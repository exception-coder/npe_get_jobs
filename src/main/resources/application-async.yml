# 异步执行器配置
# 用于全局统一的异步任务执行线程池管理和监控
async:
  executor:
    # 是否启用异步执行器（默认 true）
    enabled: true
    
    # 核心线程数
    # 如果设置为 0 或负数，将根据 CPU 核心数自动计算（CPU 核心数 * 2，最小为 4）
    # 对于 I/O 密集型任务，建议设置为 CPU 核心数的 2-4 倍
    core-pool-size: 4
    
    # 最大线程数
    # 如果设置为 0 或负数，将根据核心线程数自动计算（核心线程数 * 2）
    # 建议不要设置过大，避免上下文切换开销
    max-pool-size: 8
    
    # 队列容量
    # 当核心线程数满时，任务会放入队列等待
    # 队列满后才会创建新线程（直到达到最大线程数）
    queue-capacity: 100
    
    # 线程空闲时间（秒）
    # 超过核心线程数的线程在空闲指定时间后会被回收
    keep-alive-seconds: 60
    
    # 线程名前缀
    # 用于标识线程池中的线程，便于问题排查和监控
    thread-name-prefix: "async-exec-"
    
    # 关闭时是否等待任务完成
    # true: 优雅关闭，等待所有任务完成后再关闭线程池
    # false: 立即关闭，可能会导致任务丢失
    wait-for-tasks-on-shutdown: true
    
    # 等待终止时间（秒）
    # 关闭时等待任务完成的最长时间，超过此时间会强制关闭
    await-termination-seconds: 60
    
    # 是否启用监控功能（默认 true）
    # 启用后会定期采集线程池监控数据并输出日志
    monitor-enabled: true
    
    # 监控采集间隔（秒）
    # 定期采集线程池状态、任务执行情况等监控数据
    # 建议设置为 5-30 秒之间
    monitor-interval-seconds: 5

# 监控说明：
# 1. 线程池监控指标：
#    - 池大小（当前、核心、最大）
#    - 活跃线程数
#    - 任务统计（总数、已完成数、队列中等待数）
#    - 线程池和队列使用率
#    - 正在执行的任务列表
#
# 2. 告警机制：
#    - 当线程池使用率超过 80% 时，会输出警告日志
#    - 当队列使用率超过 80% 时，会输出警告日志
#
# 3. 日志输出：
#    - 监控日志级别为 DEBUG，详细监控数据会在 DEBUG 级别输出
#    - 警告日志级别为 WARN，重要告警信息会在 WARN 级别输出
#
# 4. 任务执行记录：
#    - 所有任务的执行状态都会被记录（SUBMITTED、RUNNING、COMPLETED、FAILED、CANCELLED）
#    - 可以通过 AsyncExecutorService 查询任务执行情况
#    - 任务执行记录会保存到数据库中，便于后续分析

# 使用建议：
# 1. 开发环境：
#    - 可以启用详细的监控日志（log level: DEBUG）
#    - 较小的线程池配置，便于调试
#
# 2. 生产环境：
#    - 根据实际负载调整线程池大小
#    - 关闭 DEBUG 日志，仅保留 WARN 以上级别
#    - 监控采集间隔可以适当延长（如 30 秒）
#
# 3. 性能调优：
#    - CPU 密集型任务：核心线程数 = CPU 核心数 + 1
#    - I/O 密集型任务：核心线程数 = CPU 核心数 * 2 ~ 4
#    - 混合型任务：根据实际测试调整
#
# 4. 容量规划：
#    - 队列容量不宜过大，避免内存占用过多
#    - 最大线程数不宜过大，避免上下文切换开销
#    - 根据业务特点和服务器配置合理设置

