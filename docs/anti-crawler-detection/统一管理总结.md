# åçˆ¬è™«å¯¹æŠ—åŠŸèƒ½ - ç»Ÿä¸€ç®¡ç†æ€»ç»“

**ç‰ˆæœ¬ï¼š** v2.0  
**æ›´æ–°æ—¶é—´ï¼š** 2026-01-22 23:59  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆç»Ÿä¸€ç®¡ç†é‡æ„

---

## ğŸ¯ é‡æ„ç›®æ ‡

å°†æ‰€æœ‰åçˆ¬è™«å¯¹æŠ—ä»£ç ç»Ÿä¸€æ•´åˆåˆ° `PlaywrightPageObserver` ç±»ä¸­ï¼Œå®ç°ï¼š
- âœ… ç»Ÿä¸€ç®¡ç†
- âœ… æ˜“äºç»´æŠ¤
- âœ… ç®€åŒ–è°ƒç”¨
- âœ… æ¸…æ™°èŒè´£

---

## ğŸ“ ä»£ç ç»“æ„

### æ ¸å¿ƒç±»

```
getjobs.common.util.PlaywrightPageObserver
â”œâ”€â”€ enableAntiCrawlerDefense()      â­ ä¸€ç«™å¼å¯ç”¨ï¼ˆæ¨èï¼‰
â”œâ”€â”€ attachRouteBlocker()            ğŸ›¡ï¸ Route API æ‹¦æˆªï¼ˆæœ€å¼ºåŠ›ï¼‰
â”œâ”€â”€ attachObservers()               ğŸ“Š é¡µé¢è¡Œä¸ºè§‚æµ‹
â”œâ”€â”€ attachBlankBlocker()            ğŸ¯ JavaScript Hook é˜»æ­¢
â”œâ”€â”€ attachBlankInterceptor()        ğŸ” JavaScript Hook è®°å½•
â”œâ”€â”€ closeObserver()                 ğŸ”’ å…³é—­å•ä¸ªè§‚æµ‹å™¨
â””â”€â”€ closeAllObservers()             ğŸ”’ å…³é—­æ‰€æœ‰è§‚æµ‹å™¨
```

### è°ƒç”¨ç±»

```
getjobs.common.service.PlaywrightService
â””â”€â”€ init()
    â””â”€â”€ enableAntiCrawlerDefense()  â­ ä¸€è¡Œä»£ç å¯ç”¨
```

---

## ğŸš€ ä½¿ç”¨æ–¹å¼

### ä¹‹å‰ï¼ˆåˆ†æ•£ç®¡ç†ï¼‰

```java
// åœ¨ PlaywrightService ä¸­
if (platform == RecruitmentPlatformEnum.BOSS_ZHIPIN) {
    // 1. é™„åŠ è§‚æµ‹å™¨
    pageObserver.attachObservers(page, platform);
    
    // 2. æ·»åŠ  Route æ‹¦æˆª
    page.route("**/*", route -> {
        String url = route.request().url();
        if (url.contains("about:blank")) {
            log.warn("ğŸ›¡ï¸ [BLOCKED] é˜»æ­¢å¯¼èˆªåˆ° about:blank: {}", url);
            route.abort();
        } else {
            route.continue_();
        }
    });
    
    log.info("âœ“ å·²ä¸º BOSS å¹³å°å¯ç”¨åçˆ¬è™«å¯¹æŠ—ï¼šè§‚æµ‹å™¨ + å¯¼èˆªæ‹¦æˆª");
}
```

**é—®é¢˜ï¼š**
- âŒ ä»£ç åˆ†æ•£åœ¨å¤šä¸ªåœ°æ–¹
- âŒ éš¾ä»¥ç»´æŠ¤å’Œæ‰©å±•
- âŒ èŒè´£ä¸æ¸…æ™°

### ç°åœ¨ï¼ˆç»Ÿä¸€ç®¡ç†ï¼‰â­

```java
// åœ¨ PlaywrightService ä¸­
if (platform == RecruitmentPlatformEnum.BOSS_ZHIPIN) {
    pageObserver.enableAntiCrawlerDefense(page, platform);
}
```

**ä¼˜åŠ¿ï¼š**
- âœ… ä¸€è¡Œä»£ç æå®š
- âœ… ç»Ÿä¸€ç®¡ç†åœ¨ PlaywrightPageObserver
- âœ… æ˜“äºç»´æŠ¤å’Œæ‰©å±•
- âœ… èŒè´£æ¸…æ™°

---

## ğŸ“Š åŠŸèƒ½å¯¹æ¯”

### æ–¹æ³•å±‚æ¬¡

```
Level 1: enableAntiCrawlerDefense()     â­ æ¨èä½¿ç”¨
    â”œâ”€â”€ attachRouteBlocker()            (è‡ªåŠ¨è°ƒç”¨)
    â””â”€â”€ attachObservers()               (è‡ªåŠ¨è°ƒç”¨)

Level 2: å•ç‹¬ä½¿ç”¨å„ä¸ªåŠŸèƒ½
    â”œâ”€â”€ attachRouteBlocker()            (æœ€å¼ºåŠ›å¯¹æŠ—)
    â”œâ”€â”€ attachObservers()               (è¡Œä¸ºç›‘æ§)
    â”œâ”€â”€ attachBlankBlocker()            (JavaScript Hook)
    â””â”€â”€ attachBlankInterceptor()        (å †æ ˆè®°å½•)
```

### ä½¿ç”¨åœºæ™¯

| åœºæ™¯ | æ¨èæ–¹æ³• | è¯´æ˜ |
|------|---------|------|
| ç”Ÿäº§ç¯å¢ƒ | `enableAntiCrawlerDefense()` | å®Œæ•´å¯¹æŠ— + ç›‘æ§ |
| å¼€å‘ç¯å¢ƒ | `enableAntiCrawlerDefense()` | ä¾¿äºè°ƒè¯•å’Œåˆ†æ |
| çº¯å¯¹æŠ— | `attachRouteBlocker()` | åªé˜»æ­¢ï¼Œä¸è®°å½• |
| çº¯åˆ†æ | `attachObservers()` | åªè®°å½•ï¼Œä¸å¯¹æŠ— |
| ç ”ç©¶ | `attachObservers()` + `attachBlankInterceptor()` | è¯¦ç»†å †æ ˆ |

---

## ğŸ“ æŠ€æœ¯æ¶æ„

### åˆ†å±‚è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PlaywrightService (è°ƒç”¨å±‚)        â”‚
â”‚   - åˆå§‹åŒ–æœåŠ¡                       â”‚
â”‚   - è°ƒç”¨ enableAntiCrawlerDefense() â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   PlaywrightPageObserver (ç®¡ç†å±‚)   â”‚
â”‚   - ç»Ÿä¸€ç®¡ç†æ‰€æœ‰å¯¹æŠ—åŠŸèƒ½             â”‚
â”‚   - æä¾›ç®€å•æ˜“ç”¨çš„ API               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Playwright API (æ‰§è¡Œå±‚)           â”‚
â”‚   - Route API (æ‹¦æˆªè¯·æ±‚)            â”‚
â”‚   - Page API (ç›‘æ§è¡Œä¸º)             â”‚
â”‚   - Context API (æ³¨å…¥è„šæœ¬)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### èŒè´£åˆ’åˆ†

| ç±» | èŒè´£ | ä¾èµ– |
|---|------|------|
| `PlaywrightService` | æœåŠ¡åˆå§‹åŒ–ã€ç”Ÿå‘½å‘¨æœŸç®¡ç† | `PlaywrightPageObserver` |
| `PlaywrightPageObserver` | åçˆ¬è™«å¯¹æŠ—åŠŸèƒ½ç»Ÿä¸€ç®¡ç† | Playwright API |
| Playwright API | åº•å±‚æµè§ˆå™¨æ§åˆ¶ | - |

---

## ğŸ“ ä»£ç ç¤ºä¾‹

### å®Œæ•´ç¤ºä¾‹

```java
@Service
public class PlaywrightService {
    private final PlaywrightPageObserver pageObserver = new PlaywrightPageObserver();
    
    @PostConstruct
    public void init() {
        // åˆå§‹åŒ–æµè§ˆå™¨
        playwright = Playwright.create();
        browser = playwright.chromium().launch(...);
        context = createNewContext();
        
        // ä¸ºæ¯ä¸ªå¹³å°åˆ›å»ºé¡µé¢
        for (RecruitmentPlatformEnum platform : RecruitmentPlatformEnum.values()) {
            Page page = createNewPage(context);
            
            // é’ˆå¯¹ BOSS å¹³å°å¯ç”¨åçˆ¬è™«å¯¹æŠ— â­
            if (platform == RecruitmentPlatformEnum.BOSS_ZHIPIN) {
                pageObserver.enableAntiCrawlerDefense(page, platform);
            }
            
            // åŠ è½½ Cookie å¹¶å¯¼èˆª
            loadPlatformCookies(platform, page);
            page.navigate(platform.getHomeUrl());
            pageMap.put(platform, page);
        }
    }
    
    @PreDestroy
    public void close() {
        // å…³é—­æ‰€æœ‰è§‚æµ‹å™¨
        pageObserver.closeAllObservers();
        
        // å…³é—­æµè§ˆå™¨
        pageMap.values().forEach(Page::close);
        if (context != null) context.close();
        if (browser != null) browser.close();
        if (playwright != null) playwright.close();
    }
}
```

### è‡ªå®šä¹‰ä½¿ç”¨

```java
// åœºæ™¯ 1: åªéœ€è¦å¯¹æŠ—ï¼Œä¸éœ€è¦ç›‘æ§
pageObserver.attachRouteBlocker(page, platform);

// åœºæ™¯ 2: åªéœ€è¦ç›‘æ§ï¼Œä¸éœ€è¦å¯¹æŠ—
pageObserver.attachObservers(page, platform);

// åœºæ™¯ 3: å®Œæ•´åŠŸèƒ½ï¼ˆæ¨èï¼‰
pageObserver.enableAntiCrawlerDefense(page, platform);

// åœºæ™¯ 4: è‡ªå®šä¹‰ç»„åˆ
pageObserver.attachRouteBlocker(page, platform);
pageObserver.attachObservers(page, platform);
pageObserver.attachBlankInterceptor(context);
```

---

## ğŸ“Š æ—¥å¿—è¾“å‡º

### å¯ç”¨æ—¶çš„æ—¥å¿—

```
========== å¯ç”¨å¹³å° Bossç›´è˜ çš„åçˆ¬è™«å¯¹æŠ—æ–¹æ¡ˆ ==========
âœ“ å·²ä¸ºå¹³å° Bossç›´è˜ æ·»åŠ  Route æ‹¦æˆªå™¨ï¼ˆç»ˆæå¯¹æŠ—æ–¹æ¡ˆï¼‰
å·²ä¸ºå¹³å° Bossç›´è˜ åˆ›å»ºè§‚æµ‹å™¨æ—¥å¿—æ–‡ä»¶: logs/playwright-observers/boss_observer_20260122_235959.log
âœ“ å·²ä¸ºå¹³å° Bossç›´è˜ é™„åŠ è§‚æµ‹å™¨ï¼Œå¼€å§‹ç›‘æ§åçˆ¬è™«è¡Œä¸º
âœ“ å¹³å° Bossç›´è˜ çš„åçˆ¬è™«å¯¹æŠ—æ–¹æ¡ˆå·²å…¨éƒ¨å¯ç”¨
  - Route æ‹¦æˆªå™¨ï¼šé˜»æ­¢ about:blank è·³è½¬
  - é¡µé¢è§‚æµ‹å™¨ï¼šè®°å½•æ‰€æœ‰å¯ç–‘è¡Œä¸º
==================================================================
```

### è¿è¡Œæ—¶çš„æ—¥å¿—

```
# Route æ‹¦æˆªæˆåŠŸ
ğŸ›¡ï¸ [ROUTE-BLOCKED] å¹³å° Bossç›´è˜ - é˜»æ­¢å¯¼èˆªåˆ° about:blank: about:blank

# è§‚æµ‹å™¨è®°å½•
[CONSOLE] warning [ANTI-DEBUG] beforeunload äº‹ä»¶è§¦å‘ï¼Œé¡µé¢å³å°†è·³è½¬
[CONSOLE] warning [ANTI-DEBUG] å½“å‰ URL: https://www.zhipin.com/guangzhou/
[CONSOLE] warning [ANTI-DEBUG] å †æ ˆ: Error
    at <anonymous>:83:38
    at https://static.zhipin.com/zhipin-geek-seo/v5404/web/geek/js/main.js:1:357108
```

---

## ğŸ”§ æ‰©å±•æŒ‡å—

### æ·»åŠ æ–°çš„æ‹¦æˆªè§„åˆ™

åœ¨ `PlaywrightPageObserver.attachRouteBlocker()` ä¸­ï¼š

```java
page.route("**/*", route -> {
    String url = route.request().url();
    
    // æ‹¦æˆª about:blank
    if (url.contains("about:blank")) {
        log.warn("ğŸ›¡ï¸ [ROUTE-BLOCKED] å¹³å° {} - é˜»æ­¢ about:blank", platform.getPlatformName());
        route.abort();
        return;
    }
    
    // æ–°å¢ï¼šæ‹¦æˆªå…¶ä»–å¯ç–‘ URL
    if (url.contains("error") || url.contains("forbidden")) {
        log.warn("ğŸ›¡ï¸ [ROUTE-BLOCKED] å¹³å° {} - å¯ç–‘ URL: {}", platform.getPlatformName(), url);
        route.abort();
        return;
    }
    
    route.continue_();
});
```

### æ·»åŠ æ–°çš„ç›‘æ§é¡¹

åœ¨ `PlaywrightPageObserver.attachObservers()` ä¸­ï¼š

```java
// æ–°å¢ï¼šç›‘æ§ dialog äº‹ä»¶
page.onDialog(dialog -> {
    writeToObserverLog(writer, "[DIALOG] " + dialog.type() + " " + dialog.message());
    dialog.dismiss();
});

// æ–°å¢ï¼šç›‘æ§ popup äº‹ä»¶
page.onPopup(popup -> {
    writeToObserverLog(writer, "[POPUP] " + popup.url());
});
```

### æ”¯æŒæ–°çš„å¹³å°

```java
// åœ¨ PlaywrightService.init() ä¸­
if (platform == RecruitmentPlatformEnum.ZHILIAN_ZHAOPIN) {
    pageObserver.enableAntiCrawlerDefense(page, platform);
}
```

---

## ğŸ“š æ–‡æ¡£ç»“æ„

```
docs/anti-crawler-detection/
â”œâ”€â”€ README.md                                   # ğŸ“š ç›®å½•ç´¢å¼•
â”œâ”€â”€ PlaywrightPageObserverä½¿ç”¨æŒ‡å—.md â­        # ğŸ”§ å·¥å…·ç±»ä½¿ç”¨æ‰‹å†Œï¼ˆæ–°å¢ï¼‰
â”œâ”€â”€ åçˆ¬è™«æ£€æµ‹åŠŸèƒ½è¯´æ˜.md                        # ğŸ“– åŠŸèƒ½è¯´æ˜
â”œâ”€â”€ Bossç›´è˜åçˆ¬è™«åˆ†ææŠ¥å‘Š.md                    # ğŸ” åˆ†ææŠ¥å‘Š
â”œâ”€â”€ Bossç›´è˜åçˆ¬è™«å¯¹æŠ—æ–¹æ¡ˆ.md                    # ğŸ›¡ï¸ å¯¹æŠ—æ–¹æ¡ˆ
â”œâ”€â”€ ç´§æ€¥æ›´æ–°-Route-APIæ–¹æ¡ˆ.md                   # âš¡ Route API è¯´æ˜
â””â”€â”€ ç»Ÿä¸€ç®¡ç†æ€»ç»“.md                             # ğŸ“‹ æœ¬æ–‡æ¡£
```

---

## âœ… é‡æ„æˆæœ

### ä»£ç æ”¹è¿›

1. âœ… **ç»Ÿä¸€ç®¡ç†** - æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ `PlaywrightPageObserver`
2. âœ… **ç®€åŒ–è°ƒç”¨** - ä¸€è¡Œä»£ç å¯ç”¨æ‰€æœ‰åŠŸèƒ½
3. âœ… **æ¸…æ™°èŒè´£** - æ¯ä¸ªç±»èŒè´£æ˜ç¡®
4. âœ… **æ˜“äºæ‰©å±•** - æ–°å¢åŠŸèƒ½åªéœ€ä¿®æ”¹ä¸€ä¸ªç±»
5. âœ… **å®Œå–„æ–‡æ¡£** - æä¾›è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—

### åŠŸèƒ½å¢å¼º

1. âœ… **Route API æ‹¦æˆª** - æœ€å¼ºåŠ›çš„å¯¹æŠ—æ–¹æ³•
2. âœ… **JavaScript Hook** - è¾…åŠ©å¯¹æŠ—å’Œåˆ†æ
3. âœ… **é¡µé¢è§‚æµ‹å™¨** - å…¨é¢ç›‘æ§é¡µé¢è¡Œä¸º
4. âœ… **ä¸€ç«™å¼å¯ç”¨** - `enableAntiCrawlerDefense()`
5. âœ… **çµæ´»ç»„åˆ** - æ”¯æŒå•ç‹¬ä½¿ç”¨å„ä¸ªåŠŸèƒ½

### æ–‡æ¡£å®Œå–„

1. âœ… **ä½¿ç”¨æŒ‡å—** - `PlaywrightPageObserverä½¿ç”¨æŒ‡å—.md`
2. âœ… **API å‚è€ƒ** - å®Œæ•´çš„æ–¹æ³•è¯´æ˜
3. âœ… **ç¤ºä¾‹ä»£ç ** - å¤šç§ä½¿ç”¨åœºæ™¯
4. âœ… **æ•…éšœæ’æŸ¥** - å¸¸è§é—®é¢˜è§£å†³
5. âœ… **æœ€ä½³å®è·µ** - æ¨èä½¿ç”¨æ–¹å¼

---

## ğŸ¯ ä¸‹ä¸€æ­¥

### ç«‹å³æ‰§è¡Œ

1. **é‡å¯åº”ç”¨** - éªŒè¯ç»Ÿä¸€ç®¡ç†åçš„åŠŸèƒ½
2. **æŸ¥çœ‹æ—¥å¿—** - ç¡®è®¤ Route æ‹¦æˆªå™¨å·¥ä½œæ­£å¸¸
3. **æµ‹è¯•é¡µé¢** - éªŒè¯ä¸å†è·³è½¬åˆ° about:blank

### æŒç»­ä¼˜åŒ–

1. **ç›‘æ§æ•ˆæœ** - é•¿æœŸè§‚å¯Ÿå¯¹æŠ—æ•ˆæœ
2. **æ”¶é›†åé¦ˆ** - è®°å½•ä½¿ç”¨ä¸­çš„é—®é¢˜
3. **æŒç»­æ”¹è¿›** - æ ¹æ®åé¦ˆä¼˜åŒ–åŠŸèƒ½

### æœªæ¥è®¡åˆ’

1. **æ”¯æŒæ›´å¤šå¹³å°** - æ‰©å±•åˆ°å…¶ä»–æ‹›è˜å¹³å°
2. **å¢å¼ºæ£€æµ‹** - æ·»åŠ æ›´å¤šåçˆ¬è™«ç‰¹å¾æ£€æµ‹
3. **è‡ªåŠ¨åŒ–å¯¹æŠ—** - æ ¹æ®æ£€æµ‹ç»“æœè‡ªåŠ¨è°ƒæ•´ç­–ç•¥

---

## ğŸ“ æ”¯æŒ

### ç›¸å…³æ–‡æ¡£

- [PlaywrightPageObserverä½¿ç”¨æŒ‡å—](./PlaywrightPageObserverä½¿ç”¨æŒ‡å—.md) â­
- [åçˆ¬è™«æ£€æµ‹åŠŸèƒ½è¯´æ˜](./åçˆ¬è™«æ£€æµ‹åŠŸèƒ½è¯´æ˜.md)
- [Bossç›´è˜åçˆ¬è™«åˆ†ææŠ¥å‘Š](./Bossç›´è˜åçˆ¬è™«åˆ†ææŠ¥å‘Š.md)
- [Bossç›´è˜åçˆ¬è™«å¯¹æŠ—æ–¹æ¡ˆ](./Bossç›´è˜åçˆ¬è™«å¯¹æŠ—æ–¹æ¡ˆ.md)

### æ ¸å¿ƒä»£ç 

- `getjobs.common.util.PlaywrightPageObserver` - ç»Ÿä¸€ç®¡ç†ç±»
- `getjobs.common.service.PlaywrightService` - æœåŠ¡è°ƒç”¨ç±»

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ¬¡é‡æ„ï¼Œæˆ‘ä»¬å®ç°äº†ï¼š

1. âœ… **ä»£ç ç»Ÿä¸€ç®¡ç†** - æ‰€æœ‰åŠŸèƒ½é›†ä¸­åœ¨ä¸€ä¸ªç±»
2. âœ… **ä½¿ç”¨æ›´åŠ ç®€å•** - ä¸€è¡Œä»£ç å¯ç”¨æ‰€æœ‰åŠŸèƒ½
3. âœ… **ç»´æŠ¤æ›´åŠ å®¹æ˜“** - ä¿®æ”¹åªéœ€æ”¹ä¸€ä¸ªåœ°æ–¹
4. âœ… **æ–‡æ¡£æ›´åŠ å®Œå–„** - æä¾›è¯¦ç»†çš„ä½¿ç”¨æŒ‡å—
5. âœ… **åŠŸèƒ½æ›´åŠ å¼ºå¤§** - Route API + JavaScript Hook

**ç°åœ¨ï¼Œåçˆ¬è™«å¯¹æŠ—åŠŸèƒ½å·²ç»å®Œå…¨ç»Ÿä¸€ç®¡ç†ï¼Œæ˜“äºä½¿ç”¨å’Œç»´æŠ¤ï¼** ğŸš€

---

**æœ€åæ›´æ–°ï¼š** 2026-01-22 23:59  
**ç‰ˆæœ¬ï¼š** v2.0  
**çŠ¶æ€ï¼š** âœ… å·²å®Œæˆç»Ÿä¸€ç®¡ç†é‡æ„

