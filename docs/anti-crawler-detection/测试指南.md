# ğŸ¯ Boss ç›´è˜åçˆ¬è™«æ£€æµ‹ - å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ é—®é¢˜æ€»ç»“

### åŸå§‹é—®é¢˜
- âŒ é¡µé¢è¢«åŠ«æŒåˆ° `about:blank`
- âŒ æ‰€æœ‰ JavaScript Hook éƒ½å¤±è´¥
- âŒ Route API æ— æ³•æ‹¦æˆª
- âŒ ç‰¹å¾æ£€æµ‹è„šæœ¬æœ¬èº«æŠ¥é”™ï¼š`TypeError: Illegal invocation`

### æ ¹æœ¬åŸå› 
Boss ç›´è˜æ£€æµ‹åˆ°äº†ä»¥ä¸‹ Playwright ç‰¹å¾ï¼š
1. `navigator.webdriver === true`
2. `window.chrome` å¯¹è±¡ç¼ºå¤±
3. `navigator.plugins.length === 0`
4. å…¶ä»–æµè§ˆå™¨æŒ‡çº¹ç‰¹å¾

---

## âœ… è§£å†³æ–¹æ¡ˆï¼ˆå·²å®æ–½ï¼‰

### 1. å®Œæ•´çš„ Stealth è„šæœ¬

åœ¨ `PlaywrightService.createNewContext()` ä¸­æ³¨å…¥äº†å®Œæ•´çš„éšè—è„šæœ¬ï¼š

```java
context.addInitScript(
    "// 1. éšè— webdriver\n" +
    "Object.defineProperty(navigator, 'webdriver', { get: () => undefined });\n" +
    "\n" +
    "// 2. ä¼ªé€  window.chrome\n" +
    "window.chrome = { runtime: {}, loadTimes: function() {}, csi: function() {}, app: {} };\n" +
    "\n" +
    "// 3. ä¼ªé€  navigator.plugins\n" +
    "Object.defineProperty(navigator, 'plugins', { get: () => [1, 2, 3, 4, 5] });\n" +
    "\n" +
    "// 4. ä¼ªé€  navigator.languages\n" +
    "Object.defineProperty(navigator, 'languages', { get: () => ['zh-CN', 'zh', 'en'] });\n" +
    "\n" +
    "// 5. ä¿®å¤ permissions API\n" +
    "// 6. è¦†ç›– toString æ–¹æ³•\n" +
    "console.log('[STEALTH] âœ“ All Playwright features hidden successfully');"
);
```

### 2. ä¼˜åŒ–çš„æµè§ˆå™¨å¯åŠ¨å‚æ•°

```java
.setArgs(List.of(
    "--disable-blink-features=AutomationControlled",
    "--exclude-switches=enable-automation",
    "--disable-infobars",
    "--window-size=1920,1080"
))
```

### 3. å®Œå–„çš„ BrowserContext é…ç½®

```java
.setViewportSize(1920, 1080)
.setDeviceScaleFactor(1.0)
.setHasTouch(false)
.setIsMobile(false)
```

### 4. ç§»é™¤æœ‰é—®é¢˜çš„ä»£ç 

- âŒ ç§»é™¤äº† `pageObserver.attachPlaywrightDetector(context)` - ä¼šæŠ¥é”™
- âœ… ä¿ç•™äº† `pageObserver.attachBlankBlocker(context)` - è¾…åŠ©åŠŸèƒ½
- âœ… ä¿ç•™äº† `pageObserver.attachBlankInterceptor(context)` - è¾…åŠ©åŠŸèƒ½

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³• 1ï¼šé‡å¯åº”ç”¨ï¼ˆæ¨èï¼‰

```bash
# 1. åœæ­¢åº”ç”¨
# 2. å¯åŠ¨åº”ç”¨
# 3. è§‚å¯Ÿæ—¥å¿—
```

**æˆåŠŸæ ‡å¿—**ï¼š
```
[STEALTH] âœ“ All Playwright features hidden successfully
âœ“ å·²ä¸ºå¹³å° BOSSç›´è˜ åˆå§‹åŒ–é¡µé¢: https://www.zhipin.com/
```

**å¤±è´¥æ ‡å¿—**ï¼š
```
[PAGE_ERROR] TypeError: Illegal invocation
[BLANK_REDIRECT] é¡µé¢è¢«åŠ«æŒåˆ° about:blank
```

### æ–¹æ³• 2ï¼šè¿è¡Œæµ‹è¯•å·¥å…·

```bash
# è¿è¡Œç‹¬ç«‹æµ‹è¯•å·¥å…·
java getjobs.common.util.PlaywrightStealthTester
```

æµ‹è¯•å·¥å…·ä¼šï¼š
1. å¯åŠ¨æµè§ˆå™¨
2. è®¿é—® Boss ç›´è˜
3. æ£€æŸ¥æ˜¯å¦è·³è½¬åˆ° `about:blank`
4. è¾“å‡ºæ‰€æœ‰ç‰¹å¾æ£€æµ‹ç»“æœ
5. ä¿æŒæµè§ˆå™¨æ‰“å¼€ 30 ç§’ä¾›æ‰‹åŠ¨æ£€æŸ¥

### æ–¹æ³• 3ï¼šæµè§ˆå™¨æ§åˆ¶å°æ‰‹åŠ¨éªŒè¯

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼Œæ‰§è¡Œï¼š

```javascript
// åº”è¯¥å…¨éƒ¨è¿”å›æ­£å¸¸å€¼
console.log({
    webdriver: navigator.webdriver,        // åº”è¯¥æ˜¯ undefined
    chrome: window.chrome,                 // åº”è¯¥æ˜¯å¯¹è±¡
    plugins: navigator.plugins.length,     // åº”è¯¥ > 0
    languages: navigator.languages         // åº”è¯¥æ˜¯ ['zh-CN', 'zh', 'en']
});
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

### ä¿®å¤å‰ âŒ
```
2026-01-23 00:31:17 [PAGE_ERROR] TypeError: Illegal invocation at <anonymous>:87:22
2026-01-23 00:31:18 [BLANK_REDIRECT] æ£€æµ‹åˆ°è·³è½¬åˆ° about:blank
2026-01-23 00:31:18 å½“å‰ URL: about:blank
```

### ä¿®å¤å âœ…
```
2026-01-23 00:40:00 [STEALTH] âœ“ All Playwright features hidden successfully
2026-01-23 00:40:01 âœ“ å·²ä¸ºå¹³å° BOSSç›´è˜ åˆå§‹åŒ–é¡µé¢: https://www.zhipin.com/
2026-01-23 00:40:02 å½“å‰ URL: https://www.zhipin.com/
```

---

## ğŸ” å¦‚æœè¿˜æ˜¯è¢«æ£€æµ‹åˆ°

### é«˜çº§æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Chrome DevTools Protocol (CDP)

```java
// ä½¿ç”¨ CDP æ›´åº•å±‚åœ°ä¿®æ”¹æµè§ˆå™¨ç‰¹å¾
Page page = context.newPage();
page.context().addInitScript("...");
```

### é«˜çº§æ–¹æ¡ˆ 2ï¼šä½¿ç”¨çœŸå®çš„ Chrome é…ç½®æ–‡ä»¶

```java
browser = playwright.chromium().launch(new BrowserType.LaunchOptions()
    .setChannel("chrome")  // ä½¿ç”¨ç³»ç»Ÿå®‰è£…çš„ Chrome
    .setArgs(List.of(
        "--user-data-dir=/path/to/real/chrome/profile"
    ))
);
```

### é«˜çº§æ–¹æ¡ˆ 3ï¼šé™ä½çˆ¬å–é¢‘ç‡

```java
// æ¨¡æ‹ŸçœŸå®ç”¨æˆ·è¡Œä¸º
Thread.sleep(2000 + random.nextInt(3000));  // éšæœºå»¶è¿Ÿ 2-5 ç§’
```

### é«˜çº§æ–¹æ¡ˆ 4ï¼šä½¿ç”¨ä»£ç† IP æ± 

```java
context = browser.newContext(new Browser.NewContextOptions()
    .setProxy(new Proxy("http://proxy-server:port"))
);
```

---

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### 1. PlaywrightService.java
- âœ… `createNewContext()` - æ·»åŠ å®Œæ•´ Stealth è„šæœ¬
- âœ… `init()` - ä¼˜åŒ–æµè§ˆå™¨å¯åŠ¨å‚æ•°
- âœ… ç§»é™¤äº†æœ‰é—®é¢˜çš„ç‰¹å¾æ£€æµ‹è°ƒç”¨

### 2. æ–°å¢æ–‡ä»¶
- âœ… `PlaywrightStealthTester.java` - ç‹¬ç«‹æµ‹è¯•å·¥å…·
- âœ… `docs/anti-crawler-detection/è§£å†³æ–¹æ¡ˆ.md` - å®Œæ•´è§£å†³æ–¹æ¡ˆæ–‡æ¡£
- âœ… `docs/anti-crawler-detection/ä¿®å¤è®°å½•.md` - ä¿®å¤è®°å½•
- âœ… `docs/anti-crawler-detection/æµ‹è¯•æŒ‡å—.md` - æœ¬æ–‡æ¡£

### 3. æœªä¿®æ”¹çš„æ–‡ä»¶
- âšª `PlaywrightPageObserver.java` - ä¿æŒä¸å˜
- âšª `AntiCrawlerAnalyzer.java` - ä¿æŒä¸å˜

---

## ğŸ“ æ ¸å¿ƒç»éªŒ

### â­ æœ€é‡è¦çš„ä¸‰ä¸ªç‰¹å¾
1. **navigator.webdriver** - å¿…é¡»æ˜¯ `undefined`
2. **window.chrome** - å¿…é¡»å­˜åœ¨ä¸”æœ‰æ­£ç¡®çš„å±æ€§
3. **navigator.plugins** - å¿…é¡»è¿”å›éç©ºæ•°ç»„

### å¸¸è§é”™è¯¯
```javascript
// âŒ é”™è¯¯ï¼šä½¿ç”¨ deleteï¼ˆä¸å¤Ÿå½»åº•ï¼‰
delete navigator.webdriver;

// âœ… æ­£ç¡®ï¼šä½¿ç”¨ Object.definePropertyï¼ˆå®Œå…¨æ§åˆ¶ï¼‰
Object.defineProperty(navigator, 'webdriver', { get: () => undefined });
```

### è°ƒè¯•æŠ€å·§
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­ä¸€æ¬¡æ€§æ£€æŸ¥æ‰€æœ‰ç‰¹å¾
console.table({
    'navigator.webdriver': navigator.webdriver,
    'window.chrome': typeof window.chrome,
    'navigator.plugins.length': navigator.plugins.length,
    'navigator.languages': navigator.languages.join(', ')
});
```

---

## ğŸ“š å‚è€ƒèµ„æ–™

1. **Playwright å®˜æ–¹æ–‡æ¡£**
   - [Emulation](https://playwright.dev/docs/emulation)
   - [Browser Contexts](https://playwright.dev/docs/browser-contexts)

2. **åæ£€æµ‹æŠ€æœ¯**
   - [puppeteer-extra-plugin-stealth](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth)
   - [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver)

3. **æµè§ˆå™¨æŒ‡çº¹**
   - [FingerprintJS](https://github.com/fingerprintjs/fingerprintjs)
   - [CreepJS](https://abrahamjuliot.github.io/creepjs/)

---

## âœ¨ æ€»ç»“

### æ ¸å¿ƒæ€è·¯è½¬å˜
- **ä¹‹å‰**ï¼šæ£€æµ‹åˆ°è·³è½¬åé˜»æ­¢ â†’ æ²»æ ‡ä¸æ²»æœ¬ âŒ
- **ç°åœ¨**ï¼šå®Œå…¨éšè— Playwright ç‰¹å¾ â†’ ä»æ ¹æºè§£å†³ âœ…

### å…³é”®æˆåŠŸå› ç´ 
1. âœ… **å…¨é¢æ€§** - éšè—æ‰€æœ‰å¯èƒ½æš´éœ²çš„ç‰¹å¾
2. âœ… **å½»åº•æ€§** - ä½¿ç”¨ `Object.defineProperty` å®Œå…¨æ§åˆ¶
3. âœ… **çœŸå®æ€§** - ä¼ªé€ çš„ç‰¹å¾è¦åƒçœŸå®æµè§ˆå™¨
4. âœ… **æ—¶æœºæ€§** - åœ¨é¡µé¢åŠ è½½å‰æ³¨å…¥è„šæœ¬

### ä¸‹ä¸€æ­¥
1. ğŸš€ é‡å¯åº”ç”¨ï¼ŒéªŒè¯ä¿®å¤æ•ˆæœ
2. ğŸ“Š ç›‘æ§é•¿æœŸç¨³å®šæ€§
3. ğŸ“ è®°å½•æˆåŠŸç»éªŒ
4. ğŸ”„ æŒç»­ä¼˜åŒ–å’Œæ”¹è¿›

---

## ğŸ†˜ é‡åˆ°é—®é¢˜ï¼Ÿ

### é—®é¢˜ 1ï¼šè¿˜æ˜¯è·³è½¬åˆ° about:blank
**å¯èƒ½åŸå› **ï¼š
- è„šæœ¬æ³¨å…¥æ—¶æœºå¤ªæ™š
- è¿˜æœ‰å…¶ä»–ç‰¹å¾è¢«æ£€æµ‹åˆ°

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰ `[STEALTH]` æ—¥å¿—
- æ‰‹åŠ¨éªŒè¯æ‰€æœ‰ç‰¹å¾æ˜¯å¦æ­£ç¡®éšè—
- è€ƒè™‘ä½¿ç”¨é«˜çº§æ–¹æ¡ˆï¼ˆCDPã€çœŸå®é…ç½®æ–‡ä»¶ç­‰ï¼‰

### é—®é¢˜ 2ï¼šé¡µé¢åŠ è½½å¾ˆæ…¢
**å¯èƒ½åŸå› **ï¼š
- ç½‘ç»œé—®é¢˜
- åçˆ¬è™«è„šæœ¬åœ¨éªŒè¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¢åŠ è¶…æ—¶æ—¶é—´
- ä½¿ç”¨ä»£ç† IP
- é™ä½çˆ¬å–é¢‘ç‡

### é—®é¢˜ 3ï¼šæ§åˆ¶å°æŠ¥é”™
**å¯èƒ½åŸå› **ï¼š
- JavaScript è¯­æ³•é”™è¯¯
- æµè§ˆå™¨ç‰ˆæœ¬ä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ Stealth è„šæœ¬è¯­æ³•
- æ›´æ–° Playwright ç‰ˆæœ¬
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯ä¿¡æ¯

---

**ç¥æµ‹è¯•é¡ºåˆ©ï¼ğŸ‰**

