# Boss ç›´è˜åçˆ¬è™«æ£€æµ‹ä¿®å¤è®°å½•

## ğŸ“… ä¿®å¤æ—¶é—´
2026-01-23 00:40

## ğŸ¯ é—®é¢˜æè¿°

### æ ¸å¿ƒé—®é¢˜
é¡µé¢è¢«åŠ«æŒåˆ° `about:blank`ï¼Œæ‰€æœ‰åçˆ¬è™«å¯¹æŠ—æªæ–½éƒ½å¤±è´¥äº†ã€‚

### æ ¹æœ¬åŸå› 
1. **åªéšè—äº† `navigator.webdriver`** - ä¸å¤Ÿå…¨é¢
2. **ç‰¹å¾æ£€æµ‹è„šæœ¬æœ¬èº«æŠ¥é”™** - `TypeError: Illegal invocation` at line 87
3. **ç¼ºå°‘å…³é”®çš„æµè§ˆå™¨ç‰¹å¾ä¼ªé€ ** - `window.chrome`ã€`navigator.plugins` ç­‰

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. å®Œæ•´çš„ Stealth è„šæœ¬

åœ¨ `PlaywrightService.createNewContext()` ä¸­æ·»åŠ äº†å®Œæ•´çš„éšè—è„šæœ¬ï¼š

```java
context.addInitScript(
    "// 1. éšè— webdriver å±æ€§\n" +
    "Object.defineProperty(navigator, 'webdriver', {\n" +
    "  get: () => undefined\n" +
    "});\n" +
    "\n" +
    "// 2. ä¼ªé€  window.chrome å¯¹è±¡ï¼ˆé‡è¦ï¼ï¼‰\n" +
    "window.chrome = {\n" +
    "  runtime: {},\n" +
    "  loadTimes: function() {},\n" +
    "  csi: function() {},\n" +
    "  app: {}\n" +
    "};\n" +
    "\n" +
    "// 3. ä¼ªé€  navigator.pluginsï¼ˆé‡è¦ï¼ï¼‰\n" +
    "Object.defineProperty(navigator, 'plugins', {\n" +
    "  get: () => [1, 2, 3, 4, 5]\n" +
    "});\n" +
    "\n" +
    "// 4. ä¼ªé€  navigator.languages\n" +
    "Object.defineProperty(navigator, 'languages', {\n" +
    "  get: () => ['zh-CN', 'zh', 'en']\n" +
    "});\n" +
    "\n" +
    "// 5. ä¿®å¤ permissions API\n" +
    "const originalQuery = window.navigator.permissions.query;\n" +
    "window.navigator.permissions.query = (parameters) => (\n" +
    "  parameters.name === 'notifications' ?\n" +
    "    Promise.resolve({ state: Notification.permission }) :\n" +
    "    originalQuery(parameters)\n" +
    ");\n" +
    "\n" +
    "// 6. è¦†ç›– toString æ–¹æ³•\n" +
    "const oldToString = Function.prototype.toString;\n" +
    "Function.prototype.toString = function() {\n" +
    "  if (this === window.navigator.permissions.query) {\n" +
    "    return 'function query() { [native code] }';\n" +
    "  }\n" +
    "  return oldToString.call(this);\n" +
    "};\n" +
    "\n" +
    "console.log('[STEALTH] âœ“ All Playwright features hidden successfully');"
);
```

### 2. ç§»é™¤æœ‰é—®é¢˜çš„ç‰¹å¾æ£€æµ‹è„šæœ¬

**ç§»é™¤äº†**ï¼š
```java
// âŒ è¿™ä¸ªè„šæœ¬ä¼šæŠ¥é”™ï¼Œæš´éœ²ç‰¹å¾
pageObserver.attachPlaywrightDetector(context);
```

**ä¿ç•™äº†**ï¼š
```java
// âœ… è¿™äº›æ˜¯è¾…åŠ©åŠŸèƒ½ï¼Œä¸ä¼šæš´éœ²ç‰¹å¾
pageObserver.attachBlankBlocker(context);
pageObserver.attachBlankInterceptor(context);
```

### 3. ä¼˜åŒ–æµè§ˆå™¨å¯åŠ¨å‚æ•°

æ·»åŠ äº†æ›´å¤šéšè—ç‰¹å¾çš„å‚æ•°ï¼š

```java
.setArgs(List.of(
    // æ ¸å¿ƒï¼šç¦ç”¨è‡ªåŠ¨åŒ–æ§åˆ¶ç‰¹å¾
    "--disable-blink-features=AutomationControlled",
    
    // é¢å¤–çš„éšè—ç‰¹å¾å‚æ•°
    "--exclude-switches=enable-automation",
    "--disable-infobars",
    "--window-size=1920,1080"
))
```

### 4. å®Œå–„ BrowserContext é…ç½®

æ·»åŠ äº†æ›´å¤šçœŸå®æµè§ˆå™¨çš„ç‰¹å¾ï¼š

```java
.setViewportSize(1920, 1080)  // è®¾ç½®çœŸå®çš„è§†å£å¤§å°
.setDeviceScaleFactor(1.0)    // è®¾ç½®è®¾å¤‡åƒç´ æ¯”
.setHasTouch(false)           // ä¸æ˜¯è§¦æ‘¸è®¾å¤‡
.setIsMobile(false)           // ä¸æ˜¯ç§»åŠ¨è®¾å¤‡
```

## ğŸ“Š ä¿®å¤æ•ˆæœé¢„æœŸ

### ä¿®å¤å‰
```
[PAGE_ERROR] TypeError: Illegal invocation at <anonymous>:87:22
[BLANK_REDIRECT] é¡µé¢è¢«åŠ«æŒåˆ° about:blank
```

### ä¿®å¤åï¼ˆé¢„æœŸï¼‰
```
[STEALTH] âœ“ All Playwright features hidden successfully
é¡µé¢æ­£å¸¸åŠ è½½ï¼Œä¸å†è·³è½¬åˆ° about:blank
```

## ğŸ” éªŒè¯æ­¥éª¤

### 1. é‡å¯åº”ç”¨
```bash
# åœæ­¢åº”ç”¨
# å¯åŠ¨åº”ç”¨
```

### 2. è§‚å¯Ÿæ—¥å¿—

**æˆåŠŸæ ‡å¿—**ï¼š
- âœ… çœ‹åˆ° `[STEALTH] âœ“ All Playwright features hidden successfully`
- âœ… æ²¡æœ‰ `[PAGE_ERROR]` é”™è¯¯
- âœ… æ²¡æœ‰ `[BLANK_REDIRECT]` è­¦å‘Š
- âœ… é¡µé¢æ­£å¸¸åŠ è½½ Boss ç›´è˜é¦–é¡µ

**å¤±è´¥æ ‡å¿—**ï¼š
- âŒ ä»ç„¶çœ‹åˆ° `[PAGE_ERROR]`
- âŒ ä»ç„¶è·³è½¬åˆ° `about:blank`
- âŒ é¡µé¢åŠ è½½å¤±è´¥

### 3. æµè§ˆå™¨æ§åˆ¶å°éªŒè¯

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œæ‰‹åŠ¨æ£€æŸ¥ï¼š

```javascript
// åº”è¯¥è¿”å› undefined
console.log(navigator.webdriver);

// åº”è¯¥è¿”å›å¯¹è±¡
console.log(window.chrome);

// åº”è¯¥è¿”å›æ•°ç»„
console.log(navigator.plugins);

// åº”è¯¥è¿”å› ['zh-CN', 'zh', 'en']
console.log(navigator.languages);
```

## ğŸ“ å…³é”®æ–‡ä»¶ä¿®æ”¹

### ä¿®æ”¹çš„æ–‡ä»¶
1. `PlaywrightService.java`
   - `createNewContext()` æ–¹æ³•
   - `init()` æ–¹æ³•ä¸­çš„æµè§ˆå™¨å¯åŠ¨å‚æ•°

### æœªä¿®æ”¹çš„æ–‡ä»¶
1. `PlaywrightPageObserver.java` - ä¿æŒä¸å˜
2. `AntiCrawlerAnalyzer.java` - ä¿æŒä¸å˜

## ğŸ“ ç»éªŒæ€»ç»“

### 1. éšè— Playwright ç‰¹å¾çš„å…³é”®ç‚¹

#### â­ æœ€é‡è¦çš„ä¸‰ä¸ªç‰¹å¾
1. **navigator.webdriver** - å¿…é¡»è®¾ç½®ä¸º `undefined`
2. **window.chrome** - å¿…é¡»ä¼ªé€ å®Œæ•´çš„å¯¹è±¡
3. **navigator.plugins** - å¿…é¡»è¿”å›éç©ºæ•°ç»„

#### å…¶ä»–é‡è¦ç‰¹å¾
4. **navigator.languages** - åº”è¯¥è¿”å›çœŸå®çš„è¯­è¨€åˆ—è¡¨
5. **permissions API** - åº”è¯¥æ­£å¸¸å·¥ä½œ
6. **Function.prototype.toString** - åº”è¯¥è¿”å› `[native code]`

### 2. å¸¸è§é”™è¯¯

#### âŒ é”™è¯¯åšæ³•
```java
// åªéšè— webdriverï¼Œä¸å¤Ÿå…¨é¢
context.addInitScript("delete navigator.webdriver;");
```

#### âœ… æ­£ç¡®åšæ³•
```java
// ä½¿ç”¨ Object.defineProperty å®Œå…¨æ§åˆ¶å±æ€§
context.addInitScript(
    "Object.defineProperty(navigator, 'webdriver', { get: () => undefined });"
);
```

### 3. è°ƒè¯•æŠ€å·§

#### ä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°
```javascript
// æ£€æŸ¥æ‰€æœ‰å¯èƒ½æš´éœ²çš„ç‰¹å¾
console.log({
    webdriver: navigator.webdriver,
    chrome: window.chrome,
    plugins: navigator.plugins.length,
    languages: navigator.languages
});
```

#### ä½¿ç”¨ Playwright çš„ evaluate
```java
page.evaluate("() => console.log(navigator.webdriver)");
```

## ğŸš€ ä¸‹ä¸€æ­¥è®¡åˆ’

### å¦‚æœä¿®å¤æˆåŠŸ
1. âœ… ç»§ç»­å®Œå–„å…¶ä»–åŠŸèƒ½
2. âœ… ç›‘æ§é•¿æœŸç¨³å®šæ€§
3. âœ… è®°å½•æˆåŠŸç»éªŒ

### å¦‚æœä¿®å¤å¤±è´¥
1. ğŸ” åˆ†ææ–°çš„æ£€æµ‹æ–¹å¼
2. ğŸ” è€ƒè™‘ä½¿ç”¨ Chrome DevTools Protocol (CDP)
3. ğŸ” è€ƒè™‘ä½¿ç”¨çœŸå®çš„ Chrome ç”¨æˆ·é…ç½®æ–‡ä»¶
4. ğŸ” è€ƒè™‘é™ä½çˆ¬å–é¢‘ç‡

## ğŸ“š å‚è€ƒèµ„æ–™

1. [Playwright Stealth](https://github.com/berstend/puppeteer-extra/tree/master/packages/puppeteer-extra-plugin-stealth)
2. [undetected-chromedriver](https://github.com/ultrafunkamsterdam/undetected-chromedriver)
3. [Playwright Anti-Detection](https://playwright.dev/docs/emulation)
4. [Chrome DevTools Protocol](https://chromedevtools.github.io/devtools-protocol/)

## âœ¨ æ€»ç»“

æœ¬æ¬¡ä¿®å¤çš„æ ¸å¿ƒæ€è·¯æ˜¯ï¼š**ä»"é˜»æ­¢è·³è½¬"è½¬å˜ä¸º"éšè—ç‰¹å¾"**ã€‚

- **ä¹‹å‰çš„æ–¹æ¡ˆ**ï¼šæ£€æµ‹åˆ°è·³è½¬åé˜»æ­¢ â†’ æ²»æ ‡ä¸æ²»æœ¬
- **ç°åœ¨çš„æ–¹æ¡ˆ**ï¼šå®Œå…¨éšè— Playwright ç‰¹å¾ â†’ ä»æ ¹æºè§£å†³é—®é¢˜

å…³é”®æ˜¯è¦**å…¨é¢ã€å½»åº•åœ°éšè—æ‰€æœ‰å¯èƒ½æš´éœ²çš„ç‰¹å¾**ï¼Œè€Œä¸æ˜¯åªéšè—ä¸€ä¸¤ä¸ªã€‚

