import{k as N,l as at,m as _,r as Le,h as Ae,a as Ce,f as P,d as je,w as ue,c as Y,o as O,b as i,e as n,n as Te,p as se,F as ve,q as _e,i as Pe,j as ae,g as I,s as te,t as Se,v as ze,x as W,y as Re,z as lt,A as nt,B as ot,C as de,D as st,E as rt,G as we,H as it,I as ut,J as ct,K as dt,L as Ne,M as Me,N as vt,O as Be,P as mt,Q as $,V as pe,R as ft,S as pt,T as yt,U as gt,W as ht,X as kt,Y as St,u as bt,Z as Ct,_ as Vt,$ as wt,a0 as he,a1 as Tt,a2 as _t}from"./index-mJOBftNs.js";import{P as xt,V as At}from"./VEmptyState-HCMhgjo4.js";import{V as xe,c as qe,a as Ue,b as $e}from"./VCard-DFIDGoOa.js";import{V as ke,a as le}from"./VRow-C6N6h8s9.js";import{V as be,u as Pt,m as Rt}from"./VTextField-tFIcna6m.js";import{a as Ke,b as Je,u as Dt,c as Ft,m as It,d as Ot}from"./VSelect-CO5xudFf.js";import{_ as He}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as Et}from"./VForm-BTvn18MX.js";import{V as Lt}from"./VAlert-CfJUBCCM.js";import{u as zt,m as Nt,h as Mt}from"./filter-JDbFQhCL.js";import{V as Bt}from"./VSwitch-0eeupGzC.js";const Ut=e=>{const C=N(!1),u=N(!1),E=N(!1),V=N(),s=N(!1),f=N(null),G=N(!1),z=N(!1),M=at(e)?e:N(e),p=_(()=>xt[M.value]),j=Le({}),x=Le({}),d=N(null),r=l=>typeof l=="string"?l.trim():l&&typeof l=="object"&&typeof l.value=="string"?String(l.value).trim():"",B=l=>{Object.keys(l).forEach(c=>{delete l[c]})},D=()=>{p.value&&(B(x),p.value.fields.forEach(l=>{l.type==="switch"?x[l.key]=!1:l.multiple?x[l.key]=[]:x[l.key]=""}))},w=()=>{B(j)},g=l=>Array.isArray(l)?l.map(c=>String(c)):typeof l=="string"?l.split(",").map(c=>c.trim()).filter(c=>c.length>0):[],ne=()=>{d.value=JSON.parse(JSON.stringify(x))},Q=()=>{d.value&&Object.assign(x,JSON.parse(JSON.stringify(d.value)))},K=l=>{if(!Array.isArray(l))return[];const c=new Map,y=[],Z=[];l.forEach((m,T)=>{if(!m||typeof m!="object")return;const U=m.code??m.value??m.id??m.key??m.name??"",oe=String(U??"").trim(),me=String(m.name??m.label??m.title??m.value??m.key??oe).trim();if(!me)return;const fe=m.parentCode??m.parentId??m.parent,re=fe==null?"":String(fe).trim(),ye=oe||me||`node-${T}`,ce={id:re?`${re}::${ye}::${T}`:`root::${ye}::${T}`,label:me};oe&&(ce.value=oe,!re&&!c.has(oe)&&c.set(oe,ce)),re?y.push({parentCode:re,option:ce}):Z.push(ce)}),y.forEach(({parentCode:m,option:T})=>{const U=c.get(m);U?(U.children=U.children??[],U.children.push(T),U.value&&delete U.value,U.props={...U.props??{},selectable:!1}):(console.warn("[PlatformState] 未找到父行业节点",{parentCode:m,option:T}),Z.push(T))});const J=m=>{m.forEach(T=>{T.children&&T.children.length>0&&(T.value&&delete T.value,T.props={...T.props??{},selectable:!1},J(T.children))})};return J(Z),Z};return{loadingDicts:C,loadingConfig:u,saving:E,formRef:V,quickDeliveryLoading:s,taskStatus:f,terminatingTask:G,clearingTask:z,meta:p,dictOptions:j,form:x,initialSnapshot:d,initializeForm:D,resetDictOptions:w,toArray:g,snapshotForm:ne,resetForm:Q,flattenOptions:l=>{if(Array.isArray(l)&&l.some(J=>J&&typeof J=="object"&&"parentCode"in J))return K(l);const c=[],y=new Set,Z=J=>{Array.isArray(J)&&J.forEach(m=>{if(m&&typeof m=="object"){const T=String(m.code??m.value??m.id??m.key??m.name??"").trim(),U=String(m.name??m.label??m.title??m.value??T).trim();T.length>0&&!y.has(T)&&(y.add(T),c.push({id:`${T}`,value:T,label:U})),Array.isArray(m.children)&&Z(m.children),Array.isArray(m.items)&&Z(m.items)}})};return Z(l),c},applyConfig:l=>{p.value&&p.value.fields.forEach(c=>{const y=l[c.key];c.type==="switch"?x[c.key]=!!y:c.multiple?x[c.key]=g(y):typeof y>"u"||y===null?x[c.key]="":x[c.key]=String(y)})},getFieldOptions:l=>l.type!=="select"?[]:j[l.key]??[],getFieldRules:l=>{if(l.required)return[c=>l.type==="switch"?!0:l.multiple?Array.isArray(c)&&c.length>0||"该项为必填":c&&String(c).trim().length>0||"该项为必填"]},buildPayload:()=>{if(!p.value)return{};const l={};return p.value.fields.forEach(c=>{const y=x[c.key];c.type==="switch"?l[c.key]=!!y:c.multiple?l[c.key]=(y??[]).join(","):l[c.key]=typeof y=="string"?y.trim():y??""}),l},handleAutocompleteUpdate:(l,c)=>{if(l.multiple){const Z=(Array.isArray(c)?c:c!=null?[c]:[]).map(m=>r(m)).filter(m=>m.length>0),J=Array.from(new Set(Z));x[l.key]=J}else{const y=r(c);x[l.key]=y}}}},Qe={boss:"/api/config/boss",zhilian:"/api/config/zhilian",job51:"/api/config/job51",liepin:"/api/config/liepin"},$t={boss:"/dicts/BOSS_ZHIPIN",zhilian:"/dicts/ZHILIAN_ZHAOPIN",job51:"/dicts/JOB_51",liepin:"/dicts/LIEPIN"};async function jt(e){return Ce(Qe[e])}async function qt(e,C){return Ae(Qe[e],{method:"POST",body:JSON.stringify(C)})}async function Kt(e){return Ce($t[e])}async function Jt(e){return Ce(`/api/task/quick-delivery/submit/${e}`,{method:"POST"})}async function Ht(e){return Ce(`/api/task-execution/status/${e}`)}async function Qt(e){return Ae(`/api/task-execution/terminate/${e}`,{method:"POST"})}async function Zt(e){return Ae(`/api/task-execution/status/${e}`,{method:"DELETE"})}const Wt=(e,C,u)=>{const E=()=>P(u),V=async()=>{if(!e.meta.value){e.loadingDicts.value=!1;return}e.loadingDicts.value=!0;try{e.resetDictOptions();const r=await Kt(E());if(!r||!r.groups){console.warn("字典响应格式异常",r);return}const B=Object.fromEntries((r.groups??[]).map(D=>[D.key,D.items??[]]));e.meta.value.fields.filter(D=>D.dictKey).forEach(D=>{const w=e.flattenOptions(B[D.dictKey]||[]);e.dictOptions[D.key]=w})}catch(r){console.error("加载字典失败",r),C.show({message:"加载字典数据失败",color:"error"}),e.loadingDicts.value=!1}finally{e.loadingDicts.value=!1}},s=async()=>{if(!e.meta.value){e.loadingConfig.value=!1;return}e.loadingConfig.value=!0;try{const r=await jt(E());r&&typeof r=="object"?e.applyConfig(r):console.info("未找到平台配置，使用默认值"),e.snapshotForm()}catch(r){console.error("加载配置失败",r),C.show({message:"加载平台配置失败",color:"error"}),e.loadingConfig.value=!1}finally{e.loadingConfig.value=!1}},f=async()=>{var B,D;const r=await((D=(B=e.formRef.value)==null?void 0:B.validate)==null?void 0:D.call(B));return(r==null?void 0:r.valid)??!0},G=async()=>{if(e.meta.value){if(!await f()){C.show({message:"请先修正表单校验错误",color:"warning"});return}e.saving.value=!0;try{const r=e.buildPayload();await qt(E(),r),e.snapshotForm(),C.show({message:`${e.meta.value.displayName} 配置已保存`,color:"success"})}catch(r){console.error("保存配置失败",r),C.show({message:"保存失败，请稍后再试",color:"error"})}finally{e.saving.value=!1}}},z=async()=>{if(e.meta.value){if(!await f()){C.show({message:"请先修正表单校验错误",color:"warning"});return}e.quickDeliveryLoading.value=!0;try{await Jt(E()),C.show({message:`${e.meta.value.displayName} 一键投递任务已提交`,color:"success"}),setTimeout(()=>{M()},1e3)}catch(r){console.error("提交一键投递任务失败",r),C.show({message:"一键投递失败，请稍后再试",color:"error"})}finally{e.quickDeliveryLoading.value=!1}}},M=async()=>{try{console.log("[PlatformService] 开始加载任务状态，平台:",E());const r=await Ht(E());console.log("[PlatformService] 任务状态响应:",r),r.success&&r.data?(e.taskStatus.value=r.data,console.log("[PlatformService] 任务状态已更新:",e.taskStatus.value)):(e.taskStatus.value=null,console.log("[PlatformService] 无任务状态"))}catch(r){console.error("[PlatformService] 加载任务状态失败",r),e.taskStatus.value=null}};return{loadDicts:V,loadConfig:s,handleSave:G,handleQuickDelivery:z,loadTaskStatus:M,refreshTaskStatus:async()=>{await M()},handleTerminateTask:async()=>{if(e.meta.value){e.terminatingTask.value=!0;try{const r=await Qt(E());r.success?(C.show({message:r.message||"终止请求已发送",color:"success"}),setTimeout(()=>{M()},500)):C.show({message:r.message||"终止失败",color:"warning"})}catch(r){console.error("终止任务失败",r),C.show({message:"终止任务失败，请稍后再试",color:"error"})}finally{e.terminatingTask.value=!1}}},handleClearTask:async()=>{if(e.meta.value){e.clearingTask.value=!0;try{const r=await Zt(E());r.success?(C.show({message:r.message||"任务状态已清除",color:"success"}),e.taskStatus.value=null):C.show({message:r.message||"清除失败",color:"warning"})}catch(r){console.error("清除任务状态失败",r),C.show({message:"清除任务状态失败，请稍后再试",color:"error"})}finally{e.clearingTask.value=!1}}},resetForm:()=>{e.resetForm(),C.show({message:"已恢复至上次加载的配置",color:"info"})}}},Gt={key:0,class:"cascader-select-right__list"},Xt={key:1,class:"cascader-select-right__placeholder text-body-2 text-medium-emphasis"},Yt=je({__name:"CascaderSelect",props:{modelValue:{type:[Array,String],default:()=>[]},items:{type:Array,default:()=>[]},label:{type:String,default:""},hint:{type:String,default:""},icon:{type:String,default:""},multiple:{type:Boolean,default:!1},rules:{type:Array,default:()=>[]},clearable:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(e,{emit:C}){const u=e,E=C,V=N(!1),s=N(null),f=N(new Set),G=t=>Array.isArray(t)?new Set(t.filter(o=>typeof o=="string"&&o.length>0)):typeof t=="string"&&t.length>0?new Set([t]):new Set;ue(()=>u.modelValue,t=>{f.value=G(t)},{immediate:!0,deep:!0});const z=_(()=>u.items??[]);ue([V,z],()=>{V.value&&(s.value&&z.value.some(t=>{var o;return t.id===((o=s.value)==null?void 0:o.id)})||(s.value=z.value[0]??null))},{immediate:!1});const M=t=>{const o=[],h=X=>{X.forEach(l=>{Array.isArray(l.children)&&l.children.length>0?h(l.children):l.value&&o.push(l)})};return h(t),o},p=_(()=>{const t=new Map;return z.value.forEach(o=>{t.set(o.id,M([o]))}),t}),j=_(()=>{const t=new Map;return p.value.forEach(o=>{o.forEach(h=>{h.value&&t.set(h.value,h)})}),t}),x=_(()=>s.value?p.value.get(s.value.id)??[]:[]),d=_(()=>f.value.size>0),r=_(()=>f.value.size===0?"":Array.from(f.value).map(o=>{var h;return((h=j.value.get(o))==null?void 0:h.label)??o}).sort().join("、")),B=_(()=>{const t=Array.from(f.value);return u.multiple?t:t[0]??""}),D=_(()=>{if(!(!u.rules||u.rules.length===0))return u.rules.map(t=>()=>t(B.value))}),w=t=>{s.value=t},g=t=>t.value?f.value.has(t.value):!1,ne=t=>{if(!t.value)return;const o=new Set(f.value);u.multiple?o.has(t.value)?o.delete(t.value):o.add(t.value):(o.clear(),o.add(t.value),V.value=!1),Q(o)},Q=t=>{f.value=t,E("update:modelValue",B.value)},K=()=>{f.value.size!==0&&Q(new Set)},q=t=>{var o;return((o=p.value.get(t.id))==null?void 0:o.length)??0},v=t=>(p.value.get(t.id)??[]).filter(h=>h.value&&f.value.has(h.value)).length;return(t,o)=>(O(),Y(Ke,{modelValue:V.value,"onUpdate:modelValue":o[1]||(o[1]=h=>V.value=h),"close-on-content-click":!1,transition:"fade-transition","max-width":"520","offset-y":""},{activator:i(({props:h})=>[n(be,te(h,{label:e.label,hint:e.hint,"persistent-hint":!!e.hint,"prepend-inner-icon":e.icon,readonly:!0,clearable:e.clearable,"model-value":r.value,rules:D.value,"onClick:clear":K}),null,16,["label","hint","persistent-hint","prepend-inner-icon","clearable","model-value","rules"])]),default:i(()=>[n(xe,{class:"cascader-select-card",elevation:"3"},{default:i(()=>[n(ke,{class:"ma-0","no-gutters":""},{default:i(()=>[n(le,{cols:"5",class:"cascader-select-left"},{default:i(()=>[n(Te,{nav:"",density:"compact"},{default:i(()=>[(O(!0),se(ve,null,_e(z.value,h=>{var X;return O(),Y(Se,{key:h.id,active:((X=s.value)==null?void 0:X.id)===h.id,onClick:l=>w(h)},{append:i(()=>[n(Re,{size:"x-small",color:"grey-darken-1",variant:"tonal"},{default:i(()=>[I(W(v(h))+"/"+W(q(h)),1)]),_:2},1024)]),default:i(()=>[n(ze,{class:"text-body-2"},{default:i(()=>[I(W(h.label),1)]),_:2},1024)]),_:2},1032,["active","onClick"])}),128))]),_:1})]),_:1}),n(le,{cols:"7",class:"cascader-select-right"},{default:i(()=>[x.value.length>0?(O(),se("div",Gt,[n(Te,{density:"comfortable"},{default:i(()=>[(O(!0),se(ve,null,_e(x.value,h=>(O(),Y(Se,{key:h.id,value:h.value,onClick:X=>ne(h)},{prepend:i(()=>[n(Je,{"model-value":g(h),"onUpdate:modelValue":X=>ne(h)},null,8,["model-value","onUpdate:modelValue"])]),default:i(()=>[n(ze,{class:"text-body-2"},{default:i(()=>[I(W(h.label),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})])):(O(),se("div",Xt," ← 请先选择左侧分类 "))]),_:1})]),_:1}),n(Pe),n(qe,{class:"justify-space-between"},{default:i(()=>[n(ae,{variant:"text",color:"secondary",onClick:K,disabled:!d.value},{default:i(()=>[...o[2]||(o[2]=[I(" 清空 ",-1)])]),_:1},8,["disabled"]),n(ae,{variant:"text",color:"primary",onClick:o[0]||(o[0]=h=>V.value=!1)},{default:i(()=>[...o[3]||(o[3]=[I("完成",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),ea=He(Yt,[["__scopeId","data-v-388c6e3f"]]),ta=nt({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Nt({filterKeys:["title"]}),...It(),...dt(Rt({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"])},"VAutocomplete"),aa=lt()({name:"VAutocomplete",props:ta(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,C){let{slots:u}=C;const{t:E}=ot(),V=N(),s=de(!1),f=de(!0),G=de(!1),z=N(),M=N(),p=de(-1),j=de(null),{items:x,transformIn:d,transformOut:r}=st(e),{textColorClasses:B,textColorStyles:D}=rt(()=>{var a;return(a=V.value)==null?void 0:a.color}),w=we(e,"search",""),g=we(e,"modelValue",[],a=>d(a===null?[null]:it(a)),a=>{const k=r(a);return e.multiple?k:k[0]??null}),ne=_(()=>typeof e.counterValue=="function"?e.counterValue(g.value):typeof e.counterValue=="number"?e.counterValue:g.value.length),Q=Pt(e),{filteredItems:K,getMatches:q}=zt(e,x,()=>j.value??(f.value?"":w.value)),v=_(()=>e.hideSelected&&j.value===null?K.value.filter(a=>!g.value.some(k=>k.value===a.value)):K.value),t=_(()=>!!(e.chips||u.chip)),o=_(()=>t.value||!!u.selection),h=_(()=>g.value.map(a=>a.props.value)),X=_(()=>{var k;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&w.value===((k=v.value[0])==null?void 0:k.title))&&v.value.length>0&&!f.value&&!G.value}),l=_(()=>e.hideNoData&&!v.value.length||Q.isReadonly.value||Q.isDisabled.value),c=we(e,"menu"),y=_({get:()=>c.value,set:a=>{var k;c.value&&!a&&((k=z.value)!=null&&k.ΨopenChildren.size)||a&&l.value||(c.value=a)}}),{menuId:Z,ariaExpanded:J,ariaControls:m,ariaLabel:T}=Dt(e,y),U=N(),oe=Ft(U,V);function me(a){e.openOnClear&&(y.value=!0),w.value=""}function fe(){l.value||(y.value=!0)}function re(a){l.value||(s.value&&(a.preventDefault(),a.stopPropagation()),y.value=!y.value)}function ye(a){var k;(Ne(a)||a.key==="Backspace")&&((k=V.value)==null||k.focus())}function De(a){var S,F,H,ee,b;if(Q.isReadonly.value)return;const k=(S=V.value)==null?void 0:S.selectionStart,A=g.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(a.key)&&a.preventDefault(),["Enter","ArrowDown"].includes(a.key)&&(y.value=!0),["Escape"].includes(a.key)&&(y.value=!1),X.value&&["Enter","Tab"].includes(a.key)&&!g.value.some(R=>{let{value:L}=R;return L===v.value[0].value})&&ie(v.value[0]),a.key==="ArrowDown"&&X.value&&((F=U.value)==null||F.focus("next")),["Backspace","Delete"].includes(a.key)){if(!e.multiple&&o.value&&g.value.length>0&&!w.value)return ie(g.value[0],!1);if(~p.value){a.preventDefault();const R=p.value;ie(g.value[p.value],!1),p.value=R>=A-1?A-2:R}else a.key==="Backspace"&&!w.value&&(p.value=A-1);return}if(e.multiple)if(a.key==="ArrowLeft"){if(p.value<0&&k&&k>0)return;const R=p.value>-1?p.value-1:A-1;if(g.value[R])p.value=R;else{const L=((H=w.value)==null?void 0:H.length)??null;p.value=-1,(ee=V.value)==null||ee.setSelectionRange(L,L)}}else if(a.key==="ArrowRight"){if(p.value<0)return;const R=p.value+1;g.value[R]?p.value=R:(p.value=-1,(b=V.value)==null||b.setSelectionRange(0,0))}else~p.value&&Ne(a)&&(p.value=-1)}function ce(a){if(Me(V.value,":autofill")||Me(V.value,":-webkit-autofill")){const k=x.value.find(A=>A.title===a.target.value);k&&ie(k)}}function Ze(){var a;e.eager&&((a=M.value)==null||a.calculateVisibleItems())}function We(){var a;s.value&&(f.value=!0,(a=V.value)==null||a.focus()),j.value=null}function Ge(a){s.value=!0,setTimeout(()=>{G.value=!0})}function Xe(a){G.value=!1}function Ye(a){(a==null||a===""&&!e.multiple&&!o.value)&&(g.value=[])}const Ve=de(!1);function ie(a){let k=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!a||a.props.disabled))if(e.multiple){const A=g.value.findIndex(F=>(e.valueComparator||vt)(F.value,a.value)),S=k??!~A;if(~A){const F=S?[...g.value,a]:[...g.value];F.splice(A,1),g.value=F}else S&&(g.value=[...g.value,a]);e.clearOnSelect&&(w.value="")}else{const A=k!==!1;g.value=A?[a]:[],j.value=f.value?"":w.value??"",w.value=A&&!o.value?a.title:"",Be(()=>{y.value=!1,f.value=!0})}}return ue(s,(a,k)=>{var A;a!==k&&(a?(Ve.value=!0,w.value=e.multiple||o.value?"":String(((A=g.value.at(-1))==null?void 0:A.props.title)??""),f.value=!0,Be(()=>Ve.value=!1)):(!e.multiple&&w.value==null&&(g.value=[]),y.value=!1,!f.value&&w.value&&(j.value=w.value),w.value="",p.value=-1))}),ue(w,a=>{!s.value||Ve.value||(a&&(y.value=!0),f.value=!a)}),ue(y,a=>{if(!e.hideSelected&&a&&g.value.length&&f.value){const k=v.value.findIndex(A=>g.value.some(S=>A.value===S.value));mt&&window.requestAnimationFrame(()=>{var A;k>=0&&((A=M.value)==null||A.scrollToIndex(k))})}a&&(j.value=null)}),ue(x,(a,k)=>{y.value||s.value&&!k.length&&a.length&&(y.value=!0)}),ut(()=>{const a=!!(!e.hideNoData||v.value.length||u["prepend-item"]||u["append-item"]||u["no-data"]),k=g.value.length>0,A=be.filterProps(e);return n(be,te({ref:V},A,{modelValue:w.value,"onUpdate:modelValue":[S=>w.value=S,Ye],focused:s.value,"onUpdate:focused":S=>s.value=S,validationValue:g.externalValue,counterValue:ne.value,dirty:k,onChange:ce,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":y.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!o.value,"v-autocomplete--selecting-index":p.value>-1},e.class],style:e.style,readonly:Q.isReadonly.value,placeholder:k?void 0:e.placeholder,"onClick:clear":me,"onMousedown:control":fe,onKeydown:De,"aria-expanded":J.value,"aria-controls":m.value}),{...u,default:()=>$(ve,null,[n(Ke,te({id:Z.value,ref:z,modelValue:y.value,"onUpdate:modelValue":S=>y.value=S,activator:"parent",contentClass:"v-autocomplete__content",disabled:l.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:Ze,onAfterLeave:We},e.menuProps),{default:()=>[a&&n(Te,te({ref:U,filterable:!0,selected:h.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:S=>S.preventDefault(),onKeydown:ye,onFocusin:Ge,onFocusout:Xe,tabindex:"-1",selectable:!0,"aria-live":"polite",color:e.itemColor??e.color},oe,e.listProps),{default:()=>{var S,F,H;return[(S=u["prepend-item"])==null?void 0:S.call(u),!v.value.length&&!e.hideNoData&&(((F=u["no-data"])==null?void 0:F.call(u))??n(Se,{key:"no-data",title:E(e.noDataText)},null)),n(Ot,{ref:M,renderless:!0,items:v.value,itemKey:"value"},{default:ee=>{var Ie,Oe,Ee;let{item:b,index:R,itemRef:L}=ee;const Fe=te(b.props,{ref:L,key:b.value,active:X.value&&R===0?!0:void 0,onClick:()=>ie(b,null)});return b.type==="divider"?((Ie=u.divider)==null?void 0:Ie.call(u,{props:b.raw,index:R}))??n(Pe,te(b.props,{key:`divider-${R}`}),null):b.type==="subheader"?((Oe=u.subheader)==null?void 0:Oe.call(u,{props:b.raw,index:R}))??n(pt,te(b.props,{key:`subheader-${R}`}),null):((Ee=u.item)==null?void 0:Ee.call(u,{item:b,index:R,props:Fe}))??n(Se,te(Fe,{role:"option"}),{prepend:ge=>{let{isSelected:et}=ge;return $(ve,null,[e.multiple&&!e.hideSelected?n(Je,{key:b.value,modelValue:et,ripple:!1,tabindex:"-1",onClick:tt=>tt.preventDefault()},null):void 0,b.props.prependAvatar&&n(yt,{image:b.props.prependAvatar},null),b.props.prependIcon&&n(pe,{icon:b.props.prependIcon},null)])},title:()=>{var ge;return f.value?b.title:Mt("v-autocomplete",b.title,(ge=q(b))==null?void 0:ge.title)}})}}),(H=u["append-item"])==null?void 0:H.call(u)]}})]}),g.value.map((S,F)=>{function H(L){L.stopPropagation(),L.preventDefault(),ie(S,!1)}const ee={"onClick:close":H,onKeydown(L){L.key!=="Enter"&&L.key!==" "||(L.preventDefault(),L.stopPropagation(),H(L))},onMousedown(L){L.preventDefault(),L.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},b=t.value?!!u.chip:!!u.selection,R=b?gt(t.value?u.chip({item:S,index:F,props:ee}):u.selection({item:S,index:F})):void 0;if(!(b&&!R))return $("div",{key:S.value,class:kt(["v-autocomplete__selection",F===p.value&&["v-autocomplete__selection--selected",B.value]]),style:ht(F===p.value?D.value:{})},[t.value?u.chip?n(St,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:S.title}}},{default:()=>[R]}):n(Re,te({key:"chip",closable:e.closableChips,size:"small",text:S.title,disabled:S.props.disabled},ee),null):R??$("span",{class:"v-autocomplete__selection-text"},[S.title,e.multiple&&F<g.value.length-1&&$("span",{class:"v-autocomplete__selection-comma"},[I(",")])])])})]),"append-inner":function(){var ee,b;for(var S=arguments.length,F=new Array(S),H=0;H<S;H++)F[H]=arguments[H];return $(ve,null,[(ee=u["append-inner"])==null?void 0:ee.call(u,...F),e.menuIcon?n(pe,{class:"v-autocomplete__menu-icon",color:(b=V.value)==null?void 0:b.fieldIconColor,icon:e.menuIcon,onMousedown:re,onClick:ft,"aria-label":T.value,title:T.value,tabindex:"-1"},null):void 0])}})}),ct({isFocused:s,isPristine:f,menu:y,search:w,filteredItems:K,select:ie},V)}}),la={key:0},na={key:1},oa={style:{"font-size":"10px","max-height":"200px",overflow:"auto"}},sa={class:"task-status-container"},ra={class:"d-flex align-center justify-space-between mb-3"},ia={class:"d-flex align-center"},ua={class:"text-subtitle-2 font-weight-medium"},ca={class:"task-info mb-3"},da={class:"text-caption text-medium-emphasis mb-1"},va={class:"text-caption text-medium-emphasis mt-1"},ma={key:0,class:"text-caption text-medium-emphasis"},fa={class:"d-flex gap-2"},pa=je({__name:"PlatformConfigView",props:{platform:{}},setup(e){const C=e,u=_t(),E=bt(),V=Ct(C,"platform"),s=Ut(V),f=Wt(s,E,V),G=s.formRef,z=_(()=>s.meta.value),M=_(()=>s.loadingDicts.value),p=_(()=>s.loadingConfig.value),j=_(()=>s.saving.value),x=_(()=>s.quickDeliveryLoading.value),d=_(()=>s.taskStatus.value),r=_(()=>s.terminatingTask.value),B=_(()=>s.clearingTask.value),D=()=>d.value?d.value.isTerminated?"success":d.value.terminateRequested?"warning":"primary":"grey",w=()=>d.value?d.value.isTerminated?"mdi-check-circle":d.value.terminateRequested?"mdi-pause-circle":"mdi-play-circle":"mdi-help-circle",g=()=>d.value?d.value.isTerminated?"任务已完成":d.value.terminateRequested?"正在终止任务":"任务执行中":"无任务",ne=()=>d.value?d.value.isTerminated?100:d.value.stepOrder?Math.min(d.value.stepOrder/10*100,95):50:0,Q=q=>{if(!q)return"-";try{return new Date(q).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}catch{return q}};s.meta.value||E.show({message:"未找到对应平台配置",color:"warning"}),ue(()=>C.platform,async(q,v)=>{if(!(q===v&&v!==void 0)){if(!s.meta.value){u.replace("/common");return}try{s.initializeForm(),await f.loadDicts(),await f.loadConfig(),await f.loadTaskStatus(),console.log("[PlatformConfigView] 任务状态已加载:",s.taskStatus.value)}catch(t){console.error("初始化平台配置失败",t),E.show({message:"初始化平台配置失败",color:"error"})}}},{immediate:!0});let K=null;return Vt(()=>{console.log("[PlatformConfigView] onMounted - 加载任务状态"),f.loadTaskStatus(),K=window.setInterval(()=>{var q,v;(q=d.value)!=null&&q.hasTask&&!((v=d.value)!=null&&v.isTerminated)&&f.refreshTaskStatus()},5e3)}),wt(()=>{K&&(clearInterval(K),K=null)}),(q,v)=>z.value?(O(),se("div",na,[n(ke,{dense:""},{default:i(()=>[n(le,{cols:"12",lg:"7"},{default:i(()=>[n(xe,{class:"section-card",loading:M.value||p.value,elevation:"2"},{default:i(()=>[n(Ue,{class:"section-title d-flex align-center"},{default:i(()=>[n(pe,{class:"mr-2",color:"primary"},{default:i(()=>[...v[0]||(v[0]=[I("mdi-tune-variant",-1)])]),_:1}),I(" "+W(z.value.displayName)+" 条件配置 ",1)]),_:1}),n($e,null,{default:i(()=>[n(Et,{ref_key:"formRef",ref:G},{default:i(()=>[n(ke,{dense:""},{default:i(()=>[(O(!0),se(ve,null,_e(z.value.fields,t=>(O(),Y(le,{key:t.key,cols:12,md:t.type==="text"?12:6},{default:i(()=>[t.type==="text"?(O(),Y(be,{key:0,modelValue:P(s).form[t.key],"onUpdate:modelValue":o=>P(s).form[t.key]=o,label:t.label,hint:t.hint,"persistent-hint":!!t.hint,"prepend-inner-icon":t.icon,rules:P(s).getFieldRules(t),clearable:""},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint","prepend-inner-icon","rules"])):t.type==="select"&&t.cascade?(O(),Y(ea,{key:1,modelValue:P(s).form[t.key],"onUpdate:modelValue":o=>P(s).form[t.key]=o,items:P(s).getFieldOptions(t),label:t.label,hint:t.hint,icon:t.icon,rules:P(s).getFieldRules(t),multiple:t.multiple},null,8,["modelValue","onUpdate:modelValue","items","label","hint","icon","rules","multiple"])):t.type==="select"?(O(),Y(aa,{key:2,modelValue:P(s).form[t.key],"onUpdate:modelValue":[o=>P(s).form[t.key]=o,o=>P(s).handleAutocompleteUpdate(t,o)],items:P(s).getFieldOptions(t),"item-title":"label","item-value":"value","item-children":"children",label:t.label,hint:t.hint,"persistent-hint":!!t.hint,"prepend-inner-icon":t.icon,rules:P(s).getFieldRules(t),"item-props":"props",multiple:t.multiple,chips:t.multiple,"closable-chips":t.multiple,"hide-selected":t.multiple,"max-values":t.maxSelection,clearable:""},null,8,["modelValue","onUpdate:modelValue","items","label","hint","persistent-hint","prepend-inner-icon","rules","multiple","chips","closable-chips","hide-selected","max-values"])):(O(),Y(Bt,{key:3,modelValue:P(s).form[t.key],"onUpdate:modelValue":o=>P(s).form[t.key]=o,label:t.label,hint:t.hint,"persistent-hint":!!t.hint},null,8,["modelValue","onUpdate:modelValue","label","hint","persistent-hint"]))]),_:2},1032,["md"]))),128))]),_:1})]),_:1},512)]),_:1}),n(qe,{class:"justify-end"},{default:i(()=>[n(ae,{variant:"tonal",color:"secondary",onClick:P(f).resetForm,disabled:p.value||M.value},{default:i(()=>[...v[1]||(v[1]=[I(" 重置 ",-1)])]),_:1},8,["onClick","disabled"]),n(ae,{color:"primary",onClick:P(f).handleSave,loading:j.value,disabled:p.value||M.value},{default:i(()=>[...v[2]||(v[2]=[I(" 保存配置 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["loading"])]),_:1}),n(le,{cols:"12",lg:"5"},{default:i(()=>[n(xe,{class:"section-card",elevation:"2"},{default:i(()=>[n(Ue,{class:"section-title d-flex align-center"},{default:i(()=>[n(pe,{class:"mr-2",color:"primary"},{default:i(()=>[...v[3]||(v[3]=[I("mdi-robot",-1)])]),_:1}),v[4]||(v[4]=I(" 任务流程 ",-1))]),_:1}),n($e,null,{default:i(()=>[n(ke,{dense:""},{default:i(()=>[n(le,{cols:"12"},{default:i(()=>{var t,o;return[n(ae,{block:"",color:"primary","prepend-icon":"mdi-send-check",loading:x.value,disabled:((t=d.value)==null?void 0:t.hasTask)&&!((o=d.value)!=null&&o.isTerminated),onClick:P(f).handleQuickDelivery},{default:i(()=>[...v[5]||(v[5]=[I(" 一键投递 ",-1)])]),_:1},8,["loading","disabled","onClick"])]}),_:1}),n(le,{cols:"12"},{default:i(()=>[n(ae,{block:"",size:"small",color:"secondary",variant:"tonal","prepend-icon":"mdi-reload",onClick:P(f).loadTaskStatus},{default:i(()=>[...v[6]||(v[6]=[I(" 手动加载任务状态 ",-1)])]),_:1},8,["onClick"])]),_:1}),n(le,{cols:"12"},{default:i(()=>[n(Lt,{type:"info",density:"compact"},{default:i(()=>[v[7]||(v[7]=$("div",{class:"text-caption"},"调试信息：",-1)),$("pre",oa,W(JSON.stringify(d.value,null,2)),1)]),_:1})]),_:1}),d.value&&d.value.hasTask?(O(),Y(le,{key:0,cols:"12"},{default:i(()=>[n(Pe,{class:"my-2"}),$("div",sa,[$("div",ra,[$("div",ia,[n(pe,{color:D(),class:"mr-2",size:"small"},{default:i(()=>[I(W(w()),1)]),_:1},8,["color"]),$("span",ua,W(g()),1)]),n(Re,{color:D(),size:"small",variant:"tonal"},{default:i(()=>[I(W(d.value.isTerminated?"已结束":d.value.terminateRequested?"终止中":"执行中"),1)]),_:1},8,["color"])]),$("div",ca,[$("div",da," 当前步骤："+W(d.value.stepDescription||d.value.currentStep),1),n(Tt,{"model-value":ne(),color:D(),height:"6",rounded:"",striped:"",indeterminate:!d.value.isTerminated&&!d.value.terminateRequested},null,8,["model-value","color","indeterminate"]),$("div",va," 开始时间："+W(Q(d.value.startTime)),1),d.value.lastUpdateTime?(O(),se("div",ma," 更新时间："+W(Q(d.value.lastUpdateTime)),1)):he("",!0)]),$("div",fa,[!d.value.isTerminated&&!d.value.terminateRequested?(O(),Y(ae,{key:0,size:"small",color:"error",variant:"tonal","prepend-icon":"mdi-stop-circle",loading:r.value,onClick:P(f).handleTerminateTask,block:""},{default:i(()=>[...v[8]||(v[8]=[I(" 终止任务 ",-1)])]),_:1},8,["loading","onClick"])):he("",!0),d.value.isTerminated?(O(),Y(ae,{key:1,size:"small",color:"secondary",variant:"tonal","prepend-icon":"mdi-delete-sweep",loading:B.value,onClick:P(f).handleClearTask,block:""},{default:i(()=>[...v[9]||(v[9]=[I(" 清除状态 ",-1)])]),_:1},8,["loading","onClick"])):he("",!0),n(ae,{size:"small",color:"primary",variant:"text","prepend-icon":"mdi-refresh",onClick:P(f).refreshTaskStatus},{default:i(()=>[...v[10]||(v[10]=[I(" 刷新 ",-1)])]),_:1},8,["onClick"])])])]),_:1})):he("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])):(O(),se("div",la,[n(At,{headline:"未找到平台",title:"无法识别的平台代码",text:"请从左侧菜单重新选择一个平台。",icon:"mdi-alert"})]))}}),xa=He(pa,[["__scopeId","data-v-e505ec9a"]]);export{xa as default};
