import{u as Re,c as Ae,m as Ee,a as Me,d as Te,b as Le}from"./VSelect-CO5xudFf.js";import{u as _e,V as Z,m as Ne}from"./VTextField-tFIcna6m.js";import{z as Be,A as Ke,B as Oe,k as K,C as F,D as ze,E as Ue,G as ee,H as $e,m as k,b0 as P,O as R,b1 as He,w as A,N as le,I as je,e as f,s as S,J as qe,K as We,b2 as Ge,L as ae,P as Je,Q as I,V as te,R as Qe,F as H,n as Xe,t as ue,i as Ye,S as Ze,T as el,U as ll,W as al,X as tl,y as ul,Y as nl,g as ol}from"./index-mJOBftNs.js";import{u as il,m as sl,h as rl}from"./filter-JDbFQhCL.js";const cl=Ke({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...sl({filterKeys:["title"]}),...Ee({hideNoData:!0,returnObject:!0}),...We(Ne({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"])},"VCombobox"),hl=Be()({name:"VCombobox",props:cl(),emits:{"update:focused":l=>!0,"update:modelValue":l=>!0,"update:search":l=>!0,"update:menu":l=>!0},setup(l,ne){var G;let{emit:oe,slots:n}=ne;const{t:ie}=Oe(),b=K(),V=F(!1),p=F(!0),O=F(!1),j=K(),E=K(),i=F(-1);let M=!1;const{items:q,transformIn:se,transformOut:re}=ze(l),{textColorClasses:ce,textColorStyles:ve}=Ue(()=>{var e;return(e=b.value)==null?void 0:e.color}),o=ee(l,"modelValue",[],e=>se($e(e)),e=>{const t=re(e);return l.multiple?t:t[0]??null}),T=_e(l),L=k(()=>!!(l.chips||n.chip)),C=k(()=>L.value||!!n.selection),g=F(!l.multiple&&!C.value?((G=o.value[0])==null?void 0:G.title)??"":""),D=F(null),d=k({get:()=>g.value,set:async e=>{var t;if(g.value=e??"",e===null||e===""&&!l.multiple&&!C.value?o.value=[]:!l.multiple&&!C.value&&(o.value=[P(l,e)],R(()=>{var r;return(r=E.value)==null?void 0:r.scrollToIndex(0)})),e&&l.multiple&&((t=l.delimiters)!=null&&t.length)){const r=l.delimiters.map(He).join("|"),a=e.split(new RegExp(`(?:${r})+`));if(a.length>1){for(let s of a)s=s.trim(),s&&(y(P(l,s)),await R());g.value=""}}e||(i.value=-1),p.value=!e}}),de=k(()=>typeof l.counterValue=="function"?l.counterValue(o.value):typeof l.counterValue=="number"?l.counterValue:l.multiple?o.value.length:d.value.length),{filteredItems:_,getMatches:fe}=il(l,q,()=>D.value??(l.alwaysFilter||!p.value?d.value:"")),w=k(()=>l.hideSelected&&D.value===null?_.value.filter(e=>!o.value.some(t=>t.value===e.value)):_.value),N=k(()=>l.hideNoData&&!w.value.length||T.isReadonly.value||T.isDisabled.value),z=ee(l,"menu"),c=k({get:()=>z.value,set:e=>{var t;z.value&&!e&&((t=j.value)!=null&&t.Î¨openChildren.size)||e&&N.value||(z.value=e)}}),{menuId:me,ariaExpanded:he,ariaControls:be,ariaLabel:W}=Re(l,c);A(g,e=>{M?R(()=>M=!1):V.value&&!c.value&&(c.value=!0),oe("update:search",e)}),A(o,e=>{var t;!l.multiple&&!C.value&&(g.value=((t=e[0])==null?void 0:t.title)??"")});const ge=k(()=>o.value.map(e=>e.value)),U=k(()=>{var t;return(l.autoSelectFirst===!0||l.autoSelectFirst==="exact"&&d.value===((t=w.value[0])==null?void 0:t.title))&&w.value.length>0&&!p.value&&!O.value}),$=K(),ye=Ae($,b);function xe(e){M=!0,R(()=>M=!1),l.openOnClear&&(c.value=!0)}function Ve(){N.value||(c.value=!0)}function pe(e){N.value||(V.value&&(e.preventDefault(),e.stopPropagation()),c.value=!c.value)}function Ce(e){var t;(ae(e)||e.key==="Backspace")&&((t=b.value)==null||t.focus())}function ke(e){var a,s,v,x;if(Ge(e)||T.isReadonly.value)return;const t=(a=b.value)==null?void 0:a.selectionStart,r=o.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(e.key)&&e.preventDefault(),["Enter","ArrowDown"].includes(e.key)&&(c.value=!0),["Escape"].includes(e.key)&&(c.value=!1),U.value&&["Enter","Tab"].includes(e.key)&&!o.value.some(u=>{let{value:h}=u;return h===w.value[0].value})&&y(_.value[0]),e.key==="ArrowDown"&&U.value&&((s=$.value)==null||s.focus("next")),e.key==="Enter"&&d.value&&(y(P(l,d.value),!0,!0),C.value&&(g.value="")),["Backspace","Delete"].includes(e.key)){if(!l.multiple&&C.value&&o.value.length>0&&!d.value)return y(o.value[0],!1);if(~i.value){e.preventDefault();const u=i.value;y(o.value[i.value],!1),i.value=u>=r-1?r-2:u}else e.key==="Backspace"&&!d.value&&(i.value=r-1);return}if(l.multiple)if(e.key==="ArrowLeft"){if(i.value<0&&t&&t>0)return;const u=i.value>-1?i.value-1:r-1;o.value[u]?i.value=u:(i.value=-1,(v=b.value)==null||v.setSelectionRange(d.value.length,d.value.length))}else if(e.key==="ArrowRight"){if(i.value<0)return;const u=i.value+1;o.value[u]?i.value=u:(i.value=-1,(x=b.value)==null||x.setSelectionRange(0,0))}else~i.value&&ae(e)&&(i.value=-1)}function we(){var e;l.eager&&((e=E.value)==null||e.calculateVisibleItems())}function Se(){var e;V.value&&((e=b.value)==null||e.focus()),p.value=!0,D.value=null}function y(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;if(!(!e||e.props.disabled))if(l.multiple){const a=o.value.findIndex(v=>(l.valueComparator||le)(v.value,e.value)),s=t??!~a;if(~a){const v=s?[...o.value,e]:[...o.value];v.splice(a,1),o.value=v}else s&&(o.value=[...o.value,e]);l.clearOnSelect&&(d.value="")}else{const a=t!==!1;o.value=a?[e]:[],(!p.value||l.alwaysFilter)&&g.value&&(D.value=g.value),g.value=a&&!C.value?e.title:"",R(()=>{c.value=r,p.value=!0})}}function Fe(e){V.value=!0,setTimeout(()=>{O.value=!0})}function Ie(e){O.value=!1}return A(V,(e,t)=>{if(!(e||e===t)&&(i.value=-1,c.value=!1,d.value)){if(l.multiple){y(P(l,d.value));return}if(!C.value)return;o.value.some(r=>{let{title:a}=r;return a===d.value})?g.value="":y(P(l,d.value))}}),A(c,e=>{if(!l.hideSelected&&e&&o.value.length&&p.value){const t=w.value.findIndex(r=>o.value.some(a=>(l.valueComparator||le)(a.value,r.value)));Je&&window.requestAnimationFrame(()=>{var r;t>=0&&((r=E.value)==null||r.scrollToIndex(t))})}e&&(D.value=null)}),A(q,(e,t)=>{c.value||V.value&&!t.length&&e.length&&(c.value=!0)}),je(()=>{const e=!!(!l.hideNoData||w.value.length||n["prepend-item"]||n["append-item"]||n["no-data"]),t=o.value.length>0,r=Z.filterProps(l);return f(Z,S({ref:b},r,{modelValue:d.value,"onUpdate:modelValue":a=>d.value=a,focused:V.value,"onUpdate:focused":a=>V.value=a,validationValue:o.externalValue,counterValue:de.value,dirty:t,class:["v-combobox",{"v-combobox--active-menu":c.value,"v-combobox--chips":!!l.chips,"v-combobox--selection-slot":!!C.value,"v-combobox--selecting-index":i.value>-1,[`v-combobox--${l.multiple?"multiple":"single"}`]:!0},l.class],style:l.style,readonly:T.isReadonly.value,placeholder:t?void 0:l.placeholder,"onClick:clear":xe,"onMousedown:control":Ve,onKeydown:ke,"aria-expanded":he.value,"aria-controls":be.value}),{...n,default:()=>I(H,null,[f(Me,S({id:me.value,ref:j,modelValue:c.value,"onUpdate:modelValue":a=>c.value=a,activator:"parent",contentClass:"v-combobox__content",disabled:N.value,eager:l.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,onAfterEnter:we,onAfterLeave:Se},l.menuProps),{default:()=>[e&&f(Xe,S({ref:$,filterable:!0,selected:ge.value,selectStrategy:l.multiple?"independent":"single-independent",onMousedown:a=>a.preventDefault(),selectable:!0,onKeydown:Ce,onFocusin:Fe,onFocusout:Ie,tabindex:"-1","aria-live":"polite",color:l.itemColor??l.color},ye,l.listProps),{default:()=>{var a,s,v;return[(a=n["prepend-item"])==null?void 0:a.call(n),!w.value.length&&!l.hideNoData&&(((s=n["no-data"])==null?void 0:s.call(n))??f(ue,{key:"no-data",title:ie(l.noDataText)},null)),f(Te,{ref:E,renderless:!0,items:w.value,itemKey:"value"},{default:x=>{var Q,X,Y;let{item:u,index:h,itemRef:m}=x;const J=S(u.props,{ref:m,key:u.value,active:U.value&&h===0?!0:void 0,onClick:()=>y(u,null)});return u.type==="divider"?((Q=n.divider)==null?void 0:Q.call(n,{props:u.raw,index:h}))??f(Ye,S(u.props,{key:`divider-${h}`}),null):u.type==="subheader"?((X=n.subheader)==null?void 0:X.call(n,{props:u.raw,index:h}))??f(Ze,S(u.props,{key:`subheader-${h}`}),null):((Y=n.item)==null?void 0:Y.call(n,{item:u,index:h,props:J}))??f(ue,S(J,{role:"option"}),{prepend:B=>{let{isSelected:De}=B;return I(H,null,[l.multiple&&!l.hideSelected?f(Le,{key:u.value,modelValue:De,ripple:!1,tabindex:"-1",onClick:Pe=>Pe.preventDefault()},null):void 0,u.props.prependAvatar&&f(el,{image:u.props.prependAvatar},null),u.props.prependIcon&&f(te,{icon:u.props.prependIcon},null)])},title:()=>{var B;return p.value?u.title:rl("v-combobox",u.title,(B=fe(u))==null?void 0:B.title)}})}}),(v=n["append-item"])==null?void 0:v.call(n)]}})]}),o.value.map((a,s)=>{function v(m){m.stopPropagation(),m.preventDefault(),y(a,!1)}const x={"onClick:close":v,onKeydown(m){m.key!=="Enter"&&m.key!==" "||(m.preventDefault(),m.stopPropagation(),v(m))},onMousedown(m){m.preventDefault(),m.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},u=L.value?!!n.chip:!!n.selection,h=u?ll(L.value?n.chip({item:a,index:s,props:x}):n.selection({item:a,index:s})):void 0;if(!(u&&!h))return I("div",{key:a.value,class:tl(["v-combobox__selection",s===i.value&&["v-combobox__selection--selected",ce.value]]),style:al(s===i.value?ve.value:{})},[L.value?n.chip?f(nl,{key:"chip-defaults",defaults:{VChip:{closable:l.closableChips,size:"small",text:a.title}}},{default:()=>[h]}):f(ul,S({key:"chip",closable:l.closableChips,size:"small",text:a.title,disabled:a.props.disabled},x),null):h??I("span",{class:"v-combobox__selection-text"},[a.title,l.multiple&&s<o.value.length-1&&I("span",{class:"v-combobox__selection-comma"},[ol(",")])])])})]),"append-inner":function(){var x,u;for(var a=arguments.length,s=new Array(a),v=0;v<a;v++)s[v]=arguments[v];return I(H,null,[(x=n["append-inner"])==null?void 0:x.call(n,...s),(!l.hideNoData||l.items.length)&&l.menuIcon?f(te,{class:"v-combobox__menu-icon",color:(u=b.value)==null?void 0:u.fieldIconColor,icon:l.menuIcon,onMousedown:pe,onClick:Qe,"aria-label":W.value,title:W.value,tabindex:"-1"},null):void 0])}})}),qe({isFocused:V,isPristine:p,menu:c,search:d,selectionIndex:i,filteredItems:_,select:y},b)}});export{hl as V};
