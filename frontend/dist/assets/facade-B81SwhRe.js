import{I as f,$ as p}from"./facade-DLk4o3Z_.js";import{aD as h,a as g,aI as v,cI as x,aQ as _,b as C,n as S,I as u,L as I,u as E,x as B}from"./TeamSpreadsheet-DqPQXi__.js";import{td as T,Y as m,dR as b,dP as d,dc as O,cI as j,dy as y}from"./index--BQDx9CP.js";function F(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e=T(e),e.length===1?h(e[0]):new g(w(e))}function w(e){return function(t){for(var r=[],n=function(i){r.push(h(e[i]).subscribe(v(t,function(o){if(r){for(var s=0;s<r.length;s++)s!==i&&r[s].unsubscribe();r=null}t.next(o)})))},a=0;r&&!t.closed&&a<e.length;a++)n(a)}}var P=(e,t,r,n)=>{for(var a=t,i=e.length-1,o;i>=0;i--)(o=e[i])&&(a=o(a)||a);return a},c=(e,t)=>(r,n)=>t(r,n,e);let l=class extends p{constructor(e,t,r,n){super(),this._commandService=e,this._injector=t,this._lexerTreeBuilder=r,this._configService=n,this._initialize()}_initialize(){}get lexerTreeBuilder(){return this._lexerTreeBuilder}moveFormulaRefOffset(e,t,r,n){return this._lexerTreeBuilder.moveFormulaRefOffset(e,t,r,n)}sequenceNodesBuilder(e){return this._lexerTreeBuilder.sequenceNodesBuilder(e)||[]}executeCalculation(){this._commandService.executeCommand(m.id,{commands:[],forceCalculation:!0},{onlyLocal:!0})}stopCalculation(){this._commandService.executeCommand(b.id,{})}calculationStart(e){return this._commandService.onCommandExecuted(t=>{if(t.id===m.id){const r=t.params;e(r.forceCalculation)}})}calculationEnd(e){return this._commandService.onCommandExecuted(t=>{if(t.id!==d.id)return;const r=t.params;r.functionsExecutedState!==void 0&&e(r.functionsExecutedState)})}whenComputingCompleteAsync(e){const t=this._injector.get(O);return t.computingStatus?Promise.resolve(!0):x(F(t.computingStatus$.pipe(S(r=>r)),_(e??3e4).pipe(C(()=>!1))))}onCalculationEnd(){return new Promise((e,t)=>{const r=setTimeout(()=>{t(new Error("Calculation end timeout"))},3e4),n=this.calculationEnd(()=>{clearTimeout(r),n.dispose(),e()})})}calculationProcessing(e){return this._commandService.onCommandExecuted(t=>{if(t.id!==d.id)return;const r=t.params;r.stageInfo!==void 0&&e(r.stageInfo)})}setMaxIteration(e){this._configService.setConfig(j,e)}};l=P([c(0,u(I)),c(1,u(E)),c(2,u(y)),c(3,B)],l);class q extends f{getFormula(){return this._injector.createInstance(l)}}f.extend(q);export{l as s};
