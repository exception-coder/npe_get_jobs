import{a$ as Vt,b0 as X,b1 as Q,b2 as ye,b3 as yx,b4 as E0,b5 as Ax,b6 as Px,H as kx,b7 as Re,b8 as $x,aP as Hx,b9 as Fx,ba as jt,ai as Vx,aj as jx,U as Bx,J as Yx,T as Wx,bb as Gx}from"./index-Dr6YZKPb.js";import{bc as io,bd as no,be as ro,bf as ao,bg as oo,bh as co,I as lo,b as ho,bi as uo,bj as _o,M as fo,bk as bo,bl as Eo,bm as Io,bn as vo,bo as mo,bp as So,bq as go,br as po,bs as Co,bt as To,i as No,x as Oo,a as Ro,G as Uo,F as Do,bu as wo}from"./index-Dr6YZKPb.js";import{W as Xx,K as ue,g as Kx,S as L,R as Zx,C as Jx,J as nt,m as Pe,a as zx,N as gt,O as qx,T as Qx,I as es,r as J,w as Bt,b as Yt,D as Wt,n as I0,c as B0,P as rt,v as ts,d as xs,e as ss,f as is}from"./index-BJN7B7wt.js";import{l as Mo,o as yo,s as Ao,h as Po,i as ko,E as $o,u as Ho,j as Fo,k as Vo,p as jo,q as Bo,t as Yo,F as Wo,_ as Go,x as Xo,y as Ko,z as Zo,A as Jo,B as zo,G as qo,H as Qo,L as e2,V as t2}from"./index-BJN7B7wt.js";import{j as m,m as w,r as T,R as Gt,i as at,v as ns,q as rs,$ as as,I as v0}from"./facade-DLk4o3Z_.js";import{aT as os,a6 as Y,b_ as cs,V as R,a5 as D,ak as Ge,O as ot,o as ct,G as ls,c4 as hs,w as P,z as ds,C as re,ah as us,W as Ae,a1 as _s,cM as fs,cL as bs,J as B,M as Xt,af as Kt,n as Y0,m as Es,c as m0,b as lt,ci as Is,K as S0,F as y,e as ht,S as vs,d as dt,E as Be,bf as ve,U as pt,q as Zt,I as _,u as H,x as W,v as F,P as ut,L as Z,B as ms,ca as _t,y as Ue,X as Ss,a7 as Jt,ai as W0,an as zt,dY as gs,de as ps}from"./TeamSpreadsheet-DqPQXi__.js";import{t8 as k,lF as Ct,s as fe,E as qt,A as Qt,gD as ex,gj as G0,tg as tx,tf as Cs,Y as Ts,dP as Ns,a9 as xx,aR as w0,bC as Os,gS as Rs,tb as Us,g$ as Xe,gv as sx,qG as Ke,qP as ix,t6 as De,d as ee,d6 as Ds,d7 as ws,eM as Ls,lr as Ms,e4 as ys,z as As,ad as Ps,ac as ks,bn as $s,bo as Hs,hl as me,bQ as Se,gk as Tt,jt as G,n_ as Fs,nZ as Vs,o5 as js,o3 as Bs,o1 as Ys,o0 as Ws,n$ as Gs,nX as Xs,nW as Ks,ob as Zs,M as g0,x as nx,iL as Js,bd as zs,km as qs,aa as Qs,u as rx,rR as ei,v as oe,r_ as ti,aW as ax,r as ft,P as Ne,mN as xi,mJ as si,mE as ii,jV as ox,kA as cx,lQ as ni,lg as ri,le as ai,kF as oi,l as ci,t as li,k1 as hi,k6 as di,k4 as ui,jF as _i,jS as fi,j1 as bi,iY as lx,kc as Ei,lG as Ii,nq as vi,l6 as mi,j4 as Si,jk as gi,jm as pi,N as hx,oT as Ci,mc as Ti,rU as Ni,w as dx,k as ux,a1 as Oi,a2 as Ri,tk as Ui,a0 as Di,a3 as wi,a6 as Li,a5 as Mi,a4 as yi,V as Ai,L as Pi,mM as ki,nJ as $i,J as Hi,c as Fi,B as Vi,H as ji,mQ as Bi,kj as Yi,n as Wi}from"./index--BQDx9CP.js";import{z as Gi,Y as Xi,x as p0,V as _x}from"./index-DpLQClwC.js";import{S as fx,v as Ki,C as Zi}from"./index-DT5UJx9J.js";import{q as bx,e as Ji,d as zi}from"./index-ChzpeWOG.js";import{R as Ex,f as qi}from"./index-Ctp6PiU5.js";import{n as Qi,a as en,P as tn}from"./index-DBDjDJo6.js";import{x as xn}from"./index-CMH43F1L.js";import{I as sn}from"./index-R4J-DW51.js";import{T as nn}from"./index-BSbE54n6.js";import{H as rn}from"./index-BLK1e6H_.js";import{o as an,a as on}from"./index-DNSnhRIr.js";import{d as cn}from"./index-DhqLArvi.js";import{a as ln}from"./index-DTw3uDfQ.js";import{f as hn}from"./index-HOPa4z_M.js";import"./index-CGM0O1y3.js";import"./index-mJOBftNs.js";import"./VRow-C6N6h8s9.js";import"./VCard-DFIDGoOa.js";import"./VSelect-CO5xudFf.js";import"./VTextField-tFIcna6m.js";import"./VTabs-BYSgCciz.js";import"./VAlert-CfJUBCCM.js";import"./VDialog-C4Wnh1zS.js";import"./VFileInput-DBMVcNlc.js";import"./VTextarea-34QBZFhW.js";const a=K;(function(x,t){const e=K,s=x();for(;;)try{if(parseInt(e(906))/1*(-parseInt(e(681))/2)+parseInt(e(822))/3+-parseInt(e(526))/4*(parseInt(e(489))/5)+-parseInt(e(434))/6+parseInt(e(695))/7+parseInt(e(462))/8+parseInt(e(700))/9===t)break;s.push(s.shift())}catch{s.push(s.shift())}})(Ze,896482);var dn=Object[a(830)],un=(x,t,e)=>t in x?dn(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,E=(x,t,e)=>un(x,typeof t!=a(708)?t+"":t,e);function Ze(){const x=["labelPosition","univer-flex univer-items-center","type","RECT","transformSelections","CLOSE_ROOM","RemoveRowCommandId","fillRule","_handleJoinEvent","origin","push","_onRefRangeChange","_scene","getCellPositionByOffset","_updateSubUnitFromURLParams","redoState","_injector","UNIVER_COLLABORATION_CLIENT_WEB_PLUGIN","SYNCED","entries","unit","MUTATION","_registerDependencies","getParam","setTimeout","_dataLoaderService","0 0 17 16","m1Prime","_httpService","setUndoRedoMutationParamsCache","clearInterval","DeleteRangeMoveUpCommandId","InsertColCommandId","_online","_unitStatus","LICENSE_IMPORT_SIZE_EXCEEDED","setAlpha","createSocket","_docSyncEditingCollabCursorService","YUUMI_PROMPT_MAX_TOKENS_EXCEEDED","session.collaboration-timeout","_init","FETCH_MISS","saveOfflineData","_config","LICENSE_EXPORT_SIZE_EXCEEDED","saveTaskMap","EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","restore","_hideTimer","stage","name","none","subunit","session.connection-failed","skeleton","CONNECTOR_DATA_TOO_LARGE","tag","_docStateChangeManagerService","NO_OTHER_CLIENTS_EDITING","permission.title","blue.400","_drawTextRange","YUUMI_AI_RUN_FAILED","createInstance","/universer-api/license/formula/limit/start","disposeWithMe","_startSheetCollabCursor","_themeService","values","M0 0H16V16H0z","_checkAndWaitForCalculationPermission","executionId","onRendered","MoveRangeCommandId","Success","makeDirty","children","application/json","maxFormulaLimit","send","_setFormulaLimitStatus","includes","ENTITLE_UPDOWN_GRADE_NOT_SUPPORT","next","ONLINE","_unitOnClients","_backgroundColor","column","_univerInstanceService","attrs","FromArray","_handleHover","sessionStatus$","_context","show","data","removeParam","_disabled","_textBubble","onPointerEnter$","m2Prime","pluginName","whenReady","MOBILE_VERIFY_CODE_MISMATCH","url(#on-line-icon_clip0_910_349)","_localeService","Failed","override","transformMutationsWithChangeset","CURRENT_STATUS_CANNOT_OPERATE","_beforeCloseService","Error","_collabSessionService","_showGuardMessage","getOwnPropertyDescriptor","storage","collab-client.tooltip.reconnect","mask","min","getUnitId","isEditing","code","APPLY_REJECT","_setupSubUnitSync","_colorAssignService","45740ocuVrM","_onCursorDelete","INVALID_INVITE_CODE","defs","releaseFormulaLimitUrl","_docTransformStateCacheService","INVALID_ARGUMENT","_configService","_refRangeService","getTypeOfUnitAdded$","getUndoRedoMutationParamsCache","_initResize","USER_NOT_FOUND","getViewport","11980647ncRWpl","_collabCursorState$","AWAITING","_draw","clipPath","16560981ifYFQc","now","No unitID or type in URL. Will not load files from remote address.","ENTITLE_REPORT_LIMIT_EXCEED","cursorInfo","http://www.w3.org/2000/svg","PERMISSION_DENIED","_setupBeforeClosingHandler","symbol","getUniverSheetInstance","cursorInfo$","map","body","currentColor","_clearPolling","_lastResponseTimestamp","ENSURE_SNAPSHOT_EXECUTION","endRow","TOO_MANY_REQUESTS","post","getMember","EMAIL_HAS_BEEN_BOUND","eventID","COMPLETION_FINISHED","actions","ENTITLE_CHAT_LIMIT_EXCEED","_maxFormulaLimit","set","_transformHistoryAndStateStack","max","CONFLICT","_getSessionTicket","random","setStateCache","startRow","currentUsage","purple.300","SUBMIT_CHANGESET_TIMEOUT","getVpScrollXYInfoByPosToVp","UPDATE_CURSOR","from","addObject","_createSocketURL","Unknown user","uni.network.url-service","LICENSE_MAX_UNITS_EXCEEDED","YUUMI_SUBSCRIPTION_NOT_FOUND","triggerDblclick","UNDEFINED","history","_revisionService","_color","exhaustSavingTask","OFFLINE","_shapes","NOT_FOUND","focused$","unload","_startCalculationLimit","_send","collaboration-client-ui.config","text","_currentUsage","_checkCalculationAvailable","ENTITLE_INSUFFICIENT_QUOTA","unshift","SNAPSHOT_INVALID_SNAPSHOT","xlink:href","[RemoteUniscriptService]: no focused unit","DeleteRangeMoveLeftCommandId","_anchor","loadOfflineData","_commandService","getUnhiddenWorksheets","getActiveSheet","_range","registerBeforeClose","_initStatusComponent","_name","has","_transformPreviousActiveRange","on-line-icon","_notificationService","InsertRangeMoveDownCommandId","with","fill","color","asObservable","endColumn","ALREADY_EXISTS","_memberService","session.will-retry","complete","MOBILE_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","roomMembers","moveTo","searchParams","_docClipboardService","REDEMPTION_INVALID_CODE","path","getStateCache","_clearOtherTimers","_instanceService","_registerRenderDependencies","UNRECOGNIZED","red.300","INTERNAL_ERROR","stringify","currentSkeleton$","height","_toggleOnline","_docSkeletonManagerService","getRenderById","contains","_getSaveTimeout","REDEMPTION_USER_REDEEM_TIMES_EXCEED","_taskIds","permission.content","_docTransformIMECacheService","collabCursorState$","transformStateCache","Warning","2458422iifuyW","evenodd","REDEMPTION_CODE_HAS_BEEN_CREATED","getFocusedUnit","range","_initStatusListener","_status$","...","defineProperty","_hasFormulaInDirtyRanges","displayName","ENTITLE_NEED_BILLING_ADDRESS","getSheetBySheetId","univer-text-sm univer-leading-8 univer-text-gray-600 dark:!univer-text-gray-200","_urlService","LOGIN_TOKEN_PROCESSING_FAILED","LICENSE_DISTRO_REJECTED","editingUnit","parse","PAYMENT_CHANNEL_NOT_SUPPORT","getAncestorScale","getItem","getUnitStatus$","USER_IS_ANONYMOUS","findNodePositionByCharIndex","collab-text-range-","off-line-icon","delete","START_CALCULATION","toRgbString","string","YUUMI_ASYNCIO_CANCELLED","_saveTaskMap","limitInfo","_docTransformSelectionsService","_entityInit$","onTransformChange$","getMergeData","_toggleOffline","onPointerLeave$","OffLineIcon","InsertRowCommandId","getDocRanges","1em","runId","sheetId","EMAIL_VERIFY_CODE_MISMATCH","collabStatus.notCollab","_drawRectRange","No remote instance service injected. May not syncing edits to the web worker.","saveImage","event$","parseInt","collaboration.closeRoom","_hovered","LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED","YUUMI_URL_COL_OUT_OF_RANGE","white","_anchorDot","functionsExecutedState","_sheetSkeletonManagerService","error","green.600","ERROR_AGAIN","registerRefRange","rgba(255, 255, 255, 0.01)","resize","[CollaborationDataLoaderController]","REDEMPTION_USER_NOT_ELIGIBLE","_messageService","deepClone","TEXT","_updateLocalCursor","memberID","/run/","startColumn","_getFormulaLimitStatus","_refreshCollabCursors","measureText","_imageIoService","transformIMECache","imageSourceType","setItem","_assignedColors","46ZqNAJu","registerRenderModule","_syncEditingCollabCursorService","_removeCollabCursors","_initCommandInterceptor","InsertRangeMoveRightCommandId","undoState","_initEntityListener","status$","USER_NOT_INVITED_CODE","clearTimeout","USERS_LEAVE","_session","APPLY_DUPLICATED","enableLocalCache","_cursors","source","_handleLeaveEvent","drawWith","find","fillStyle","_scheduleClearOtherTimer","getCurrentRevOfUnit","pipe","REDEMPTION_CODE_FULLY_REDEEMED","DATA_SOURCE_TOO_LARGE","INVITE_CODE_HAS_BEEN_UES","INVITE_CODE_REQUIRED","idSuffix","setParam","APPLY_REVISION_CONFILICT","setActiveRange","_scheduleHeartbeat","subscribe","_entities","length","getCellMatrix","_heartbeatTimer","unsubscribe","collaboration.single-unit.warning","getColorFromTheme","_hover","_eventUnsubscribe","LOGIN_FAILED","getCollabEntity$","fillText","result","hide","SOCKET_FAILED","split","bold 13px Source Han Sans CN","dispose","replace","_ensureSubject","_initCommandExecutedListener","getCollabCursors$","top","subscribeEvent","disableLocalCache","collabStatus.fetchMiss","current","_drawAnchor","isActive","getTypeOfUnitDisposed$","/universer-api/license/formula/limit/done","transformMutation","RemoveColCommandId","startsWith","all","_scheduleSaving","YUUMI_UNABLE_LOAD_URL","OnLineIcon","mutations","key","_colorIndex","UNIVER_DOC","_cachedData","unitId","APPLY_PERMISSION_DENIED","_updateCollabCursors","_handleEvent","REDEMPTION_CODE_INACTIVE","syncEditingCollabCursor","_releaseCalculationLimit","_id","ENTITLE_DUP_SUBSCRIPTION","getRangePointData","isArray","onCommandExecuted","params","SNAPSHOT_HAS_BEEN_REMOVED","_collabCursorController","_startDocCollabCursor","_initEvent","jiqing.500","_renderManagerService","location","SOCKET_FAILED_RETRY","4844406HZHvop","collab-rect-range-","get","colorChannel1","bottom","UniverIcon","INVITE_CODE_ALREADY_BOUND","executeCommand","toString","popstate","UNAUTHENTICATED","univer-mr-2 univer-flex univer-text-xl","unitID","dispose$","_transformService","_getScale","forEach","YUUMI_TABLE_NOT_FOUND_IN_UNIT","url(#$1","sessionTicket","replaceState","YUUMI_ALL_TABLES_IS_INVALID","debug","textRanges","ACTIVE_UNIT_EVENT_CHANNEL","add","off-line-icon_clip0_910_343","AWAITING_WITH_PENDING","1080712qURqAB","onLocalMutation","urlChange$","OTHER_CLIENT_EDITING","newValue","defIds","getMemberID","_document","_updateURLWithCurrentState","assignAColorForMemberID","doc.mutation.rich-text-editing","formula.calculation.unable","setConfig","CHANGESET_REVISION_CONFILICT","_collaborationController","addObjects","_logService","0 0 16 16","collaboration-client.offline-data-not-saved","_cursorInfo$","font","JOIN_ROOM_FAILED","_lastPointer","currentTheme$","use","black","ticket","6150hYtdkP","_roomMembers$","WECHAT_HAS_BEEN_BOUND","REDEMPTION_CODE_NOT_STARTED","assign","on-line-icon_clip0_910_349","_getSheetObject","SUCCESS","width","_handleHeartbeatEvent","YUUMI_CONNECTOR_URL_NOT_FOUND","setShapeProps","url(#off-line-icon_clip0_910_343)","collabStatus.synced","selection","onStarting","row","href","size","#FFF","getValue","div","_render","getSheetId","M4.5865 11.6499C3.36983 11.6499 1.6665 11.1024 1.6665 8.9124C1.6665 6.3574 4.2215 5.8099 4.9515 5.8099C5.3165 4.5324 6.0465 2.5249 8.9665 2.5249C11.5215 2.5249 12.6165 3.9849 12.9815 5.2624C12.9815 5.2624 16.2665 5.6274 16.2665 8.7299C16.2665 10.9199 14.8065 11.6499 13.3465 11.6499M6.7767 11.6497L8.9667 13.4747L11.8867 9.82466","_localStorageService","yellow.400","then","_docSkeleton","transformRemoteChangeset","init","UNIVER_SHEET","APPLY_NON_SEQUENTIAL_REVISION","requireSession","getCurrent","_cursorShapes","_labelPosition","5692bNXfOa","getformulaLimitStatusUrl","collabStatus.conflict","ENTITLE_CAN_NOT_BUY_LOWER_OTP","_getMergeRange","_cursor","round","OTHER_CLIENTS_EDITING","roomMembers$","lineTo","NOT_COLLAB","_removeClearOtherTimer","_collaborationUIEventService","_saveCache","ranges","MOBILE_HAS_BEEN_BOUND","_pollingInterval","_selfUnitIDs","substring","_initDependencies","save","_getAnchorBounding","_applyCommand","_onCursorUpdate","onMouseMove","backgroundColor","entityInit$","getConfig","_transformUndoRedoStack"];return Ze=function(){return x},Ze()}function bt({ref:x,...t}){const e=a,{icon:s,id:i,className:n,extend:r,...c}=t,l=("univerjs-icon univerjs-icon-"+i+" "+(n||"")).trim(),h=T.useRef("_"+bn());return Ix(s,""+i,{defIds:s[e(467)],idSuffix:h[e(396)]},{ref:x,className:l,...c},r)}function Ix(x,t,e,s,i){const n=a;return T.createElement(x[n(612)],{key:t,..._n(x,e,i),...s},(fn(x,e)[n(632)]||[])[n(711)]((r,c)=>Ix(r,t+"-"+x[n(612)]+"-"+c,e,void 0,i)))}function _n(x,t,e){const s=a,i={...x[s(645)]};e!=null&&e.colorChannel1&&i[s(785)]===s(437)&&(i[s(785)]=e[s(437)]),x[s(612)]===s(673)&&i.id&&(i.id=i.id+t.idSuffix),Object[s(574)](i)[s(450)](([r,c])=>{const l=s;r==="mask"&&typeof c==l(852)&&(i[r]=c[l(388)](/url\(#(.*)\)/,l(452)+t.idSuffix+")"))});const{defIds:n}=t;return!n||n[s(371)]===0||(x[s(612)]===s(486)&&i[s(767)]&&(i["xlink:href"]=i[s(767)]+t[s(364)]),Object[s(574)](i)[s(450)](([r,c])=>{const l=s;typeof c==l(852)&&(i[r]=c[l(388)](/url\(#(.*)\)/,l(452)+t[l(364)]+")"))})),i}function fn(x,t){const e=a;var s;const{defIds:i}=t;return!i||i[e(371)]===0?x:x[e(612)]==="defs"&&(s=x[e(632)])!=null&&s[e(371)]?{...x,children:x.children[e(711)](n=>typeof n[e(645)].id==e(852)&&i&&i[e(637)](n[e(645)].id)?{...n,attrs:{...n[e(645)],id:n[e(645)].id+t[e(364)]}}:n)}:x}function bn(){const x=a;return Math[x(732)]().toString(36)[x(544)](2,8)}bt[a(832)]=a(439);const En={tag:"svg",attrs:{xmlns:a(705),fill:"none",viewBox:a(479),width:a(865),height:"1em"},children:[{tag:"g",attrs:{clipPath:a(501)},children:[{tag:"path",attrs:{stroke:a(713),d:"M3.61971 11.6499C2.40304 11.6499 0.699707 11.1024 0.699707 8.9124C0.699707 6.3574 3.25471 5.8099 3.98471 5.8099C4.34971 4.5324 5.07971 2.5249 7.99971 2.5249C10.5547 2.5249 11.6497 3.9849 12.0147 5.2624C12.0147 5.2624 15.2997 5.6274 15.2997 8.7299C15.2997 10.9199 13.8397 11.6499 12.3797 11.6499M9.82471 9.82466L6.17471 13.4747M6.17471 9.82466L9.82471 13.4747",strokeLinecap:a(532),strokeLinejoin:a(532),strokeWidth:1.2}}]},{tag:a(684),attrs:{},children:[{tag:"clipPath",attrs:{id:a(460)},children:[{tag:a(799),attrs:{fill:a(879),d:a(625)}}]}]}],defIds:[a(460)]},vx=T.forwardRef(function(x,t){const e=a;return T.createElement(bt,Object[e(493)]({},x,{id:e(848),ref:t,icon:En}))});vx[a(832)]=a(862);const In={tag:"svg",attrs:{xmlns:a(705),fill:a(607),viewBox:a(581),width:a(865),height:a(865)},children:[{tag:"g",attrs:{clipPath:a(660)},children:[{tag:a(799),attrs:{stroke:a(713),d:a(513),strokeLinecap:a(532),strokeLinejoin:a(532),strokeWidth:1.2}}]},{tag:a(684),attrs:{},children:[{tag:a(699),attrs:{id:a(494)},children:[{tag:a(799),attrs:{fill:a(879),d:a(625),transform:"translate(.97)"}}]}]}],defIds:[a(494)]},mx=T.forwardRef(function(x,t){const e=a;return T.createElement(bt,Object[e(493)]({},x,{id:e(781),ref:t,icon:In}))});mx[a(832)]=a(407);function vn(x){const t=a;switch(x){case L[t(753)]:return"collabStatus.offline";case L[t(730)]:return t(528);case L[t(597)]:return t(395);case L.NOT_COLLAB:return t(869);case L[t(697)]:case L[t(461)]:return"collabStatus.syncing";case L[t(573)]:case L.PENDING:return t(502)}}function mn(x){const t=a,{status$:e}=x,s=De(e,L[t(536)]),i=ee(y),n=ee(Bt),r=s!==L.OFFLINE,c=i.t(vn(s)),l=r?m.jsx(mx,{}):m.jsx(vx,{}),h=T.useCallback(()=>{r||n.reconnect()},[r,n]);function d(){const u=t;return m.jsxs(u(510),{className:u(556),onClick:h,children:[m.jsx(u(510),{className:at(u(445),{"univer-text-green-500":r,"univer-text-red-500":!r}),children:l}),m.jsx("div",{className:u(835),children:c})]})}return r?d():m.jsx(Gt,{title:i.t(t(672)),children:d()})}Object[a(670)];var Sn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},ke=(x,t)=>(e,s)=>t(e,s,x);let Je=class extends R{constructor(x,t,e,s){const i=a;super(),E(this,i(828),new D(L[i(536)])),this[i(644)]=x,this[i(571)]=t,this._collaborationController=e,this._uiPartsService=s,this[i(777)](),this._initStatusListener()}[a(827)](){const x=a;this[x(621)](this[x(644)][x(756)][x(359)](fe(()=>{const t=x,e=this[t(644)].getFocusedUnit();return e?this[t(476)][t(380)](e.getUnitId()):Ge(null)}),fe(t=>t?t[x(914)]:Ge(L[x(536)])))[x(369)](t=>{this[x(828)].next(t)}))}[a(777)](){const x=a;this[x(621)](this._uiPartsService.registerComponent(qt.HEADER_MENU,()=>Qt(gn({status$:this[x(828)].asObservable()}),this[x(571)])))}};Je=Sn([ke(0,F),ke(1,_(H)),ke(2,_(I0)),ke(3,nx)],Je);function gn(x){const{status$:t}=x;return function(){return m.jsx(mn,{status$:t})}}const Sx=os(a(744));var pn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},ge=(x,t)=>(e,s)=>t(e,s,x);let ze=class extends Y{constructor(x,t,e,s,i){const n=a;super(),this._urlService=x,this._logService=t,this[n(772)]=e,this._dataLoaderService=s,i?i==null||i[n(658)]().then(()=>this[n(596)]()):(this[n(478)][n(456)](n(889),n(871)),this[n(596)]())}async[a(596)](){const x=a,t=this[x(836)][x(578)](x(575)),e=this._urlService[x(578)](x(557)),s=this[x(836)][x(578)](x(608));if(!t||!e){this._logService[x(456)](x(889),x(702));return}const i=await this[x(580)].loadUnit(t,Number(e),s);i&&i instanceof cs&&this[x(679)](i)}async[a(679)](x){const t=a;await this._updateSubUnitFromURLParams(x),x.activeSheet$[t(359)](k(this[t(447)]))[t(369)](e=>{e&&this[t(470)](e)}),this[t(836)].urlChange$[t(359)](k(this[t(447)]))[t(369)](()=>this[t(569)](x))}[a(470)](x,t=!1){const e=a,s=this[e(836)][e(578)]("subunit");x[e(512)]()!==s&&this[e(836)][e(365)](e(608),x[e(512)](),t)}async _updateSubUnitFromURLParams(x){const t=a;var e;const s=this[t(836)][t(578)](t(608));if(!s||!x[t(834)](s)){const i=x[t(773)]()[0],n=x[t(834)](i);if(!n)return;this._updateURLWithCurrentState(n,!0),await this._commandService[t(441)](Ct.id,{unitId:x.getUnitId(),subUnitId:i});return}((e=x[t(774)]())==null?void 0:e[t(512)]())!==s&&await this[t(772)][t(441)](Ct.id,{unitId:x[t(675)](),subUnitId:s})}};ze=pn([ge(0,Sx),ge(1,ut),ge(2,Z),ge(3,_(B0)),ge(4,ms(Js))],ze);Object[a(670)];var Cn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},Nt=(x,t)=>(e,s)=>t(e,s,x);function K(x,t){const e=Ze();return K=function(s,i){return s=s-354,e[s]},K(x,t)}let X0=class extends Y{constructor(t,e){const s=a;super(),this[s(797)]=t,this[s(901)]=e,this._init()}[a(596)](){const t=a,e=this;this[t(621)](this[t(797)].addClipboardHook({onBeforePasteImage:async s=>{const i=t,n=await e[i(901)][i(872)](s);return n?{source:n[i(922)],imageSourceType:n[i(903)]}:null}}))}};X0=Cn([Nt(0,zs),Nt(1,_t)],X0);const Ot=[a(736),a(430),a(884),a(805),a(616),a(515)];class Et extends R{constructor(){const t=a;super(...arguments),E(this,t(905),new Map),E(this,t(410),0)}[a(471)](t){const e=a;if(this[e(905)][e(779)](t))return this[e(905)][e(436)](t);const s=Ot[this[e(410)]];return this[e(410)]=(this._colorIndex+1)%Ot[e(371)],this[e(905)][e(727)](t,s),s}}function gx(x){const t=a;let e="";for(const s of x){const{startOffset:i,endOffset:n,isActive:r,rangeType:c,segmentId:l,segmentPage:h}=s;e[t(371)]&&(e+=","),e+=i+":"+n+":"+(r?"1":"0")+":"+c+":"+l+":"+h}return e}function Tn(x){const t=a,e=x[t(385)](","),s=[];for(const i of e){const[n,r,c,l,h,d]=i[t(385)](":");s[t(565)]({startOffset:Number(n),endOffset:Number(r),collapsed:n===r,isActive:c==="1",rangeType:l===Be[t(893)]?Be[t(893)]:Be[t(558)],segmentId:typeof h==t(852)?String(h):"",segmentPage:Number(d??-1)})}return s.some(i=>i[t(398)])||(s[0][t(398)]=!0),s}class It extends Y{constructor(){const t=a;super(...arguments),E(this,t(696),new D(null)),E(this,"collabCursorState$",this._collabCursorState$[t(787)]())}[a(418)](t){const e=a,{unitID:s,memberID:i,textRanges:n}=t,r=gx(n);if(r==="")return;const c={unitID:s,memberID:i,selection:r};this[e(696)][e(639)](c)}}Object[a(670)];var Nn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},xe=(x,t)=>(e,s)=>t(e,s,x);const On=300,Rn=100;let K0=class extends Y{constructor(t,e,s,i,n,r,c,l,h){const d=a;super(),E(this,"_online",!1),E(this,d(596),!1),E(this,"_cursorInfo$",new D(new Map)),E(this,d(710),this[d(481)][d(787)]()),E(this,d(490),new D([])),E(this,d(534),this[d(490)][d(359)](ht(On))),E(this,"_updateLocalCursor",S0(u=>{const b=d,I={eventID:Q[b(739)],data:{unitID:this.unitID,memberID:this[b(918)].getMemberID(),selection:gx(u)}};this[b(918)].send(I,this[b(446)])},Rn)),this[d(446)]=t,this[d(918)]=e,this[d(571)]=s,this[d(680)]=i,this[d(790)]=n,this[d(908)]=r,this._transformService=c,this._univerInstanceService=l,this[d(772)]=h}get[a(704)](){const t=a;return this[t(481)][t(509)]()}get roomMembers(){const t=a;return this[t(490)][t(509)]()}[a(387)](){const t=a;super[t(387)](),this._cursorInfo$[t(639)](new Map),this[t(481)][t(792)](),this[t(490)].next([]),this[t(490)][t(792)]()}[a(519)](){const t=a;this[t(596)]||(this[t(596)]=!0,this._session[t(648)][t(359)](k(this[t(447)]))[t(369)](e=>{const s=t;e===Yt[s(640)]?this._toggleOnline():this[s(860)]()}),this._session[t(873)].pipe(k(this[t(447)]))[t(369)](e=>{const s=t,i=e[s(722)];i===Q[s(739)]&&this[s(549)](e),i===Q.USERS_LEAVE&&this[s(682)](e)}),this.disposeWithMe(this[t(772)].onCommandExecuted(e=>{const s=t,i=e[s(425)];i!=null&&this[s(588)]&&e.id===Ps.id&&i[s(413)]===this.unitID&&i[s(676)]===!1&&i[s(540)][s(371)]>0&&this._updateLocalCursor(i[s(540)])})),this[t(908)][t(819)][t(359)](k(this[t(447)]))[t(369)](e=>{const s=t;if((e==null?void 0:e[s(446)])!==this[s(446)])return;const i={eventID:Q.UPDATE_CURSOR,data:e};this[s(549)](i)}),this[t(621)](this._commandService[t(424)](e=>{const s=t;if(e[s(425)]==null)return;const i=e[s(425)];if(e.id!==ks.id||i.unitId!==this[s(446)])return;const n={id:"doc.mutation.rich-text-editing",params:i},r=this.cursorInfo;for(const[c,l]of r){const h={id:s(472),params:{unitId:this[s(446)],actions:null,textRanges:l[s(540)]}},d=this[s(448)][s(401)](n,h,!1);if(X(d))throw d[s(883)];r[s(727)](c,{...l,ranges:d[s(656)][s(425)].textRanges})}queueMicrotask(()=>{const c=s;this[c(481)][c(639)](r)})})))}_onCursorUpdate(t){const e=a;var s,i;const{memberID:n,selection:r}=t.data,c=Tn(r),l=(i=(s=this._memberService[e(720)](this[e(446)],n))==null?void 0:s[e(606)])!=null?i:e(743),h={color:this[e(680)][e(471)](n),name:l,ranges:c},d=this.cursorInfo;d[e(727)](n,h),this[e(481)][e(639)](d)}[a(682)](t){const e=a,{memberID:s}=t[e(651)],i=this.cursorInfo;i[e(849)](s),this._cursorInfo$[e(639)](i)}[a(810)](){const t=a;var e;if(this[t(588)]=!0,((e=this[t(644)].getFocusedUnit())==null?void 0:e[t(675)]())!==this[t(446)])return;const s=this[t(571)][t(436)](xx)[t(864)]();Array[t(423)](s)&&s[t(371)]>0&&this[t(894)](s)}[a(860)](){const t=a;this[t(588)]=!1}};K0=Nn([xe(2,_(H)),xe(3,_(Et)),xe(4,_(rt)),xe(5,_(It)),xe(6,ye),xe(7,F),xe(8,Z)],K0);Object[a(670)];var Un=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},ce=(x,t)=>(e,s)=>t(e,s,x);const Dn=300,wn=100,Ln=()=>{let x=[],t=!1;return e=>{x.push(e),t||(t=!0,setTimeout(()=>{x[K(450)](i=>i()),x=[],t=!1}))}};let Z0=class extends Y{constructor(x,t,e,s,i,n,r,c){const l=a;super(),E(this,l(588),!1),E(this,"_init",!1),E(this,l(481),new D(new Map)),E(this,l(710),this[l(481)].asObservable()),E(this,"_roomMembers$",new D([])),E(this,l(534),this._roomMembers$.pipe(ht(Dn))),E(this,"_updateLocalCursor",S0((h,d)=>{const u=l,b={eventID:Q[u(739)],data:{unitID:this[u(446)],memberID:this[u(918)][u(468)](),selection:Ls(h,d.range)}};this[u(918)][u(635)](b,this[u(446)])},wn)),this[l(446)]=x,this._session=t,this[l(571)]=e,this[l(680)]=s,this[l(790)]=i,this[l(644)]=n,this[l(772)]=r,this[l(689)]=c}get[a(704)](){return this[a(481)].getValue()}get[a(794)](){return this[a(490)].getValue()}[a(387)](){const x=a;super[x(387)](),this[x(481)][x(639)](new Map),this[x(481)][x(792)](),this._roomMembers$[x(639)]([]),this[x(490)][x(792)]()}init(){const x=a;this._init||(this[x(596)]=!0,this[x(918)][x(648)][x(359)](k(this[x(447)]))[x(369)](t=>{const e=x;t===Yt[e(640)]?this[e(810)]():this[e(860)]()}),this._session[x(873)][x(359)](k(this[x(447)]))[x(369)](t=>{const e=x,s=t[e(722)];s===Q[e(739)]&&this[e(549)](t),s===Q[e(917)]&&this[e(682)](t)}),this._onRefRangeChange(),this[x(621)](this._commandService[x(424)](t=>{const e=x;if(this[e(588)]&&t.id===Ms.id&&t.params[e(413)]===this[e(446)]){const s=t.params;this[e(894)](s.subUnitId,s.selections[0])}})))}_onCursorUpdate(x){const t=a;var e,s;const{memberID:i,selection:n}=x[t(651)],{sheetName:r,range:c}=ys(n),l={name:(s=(e=this[t(790)][t(720)](this.unitID,i))==null?void 0:e[t(606)])!=null?s:"Unknown user",range:this[t(530)](r,c),sheetID:r,color:this[t(680)][t(471)](i),selection:n},h=this.cursorInfo;h.set(i,l),this._cursorInfo$[t(639)](h)}[a(682)](x){const t=a,{memberID:e}=x[t(651)],s=this[t(704)];s.delete(e),this[t(481)][t(639)](s)}[a(530)](x,t){const e=a;var s,i;const n=(i=(s=this[e(644)][e(709)](this[e(446)]))==null?void 0:s[e(834)](x))==null?void 0:i[e(859)]();return(n==null?void 0:n[e(355)](r=>vs[e(813)](r,t)))||t}[a(566)](){const x=a,t=new dt,e=Ln(),s=()=>{const i=K;t.dispose();const n=(r,c,l,h)=>{const d=K;let u=[];switch(r.id){case G[d(769)]:{u=Ks(r,h);break}case G[d(586)]:{u=Xs(r,h);break}case G[d(587)]:{u=Gs(r,h);break}case G[d(783)]:{u=Ws(r,h);break}case G[d(911)]:{u=Ys(r,h);break}case G[d(863)]:{u=Bs(r,h);break}case G[d(629)]:{u=js(r,h);break}case G[d(402)]:{u=Vs(r,h);break}case G[d(561)]:{u=Fs(r,h);break}}const b=Zs(u,h),I=this[d(704)][d(436)](c);if(I&&b){const v={...I,range:b};this.cursorInfo[d(727)](c,v),e(()=>{const S=d,g=this[S(689)][S(886)](b,p=>(g[S(387)](),n(p,c,l,b)));t[S(459)](g)})}return{redos:[],undos:[]}};this[i(704)][i(450)]((r,c)=>{const l=i,{range:h,sheetID:d}=r,u=this[l(689)][l(886)](h,b=>(u[l(387)](),n(b,c,d,h)));t[l(459)](u)})};this[x(621)](Ae(this[x(481)][x(369)](()=>{s()})))}[a(810)](){const x=a;var t,e;if(this[x(588)]=!0,((t=this[x(644)][x(825)]())==null?void 0:t[x(675)]())!==this[x(446)])return;const s=(e=this[x(571)][x(436)](As).getCurrentSelections())==null?void 0:e[0],i=this._univerInstanceService.getCurrentUnitForType(P[x(520)]).getActiveSheet();s&&i&&this[x(894)](i.getSheetId(),s)}[a(860)](){const x=a;this[x(588)]=!1}};Z0=Un([ce(2,_(H)),ce(3,_(Et)),ce(4,_(rt)),ce(5,F),ce(6,Z),ce(7,_(qs))],Z0);Object[a(670)];var Mn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},L0=(x,t)=>(e,s)=>t(e,s,x);let be=class extends Y{constructor(t,e,s){const i=a;super(),E(this,i(370),new Map),E(this,"_entityInit$",new Kt),this[i(644)]=t,this[i(571)]=e,this[i(668)]=s,this._init()}dispose(){const t=a;super[t(387)](),this[t(857)][t(792)](),this[t(370)].forEach(e=>e[t(387)]())}[a(391)](t){const e=a;return this._entities[e(779)](t)?this[e(370)][e(436)](t)[e(710)]:this[e(857)].pipe(Y0(s=>s[e(446)]===t),fe(s=>s.cursorInfo$))}[a(596)](){const t=a;this[t(644)].getTypeOfUnitAdded$(P[t(520)])[t(359)](k(this.dispose$)).subscribe(async e=>{const s=t,i=e[s(675)](),n=await this[s(622)](i);this[s(857)][s(639)](n),this[s(370)].set(i,n)}),this._univerInstanceService[t(690)](P[t(411)]).pipe(k(this[t(447)])).pipe(Y0(e=>!e[t(675)]()[t(403)]("__")))[t(369)](async e=>{const s=t,i=e[s(675)](),n=await this[s(428)](i);this[s(857)][s(639)](n),this[s(370)].set(i,n)}),Es(this[t(644)].getTypeOfUnitDisposed$(P[t(411)]),this[t(644)][t(399)](P[t(520)]))[t(359)](k(this[t(447)])).subscribe(e=>{const s=t,i=e[s(675)](),n=this._entities[s(436)](i);n&&(n[s(387)](),this[s(370)].delete(i))})}async[a(622)](t){const e=a,s=await this[e(668)][e(522)](t),i=this[e(571)][e(619)](Z0,t,s);return i[e(519)](),i}async[a(428)](t){const e=a,s=await this[e(668)][e(522)](t),i=this._injector[e(619)](K0,t,s);return i.init(),i}};be=Mn([L0(0,F),L0(1,_(H)),L0(2,_(Bt))],be);const we=20,Rt=200,M0=4,yn=5;function An(x,t){const e=a;let{radius:s,width:i,height:n}=t;s=s??0,i=i??30,n=n??30;let r=0,c=0,l=0;r=c=l=Math[e(674)](s,i/2,n/2),x.beginPath(),x[e(795)](r,0),x.lineTo(i-c,0),x.arc(i-c,c,c,Math.PI*3/2,0,!1),x[e(535)](i,n-l),x.arc(i-l,n-l,l,0,Math.PI/2,!1),x[e(535)](0,n),x[e(535)](0,r),x.arc(r,r,r,Math.PI,Math.PI*3/2,!1),x.closePath(),t.fill&&(x[e(546)](),x[e(356)]=t[e(785)],t[e(562)]===e(823)?x[e(785)]("evenodd"):x.fill(),x.restore())}class C0 extends ex{constructor(t,e){const s=a;super(t,e),E(this,s(786)),E(this,"text"),this[s(786)]=e==null?void 0:e[s(786)],this[s(761)]=e==null?void 0:e[s(761)]}static[a(354)](t,e){const s=a,{text:i,color:n}=e;t[s(546)](),t[s(482)]=s(386);const r=t[s(900)](i)[s(497)],c=Math.min(r+2*M0,Rt);An(t,{height:we,radius:4,width:c,fill:n}),t[s(356)]=s(508);const l=M0,h=we-yn,d=Rt-2*M0;if(r>d){let u="",b=0;for(const I of i){const v=t[s(900)](I)[s(497)];if(b+v<=d-t[s(900)]("...")[s(497)])u+=I,b+=v;else{u+=s(829);break}}t[s(381)](u,l,h)}else t[s(381)](i,l,h);t[s(603)]()}[a(698)](t){C0[a(354)](t,this)}}const y0="collab-text-anchor-",Pn=a(847),kn=a(435),pe=6,$n=1.5,A0=4,Hn=1.5,Fn=a(887);class Ut{constructor(t,e,s,i){const n=a;E(this,n(754),[]),E(this,"_anchor",null),E(this,"_textBubble",null),E(this,n(880),null),E(this,n(604),null),E(this,n(378),null),this[n(531)]=t,this._scene=e,this[n(517)]=s,this[n(469)]=i,this[n(511)]()}set[a(377)](t){const e=a;t?(this[e(880)]&&this[e(880)].hide(),this[e(654)]&&this[e(654)][e(650)]()):(this[e(880)]&&this[e(880)].show(),this[e(654)]&&this[e(654)][e(383)]())}dispose(){const t=a;for(const e of this[t(754)])e[t(387)]();this[t(654)]&&this[t(654)][t(387)](),this[t(880)]&&this[t(880)][t(387)](),this[t(770)]&&this[t(770)].dispose(),this[t(378)]&&this[t(378)]()}[a(511)](){const t=a;var e;const{_docSkeleton:s,_document:i}=this,{color:n,name:r,ranges:c}=this[t(531)],l=i.getOffsetConfig(),{docsLeft:h,docsTop:d}=l,u=new $s(l,s);for(const{startOffset:b,endOffset:I,rangeType:v,segmentId:S,segmentPage:g,collapsed:p,isActive:N}of c){const U=s.findNodePositionByCharIndex(b,!0,S,g);let M=s[t(846)](I,!0,S,g);if(M==null&&(M=s[t(846)](I-1,!1,S,g)),N){const{contentBoxPointGroup:A}=u[t(422)](M,M);if(A.length===0)continue;this._drawAnchor(n,A,h,d,r),this[t(378)]=this[t(647)]()}if(U&&M){if(v===Be.RECT){const A=new Hs(l,s),{pointGroup:V}=(e=A[t(422)](U,M))!=null?e:{};if(V==null||V[t(371)]===0)continue;this[t(870)](n,V,h,d)}else if(!p){const{borderBoxPointGroup:A}=u[t(422)](U,M);if(A[t(371)]===0)continue;this[t(617)](n,A,h,d)}}}}[a(397)](t,e,s,i,n){const r=a,c=this[r(547)](e),{left:l,top:h,height:d}=c,u=this._getScale(),b=Hn/u,I=new G0(y0+re(pe),{left:l+s-b,top:h+i,height:d,width:$n,fill:t||me(ve[r(487)],0),strokeWidth:b,stroke:Fn,evented:!0});this[r(770)]=I,this[r(567)][r(741)](I,Se);const v=new G0(y0+re(pe),{left:l+s-b,top:h+i-A0/2,height:A0,width:A0,fill:t||me(ve[r(487)],0),strokeWidth:0,stroke:t||me(ve.black,0),evented:!1});this._anchorDot=v,this[r(567)][r(741)](v,Se);const S=new C0(y0+re(pe),{left:l+s-b,top:h+i-we,text:n,color:t});this[r(654)]=S,this._scene.addObject(S,Se),this[r(377)]=!1}_handleHover(){const t=a,e=this[t(770)][t(655)][t(393)](()=>{const i=t;this[i(377)]=!0}),s=this[t(770)].onPointerLeave$.subscribeEvent(()=>{const i=t;this[i(604)]&&clearTimeout(this[i(604)]),this[i(604)]=setTimeout(()=>{const n=i;this[n(377)]=!1},2e3)});return()=>{e[t(374)](),s.unsubscribe()}}[a(617)](t,e,s,i){const n=a,r=new pt(t)[n(591)](.2)[n(851)](),c=new Tt(Pn+re(pe),{pointsGroup:e,fill:r||me(ve[n(487)],.2),left:s,top:i,evented:!1,debounceParentDirty:!1});this._shapes[n(565)](c),this[n(567)][n(741)](c,Se)}[a(870)](t,e,s,i){const n=a,r=new pt(t)[n(591)](.2).toRgbString(),c=new Tt(kn+re(pe),{pointsGroup:e,fill:r||me(ve.black,.2),left:s,top:i,evented:!1,debounceParentDirty:!1});this._shapes[n(565)](c),this._scene[n(741)](c,Se)}_getAnchorBounding(t){const e=t[0],s=e[0],i=e[2],{x:n,y:r}=s,{x:c,y:l}=i;return{left:n,top:r,width:c-n,height:l-r}}[a(449)](){const t=a,{scaleX:e,scaleY:s}=this[t(567)][t(842)]();return Math[t(729)](e,s)}}var Vn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},$e=(x,t)=>(e,s)=>t(e,s,x);let J0=class extends Y{constructor(t,e,s,i,n){const r=a;super(),E(this,r(524),[]),E(this,r(921),[]),this[r(649)]=t,this._docSkeletonManagerService=e,this[r(427)]=s,this._commandService=i,this[r(623)]=n,this._init()}[a(596)](){const t=a,e=this._context[t(413)],s=this._docSkeletonManagerService;this[t(621)](m0([this._collabCursorController[t(391)](e),this[t(623)][t(485)]])[t(359)](lt(([i,n])=>({skeleton:s.getSkeleton(),cursors:[...i[t(624)]()].flatMap(r=>({...r,color:this[t(623)][t(376)](r[t(786)])}))}))).subscribe(i=>{const n=t;if(this[n(909)](),i){const{skeleton:r,cursors:c}=i;this[n(415)](r,c)}})),this[t(692)](),this[t(390)]()}_updateCollabCursors(t,e){const s=a,{scene:i,mainComponent:n}=this[s(649)],r=e[s(711)](c=>new Ut(c,i,t,n));this[s(524)]=r,this._cursors=e}[a(899)](){const t=a;this[t(909)]();const{scene:e,mainComponent:s}=this[t(649)],i=this[t(811)].getSkeleton(),n=this[t(921)].map(r=>new Ut(r,e,i,s));this[t(524)]=n}[a(909)](){const t=a;this[t(524)][t(450)](e=>e[t(387)]()),this[t(524)]=[]}[a(390)](){const t=a,e=[Os.id];this.disposeWithMe(this[t(772)][t(424)](s=>{const i=t;e[i(637)](s.id)&&s.params[i(413)]===this[i(649)].unitId&&this[i(899)]()}))}[a(692)](){const t=a;this[t(621)](Is(this[t(649)].engine[t(858)])[t(359)](Y0(e=>e[t(557)]===Rs[t(888)]),Us(16)).subscribe(()=>{this[t(899)]()}))}};J0=Vn([$e(1,_(Qs)),$e(2,_(be)),$e(3,Z),$e(4,_(Ue))],J0);const jn=1,Bn=1.5;class px extends ex{constructor(t,e){const s=a;super(t,e),E(this,s(751)),E(this,s(876),!1),E(this,s(775)),E(this,"_name",""),E(this,"_labelPosition",s(392)),E(this,"_backgroundColor"),e&&this.setShapeProps(e),this.onPointerEnter$[s(393)](()=>this[s(500)]({hovered:!0})),this[s(861)][s(393)](()=>this[s(500)]({hovered:!1}))}[a(500)](t){const e=a;var s,i,n,r,c,l;this[e(751)]=(s=t.color)!=null?s:this[e(751)],this[e(876)]=(i=t.hovered)!=null?i:this._hovered,this._range=(n=t[e(826)])!=null?n:this[e(775)],this[e(778)]=(r=t[e(606)])!=null?r:this._name,this._labelPosition=(c=t[e(555)])!=null?c:this[e(525)],this[e(642)]=(l=t[e(551)])!=null?l:this[e(642)],this.transformByState({width:t[e(497)],height:t[e(809)]})}[a(550)](t){const e=a,{row:s,column:i}=t;if(s>=this[e(775)][e(734)]&&s<=this[e(775)][e(717)]&&i>=this[e(775)].startColumn&&i<=this[e(775)].endColumn){this.setShapeProps({hovered:!0});return}this[e(500)]({hovered:!1})}[a(747)](t){return!1}_draw(t){const e=a;G0[e(354)](t,{width:this[e(497)],height:this[e(809)],strokeWidth:Bn,stroke:this[e(751)],evented:!1,fill:this[e(642)]}),this._hovered&&(t.save(),t.transform(1,0,0,1,this[e(497)],this[e(525)]===e(438)?0:-we),C0[e(354)](t,{text:this[e(778)],color:this._color}),t[e(603)]())}}var Yn=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},P0=(x,t)=>(e,s)=>t(e,s,x);const Wn=5001;let z0=class extends Y{constructor(x,t,e,s){const i=a;super(),E(this,i(921),new Set),E(this,i(484),null),this[i(649)]=x,this[i(882)]=t,this[i(427)]=e,this[i(623)]=s,this._init()}_init(){const x=a;this[x(882)][x(808)].pipe(k(this[x(447)]),fe(t=>{const e=x;if(t){const s=t[e(867)];return m0(this[e(427)].getCollabCursors$(this[e(649)].unitId),this._themeService.currentTheme$)[e(359)](lt(([i,n])=>{const r=e,c=new Map;return i[r(450)]((l,h)=>{const d=r;if(l.sheetID===s){const u={...l};u[d(786)]=this[d(623)][d(376)](l[d(786)]),c[d(727)](h,u)}}),{skeleton:t,cursors:c}}))}return Ge({skeleton:null,cursors:new Map})}))[x(369)](({skeleton:t,cursors:e})=>{const s=x;this[s(909)](),t&&this[s(415)](t,e)}),this._sheetSkeletonManagerService[x(808)][x(369)](t=>{const e=x;if(t==null)return;const{skeleton:s}=t,{scene:i}=this[e(649)];i.onPointerMove$[e(393)](S0(n=>{const r=e;var c,l;const{offsetX:h,offsetY:d}=n,{x:u,y:b}=i.getRelativeToViewportCoord(Xe[r(646)]([h,d])),{scaleX:I,scaleY:v}=i.getAncestorScale(),S=i[r(694)](sx.VIEW_MAIN),g=i[r(738)](Xe[r(646)]([u,b]),S),p=s[r(568)](h,d,I,v,g);((c=this[r(484)])==null?void 0:c[r(643)])===p.column&&((l=this[r(484)])==null?void 0:l.row)===p[r(505)]||this[r(921)][r(450)](N=>{N[r(550)](p)})},100))})}[a(415)](x,t){const e=a;var s;const i=(s=this._sheetSkeletonManagerService[e(523)]())==null?void 0:s[e(610)];if(!i)return;const n=this[e(495)]();if(!n)return;this[e(921)][e(450)](l=>{l[e(631)]()});const{scene:r}=n,c=Gn(Array[e(740)](t[e(624)]())).map(l=>{const h=e,{color:d,range:u,name:b,selection:I,sheetID:v}=l,{startColumn:S,startRow:g,endColumn:p,endRow:N}=u,U=Ke(g,S,r,i),M=Ke(N,p,r,i),{columnHeaderHeightAndMarginTop:A}=i,{startX:V,startY:Ie}=U,{endX:O0,endY:R0}=M,U0=O0-V,D0=R0-Ie,Mx={labelPosition:Ie-A>=we?h(392):"bottom",sheetID:v,range:u,color:d,name:b,selection:I,left:V,top:Ie,width:U0,height:D0,evented:!1,zIndex:Wn};return new px(b,Mx)});r[e(477)](c,jn),this._cursors=new Set(c)}[a(909)](){const x=a;var t;(t=this[x(921)])==null||t[x(450)](e=>e[x(387)]())}[a(495)](){const x=a;return ix(this[x(649)][x(575)],this[x(649)])}};z0=Yn([P0(1,_(rx)),P0(2,_(be)),P0(3,_(Ue))],z0);function Gn(x){const t=a,e=new Map;return x[t(450)](s=>{const i=t;if(e[i(779)](s[i(503)])){const n=e[i(436)](s.selection);n[i(606)]+=", "+s[i(606)]}else e[i(727)](s[i(503)],s)}),Array[t(740)](e[t(624)]())}Object[a(670)];var Xn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},le=(x,t)=>(e,s)=>t(e,s,x);let qe=class extends R{constructor(x,t,e,s,i,n){const r=a;super(),this[r(666)]=x,this._localCacheService=t,this[r(538)]=e,this[r(891)]=s,this._notificationService=i,this[r(661)]=n,this[r(707)](),this[r(429)]()}[a(707)](){const x=a;this.disposeWithMe(this[x(666)][x(776)](()=>{const t=x;if(this._localCacheService[t(601)][t(507)])return this[t(661)].t(t(480))}))}[a(429)](){const x=a;this.disposeWithMe(this[x(538)][x(873)][x(369)](t=>{const e=x;t.id===J[e(465)]&&this[e(891)][e(650)]({type:w[e(821)],content:this[e(661)].t(e(375))}),t.id===J[e(560)]&&this[e(891)][e(650)]({type:w.Warning,content:this[e(661)].t(e(875))}),t.id===J[e(706)]&&this[e(782)].show({title:this._localeService.t(e(615)),content:this[e(661)].t(e(817)),type:"error",duration:0}),t.id===J.CONFLICT&&this[e(891)].show({type:w[e(667)],content:this[e(661)].t(e(875))+"("+t.data+")"}),t.id===J[e(483)]&&this._messageService.show({type:w[e(821)],content:this[e(661)].t(t[e(651)]||"")}),t.id===J[e(433)]&&this[e(891)][e(650)]({type:w[e(821)],content:this._localeService.t(e(791))}),t.id===J[e(384)]&&this[e(891)][e(650)]({type:w[e(667)],content:this[e(661)].t(e(609))}),t.id===J[e(737)]&&this[e(891)][e(650)]({type:w.Error,content:this[e(661)].t(e(595))})}))}};qe=Xn([le(0,ei),le(1,nt),le(2,_(ts)),le(3,oe),le(4,ti),le(5,_(y))],qe);const Kn=a(760),Dt={};var Zn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},wt=(x,t)=>(e,s)=>t(e,s,x);let Qe=class{constructor(x,t){const e=a;this[e(448)]=x,this[e(431)]=t}transformIMECache(x){const t=a;this[t(554)](x),this[t(780)](x)}transformRemoteChangeset(x){const t=a,{unitID:e}=x,s=this[t(431)].getRenderById(e)[t(784)](w0),{redoCache:i}=s[t(691)]();if(i[t(371)]===0)return x;let n=B[t(892)](x.mutations[0]);for(let r=0;r<i.length;r++){const c={id:t(472),params:{...i[r]}},l=this[t(448)][t(401)](n,c,!1);if(X(l))throw l[t(883)];n=l[t(582)]}return{...B[t(892)](x),mutations:[n]}}[a(554)](x){const t=a,{unitID:e}=x,s=this._renderManagerService[t(812)](e).with(w0),{undoCache:i,redoCache:n}=s[t(691)]();if(i[t(371)]===0||n.length===0)return;const r=[],c=[];let l=B[t(892)](x[t(408)][0]),h=B[t(892)](x[t(408)][0]);for(let d=i[t(371)]-1;d>=0;d--){const u={id:"doc.mutation.rich-text-editing",params:{...i[d]}},b={id:t(472),params:{...n[d]}},I=this._transformService[t(401)](l,u,!1),v=this[t(448)][t(401)](h,b,!1);if(X(I))throw I[t(883)];if(X(v))throw v[t(883)];r[t(765)](I[t(656)].params),c.unshift(v.m2Prime[t(425)]),l=I.m1Prime,h=v[t(582)]}s[t(584)]({undoCache:r,redoCache:c})}[a(780)](x){const t=a,{unitID:e}=x,s=this[t(431)].getRenderById(e)[t(784)](w0),i=s.getActiveRange();if(i==null)return;const n=[{id:t(472),params:{unitId:x[t(446)],actions:null,textRanges:[i]}}],r=this._transformService[t(664)](x,n);if(!Vt(r))throw r.error;const c=r[t(656)][0][t(425)][t(457)];Array[t(423)](c)&&c[t(371)]&&s[t(367)](c[0])}};Qe=Zn([wt(0,ye),wt(1,g0)],Qe);Object[a(670)];var Jn=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},k0=(x,t)=>(e,s)=>t(e,s,x);let e0=class{constructor(t,e,s){const i=a;this[i(571)]=t,this[i(448)]=e,this[i(613)]=s}[a(820)](t){this[a(728)](t)}[a(518)](t){const e=a,{unitID:s}=t,{collaboration:i}=this[e(613)][e(800)](s);if(i.length===0)return t;let n=B.deepClone(t.mutations[0]);for(let r=0;r<i[e(371)];r++){const c={id:"doc.mutation.rich-text-editing",params:{unitId:i[r][e(413)],...i[r][e(570)]}},l=this[e(448)][e(401)](n,c,!1);if(X(l))throw l[e(883)];n=l[e(582)]}return{...B[e(892)](t),mutations:[n]}}[a(728)](t){const e=a,{unitID:s}=t,{history:i,collaboration:n}=this[e(613)][e(800)](s);if(i[e(371)]===0&&n[e(371)]===0)return;const r=[],c=[];let l=B[e(892)](t[e(408)][0]),h=B[e(892)](t[e(408)][0]);for(let d=i.length-1;d>=0;d--){const u={id:e(472),params:{unitId:i[d].unitId,...i[d][e(912)]}},b={id:e(472),params:{unitId:i[d].unitId,...i[d][e(570)]}},I=this[e(448)][e(401)](l,u,!1),v=this[e(448)].transformMutation(h,b,!1);if(X(I))throw I.error;if(X(v))throw v[e(883)];r[e(765)]({...i[d],undoState:I[e(656)][e(425)],redoState:v[e(656)].params}),l=I[e(582)],h=v.m1Prime}l=B[e(892)](t[e(408)][0]),h=B[e(892)](t[e(408)][0]);for(let d=n[e(371)]-1;d>=0;d--){const u={id:"doc.mutation.rich-text-editing",params:{unitId:n[d][e(413)],...n[d][e(912)]}},b={id:e(472),params:{unitId:n[d][e(413)],...n[d][e(570)]}},I=this[e(448)].transformMutation(l,u,!1),v=this[e(448)][e(401)](h,b,!1);if(X(I))throw I.error;if(X(v))throw v.error;c.unshift({...n[d],undoState:I.m2Prime.params,redoState:v[e(656)][e(425)]}),l=I[e(582)],h=v[e(582)]}this[e(613)][e(733)](s,{history:r,collaboration:c})}};e0=Jn([k0(0,_(H)),k0(1,ye),k0(2,_(ax))],e0);var zn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},Lt=(x,t)=>(e,s)=>t(e,s,x);let t0=class{constructor(t,e){const s=a;this[s(571)]=t,this._transformService=e}transformSelections(t){const e=a;var s;const i=this[e(571)][e(436)](xx),n=(s=i[e(864)]())!=null?s:[];if(n[e(371)]===0)return;const r=t[e(446)],c=[{id:"doc.mutation.rich-text-editing",params:{unitId:r,actions:null,textRanges:n}}],l=this[e(448)][e(664)](t,c);if(!Vt(l))throw l[e(883)];const h=l[e(656)][0][e(425)][e(457)];Array[e(423)](h)&&h[e(371)]&&i.replaceDocRanges(h,{unitId:r,subUnitId:r},!1)}};t0=zn([Lt(0,_(H)),Lt(1,ye)],t0);Object[a(670)];var qn=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},z=(x,t)=>(e,s)=>t(e,s,x);let x0=class extends R{constructor(t,e,s,i,n,r,c,l){const h=a;super(),E(this,h(828),new D(L[h(536)])),this[h(613)]=t,this._collaborationController=e,this._docTransformIMECacheService=s,this[h(686)]=i,this[h(856)]=n,this[h(593)]=r,this[h(891)]=c,this._localeService=l,this[h(913)]()}_initEntityListener(){const t=a;this[t(621)](this[t(476)][t(552)].subscribe(e=>{const s=t,i=this[s(613)].docStateChange$[s(369)](n=>{const r=s;if(n==null)return;const{unitId:c,redoState:l,commandId:h}=n;if(c!==e[r(446)])return;const d={id:h,type:Xt[r(576)],params:{unitId:c,actions:l[r(724)],textRanges:null}};e[r(463)](d)});if(e[s(621)](i),e instanceof es){const n={onTransformIME:r=>this[s(818)][s(902)](r),onTransformState:r=>this[s(686)].transformStateCache(r),onTransformSelections:r=>this[s(856)][s(559)](r),onSyncEditingCollabCursor:r=>this[s(593)][s(418)](r),onTransformRemoteChangesetByIMECache:r=>this._docTransformIMECacheService[s(518)](r),onTransformRemoteChangesetByStateCache:r=>this[s(686)][s(518)](r)};e.addHandlerCallback(n)}}))}};x0=qn([z(0,_(ax)),z(1,_(I0)),z(2,_(Qe)),z(3,_(e0)),z(4,_(t0)),z(5,_(It)),z(6,oe),z(7,_(y))],x0);var Oe=(x=>(x[x[a(748)]=0]=a(748),x[x.OK=1]="OK",x[x[a(806)]=2]=a(806),x[x[a(706)]=3]=a(706),x[x.NOT_FOUND=4]=a(755),x[x[a(444)]=5]=a(444),x[x[a(789)]=6]="ALREADY_EXISTS",x[x[a(687)]=7]="INVALID_ARGUMENT",x[x[a(718)]=8]=a(718),x[x[a(723)]=9]=a(723),x[x.LOGIN_FAILED=10]=a(379),x[x[a(659)]=11]="MOBILE_VERIFY_CODE_MISMATCH",x[x[a(793)]=12]=a(793),x[x[a(868)]=13]="EMAIL_VERIFY_CODE_MISMATCH",x[x[a(602)]=14]="EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED",x[x.AUTHORIZE_CODE_ILLEGAL=15]="AUTHORIZE_CODE_ILLEGAL",x[x[a(837)]=16]=a(837),x[x[a(665)]=100]=a(665),x[x[a(885)]=101]=a(885),x[x[a(693)]=201]=a(693),x[x[a(845)]=202]="USER_IS_ANONYMOUS",x[x[a(475)]=5001]=a(475),x[x[a(766)]=6001]=a(766),x[x.SNAPSHOT_HAS_BEEN_REMOVED=6002]=a(426),x[x.ENSURE_SNAPSHOT_EXECUTION=6003]=a(716),x[x[a(678)]=7001]="APPLY_REJECT",x[x[a(521)]=7002]=a(521),x[x[a(366)]=7003]=a(366),x[x[a(414)]=7004]=a(414),x[x.APPLY_DUPLICATED=7005]=a(919),x[x[a(611)]=8001]=a(611),x[x.LICENSE_MAX_UNITS_EXCEEDED=9001]=a(745),x[x[a(877)]=9002]=a(877),x[x[a(590)]=9003]="LICENSE_IMPORT_SIZE_EXCEEDED",x[x[a(600)]=9004]=a(600),x[x[a(838)]=9005]=a(838),x[x.YUUMI_UNABLE_LOAD_URL=10001]=a(406),x[x[a(878)]=10002]=a(878),x[x.YUUMI_RATE_OVER_LIMIT=10003]="YUUMI_RATE_OVER_LIMIT",x[x[a(746)]=10004]=a(746),x[x.YUUMI_NO_CUBOID_FOR_QUESTION=10010]="YUUMI_NO_CUBOID_FOR_QUESTION",x[x[a(853)]=10011]="YUUMI_ASYNCIO_CANCELLED",x[x[a(451)]=10012]=a(451),x[x.YUUMI_ALL_TABLES_IS_INVALID=10013]=a(455),x[x.YUUMI_PROMPT_MAX_TOKENS_EXCEEDED=10014]=a(594),x[x[a(618)]=10015]=a(618),x[x[a(499)]=10016]="YUUMI_CONNECTOR_URL_NOT_FOUND",x[x.PY_RUNTIME_SCRIPT_ERROR=11001]="PY_RUNTIME_SCRIPT_ERROR",x[x.INVITE_CODE_HAS_BEEN_UES=12001]=a(362),x[x[a(683)]=12002]=a(683),x[x[a(363)]=12003]=a(363),x[x.USER_NOT_INVITED_CODE=12004]=a(915),x[x[a(440)]=12005]="INVITE_CODE_ALREADY_BOUND",x[x[a(491)]=13001]=a(491),x[x[a(541)]=13002]=a(541),x[x[a(721)]=13003]=a(721),x[x[a(529)]=14001]=a(529),x[x[a(638)]=14002]=a(638),x[x[a(421)]=14003]=a(421),x[x[a(841)]=14004]="PAYMENT_CHANNEL_NOT_SUPPORT",x[x.ENTITLE_CHAT_LIMIT_EXCEED=14101]=a(725),x[x[a(703)]=14102]=a(703),x[x[a(764)]=14103]="ENTITLE_INSUFFICIENT_QUOTA",x[x.ENTITLE_NEED_BILLING_ADDRESS=14301]=a(833),x[x.REDEMPTION_INVALID_CODE=15001]=a(798),x[x[a(417)]=15002]=a(417),x[x[a(360)]=15003]="REDEMPTION_CODE_FULLY_REDEEMED",x[x.REDEMPTION_CODE_NOT_STARTED=15004]=a(492),x[x[a(890)]=15005]="REDEMPTION_USER_NOT_ELIGIBLE",x[x[a(815)]=15006]=a(815),x[x[a(824)]=15007]=a(824),x[x[a(361)]=16001]=a(361),x[x[a(804)]=-1]="UNRECOGNIZED",x))(Oe||{});function Qn(x){const t=a;var e,s;const i=(e=x.stageInfo)==null?void 0:e[t(605)],n=((s=x.stageInfo)==null?void 0:s.totalFormulasToCalculate)||0;return i===Ds[t(850)]&&n>0}function er(x){const t=a;return x[t(881)]===ws[t(496)]}var tr=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},se=(x,t)=>(e,s)=>t(e,s,x);const xr="/universer-api/license/formula/limit/status",sr=a(620),ir=a(400);let s0=class extends R{constructor(x,t,e,s,i,n,r){const c=a;super(),E(this,c(542),null),E(this,c(726),0),E(this,c(762),0),E(this,c(816),[]),E(this,c(715),0),this[c(891)]=x,this[c(772)]=t,this[c(688)]=e,this[c(583)]=s,this._univerInstanceService=i,this[c(478)]=n,this._localeService=r,this._initCommandInterceptor()}[a(910)](){const x=a;this[x(621)](this[x(772)].beforeCommandExecuted((t,e)=>{const s=x;var i;if(t.id!==Ts.id)return;const n=t.params;if(this._hasFormulaInDirtyRanges((i=n.dirtyRanges)!=null?i:[])&&!this[s(763)]())throw this[s(626)](t,e),this[s(669)](),new _s})),this.disposeWithMe(this[x(772)].onCommandExecuted((t,e)=>{const s=x;if(t.id!==Ns.id)return;const i=t.params;if(Qn(i)){const n=re();this[s(816)][s(565)](n),this[s(758)](n)}else if(er(i)&&this._taskIds[s(371)]>0){const n=this[s(816)].shift();this._releaseCalculationLimit(n)}}))}[a(387)](){const x=a;super.dispose(),this._clearPolling(),this[x(816)]=[],this[x(762)]=0,this[x(726)]=0,this._lastResponseTimestamp=0}async[a(626)](x,t){const e=a;for(let s=0;s<30;s++)try{if(await this[e(898)](),this[e(763)]()){this[e(548)](x,t),this[e(891)][e(650)]({content:this[e(661)].t("formula.calculation.started"),type:w[e(630)]});return}await new Promise(i=>{const n=e;this._pollingInterval=window[n(579)](i,1e3)})}catch(i){this[e(478)][e(883)](i)}this[e(891)][e(650)]({content:this._localeService.t(e(473)),type:w[e(667)]})}[a(548)](x,t){const e=a;try{this[e(772)][e(441)](x.id,x.params,t)}catch(s){this[e(478)][e(883)](s)}}[a(636)](x,t){const e=a;t<this[e(715)]||(this[e(715)]=t,this[e(726)]=Number[e(874)](x[e(634)]),this._currentUsage=Number.parseInt(x[e(735)]))}async[a(758)](x){const t=a;var e,s;const i=Date[t(701)]();try{const n=((e=this._configService[t(553)](ue))==null?void 0:e.startFormulaLimitUrl)||sr,r=(await this[t(583)][t(719)](n,{body:JSON.stringify({taskId:x})}))[t(712)];if(((s=r[t(883)])==null?void 0:s[t(677)])!==Oe.OK)return;this[t(636)](r[t(855)],i)}catch(n){this[t(478)][t(883)](n)}}async[a(898)](x){const t=a;var e,s;const i=Date[t(701)]();try{const n=((e=this._configService[t(553)](ue))==null?void 0:e[t(527)])||xr,r=x?n+"?taskId="+encodeURIComponent(x):n,c=(await this._httpService[t(436)](r)).body;if(((s=c[t(883)])==null?void 0:s[t(677)])!==Oe.OK)return;this._setFormulaLimitStatus(c[t(855)],i)}catch(n){this[t(478)][t(883)](n)}}async[a(419)](x){const t=a;var e,s;const i=Date[t(701)]();try{const n=((e=this[t(688)].getConfig(ue))==null?void 0:e[t(685)])||ir,r=(await this[t(583)][t(719)](n,{body:JSON.stringify({taskId:x})}))[t(712)];if(((s=r.error)==null?void 0:s[t(677)])!==Oe.OK)return;this[t(636)](r[t(855)],i)}catch(n){this[t(478)][t(883)](n)}}_checkCalculationAvailable(){const x=a;return this[x(726)]===0?!0:this._maxFormulaLimit-this[x(762)]>0}[a(714)](){const x=a;this[x(542)]&&(clearTimeout(this[x(542)]),this[x(542)]=null)}_showGuardMessage(){const x=a;this._messageService[x(650)]({content:this[x(661)].t("formula.calculation.waiting"),type:w.Loading})}[a(831)](x){const t=a;for(const e of x){const{unitId:s,sheetId:i,range:n}=e,r=this[t(644)].getUnit(s);if(!r)continue;const c=r[t(834)](i);if(!c)continue;const l=c[t(372)]();for(let h=n.startRow;h<=n[t(717)];h++)for(let d=n[t(897)];d<=n[t(788)];d++){const u=l[t(509)](h,d);if(u&&(fs(u.f)||bs(u.si)))return!0}}return!1}};s0=tr([se(0,_(oe)),se(1,Z),se(2,W),se(3,_(p0)),se(4,F),se(5,ut),se(6,_(y))],s0);var nr=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},$0=(x,t)=>(e,s)=>t(e,s,x);let q0=class extends R{constructor(t,e,s){const i=a;super(),E(this,i(412),new Map),E(this,"_saveTaskMap",new Map),E(this,i(653),!1),this[i(688)]=t,this[i(514)]=e,this[i(750)]=s}[a(394)](){const t=a;this[t(653)]=!0}[a(920)](){const t=a;this[t(653)]=!1}get[a(601)](){return this[a(854)]}[a(387)](){const t=a;this[t(752)]().then(()=>super[t(387)]())}async[a(771)](t){const e=a;return this[e(653)]?null:this._localStorageService[e(843)](gt(t))}async[a(598)](t,e){const s=a;return!!this._localStorageService[s(904)](t,e)}updateOfflineData(t,e,s,i){const n=a,r=this[n(750)][n(358)](t);this[n(412)][n(727)](t,{unitID:t,type:e,awaitingChangeset:s,mutations:i,rev:r}),this[n(854)].has(t)||this[n(405)](t)}[a(405)](t){const e=a,s=this[e(814)]();s===0?this[e(539)](t):this[e(854)][e(727)](t,setTimeout(()=>this[e(539)](t),s))}[a(814)](){const t=a;var e;return(e=this[t(688)].getConfig(Qx))!=null?e:qx}[a(539)](t){const e=a,s=this[e(854)].get(t);return s!==void 0&&window[e(916)](s),this[e(514)][e(904)](gt(t),this[e(412)].get(t))[e(516)](()=>this._saveTaskMap.delete(t))}async exhaustSavingTask(){const t=a,e=[];this[t(854)][t(450)]((s,i)=>{const n=t;window[n(916)](s),e[n(565)](this[n(539)](i)[n(516)](()=>{const r=n;this[r(854)][r(849)](i)}))}),await Promise[t(404)](e)}};q0=nr([$0(0,W),$0(1,Ss),$0(2,_(yx))],q0);class rr extends Y{constructor(){const t=a;super(),E(this,t(464)),this[t(464)]=tx(window,t(443)).pipe(k(this.dispose$),Cs(1),zx(void 0))}[a(365)](t,e,s=!1){const i=a,n=new URL(window[i(432)].href);n[i(796)][i(727)](t,e),s?window[i(749)][i(454)]("","",n.toString()):window.history.pushState("","",n[i(442)]())}[a(652)](t,e=!1){const s=a,i=new URL(window.location[s(506)]);i[s(796)][s(849)](t),e?window[s(749)].replaceState("","",i[s(442)]()):window[s(749)].pushState("","",i[s(442)]())}[a(578)](t){const e=a;var s;return(s=new URL(window[e(432)][e(506)])[e(796)][e(436)](t))!=null?s:void 0}}var ar=Object[a(830)],or=(x,t,e)=>t in x?ar(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,cr=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},H0=(x,t)=>(e,s)=>t(e,s,x),lr=(x,t,e)=>or(x,t+"",e);const hr=a(572);let Ye=class extends ot{constructor(x=Dt,t,e,s){const i=a;super(),this[i(599)]=x,this[i(431)]=t,this[i(571)]=e,this._configService=s;const{...n}=ct({},Dt,this[i(599)]);this[i(688)][i(474)](Kn,n)}[a(504)](){this[a(577)](),this._initDependencies()}[a(628)](){this._registerRenderDependencies()}[a(577)](){const x=a;var t;const e=[[Et],[s0],[t0],[Qe],[e0],[It],[Sx,{useClass:rr}],[Gi,{useClass:Xi}],[nt,{useClass:q0}],[Je],[x0],[qe],[be],[X0],[ze]];ls(this._injector,hs(e,(t=this[x(599)])==null?void 0:t[x(663)]))}[a(803)](){const x=a;this.disposeWithMe(this[x(431)].registerRenderModule(P.UNIVER_DOC,[J0])),this[x(621)](this._renderManagerService[x(907)](P[x(520)],[z0]))}[a(545)](){ds(this._injector,[[be],[Je],[x0],[qe],[ze],[s0]])}};lr(Ye,a(657),hr),Ye=cr([Zt(Wt),H0(1,g0),H0(2,_(H)),H0(3,W)],Ye);Object[a(670)];var dr=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},Ce=(x,t)=>(e,s)=>t(e,s,x);let Q0=class extends Xx{constructor(x,t,e,s,i){super(x,t,e,s,i)}async[a(592)](x){const t=a,e=await this[t(731)](),s=this._createSocketURL(x,e);return this._doCreateSocket(s)}[a(742)](x,t){const e=a,s=typeof window>"u"?new URL(x):new URL(x,window[e(432)][e(564)]);s[e(796)][e(727)](e(453),t);const i=typeof window>"u"?new URLSearchParams:new URLSearchParams(window[e(432)].search);return i[e(436)](e(866))&&s[e(796)][e(727)](e(866),i[e(436)](e(866))),s[e(442)]()}async _getSessionTicket(){const x=a;var t,e,s;const i=this[x(688)][x(553)](ue),n=(t=i==null?void 0:i.wsSessionTicketUrl)!=null?t:Kx;return(s=(e=(await this[x(583)][x(436)](n,{headers:{"Content-Type":x(633)}}))[x(712)])==null?void 0:e[x(488)])!=null?s:""}};Q0=dr([Ce(0,_(H)),Ce(1,_(p0)),Ce(2,W),Ce(3,ut),Ce(4,E0)],Q0);var ur=(x,t,e,s)=>{const i=a;for(var n=t,r=x[i(371)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},F0=(x,t)=>(e,s)=>t(e,s,x);let et=class extends R{constructor(x,t,e){const s=a;super(),this._instanceService=x,this[s(583)]=t,this._configService=e}async runOnServer(x,t,e,...s){const i=a;var n,r,c,l;const h=this[i(802)].getFocusedUnit();if(!h)throw new Error(i(768));const d=((n=this[i(688)][i(553)](Zx))!=null?n:Jx)+"/"+x+i(896)+t,u=new URL(window[i(432)][i(506)]),b={scriptId:x,runId:(r=u[i(796)].get(i(866)))!=null?r:"",function:t,unitId:h[i(675)](),argsOfFunction:JSON[i(807)](s),invokeId:(c=e.invokeId)!=null?c:"",executionId:(l=e[i(627)])!=null?l:""};try{const I=await this[i(583)][i(719)](d,{body:b});return I[i(712)][i(883)]&&I[i(712)][i(883)][i(677)]!==Oe.OK?i(662):I[i(712)][i(382)]}catch{return i(662)}}};et=ur([F0(0,F),F0(1,_(p0)),F0(2,W)],et);const Mt=3e4,yt=a(458);class Ja extends R{constructor(){const t=a;super(),E(this,t(420),re()),E(this,t(543),new Set),E(this,t(641),new Map),E(this,t(373),null),E(this,t(801),new Map),E(this,t(589),new Map),this[t(596)]()}[a(387)](){const t=a;super[t(387)](),this[t(801)][t(450)]((e,s)=>this[t(537)](s)),this[t(373)]&&window[t(585)](this._heartbeatTimer)}[a(844)](t){return this._ensureSubject(t).pipe(us())}[a(839)](t){const e=a;this[e(543)].size===0&&this[e(368)](),this[e(543)][e(459)](t),this._send({type:0,memberID:this[e(420)],unitIDs:[t],isForwarded:!1})}disposeUnit(t){const e=a;this[e(543)][e(849)](t),this[e(543)].size===0&&this[e(373)]&&window[e(585)](this[e(373)])}[a(596)](){const t=a;this.disposeWithMe(Ae(tx(window,t(671))[t(369)](e=>{const s=t;if(e[s(409)]!==yt||!e.newValue)return;const i=JSON[s(840)](e[s(466)]);this._handleEvent(i)}))),window.addEventListener(t(757),()=>this._send({type:1,memberID:this[t(420)],unitIDs:Array[t(740)](this[t(543)])}))}[a(416)](t){const e=a;switch(t[e(557)]){case 0:this[e(563)](t);break;case 1:this[e(923)](t);break;case 2:this[e(498)](t);break}}[a(563)](t){const e=a,{unitIDs:s,memberID:i,isForwarded:n}=t;s[e(450)](r=>{const c=e;if(!n&&this[c(641)][c(779)](r)&&this[c(389)](r)[c(639)](Pe.OTHER_CLIENTS_EDITING),!this[c(641)].has(r)||!this[c(641)][c(436)](r)[c(779)](i)){const l=this[c(641)].get(r)||new Set;l[c(459)](i),this._unitOnClients[c(727)](r,l),this[c(357)](i)}}),n||this._send({type:0,memberID:this[e(420)],unitIDs:[...this._selfUnitIDs],isForwarded:!0})}_scheduleClearOtherTimer(t){const e=a;this[e(537)](t);const s=window[e(579)](()=>{const i=e;this[i(641)][i(450)](n=>{n[i(849)](t)})},Mt*2);this[e(801)][e(727)](t,s)}[a(537)](t){const e=a;if(this[e(801)][e(779)](t)){const s=this[e(801)].get(t);s&&window.clearTimeout(s),this[e(801)][e(727)](t,null)}}_handleLeaveEvent(t){const e=a,{memberID:s,unitIDs:i}=t;i.forEach(n=>{const r=K;var c;const l=this[r(641)].get(n);l&&(l.delete(s),(c=this._ensureSubject(n))==null||c[r(639)](l.size===0?Pe[r(614)]:Pe[r(533)]))}),this[e(537)](s)}[a(498)](t){const e=a;this[e(357)](t[e(895)])}[a(759)](t){const e=a;localStorage[e(904)](yt,JSON[e(807)](t))}[a(368)](){this._heartbeatTimer=window.setInterval(()=>{const t=K;this[t(759)]({type:2,memberID:this[t(420)]})},Mt)}_ensureSubject(t){const e=a;return this[e(589)][e(779)](t)||this[e(589)][e(727)](t,new D(Pe[e(614)])),this._unitStatus.get(t)}}const o=te;(function(x,t){const e=te,s=x();for(;;)try{if(parseInt(e(657))/1*(parseInt(e(820))/2)+parseInt(e(803))/3*(parseInt(e(540))/4)+parseInt(e(733))/5*(-parseInt(e(507))/6)+parseInt(e(885))/7*(parseInt(e(700))/8)+-parseInt(e(558))/9*(parseInt(e(895))/10)+-parseInt(e(502))/11+parseInt(e(653))/12===t)break;s.push(s.shift())}catch{s.push(s.shift())}})(a0,523240);var _r=Object.defineProperty,fr=(x,t,e)=>t in x?_r(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,C=(x,t,e)=>fr(x,typeof t!="symbol"?t+"":t,e);function te(x,t){const e=a0();return te=function(s,i){return s=s-491,e[s]},te(x,t)}const Cx="edit-history-viewer.config",At={};Object[o(668)];var br=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},Er=(x,t)=>(e,s)=>t(e,s,x);let i0=class extends R{constructor(x){const t=o;super(),this[t(499)]=x,this._init()}[o(493)](){const x=o;this[x(693)](this[x(499)][x(709)][x(597)](t=>{const e=x;t!=null&&t[e(931)]&&this[e(499)][e(606)]({show:!1})}))}};i0=br([Er(0,Ci)],i0);var T0=(x=>(x[x[o(811)]=0]=o(811),x[x.OK=1]="OK",x[x[o(899)]=2]=o(899),x[x[o(738)]=3]=o(738),x[x.NOT_FOUND=4]=o(538),x[x[o(523)]=5]=o(523),x[x.ALREADY_EXISTS=6]="ALREADY_EXISTS",x[x[o(702)]=7]=o(702),x[x[o(890)]=8]="TOO_MANY_REQUESTS",x[x.COMPLETION_FINISHED=9]=o(836),x[x[o(509)]=10]=o(509),x[x.MOBILE_VERIFY_CODE_MISMATCH=11]=o(550),x[x[o(553)]=12]=o(553),x[x[o(530)]=13]=o(530),x[x.EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED=14]="EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED",x[x[o(779)]=15]=o(779),x[x[o(843)]=16]=o(843),x[x.CURRENT_STATUS_CANNOT_OPERATE=100]=o(729),x[x[o(570)]=101]=o(570),x[x[o(756)]=201]=o(756),x[x[o(731)]=202]=o(731),x[x.CHANGESET_REVISION_CONFILICT=5001]=o(646),x[x.SNAPSHOT_INVALID_SNAPSHOT=6001]=o(757),x[x[o(835)]=6002]=o(835),x[x[o(525)]=6003]="ENSURE_SNAPSHOT_EXECUTION",x[x[o(809)]=7001]=o(809),x[x[o(732)]=7002]=o(732),x[x.APPLY_REVISION_CONFILICT=7003]=o(891),x[x[o(578)]=7004]="APPLY_PERMISSION_DENIED",x[x.APPLY_DUPLICATED=7005]=o(684),x[x[o(847)]=8001]=o(847),x[x.LICENSE_MAX_UNITS_EXCEEDED=9001]=o(937),x[x[o(628)]=9002]=o(628),x[x.LICENSE_IMPORT_SIZE_EXCEEDED=9003]=o(599),x[x[o(838)]=9004]=o(838),x[x[o(673)]=9005]=o(673),x[x.YUUMI_UNABLE_LOAD_URL=10001]=o(528),x[x[o(882)]=10002]=o(882),x[x[o(604)]=10003]=o(604),x[x[o(616)]=10004]="YUUMI_SUBSCRIPTION_NOT_FOUND",x[x.YUUMI_NO_CUBOID_FOR_QUESTION=10010]=o(723),x[x[o(532)]=10011]=o(532),x[x[o(909)]=10012]=o(909),x[x[o(810)]=10013]=o(810),x[x[o(737)]=10014]=o(737),x[x[o(712)]=10015]=o(712),x[x[o(826)]=10016]=o(826),x[x[o(641)]=11001]=o(641),x[x[o(943)]=12001]=o(943),x[x[o(894)]=12002]=o(894),x[x.INVITE_CODE_REQUIRED=12003]="INVITE_CODE_REQUIRED",x[x[o(868)]=12004]=o(868),x[x[o(714)]=12005]=o(714),x[x.WECHAT_HAS_BEEN_BOUND=13001]="WECHAT_HAS_BEEN_BOUND",x[x.MOBILE_HAS_BEEN_BOUND=13002]=o(724),x[x.EMAIL_HAS_BEEN_BOUND=13003]=o(919),x[x[o(600)]=14001]=o(600),x[x.ENTITLE_UPDOWN_GRADE_NOT_SUPPORT=14002]=o(920),x[x[o(518)]=14003]=o(518),x[x.PAYMENT_CHANNEL_NOT_SUPPORT=14004]=o(774),x[x.ENTITLE_CHAT_LIMIT_EXCEED=14101]=o(880),x[x[o(846)]=14102]=o(846),x[x.ENTITLE_INSUFFICIENT_QUOTA=14103]="ENTITLE_INSUFFICIENT_QUOTA",x[x[o(853)]=14301]="ENTITLE_NEED_BILLING_ADDRESS",x[x[o(910)]=15001]=o(910),x[x[o(692)]=15002]=o(692),x[x.REDEMPTION_CODE_FULLY_REDEEMED=15003]=o(614),x[x[o(925)]=15004]=o(925),x[x[o(938)]=15005]="REDEMPTION_USER_NOT_ELIGIBLE",x[x.REDEMPTION_USER_REDEEM_TIMES_EXCEED=15006]="REDEMPTION_USER_REDEEM_TIMES_EXCEED",x[x.REDEMPTION_CODE_HAS_BEEN_CREATED=15007]="REDEMPTION_CODE_HAS_BEEN_CREATED",x[x[o(542)]=16001]=o(542),x[x[o(718)]=-1]=o(718),x))(T0||{}),n0=(x=>(x[x[o(771)]=0]="UNIVER_UNKNOWN",x[x[o(873)]=1]="UNIVER_DOC",x[x[o(567)]=2]=o(567),x[x[o(935)]=3]=o(935),x[x[o(856)]=4]=o(856),x[x[o(718)]=-1]="UNRECOGNIZED",x))(n0||{}),ne=(x=>(x[x[o(623)]=0]=o(623),x[x[o(496)]=1]=o(496),x[x.ManageCollaborator=2]="ManageCollaborator",x[x.Print=3]=o(577),x[x[o(592)]=4]=o(592),x[x.Comment=5]="Comment",x[x[o(917)]=6]=o(917),x[x.Share=7]=o(913),x[x[o(815)]=8]=o(815),x[x[o(585)]=9]=o(585),x[x[o(902)]=10]=o(902),x[x[o(786)]=11]=o(786),x[x[o(680)]=12]=o(680),x[x.CreateWorksheet=13]=o(665),x[x[o(560)]=14]=o(560),x[x.EditWorksheetCell=15]=o(697),x[x[o(930)]=16]="InsertHyperlink",x[x[o(776)]=17]=o(776),x[x[o(678)]=18]=o(678),x[x[o(710)]=19]="PivotTable",x[x[o(766)]=20]=o(766),x[x[o(758)]=21]="History",x[x[o(813)]=22]=o(813),x[x[o(854)]=23]=o(854),x[x[o(734)]=24]=o(734),x[x[o(571)]=25]=o(571),x[x.DeleteSheet=26]=o(632),x[x[o(513)]=27]=o(513),x[x.CopySheet=28]="CopySheet",x[x[o(659)]=29]="RenameSheet",x[x[o(631)]=30]=o(631),x[x[o(699)]=31]=o(699),x[x.SelectUnProtectedCells=32]=o(573),x[x[o(881)]=33]="SetCellStyle",x[x.SetCellValue=34]=o(823),x[x[o(572)]=35]=o(572),x[x.SetColumnStyle=36]=o(559),x[x[o(898)]=37]=o(898),x[x[o(728)]=38]=o(728),x[x[o(630)]=39]=o(630),x[x[o(637)]=40]="DeleteColumn",x[x.EditExtraObject=41]=o(915),x[x[o(795)]=42]="Delete",x[x.RecoverHistory=43]=o(800),x[x[o(849)]=44]=o(849),x[x[o(500)]=45]=o(500),x[x[o(718)]=-1]=o(718),x))(ne||{});function Ir(x){const t=o;return!!(x&&x[t(905)]&&x[t(905)]!==T0.OK&&x[t(905)]!=="OK")}const vt=(x,t)=>{const e=o;if(!x)return{date:"",time:""};const s=new Date(x),i=s[e(521)]()[e(627)]("T")[0];switch(t){case Jt.ZH_CN:return{date:tt(i,t),time:s[e(760)]()+":"+String(s[e(942)]())[e(901)](2,"0")};default:return{date:tt(i,t),time:s[e(760)]()+":"+s[e(942)]()}}},vr=(x,t)=>{const e=o,s=x.user||t.t(e(492));if(x[e(648)][e(861)](r=>r===Re.id)&&x[e(772)]){const r=vt(x.recoverTime,t[e(767)]()),c=r.date+" "+r.time;return s+" "+t.t(e(634))+" "+c+" "+t.t(e(575))}const i=mr(x),n=i[e(618)]===1?t.t(i[0]):""+t.t(i[0])+t.t(e(638));return s+" "+n};function mr(x){const t=o;if(x[t(648)][t(618)]===0)return[""];const e=t(837),s=e+t(924),i=[{id:$x.id,action:e+"createSheet"},{id:Re.id,action:e+t(569)},{id:ox.id,action:e+t(750)},{id:cx.id,action:e+t(933)},{id:mi.id,action:e+t(755)},{id:Ex.id,action:e+"setFilter"},{id:fx.id,action:e+t(735)},{id:Ki.id,action:e+"setDV"},{id:bx.id,action:e+t(791)},{id:Ji.id,action:e+t(791)},{id:Si.id,action:e+t(908)},{id:lx.id,action:e+t(908)},{id:Hx.id,action:e+t(633)},{id:gi.id,action:e+"deleteProtection"},{id:pi.id,action:e+t(921)}].filter(n=>x[t(648)][t(620)](n.id));return i!=null&&i[t(618)]?i.map(n=>n[t(683)]):[s]}function tt(x,t){const e=o,[s,i,n]=new Date().toISOString()[e(627)]("T")[0][e(627)]("-"),[r,c,l]=x[e(627)]("-"),h=s===r&&i===c&&n===l;let d="",u="",b="";switch(t){case Jt.ZH_CN:return h?"":(d=s===r?"":r+"",u=c+"",b=l+"",""+d+u+b);default:return h?e(534):(d=s===r?"":r+"-",u=c+"-",b=""+l,""+d+u+b)}}function Sr(x){return x?x.reduce((t,e)=>{const s=te,i=new Date(e[s(717)])[s(521)]()[s(627)]("T")[0];return t[s(618)]>0&&t[t.length-1][s(799)]===i?t[t[s(618)]-1][s(752)][s(869)](e):t[s(869)]({dateString:i,versions:[e]}),t},[]):[]}var gr=(x,t,e,s)=>{const i=o;for(var n=t,r=x[i(618)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},ie=(x,t)=>(e,s)=>t(e,s,x);const pr=o(522);let r0=class extends R{constructor(t,e,s,i,n,r,c){const l=o;super(),C(this,"_workbookDataCache",new Map),this._snapshotServerService=t,this._univerInstanceService=e,this[l(804)]=s,this[l(695)]=i,this[l(551)]=n,this[l(848)]=r,this[l(807)]=c}dispose(){const t=o;this[t(802)][t(625)](),super[t(491)]()}async[o(591)](t,e){const s=o,i=this[s(867)]()+"/"+t+s(537)+(e?"&lastLabel="+e:"");try{const n=(await this[s(551)].get(i)).body;if(n&&n[s(749)]&&n.error.code===T0.OK){const{hasMore:r,lastLabel:c}=n,l=Cr(n),h=n[s(626)][s(650)];return{hasMore:r,lastLabel:c,versions:l,members:h}}}catch(n){console[s(749)](n)}return null}[o(867)](){const t=o;var e;const s=this[t(695)][t(677)](Cx);return(e=s==null?void 0:s[t(862)])!=null?e:pr}async loadSheet(t,e,s){const i=o;var n,r;s===void 0&&(s={}),this[i(802)][i(517)](t)||this[i(802)][i(506)](t,new Map);const{snapshot:c,changesets:l,error:h}=await this._snapshotServerService[i(516)](s,{unitID:t,type:n0.UNIVER_SHEET,revision:e});if(Ir(h)||!c||!c.workbook)throw new Error(i(671));const d=(n=l==null?void 0:l[i(618)])!=null?n:0;if(e!==0&&c[i(524)]+d!==e)throw new Error(i(531));const{workbook:u}=c,b=u[i(801)]?Object[i(669)](u[i(801)])[i(789)](([S,g])=>{const p=i;var N,U;return(U=(N=g[p(579)])==null?void 0:N.map(M=>M))!=null?U:[]})[i(652)]():[],I=(await Promise.all(b.map(S=>this[i(824)][i(814)](s,{unitID:t,type:n0[i(567)],blockID:S})[i(515)](g=>g.block))))[i(694)](S=>!!S),v=kx(c,I);return(r=this._workbookDataCache[i(878)](t))==null||r.set(e,{workbook:v}),new Promise(S=>{const g=i,p=this[g(508)][g(703)](P[g(567)]);p?(this[g(508)][g(923)](p[g(595)]()),setTimeout(()=>{this[g(790)](v,l),this._sheetPermissionInitController.refreshRangeProtectPermission(),S(!0)},0)):(this[g(790)](v,l),S(!0))})}[o(790)](t,e){const s=o,i=this[s(508)][s(726)](P[s(567)],t);this[s(508)][s(928)](i.getUnitId());const n=this[s(848)][s(874)][s(503)](this[s(848)][s(874)].getInterceptPoints()[s(580)]);return e==null||e[s(556)](r=>{const c=s,l=r[c(687)][c(789)](h=>({id:h.id,params:JSON.parse(h[c(543)])}));({...r,mutations:n(l,null)||l})[c(687)][c(556)](h=>{const d=c;this[d(804)][d(787)](h.id)&&this._commandService.syncExecuteCommand(h.id,h.params)})}),i}};r0=gr([ie(0,E0),ie(1,F),ie(2,Z),ie(3,W),ie(4,_(p0)),ie(5,_(Fx)),ie(6,_(Ti))],r0);function Cr(x){const t=o;var e,s;const i=[],{entities:n,historyIds:r}=x,{datas:c,users:l}=n;for(const h of r)if(c[h]){const d=!!((e=l[c[h][t(858)]])!=null&&e[t(635)]);i[t(869)]({unitId:c[h][t(784)],user:d?"":((s=l==null?void 0:l[c[h][t(858)]])==null?void 0:s.name)||"",isAnonymous:d,id:h,time:c[h][t(841)]?Number(c[h][t(841)]):void 0,commands:c[h][t(887)],startRev:Number(c[h][t(672)]),endRev:Number(c[h].endRevision),recoverTime:c[h][t(772)]?Number(c[h][t(772)]):void 0})}return i}var Tr=(x,t,e,s)=>{const i=o;for(var n=t,r=x[i(618)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},He=(x,t)=>(e,s)=>t(e,s,x),_e=(x=>(x[o(689)]=o(761),x[o(883)]="exited",x[o(785)]=o(749),x))(_e||{}),Ee=(x=>(x[o(661)]=o(866),x[o(904)]=o(889),x[o(763)]=o(498),x))(Ee||{});const Nr=o(857);let $=class extends R{constructor(t,e,s,i){const n=o;super(),C(this,"_versions$",new D([])),C(this,n(563),this._versions$[n(927)]()),C(this,n(940),new D("")),C(this,"currentVersion$",this[n(940)].asObservable()),C(this,n(589),new D("entered")),C(this,n(649),this[n(589)][n(927)]()),C(this,n(778),new D(0)),C(this,n(842),this[n(778)][n(927)]()),C(this,n(817),new D("")),C(this,n(667),this._unitId$.asObservable()),C(this,n(612),!1),C(this,"_loadingState$",new D(n(866))),C(this,n(707),this[n(739)][n(927)]()),C(this,n(593),null),C(this,n(674),!0),C(this,n(740),new Map),C(this,n(840)),C(this,n(922)),C(this,"_maskElement"),C(this,n(660),!1),this[n(544)]=t,this[n(615)]=e,this[n(907)]=s,this[n(640)]=i}async[o(698)](t,e,s){const i=o;this[i(840)]=e,this[i(660)]=s,this[i(817)][i(830)](t),this[i(612)]=!0;const n=await this[i(640)][i(591)](t);if(this[i(612)]=!1,n){const{versions:r,lastLabel:c,hasMore:l,members:h}=n;r[i(618)]===0&&r.push({unitId:t,id:Nr,startRev:1,endRev:0,time:Date[i(727)](),user:this._localeService.t("editHistory.panel.currentUser"),commands:[],isAnonymous:!1}),this._updateVersions(r,l,c,h),this._currentVersion$[i(830)](r[0].id)}else this[i(589)][i(830)]("error")}async[o(651)](){const t=o;if(!this[t(593)]||!this[t(674)]||this[t(612)])return!1;this[t(612)]=!0;const e=await this[t(640)][t(591)](this[t(784)],this[t(593)]);if(this[t(612)]=!1,e){const{versions:s,lastLabel:i,hasMore:n,members:r}=e;this[t(565)](s,n,i,r)}else this[t(544)][t(931)]({content:this[t(907)].t("editHistory.panel.listFetchError"),type:w[t(785)],duration:3e3});return!0}async[o(636)](t){const e=o;var s;const i=(s=this._versions$[e(792)])==null?void 0:s.find(r=>r.id===t),{endRev:n}=i||{};n||n===0?(this[e(739)][e(830)]("loading"),await this[e(640)][e(831)](this[e(784)],n),this[e(739)][e(830)](e(498))):this[e(589)][e(830)](e(749))}async[o(708)](t){const e=o,s=t?this.getVersion(t):this[e(527)]();if(!s)return;const i=s[e(510)],n=vt(s[e(717)],this[e(907)][e(767)]());await this._confirmService[e(495)]({id:e(704),title:{title:this._localeService.t(e(533))},children:{title:this._localeService.t(e(859))+e(574)+n[e(644)]+" "+n[e(717)]+")"},cancelText:this[e(907)].t(e(906)),confirmText:this[e(907)].t(e(602))})&&this[e(778)][e(830)](i)}_updateVersions(t,e,s,i){const n=o;this[n(666)][n(830)](this[n(666)][n(792)].concat(t)),this[n(674)]=e,this[n(593)]=s,i&&Object[n(736)](i)[n(556)](r=>this[n(740)][n(506)](r,i[r]))}[o(527)](){const t=o;return this[t(713)](this[t(940)][t(792)])}[o(713)](t){const e=o;var s;return(s=this[e(666)][e(792)])==null?void 0:s[e(647)](i=>i.id===t)}[o(759)](t){return this[o(740)].get(t)}[o(596)](){const t=o;this[t(529)]=document.createElement(t(827)),this[t(529)][t(780)]=t(941),this[t(529)].style[t(754)]="absolute",this[t(529)][t(888)].top="0",this[t(529)][t(888)][t(613)]="0",this[t(529)][t(888)].width=t(701),this[t(529)][t(888)].height=t(701),this[t(529)][t(888)][t(547)]="rgba(225, 225, 225, 0.5)",this[t(529)].style.color=t(783),this._maskElement[t(888)][t(621)]=t(561),this[t(529)][t(888)][t(884)]=t(557),this[t(529)].style.zIndex=t(721),this._maskElement.style[t(621)]="none",this[t(922)][t(825)](this._maskElement)}[o(879)](){const t=o;var e;const s=(e=document[t(497)](this[t(840)]))==null?void 0:e[t(872)](t(808));s&&(this._maskContainer=s,this[t(596)]())}[o(775)](){const t=o;this[t(922)]||this._initMaskContainer(),this[t(529)]&&(this[t(529)].style[t(621)]=t(561))}[o(608)](){const t=o;this[t(529)]&&(this._maskElement[t(888)][t(621)]="none")}set[o(851)](t){const e=o;this[e(589)][e(830)](t)}set[o(663)](t){const e=o;t!==this._currentVersion$[e(792)]&&this[e(940)][e(830)](t)}get[o(663)](){const t=o;return this._currentVersion$[t(792)]}set[o(784)](t){this[o(817)].next(t)}get unitId(){const t=o;return this[t(817)][t(792)]}get canRevert(){return this[o(660)]}get loadingState(){const t=o;return this[t(739)][t(792)]}};$=Tr([He(0,oe),He(1,Ni),He(2,_(y)),He(3,_(r0))],$);function N0({ref:x,...t}){const e=o,{icon:s,id:i,className:n,extend:r,...c}=t,l=("univerjs-icon univerjs-icon-"+i+" "+(n||""))[e(819)](),h=T.useRef("_"+Ur());return Tx(s,""+i,{defIds:s[e(834)],idSuffix:h[e(877)]},{ref:x,className:l,...c},r)}function Tx(x,t,e,s,i){const n=o;return T.createElement(x.tag,{key:t,...Or(x,e,i),...s},(Rr(x,e)[n(656)]||[])[n(789)]((r,c)=>Tx(r,t+"-"+x.tag+"-"+c,e,void 0,i)))}function Or(x,t,e){const s=o,i={...x.attrs};e!=null&&e[s(796)]&&i[s(617)]==="colorChannel1"&&(i[s(617)]=e[s(796)]),x[s(926)]===s(552)&&i.id&&(i.id=i.id+t[s(886)]),Object.entries(i)[s(556)](([r,c])=>{const l=s;r===l(552)&&typeof c=="string"&&(i[r]=c[l(929)](/url\(#(.*)\)/,l(568)+t.idSuffix+")"))});const{defIds:n}=t;return!n||n[s(618)]===0||(x.tag===s(504)&&i["xlink:href"]&&(i["xlink:href"]=i[s(797)]+t[s(886)]),Object[s(669)](i)[s(556)](([r,c])=>{const l=s;typeof c==l(679)&&(i[r]=c[l(929)](/url\(#(.*)\)/,l(568)+t.idSuffix+")"))})),i}function Rr(x,t){const e=o;var s;const{defIds:i}=t;return!i||i.length===0?x:x.tag==="defs"&&(s=x[e(656)])!=null&&s[e(618)]?{...x,children:x[e(656)][e(789)](n=>typeof n[e(675)].id==e(679)&&i&&i[e(620)](n[e(675)].id)?{...n,attrs:{...n.attrs,id:n[e(675)].id+t[e(886)]}}:n)}:x}function a0(){const x=["editHistory.action.revertSheetSuffix","_diffRangesMap","Print","APPLY_PERMISSION_DENIED","blocks","COMPRESS_MUTATION_APPLY","editHistory.panel.revertDesc","getVpScrollXYInfoByPosToVp","subUnitId","_lastPointer","MoveWorksheet","_initRender","FromArray","rules","_status$","univer-text-sm univer-leading-5 univer-text-gray-500 dark:!univer-text-gray-300","getVersions","Duplicate","_lastLabel","getDialogs$","getUnitId","_createMask","subscribe","_sidebarDisposable","LICENSE_IMPORT_SIZE_EXCEEDED","ENTITLE_CAN_NOT_BUY_LOWER_OTP","_renderManagerService","editHistory.panel.confirm","params","YUUMI_RATE_OVER_LIMIT","url(#restore-icon_clip0_1247_2)","setState","register","hideMask","_transformMutationByOrder","_getSheetObject","_permissionService","_fetching","left","REDEMPTION_CODE_FULLY_REDEEMED","_confirmService","YUUMI_SUBSCRIPTION_NOT_FOUND","fill","length","onSteady","includes","display","univer-flex univer-h-12 univer-cursor-default univer-items-center","View","currentSkeleton$","clear","entities","split","LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED","permissionPointUpdate$","DeleteRow","CreateSheet","DeleteSheet","addSparkline","editHistory.action.revertSheetPrefix","anonymous","triggerLoadSheet","DeleteColumn","editHistory.action.etc","substring","_historyFetchService","PY_RUNTIME_SCRIPT_ERROR","_injector","name","date","startColumn","CHANGESET_REVISION_CONFILICT","find","commands","status$","users","loadMoreVersions","flat","9658020RATEoB","univer-flex univer-flex-1 univer-items-center univer-justify-center","open","children","172013flCiJx","_diffs","RenameSheet","_canRevert","Init","scrollEvent$","currentVersion","univer-flex univer-flex-1 univer-items-center univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200","CreateWorksheet","_versions$","unitId$","getOwnPropertyDescriptor","entries","_transformService","[HistoryFetchService]: request snapshot error!","startRevision","LICENSE_DISTRO_REJECTED","_hasMore","attrs","column","getConfig","Filter","string","RenameWorksheet","add","stopPropagation","action","APPLY_DUPLICATED","VIEW_MAIN","univer-flex univer-h-7 univer-w-full univer-items-center univer-justify-center","mutations","_versionDiffService","Entered","top","onMouseMove","REDEMPTION_CODE_INACTIVE","disposeWithMe","filter","_configService","_updateDiffMarks","EditWorksheetCell","triggerLoadVersions","SelectProtectedCells","40xeHEUL","100%","INVALID_ARGUMENT","getCurrentUnitForType","confirm-revert-revision","registerRenderModule","univer-ml-2 univer-flex univer-h-5 univer-items-center univer-justify-center univer-rounded univer-border univer-border-primary-600 univer-bg-primary-50 univer-px-1.5 univer-text-xs univer-text-primary-600","loadingState$","triggerRevert","state$","PivotTable","skeleton","YUUMI_AI_RUN_FAILED","getVersion","INVITE_CODE_ALREADY_BOUND","ensureVersion","onRendered","time","UNRECOGNIZED","0 0 16 16","getDataRange","1000","univer-h-full univer-space-y-2 univer-overflow-auto univer-pb-4","YUUMI_NO_CUBOID_FOR_QUESTION","MOBILE_HAS_BEEN_BOUND","0 0 16 17","createUnit","now","InsertColumn","CURRENT_STATUS_CANNOT_OPERATE","univer-ml-2.5 univer-flex univer-size-8 univer-cursor-pointer univer-items-center univer-justify-center univer-rounded","USER_IS_ANONYMOUS","APPLY_NON_SEQUENTIAL_REVISION","280jTSyFy","ViewFilter","setDV","keys","YUUMI_PROMPT_MAX_TOKENS_EXCEEDED","PERMISSION_DENIED","_loadingState$","_members","restore-icon_clip0_1247_2","_dialogOptions$","sheetId","editHistory.header.revert","onStarting","univer-flex univer-size-6 univer-items-center univer-justify-center univer-rounded univer-text-gray-400 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700","_combineRanges","transformMutations","error","insertSheet","none","versions","pipe","position","setFrozen","USER_NOT_FOUND","SNAPSHOT_INVALID_SNAPSHOT","History","getMember","getHours","entered","m1Prime","Loaded","rule","#0B9EFB","FloatImg","getCurrentLocale","history-panel","Comment","merge","UNIVER_UNKNOWN","recoverTime","_initActiveSwitch","PAYMENT_CHANNEL_NOT_SUPPORT","showMask","Sort","changesets","_revertRevision$","AUTHORIZE_CODE_ILLEGAL","className","subType","editHistory.info.loading","white","unitId","Error","HideWorksheet","hasCommand","_sidebarService","map","_createUnit","setCF","value","currentColor","sheet","Delete","colorChannel1","xlink:href","_openPanel","dateString","RecoverHistory","blockMeta","_workbookDataCache","51QURDVB","_commandService","editHistory.panel.title","_config","_sheetPermissionInitController",".univer-app-container-content","APPLY_REJECT","YUUMI_ALL_TABLES_IS_INVALID","UNDEFINED","univer-m-auto univer-animate-spin","RwHgtClWdt","getDeserializedSheetBlock","Export","RestoreIcon","_unitId$","closeAll","trim","2gSotxP","endRow","hidden","SetCellValue","_snapshotServerService","append","YUUMI_CONNECTOR_URL_NOT_FOUND","div","_removeDiffMarks","evenodd","next","loadSheet","_getActiveSubUnitId","rgba(58, 96, 247, 0.20)","defIds","SNAPSHOT_HAS_BEEN_REMOVED","COMPLETION_FINISHED","editHistory.action.","LICENSE_EXPORT_SIZE_EXCEEDED","ranges","_historyContainerId","createTime","revertRevision$","LOGIN_TOKEN_PROCESSING_FAILED","range","pluginName","ENTITLE_REPORT_LIMIT_EXCEED","CONNECTOR_DATA_TOO_LARGE","_compressMutationService","ViewHistory","http://www.w3.org/2000/svg","status","M8.79993 14.0166C8.79993 14.4585 8.44176 14.8166 7.99993 14.8166C4.23529 14.8166 1.18345 11.7648 1.18345 8.00017C1.18345 4.23554 4.23529 1.18369 7.99993 1.1837C11.7646 1.1837 14.8164 4.23554 14.8164 8.00017C14.8164 8.442 14.4582 8.80017 14.0164 8.80017C13.5746 8.80017 13.2164 8.442 13.2164 8.00017C13.2164 5.11919 10.8809 2.7837 7.99993 2.7837C5.11895 2.7837 2.78345 5.11919 2.78345 8.00017C2.78345 10.8812 5.11895 13.2166 7.99993 13.2166C8.44176 13.2166 8.79993 13.5748 8.79993 14.0166Z","ENTITLE_NEED_BILLING_ADDRESS","ViemRwHgtClWdt","endColumn","UNIVER_PROJECT","VIRTUAL_VERSION_NOW","userId","editHistory.panel.revertConfirmText","bottom","some","historyListServerUrl","setValue","toString","_componentManager","init","_getAPIPrefix","USER_NOT_INVITED_CODE","push","M2.06678 3.37926C2.0668 1.94333 3.23085 0.779297 4.66678 0.779297H9.44256C10.1796 0.779297 10.8821 1.09213 11.3751 1.63999L13.2659 3.74079C13.6955 4.21822 13.9333 4.83779 13.9333 5.4801V12.7126C13.9333 14.1486 12.7692 15.3126 11.3333 15.3126H4.66665C3.2307 15.3126 2.06663 14.1486 2.06665 12.7126L2.06678 3.37926ZM4.66678 1.9793C3.89359 1.9793 3.26679 2.60609 3.26678 3.37928L3.26665 12.7126C3.26664 13.4858 3.89344 14.1126 4.66665 14.1126H11.3333C12.1065 14.1126 12.7333 13.4858 12.7333 12.7126V5.4801C12.7333 5.44882 12.7322 5.41764 12.7302 5.3866H10.7985C9.91488 5.3866 9.19853 4.67026 9.19853 3.78661V1.9793H4.66678ZM10.4832 2.44275L12.0526 4.1866H10.7985C10.5776 4.1866 10.3985 4.00752 10.3985 3.78661V2.35649C10.4279 2.38389 10.4561 2.41266 10.4832 2.44275Z","defs","querySelector","UNIVER_DOC","interceptor","getCurrent","active","current","get","_initMaskContainer","ENTITLE_CHAT_LIMIT_EXCEED","SetCellStyle","YUUMI_URL_COL_OUT_OF_RANGE","Exited","justifyContent","1333444IklExx","idSuffix","command","style","loading","TOO_MANY_REQUESTS","APPLY_REVISION_CONFILICT","getViewport","univer-text-gray-500","INVALID_INVITE_CODE","3136610fqHsKT","displayName","_initPanel","InsertRow","INTERNAL_ERROR","addObjects","padStart","DeleteWorksheet","_uiPartsService","Loading","code","editHistory.panel.cancel","_localeService","addProtection","YUUMI_TABLE_NOT_FOUND_IN_UNIT","REDEMPTION_INVALID_CODE","span","from","Share","values","EditExtraObject","_sheetSkeletonManagerService","Copy","svg","EMAIL_HAS_BEEN_BOUND","ENTITLE_UPDOWN_GRADE_NOT_SUPPORT","deleteProtection","_maskContainer","disposeUnit","editSheet","REDEMPTION_CODE_NOT_STARTED","tag","asObservable","focusUnit","replace","InsertHyperlink","show","onPointerMove$","removeSheet","UniverIcon","UNIVER_SLIDE","_extractRanges","LICENSE_MAX_UNITS_EXCEEDED","REDEMPTION_USER_NOT_ELIGIBLE","assign","_currentVersion$","history-mask","getMinutes","INVITE_CODE_HAS_BEEN_UES","getCellPositionByOffset","dispose","editHistory.panel.unknownUser","_init","close","confirm","Edit","getElementById","loaded","_cellEditorManagerService","CreatePermissionObject","_historyManagerService","11066484JoGYuU","fetchThroughInterceptors","use","M6.42416 4.42417C6.65847 4.18985 6.65847 3.80995 6.42416 3.57564C6.18984 3.34132 5.80994 3.34132 5.57563 3.57564L1.57564 7.57564C1.34132 7.80995 1.34132 8.18985 1.57564 8.42417L5.57563 12.4242C5.80994 12.6585 6.18984 12.6585 6.42416 12.4242C6.65847 12.1899 6.65847 11.81 6.42416 11.5756L3.44843 8.5999H14C14.3314 8.5999 14.6 8.33127 14.6 7.9999C14.6 7.66853 14.3314 7.3999 14 7.3999H3.44843L6.42416 4.42417Z","set","29244zlYDKj","_univerInstanceService","LOGIN_FAILED","endRev","_currentVersionDiff$","clipPath","HideSheet","canRevert","then","getUnitOnRev","has","ENTITLE_DUP_SUBSCRIPTION","1em","_context","toISOString","/universer-api/history","UNAUTHENTICATED","rev","ENSURE_SNAPSHOT_EXECUTION","setConfig","getCurrentVersion","YUUMI_UNABLE_LOAD_URL","_maskElement","EMAIL_VERIFY_CODE_MISMATCH","[HistoryFetchService]: wrong rev from the server!","YUUMI_ASYNCIO_CANCELLED","editHistory.panel.revertConfirm","Today","univer-text-2xl dark:!univer-text-white","back-icon","/list?length=20","NOT_FOUND","restore-icon","117704ubCBZf","univer-flex univer-items-center univer-justify-center","DATA_SOURCE_TOO_LARGE","data","_messageService","path","cellValue","backgroundColor","univer-animate-spin","memberId","MOBILE_VERIFY_CODE_MISMATCH","_httpService","mask","MOBILE_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","updatePermissionPoint","currentVersionDiff$","forEach","center","18MSYyjs","SetColumnStyle","SetWorksheetStyle","flex","forValue","versions$","startRow","_updateVersions","subscribeEvent","UNIVER_SHEET","url(#$1","revertSheet","ERROR_AGAIN","MoveSheet","SetRowStyle","SelectUnProtectedCells",": ("];return a0=function(){return x},a0()}function Ur(){const x=o;return Math.random()[x(864)](36)[x(639)](2,8)}N0[o(896)]=o(934);const Dr={tag:"svg",attrs:{xmlns:o(850),fill:o(751),viewBox:"0 0 16 16",width:o(519),height:o(519)},children:[{tag:o(545),attrs:{fill:o(793),d:o(505)}}]},Nx=T.forwardRef(function(x,t){const e=o;return T.createElement(N0,Object[e(939)]({},x,{id:e(536),ref:t,icon:Dr}))});Nx.displayName="BackIcon";const wr={tag:o(918),attrs:{xmlns:o(850),fill:o(751),viewBox:o(725),width:o(519),height:o(519)},children:[{tag:"g",attrs:{fill:"currentColor",clipPath:o(605)},children:[{tag:o(545),attrs:{d:"M7.41252 10.6196C7.64683 10.3852 7.64683 10.0053 7.41252 9.77103L6.77012 9.12863H9.67836C9.89927 9.12863 10.0784 9.30772 10.0784 9.52863V11.1953C10.0784 11.5267 10.347 11.7953 10.6784 11.7953C11.0097 11.7953 11.2784 11.5267 11.2784 11.1953V9.52863C11.2784 8.64497 10.562 7.92863 9.67836 7.92863H6.77012L7.41252 7.28623C7.64683 7.05191 7.64683 6.67201 7.41252 6.4377C7.1782 6.20338 6.79831 6.20338 6.56399 6.4377L4.89732 8.10437C4.66301 8.33868 4.66301 8.71858 4.89732 8.95289L6.56399 10.6196C6.79831 10.8539 7.1782 10.8539 7.41252 10.6196Z"}},{tag:o(545),attrs:{d:o(870),fillRule:"evenodd",clipRule:o(829)}}]},{tag:o(871),attrs:{},children:[{tag:o(512),attrs:{id:o(741)},children:[{tag:"rect",attrs:{width:16,height:16,y:.05,fill:o(783),rx:4}}]}]}],defIds:["restore-icon_clip0_1247_2"]},Ox=T.forwardRef(function(x,t){const e=o;return T.createElement(N0,Object[e(939)]({},x,{id:e(539),ref:t,icon:wr}))});Ox.displayName=o(816);const Lr={tag:o(918),attrs:{xmlns:o(850),fill:"none",viewBox:o(719),width:"1em",height:o(519)},children:[{tag:"path",attrs:{fill:"#0B9EFB",d:o(852),fillOpacity:.2,fillRule:o(829),clipRule:o(829)}},{tag:o(545),attrs:{fill:o(765),d:"M7.20007 1.98384C7.20007 1.54201 7.55824 1.18384 8.00007 1.18384C11.7647 1.18384 14.8165 4.23568 14.8165 8.00032C14.8165 11.765 11.7647 14.8168 8.00007 14.8168C4.23543 14.8168 1.18359 11.765 1.18359 8.00032C1.18359 7.55849 1.54177 7.20031 1.98359 7.20031C2.42542 7.20031 2.78359 7.55849 2.78359 8.00032C2.78359 10.8813 5.11909 13.2168 8.00007 13.2168C10.8811 13.2168 13.2165 10.8813 13.2165 8.00032C13.2165 5.11933 10.8811 2.78384 8.00007 2.78384C7.55824 2.78384 7.20007 2.42567 7.20007 1.98384Z",fillRule:"evenodd",clipRule:o(829)}}]},mt=T.forwardRef(function(x,t){return T.createElement(N0,Object.assign({},x,{id:"loading-multi-icon",ref:t,icon:Lr}))});mt.displayName="LoadingMultiIcon";function Mr(){const x=o;var t;const e=ee($),s=ee(y),i=T.useCallback(()=>{const d=te;e[d(851)]=_e[d(883)]},[e]),n=T.useCallback(()=>{e[te(708)]()},[e]),r=De(e.currentVersion$),c=De(e[x(563)]),l=r===((t=c==null?void 0:c[0])==null?void 0:t.id),h=r!==""&&!l&&e[x(514)];return m.jsxs(x(827),{className:at(x(622),rs),children:[m.jsx("a",{className:x(730),role:"button",onClick:i,children:m.jsx(Nx,{className:x(535)})}),m.jsx(x(827),{className:x(654),children:h&&m.jsx(ns,{variant:"primary",onClick:n,children:s.t(x(744))})})]})}Object[o(668)];var yr=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},he=(x,t)=>(e,s)=>t(e,s,x);let o0=class extends R{constructor(t,e,s,i,n,r){const c=o;super(),this[c(611)]=t,this[c(903)]=e,this[c(544)]=s,this[c(907)]=i,this[c(501)]=n,this._injector=r,this[c(493)]()}[o(493)](){const t=o;this[t(693)](this[t(501)].currentVersion$[t(597)](e=>{const s=t;e&&this[s(501)][s(636)](e)})),this[t(693)](this._permissionService[t(629)][t(597)](e=>{const s=t,i=this[s(501)][s(784)];i&&(e[s(781)]===ne[s(496)]&&e[s(792)]===!0&&this[s(611)][s(554)](new Ne(i).id,!1),e[s(781)]===ne[s(659)]&&e[s(792)]===!0&&this._permissionService[s(554)](new xi(i).id,!1),e[s(781)]===ne[s(571)]&&e[s(792)]===!0&&this[s(611)][s(554)](new si(i).id,!1),e[s(781)]===ne[s(513)]&&e[s(792)]===!0&&this[s(611)].updatePermissionPoint(new ii(i).id,!1),e[s(781)]===ne[s(769)]&&e[s(792)]===!0&&this[s(611)][s(554)](new Ne(i).id,!1),e[s(781)]===ne.FloatImg&&e.value===!0&&this._permissionService.updatePermissionPoint(new Ne(i).id,!1))})),this.disposeWithMe(this[t(903)].registerComponent(qt.HEADER,()=>Qt(Mr,this[t(642)]))),this[t(693)](this[t(501)][t(707)][t(597)](e=>{const s=t;e===Ee.Loading&&(this[s(501)][s(775)](),this._messageService[s(931)]({type:w.Info,content:this._localeService.t(s(782))})),e===Ee[s(763)]&&this[s(501)][s(608)]()}))}};o0=yr([he(0,zt),he(1,nx),he(2,oe),he(3,_(y)),he(4,_($)),he(5,_(H))],o0);Object[o(668)];var Ar=(x,t,e,s)=>{const i=o;for(var n=t,r=x[i(618)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},V0=(x,t)=>(e,s)=>t(e,s,x);let Le=class extends R{constructor(t,e,s){const i=o;super(),C(this,i(576),new Map),C(this,i(511),new D({ranges:new Map,active:null})),C(this,i(555),this[i(511)][i(927)]()),this[i(501)]=t,this._transformService=e,this._snapshotServerService=s,this._init()}_init(){const t=o;this[t(576)]=new Map,this.disposeWithMe(this[t(501)][t(667)][t(597)](e=>{const s=t;e&&!this._diffRangesMap[s(517)](e)&&this._diffRangesMap[s(506)](e,new Map)})),this[t(693)](this[t(501)].currentVersion$.subscribe(async e=>{const s=t;var i;e&&(await this[s(715)](e),this._currentVersionDiff$[s(830)](((i=this._diffRangesMap[s(878)](this[s(501)].unitId))==null?void 0:i[s(878)](e))||{ranges:new Map,active:null}))}))}async[o(715)](t){const e=o;var s,i;const n=this[e(501)][e(713)](t),r=this._historyManagerService[e(784)];if(!n||!r)return;const c=this[e(576)][e(878)](r);if(c||this[e(576)].set(r,new Map),(s=this[e(576)][e(878)](r))!=null&&s.has(n.id))return;const{startRev:l,endRev:h}=n;if(l===1){c[e(506)](n.id,{ranges:new Map,active:null});return}const d=l-1,u=h,b=await this[e(824)].fetchMissingChangesets({},{unitID:r,from:d,to:u,type:n0[e(567)]});if(((i=b[e(749)])==null?void 0:i[e(905)])===T0.OK){const I=b[e(777)][e(789)](p=>((p.mutations===null||p[e(687)]===void 0)&&(p[e(687)]=[]),Ax(p))).map(p=>p[e(687)][e(789)](N=>({...N,params:{...N[e(603)],memberId:p.userID}})))[e(652)](),v=this[e(609)](I),S=this._getActiveSubUnitId(I),g=this[e(936)](v);c.set(n.id,{ranges:g,active:S})}}_transformMutationByOrder(t){const e=o;let s=[];for(let i=0;i<t[e(618)];i++){const n=t[i];if(s[e(869)](n),i!==t.length-1){const r=t[i+1],c=this[e(670)][e(748)](s,[r]);Px(c)?s=c[e(762)]:s=[]}}return s}[o(832)](t){const e=o;let s=[];return t.forEach(i=>{const n=te;if(i.id===ox.id){const r=i.params;s[n(869)](r[n(794)].id)}else if(i.id===cx.id){const r=i[n(603)];s[n(618)]>0&&(s=s[n(694)](c=>c!==r[n(583)]))}else if(i.id===ni.id){const r=i.params;r[n(822)]?s=s[n(694)](c=>c!==r.subUnitId):s.push(r[n(583)])}else{const r=i[n(603)];r[n(583)]&&s[n(869)](r[n(583)])}}),s[e(618)]>0?s[s.length-1]:null}[o(936)](t){const e=o,s=new Map;return t[e(556)](i=>{const n=e;var r,c;const l=(r=i[n(603)])==null?void 0:r[n(549)];if(l){s[n(517)](l)||s[n(506)](l,[]);const h=this._getRangesByMutation(i);(c=s[n(878)](l))==null||c[n(869)](...h)}}),s.forEach((i,n)=>{s[e(506)](n,this._combineRanges(i))}),s}_getRangesByMutation(t){const e=o;switch(t.id){case lx.id:{const s=t[e(603)];return s[e(588)][e(789)](i=>i[e(839)][e(789)](n=>({range:n,unitId:s.unitId,subUnitId:s[e(583)]})))[e(652)]()}case bi.id:{const s=t[e(603)];return s.ranges[e(789)](i=>({range:i,unitId:s[e(784)],subUnitId:s[e(583)]}))}case fi.id:{const s=t[e(603)];return[{range:s.range,unitId:s.unitId,subUnitId:s.subUnitId}]}case _i.id:{const s=t.params;return[{range:s.range,unitId:s.unitId,subUnitId:s[e(583)]}]}case ui.id:{const s=t.params,{from:i,to:n,unitId:r}=s;return[{range:Pt(i[e(792)]),unitId:r,subUnitId:i[e(583)]},{range:Pt(n[e(792)]),unitId:r,subUnitId:n[e(583)]}]}case di.id:{const s=t.params,{unitId:i,subUnitId:n,sourceRange:r,targetRange:c}=s,l=r[e(821)]-r[e(564)]+1;return[{range:c.startRow<=r[e(564)]?c:{...c,startRow:c[e(564)]-l,endRow:c.endRow-l},unitId:i,subUnitId:n}]}case hi.id:{const s=t[e(603)],{unitId:i,subUnitId:n,sourceRange:r,targetRange:c}=s,l=r[e(855)]-r[e(645)]+1;return[{range:c[e(645)]<=r[e(645)]?c:{...c,startColumn:c[e(645)]-l,endColumn:c[e(855)]-l},unitId:i,subUnitId:n}]}case li.id:{const s=t[e(603)],{values:i,unitId:n,subUnitId:r}=s;return Object[e(914)](i).map(c=>c.ranges[e(789)](l=>({range:l,unitId:n,subUnitId:r}))).flat()}case ci.id:{const s=t[e(603)],{ranges:i,unitId:n,subUnitId:r}=s;return i.map(c=>({range:c,unitId:n,subUnitId:r}))}case oi.id:{const s=t[e(603)],{unitId:i,subUnitId:n,range:r}=s;return[{range:r,unitId:i,subUnitId:n}]}case ai.id:{const s=t[e(603)];return s[e(764)][e(839)][e(789)](i=>({range:i,unitId:s[e(784)],subUnitId:s[e(583)]}))}case ri.id:{const s=t[e(603)];return s[e(546)]?Pr(s[e(546)]).map(i=>({range:i,unitId:s[e(784)],subUnitId:s[e(583)]})):[]}case Ex.id:{const s=t[e(603)];return[{range:s[e(844)],unitId:s[e(784)],subUnitId:s[e(583)]}]}case fx.id:{const s=t[e(603)];return(Array.isArray(s[e(764)])?s[e(764)]:[s[e(764)]])[e(789)](i=>i[e(839)][e(789)](n=>({range:n,unitId:s.unitId,subUnitId:s[e(583)]}))).flat()}case bx.id:{const s=t[e(603)];return s[e(764)].ranges[e(789)](i=>({range:i,unitId:s[e(784)],subUnitId:s[e(583)]}))}default:return[]}}[o(747)](t){const e=o;if(t[e(618)]<=1)return t;const s=new Map;return t[e(556)](i=>{const n=e;var r;const{unitId:c,subUnitId:l}=i,h=c+"-"+l;s[n(517)](h)?(r=s[n(878)](h))==null||r[n(869)](i):s.set(h,[i])}),Array[e(912)](s[e(914)]())[e(789)](i=>new Ei()[e(681)](...i[e(789)](n=>n[e(844)]))[e(770)]()[e(789)](n=>({range:n,unitId:i[0][e(784)],subUnitId:i[0][e(583)]})))[e(652)]()}};Le=Ar([V0(0,_($)),V0(1,ye),V0(2,E0)],Le);function Pt(x){const t=o;return new W0(x)[t(720)]()}function Pr(x){const t=o,e=new W0(x),s=new W0;return e[t(562)]((i,n)=>{s[t(863)](i,n,1)}),vi(s)}Object[o(668)];var kr=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},de=(x,t)=>(e,s)=>t(e,s,x);let xt=class extends R{constructor(x,t,e,s,i,n,r){const c=o;super(),C(this,c(658),new Set),C(this,c(584),null),this[c(520)]=x,this[c(501)]=t,this._versionDiffService=e,this[c(508)]=s,this[c(601)]=i,this._sheetSkeletonManagerService=n,this._commandService=r,this._init()}_init(){const x=o;this[x(586)](),this[x(773)]()}[o(586)](){const x=o;this[x(693)](m0([this[x(501)][x(707)],this[x(916)][x(624)]])[x(753)](fe(([t,e])=>{const s=x;if(t===Ee.Loaded&&e){const i=e[s(743)];return this[s(688)][s(555)][s(753)](lt(n=>{const r=s,c=new Map;return n[r(839)][r(556)]((l,h)=>{const d=r,u=l[d(694)](b=>b[d(583)]===i);c[d(506)](h,u)}),{skeleton:e,diffs:c}}))}return Ge({skeleton:null,diffs:new Map})}))[x(597)](({skeleton:t,diffs:e})=>{this[x(828)](),t&&this._updateDiffMarks(t,e)})),this[x(693)](this._sheetSkeletonManagerService[x(624)][x(597)](t=>{const e=x;if(t==null)return;const{skeleton:s}=t,{scene:i}=this[e(520)];i[e(932)][e(566)](S0(n=>{const r=e;var c,l;const{offsetX:h,offsetY:d}=n,{x:u,y:b}=i.getRelativeToViewportCoord(Xe[r(587)]([h,d])),{scaleX:I,scaleY:v}=i.getAncestorScale(),S=i[r(892)](sx[r(685)]),g=i[r(582)](Xe[r(587)]([u,b]),S),p=s[r(944)](h,d,I,v,g);((c=this[r(584)])==null?void 0:c[r(676)])===p[r(676)]&&((l=this[r(584)])==null?void 0:l.row)===p.row||this[r(658)][r(556)](N=>{N[r(691)](p)})},100))}))}_initActiveSwitch(){const x=o;this[x(693)](this[x(501)].loadingState$[x(597)](t=>{const e=x,s=new dt;return t===Ee[e(763)]&&(s[e(491)](),s[e(681)](this[e(688)][e(555)].subscribe(i=>{const n=e;i[n(876)]&&this[n(804)].executeCommand(Ii.id,{unitId:this[n(520)][n(784)],subUnitId:i[n(876)]})}))),()=>s[e(491)]()}))}[o(696)](x,t){const e=o;var s;const i=(s=this[e(916)][e(875)]())==null?void 0:s[e(711)];if(!i)return;this[e(658)][e(556)](c=>{c.makeDirty()});const{scene:n}=this[e(520)],r=Array.from(t.keys())[e(789)](c=>t.get(c)[e(789)](l=>{const h=e;var d;const{range:u,subUnitId:b,unitId:I}=l,{startColumn:v,startRow:S,endColumn:g,endRow:p}=u,N=Ke(S,v,n,i),U=Ke(p,g,n,i),{columnHeaderHeightAndMarginTop:M}=i,{startX:A,startY:V}=N,{endX:Ie,endY:O0}=U,R0=Ie-A,U0=O0-V,D0={labelPosition:V-M>=20?h(690):h(860),sheetID:b,range:u,color:h(833),fillAfterStrokeEnabled:!0,backgroundColor:h(833),name:((d=this._historyManagerService[h(759)](c))==null?void 0:d[h(643)])||"",selection:I+"-"+b+"-"+u[h(645)]+"-"+u.startRow+"-"+u[h(855)]+"-"+u[h(821)],left:A,top:V,width:R0,height:U0,evented:!1,zIndex:1};return new px("",D0)}))[e(652)]();n[e(900)](r,1),this[e(658)]=new Set(r)}[o(828)](){const x=o;var t;(t=this[x(658)])==null||t.forEach(e=>e[x(491)]())}[o(610)](){const x=o;return ix(this[x(508)],this[x(601)])}};xt=kr([de(1,_($)),de(2,_(Le)),de(3,F),de(4,g0),de(5,_(rx)),de(6,Z)],xt);function $r(){const x=o,t=ee($),e=De(t.versions$),[s,i]=T.useState(!1),n=Sr(e);return e?m.jsx(x(827),{className:"univer-overflow-hidden",children:m.jsxs(x(827),{className:x(722),children:[n[x(789)]((r,c)=>m.jsxs(T.Fragment,{children:[m.jsx(Vr,{date:r[x(799)]}),r[x(752)].map((l,h)=>m.jsx(jr,{index:[c,h],item:l},c+"-"+h))]},r[x(799)])),s&&m.jsx(Hr,{})]})}):m.jsx(Fr,{})}function Hr(){const x=o;return m.jsx(x(827),{className:x(686),children:m.jsx(mt,{className:x(548)})})}function Fr(){const x=o;return m.jsx(x(827),{className:x(541),children:m.jsx(x(911),{className:x(893),children:m.jsx(mt,{className:x(812)})})})}function Vr(x){const t=o,e=ee(y),{date:s}=x;return m.jsx(t(827),{className:"univer-flex univer-items-center univer-gap-2.5 univer-py-1.5 univer-text-sm univer-font-medium",children:tt(s,e[t(767)]())})}function jr(x){const t=o,{item:e,index:s}=x,{time:i,user:n}=e,[r,c]=s,l=ee($),h=De(l.currentVersion$,"",!0)===e.id,d=r===0&&c===0,u=!d&&l[t(514)],b=ee(y),I=b.getCurrentLocale(),v=vt(i,I),S=b.t("editHistory.panel.currentVersion"),g=T.useCallback(N=>{const U=t;l.loadingState!==Ee[U(904)]&&(l.currentVersion=N)},[l]),p=T.useCallback(N=>{l[t(708)](N)},[l]);return m.jsxs("div",{className:at("univer-h-15 univer-flex univer-cursor-pointer univer-flex-col univer-justify-center univer-gap-1 univer-rounded-md univer-px-4 univer-py-1.5 univer-transition-colors hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",{"univer-bg-gray-50 dark:!univer-bg-gray-900":h}),onClick:()=>g(e.id),children:[m.jsxs("div",{className:"univer-flex univer-h-6 univer-w-full univer-justify-between",children:[m.jsxs(t(827),{className:t(664),children:[m.jsx(t(911),{children:v.time}),d&&m.jsx("span",{className:t(706),children:S})]}),m.jsx(t(827),{children:u&&m.jsx(Gt,{title:b.t(t(581)),children:m.jsx(t(827),{onClick:N=>{N[t(682)](),p(e.id)},className:t(746),children:m.jsx(Ox,{})})})})]}),m.jsx(t(827),{className:t(590),children:vr(e,b)})]})}var Br=(x,t,e,s)=>{const i=o;for(var n=t,r=x[i(618)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},Fe=(x,t)=>(e,s)=>t(e,s,x);const kt=o(768);let c0=class extends R{constructor(x,t,e,s){const i=o;super(),C(this,i(598),null),this[i(788)]=x,this[i(865)]=t,this[i(907)]=e,this[i(501)]=s,this[i(493)]()}[o(493)](){const x=o;this[x(897)](),this[x(798)]()}_openPanel(){const x=o;if(this[x(598)])return;const t={header:{title:this[x(907)].t(x(805))},children:{label:kt},onClose:()=>{const e=x;this[e(598)]=null,this._historyManagerService[e(851)]=_e.Exited}};this[x(598)]=this._sidebarService[x(655)]({...t})}[o(897)](){const x=o;this[x(693)](this[x(865)][x(607)](kt,$r)),this[x(693)](this[x(788)][x(662)][x(753)](ht(100))[x(597)](t=>{const e=x,{target:s}=t||{};if(s){const{scrollTop:i,scrollHeight:n,clientHeight:r}=s;i+r>=n-5&&this[e(501)][e(651)]()}}))}};c0=Br([Fe(0,dx),Fe(1,_(ux)),Fe(2,_(y)),Fe(3,_($))],c0);class Yr extends R{constructor(){const t=o;super(),C(this,t(742),new Kt)}[o(655)](){return Ae(()=>{})}[o(494)](){}[o(818)](t){}[o(594)](){const t=o;return this._dialogOptions$[t(927)]()}}var Wr=Object.defineProperty;Object[o(668)];var Gr=(x,t,e)=>t in x?Wr(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,Xr=(x,t,e,s)=>{const i=o;for(var n=t,r=x[i(618)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},j0=(x,t)=>(e,s)=>t(e,s,x),Kr=(x,t,e)=>Gr(x,t+"",e);const Zr="UNIVER_EDIT_HISTORY_VIEWER_PLUGIN";let We=class extends ot{constructor(x=At,t,e,s){const i=o;super(),this._config=x,this[i(642)]=t,this[i(601)]=e,this[i(695)]=s;const{...n}=ct({},At,this[i(806)]);this[i(695)][i(526)](Cx,n)}[o(745)](){const x=o;[[$],[o0],[Le],[r0],[c0],[i0],[E0,{useClass:xs}],[ft,{useClass:Yr}],[_t,{useClass:ss}]][x(556)](t=>this._injector[x(681)](t)),this[x(642)][x(878)](o0)}[o(716)](){const x=o;[[xt]][x(556)](t=>{const e=x;this[e(693)](this[e(601)][e(705)](P[e(567)],t))}),this[x(642)][x(878)](i0),this._injector[x(878)](c0)}[o(619)](){const x=o;this[x(642)][x(878)](Le)}};Kr(We,o(845),Zr),We=Xr([Zt(hx,_x),j0(1,_(H)),j0(2,g0),j0(3,W)],We);const f=h0;(function(x,t){const e=h0,s=x();for(;;)try{if(-parseInt(e(409))/1*(-parseInt(e(374))/2)+parseInt(e(358))/3*(-parseInt(e(425))/4)+parseInt(e(467))/5+parseInt(e(469))/6*(parseInt(e(399))/7)+-parseInt(e(430))/8+-parseInt(e(397))/9+parseInt(e(387))/10===t)break;s.push(s.shift())}catch{s.push(s.shift())}})(l0,727193);var Jr=Object[f(390)],zr=(x,t,e)=>t in x?Jr(x,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):x[t]=e,ae=(x,t,e)=>zr(x,typeof t!="symbol"?t+"":t,e);function l0(){const x=["getCurrentLocale","_commandService","_permissionService","add","display","currentTheme$","status$","exhaustSavingTask"," has been registered.","revertRevision$","attrs","defs","onStarting","dispose","mask","history-container","historyUniver$","show","registerCommand","position","tag","history-icon_clip0_907_281","getElementById","Entered","getOwnPropertyDescriptor","http://www.w3.org/2000/svg","_pluginMap","every","entries","_themeService","block","_disposableCollection","1461lfapGJ","event$","editHistory.panel.listFetchError","data","univerContainerId","get","CHANGESET_ACK","clear","path","dataset","editHistory.panel.revertFailed","includes","zIndex","univer-history-container","_messageService","_revertErrorTimer","2376354pfiNGM","Error","current","OPERATION","UNIVER_CONTAINER_ID","none","closeAll","_init","fill","left","setLocale","unsubscribe","getSheetId","12260150FfMRqZ","xlink:href","edit-history-loader.config","defineProperty","getConfig","historyUniver","UNIVER_EDIT_HISTORY_LOADER_PLUGIN","unMountHistoryContent","registerPlugin","composePermission","2190321EhSzib","UniverIcon","1062509pJBbef","_initPlugins","_injector","_checkCanRevert","getLocales","_sidebarService","defIds","createElement","UNIVER_SHEET","univer-container","1ydkFjj","toString","set","_dialogService","1em","from","_historyUniver$","historyListServerUrl","_localeService","url(#$1","Exited","children","map","_componentManager","_univerInstanceService","_configService","11568vhghaf","univer.operation.toggle-edit-history","UNIVER_UNKNOWN","mutations","M4.45388 4.14989H3.52896C4.61144 2.8939 6.21319 2.0999 7.9999 2.0999C11.2584 2.0999 13.8999 4.74142 13.8999 7.9999C13.8999 11.2584 11.2584 13.8999 7.9999 13.8999C4.74142 13.8999 2.0999 11.2584 2.0999 7.9999C2.0999 7.66853 1.83127 7.3999 1.4999 7.3999C1.16853 7.3999 0.899902 7.66853 0.899902 7.9999C0.899902 11.9211 4.07868 15.0999 7.9999 15.0999C11.9211 15.0999 15.0999 11.9211 15.0999 7.9999C15.0999 4.07868 11.9211 0.899902 7.9999 0.899902C5.88709 0.899902 3.9903 1.82298 2.69023 3.28636V2.38625C2.69023 2.05488 2.42161 1.78625 2.09023 1.78625C1.75886 1.78625 1.49023 2.05488 1.49023 2.38625V4.74989C1.49023 5.08126 1.75886 5.34989 2.09023 5.34989H4.45388C4.78525 5.34989 5.05388 5.08126 5.05388 4.74989C5.05388 4.41851 4.78525 4.14989 4.45388 4.14989Z","3393648ObgLKs","random","register","assign","forEach","next","colorChannel1","uComp","displayName","M0 0H16V16H0z","subscribe","invoke","setConfig","OTHERS","setDarkMode","flat","permissionId","mergeMenu","string","session","currentColor","substring","__getInjector","mountHistoryContent","_selectionProtectionRuleModel","pluginName","disposeWithMe","top","location","HistoryIcon","close","getSubunitRuleList","_localCacheService","getUnit","length","eventID","replace","1185965miQkoD","appendChild","6dgkVil","_initContainer","some","1000","getAllPlugins","onCommandExecuted","_collaborationController","params","idSuffix","value","_config","style","_historyManagerService","div","[HistoryLoaderService]: Plugin ","_initListener"];return l0=function(){return x},l0()}const Rx=f(389),$t={};function Ux({ref:x,...t}){const e=f,{icon:s,id:i,className:n,extend:r,...c}=t,l=("univerjs-icon univerjs-icon-"+i+" "+(n||"")).trim(),h=T.useRef("_"+ea());return Dx(s,""+i,{defIds:s[e(405)],idSuffix:h[e(376)]},{ref:x,className:l,...c},r)}function Dx(x,t,e,s,i){const n=f;return T.createElement(x[n(346)],{key:t,...qr(x,e,i),...s},(Qr(x,e).children||[])[n(421)]((r,c)=>Dx(r,t+"-"+x[n(346)]+"-"+c,e,void 0,i)))}function qr(x,t,e){const s=f,i={...x[s(495)]};e!=null&&e[s(436)]&&i[s(382)]===s(436)&&(i[s(382)]=e.colorChannel1),x[s(346)]===s(499)&&i.id&&(i.id=i.id+t[s(477)]),Object[s(354)](i)[s(434)](([r,c])=>{const l=s;r===l(499)&&typeof c==l(448)&&(i[r]=c[l(466)](/url\(#(.*)\)/,l(418)+t[l(477)]+")"))});const{defIds:n}=t;return!n||n[s(464)]===0||(x[s(346)]==="use"&&i[s(388)]&&(i[s(388)]=i[s(388)]+t.idSuffix),Object[s(354)](i)[s(434)](([r,c])=>{const l=s;typeof c==l(448)&&(i[r]=c.replace(/url\(#(.*)\)/,l(418)+t[l(477)]+")"))})),i}function h0(x,t){const e=l0();return h0=function(s,i){return s=s-346,e[s]},h0(x,t)}function Qr(x,t){const e=f;var s;const{defIds:i}=t;return!i||i[e(464)]===0?x:x[e(346)]===e(496)&&(s=x[e(420)])!=null&&s[e(464)]?{...x,children:x.children[e(421)](n=>typeof n[e(495)].id==e(448)&&i&&i[e(369)](n[e(495)].id)?{...n,attrs:{...n[e(495)],id:n.attrs.id+t[e(477)]}}:n)}:x}function ea(){const x=f;return Math[x(431)]()[x(410)](36)[x(451)](2,8)}Ux[f(438)]=f(398);const ta={tag:"svg",attrs:{xmlns:f(351),fill:f(379),viewBox:"0 0 16 16",width:f(413),height:f(413)},children:[{tag:"g",attrs:{fill:f(450),clipPath:"url(#history-icon_clip0_907_281)"},children:[{tag:f(366),attrs:{d:f(429)}},{tag:f(366),attrs:{d:"M8.28291 5.16293C8.28295 4.83156 8.01435 4.5629 7.68298 4.56287C7.35161 4.56283 7.08295 4.83143 7.08291 5.1628L7.08252 8.63494C7.0825 8.79881 7.1495 8.95555 7.26796 9.06877L9.70073 11.3939C9.94029 11.6228 10.3201 11.6142 10.549 11.3747C10.778 11.1351 10.7694 10.7553 10.5298 10.5263L8.28255 8.37852L8.28291 5.16293Z"}}]},{tag:f(496),attrs:{},children:[{tag:"clipPath",attrs:{id:f(347)},children:[{tag:f(366),attrs:{fill:"white",d:f(439)}}]}]}],defIds:["history-icon_clip0_907_281"]},wx=T.forwardRef(function(x,t){const e=f;return T.createElement(Ux,Object[e(433)]({},x,{id:"history-icon",ref:t,icon:ta}))});wx[f(438)]=f(459);Object[f(350)];var xa=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},j=(x,t)=>(e,s)=>t(e,s,x);const sa=f(408),Lx=f(378),Te=f(371);let Me=class extends R{constructor(x,t,e,s,i,n,r,c,l,h){const d=f;super(),ae(this,d(415),new D(null)),ae(this,d(501),this[d(415)].asObservable()),ae(this,d(357),new dt),ae(this,d(352),new Map),this._localeService=x,this[d(423)]=t,this[d(424)]=e,this._commandService=s,this[d(372)]=i,this._permissionService=n,this._selectionProtectionRuleModel=r,this._dialogService=c,this[d(404)]=l,this._themeService=h,this._init()}get historyUniver(){const x=f;return this[x(415)][x(478)]}_init(){const x=f;this[x(470)](),this[x(400)]()}_initContainer(){const x=f;var t;const e=(t=this._configService.getConfig(Lx))!=null?t:sa,s=document[x(348)](e);if(!s)return;const i=document[x(406)](x(482));i.id=Te,i[x(367)][x(437)]=x(500),i[x(480)][x(504)]="absolute",i.style[x(457)]="0",i[x(480)][x(383)]="0",i[x(480)].width="100%",i.style.height="100%",i[x(480)][x(370)]=x(472),i[x(480)].display=x(379),s[x(468)](i)}_initPlugins(){const x=f;var t;[[Oi],[Ri,{container:Te,header:!0,toolbar:!1,footer:!0,contextMenu:!1,override:[[ft,null]]}],[_x],[Ui,{override:[[_t,null]]}],[Di,{hasScroll:!1}],[wi],[hn],[Li,{notExecuteFormula:!0}],[hx],[an],[on],[jt],[qi],[rn],[zi],[xn],[cn],[ln],[Zi],[sn],[nn],[Mi,{notExecuteFormula:!0}],[yi,{workerURL:"./worker.js"}],[Qi],[en],[tn],[Vx],[jx],[Bx,{notExecuteFormula:!0}],[We,{historyListServerUrl:(t=this._configService[x(391)](Rx))==null?void 0:t[x(416)]}]][x(434)](([e,s])=>this[x(395)](e,s))}[f(498)](){const x=f;super[x(498)](),this[x(394)](),this[x(352)][x(365)]()}registerPlugin(x,t,e){const s=f;if(this._pluginMap.has(x[s(455)])&&!e)throw new Error(s(483)+x[s(455)]+s(493));this[s(352)][s(411)](x[s(455)],[x,t])}[f(473)](){return Array[f(414)](this._pluginMap.values())}mountHistoryContent(x){const t=f,e=document[t(348)](Te);e&&(e.style.display=t(356),this._initUniver(x,Te))}[f(394)](){const x=f;var t;this[x(357)][x(498)](),(t=this[x(392)])==null||t[x(498)](),this[x(415)][x(435)](null);const e=document[x(348)](Te);e&&(e[x(480)][x(489)]=x(379))}_initUniver(x,t){const e=f;if(this[e(392)])return;const s=new gs({locales:{[this[e(417)][e(485)]()]:this[e(417)][e(403)]()},override:[[ps,{useClass:is}]]}),i=s[e(452)]();this[e(456)](this[e(355)].darkMode$[e(440)](l=>{const h=e;i[h(363)](Ue)[h(444)](l)})),this[e(456)](this._themeService[e(490)].subscribe(l=>{i.get(Ue).setTheme(l)})),i[e(363)](y)[e(384)](this[e(417)][e(485)]()),i.get(W)[e(442)](ue,this._configService[e(391)](ue));const n=this._configService[e(391)](Yx);n&&s[e(395)](Wx,{license:n.ls}),this[e(352)][e(434)](([l,h])=>{s[e(395)](l,h)}),i[e(441)](l=>{this[e(484)](l,x)}),this[e(415)].next(s);const r=i.get($),c=this[e(402)](x);r.triggerLoadVersions(x,t,c)}_initListener(x,t){const e=f,s=x.get($);this[e(357)].add(s[e(491)][e(440)](i=>{const n=e;switch(i){case _e[n(349)]:this[n(412)][n(380)](),this[n(404)][n(460)]();break;case _e[n(419)]:this.unMountHistoryContent();break;case _e[n(375)]:this[n(394)](),this[n(372)][n(502)]({content:this._localeService.t(n(360)),type:w[n(375)],duration:3e3});break}})),this[e(357)][e(488)](s[e(494)][e(440)](async i=>{i&&this[e(486)].executeCommand(Re.id,{unitId:t,revision:i})}))}_checkCanRevert(x){const t=f,e=this[t(423)][t(463)](x).getSheets()[t(421)](c=>c[t(386)]()),s=new Ne(x).id,i=e[t(421)](c=>new Ai(x,c).id),n=e[t(421)](c=>this[t(454)][t(461)](x,c)[t(421)](l=>new Pi(x,c,l[t(446)]).id))[t(445)](),r=new ki(x).id;return this[t(487)][t(396)]([s,...i,...n,r])[t(353)](c=>!!c.value)}};Me=xa([j(0,_(y)),j(1,F),j(2,W),j(3,Z),j(4,oe),j(5,zt),j(6,_(Yi)),j(7,_(ft)),j(8,_(dx)),j(9,_(Ue))],Me);const St={id:f(426),type:Xt[f(377)],handler:x=>{const t=f,e=x[t(363)](Me),s=x[t(363)](F),{unitId:i}=$i(s)||{};return i?(e[t(453)](i),!0):!1}};function ia(x){const t=f;return{id:St.id,type:ji.BUTTON,icon:"HistoryIcon",tooltip:"editHistory.panel.title",hidden$:Vi(x,P[t(407)]),disabled$:Fi(x,{workbookTypes:[Ne,Bi],worksheetTypes:[],rangeTypes:[]})}}const na={[Hi[f(443)]]:{[St.id]:{order:.2,menuItemFactory:ia}}};Object[f(350)];var ra=(x,t,e,s)=>{const i=f;for(var n=t,r=x[i(464)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},q=(x,t)=>(e,s)=>t(e,s,x);let d0=class extends Y{constructor(x,t,e,s,i,n,r,c){const l=f;super(),ae(this,l(373),null),this[l(486)]=x,this._menuManagerService=t,this._componentManager=e,this[l(481)]=s,this[l(417)]=i,this[l(372)]=n,this._collaborationController=r,this[l(462)]=c,this[l(381)]()}[f(381)](){const x=f;[St][x(434)](t=>this[x(456)](Ae(this[x(486)][x(503)](t)))),this[x(456)](this[x(422)][x(432)]("HistoryIcon",wx)),this._menuManagerService[x(447)](na),this[x(456)](this[x(486)][x(474)](t=>{const e=x;if(t.id===Re.id){this[e(372)][e(502)]({content:this[e(417)].t("editHistory.panel.reverting"),type:w.Loading,duration:5e3});const{unitId:s}=t[e(476)],i=this[e(475)].getCollabEntity(s),n=m0([i[e(449)][e(359)],i.state$]).subscribe(async([r,c])=>{const l=e;var h;r[l(465)]===Q[l(364)]&&(c==null?void 0:c.status)===L.SYNCED&&r[l(361)][l(428)][l(471)](d=>d.id===Re.id)&&(this[l(481)][l(394)](),n[l(385)](),this._revertErrorTimer&&clearTimeout(this[l(373)]),await((h=this._localCacheService)==null?void 0:h[l(492)]()),setTimeout(()=>window[l(458)].reload()))});this[e(373)]=setTimeout(()=>{const r=e;n[r(385)](),this[r(372)].show({content:this[r(417)].t(r(368)),type:w[r(375)],duration:3e3})},5e3)}}))}};d0=ra([q(0,Z),q(1,Wi),q(2,_(ux)),q(3,_(Me)),q(4,_(y)),q(5,oe),q(6,_(I0)),q(7,nt)],d0);var aa=(x,t,e,s)=>{for(var i=t,n=x.length-1,r;n>=0;n--)(r=x[n])&&(i=r(i)||i);return i},Ht=(x,t)=>(e,s)=>t(e,s,x);const oa=f(393);var Ve;let st=(Ve=class extends ot{constructor(x=$t,t,e){const s=f;super(),this[s(479)]=x,this[s(401)]=t,this._configService=e;const{menu:i,...n}=ct({},$t,this[s(479)]);i&&this._configService[s(442)]("menu",i,{merge:!0}),this[s(424)][s(442)](Rx,n),this[s(479)][s(362)]&&this[s(424)].setConfig(Lx,this[s(479)].univerContainerId)}[f(497)](){const x=f;[[Me],[d0]][x(434)](t=>this[x(401)][x(488)](t))}onSteady(){const x=f;this[x(401)][x(363)](d0)}},ae(Ve,"type",P[f(427)]),ae(Ve,"pluginName",oa),Ve);st=aa([Ht(1,_(H)),Ht(2,W)],st);var O=_0;(function(x,t){for(var e=_0,s=x();;)try{var i=-parseInt(e(298))/1+parseInt(e(294))/2+-parseInt(e(297))/3+parseInt(e(287))/4+parseInt(e(311))/5+parseInt(e(293))/6+-parseInt(e(291))/7;if(i===t)break;s.push(s.shift())}catch{s.push(s.shift())}})(u0,753576);function u0(){var x=["3778881iBPaFX","290725qsCoax","subscribeCollaborators","extend","members$","waitForRoom$","_injector","loadActiveSheetAsync","length","loadUnitOfRevision","from","loadServerUnit","getUniverSheet","get","1353810qxUyIc","createInstance","_handler","subscribe","loadSheetAsync","loadActiveSheet","readyForCollab","3013952vxFaKW","loadServerUnitOfRevision","pipe","_collaborationController","2851359FqvZwi","loadSheet","2953968oRrlhQ","2389374KnJKwK","getOwnPropertyDescriptor","[FCollaboration]: this method should be override."];return u0=function(){return x},u0()}Object[O(295)];var ca=(x,t,e,s)=>{for(var i=O,n=t,r=x[i(305)]-1,c;r>=0;r--)(c=x[r])&&(n=c(n)||n);return n},je=(x,t)=>(e,s)=>t(e,s,x);let it=class extends as{constructor(x,t,e,s,i){var n=O;super(),this[n(282)]=x,this[n(303)]=t,this._univerInstanceService=e,this._snapshotService=s,this[n(290)]=i}async[O(285)](){return this.loadActiveSheetAsync()}async[O(304)](){var x=O;throw new Error(x(296))}async[O(292)](x){var t=O;return this[t(284)](x)}async loadSheetAsync(x,t){var e=O;return await this._snapshotService[e(292)](x,0,t)?(await this[e(290)][e(286)](x),this[e(282)][e(309)](x)):null}[O(299)](x,t){var e=O;const s=this._injector[e(310)](rt)[e(302)](x)[e(289)](fe(i=>i[e(301)]))[e(283)](i=>t(Array[e(307)](i.values())));return Ae(s)}};it=ca([je(1,_(H)),je(2,F),je(3,_(Gx)),je(4,_(I0))],it);class la extends v0{getCollaboration(){var t=O;return this[t(303)][t(281)](it,{getUniverSheet:e=>this.getUniverSheet(e)})}[O(308)](t,e,s){var i=O;return this[i(303)].get(B0).loadUnit(t,e,s)}[O(288)](t,e,s){var i=O;return this._injector[i(310)](B0)[i(306)](t,e,s)}}function _0(x,t){var e=u0();return _0=function(s,i){s=s-281;var n=e[s];return n},_0(x,t)}v0[O(300)](la);var Ft=b0;function f0(){var x=["7TZauBt","811342djfXLL","_injector","5UuxLYA","3278760CZDdZm","3341924ACkhyR","238430bUEFgk","3657510sWCYxj","2619270jWVfPx","get","runOnServer","12779860CkXkHX","9TsalWU"];return f0=function(){return x},f0()}function b0(x,t){var e=f0();return b0=function(s,i){s=s-384;var n=e[s];return n},b0(x,t)}(function(x,t){for(var e=b0,s=x();;)try{var i=parseInt(e(385))/1*(-parseInt(e(391))/2)+parseInt(e(393))/3+parseInt(e(390))/4+-parseInt(e(388))/5*(-parseInt(e(392))/6)+-parseInt(e(386))/7+parseInt(e(389))/8+-parseInt(e(384))/9*(parseInt(e(396))/10);if(i===t)break;s.push(s.shift())}catch{s.push(s.shift())}})(f0,499604);class ha extends v0{[Ft(395)](t,e,...s){var i=Ft;return this[i(387)][i(394)](et).runOnServer(t,e,{},...s)}}v0.extend(ha);function da(x){const t=new URL(x,window.location.origin);switch(t.protocol){case"https:":t.protocol="wss:";break;case"http:":t.protocol="ws:";break}return t.toString()}function to(x={}){const{universerEndpoint:t,univerContainerId:e="app",enableOfflineEditing:s=!0,enableSingleActiveInstanceLock:i=!0}=x,n=t??`${window.location.protocol}//${window.location.host}`;return{plugins:[jt,[Wt,{socketService:Q0,enableOfflineEditing:s,enableSingleActiveInstanceLock:i,enableAuthServer:!0,authzUrl:`${n}/universer-api/authz`,snapshotServerUrl:`${n}/universer-api/snapshot`,collabSubmitChangesetUrl:`${n}/universer-api/comb`,collabWebSocketUrl:da(`${n}/universer-api/comb/connect`),loginUrlKey:`${n}/universer-api/oidc/authpage`,uploadFileServerUrl:`${n}/universer-api/stream/file/upload`,signUrlServerUrl:`${n}/universer-api/file/{fileID}/sign-url`,downloadEndpointUrl:`${n}/`,wsSessionTicketUrl:`${n}/universer-api/user/session-ticket`,sendChangesetTimeout:200}],[Ye,{}],[st,{univerContainerId:e,historyListServerUrl:`${n}/universer-api/history`}]]}}export{is as AuthzIoHttpService,Mo as AwaitingState,yo as AwaitingWithPendingState,Q0 as BrowserCollaborationSocketService,ue as COLLABORATION_CLIENT_PLUGIN_CONFIG_KEY,I0 as CollaborationController,ze as CollaborationDataLoaderController,Ao as CollaborationEntity,Q as CollaborationEvent,ss as CollaborationImageIoService,Po as CollaborationSession,Bt as CollaborationSessionService,Xx as CollaborationSocketService,L as CollaborationStatus,J as CollaborationUIEventId,ts as CollaborationUIEventService,ko as CollaborativeUndoRedoService,$o as CommentService,Fx as CompressMutationService,Ho as ConflictState,$x as CreateUnitMutation,Fo as DEFAULT_COLLAB_WEB_SOCKET_URL,Jx as DEFAULT_REMOTE_UNISCRIPT_EXECUTION_ENDPOINT,Kx as DEFAULT_WS_SESSION_TICKET_URL,B0 as DataLoaderService,Je as DesktopCollaborationStatusDisplayController,es as DocCollaborationEntity,io as DocTransformController,Vo as FetchingMissState,jo as HEARTBEAT_INTERVAL_KEY,Bo as HEARTBEAT_TIMEOUT_KEY,Me as HistoryLoaderService,$ as HistoryManagerService,_e as HistoryModeStatus,Yo as ICollaborationSocketService,nt as ILocalCacheService,Wo as INetworkConditionService,Go as ISingleActiveUnitService,E0 as ISnapshotServerService,ye as ITransformService,Sx as IURLService,qx as LOCAL_CACHE_INTERVAL,Qx as LOCAL_CACHE_INTERVAL_KEY,rt as MemberService,Xo as MentionIoHttpService,Ko as OfflineState,Zo as PendingState,Zx as REMOTE_UNISCRIPT_EXECUTION_ENDPOINT_KEY,Jo as RETRY_CONNECTING_MAX_COUNT_KEY,et as RemoteUniscriptService,Re as RevertRevisionMutation,yx as RevisionService,no as SINGLE_HISTORY_MUTATIONS,ro as SINGLE_SNAPSHOT_MUTATIONS,Yt as SessionStatus,px as SheetCollabCursorShape,zo as SheetCollaborationEntity,ao as SheetTransformController,qo as SheetTransformSelectionsService,oo as SnapshotSaveService,xs as SnapshotServerOverHTTPService,Gx as SnapshotService,Qo as SyncedState,co as TransformService,Lx as UNIVER_CONTAINER_ID_KEY,Te as UNIVER_HISTORY_CONTAINER_ID,Pe as UnitStatus,Wt as UniverCollaborationClientPlugin,Ye as UniverCollaborationClientUIPlugin,jt as UniverCollaborationPlugin,st as UniverEditHistoryLoaderPlugin,We as UniverEditHistoryViewerPlugin,to as UniverSheetsCollaborationPreset,Ja as WebBrowserSingleActiveUnitService,rr as WebURLService,lo as b64DecodeUnicode,ho as b64EncodeUnicode,e2 as deserializeToCombResponse,uo as generateTempDocumentSnapshot,_o as generateTemporarySnap,gt as getLocalCacheKey,fo as getSheetBlocksFromSnapshot,bo as isTransformChangesetsFailure,Eo as isTransformChangesetsSuccess,X as isTransformMutationFailure,Io as isTransformMutationSuccess,vo as isTransformMutationsFailure,Px as isTransformMutationsSuccess,mo as isTransformMutationsWithChangesetFailure,Vt as isTransformMutationsWithChangesetSuccess,So as mapDocumentTypeToUniverType,go as parseChangesetToProtocol,po as parseMutationToProtocol,Ax as parseProtocolChangeset,Co as parseProtocolCommand,To as parseProtocolMutation,t2 as serializeCombRequest,No as textDecoder,Oo as textEncoder,Ro as transformDocumentDataToSnapshot,Uo as transformSnapshotToDocumentData,kx as transformSnapshotToWorkbookData,Do as transformWorkbookDataToSnapshot,wo as uuidv4};
