import{M as I,k as O,L as x,v as k,j as M,f as y,p as H,F as J,ab as ne,g as Y,ai as R,ac as oe,V as ie,a5 as ce,a7 as c,m as ue,s as Z,w as ee,d1 as fe,O as he,o as de,G as me,z as ge,dD as pe,ak as ve,q as _e,I as E,u as be,x as te,y as Se}from"./TeamSpreadsheet-DqPQXi__.js";import{z as D,W as P,nJ as W,U as $e,ng as G,o8 as z,t as ae,Z as we,l as ye,lg as B,Q as Re,h as Ce,jX as Me,s as xe,b as Ee,a6 as Ne,G as Ie}from"./index--BQDx9CP.js";var Ve=Object.defineProperty,Ue=(e,t,a)=>t in e?Ve(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,K=(e,t,a)=>Ue(e,typeof t!="symbol"?t+"":t,a);const se=["$","£","¥","¤","֏","؋","৳","฿","៛","₡","₦","₩","₪","₫","€","₭","₮","₱","₲","₴","₸","₹","₺","₼","₽","₾","₿","﷼"],U=new Map([[c.EN_US,"$"],[c.RU_RU,"₽"],[c.VI_VN,"₫"],[c.ZH_CN,"¥"],[c.ZH_TW,"NT$"],[c.FR_FR,"€"],[c.FA_IR,"﷼"],[c.KO_KR,"₩"],[c.ES_ES,"€"],[c.CA_ES,"€"]]);function Oe(e){switch(e){case c.CA_ES:case c.ES_ES:case c.FR_FR:return{icon:"EuroIcon",symbol:U.get(e)||"€",locale:e};case c.RU_RU:return{icon:"RoubleIcon",symbol:U.get(e)||"₽",locale:e};case c.ZH_CN:return{icon:"RmbIcon",symbol:U.get(e)||"¥",locale:e};case c.EN_US:default:return{icon:"DollarIcon",symbol:"$",locale:c.EN_US}}}function q(e){return U.get(e)||"$"}function Te(e,t=2){let a=t;t>127&&(a=127);let s="";return a>0&&(s=`.${"0".repeat(a)}`),`"${q(e)}"#,##0${s}_);[Red]("${q(e)}"#,##0${s})`}const Ae=[{label:"1930-08-05",suffix:"yyyy-MM-dd"},{label:"1930/08/05",suffix:"yyyy/MM/dd"},{label:"1930年08月05日",suffix:'yyyy"年"MM"月"dd"日"'},{label:"08-05",suffix:"MM-dd"},{label:"8月5日",suffix:'M"月"d"日"'},{label:"13:30:30",suffix:"h:mm:ss"},{label:"13:30",suffix:"h:mm"},{label:"下午01:30",suffix:"A/P hh:mm"},{label:"下午1:30",suffix:"A/P h:mm"},{label:"下午1:30:30",suffix:"A/P h:mm:ss"},{label:"08-05 下午 01:30",suffix:"MM-dd A/P hh:mm"}],Fe=[{label:"(1,235)",suffix:"#,##0_);(#,##0)"},{label:"(1,235) ",suffix:"#,##0_);[Red](#,##0)",color:"red"},{label:"1,234.56",suffix:"#,##0.00_);#,##0.00"},{label:"1,234.56",suffix:"#,##0.00_);[Red]#,##0.00",color:"red"},{label:"-1,234.56",suffix:"#,##0.00_);-#,##0.00"},{label:"-1,234.56",suffix:"#,##0.00_);[Red]-#,##0.00",color:"red"}],je=[{label:e=>`${e}1,235`,suffix:e=>`"${e}"#,##0.00_);"${e}"#,##0.00`},{label:e=>`${e}1,235`,suffix:e=>`"${e}"#,##0.00_);[Red]"${e}"#,##0.00`,color:"red"},{label:e=>`(${e}1,235)`,suffix:e=>`"${e}"#,##0.00_);("${e}"#,##0.00)`},{label:e=>`(${e}1,235)`,suffix:e=>`"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`,color:"red"},{label:e=>`-${e}1,235`,suffix:e=>`"${e}"#,##0.00_);-"${e}"#,##0.00`},{label:e=>`-${e}1,235`,suffix:e=>`"${e}"#,##0.00_);[Red]-"${e}"#,##0.00`,color:"red"}],T=(e,t=0)=>{var a;return e&&(a=O.getFormatInfo(e).maxDecimals)!=null?a:t},Q=e=>new Array(Math.min(Math.max(0,Number(e)),30)).fill(0).join(""),A=(e,t)=>e.split(";").map(a=>/\.0?/.test(a)?a.replace(/\.0*/g,`${t>0?".":""}${Q(Number(t||0))}`):/0([^0]?)|0$/.test(a)?a.replace(/0([^0]+)|0$/,`0${t>0?".":""}${Q(Number(t||0))}$1`):a).join(";"),Je=e=>/\.0?/.test(e)||/0([^0]?)|0$/.test(e),V={id:"sheet.command.numfmt.set.numfmt",type:I.COMMAND,handler:(e,t)=>{if(!t)return!1;const a=e.get(x),s=e.get(k),l=e.get(ne),r=W(s,t);if(!r)return!1;const{unitId:o,subUnitId:g,worksheet:u}=r,f=t.values.filter(n=>!!n.pattern),S=t.values.filter(n=>!n.pattern),w=$e(o,g,f),m={unitId:o,subUnitId:g,ranges:S.map(n=>({startColumn:n.col,startRow:n.row,endColumn:n.col,endRow:n.row}))},p=[],h=[];if(f.length){const n=f.reduce((d,i)=>{Y(i.pattern)&&d.setValue(i.row,i.col,{t:y.STRING});const $=u.getCellRaw(i.row,i.col);if($){const N=G($.v);N!==$.t&&d.setValue(i.row,i.col,{t:N})}return d},new R).getMatrix(),_=new R;new R(n).forValue((d,i)=>{const $=u.getCellRaw(d,i);$?_.setValue(d,i,{t:$.t}):_.setValue(d,i,{t:void 0})}),Object.keys(w.values).forEach(d=>{const i=w.values[d];i.ranges=z(i.ranges)}),p.push({id:ae.id,params:w});const b=we(e,w);h.push(...b)}if(S.length){m.ranges=z(m.ranges);const n=S.reduce((d,i)=>{const $=u.getCellRaw(i.row,i.col);if($){const N=G($.v);N!==$.t&&d.setValue(i.row,i.col,{t:N})}return d},new R).getMatrix(),_=new R;new R(n).forValue((d,i)=>{const $=u.getCellRaw(d,i);$?_.setValue(d,i,{t:$.t}):_.setValue(d,i,{t:void 0})}),p.push({id:ye.id,params:m},{id:B.id,params:{unitId:o,subUnitId:g,cellValue:n}});const b=Re(e,m);h.push({id:B.id,params:{unitId:o,subUnitId:g,cellValue:_.getMatrix()}},...b)}const v=oe(p,a).result;return v&&l.pushUndoRedo({unitID:o,undoMutations:h,redoMutations:p}),v}},ke={id:"sheet.command.numfmt.add.decimal.command",type:I.COMMAND,handler:async e=>{const t=e.get(x),a=e.get(D),s=e.get(P),l=e.get(k),r=a.getCurrentSelections();if(!r||!r.length)return!1;const o=W(l);if(!o)return!1;const{unitId:g,subUnitId:u}=o;let f=0;r.forEach(p=>{M.foreach(p.range,(h,v)=>{const n=s.getValue(g,u,h,v);if(!n){const b=o.worksheet.getCellRaw(h,v);if(!f&&b&&b.t===y.NUMBER&&b.v){const d=/\.(\d*)$/.exec(String(b.v));if(d){const i=d[1].length;if(!i)return;f=Math.max(f,i)}}return}const _=T(n.pattern);f=_>f?_:f})});const S=f+1,w=A(`0${S>0?".0":""}`,S),m=[];return r.forEach(p=>{M.foreach(p.range,(h,v)=>{const n=s.getValue(g,u,h,v);if(H(n==null?void 0:n.pattern))m.push({row:h,col:v,pattern:w});else{const _=T(n.pattern),b=A(n.pattern,_+1);b!==n.pattern&&m.push({row:h,col:v,pattern:b})}})}),m.length?await t.executeCommand(V.id,{values:m}):!1}},De={id:"sheet.command.numfmt.set.currency",type:I.COMMAND,handler:async e=>{const t=e.get(x),a=e.get(D),s=e.get(J),l=a.getCurrentSelections();if(!l||!l.length)return!1;const r=[],o=Oe(s.getCurrentLocale()),g=Te(o.locale);return l.forEach(u=>{M.foreach(u.range,(f,S)=>{r.push({row:f,col:S,pattern:g,type:"currency"})})}),await t.executeCommand(V.id,{values:r})}},Le={id:"sheet.command.numfmt.set.percent",type:I.COMMAND,handler:async e=>{const t=e.get(x),a=e.get(D).getCurrentSelections();if(!a||!a.length)return!1;const s=[],l="0%";return a.forEach(r=>{M.foreach(r.range,(o,g)=>{s.push({row:o,col:g,pattern:l,type:"percent"})})}),await t.executeCommand(V.id,{values:s})}},Ge={id:"sheet.command.numfmt.subtract.decimal.command",type:I.COMMAND,handler:async e=>{const t=e.get(x),a=e.get(D),s=e.get(P),l=e.get(k),r=a.getCurrentSelections();if(!r||!r.length)return!1;const o=W(l);if(!o)return!1;const{unitId:g,subUnitId:u}=o;let f=0;r.forEach(p=>{M.foreach(p.range,(h,v)=>{const n=s.getValue(g,u,h,v);if(!n){const b=o.worksheet.getCellRaw(h,v);if(!f&&b&&b.t===y.NUMBER&&b.v){const d=/\.(\d*)$/.exec(String(b.v));if(d){const i=d[1].length;if(!i)return;f=Math.max(f,i)}}return}const _=T(n.pattern);f=_>f?_:f})});const S=f-1,w=A(`0${S>0?".0":"."}`,S),m=[];return r.forEach(p=>{M.foreach(p.range,(h,v)=>{const n=s.getValue(g,u,h,v);if(H(n==null?void 0:n.pattern))m.push({row:h,col:v,pattern:w});else{const _=T(n.pattern);m.push({row:h,col:v,pattern:A(n.pattern,_-1)})}})}),await t.executeCommand(V.id,{values:m})}},re="sheets-numfmt.config",X={},Ye=e=>O.getFormatInfo(e).type||"unknown",Be=(e,t,a="en")=>{const s=O.formatColor(e,t),l=s?String(s):void 0,r=O.format(e,t,{locale:a,throws:!1});return t<0?{result:r,color:l}:{result:r}},He=(e,t,a)=>e===pe?{result:String(Ee(t))}:Be(e,t,a);var Pe=(e,t,a,s)=>{for(var l=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(l=o(l)||l);return l},C=(e,t)=>(a,s)=>t(a,s,e);const We={tl:{size:6,color:"#409f11"}};let F=class extends ie{constructor(e,t,a,s,l,r,o){super(),K(this,"_locale$",new ce("en")),K(this,"locale$",this._locale$.asObservable()),this._instanceService=e,this._sheetInterceptorService=t,this._themeService=a,this._commandService=s,this._numfmtService=l,this._localeService=r,this._configService=o,this._initInterceptorCellContent()}get locale(){const e=this._locale$.getValue();if(e)return e;switch(this._localeService.getCurrentLocale()){case c.FR_FR:return"fr";case c.RU_RU:return"ru";case c.VI_VN:return"vi";case c.ZH_CN:return"zh-CN";case c.KO_KR:return"ko";case c.ZH_TW:return"zh-TW";case c.ES_ES:case c.CA_ES:return"es";case c.EN_US:case c.FA_IR:default:return"en"}}_initInterceptorCellContent(){const e=new R;this.disposeWithMe(ue(this._locale$,this._localeService.currentLocale$).subscribe(()=>{e.reset()})),this.disposeWithMe(this._sheetInterceptorService.intercept(Ce.CELL_CONTENT,{effect:Z.Value|Z.Style,handler:(t,a,s)=>{var l,r;if(!t||t.v===void 0||t.v===null||t.t===y.BOOLEAN||t.t===y.FORCE_STRING)return s(t);const o=a.unitId,g=a.subUnitId;let u;if(t!=null&&t.s){const h=a.workbook.getStyles().get(t.s);h!=null&&h.n&&(u=h.n)}if(u||(u=this._numfmtService.getValue(o,g,a.row,a.col)),H(u==null?void 0:u.pattern)||t.t!==y.NUMBER&&G(t.v,t.t)!==y.NUMBER)return s(t);const f=t;if((!t||t===a.rawData)&&(t={...a.rawData}),Y(u==null?void 0:u.pattern))return(l=this._configService.getConfig(re))!=null&&l.disableTextFormatMark?(t.t=y.STRING,s(t)):(t.t=y.STRING,t.markers={...t==null?void 0:t.markers,...We},s(t));let S="";const w=e.getValue(a.row,a.col);if(w&&w.parameters===`${f.v}_${u==null?void 0:u.pattern}`)return s({...t,...w.result});const m=He(u==null?void 0:u.pattern,Number(f.v),this.locale);if(S=m.result,!S)return s(t);const p={v:S,t:y.NUMBER};if(m.color){const h=(r=this._themeService.getColorFromTheme(`${m.color}.500`))!=null?r:m.color;h&&(p.interceptorStyle={cl:{rgb:h}})}return e.setValue(a.row,a.col,{result:p,parameters:`${f.v}_${u==null?void 0:u.pattern}`}),Object.assign(t,p),s(t)},priority:Me.NUMFMT})),this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===ae.id){const a=t.params;Object.keys(a.values).forEach(s=>{a.values[s].ranges.forEach(l=>{M.foreach(l,(r,o)=>{e.realDeleteValue(r,o)})})})}else if(t.id===B.id){const a=t.params;new R(a.cellValue).forValue((s,l)=>{e.realDeleteValue(s,l)})}})),this.disposeWithMe(this._instanceService.getCurrentTypeOfUnit$(ee.UNIVER_SHEET).pipe(xe(t=>{var a;return(a=t==null?void 0:t.activeSheet$)!=null?a:ve(null)}),fe(1)).subscribe(()=>e.reset()))}setNumfmtLocal(e){this._locale$.next(e)}};F=Pe([C(0,k),C(1,E(Ie)),C(2,E(Se)),C(3,E(x)),C(4,E(P)),C(5,E(J)),C(6,te)],F);const Ze="SHEET_NUMFMT_PLUGIN";var ze=Object.defineProperty,Ke=(e,t,a)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,qe=(e,t,a,s)=>{for(var l=t,r=e.length-1,o;r>=0;r--)(o=e[r])&&(l=o(l)||l);return l},L=(e,t)=>(a,s)=>t(a,s,e),le=(e,t,a)=>Ke(e,typeof t!="symbol"?t+"":t,a);let j=class extends he{constructor(e=X,t,a,s){super(),this._config=e,this._injector=t,this._configService=a,this._commandService=s;const{...l}=de({},X,this._config);this._configService.setConfig(re,l)}onStarting(){me(this._injector,[[F]]),ge(this._injector,[[F]])}onRendered(){[ke,Ge,De,Le,V].forEach(e=>{this.disposeWithMe(this._commandService.registerCommand(e))})}};le(j,"pluginName",Ze);le(j,"type",ee.UNIVER_SHEET);j=qe([_e(Ne),L(1,E(be)),L(2,te),L(3,x)],j);const et=e=>se.find(t=>e.includes(t)),tt=()=>se.map(e=>({label:e,value:e})),at=e=>je.map(t=>({label:t.label(e),value:t.suffix(e),color:t.color})),st=()=>Ae.map(e=>({label:e.label,value:e.suffix})),rt=()=>Fe.map(e=>({label:e.label,value:e.suffix,color:e.color}));export{je as A,Ge as B,F as D,A as F,He as G,Be as H,Le as L,V as O,T as P,ke as V,q as Y,re as a,Ae as b,st as c,Fe as d,se as e,j as f,Te as g,tt as h,at as i,De as j,rt as l,et as o,Q as q,Je as r,Ye as s,U as w,Oe as x};
