import{bl as Pt,a$ as G0,b1 as k,b5 as Yt,bu as He,bq as Be,bo as Kt,x as zt,I as Wt,b4 as Ie,bp as me,an as Fe,ba as je,b2 as O0,b3 as h0,b9 as kt,bb as $e}from"./index-Dr6YZKPb.js";import{b as d0,aC as Ve,aD as Ge,cH as A0,aQ as Ye,aE as Ke,aT as vt,V as k0,a6 as Y0,af as l0,ak as pe,n as U0,cI as ze,w as s0,m as tt,a5 as M0,W as Q0,c8 as _t,c9 as N0,C as We,d as Xe,en as Je,M as Ht,dT as Xt,J as qe,S as Qe,L as e0,O as Ze,o as tx,ab as f0,c4 as ex,de as xx,ca as ix,eo as rx,G as sx,bW as nx,z as Jt,ac as ax,aO as ox,bU as cx,bT as qt,b_ as hx,q as ux,P as Q,I as P,u as J,x as x0,v as r0,df as dx,B as W,an as K0,F as z0,am as lx}from"./TeamSpreadsheet-DqPQXi__.js";import{t8 as p0,tf as fx,P as et,ac as Se,z as vx,lr as Qt,ju as _x,jV as Ex,mc as bx,tu as Ix}from"./index--BQDx9CP.js";import{c as mx,a as px,z as Sx,x as g0,K as gx,d as Cx,V as Tx}from"./index-DpLQClwC.js";function Ox(t){return d0(function(){return t})}function Rx(t,e){return Ve(function(x,r){return Ge(t(x,r)).pipe(A0(1),Ox(x))})}function Zt(t,e){e===void 0&&(e=Ke);var x=Ye(t,e);return Rx(function(){return x})}var i=j;(function(t,e){for(var x=j,r=t();;)try{var s=parseInt(x(724))/1+parseInt(x(374))/2+-parseInt(x(198))/3+-parseInt(x(797))/4*(parseInt(x(717))/5)+-parseInt(x(123))/6+parseInt(x(863))/7*(-parseInt(x(771))/8)+parseInt(x(256))/9;if(s===e)break;r.push(r.shift())}catch{r.push(r.shift())}})(nt,428880);var yx=Object[i(433)],Nx=(t,e,x)=>e in t?yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:x}):t[e]=x,L=(t,e,x)=>Nx(t,typeof e!=i(228)?e+"":e,x);const Dx=i(471),wx="SNAPSHOT_URL_KEY",Ux=2e3,ge=i(732),Ax="/universer-api/user/session-ticket",Ce="HEARTBEAT_INTERVAL",Mx=3e4,Bt="HEARTBEAT_TIMEOUT",Te=2e4,Lx=2e4,Oe=i(590),Px=3,kx="LOCAL_CACHE_INTERVAL",Hx=1e3,Bx="/universer-api/comb",Fx=i(465),jx=i(330),$x="/universer-api/uniscript";var Re=(t=>(t[t[i(484)]=0]=i(484),t[t.OK=1]="OK",t[t[i(781)]=2]="INTERNAL_ERROR",t[t.PERMISSION_DENIED=3]=i(238),t[t[i(505)]=4]="NOT_FOUND",t[t[i(727)]=5]=i(727),t[t[i(705)]=6]=i(705),t[t[i(487)]=7]="INVALID_ARGUMENT",t[t.TOO_MANY_REQUESTS=8]="TOO_MANY_REQUESTS",t[t.COMPLETION_FINISHED=9]=i(376),t[t.LOGIN_FAILED=10]=i(533),t[t[i(700)]=11]=i(700),t[t.MOBILE_VERIFY_CODE_NOT_FOUND_OR_EXPIRED=12]=i(552),t[t[i(331)]=13]=i(331),t[t[i(381)]=14]=i(381),t[t[i(177)]=15]="AUTHORIZE_CODE_ILLEGAL",t[t.LOGIN_TOKEN_PROCESSING_FAILED=16]=i(740),t[t[i(669)]=100]=i(669),t[t[i(244)]=101]=i(244),t[t[i(796)]=201]=i(796),t[t.USER_IS_ANONYMOUS=202]=i(662),t[t.CHANGESET_REVISION_CONFILICT=5001]=i(687),t[t[i(593)]=6001]="SNAPSHOT_INVALID_SNAPSHOT",t[t[i(768)]=6002]=i(768),t[t[i(215)]=6003]=i(215),t[t[i(385)]=7001]="APPLY_REJECT",t[t[i(775)]=7002]=i(775),t[t[i(540)]=7003]="APPLY_REVISION_CONFILICT",t[t[i(598)]=7004]=i(598),t[t[i(447)]=7005]=i(447),t[t.CONNECTOR_DATA_TOO_LARGE=8001]="CONNECTOR_DATA_TOO_LARGE",t[t[i(901)]=9001]=i(901),t[t[i(173)]=9002]="LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED",t[t[i(332)]=9003]="LICENSE_IMPORT_SIZE_EXCEEDED",t[t[i(419)]=9004]="LICENSE_EXPORT_SIZE_EXCEEDED",t[t.LICENSE_DISTRO_REJECTED=9005]=i(361),t[t[i(643)]=10001]=i(643),t[t[i(143)]=10002]=i(143),t[t.YUUMI_RATE_OVER_LIMIT=10003]=i(854),t[t[i(302)]=10004]=i(302),t[t[i(485)]=10010]="YUUMI_NO_CUBOID_FOR_QUESTION",t[t[i(691)]=10011]="YUUMI_ASYNCIO_CANCELLED",t[t[i(109)]=10012]=i(109),t[t[i(233)]=10013]=i(233),t[t[i(728)]=10014]="YUUMI_PROMPT_MAX_TOKENS_EXCEEDED",t[t[i(560)]=10015]=i(560),t[t.YUUMI_CONNECTOR_URL_NOT_FOUND=10016]=i(886),t[t.PY_RUNTIME_SCRIPT_ERROR=11001]="PY_RUNTIME_SCRIPT_ERROR",t[t[i(860)]=12001]=i(860),t[t[i(201)]=12002]=i(201),t[t.INVITE_CODE_REQUIRED=12003]="INVITE_CODE_REQUIRED",t[t[i(206)]=12004]=i(206),t[t[i(423)]=12005]=i(423),t[t.WECHAT_HAS_BEEN_BOUND=13001]=i(541),t[t[i(576)]=13002]="MOBILE_HAS_BEEN_BOUND",t[t.EMAIL_HAS_BEEN_BOUND=13003]=i(712),t[t[i(293)]=14001]="ENTITLE_CAN_NOT_BUY_LOWER_OTP",t[t[i(536)]=14002]=i(536),t[t.ENTITLE_DUP_SUBSCRIPTION=14003]=i(545),t[t[i(791)]=14004]=i(791),t[t[i(551)]=14101]=i(551),t[t[i(273)]=14102]=i(273),t[t.ENTITLE_INSUFFICIENT_QUOTA=14103]="ENTITLE_INSUFFICIENT_QUOTA",t[t[i(222)]=14301]=i(222),t[t[i(876)]=15001]=i(876),t[t[i(721)]=15002]="REDEMPTION_CODE_INACTIVE",t[t[i(428)]=15003]="REDEMPTION_CODE_FULLY_REDEEMED",t[t[i(167)]=15004]=i(167),t[t[i(801)]=15005]=i(801),t[t.REDEMPTION_USER_REDEEM_TIMES_EXCEED=15006]=i(835),t[t[i(352)]=15007]=i(352),t[t.DATA_SOURCE_TOO_LARGE=16001]=i(429),t[t[i(213)]=-1]=i(213),t))(Re||{}),n0=(t=>(t[t.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",t[t.UNIVER_DOC=1]=i(744),t[t[i(370)]=2]=i(370),t[t[i(839)]=3]=i(839),t[t[i(380)]=4]="UNIVER_PROJECT",t[t[i(213)]=-1]=i(213),t))(n0||{}),z=(t=>(t[t[i(144)]=0]=i(144),t[t[i(282)]=1]=i(282),t[t.JOIN=2]=i(509),t[t[i(310)]=3]=i(310),t[t[i(261)]=4]="INGEST",t[t[i(777)]=5]=i(777),t[t[i(420)]=6]=i(420),t[t[i(213)]=-1]=i(213),t))(z||{}),C0=(t=>(t[t[i(162)]=0]=i(162),t[t.OK=1]="OK",t[t[i(488)]=2]=i(488),t[t[i(270)]=1001]=i(270),t[t[i(616)]=1002]=i(616),t[t[i(327)]=1003]=i(327),t[t[i(718)]=1004]=i(718),t[t[i(213)]=-1]="UNRECOGNIZED",t))(C0||{}),ye=(t=>(t[t[i(181)]=0]="Undefined",t[t[i(320)]=1]=i(320),t[t.HttpExport=2]=i(530),t[t[i(572)]=3]="UnitEmbedded",t[t[i(377)]=4]=i(377),t[t.UserProfileImg=5]=i(305),t[t[i(826)]=6]=i(826),t[t.UNRECOGNIZED=-1]=i(213),t))(ye||{});const Vx=i(639);function Gx(t){var e=i;return JSON[e(878)](t).length}var a0=(t=>(t[i(295)]=i(295),t[i(238)]=i(238),t.CONFLICT=i(176),t[i(597)]=i(597),t[i(558)]=i(558),t.SOCKET_FAILED_RETRY=i(773),t.SOCKET_FAILED=i(266),t[i(389)]=i(389),t))(a0||{});class b0{constructor(){var e=i;L(this,"_event$",new l0),L(this,"event$",this._event$[e(475)]())}[i(194)](e){var x=i;this[x(684)].next(e)}}class Ft{constructor(){var e=i;L(this,e(402),new l0),L(this,e(110),this[e(402)].asObservable())}[i(411)](e){this._commentUpdate$.next(e)}}Object[i(498)];var Yx=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},te=(t,e)=>(x,r)=>e(x,r,t);let L0=class extends k0{constructor(t,e){var x=i;super(),L(this,x(274),new Map),L(this,x(762),new l0),this[x(263)]=t,this[x(767)]=e,this[x(657)](tt(this._univerInstanceService[x(809)](s0.UNIVER_SHEET)[x(348)](d0(r=>r[x(309)]())),this[x(263)][x(809)](s0[x(744)])[x(348)](d0(r=>r[x(309)]())),this[x(263)].getTypeOfUnitDisposed$(s0[x(839)])[x(348)](d0(r=>r.getUnitId())))[x(461)](r=>this[x(224)](r)))}[i(514)](t){var e=i;return this[e(274)].has(t)?pe(this._roomMembers[e(126)](t)):this[e(762)].pipe(d0(x=>{var r=e;if(x===t)return this[r(274)][r(126)](x)}))}[i(683)](t){var e=i;this[e(767)].setCurrentUser(t)}[i(214)](){var t=i;return this[t(767)][t(214)]()}updateMember(t,e){var x=i;let r=this[x(274)][x(126)](t);r||(r=new Kx,this[x(274)].set(t,r),this[x(762)][x(836)](t)),r[x(490)](e)}[i(588)](t,e){var x=i;const r=this._roomMembers[x(126)](t);r&&r[x(588)](e)}[i(474)](t){var e=i;return this[e(274)][e(126)](t)}[i(112)](t,e){var x=i;const r=this[x(274)][x(126)](t);if(r)return r[x(112)](e)}_removeRoom(t){var e=i;const x=this[e(274)][e(126)](t);x&&(x[e(114)](),this[e(274)][e(277)](t))}dispose(){var t=i;this._roomMembers.forEach(e=>e[t(114)]()),this[t(274)][t(788)](),this._roomCreated$[t(681)]()}};L0=Yx([te(0,r0),te(1,P(dx))],L0);class Kx extends k0{constructor(){var e=i;super(...arguments),L(this,"_members",new Map),L(this,e(749),new M0(this._members)),L(this,e(670),this[e(749)][e(475)]())}[i(114)](){var e=i;this[e(328)].clear()}[i(490)](e){var x=i;this[x(328)].set(e.memberID,e),this._emitMembers()}[i(588)](e){var x=i;this._members[x(277)](e)}[i(112)](e){var x=i;return this[x(328)][x(126)](e)}[i(111)](){var e=i;return Array[e(852)](this[e(328)][e(515)]())}[i(271)](){var e=i;this[e(749)].next(this[e(328)])}}Object[i(498)];var zx=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},D0=(t,e)=>(x,r)=>e(x,r,t),S0=(t=>(t[t[i(108)]=0]="IDLE",t[t[i(464)]=1]="JOINING",t[t[i(658)]=2]=i(658),t[t[i(365)]=3]=i(365),t))(S0||{});const ee={[C0[i(488)]]:i(840),[C0.JOIN_ROOM_FULL]:"session.room-full",[C0.JOIN_ROOM_NOT_EXISTS]:i(845),[C0.JOIN_ROOM_PERMISSION_DENIED]:i(888),[C0.GLOBAL_ROOMS_CNT_EXCEEDS]:"session.room-cnt-exceeds"};let xt=class extends Y0{constructor(t,e,x,r,s,n,a,c){var o=i;super(),L(this,"_sessionStatus$",new M0(0)),L(this,o(251),this[o(885)][o(475)]()),L(this,"_event$",new l0),L(this,o(695),this[o(684)][o(475)]()),L(this,o(422)),L(this,o(587)),L(this,"_collaborationTimeoutTimer"),L(this,o(367),!1),L(this,o(252),null),this[o(772)]=t,this[o(211)]=x,this[o(633)]=r,this._memberService=s,this[o(755)]=n,this[o(634)]=a,this[o(356)]=c,this[o(367)]=!!this[o(356)],e.pipe(p0(this.dispose$))[o(461)](v=>{var _=o,f;typeof v>"u"||(this[_(422)]=v,v?(this._joinRoom(v),this._socketMessageSubscription=v[_(760)][_(461)](h=>{h.routeKey===this._unitID&&this._onCombEvent(h)})):(this[_(577)](),this._sessionStatus$.next(2),(f=this[_(587)])==null||f[_(311)](),this[_(587)]=null))})}get[i(841)](){var t=i;return this[t(885)].getValue()}[i(532)](){var t=i,e,x;return(x=(e=this[t(422)])==null?void 0:e[t(118)])!=null?x:null}dispose(){var t=i;super.dispose(),this.dispose$.next(),this[t(730)][t(681)]()}[i(453)](){var t=i,e,x;this._throwTelemetryCollaborationNewChangeset(),(e=this._socket)==null||e[t(629)]({cmd:z[t(310)],data:{roomID:this[t(772)]}}),(x=this[t(422)])==null||x.close(),this[t(684)].complete(),this._sessionStatus$[t(681)](),this.dispose()}_onCombEvent(t){var e=i;t[e(315)]===z[e(509)]?this._onJoinRoomEvent(t):t[e(315)]===z[e(420)]&&this[e(278)](t)}_joinRoom(t){var e=i;this[e(885)].next(1),t[e(629)]({cmd:z[e(509)],routeKey:this[e(772)],routeType:"",data:{rooms:[{roomID:this[e(772)]}]}})}[i(113)](t){var e=i,x;if(t.code in ee){this[e(634)][e(194)]({id:a0[e(558)],data:ee[t[e(607)]]}),this[e(885)][e(836)](2);return}this[e(885)][e(836)](3);const r=(x=t.data[e(405)][this._unitID])==null?void 0:x[e(495)];r&&r.forEach(s=>this[e(699)][e(490)](this[e(772)],s))}[i(278)](t){var e=i;try{const x=t.data;switch(x.eventID){case k.USERS_ENTER:this[e(694)](x),this._event$[e(836)](x);break;case k.USERS_LEAVE:this[e(544)](x),this[e(684)][e(836)](x);break;case k.CHANGESET_ACK:case k[e(410)]:this._stopTelemetryCollaborationNewChangeset(),this[e(686)](),this[e(684)].next(x);break;case k[e(161)]:this[e(211)].error(e(489)+JSON.stringify(x)),this[e(684)][e(836)](x);break;case k[e(739)]:this[e(755)].onCommentUpdate(x.data),this[e(684)].next(x);break;default:this[e(684)][e(836)](x)}}catch(x){this[e(211)][e(355)](x,t)}}[i(694)](t){var e=i;this[e(699)][e(490)](this[e(772)],t[e(163)])}[i(544)](t){var e=i;this._memberService.removeMember(this[e(772)],t[e(163)][e(118)])}async[i(629)](t,e){var x=i;if(this[x(841)]!==3||!this[x(422)])throw new Error(x(789));try{t[x(589)]===k[x(631)]&&(this[x(679)](),this[x(200)](t)),this[x(422)][x(629)]({cmd:z[x(261)],routeKey:e,routeType:"",data:t})}catch(r){this[x(211)][x(355)](r)}}[i(679)](){var t=i,e;this[t(414)]=setTimeout(()=>{var x=t;this[x(414)]=null,this._collaborationUIEventService[x(194)]({id:a0[x(389)]})},(e=this[t(633)][t(599)](Bt))!=null?e:Te)}_clearCollaborationTimeoutTimer(){var t=i;this[t(414)]&&(clearTimeout(this[t(414)]),this[t(414)]=null)}_startTelemetryCollaborationNewChangeset(t){var e=i;if(!this[e(367)])return;const{data:x}=t,{unitID:r,changeset:s}=x,{mutations:n,type:a}=s;this[e(252)]={unitId:r,type:a,startTime:performance[e(319)](),stopTime:0,duration:0,size:Gx(n)}}[i(371)](){var t=i;if(this[t(367)]){if(!this[t(252)]){this._logService[t(355)](t(571),"telemetry info is not initialized");return}this[t(252)][t(621)]=performance.now(),this._telemetryInfo[t(672)]=this[t(252)][t(621)]-this[t(252)].startTime,this._telemetryService[t(220)](Vx,this[t(252)]),this._telemetryInfo=null}}[i(577)](){var t=i;this[t(252)]=null}};xt=zx([D0(2,Q),D0(3,x0),D0(4,P(L0)),D0(5,P(Ft)),D0(6,P(b0)),D0(7,W(Ix))],xt);const t0=vt(i(383));function Wx(t){var e=i;return e(507)+t}Object[i(498)];var Xx=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},Et=(t,e)=>(x,r)=>e(x,r,t);function Jx(t){var e=i;const{unitID:x,mutations:r}=t;return{unitId:x,subUnitId:r[e(208)]>0?r[0][e(575)][e(563)]:null}}let j0=class{constructor(t,e,x){var r=i;this[r(307)]=t,this[r(298)]=e,this[r(671)]=x}[i(313)](t){var e=i,x,r,s,n;const a=this[e(307)][e(126)](vx),{unitId:c,subUnitId:o}=Jx(t),v=a==null?void 0:a[e(430)](c)[e(531)](),_=(r=(x=this[e(671)][e(867)](c))==null?void 0:x.getActiveSheet())==null?void 0:r.getSheetId();if(v[e(208)]===0||!c||!o)return;const f=[{id:Qt.id,params:{unitId:c,subUnitId:_,selections:qe[e(226)](v)}}],h=this._transformService[e(543)](t,f);if(!G0(h))throw h.error;const b=(n=(s=h[e(722)][0])==null?void 0:s[e(575)])==null?void 0:n[e(336)];if(Array[e(665)](b)&&b.length){if(b.length===f[0][e(575)][e(336)][e(208)]&&b.every((E,m)=>Qe[e(764)](E[e(741)],f[0][e(575)].selections[m].range)))return;this[e(307)].get(e0)[e(521)](Qt.id,{unitId:c,subUnitId:_,selections:b})}}};j0=Xx([Et(0,P(J)),Et(1,O0),Et(2,r0)],j0);const W0=vt("univer-pro.collaboration-client.single-active-unit-service");var jt=(t=>(t[t[i(811)]=0]=i(811),t[t[i(159)]=1]=i(159),t))(jt||{});const q=i(899),qx={},Qx=new Set([Ex.id]);function xe(t,e,x,r,s){var n=i,a,c,o,v;const _=[];for(const b of t)if(Qx[n(412)](b.id)){if(_.length>0)break;_[n(249)](b);break}else _.push(b);const f=(c=(a=s.getCurrentUser())==null?void 0:a[n(258)])!=null?c:n(569),h=(v=(o=s[n(214)]())==null?void 0:o[n(118)])!=null?v:n(569);return{changeset:{unitID:e,type:me(x[n(838)](e)),baseRev:r[n(513)](e),revision:0,userID:f,memberID:h,mutations:_},pendingMutations:t.slice(_[n(208)])}}function Zx(t,e,x,r,s){var n=i,a,c,o,v;const _=[t.reduce((b,E)=>{var m=j,A;const{id:M}=b,{id:w,type:U}=E,d=(A=b[m(575)])!=null?A:{actions:null},u=E.params;if(M&&M!==w)throw new Error(m(268)+M+m(820)+w+".");return{...b,id:w,type:U,params:{unitId:u[m(814)],textRanges:u[m(418)],actions:cx[m(466)](d.actions,u[m(393)])}}},{})],f=(c=(a=s.getCurrentUser())==null?void 0:a[n(258)])!=null?c:n(569),h=(v=(o=s[n(214)]())==null?void 0:o[n(118)])!=null?v:n(569);return{changeset:{unitID:e,type:me(x[n(838)](e)),baseRev:r.getCurrentRevOfUnit(e),revision:0,userID:f,memberID:h,mutations:_},pendingMutations:[]}}function Ne(t,e){var x=i;const r=new ox(1);return setTimeout(()=>r.next(e),t),r[x(475)]()[x(348)](A0(1))}const ti={id:_x.id,type:Ht.MUTATION,params:{}};Object[i(498)];var R0=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},B=(t,e)=>(x,r)=>e(x,r,t),$t=(t=>(t.NOT_COLLAB=i(830),t[i(525)]=i(117),t[i(595)]=i(794),t[i(145)]=i(232),t[i(511)]=i(421),t[i(554)]="fetch_missing",t[i(176)]=i(828),t.OFFLINE=i(769),t))($t||{});const De=6e4;class y0{constructor(e,x,r,s,n,a,c,o,v){var _=i;L(this,_(808),null),L(this,"_pendingMutations",[]),this[_(557)]=e,this[_(151)]=x,this[_(782)]=n,this._commandService=a,this._undoRedoService=c,this._revisionService=o,this[_(190)]=v,this[_(808)]=r,this[_(391)]=s}[i(171)](e){var x=i;const r=this[x(652)].getCurrentRevOfUnit(this.unitID);return e[x(892)]>r+1?(this[x(782)][x(770)]({from:r,to:e.revision-1}),!0):!1}[i(199)](e){var x=i;this[x(647)][x(617)](this[x(557)],e)}[i(660)](e){var x=i,r,s;(s=(r=this._handler)[x(318)])==null||s[x(678)](r,e)}_transformIMECache(e){var x=i,r,s;return(s=(r=this[x(782)]).onTransformIME)==null?void 0:s.call(r,e)}[i(131)](e){var x=i,r,s;return(s=(r=this._handler).onTransformState)==null?void 0:s[x(678)](r,e)}[i(438)](e){var x=i,r,s,n;return(n=(s=(r=this[x(782)])[x(329)])==null?void 0:s[x(678)](r,e))!=null?n:e}[i(709)](e){var x=i,r,s,n;return(n=(s=(r=this[x(782)]).onTransformRemoteChangesetByStateCache)==null?void 0:s[x(678)](r,e))!=null?n:e}[i(404)](e){var x=i,r,s;if(this[x(151)]===n0[x(744)]){const{unitID:n,mutations:a,memberID:c}=e,o=a[x(208)]>0?a[0][x(575)][x(418)]:[];Array[x(665)](o)&&o.length>0&&((s=(r=this[x(782)])[x(417)])==null||s.call(r,{unitID:n,memberID:c,textRanges:o}))}}_updateLocalCache(){var e=i,x;(x=this._localCacheService)==null||x[e(269)](this[e(557)],this[e(151)],this._awaitingChangeset,this[e(391)])}[i(585)](){var e=i;return this._revisionService[e(513)](this[e(557)])}[i(668)](){var e=i;this[e(652)][e(745)](this[e(557)])}[i(776)](e){var x=i,r;let s=this._transformRemoteChangesetByIMECache(e);s=this._transformRemoteChangesetByStateCache(s);const n=ax(s[x(825)],this[x(893)],{fromCollab:!0});if(!n[x(254)])throw n[x(355)]instanceof Error?n[x(355)]:new Error((r=n.error)!=null?r:"[CollaborationState]: apply error!");this[x(247)](s),this._transformStateCache(s),this[x(199)](e),this._transformSelections(s),this[x(404)](s),this._incrementRevisionNumber()}}let T0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v){var _=i;super(t,e,null,[],x,a,n,r,v),L(this,_(136),"synced"),this[_(307)]=s,this[_(211)]=c,this[_(298)]=o,this[_(445)]=v}[i(583)](t){var e=i;const x=this[e(307)][e(792)](o0,this[e(557)],this[e(151)],[t],this[e(782)]);return x._schedule(),x[e(272)](),x}onRemoteChangeset(t){var e=i;if(this._checkMissing(t))return this[e(307)][e(792)](i0,this[e(557)],this[e(151)],null,[],null,[t],this[e(782)]);try{const x=this._transformService.transformMutationsWithChangeset(t,[ti]);if(G0(x)){const{c1Prime:r}=x;return this[e(776)](r),this}throw x[e(355)]}catch(x){return this._logService.error(x),this[e(504)](!1)}}[i(504)](t){var e=i;return this[e(307)][e(792)](_0,this.unitID,this[e(151)],null,[],this[e(782)],t)}onRemoteAck(){var t=i;throw new Error(t(308))}[i(506)](){throw new Error("[SyncedState]: received rejection.")}onRemoteRetry(){return this}[i(636)](){var t=i;return this[t(307)][t(792)](E0,this[t(557)],this[t(151)],null,[],this._handler)}[i(265)](){return this}[i(873)](){throw new Error("[SyncedState]: invalid calling to `resend`.")}[i(424)](){var t=i;const e=this._revisionService.getCurrentRevOfUnit(this[t(557)]);return this[t(782)][t(770)]({from:e,to:0}),this[t(307)][t(792)](i0,this[t(557)],this.type,null,[],null,[],this[t(782)])}};T0=R0([B(3,P(h0)),B(4,P(J)),B(5,f0),B(6,e0),B(7,Q),B(8,O0),B(9,W(t0))],T0);let o0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h,b){var E=i;super(t,e,null,x,r,o,h,n,b),L(this,E(136),E(794)),L(this,E(875),null),L(this,E(235),null),this[E(307)]=s,this[E(699)]=a,this._logService=c,this._configService=v,this[E(298)]=_,this._univerInstanceService=f}[i(583)](t){var e=i;return this[e(391)][e(249)](t),this._updateLocalCache(),this}[i(799)](t){var e=i;if(this[e(171)](t))return this._clearScheduledTask(),this[e(307)][e(792)](i0,this[e(557)],this.type,null,this[e(391)],null,[t],this[e(782)]);try{const x=this._transformService[e(543)](t,this[e(391)]);if(G0(x)){const{c1Prime:r,m2Prime:s}=x;this[e(776)](r);const n=this._injector[e(792)](o0,this[e(557)],this[e(151)],s,this[e(782)]);this._clearScheduledTask();const a=new Date().getTime(),c=this[e(875)]?Math[e(149)](this[e(875)]-a,0):this[e(239)]();return n[e(178)](c),n}throw x[e(355)]}catch(x){return this._logService[e(355)](x),this[e(504)](!1)}}[i(594)](){var t=i;throw new Error(t(846))}[i(506)](){throw new Error("[PendingState]: received rejection.")}[i(900)](){return this}[i(636)](){var t=i;return this._clearScheduledTask(),this[t(307)][t(792)](E0,this.unitID,this[t(151)],null,this[t(391)],this[t(782)])}[i(265)](){return this}[i(178)](t){var e=i;const x=t??this[e(239)]();this[e(875)]=new Date()[e(156)]()+x,this[e(235)]=setTimeout(()=>{var r=e;this[r(872)]();let s=null;switch(this[r(151)]){case n0[r(370)]:{s=xe(this[r(391)],this.unitID,this[r(263)],this._revisionService,this[r(699)]);break}case n0[r(744)]:{this[r(391)][r(155)](o=>o.id===Se.id)?s=Zx(this[r(391)],this[r(557)],this[r(263)],this[r(652)],this[r(699)]):s=xe(this[r(391)],this[r(557)],this[r(263)],this[r(652)],this[r(699)]);break}default:throw new Error(r(129)+this.type+r(120))}const{changeset:n,pendingMutations:a}=s;this[r(782)].onSendChangeset(n);const c=a[r(208)]?this._injector[r(792)](c0,this.unitID,this[r(151)],n,a,this[r(782)],void 0):this[r(307)][r(792)](v0,this[r(557)],this[r(151)],n,this._handler);c[r(272)](),this._handler.onStateChange(this,c)},x)}[i(239)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x[t(567)])!=null?e:Ux}[i(873)](){var t=i;throw new Error(t(748))}[i(872)](){var t=i;this[t(235)]!=null&&(clearTimeout(this[t(235)]),this[t(235)]=null)}[i(504)](t){var e=i;return this[e(872)](),this[e(307)][e(792)](_0,this[e(557)],this[e(151)],null,this[e(391)],this[e(782)],t)}};o0=R0([B(4,P(J)),B(5,P(h0)),B(6,P(L0)),B(7,Q),B(8,e0),B(9,x0),B(10,O0),B(11,r0),B(12,f0),B(13,W(t0))],o0);let v0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v,_){var f=i;super(t,e,x,[],r,a,v,n,_),L(this,f(136),f(232)),L(this,"_resendTimeout",0),L(this,f(815)),L(this,f(736)),this._injector=s,this[f(211)]=c,this._transformService=o}[i(583)](t){var e=i;this._clearScheduledTask();const x=this._injector[e(792)](c0,this[e(557)],this[e(151)],this[e(808)],[t],this[e(782)],this[e(815)]);return x[e(272)](),x}[i(799)](t){var e=i;if(this[e(171)](t))return this[e(872)](),this[e(307)].createInstance(i0,this[e(557)],this[e(151)],this[e(808)],[],null,[t],this._handler);try{const x=this[e(298)].transformChangesets([t],[this[e(808)]],!1);if(Pt(x)){const{c1Prime:r,c2Prime:s}=x;this[e(776)](r[0]),s[0][e(353)]=this[e(585)](),this[e(872)]();const n=this._injector.createInstance(v0,this[e(557)],this.type,s[0],this[e(782)]);return n[e(272)](),n}return this[e(504)](!1)}catch(x){return this[e(211)][e(355)](x),this[e(504)](!1)}}[i(594)](t){var e=i;this[e(872)]();const x=this[e(652)][e(513)](this[e(557)]);if(t[e(892)]<x-1)return this;if(this[e(171)](t))return this[e(307)][e(792)](i0,this[e(557)],this[e(151)],null,[],this._awaitingChangeset,[],this._handler);this[e(668)]();const r=this._injector[e(792)](T0,this.unitID,this[e(151)],this[e(782)]);return r._updateLocalCache(),r}[i(506)](t){var e=i;return this._onConflict(!!(t!=null&&t[e(844)]))}[i(900)](t){var e=i;return this[e(242)]>De?this[e(636)]():(this[e(815)]=Ne(this._resendTimeout,{timeout:this[e(242)],reqId:t[e(884)]}),this[e(736)]=this._resendTimer.subscribe(({reqId:x,timeout:r})=>{var s=e;this[s(314)](x,r)}),this)}[i(636)](){var t=i;return this[t(872)](),this._injector[t(792)](E0,this.unitID,this[t(151)],this[t(808)],[],this[t(782)])}[i(265)](){return this}[i(873)](){var t=i;this._handler[t(528)](this[t(808)])}_onConflict(t){var e=i;return this[e(872)](),this[e(307)][e(792)](_0,this[e(557)],this[e(151)],this[e(808)],[],this[e(782)],t)}[i(314)](t,e){var x=i,r;t===((r=this[x(808)])==null?void 0:r[x(884)])&&(this[x(873)](),this[x(242)]=e===0?1e3:e*2)}[i(872)](){var t=i,e;(e=this[t(736)])==null||e[t(311)](),this[t(242)]=0}};v0=R0([B(4,P(J)),B(5,P(h0)),B(6,e0),B(7,Q),B(8,O0),B(9,f0),B(10,W(t0))],v0);let c0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h){var b=i;super(t,e,x,r,s,o,f,c,h),L(this,b(136),b(421)),L(this,"_resendTimeout",0),L(this,b(815)),L(this,b(736)),this[b(307)]=a,this[b(211)]=v,this[b(298)]=_,this[b(445)]=h,n&&(this._resendTimer=n,this._sender=this._resendTimer[b(461)](({reqId:E,timeout:m})=>{var A=b;this[A(314)](E,m)}))}[i(583)](t){var e=i;return this._pendingMutations[e(249)](t),this}[i(799)](t){var e=i;if(this[e(171)](t))return this[e(872)](),this[e(307)][e(792)](i0,this.unitID,this[e(151)],this[e(808)],this[e(391)],null,[t],this[e(782)]);try{const x=this[e(298)][e(497)]([t],[this[e(808)]],!1);if(Pt(x)){const{c1Prime:r,c2Prime:s}=x,n=this._transformService[e(543)](r[0],this[e(391)]);if(G0(n)){const{c1Prime:a,m2Prime:c}=n;return this[e(776)](a),s[0][e(353)]=this[e(585)](),this[e(872)](),this[e(307)][e(792)](c0,this.unitID,this[e(151)],s[0],c,this[e(782)],void 0)}throw n[e(355)]}throw x[e(355)]}catch(x){return this[e(211)][e(355)](x),this._onConflict(!1)}}onRemoteAck(t){var e=i;if(this[e(872)](),this._checkMissing(t))return this._injector.createInstance(i0,this[e(557)],this.type,null,this[e(391)],this[e(808)],[],this._handler);this[e(668)]();const x=this[e(307)][e(792)](o0,this[e(557)],this[e(151)],this[e(391)],this[e(782)]);return x[e(178)](),x[e(272)](),x}onRemoteRej(t){var e=i;return this[e(504)](!!(t!=null&&t[e(844)]))}[i(900)](t){var e=i;return this[e(242)]>De?this.toggleOffline():(this._resendTimer=Ne(this[e(242)],{timeout:this[e(242)],reqId:t[e(884)]}),this[e(736)]=this[e(815)].subscribe(({reqId:x,timeout:r})=>{var s=e;this[s(314)](x,r)}),this)}toggleOffline(){var t=i;return this._clearScheduledTask(),this._injector[t(792)](E0,this.unitID,this[t(151)],this[t(808)],this[t(391)],this[t(782)])}toggleOnline(){return this}[i(873)](){var t=i;this[t(782)][t(528)](this[t(808)])}[i(504)](t){var e=i;return this[e(872)](),this._injector[e(792)](_0,this[e(557)],this[e(151)],null,this[e(391)],this[e(782)],t)}_resendWithTimeout(t,e){var x=i,r;t===((r=this[x(808)])==null?void 0:r[x(884)])&&(this.resend(),this[x(242)]=e===0?1e3:e*2)}[i(872)](){var t=i,e;(e=this[t(736)])==null||e[t(311)](),this._resendTimeout=0}};c0=R0([B(6,P(J)),B(7,P(h0)),B(8,e0),B(9,Q),B(10,O0),B(11,f0),B(12,W(t0))],c0);let _0=class extends y0{constructor(t,e,x,r,s,n=!1,a,c,o,v,_,f,h){var b=i;super(t,e,x,r,s,c,o,v,h),L(this,b(136),"conflict"),this[b(693)]=n,this[b(578)]=a,this[b(612)]=_,this[b(634)]=f,this[b(445)]=h,this[b(264)](),this[b(869)](),this._disableEditing()}[i(583)](){return this}onRemoteChangeset(){return this}[i(594)](){return this}[i(506)](){return this}[i(900)](){return this}[i(636)](){return this}toggleOnline(){return this}[i(873)](){var t=i;throw new Error(t(407))}[i(869)](){var t=i,e;(e=this[t(190)])==null||e.updateOfflineData(this[t(557)],this[t(151)],null,[])}[i(264)](){var t=i;this._isPermissionRej?this[t(634)][t(194)]({id:a0[t(238)]}):this[t(634)][t(194)]({id:a0[t(176)]})}[i(150)](){var t=i;this._permissionService[t(152)](new et(this.unitID).id,!1)}};_0=R0([B(6,P(K0)),B(7,e0),B(8,f0),B(9,P(h0)),B(10,P(z0)),B(11,P(b0)),B(12,W(t0))],_0);let E0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v){var _=i;super(t,e,x,r,s,c,o,a,v),L(this,_(136),_(769)),this._injector=n}appendMutation(t){var e=i;return this[e(391)][e(249)](t),this._updateLocalCache(),this}onRemoteChangeset(t){var e=i;throw new Error(e(810))}onRemoteAck(){var t=i;throw new Error(t(656))}[i(506)](){var t=i;throw new Error(t(608))}[i(900)](){return this}toggleOffline(){return this}[i(265)](){const{_injector:t,_pendingMutations:e,_awaitingChangeset:x,unitID:r,_handler:s,type:n}=this,a=we(t,r,n,x,e,s);return a instanceof o0?a._schedule():(a instanceof c0||a instanceof v0)&&a.resend(),a}[i(873)](){var t=i;throw new Error(t(452))}};E0=R0([B(5,P(J)),B(6,P(h0)),B(7,e0),B(8,f0),B(9,W(t0))],E0);let i0=class extends y0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h,b){var E=i;super(t,e,x,r,a,_,f,o,b),L(this,E(136),E(733)),this[E(209)]=s,this[E(436)]=n,this[E(307)]=c,this._logService=v,this[E(298)]=h,this[E(445)]=b}[i(746)](t){var e=i;try{const x=[...t,...this[e(436)]],r=[this[e(808)]||this[e(209)]][e(437)](o=>!!o);let s,n;if(r.length){const o=this._transformService.transformChangesets(x,r,!1);if(!Pt(o))throw o.error;s=o[e(148)],n=o.c2Prime}else s=x,n=[];let a=this._pendingMutations;s[e(817)](o=>{var v=e;let _;if(a.length){const f=this[v(298)][v(543)](o,a);if(!G0(f))throw f[v(355)];_=f[v(148)],a=f[v(722)]}else _=o;this[v(776)](_)}),this[e(209)]&&this[e(668)](),this[e(808)]&&n.length&&(n[0].baseRev=this._getCurrentRevision());let c;if(this[e(808)]&&a[e(208)]!==0)c=this[e(307)][e(792)](c0,this.unitID,this[e(151)],n[0],a,this._handler,void 0);else if(this[e(808)]&&a[e(208)]===0)n[0][e(353)]=this[e(585)](),c=this[e(307)].createInstance(v0,this[e(557)],this[e(151)],n[0],this[e(782)]);else if(a.length!==0){const o=this._injector[e(792)](o0,this.unitID,this[e(151)],a,this[e(782)]);o[e(178)](),c=o}else c=this[e(307)][e(792)](T0,this[e(557)],this[e(151)],this[e(782)]);return c._updateLocalCache(),c}catch(x){return this[e(211)][e(355)](e(343),e(813),x),this[e(307)][e(792)](_0,this[e(557)],this.type,this[e(808)],this[e(391)],this._handler,!1)}}[i(873)](){throw new Error("[FetchingMissState]: invalid calling to `resend`.")}[i(583)](t){var e=i;return this[e(391)].push(t),this}[i(799)](t){var e=i;return this[e(436)].push(t),this}onRemoteAck(t){var e=i;if(this._awaitingChangeset)return this[e(209)]=this[e(808)],this[e(808)]=null,this;throw new Error(e(160))}[i(506)](t){var e=i;return this[e(504)](!!(t!=null&&t.isPermissionRej))}[i(900)](){return this}[i(636)](){var t=i;return this[t(307)][t(792)](E0,this.unitID,this[t(151)],this._awaitingChangeset,this[t(391)],this[t(782)])}[i(265)](){return this}_onConflict(t){var e=i;return this[e(307)].createInstance(_0,this.unitID,this[e(151)],this._awaitingChangeset,this._pendingMutations,this._handler,t)}};i0=R0([B(7,P(J)),B(8,P(h0)),B(9,Q),B(10,e0),B(11,f0),B(12,O0),B(13,W(t0))],i0);function we(t,e,x,r,s,n){var a=i;return r&&s[a(208)]?t[a(792)](c0,e,x,r,s,n,void 0):r?t[a(792)](v0,e,x,r,n):s[a(208)]?t[a(792)](o0,e,x,s,n):t[a(792)](T0,e,x,n)}Object[i(498)];var Vt=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},Y=(t,e)=>(x,r)=>e(x,r,t);let $0=class extends Y0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h,b){var E=i;super(),L(this,"_state$",new M0(null)),L(this,E(688),this[E(276)].asObservable()),L(this,E(141)),L(this,"_collaborationPaused",!1),L(this,E(462),""),L(this,E(158),0),L(this,E(289),this.state$.pipe(d0(m=>m?m[E(136)]:$t[E(658)]),fx(1))),L(this,E(137),!1),L(this,E(553),[]),this[E(557)]=t,this.session=e,this[E(630)]=x,this[E(307)]=r,this._compressMutationService=s,this[E(612)]=n,this._revisionService=a,this[E(346)]=c,this[E(263)]=o,this[E(211)]=v,this[E(893)]=_,this._permissionService=f,this[E(800)]=h,this[E(190)]=b}get[i(195)](){var t=i;return this[t(141)]}async[i(408)](){var t=i;if(this.state)throw new Error(t(547));await this[t(234)]()}[i(259)](){return this._collaborationPaused=!0,Q0(()=>{var t=j;this[t(882)]=!1,this[t(218)]()})}[i(243)](t){this._onLocalMutation(t)}_updateState(t){var e=i;this[e(141)]=t,this[e(276)][e(836)](t)}async _init(){var t=i,e;this[t(834)](await this[t(182)]()),this[t(800)]&&((e=this[t(800)])==null||e.editingUnit(this[t(557)]),this.disposeWithMe(this[t(800)][t(707)](this[t(557)]).subscribe(r=>{var s=t;this[s(211)].debug(s(556),s(859),r),r===jt[s(159)]?(this[s(346)][s(194)]({id:a0[s(295)]}),this[s(578)][s(152)](new et(this[s(557)]).id,!1),this[s(578)][s(358)](!1)):(this[s(578)][s(152)](new et(this[s(557)]).id,!0),this[s(578)].setShowComponents(!0))})));let x=!1;return this[t(657)](this.session.sessionStatus$.subscribe(r=>{var s=t;r===S0[s(365)]?this._toggleOnline(x):r===S0.OFFLINE&&(x=!0,this[s(529)]())})),this.disposeWithMe(this[t(360)][t(695)].subscribe(r=>{var s=t;try{switch(r[s(589)]){case k[s(891)]:{this[s(761)](Yt(r[s(163)]));break}case k[s(172)]:{this._onRemoteACK(r[s(163)]);break}case k.CHANGESET_REJ:{this[s(750)]();break}case k[s(410)]:{this._onRemoteRetry(r[s(163)]);break}case k.PSEUDO_FETCH_MISSING_RESULT:{this[s(493)](r.data[s(287)][s(864)](n=>Yt(n)));break}case k[s(338)]:{this[s(750)]({isPermissionRej:!0});break}case k[s(690)]:break}}catch(n){throw console[s(355)](s(170),n),n}})),this[t(141)]}[i(119)](){this._transitionLocked=!1}_lockTransition(){var t=i;if(this[t(137)])throw new Error("[CollaborationEntity]: cannot lock transition twice! This is an implementation error, meaning you transit the collaboration state again in the process of a previous transition. This should never happen.");this[t(137)]=!0}[i(627)](t){var e=i;this[e(843)](),this[e(834)](this[e(141)][e(583)](t)),this[e(119)]()}[i(761)](t){var e=i;if(!(t[e(892)]<=this._revisionService[e(513)](this[e(557)]))){if(this[e(882)]){this._remoteChangesetQueue[e(249)](t);return}this._applyRemoteChangeset(t)}}[i(218)](){var t=i;this[t(553)].forEach(e=>this._applyRemoteChangeset(e)),this[t(553)]=[]}[i(642)](t){var e=i;const x=this._compressMutationService[e(824)][e(139)](this._compressMutationService[e(824)][e(795)]()[e(661)])(t[e(825)],null)||t[e(825)],r={...t,mutations:x};this._lockTransition(),this[e(834)](this[e(141)][e(799)](r)),this._unlockTransition()}[i(517)](t){var e=i;this[e(843)](),this[e(834)](this[e(141)][e(594)](t)),this[e(119)]()}_onRemoteRejected(t){var e=i;this[e(843)](),this[e(834)](this._state[e(506)](t)),this[e(119)]()}_onRemoteRetry(t){var e=i;this[e(843)](),this[e(834)](this._state[e(900)](t)),this._unlockTransition()}[i(493)](t){var e=i;if(!(this[e(141)]instanceof i0))throw new TypeError(e(153));const x=t[e(864)](r=>{var s=e;const n=this[s(526)][s(824)][s(139)](this[s(526)].interceptor[s(795)]()[s(661)])(r[s(825)],null)||r[s(825)];return{...r,mutations:n}});this[e(843)](),this[e(834)](this[e(141)].onMissedChangesetFetched(x)),this[e(119)]()}_toggleOffline(){var t=i;this[t(843)](),this[t(834)](this[t(141)].toggleOffline()),this._unlockTransition()}[i(236)](t=!1){var e=i;this[e(843)](),this[e(834)](this[e(141)][e(265)]()),this[e(119)]();const x=this._state;t&&x instanceof T0&&(this._lockTransition(),this[e(834)](x[e(424)]()),this._unlockTransition())}async[i(182)](){return new Promise(t=>{var e=j;this[e(360)][e(251)][e(348)](A0(1)).subscribe(async x=>{var r=e;t(await this[r(675)](x===S0.ONLINE))})})}[i(372)](){const t=this.unitID;return{onStateChange:(e,x)=>{var r=j;if(e!==this[r(141)])throw new Error(r(477)+e.status+`
After: `+x.status+`
Current: `+this[r(141)][r(136)]);this[r(834)](x)},onSendChangeset:e=>{var x=j;e[x(491)]||(e[x(491)]=this._changesetSessionId,e[x(884)]=++this[x(158)]);const r={eventID:k.SUBMIT_CHANGESET,data:{unitID:e[x(557)],unitType:this[x(630)],changeset:e,memberID:this.session.getMemberID()}};this[x(360)][x(629)](r,this[x(557)])},onMissingChangesets:({from:e,to:x})=>{var r=j;this[r(211)].debug(r(556),r(379)+e+r(823)+x);const s={eventID:k[r(219)],data:{unitID:t,unitType:this[r(630)],from:e,to:x}};this[r(360)][r(629)](s,this[r(557)])}}}async[i(675)](t){var e=i,x,r,s;const n=await((x=this._localCacheService)==null?void 0:x.loadOfflineData(this.unitID)),a=(r=n==null?void 0:n[e(825)])!=null?r:[],c=(s=n==null?void 0:n[e(476)])!=null?s:null,o=!!(c!=null&&c[e(491)])&&!!(c!=null&&c.reqId);this[e(462)]=o?c[e(491)]:He(),this._changesetReqId=o?c[e(884)]:0;const v=this[e(557)];try{this[e(524)](c,a)}catch(f){this._logService.error(f)}const _=this[e(372)]();if(t){const f=we(this[e(307)],v,this._type,c,a,_);return f instanceof o0?f[e(178)]():(f instanceof c0||f instanceof v0)&&f[e(873)](),f}return this._injector[e(792)](E0,v,this[e(630)],c,a,_)}[i(524)](t,e){var x=i,r,s;const n=this._compressMutationService[x(824)].fetchThroughInterceptors(this._compressMutationService.interceptor[x(795)]()[x(661)]);(r=n((t==null?void 0:t[x(825)])||[],null))==null||r[x(817)](a=>this[x(893)][x(521)](a.id,a.params)),(s=n(e||[],null))==null||s[x(817)](a=>this[x(893)][x(521)](a.id,a[x(575)]))}};$0=Vt([Y(3,P(J)),Y(4,P(kt)),Y(5,P(z0)),Y(6,P(h0)),Y(7,P(b0)),Y(8,r0),Y(9,Q),Y(10,e0),Y(11,K0),Y(12,W(W0)),Y(13,W(t0))],$0);let it=class extends $0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h,b){var E=i;super(t,x,e,r,s,n,a,c,o,v,_,f,h,b),L(this,E(738),null),this[E(557)]=t,this[E(151)]=e}[i(641)](t){var e=i;this[e(738)]=t}dispose(){var t=i;this[t(738)]=null,super[t(114)]()}[i(372)](){var t=i;const e=super[t(372)]();return e[t(333)]=x=>{var r=t,s,n;return(n=(s=this[r(738)])==null?void 0:s[r(333)])==null?void 0:n[r(678)](s,x)},e[t(431)]=x=>{var r=t,s,n;return(n=(s=this[r(738)])==null?void 0:s[r(431)])==null?void 0:n[r(678)](s,x)},e[t(318)]=x=>{var r=t,s,n;return(n=(s=this._handlerCallback)==null?void 0:s[r(318)])==null?void 0:n[r(678)](s,x)},e[t(417)]=x=>{var r=t,s,n;return(n=(s=this[r(738)])==null?void 0:s.onSyncEditingCollabCursor)==null?void 0:n[r(678)](s,x)},e[t(329)]=x=>{var r=t,s,n,a;if(!((s=this[r(738)])!=null&&s[r(329)]))throw new Error(r(448));return(a=(n=this._handlerCallback)==null?void 0:n[r(329)])==null?void 0:a[r(678)](n,x)},e[t(396)]=x=>{var r=t,s,n,a;if(!((s=this._handlerCallback)!=null&&s[r(396)]))throw new Error(r(180));return(a=(n=this[r(738)])==null?void 0:n.onTransformRemoteChangesetByStateCache)==null?void 0:a[r(678)](n,x)},e}async[i(234)](){var t=i;const e=await super[t(234)]();return this[t(657)](this._commandService[t(503)]((x,r)=>{var s=t;if(x[s(151)]!==Ht[s(518)]||r!=null&&r[s(703)]||r!=null&&r.onlyLocal||x.id===Se.id)return;const n=x.params;if((n==null?void 0:n[s(814)])!==this[s(557)])return;const a=x,c=this[s(526)][s(824)].fetchThroughInterceptors(this._compressMutationService[s(824)].getInterceptPoints().COMPRESS_MUTATION_SEND)([a],this[s(263)])||[a];this[s(627)](c[0])})),e}};it=Vt([Y(3,P(J)),Y(4,P(kt)),Y(5,P(z0)),Y(6,P(h0)),Y(7,P(b0)),Y(8,r0),Y(9,Q),Y(10,e0),Y(11,K0),Y(12,W(W0)),Y(13,W(t0))],it);let rt=class extends $0{constructor(t,e,x,r,s,n,a,c,o,v,_,f,h,b,E){var m=i;super(t,x,e,r,s,n,a,o,v,_,f,h,b,E),this.unitID=t,this[m(151)]=e,this[m(403)]=c}[i(372)](){var t=i;const e=super[t(372)]();return e[t(318)]=x=>this[t(403)][t(313)](x),e}async[i(234)](){var t=i;const e=await super[t(234)]();return this.disposeWithMe(this[t(893)].onCommandExecuted((x,r)=>{var s=t;if(x.type!==Ht.MUTATION||r!=null&&r[s(703)]||r!=null&&r[s(674)])return;const n=x.params;if((n==null?void 0:n[s(814)])!==this[s(557)])return;const a=x,c=this[s(526)][s(824)][s(139)](this[s(526)][s(824)][s(795)]().COMPRESS_MUTATION_SEND)([a],this._univerInstanceService)||[a];this[s(627)](c[0])})),e}};rt=Vt([Y(3,P(J)),Y(4,P(kt)),Y(5,P(z0)),Y(6,P(h0)),Y(7,P(j0)),Y(8,P(b0)),Y(9,r0),Y(10,Q),Y(11,e0),Y(12,K0),Y(13,W(W0)),Y(14,W(t0))],rt);const Ue=vt(i(902));function Ae(t){var e=i,x,r,s,n,a;const c=t[e(163)],o=JSON[e(303)](c);switch(o[e(315)]){case z.HEARTBEAT:case z[e(282)]:{const v=o[e(460)];return{...o,data:v,cmd:o.cmd}}case z[e(509)]:{const v=o[e(427)];return{...o,data:v,cmd:o[e(315)]}}case z.RECV:{const v=o.collaMsg;switch(v[e(589)]){case k[e(338)]:return{...o,data:{...v,data:(x=v[e(316)])==null?void 0:x.cs},cmd:o[e(315)]};case k.CHANGESET_ACK:return{...o,data:{...v,data:(r=v[e(267)])==null?void 0:r.cs},cmd:o[e(315)]};case k[e(891)]:return{...o,data:{...v,data:(s=v[e(334)])==null?void 0:s.cs},cmd:o[e(315)]};case k[e(535)]:return{...o,data:{...v,data:(n=v.csRejEvent)==null?void 0:n.cs},cmd:o.cmd};case k[e(410)]:return{...o,data:{...v,data:(a=v.csShouldRetryEvent)==null?void 0:a.cs},cmd:o[e(315)]};case k[e(142)]:return{...o,data:{...v,data:v[e(413)]},cmd:o[e(315)]};case k[e(169)]:return{...o,data:{...v,data:v[e(192)]},cmd:o[e(315)]};case k.USERS_LEAVE:return{...o,data:{...v,data:v[e(387)]},cmd:o[e(315)]};case k[e(444)]:return{...o,data:{...v,data:v[e(622)]},cmd:o[e(315)]};case k.LIVESHARE_FETCH_OPERATIONS:case k[e(620)]:return{...o,data:{...v,data:v.liveShareOperation},cmd:o[e(315)]};case k[e(689)]:return{...o,data:{...v,data:v[e(622)]},cmd:o.cmd};case k.MSG_FOR_ERROR:return{...o,data:v,cmd:o[e(315)]};case k[e(739)]:return{...o,data:{...v,data:v[e(858)]},cmd:o[e(315)]};case k[e(146)]:return{...o,data:{...v,data:v[e(386)]},cmd:o[e(315)]};case k[e(853)]:return{...o,data:{...v,data:v[e(229)]},cmd:o.cmd};case k[e(690)]:return{...o,data:{...v,data:v[e(889)]},cmd:o.cmd};default:return o}}default:return o}}function Me(t){var e=i;switch(t[e(315)]){case z[e(777)]:case z[e(282)]:return JSON.stringify({cmd:t[e(315)],routeKey:t.routeKey});case z[e(261)]:{let x;switch(t[e(163)].eventID){case k[e(142)]:{x={eventID:k[e(142)],updateCursorEvent:t.data[e(163)]};break}case k[e(614)]:{x={eventID:k[e(614)],leaveEvent:t[e(163)][e(163)]};break}case k[e(169)]:{x={eventID:k.USERS_ENTER,joinEvent:t[e(163)][e(163)]};break}case k.LIVESHARE_NEW_HOST:{x={eventID:k[e(444)],liveShareNewHost:t[e(163)][e(163)]};break}case k[e(620)]:{x={eventID:k[e(620)],liveShareOperation:t[e(163)][e(163)]};break}case k[e(689)]:{x={eventID:k[e(689)],liveShareTerminate:t[e(163)][e(163)]};break}case k.LIVESHARE_REQUEST_HOST:{x={eventID:k.LIVESHARE_REQUEST_HOST,liveShareRequestHost:t[e(163)].data};break}case k[e(747)]:{x={eventID:k[e(747)]};break}default:x={eventID:t.data[e(589)]}}return JSON[e(878)]({cmd:t.cmd,routeKey:t.routeKey,collaMsg:x})}case z[e(509)]:return JSON.stringify({cmd:t.cmd,routeKey:t.routeKey,joinReq:t[e(163)]});case z.LEAVE:return JSON[e(878)]({cmd:t[e(315)],routeKey:t[e(645)],leaveReq:t.data});default:throw new Error(e(870))}}Object[i(498)];var ei=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},H0=(t,e)=>(x,r)=>e(x,r,t);const Gt=vt(i(281));function xi(t,e,x){var r=i;return t+"/"+e+"/unit/"+x+r(306)}let gt=class extends k0{constructor(t,e,x,r,s){var n=i;super(),this._injector=t,this._httpService=e,this[n(633)]=x,this[n(211)]=r,this[n(534)]=s}[i(778)](t){var e=i;const x=this[e(307)][e(126)](Sx);if(!x)throw new Error(e(804));const r=x[e(758)](t);if(!r)throw new Error("[CollaborationSocketService]: failed to create socket!");const s=new Xe,n=new l0;s[e(221)](r[e(154)][e(461)](_=>n[e(836)](_))),s.add(Q0(()=>n[e(681)]()));const a=new l0;s.add(r[e(426)].subscribe(_=>a[e(836)](_))),s[e(221)](Q0(()=>a.complete()));const c=new l0;s.add(r[e(760)][e(461)](_=>{const f=Ae(_);c.next(f)})),s[e(221)](Q0(()=>c[e(681)]()));let o;const v=()=>{var _=e;a[_(836)](new Event(_(648))),n[_(836)](new Event("connection error")),o[_(453)]()};return o={memberID:"",close$:n.asObservable(),error$:a[e(475)](),open$:r[e(632)],message$:c.asObservable(),send:_=>{var f=e;if(_.cmd===z[f(261)]){if(_[f(163)][f(589)]===k[f(631)]){this[f(279)](o,_[f(163)])[f(849)](h=>{var b=f;this[b(211)][b(355)](h),v()});return}if(_[f(163)][f(589)]===k[f(219)]){const h=_[f(163)];this[f(881)](h).then(b=>{var E=f;c.next({cmd:z[E(420)],code:C0.OK,routeKey:h[E(163)][E(557)],routeType:"",data:{eventID:k[E(766)],data:{changesets:b}}})}).catch(b=>{this._logService.error(b),v()});return}}r.send(Me(_))},close:()=>{var _=e;r.close(),s[_(114)]()}},o}async[i(279)](t,e){var x=i,r;const{unitType:s,unitID:n,changeset:a}=e[x(163)],c={unitID:n,memberID:t[x(118)],type:s,changeset:Be(a)},o=this[x(633)][x(599)](q),v=xi((r=o==null?void 0:o[x(454)])!=null?r:Bx,s,n);try{await this[x(349)][x(821)](v,{body:c})}catch(_){throw this._logService[x(355)](x(571),x(340)),_}}async[i(881)](t){var e=i;const{unitID:x,from:r,to:s,unitType:n}=t[e(163)];return(await this[e(534)][e(362)]({metadata:void 0},{unitID:x,type:n,from:r,to:s})).changesets[e(864)](a=>((a[e(825)]===null||a[e(825)]===void 0)&&(a[e(825)]=[]),a))}};gt=ei([H0(0,P(J)),H0(1,P(g0)),H0(2,x0),H0(3,Q),H0(4,Ie)],gt);Object[i(498)];var ii=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},w0=(t,e)=>(x,r)=>e(x,r,t);let P0=class extends k0{constructor(t,e,x,r,s,n){var a=i;super(),L(this,a(759),new M0(void 0)),L(this,a(500),this[a(759)][a(475)]()),L(this,a(499),null),L(this,a(623),new Map),L(this,a(650),new M0(S0[a(108)])),L(this,a(289),this._status$.asObservable()),L(this,a(135),!1),L(this,"_retryConnectingTimer"),L(this,a(677),0),L(this,a(373)),L(this,"_timeoutTimer"),this[a(307)]=t,this[a(211)]=e,this[a(633)]=x,this._socketService=r,this[a(634)]=s,this[a(459)]=n,this[a(132)]()}get _socket(){var t=i;return this[t(759)][t(786)]()}[i(132)](){var t=i;this._networkConditionService&&this[t(657)](this[t(459)][t(283)][t(461)](e=>{var x=t;e&&!this[x(422)]&&this[x(682)](),e||this[x(339)]()}))}[i(114)](){var t=i;super.dispose(),this[t(692)](),this[t(561)](),this[t(469)](),this[t(623)].forEach(e=>e.dispose()),this[t(623)].clear(),this[t(650)][t(681)]()}async[i(649)](t){var e=i;if(this[e(623)][e(412)](t))return this[e(623)][e(126)](t);this._tryEnsureSocket();const x=this[e(307)][e(792)](xt,t,this[e(759)][e(475)]());return this[e(623)][e(130)](t,x),x}[i(326)](t){var e=i,x;const r=this[e(623)].get(t);r&&(this[e(623)][e(277)](t),r[e(453)]()),this[e(623)][e(248)]||(x=this[e(422)])==null||x[e(453)]()}[i(682)](){var t=i;this[t(677)]=0,this._clearRetryConnectingTimer(),this._tryReconnect()}[i(692)](){var t=i;this._retryConnectingTimer!=null&&(clearTimeout(this[t(592)]),this._retryConnectingTimer=null)}async[i(715)](){var t=i,e;const x=this[t(633)].getConfig(q),r=(e=x==null?void 0:x[t(241)])!=null?e:ge,s=await this._socketService.createSocket(r);return this[t(499)]=s,s}async[i(550)](){var t=i,e,x;try{const r=(x=(e=this._socket)!=null?e:this[t(499)])!=null?x:await this._createSocket();if(r){const s=r[t(629)];r[t(629)]=n=>(this._rescheduleHeartbeat(),s[t(735)](r,[n])),r[t(760)][t(461)](n=>this[t(779)](r,n)),r[t(426)].pipe(A0(1)).subscribe(n=>this[t(211)].error(t(565),n)),r[t(632)].pipe(A0(1))[t(461)](()=>{this._onConnectionOpen(r)}),r.close$[t(348)](A0(1))[t(461)](n=>{var a=t;this[a(211)][a(210)](a(866),"socket close",n),this[a(527)]()})}}catch(r){this[t(211)][t(355)](r),this[t(527)]()}}[i(406)](t){var e=i;this[e(211)][e(210)]("[CollaborationSessionService]",e(708)),t.send({cmd:z[e(282)]}),this[e(698)]()}[i(339)](){var t=i;this[t(135)]=!1,this[t(499)]=null,this[t(650)][t(836)](S0.OFFLINE),this[t(759)][t(836)](null),this[t(561)](),this[t(469)]()}_onConnectionFailed(){var t=i,e;this[t(339)](),this[t(677)]<((e=this._configService[t(599)](Oe))!=null?e:Px)?(this._collaborationUIEventService.emitEvent({id:a0[t(773)]}),this[t(818)]()):this._collaborationUIEventService[t(194)]({id:a0[t(266)]})}[i(818)](){var t=i,e;const x=this._retryCount,r=this._configService.getConfig(q),s=x===0?0:((e=r==null?void 0:r[t(803)])!=null?e:Lx)*2**x;this[t(592)]=setTimeout(()=>{var n=t;clearTimeout(this[n(592)]),this._retryConnectingTimer=null,this[n(550)]()},s),this[t(677)]+=1}_onMessage(t,e){var x=i;const{cmd:r}=e;r===z.HELLO&&!this[x(135)]&&(t.memberID=e[x(163)][x(118)],this._socket$[x(836)](t),this[x(650)][x(836)](S0[x(365)]),this[x(135)]=!0,this[x(499)]=null),r===z.HEARTBEAT&&this[x(561)](),this[x(698)]()}[i(698)](){var t=i,e;this[t(469)](),this[t(373)]=setTimeout(()=>this[t(601)](),(e=this[t(633)][t(599)](Ce))!=null?e:Mx)}[i(601)](){var t=i;this._socket[t(629)]({cmd:z[t(777)]}),this._waitForHeartbeatResponse()}[i(659)](){var t=i,e;this[t(847)]=setTimeout(()=>this[t(527)](),(e=this[t(633)][t(599)](Bt))!=null?e:Te)}[i(469)](){var t=i;this[t(373)]!=null&&(clearTimeout(this[t(373)]),this[t(373)]=null)}[i(561)](){var t=i;this[t(847)]!=null&&(clearTimeout(this._timeoutTimer),this._timeoutTimer=null)}};P0=ii([w0(0,P(J)),w0(1,Q),w0(2,x0),w0(3,Gt),w0(4,P(b0)),w0(5,W(Ue))],P0);Object[i(498)];var ri=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},q0=(t,e)=>(x,r)=>e(x,r,t);let V0=class extends Y0{constructor(t,e,x,r){var s=i,n;super(),L(this,s(240),new Map),L(this,"_entityInit$",new l0),L(this,"entityInit$",this[s(250)][s(475)]()),this[s(307)]=t,this[s(549)]=e,this[s(633)]=x,this._univerInstanceService=r,((n=this[s(633)][s(599)](q))==null?void 0:n[s(609)])!==!1&&this[s(234)]()}dispose(){var t=i;super[t(114)](),this[t(240)][t(817)](e=>e[t(114)]()),this._entities.clear()}[i(711)](t){var e=i,x;return(x=this._entities[e(126)](t))!=null?x:null}[i(752)](t){var e=i;const x=this[e(711)](t);return x?pe(x):this._entityInit$.pipe(U0(r=>r.unitID===t))}[i(325)](t){var e=i;return ze(this[e(752)](t).pipe(d0(()=>{})))}[i(234)](){var t=i;this[t(263)][t(574)](s0.UNIVER_SHEET)[t(348)](p0(this.dispose$),Zt(16)).subscribe(async e=>{var x=t;const r=e.getUnitId(),s=await this[x(191)](r,n0[x(370)]);this[x(240)][x(130)](r,s)}),this[t(263)].getTypeOfUnitAdded$(s0[t(744)]).pipe(p0(this[t(730)]),Zt(16))[t(348)](U0(e=>!e.getUnitId().startsWith("__"))).subscribe(async e=>{var x=t;const r=e[x(309)](),s=await this[x(191)](r,n0.UNIVER_DOC);this[x(240)].set(r,s)}),tt(this._univerInstanceService[t(809)](s0[t(370)]),this._univerInstanceService.getTypeOfUnitDisposed$(s0[t(744)]))[t(348)](p0(this[t(730)])).subscribe(e=>{var x=t;const r=e[x(309)](),s=this[x(240)][x(126)](r);s&&(s[x(114)](),this[x(240)][x(277)](r))})}async _startCollaboration(t,e){var x=i;const r=await this._collabSessionService[x(649)](t),s=this[x(307)][x(792)](this[x(591)](e),t,e,r);return await s.init(),this._entityInit$[x(836)](s),s}_getCtorByUniverType(t){var e=i;switch(t){case n0[e(744)]:return it;case n0.UNIVER_SHEET:return rt;default:throw new Error(e(704)+t)}}};V0=ri([q0(0,P(J)),q0(1,P(P0)),q0(2,x0),q0(3,r0)],V0);var si=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},ie=(t,e)=>(x,r)=>e(x,r,t);const ni="DEFAULT_FILE_NAME",ai=i(604);let Ct=class extends k0{constructor(t,e){var x=i;super(),this[x(263)]=t,this._configService=e,this[x(234)]()}_init(){var t=i;this[t(657)](this[t(263)][t(827)][t(461)](()=>{var e=t,x;const r=this[e(263)][e(855)]();let s=(x=this[e(633)][e(599)](ni))!=null?x:ai;r instanceof hx&&(s=r.name),document.title=s}))}};Ct=si([ie(0,r0),ie(1,x0)],Ct);Object[i(498)];var oi=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},bt=(t,e)=>(x,r)=>e(x,r,t);let st=class{constructor(t,e,x){var r=i;this[r(633)]=t,this[r(349)]=e,this[r(480)]=x,this[r(408)]()}init(){var t=i;this._httpService[t(416)]({priority:1,interceptor:(e,x)=>x(e).pipe(Cx(async r=>{var s=t;const n=r;if(n[s(136)]===401){if(typeof window>"u")throw new Error(s(368));if(window[s(470)](this.localeService.t(s(299)))){const a=window[s(245)](window[s(861)][s(618)]);window.location[s(618)]=this._getLoginPath()+s(366)+a}}return n}))})}[i(409)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x[t(237)])!=null?e:Fx}};st=oi([bt(0,x0),bt(1,P(g0)),bt(2,P(z0))],st);function nt(){var t=["call","_scheduleCollaborationTimeoutTimer","signUrlServerUrl","complete","reconnect","setCurrentUser","_event$","NoPadding","_clearCollaborationTimeoutTimer","CHANGESET_REVISION_CONFILICT","state$","LIVESHARE_TERMINATE","UNISCRIPT_RUN","YUUMI_ASYNCIO_CANCELLED","_clearRetryConnectingTimer","_isPermissionRej","_onUserJoin","event$","_substituteRedoStack","ERROR_IMAGE_TYPE","_rescheduleHeartbeat","_memberService","MOBILE_VERIFY_CODE_MISMATCH","hostname","_prevBlock","fromCollab","[CollaborationController]: invalid univer type: ","ALREADY_EXISTS","hasOwnProperty","getUnitStatus$","socket open.","_transformRemoteChangesetByStateCache","createDecryptor","getCollabEntity","EMAIL_HAS_BEEN_BOUND","substr","_getUploadFileURL","_createSocket","prototype","60FCOjdH","GLOBAL_ROOMS_CNT_EXCEEDS","CipherParams","unitInfo$","REDEMPTION_CODE_INACTIVE","m2Prime","exports","287932OLbckZ","Cipher","BlockCipherMode","UNAUTHENTICATED","YUUMI_PROMPT_MAX_TOKENS_EXCEEDED","charAt","dispose$","_createHelper","ws://127.0.0.1:8000/universer-api/comb/connect","fetch_missing","decrypt","apply","_sender","getRandomValues","_handlerCallback","COMMENT_UPDATE","LOGIN_TOKEN_PROCESSING_FAILED","range","Base","patch","UNIVER_DOC","incrementRevOfUnit","onMissedChangesetFetched","LIVESHARE_FETCH_OPERATIONS","[PendingState]: invalid calling to `resend`.","_members$","_onRemoteRejected","batchAllowed","getCollabEntity$","Native crypto module could not be used to get secure random number.","kdf","_commentService","slice","name","createSocket","_socket$","message$","_onRemoteChangeset","_roomCreated$","requestParams","equals","create","PSEUDO_FETCH_MISSING_RESULT","_userManagerService","SNAPSHOT_HAS_BEEN_REMOVED","offline","onMissingChangesets","4869352KInCri","_unitID","SOCKET_FAILED_RETRY","HMAC","APPLY_NON_SEQUENTIAL_REVISION","_executeRemoteChangeset","HEARTBEAT","_doCreateSocket","_onMessage","subject","INTERNAL_ERROR","_handler","loadUnit","[UniverCollaborationClientPlugin]","getSnapshotAPIPath","getValue","updateCollaborator","clear","[CollaborationSession]: should not send message when the session is offline!","ceil","PAYMENT_CHANNEL_NOT_SUPPORT","createInstance","_clearUndo","pending","getInterceptPoints","USER_NOT_FOUND","198184kJeOuF","[DataLoaderService]","onRemoteChangeset","_singleActiveUnitService","REDEMPTION_USER_NOT_ELIGIBLE","ERROR_EXCEED_SIZE","retryConnectingInterval","[CollaborationSocketService]: failed to get web socket factory!","_keySchedule","BlockCipher","update","_awaitingChangeset","getTypeOfUnitDisposed$","[OfflineState]: received changeset.","NO_OTHER_CLIENTS_EDITING","listCollaborators","failed to apply missed changesets!","unitId","_resendTimer","finalize","forEach","_tryReconnect","_substituteUndoStack"," - ","post","salt"," to ","interceptor","mutations","ClipsheetFragments","focused$","conflict","_map","not_collab","abs","_mode","reduce","_updateState","REDEMPTION_USER_REDEEM_TIMES_EXCEED","next","Hex","getUnitType","UNIVER_SLIDE","session.join-failed","sessionStatus","objectActions","_lockTransition","isPermissionRej","session.room-not-exists","[PendingState]: received acknowledgement.","_timeoutTimer","entries","catch","_clearRedo","getImage","from","SHOULD_CLOSE_CONN","YUUMI_RATE_OVER_LIMIT","getFocusedUnit","/block/","allowed","commentUpdateEvent","editing status changed to","INVITE_CODE_HAS_BEEN_UES","location","_replaceFileID","7inZbGL","map","/object/","[CollaborationSessionService]","getUnit","transformStack failed!","_clearLocalCache","[serializeCombRequest]: should not fall into default branch!","floor","_clearScheduledTask","resend","enableAuthServer","_scheduleCompleteTimestamp","REDEMPTION_INVALID_CODE","_createHmacHelper","stringify","src","saveChangeset","_fetchMissChangesets","_collaborationPaused","objectType","reqId","_sessionStatus$","YUUMI_CONNECTOR_URL_NOT_FOUND","clone","session.room-permission-denied","uniscriptRunEvent","SUCCUSS","NEW_CHANGESETS","revision","_commandService","image/jpeg","POST","_doProcessBlock","initWorkbookPermissionChange","reject","collaboration-client.config","onRemoteRetry","LICENSE_MAX_UNITS_EXCEEDED","univer-pro.collaboration-client.network-condition.service","IDLE","YUUMI_TABLE_NOT_FOUND_IN_UNIT","commentUpdate$","getAllMembers","getMember","_onJoinRoomEvent","dispose","Hasher","_reverseMap","synced","memberID","_unlockTransition"," in _schedule.","saveSheetBlock","replace","2129436CvaGEI","msCrypto","loadSheet","get","__creator","algo","[PendingState]: unhandled univer type: ","set","_transformStateCache","_listenToNetworkCondition","blockSize","mode","_socketReady","status","_transitionLocked","random","fetchThroughInterceptors","append","_state","UPDATE_CURSOR","YUUMI_URL_COL_OUT_OF_RANGE","UNKNOWN_CMD","AWAITING","UPDATE_PERMISSION_OBJ","image/png","c1Prime","max","_disableEditing","type","updatePermissionPoint","[CollaborationEntity]: cannot apply missing results on other states!","close$","every","getTime","_ENC_XFORM_MODE","_changesetReqId","OTHER_CLIENTS_EDITING","[FetchingMissState]: not expected to receive ack when `this._awaitingChangeset` is null!","MSG_FOR_ERROR","UNKNOWN_CODE","data","x-univer-host","byteOffset","/resources","REDEMPTION_CODE_NOT_STARTED","join","USERS_ENTER","Error on receiving event","_checkMissing","CHANGESET_ACK","LICENSE_MAX_MEMBERS_PER_UNIT_EXCEEDED","image/gif","authzUrl","CONFLICT","AUTHORIZE_CODE_ILLEGAL","_schedule","_decreaseWaiting","onTransformRemoteChangesetByStateCache callback is not added yet.","Undefined","_createInitialState","UUID","_key","OPTIONAL","url","/universer-api/stream/file/upload","/universer-api/authz","&to=","_localCacheService","_startCollaboration","joinEvent","hasher","emitEvent","state","ERROR_IMAGE","listRoles","2125251xQoJcF","_transformUndoredo","_startTelemetryCollaborationNewChangeset","INVALID_INVITE_CODE","_nDataBytes","onStarting","encode","setWaitCount","USER_NOT_INVITED_CODE","cfg","length","_acknowledgedAwaitingChangeset","debug","_logService","updateSnapshot","UNRECOGNIZED","getCurrentUser","ENSURE_SNAPSHOT_EXECUTION","originalMeta","resolve","_exhaustRemoteChangesetQueue","FETCH_MISSING","capture","add","ENTITLE_NEED_BILLING_ADDRESS","crypto","_removeRoom","/allowed","deepClone","mixIn","symbol","shouldCloseConn",'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.',"SHA1","awaiting","YUUMI_ALL_TABLES_IS_INVALID","_init","_sendingTimer","_toggleOnline","loginUrlKey","PERMISSION_DENIED","_getSendChangesetTimeout","_entities","collabWebSocketUrl","_resendTimeout","onLocalMutation","ERROR_AGAIN","encodeURIComponent","BufferedBlockAlgorithm","_transformIMECache","size","push","_entityInit$","sessionStatus$","_telemetryInfo","_imageSourceCache","result","socketService","19467882XRrCvT","[CollaborationUndoRedoService]","userID","pauseCollaboration","_nRounds","INGEST","collaboratorID","_univerInstanceService","_showConflictNotification","toggleOnline","SOCKET_FAILED","csAckEvent","Cannot assemble a changeset from multiple mutations of different types: ","updateOfflineData","JOIN_ROOM_FULL","_emitMembers","_updateLocalCache","ENTITLE_REPORT_LIMIT_EXCEED","_roomMembers","action","_state$","delete","_onRecvEvent","_submitChangeset","OpenSSL","univer-pro.collaboration-client-socket-service","HELLO","online$","_initRequestHeader","default","readAsDataURL","changesets","_redoStacks","status$","_invKeySchedule","snapshotServerUrl","_append","ENTITLE_CAN_NOT_BUY_LOWER_OTP","objects","OTHER_CLIENT_EDITING","roles","findIndex","_transformService","auth.needGotoLoginAlert","extend","getUnitOnRev","YUUMI_SUBSCRIPTION_NOT_FOUND","parse","_data","UserProfileImg","/new_changes","_injector","[SyncedState]: received acknowledgement.","getUnitId","LEAVE","unsubscribe","&source=","transformSelections","_resendWithTimeout","cmd","permissionRejEvent","function","onTransformSelections","now","HttpImport","padding","_parse","ciphertext","byteLength","readyForCollab","closeSession","JOIN_ROOM_PERMISSION_DENIED","_members","onTransformRemoteChangesetByIMECache","REMOTE_UNISCRIPT_EXECUTION_ENDPOINT","EMAIL_VERIFY_CODE_MISMATCH","LICENSE_IMPORT_SIZE_EXCEEDED","onTransformIME","newCsEvent","headers","selections","_xformMode","PERMISSION_REJ","_onOffline","submit changeset error!","buffer","_config","[FetchMissState]","objectID","_transformStack","_eventService","__Key__","pipe","_httpService","_minBufferSize","[UniverCollaborationClientPlugin]: you must provide a socketService implementation in config!","REDEMPTION_CODE_HAS_BEEN_CREATED","baseRev","_waitCount","error","_telemetryService","_doCryptBlock","setShowComponents","_cipher","session","LICENSE_DISTRO_REJECTED","fetchMissingChangesets","collaborators","Failed to update permission point","ONLINE","?url=","_shouldReportTelemetry","[AuthServerService]: you should provide authentication info on Node.js.","_getUndoStack","UNIVER_SHEET","_stopTelemetryCollaborationNewChangeset","_createHandler","_sendHeartbeatTimer","488788wUKoYO","_initCloseConn","COMPLETION_FINISHED","UnitSnapshot","target","fetching missing changesets from ","UNIVER_PROJECT","EMAIL_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","_hash","collaboration-client.local-cache-service","loadOfflineData","APPLY_REJECT","updatePermissionObjEvent","leaveEvent","compute","SUBMIT_CHANGESET_TIMEOUT","_collaborationSessionService","_pendingMutations","_snapshotService","actions","encrypt","getResourcesRequest","onTransformRemoteChangesetByStateCache","_change$","_updateStatus","unitId is not found","deleteCollaborator","This method should not be called on the client side!","_commentUpdate$","_sheetTransformSelectionsService","_syncEditingCollabCursor","roomInfos","_onConnectionOpen","[ConflictState]: invalid calling to `resend`.","init","_getLoginPath","CHANGESET_SHOULD_RETRY","onCommentUpdate","has","updateCursorEvent","_collaborationTimeoutTimer","includes","registerHTTPInterceptor","onSyncEditingCollabCursor","textRanges","LICENSE_EXPORT_SIZE_EXCEEDED","RECV","awaiting_with_pending","_socket","INVITE_CODE_ALREADY_BOUND","fetchMiss","_iv","error$","joinRsp","REDEMPTION_CODE_FULLY_REDEEMED","DATA_SOURCE_TOO_LARGE","getWorkbookSelections","onTransformState","body","defineProperty","createCollaborator","_hasher","_queuedRemoteChangesets","filter","_transformRemoteChangesetByIMECache","pad","ivSize","toString","disableLocalCache","Decryptor","LIVESHARE_NEW_HOST","localCacheService","avatar","APPLY_DUPLICATED","onTransformRemoteChangesetByIMECache callback is not added yet.","override","_getAPIPrefix","Utf8","[OfflineState]: invalid calling to `resend`.","close","collabSubmitChangesetUrl","list","MD5","concat","processBlock","_networkConditionService","infoRsp","subscribe","_changesetSessionId","getSheetBlock","JOINING","/universer-api/oidc/authpage","compose","onload","sigBytes","_clearHeartbeatTimer","confirm","/universer-api/snapshot","AES","createEncryptor","getRoom","asObservable","awaitingChangeset",`[CollaborationEntity]: invalid state transition! State transferred from is not the current state.
Before: `,"/universer-api/snapshot/","saveImage","localeService","keySize","pluginName","image/bmp","UNDEFINED","YUUMI_NO_CUBOID_FOR_QUESTION","People","INVALID_ARGUMENT","FAIL","save fail reason is ","updateMember","sid","randomBytes","_onFetchMissResult","_unitInfo$","members","/fetchmissing?from=","transformChangesets","getOwnPropertyDescriptor","_candidateSocket","socket$","enc","rev","onCommandExecuted","_onConflict","NOT_FOUND","onRemoteRej","unit-cache-","Encryptor","JOIN","Base64","AWAITING_WITH_PENDING","BASE64","getCurrentRevOfUnit","waitForRoom$","values","_DEC_XFORM_MODE","_onRemoteACK","MUTATION","_doFinalize","reset","executeCommand","/collaborator","/role","_replayCachedMutations","SYNCED","_compressMutationService","_onConnectionFailed","onSendChangeset","_toggleOffline","HttpExport","getCurrentSelections","getMemberID","LOGIN_FAILED","_snapshotServerService","CHANGESET_REJ","ENTITLE_UPDOWN_GRADE_NOT_SUPPORT","_getRedoStack","key","__esModule","APPLY_REVISION_CONFILICT","WECHAT_HAS_BEEN_BOUND","method","transformMutationsWithChangeset","_onUserLeave","ENTITLE_DUP_SUBSCRIPTION","_process",'[CollaborationEntity]: initial state has been created before. You should not call "init" twice.',"Pkcs7","_collabSessionService","_tryEnsureSocket","ENTITLE_CHAT_LIMIT_EXCEED","MOBILE_VERIFY_CODE_NOT_FOUND_OR_EXPIRED","_remoteChangesetQueue","FETCH_MISS","_initUnitPermissionChange","[CollaborationEntity]","unitID","JOIN_ROOM_FAILED","change$","YUUMI_AI_RUN_FAILED","_clearTimeoutTimer","charCodeAt","subUnitId","$super","[CollaborationSessionService]: socket error","_oKey","sendChangesetTimeout","putCollaborators","unknown","WordArray","[CollaborationSession]","UnitEmbedded","FileId","getTypeOfUnitAdded$","params","MOBILE_HAS_BEEN_BOUND","_throwTelemetryCollaborationNewChangeset","_permissionService","words","/object","_initMergeInterceptor","_initDependencies","appendMutation","loadUnitOfRevision","_getCurrentRevision","format","_socketMessageSubscription","removeMember","eventID","RETRY_CONNECTING_MAX_COUNT","_getCtorByUniverType","_retryConnectingTimer","SNAPSHOT_INVALID_SNAPSHOT","onRemoteAck","PENDING","reverse","CLOSE_ROOM","APPLY_PERMISSION_DENIED","getConfig","min","_sendHeartbeat","saveSnapshot","clamp","Univer","Latin1","indexOf","code","[OfflineState]: received rejection.","enableCollaboration","unpad","PERSON","_localeService","find","USERS_LEAVE","fetching the latest document from the server.","JOIN_ROOM_NOT_EXISTS","transformUndoRedo","href","/unit/","LIVESHARE_OPERATION","stopTime","liveShareNewHost","_sessions","/-/object/-/batch_allowed","Malformed UTF-8 data","_getSignURL","_onLocalMutation","getImageSourceCache","send","_type","SUBMIT_CHANGESET","open$","_configService","_collaborationUIEventService","HmacSHA1","toggleOffline","decryptBlock","execute","collaboration_new_changeset","EvpKDF","addHandlerCallback","_applyRemoteChangeset","YUUMI_UNABLE_LOAD_URL",'you should override "IUndoRedoService" provided in "core" package!',"routeKey","_registerDependencies","_undoRedoService","connection error","requireSession","_status$","string","_revisionService","splice","_iKey","_getAPIPrefixPath","[OfflineState]: received acknowledgement.","disposeWithMe","OFFLINE","_waitForHeartbeatResponse","_transformSelections","COMPRESS_MUTATION_APPLY","USER_IS_ANONYMOUS","_HTTPService","lib","isArray","_getDownloadEndpointURL","fromCharCode","_incrementRevisionNumber","CURRENT_STATUS_CANNOT_OPERATE","members$","_instanceService","duration","SerializableCipher","onlyLocal","_createInitialStateImpl","sin","_retryCount"];return nt=function(){return t},nt()}Object[i(498)];var ci=(t,e,x,r)=>{for(var s=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=a(s)||s);return s},re=(t,e)=>(x,r)=>e(x,r,t);const hi=i(188);let at=class extends k0{constructor(t,e){var x=i;super(),this[x(663)]=t,this[x(633)]=e,this[x(581)]()}_initMergeInterceptor(){var t=i;const e=this;this[t(657)](this[t(663)][t(416)]({priority:999,interceptor:mx({isMatch(x){var r=t,s;if(x[r(542)]===r(895)&&(s=x[r(763)])!=null&&s.body){const{objectID:n,objectType:a}=x[r(763)][r(432)]||{};if(!n||a===void 0)return!1;const c=e[r(655)]()+"/"+a+"/object/"+n+r(225);if(x[r(186)]===c)return!0}return!1},getParamsFromRequest(x){var r=t,s;return(s=x[r(763)])==null?void 0:s[r(432)]},mergeParamsToRequest(x,r){var s=t;const n=e._getAPIPrefixPath()+s(624),a=x[s(833)]((o,v)=>{var _=s;const{unitID:f,objectID:h,objectType:b,actions:E}=v;return o[f]||(o[f]={}),o[f][h]||(o[f][h]={objectID:h,objectType:b,actions:[]}),o[f][h][_(393)][_(249)](...E),o},{}),c=[];for(const o in a)for(const v in a[o]){const{actions:_,objectType:f}=a[o][v],h=[...new Set(_)];c[s(249)]({unitID:o,objectID:v,objectType:f,actions:h})}return new px("POST",n,{headers:r[s(335)],withCredentials:r.withCredentials,responseType:r.responseType,body:{requests:c}})}},{distributeResult(x,r){var s=t;const{objectActions:n}=x;return r[s(864)](a=>{var c=s;const{unitID:o,objectID:v,actions:_}=a,f=n[c(613)](b=>b[c(557)]===o&&b[c(344)]===v),h=_[c(864)](b=>f==null?void 0:f[c(393)][c(613)](E=>E[c(275)]===b)).filter(b=>!!b);return{config:a,result:{actions:h,error:x[c(355)]}}})}})}))}[i(655)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x[t(175)])!=null?e:hi}async[i(765)](t){var e=i;const x=this[e(655)]()+"/"+t[e(883)]+e(580);return(await this[e(663)][e(821)](x,{body:t}))[e(432)][e(344)]||""}async[i(455)](t){var e=i;const x=this[e(655)]()+"/-/object/list";return(await this[e(663)][e(821)](x,{body:t}))[e(432)][e(294)]}async[i(807)](t){var e=i,x,r;const s=this._getAPIPrefixPath()+"/"+t[e(883)]+e(865)+t[e(344)],n=await this._HTTPService.put(s,{body:t});if(((r=(x=n==null?void 0:n[e(432)])==null?void 0:x[e(355)])==null?void 0:r[e(607)])!==1)throw new Error(e(364))}async[i(857)](t){var e=i;const x=this[e(655)]()+"/"+t[e(883)]+e(865)+t.objectID+"/allowed";return(await this[e(663)][e(821)](x,{body:t}))[e(432)][e(393)]}async[i(751)](t){var e=i;const x=this[e(655)]()+e(624);return(await this[e(663)].post(x,{body:{requests:t}}))[e(432)][e(842)]}async[i(197)](t){var e=i;const x=this._getAPIPrefixPath()+"/"+t[e(883)]+e(523),r=await this[e(663)].post(x,{body:t});return{roles:r[e(432)][e(296)],actions:r[e(432)][e(393)]}}async[i(400)](t){var e=i;const x=this._getAPIPrefixPath()+"/collaborator";await this._HTTPService[e(277)](x,{params:{collaboratorID:t[e(262)],objectID:t[e(344)],unitID:t[e(557)]}})}async[i(787)](t){var e=i;const x=this._getAPIPrefixPath()+"/collaborator";await this[e(663)][e(743)](x,{body:t})}async[i(434)](t){var e=i;const x=this._getAPIPrefixPath()+e(522);await this[e(663)][e(821)](x,{body:t})}async[i(812)](t){var e=i;const x=this[e(655)]()+e(522);return(await this[e(663)][e(126)](x,{params:{objectID:t.objectID,unitID:t.unitID}}))[e(432)][e(363)]}async[i(568)](t){var e=i;const x=this[e(655)]()+e(522);await this[e(663)].put(x,{body:t})}};at=ci([re(0,P(g0)),re(1,P(x0))],at);var It=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function X0(t){var e=i;return t&&t[e(539)]&&Object[e(716)][e(706)][e(678)](t,e(285))?t[e(285)]:t}var Tt={exports:{}};function ui(t){var e=i;throw new Error('Could not dynamically require "'+t+e(230))}var Ot={exports:{}},di=Ot[i(723)],se;function u0(){var t=i;return se||(se=1,function(e,x){(function(r,s){var n=j;e[n(723)]=s()})(di,function(){var r=r||function(s,n){var a=j,c;if(typeof window<"u"&&window[a(223)]&&(c=window[a(223)]),typeof self<"u"&&self[a(223)]&&(c=self[a(223)]),typeof globalThis<"u"&&globalThis.crypto&&(c=globalThis[a(223)]),!c&&typeof window<"u"&&window.msCrypto&&(c=window[a(124)]),!c&&typeof It<"u"&&It[a(223)]&&(c=It[a(223)]),!c&&typeof ui=="function")try{c=require("crypto")}catch{}var o=function(){var d=a;if(c){if(typeof c[d(737)]==d(317))try{return c[d(737)](new Uint32Array(1))[0]}catch{}if(typeof c[d(492)]==d(317))try{return c[d(492)](4).readInt32LE()}catch{}}throw new Error(d(753))},v=Object[a(765)]||function(){function d(){}return function(u){var I=j,S;return d[I(716)]=u,S=new d,d[I(716)]=null,S}}(),_={},f=_[a(664)]={},h=f.Base=function(){return{extend:function(d){var u=j,I=v(this);return d&&I.mixIn(d),(!I[u(706)]("init")||this[u(408)]===I[u(408)])&&(I.init=function(){var S=u;I[S(564)][S(408)][S(735)](this,arguments)}),I.init[u(716)]=I,I[u(564)]=this,I},create:function(){var d=j,u=this[d(300)]();return u[d(408)][d(735)](u,arguments),u},init:function(){},mixIn:function(d){var u=j;for(var I in d)d[u(706)](I)&&(this[I]=d[I]);d[u(706)](u(441))&&(this.toString=d.toString)},clone:function(){var d=j;return this[d(408)].prototype[d(300)](this)}}}(),b=f[a(570)]=h[a(300)]({init:function(d,u){var I=a;d=this[I(579)]=d||[],u!=n?this[I(468)]=u:this[I(468)]=d.length*4},toString:function(d){var u=a;return(d||m)[u(878)](this)},concat:function(d){var u=a,I=this[u(579)],S=d[u(579)],O=this.sigBytes,H=d[u(468)];if(this[u(603)](),O%4)for(var G=0;G<H;G++){var $=S[G>>>2]>>>24-G%4*8&255;I[O+G>>>2]|=$<<24-(O+G)%4*8}else for(var l=0;l<H;l+=4)I[O+l>>>2]=S[l>>>2];return this[u(468)]+=H,this},clamp:function(){var d=a,u=this.words,I=this[d(468)];u[I>>>2]&=4294967295<<32-I%4*8,u[d(208)]=s[d(790)](I/4)},clone:function(){var d=a,u=h.clone[d(678)](this);return u.words=this[d(579)][d(756)](0),u},random:function(d){for(var u=a,I=[],S=0;S<d;S+=4)I.push(o());return new b[u(408)](I,d)}}),E=_.enc={},m=E[a(837)]={stringify:function(d){for(var u=a,I=d[u(579)],S=d.sigBytes,O=[],H=0;H<S;H++){var G=I[H>>>2]>>>24-H%4*8&255;O[u(249)]((G>>>4).toString(16)),O[u(249)]((G&15).toString(16))}return O.join("")},parse:function(d){for(var u=a,I=d[u(208)],S=[],O=0;O<I;O+=2)S[O>>>3]|=parseInt(d[u(713)](O,2),16)<<24-O%8*4;return new b[u(408)](S,I/2)}},A=E[a(605)]={stringify:function(d){for(var u=a,I=d[u(579)],S=d[u(468)],O=[],H=0;H<S;H++){var G=I[H>>>2]>>>24-H%4*8&255;O[u(249)](String.fromCharCode(G))}return O[u(168)]("")},parse:function(d){for(var u=a,I=d.length,S=[],O=0;O<I;O++)S[O>>>2]|=(d.charCodeAt(O)&255)<<24-O%4*8;return new b[u(408)](S,I)}},M=E[a(451)]={stringify:function(d){var u=a;try{return decodeURIComponent(escape(A[u(878)](d)))}catch{throw new Error(u(625))}},parse:function(d){var u=a;return A[u(303)](unescape(encodeURIComponent(d)))}},w=f[a(246)]=h.extend({reset:function(){var d=a;this[d(304)]=new b[d(408)],this[d(202)]=0},_append:function(d){var u=a;typeof d==u(651)&&(d=M[u(303)](d)),this._data[u(457)](d),this._nDataBytes+=d[u(468)]},_process:function(d){var u=a,I,S=this[u(304)],O=S[u(579)],H=S.sigBytes,G=this[u(133)],$=G*4,l=H/$;d?l=s[u(790)](l):l=s[u(149)]((l|0)-this[u(350)],0);var p=l*G,T=s[u(600)](p*4,H);if(p){for(var g=0;g<p;g+=G)this[u(896)](O,g);I=O[u(653)](0,p),S[u(468)]-=T}return new b.init(I,T)},clone:function(){var d=a,u=h[d(887)][d(678)](this);return u[d(304)]=this[d(304)].clone(),u},_minBufferSize:0});f.Hasher=w[a(300)]({cfg:h[a(300)](),init:function(d){var u=a;this.cfg=this[u(207)][u(300)](d),this[u(520)]()},reset:function(){var d=a;w[d(520)][d(678)](this),this._doReset()},update:function(d){var u=a;return this[u(292)](d),this._process(),this},finalize:function(d){var u=a;d&&this._append(d);var I=this[u(519)]();return I},blockSize:16,_createHelper:function(d){return function(u,I){var S=j;return new d[S(408)](I)[S(816)](u)}},_createHmacHelper:function(d){return function(u,I){var S=j;return new U[S(774)][S(408)](d,I)[S(816)](u)}}});var U=_[a(128)]={};return _}(Math);return r})}(Ot)),Ot[t(723)]}var Rt={exports:{}},li=Rt[i(723)],ne;function Le(){var t=i;return ne||(ne=1,function(e,x){(function(r,s){var n=j;e[n(723)]=s(u0())})(li,function(r){var s=j;return function(){var n=j,a=r,c=a[n(664)],o=c[n(570)],v=a[n(501)];v[n(510)]={stringify:function(f){var h=n,b=f[h(579)],E=f.sigBytes,m=this[h(829)];f[h(603)]();for(var A=[],M=0;M<E;M+=3)for(var w=b[M>>>2]>>>24-M%4*8&255,U=b[M+1>>>2]>>>24-(M+1)%4*8&255,d=b[M+2>>>2]>>>24-(M+2)%4*8&255,u=w<<16|U<<8|d,I=0;I<4&&M+I*.75<E;I++)A[h(249)](m[h(729)](u>>>6*(3-I)&63));var S=m[h(729)](64);if(S)for(;A[h(208)]%4;)A[h(249)](S);return A.join("")},parse:function(f){var h=n,b=f.length,E=this[h(829)],m=this[h(116)];if(!m){m=this[h(116)]=[];for(var A=0;A<E.length;A++)m[E[h(562)](A)]=A}var M=E[h(729)](64);if(M){var w=f[h(606)](M);w!==-1&&(b=w)}return _(f,b,m)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function _(f,h,b){for(var E=n,m=[],A=0,M=0;M<h;M++)if(M%4){var w=b[f[E(562)](M-1)]<<M%4*2,U=b[f.charCodeAt(M)]>>>6-M%4*2,d=w|U;m[A>>>2]|=d<<24-A%4*8,A++}return o[E(765)](m,A)}}(),r[s(501)][s(510)]})}(Rt)),Rt[t(723)]}var yt={exports:{}},fi=yt[i(723)],ae;function vi(){var t=i;return ae||(ae=1,function(e,x){(function(r,s){var n=j;e[n(723)]=s(u0())})(fi,function(r){var s=j;return function(n){var a=j,c=r,o=c[a(664)],v=o.WordArray,_=o[a(115)],f=c[a(128)],h=[];(function(){for(var w=a,U=0;U<64;U++)h[U]=n[w(831)](n[w(676)](U+1))*4294967296|0})();var b=f[a(456)]=_[a(300)]({_doReset:function(){var w=a;this[w(382)]=new v[w(408)]([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(w,U){for(var d=a,u=0;u<16;u++){var I=U+u,S=w[I];w[I]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360}var O=this[d(382)][d(579)],H=w[U+0],G=w[U+1],$=w[U+2],l=w[U+3],p=w[U+4],T=w[U+5],g=w[U+6],C=w[U+7],F=w[U+8],V=w[U+9],K=w[U+10],X=w[U+11],Z=w[U+12],I0=w[U+13],m0=w[U+14],J0=w[U+15],R=O[0],y=O[1],N=O[2],D=O[3];R=E(R,y,N,D,H,7,h[0]),D=E(D,R,y,N,G,12,h[1]),N=E(N,D,R,y,$,17,h[2]),y=E(y,N,D,R,l,22,h[3]),R=E(R,y,N,D,p,7,h[4]),D=E(D,R,y,N,T,12,h[5]),N=E(N,D,R,y,g,17,h[6]),y=E(y,N,D,R,C,22,h[7]),R=E(R,y,N,D,F,7,h[8]),D=E(D,R,y,N,V,12,h[9]),N=E(N,D,R,y,K,17,h[10]),y=E(y,N,D,R,X,22,h[11]),R=E(R,y,N,D,Z,7,h[12]),D=E(D,R,y,N,I0,12,h[13]),N=E(N,D,R,y,m0,17,h[14]),y=E(y,N,D,R,J0,22,h[15]),R=m(R,y,N,D,G,5,h[16]),D=m(D,R,y,N,g,9,h[17]),N=m(N,D,R,y,X,14,h[18]),y=m(y,N,D,R,H,20,h[19]),R=m(R,y,N,D,T,5,h[20]),D=m(D,R,y,N,K,9,h[21]),N=m(N,D,R,y,J0,14,h[22]),y=m(y,N,D,R,p,20,h[23]),R=m(R,y,N,D,V,5,h[24]),D=m(D,R,y,N,m0,9,h[25]),N=m(N,D,R,y,l,14,h[26]),y=m(y,N,D,R,F,20,h[27]),R=m(R,y,N,D,I0,5,h[28]),D=m(D,R,y,N,$,9,h[29]),N=m(N,D,R,y,C,14,h[30]),y=m(y,N,D,R,Z,20,h[31]),R=A(R,y,N,D,T,4,h[32]),D=A(D,R,y,N,F,11,h[33]),N=A(N,D,R,y,X,16,h[34]),y=A(y,N,D,R,m0,23,h[35]),R=A(R,y,N,D,G,4,h[36]),D=A(D,R,y,N,p,11,h[37]),N=A(N,D,R,y,C,16,h[38]),y=A(y,N,D,R,K,23,h[39]),R=A(R,y,N,D,I0,4,h[40]),D=A(D,R,y,N,H,11,h[41]),N=A(N,D,R,y,l,16,h[42]),y=A(y,N,D,R,g,23,h[43]),R=A(R,y,N,D,V,4,h[44]),D=A(D,R,y,N,Z,11,h[45]),N=A(N,D,R,y,J0,16,h[46]),y=A(y,N,D,R,$,23,h[47]),R=M(R,y,N,D,H,6,h[48]),D=M(D,R,y,N,C,10,h[49]),N=M(N,D,R,y,m0,15,h[50]),y=M(y,N,D,R,T,21,h[51]),R=M(R,y,N,D,Z,6,h[52]),D=M(D,R,y,N,l,10,h[53]),N=M(N,D,R,y,K,15,h[54]),y=M(y,N,D,R,G,21,h[55]),R=M(R,y,N,D,F,6,h[56]),D=M(D,R,y,N,J0,10,h[57]),N=M(N,D,R,y,g,15,h[58]),y=M(y,N,D,R,I0,21,h[59]),R=M(R,y,N,D,p,6,h[60]),D=M(D,R,y,N,X,10,h[61]),N=M(N,D,R,y,$,15,h[62]),y=M(y,N,D,R,V,21,h[63]),O[0]=O[0]+R|0,O[1]=O[1]+y|0,O[2]=O[2]+N|0,O[3]=O[3]+D|0},_doFinalize:function(){var w=a,U=this[w(304)],d=U[w(579)],u=this._nDataBytes*8,I=U.sigBytes*8;d[I>>>5]|=128<<24-I%32;var S=n.floor(u/4294967296),O=u;d[(I+64>>>9<<4)+15]=(S<<8|S>>>24)&16711935|(S<<24|S>>>8)&4278255360,d[(I+64>>>9<<4)+14]=(O<<8|O>>>24)&16711935|(O<<24|O>>>8)&4278255360,U[w(468)]=(d.length+1)*4,this[w(546)]();for(var H=this._hash,G=H.words,$=0;$<4;$++){var l=G[$];G[$]=(l<<8|l>>>24)&16711935|(l<<24|l>>>8)&4278255360}return H},clone:function(){var w=a,U=_[w(887)][w(678)](this);return U._hash=this[w(382)].clone(),U}});function E(w,U,d,u,I,S,O){var H=w+(U&d|~U&u)+I+O;return(H<<S|H>>>32-S)+U}function m(w,U,d,u,I,S,O){var H=w+(U&u|d&~u)+I+O;return(H<<S|H>>>32-S)+U}function A(w,U,d,u,I,S,O){var H=w+(U^d^u)+I+O;return(H<<S|H>>>32-S)+U}function M(w,U,d,u,I,S,O){var H=w+(d^(U|~u))+I+O;return(H<<S|H>>>32-S)+U}c[a(456)]=_._createHelper(b),c.HmacMD5=_[a(877)](b)}(Math),r[s(456)]})}(yt)),yt[t(723)]}var Nt={exports:{}},Dt={exports:{}},_i=Dt[i(723)],oe;function Ei(){return oe||(oe=1,function(t,e){(function(x,r){var s=j;t[s(723)]=r(u0())})(_i,function(x){var r=j;return function(){var s=j,n=x,a=n[s(664)],c=a[s(570)],o=a[s(115)],v=n.algo,_=[],f=v[s(231)]=o[s(300)]({_doReset:function(){var h=s;this[h(382)]=new c[h(408)]([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(h,b){for(var E=s,m=this[E(382)][E(579)],A=m[0],M=m[1],w=m[2],U=m[3],d=m[4],u=0;u<80;u++){if(u<16)_[u]=h[b+u]|0;else{var I=_[u-3]^_[u-8]^_[u-14]^_[u-16];_[u]=I<<1|I>>>31}var S=(A<<5|A>>>27)+d+_[u];u<20?S+=(M&w|~M&U)+1518500249:u<40?S+=(M^w^U)+1859775393:u<60?S+=(M&w|M&U|w&U)-1894007588:S+=(M^w^U)-899497514,d=U,U=w,w=M<<30|M>>>2,M=A,A=S}m[0]=m[0]+A|0,m[1]=m[1]+M|0,m[2]=m[2]+w|0,m[3]=m[3]+U|0,m[4]=m[4]+d|0},_doFinalize:function(){var h=s,b=this[h(304)],E=b[h(579)],m=this._nDataBytes*8,A=b.sigBytes*8;return E[A>>>5]|=128<<24-A%32,E[(A+64>>>9<<4)+14]=Math[h(871)](m/4294967296),E[(A+64>>>9<<4)+15]=m,b[h(468)]=E[h(208)]*4,this[h(546)](),this[h(382)]},clone:function(){var h=s,b=o.clone[h(678)](this);return b._hash=this[h(382)][h(887)](),b}});n.SHA1=o[s(731)](f),n[s(635)]=o[s(877)](f)}(),x[r(231)]})}(Dt)),Dt.exports}var wt={exports:{}},bi=wt[i(723)],ce;function Ii(){var t=i;return ce||(ce=1,function(e,x){(function(r,s){var n=j;e[n(723)]=s(u0())})(bi,function(r){(function(){var s=j,n=r,a=n[s(664)],c=a[s(742)],o=n[s(501)],v=o[s(451)],_=n[s(128)];_[s(774)]=c[s(300)]({init:function(f,h){var b=s;f=this._hasher=new f[b(408)],typeof h=="string"&&(h=v[b(303)](h));var E=f[b(133)],m=E*4;h[b(468)]>m&&(h=f.finalize(h)),h[b(603)]();for(var A=this._oKey=h[b(887)](),M=this._iKey=h[b(887)](),w=A[b(579)],U=M[b(579)],d=0;d<E;d++)w[d]^=1549556828,U[d]^=909522486;A[b(468)]=M[b(468)]=m,this.reset()},reset:function(){var f=s,h=this[f(435)];h[f(520)](),h.update(this[f(654)])},update:function(f){var h=s;return this[h(435)].update(f),this},finalize:function(f){var h=s,b=this._hasher,E=b[h(816)](f);b[h(520)]();var m=b[h(816)](this[h(566)][h(887)]()[h(457)](E));return m}})})()})}(wt)),wt[t(723)]}var mi=Nt[i(723)],he;function Pe(){var t=i;return he||(he=1,function(e,x){(function(r,s,n){var a=j;e[a(723)]=s(u0(),Ei(),Ii())})(mi,function(r){var s=j;return function(){var n=j,a=r,c=a[n(664)],o=c[n(742)],v=c.WordArray,_=a.algo,f=_[n(456)],h=_.EvpKDF=o.extend({cfg:o[n(300)]({keySize:128/32,hasher:f,iterations:1}),init:function(b){var E=n;this[E(207)]=this[E(207)][E(300)](b)},compute:function(b,E){for(var m=n,A,M=this[m(207)],w=M[m(193)].create(),U=v.create(),d=U[m(579)],u=M[m(481)],I=M.iterations;d.length<u;){A&&w[m(807)](A),A=w.update(b)[m(816)](E),w.reset();for(var S=1;S<I;S++)A=w[m(816)](A),w[m(520)]();U.concat(A)}return U[m(468)]=u*4,U}});a[n(640)]=function(b,E,m){var A=n;return h[A(765)](m)[A(388)](b,E)}}(),r[s(640)]})}(Nt)),Nt[t(723)]}var Ut={exports:{}},pi=Ut[i(723)],ue;function ke(){return ue||(ue=1,function(t,e){(function(x,r,s){var n=j;t[n(723)]=r(u0(),Pe())})(pi,function(x){var r=j;x[r(664)][r(725)]||function(s){var n=r,a=x,c=a[n(664)],o=c[n(742)],v=c[n(570)],_=c[n(246)],f=a[n(501)];f[n(451)];var h=f.Base64,b=a[n(128)],E=b[n(640)],m=c[n(725)]=_[n(300)]({cfg:o[n(300)](),createEncryptor:function(l,p){var T=n;return this[T(765)](this[T(157)],l,p)},createDecryptor:function(l,p){var T=n;return this.create(this[T(516)],l,p)},init:function(l,p,T){var g=n;this[g(207)]=this[g(207)][g(300)](T),this._xformMode=l,this[g(184)]=p,this.reset()},reset:function(){var l=n;_[l(520)][l(678)](this),this._doReset()},process:function(l){var p=n;return this[p(292)](l),this._process()},finalize:function(l){var p=n;l&&this._append(l);var T=this[p(519)]();return T},keySize:128/32,ivSize:128/32,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function l(p){var T=j;return typeof p==T(651)?$:O}return function(p){return{encrypt:function(T,g,C){return l(g).encrypt(p,T,g,C)},decrypt:function(T,g,C){return l(g).decrypt(p,T,g,C)}}}}()});c.StreamCipher=m.extend({_doFinalize:function(){var l=n,p=this[l(546)](!0);return p},blockSize:1});var A=a.mode={},M=c[n(726)]=o[n(300)]({createEncryptor:function(l,p){var T=n;return this.Encryptor[T(765)](l,p)},createDecryptor:function(l,p){var T=n;return this[T(443)].create(l,p)},init:function(l,p){var T=n;this[T(359)]=l,this[T(425)]=p}}),w=A.CBC=function(){var l=n,p=M.extend();p[l(508)]=p[l(300)]({processBlock:function(g,C){var F=l,V=this[F(359)],K=V[F(133)];T[F(678)](this,g,C,K),V.encryptBlock(g,C),this._prevBlock=g.slice(C,C+K)}}),p.Decryptor=p[l(300)]({processBlock:function(g,C){var F=l,V=this[F(359)],K=V[F(133)],X=g[F(756)](C,C+K);V[F(637)](g,C),T.call(this,g,C,K),this[F(702)]=X}});function T(g,C,F){var V=l,K,X=this[V(425)];X?(K=X,this[V(425)]=s):K=this[V(702)];for(var Z=0;Z<F;Z++)g[C+Z]^=K[Z]}return p}(),U=a.pad={},d=U[n(548)]={pad:function(l,p){for(var T=n,g=p*4,C=g-l[T(468)]%g,F=C<<24|C<<16|C<<8|C,V=[],K=0;K<C;K+=4)V[T(249)](F);var X=v[T(765)](V,C);l.concat(X)},unpad:function(l){var p=n,T=l[p(579)][l[p(468)]-1>>>2]&255;l[p(468)]-=T}};c.BlockCipher=m[n(300)]({cfg:m[n(207)][n(300)]({mode:w,padding:d}),reset:function(){var l=n,p;m.reset[l(678)](this);var T=this.cfg,g=T.iv,C=T[l(134)];this[l(337)]==this[l(157)]?p=C[l(473)]:(p=C[l(710)],this._minBufferSize=1),this._mode&&this[l(832)][l(127)]==p?this[l(832)][l(408)](this,g&&g.words):(this[l(832)]=p.call(C,this,g&&g.words),this[l(832)].__creator=p)},_doProcessBlock:function(l,p){var T=n;this._mode[T(458)](l,p)},_doFinalize:function(){var l=n,p,T=this[l(207)].padding;return this._xformMode==this[l(157)]?(T.pad(this[l(304)],this[l(133)]),p=this[l(546)](!0)):(p=this[l(546)](!0),T[l(610)](p)),p},blockSize:128/32});var u=c[n(719)]=o[n(300)]({init:function(l){var p=n;this[p(227)](l)},toString:function(l){return(l||this.formatter).stringify(this)}}),I=a[n(586)]={},S=I[n(280)]={stringify:function(l){var p=n,T,g=l.ciphertext,C=l[p(822)];return C?T=v[p(765)]([1398893684,1701076831])[p(457)](C)[p(457)](g):T=g,T[p(441)](h)},parse:function(l){var p=n,T,g=h.parse(l),C=g[p(579)];return C[0]==1398893684&&C[1]==1701076831&&(T=v[p(765)](C[p(756)](2,4)),C[p(653)](0,4),g[p(468)]-=16),u[p(765)]({ciphertext:g,salt:T})}},O=c[n(673)]=o[n(300)]({cfg:o.extend({format:S}),encrypt:function(l,p,T,g){var C=n;g=this[C(207)].extend(g);var F=l[C(473)](T,g),V=F.finalize(p),K=F[C(207)];return u[C(765)]({ciphertext:V,key:T,iv:K.iv,algorithm:l,mode:K[C(134)],padding:K[C(321)],blockSize:l[C(133)],formatter:g[C(586)]})},decrypt:function(l,p,T,g){var C=n;g=this[C(207)][C(300)](g),p=this[C(322)](p,g.format);var F=l[C(710)](T,g)[C(816)](p[C(323)]);return F},_parse:function(l,p){return typeof l=="string"?p.parse(l,this):l}}),H=a[n(754)]={},G=H[n(280)]={execute:function(l,p,T,g,C){var F=n;if(g||(g=v.random(64/8)),C)var V=E[F(765)]({keySize:p+T,hasher:C})[F(388)](l,g);else var V=E[F(765)]({keySize:p+T})[F(388)](l,g);var K=v[F(765)](V[F(579)][F(756)](p),T*4);return V.sigBytes=p*4,u[F(765)]({key:V,iv:K,salt:g})}},$=c.PasswordBasedCipher=O[n(300)]({cfg:O[n(207)][n(300)]({kdf:G}),encrypt:function(l,p,T,g){var C=n;g=this[C(207)].extend(g);var F=g.kdf.execute(T,l[C(481)],l[C(440)],g[C(822)],g[C(193)]);g.iv=F.iv;var V=O[C(394)].call(this,l,p,F[C(538)],g);return V.mixIn(F),V},decrypt:function(l,p,T,g){var C=n;g=this[C(207)].extend(g),p=this[C(322)](p,g[C(586)]);var F=g[C(754)][C(638)](T,l[C(481)],l.ivSize,p.salt,g[C(193)]);g.iv=F.iv;var V=O[C(734)][C(678)](this,l,p,F.key,g);return V}})}()})}(Ut)),Ut.exports}var Si=Tt[i(723)],de;function gi(){return de||(de=1,function(t,e){(function(x,r,s){t.exports=r(u0(),Le(),vi(),Pe(),ke())})(Si,function(x){return function(){var r=j,s=x,n=s[r(664)],a=n[r(806)],c=s[r(128)],o=[],v=[],_=[],f=[],h=[],b=[],E=[],m=[],A=[],M=[];(function(){for(var d=[],u=0;u<256;u++)u<128?d[u]=u<<1:d[u]=u<<1^283;for(var I=0,S=0,u=0;u<256;u++){var O=S^S<<1^S<<2^S<<3^S<<4;O=O>>>8^O&255^99,o[I]=O,v[O]=I;var H=d[I],G=d[H],$=d[G],l=d[O]*257^O*16843008;_[I]=l<<24|l>>>8,f[I]=l<<16|l>>>16,h[I]=l<<8|l>>>24,b[I]=l;var l=$*16843009^G*65537^H*257^I*16843008;E[O]=l<<24|l>>>8,m[O]=l<<16|l>>>16,A[O]=l<<8|l>>>24,M[O]=l,I?(I=H^d[d[d[$^H]]],S^=d[d[S]]):I=S=1}})();var w=[0,1,2,4,8,16,32,64,128,27,54],U=c.AES=a[r(300)]({_doReset:function(){var d=r,u;if(!(this[d(260)]&&this._keyPriorReset===this._key)){for(var I=this._keyPriorReset=this[d(184)],S=I[d(579)],O=I[d(468)]/4,H=this[d(260)]=O+6,G=(H+1)*4,$=this[d(805)]=[],l=0;l<G;l++)l<O?$[l]=S[l]:(u=$[l-1],l%O?O>6&&l%O==4&&(u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[u&255]):(u=u<<8|u>>>24,u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[u&255],u^=w[l/O|0]<<24),$[l]=$[l-O]^u);for(var p=this[d(290)]=[],T=0;T<G;T++){var l=G-T;if(T%4)var u=$[l];else var u=$[l-4];T<4||l<=4?p[T]=u:p[T]=E[o[u>>>24]]^m[o[u>>>16&255]]^A[o[u>>>8&255]]^M[o[u&255]]}}},encryptBlock:function(d,u){var I=r;this._doCryptBlock(d,u,this[I(805)],_,f,h,b,o)},decryptBlock:function(d,u){var I=r,S=d[u+1];d[u+1]=d[u+3],d[u+3]=S,this[I(357)](d,u,this._invKeySchedule,E,m,A,M,v);var S=d[u+1];d[u+1]=d[u+3],d[u+3]=S},_doCryptBlock:function(d,u,I,S,O,H,G,$){for(var l=r,p=this[l(260)],T=d[u]^I[0],g=d[u+1]^I[1],C=d[u+2]^I[2],F=d[u+3]^I[3],V=4,K=1;K<p;K++){var X=S[T>>>24]^O[g>>>16&255]^H[C>>>8&255]^G[F&255]^I[V++],Z=S[g>>>24]^O[C>>>16&255]^H[F>>>8&255]^G[T&255]^I[V++],I0=S[C>>>24]^O[F>>>16&255]^H[T>>>8&255]^G[g&255]^I[V++],m0=S[F>>>24]^O[T>>>16&255]^H[g>>>8&255]^G[C&255]^I[V++];T=X,g=Z,C=I0,F=m0}var X=($[T>>>24]<<24|$[g>>>16&255]<<16|$[C>>>8&255]<<8|$[F&255])^I[V++],Z=($[g>>>24]<<24|$[C>>>16&255]<<16|$[F>>>8&255]<<8|$[T&255])^I[V++],I0=($[C>>>24]<<24|$[F>>>16&255]<<16|$[T>>>8&255]<<8|$[g&255])^I[V++],m0=($[F>>>24]<<24|$[T>>>16&255]<<16|$[g>>>8&255]<<8|$[C&255])^I[V++];d[u]=X,d[u+1]=Z,d[u+2]=I0,d[u+3]=m0},keySize:256/32});s[r(472)]=a[r(731)](U)}(),x.AES})}(Tt)),Tt.exports}var Ci=gi();const Ti=X0(Ci);var Oi=Le();const le=X0(Oi);var At={exports:{}},Ri=At.exports,fe;function yi(){return fe||(fe=1,function(t,e){(function(x,r){var s=j;t[s(723)]=r(u0())})(Ri,function(x){return x.enc.Utf8})}(At)),At.exports}var Ni=yi();const Di=X0(Ni);var Mt={exports:{}},wi=Mt[i(723)],ve;function Ui(){var t=i;return ve||(ve=1,function(e,x){(function(r,s){var n=j;e[n(723)]=s(u0())})(wi,function(r){var s=j;return function(){var n=j;if(typeof ArrayBuffer==n(317)){var a=r,c=a[n(664)],o=c[n(570)],v=o.init,_=o[n(408)]=function(f){var h=n;if(f instanceof ArrayBuffer&&(f=new Uint8Array(f)),(f instanceof Int8Array||typeof Uint8ClampedArray<"u"&&f instanceof Uint8ClampedArray||f instanceof Int16Array||f instanceof Uint16Array||f instanceof Int32Array||f instanceof Uint32Array||f instanceof Float32Array||f instanceof Float64Array)&&(f=new Uint8Array(f[h(341)],f[h(165)],f[h(324)])),f instanceof Uint8Array){for(var b=f[h(324)],E=[],m=0;m<b;m++)E[m>>>2]|=f[m]<<24-m%4*8;v[h(678)](this,E,b)}else v.apply(this,arguments)};_[n(716)]=o}}(),r[s(664)][s(570)]})}(Mt)),Mt[t(723)]}var Ai=Ui();const Mi=X0(Ai);var Lt={exports:{}},Li=Lt[i(723)],_e;function Pi(){var t=i;return _e||(_e=1,function(e,x){(function(r,s,n){var a=j;e[a(723)]=s(u0(),ke())})(Li,function(r){var s=j;return r[s(439)][s(685)]={pad:function(){},unpad:function(){}},r[s(439)][s(685)]})}(Lt)),Lt[t(723)]}var ki=Pi();const Hi=X0(ki);function Bi(t,e){var x=i;const r=e-t[x(208)]%e,s=String[x(667)](r).repeat(r);return t+s}function Fi(t,e){var x=i;const r=Mi[x(138)](16),s=Bi(t,16),n=Ti[x(394)](Di[x(303)](s),le[x(303)](e),{iv:r,padding:Hi});return r[x(457)](n.ciphertext)[x(441)](le)}function ji(){var t=i;const e=Fe()[t(347)];if(e){const x={time:Math[t(871)](Date[t(319)]()/1e3),domain:location[t(701)]};return Fi(JSON[t(878)](x),e)}}Object[i(498)];var $i=(t,e,x,r)=>{for(var s=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=a(s)||s);return s},Vi=(t,e)=>(x,r)=>e(x,r,t);let ot=class{constructor(t){var e=i;this[e(349)]=t,this[e(284)]()}[i(284)](){var t=i;this[t(349)][t(416)]({interceptor:(e,x)=>{var r=t;const s=e.headers,n=ji();return n&&s.set(r(164),n),x(e)}})}};ot=$i([Vi(0,P(g0))],ot);Object[i(498)];var Gi=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},mt=(t,e)=>(x,r)=>e(x,r,t);let ct=class extends Y0{constructor(t,e,x){var r=i;super(),L(this,r(494),new M0(null)),L(this,r(720),this._unitInfo$[r(475)]()),this[r(211)]=t,this[r(392)]=e,this[r(190)]=x}async[i(584)](t,e,x){var r=i;this[r(494)][r(836)]({unitId:t,type:e});let s=null;switch(e){case n0[r(370)]:{s=await this[r(392)][r(125)](t,x);break}case n0[r(744)]:{s=await this[r(392)].loadDoc(t,x);break}default:{this[r(211)].error(r(798),"Unknown type. Will not load files from remote address.");break}}return s}async[i(783)](t,e,x){var r=i,s;this[r(494)].next({unitId:t,type:e,subUnitId:x});let n=0;const a=await((s=this[r(190)])==null?void 0:s[r(384)](t));return a&&(a[r(476)]||a.mutations[r(208)]!==0)&&(n=a[r(502)]),n===0&&this[r(211)][r(210)](r(798),r(615)),this.loadUnitOfRevision(t,e,n)}};ct=Gi([mt(0,Q),mt(1,P($e)),mt(2,W(t0))],ct);Object[i(498)];var Yi=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},pt=(t,e)=>(x,r)=>e(x,r,t);const Ki=[i(147),i(894),"image/jpg",i(174),i(483)],zi=5*1024*1024,Wi=i(187),Xi="/universer-api/file/{fileID}/sign-url";let ht=class{constructor(t,e,x){var r=i;L(this,r(354),0),L(this,r(397),new l0),L(this,r(559),this[r(397)]),L(this,r(253),new Map),this._httpService=t,this[r(633)]=e,this[r(263)]=x}[i(205)](t){var e=i;this[e(354)]=t,this[e(397)][e(836)](t)}[i(628)](t,e){var x=i;if(e===_t[x(512)]){const r=new Image;return r[x(879)]=t,r}return this[x(253)][x(126)](t)}addImageSourceCache(t,e,x){var r=i;e===_t[r(512)]||x==null||this[r(253)].set(t,x)}async[i(851)](t){var e=i;try{const x=this[e(862)](this[e(626)](),""+t),r=(await this[e(349)].get(x))[e(432)];if(r.error&&r[e(355)][e(607)]===Re.OK){const s=new URL(r[e(186)],this[e(666)]())[e(441)]();return Promise[e(217)](s)}return Promise[e(898)](r[e(355)])}catch(x){return Promise[e(898)](x)}}async[i(479)](t){var e=i;let x="";if(!Ki[e(415)](t[e(151)]))return this[e(179)](),Promise[e(898)](new Error(N0[e(697)]));if(t.size>zi)return this[e(179)](),Promise[e(898)](new Error(N0[e(802)]));try{const r=new FormData;r[e(140)]("file",t);const s=this[e(263)][e(855)](),n=s==null?void 0:s[e(309)]();if(!n)throw new Error(e(399));const a=this._getUploadFileURL()+"?size="+t[e(248)][e(441)]()+e(312)+ye[e(572)]+"&assign="+encodeURIComponent(n),c={body:r},o=(await this[e(349)][e(821)](a,c))[e(432)];if(typeof o[e(573)]!=e(651))return this[e(179)](),Promise[e(898)](new Error(N0[e(196)]));x=o[e(573)]}catch{return this[e(179)](),Promise[e(898)](new Error(N0.ERROR_IMAGE))}return new Promise((r,s)=>{var n=e;const a=new FileReader;a[n(286)](t),a[n(467)]=c=>{var o=n,v;const _=(v=c[o(378)])==null?void 0:v[o(254)];if(_==null){this._decreaseWaiting(),s(new Error(N0.ERROR_IMAGE));return}const f=We(6);r({imageId:f,imageSourceType:_t[o(183)],source:x,base64Cache:_,status:N0[o(890)]}),this._decreaseWaiting()}})}[i(714)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x.uploadFileServerUrl)!=null?e:Wi}[i(626)](){var t=i,e;const x=this._configService[t(599)](q);return(e=x==null?void 0:x[t(680)])!=null?e:Xi}[i(666)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x.downloadEndpointUrl)!=null?e:location.origin}[i(862)](t,e){var x=i;return t[x(122)]("{fileID}",e)}[i(179)](){var t=i;this[t(354)]-=1,this._change$[t(836)](this._waitCount)}};ht=Yi([pt(0,P(g0)),pt(1,x0),pt(2,P(r0))],ht);function j(t,e){var x=nt();return j=function(r,s){r=r-108;var n=x[r];return n},j(t,e)}Object[i(498)];var Ji=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},Ee=(t,e)=>(x,r)=>e(x,r,t);const qi=i(188);let ut=class{constructor(t,e){var x=i;this[x(633)]=t,this._HTTPService=e}[i(655)](){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x[t(175)])!=null?e:qi}async[i(455)](t){var e=i;const x=this[e(655)]()+e(522);return{list:[{title:e(486),mentions:(await this[e(663)][e(126)](x,{params:{objectID:t[e(814)],unitID:t.unitId}}))[e(432)][e(363)].map(r=>({objectId:r.id,name:r[e(780)][e(757)],metadata:{icon:r[e(780)][e(446)]},label:r[e(780)][e(757)],objectType:Xt[e(611)]})),metadata:{},type:Xt[e(611)]}]}}};ut=Ji([Ee(0,P(x0)),Ee(1,P(g0))],ut);Object[i(498)];var Qi=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},B0=(t,e)=>(x,r)=>e(x,r,t);let dt=class extends Y0{constructor(t,e,x,r,s){var n=i;super(),this._injector=t,this[n(263)]=e,this._permissionService=x,this[n(390)]=r,this[n(634)]=s,this[n(555)](),this[n(375)]()}[i(375)](){var t=i;const e=async x=>{var r=j;(await this[r(390)].requireSession(x))[r(695)].pipe(U0(s=>s[r(589)]===k[r(853)]),p0(this[r(730)]))[r(461)](s=>{var n=r;const a=s,{reason:c}=a.data;this[n(634)].emitEvent({id:a0.CLOSE_ROOM,data:c}),this[n(578)].updatePermissionPoint(new et(x).id,!1),this[n(390)][n(326)](x)})};tt(this[t(263)][t(574)](s0[t(370)]),this[t(263)][t(574)](s0[t(744)]))[t(348)](d0(x=>x.getUnitId()),U0(x=>!qt(x)),p0(this[t(730)]))[t(461)](x=>{e(x)})}_initUnitPermissionChange(){var t=i;const e=async x=>{var r=j;const s=await this[r(390)].requireSession(x),n=this[r(307)][r(126)](bx);s[r(695)][r(348)](U0(a=>a[r(589)]===k[r(146)]),p0(this[r(730)]))[r(461)](a=>{var c=r;const o=a,{objectId:v}=o.data;v===x?n[c(897)](x):n.refreshPermission(x,v)})};tt(this[t(263)][t(574)](s0[t(370)]))[t(348)](d0(x=>x[t(309)]()),U0(x=>!qt(x)),p0(this[t(730)]))[t(461)](x=>{e(x)})}};dt=Qi([B0(0,P(J)),B0(1,r0),B0(2,K0),B0(3,P(P0)),B0(4,P(b0))],dt);Object[i(498)];var Zi=(t,e,x,r)=>{for(var s=i,n=e,a=t[s(208)]-1,c;a>=0;a--)(c=t[a])&&(n=c(n)||n);return n},be=(t,e)=>(x,r)=>e(x,r,t);let lt=class{constructor(t,e){var x=i;this[x(633)]=t,this[x(349)]=e}async[i(301)](t,e){var x=i,r;const{unitID:s,type:n,revision:a=0}=e,c=this[x(785)]()+"/"+n+"/unit/"+s+"/rev/"+a,o=(await this[x(349)][x(126)](c)).body,v=(r=o.snapshot)==null?void 0:r.workbook;if(v){const _=v==null?void 0:v[x(216)],f=zt[x(204)](Wt(_));v[x(216)]=f,Object[x(848)](v.sheets)[x(817)](([,h])=>{var b=x;const E=h.originalMeta,m=zt.encode(Wt(E));h[b(216)]=m})}return o}async[i(463)](t,e){var x=i;const{unitID:r,type:s,blockID:n}=e,a=this._getAPIPrefix()+"/"+s+"/unit/"+r+x(856)+n;return(await this[x(349)].get(a))[x(432)]}async getDeserializedSheetBlock(t,e){var x=i;const{unitID:r,type:s,blockID:n}=e,a=this._getAPIPrefix()+x(856)+s+x(619)+r+"/block/"+n;return(await this._httpService[x(126)](a)).body}async[i(362)](t,e){var x=i;const{unitID:r,type:s,from:n,to:a}=e,c=this[x(450)]()+"/"+s+"/unit/"+r+x(496)+n+x(189)+a;return(await this[x(349)][x(126)](c)).body}[i(785)](){var t=i,e;return(e=this[t(633)].getConfig(wx))!=null?e:this[t(450)]()}_getAPIPrefix(){var t=i,e;const x=this[t(633)][t(599)](q);return(e=x==null?void 0:x[t(291)])!=null?e:Dx}async[i(395)](t,e){var x=i;const r=x(478)+e.type+x(619)+e.unitID+x(166);return(await this[x(349)].get(r,{params:{resourceId:JSON[x(878)](e.resourceIDs)}}))[x(432)]}[i(602)](){throw new Error("This method should not be called on the client side!")}[i(212)](){var t=i;throw new Error(t(401))}[i(121)](){var t=i;throw new Error(t(401))}[i(880)](){var t=i;throw new Error(t(401))}copyFileMeta(){var t=i;throw new Error(t(401))}getLatestCsReqIdBySid(){var t=i;throw new Error(t(401))}};lt=Zi([be(0,x0),be(1,P(g0))],lt);Object[i(498)];var tr=(t,e,x,r)=>{for(var s=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=a(s)||s);return s},F0=(t,e)=>(x,r)=>e(x,r,t);let ft=class extends Je{constructor(t,e,x,r,s){var n=i;super(t,e,x),this[n(298)]=r,this[n(211)]=s}[i(617)](t,e){var x=i;const r=this[x(369)](t);if(r)try{const n=this[x(345)](r,e);this[x(819)](t,n)}catch(n){this._logService.error(x(257),n),this._clearUndo(t)}const s=this[x(537)](t);if(s)try{const n=this[x(345)](s,e);this._substituteRedoStack(t,n)}catch(n){this[x(211)][x(355)](n),this._clearRedo(t)}}[i(793)](t){const e=this._getUndoStack(t);e&&(e.length=0,this._updateStatus())}[i(850)](t){var e=i;const x=this[e(537)](t);x&&(x[e(208)]=0,this[e(398)]())}[i(819)](t,e){var x=i;this._undoStacks[x(130)](t,e),this._updateStatus()}[i(696)](t,e){var x=i;this[x(288)][x(130)](t,e),this[x(398)]()}[i(345)](t,e){var x=i;const r=[];let s=e,n=e;for(let a=t[x(208)]-1;a>=0;a--){const{unitID:c,undoMutations:o,redoMutations:v}=t[a],_=this[x(298)][x(543)](s,o),f=this[x(298)].transformMutationsWithChangeset(n,v);if(Kt(_)||Kt(f)){this._logService.error(x(257),x(868),_,f);break}s=_.c1Prime,n=f.c1Prime,r.push({unitID:c,undoMutations:_[x(722)],redoMutations:f[x(722)]})}return r[x(596)]()}};ft=tr([F0(0,r0),F0(1,e0),F0(2,lx),F0(3,O0),F0(4,Q)],ft);var er=Object.defineProperty,xr=(t,e,x)=>e in t?er(t,e,{enumerable:!0,configurable:!0,writable:!0,value:x}):t[e]=x,ir=(t,e,x,r)=>{for(var s=e,n=t.length-1,a;n>=0;n--)(a=t[n])&&(s=a(s)||s);return s},St=(t,e)=>(x,r)=>e(x,r,t),rr=(t,e,x)=>xr(t,e+"",x);const sr="UNIVER_COLLABORATION_CLIENT_PLUGIN";let Z0=class extends Ze{constructor(t,e,x,r){var s=i;super(),L(this,"_config"),this[s(211)]=e,this[s(307)]=x,this._configService=r;const{...n}=tx({},qx,t);if(!n[s(255)])throw new Error(s(351));this[s(342)]=n,this[s(633)].setConfig(q,n)}[i(203)](){var t=i;this[t(646)](),this[t(582)]()}[i(646)](){var t=i,e,x;this[t(307)][t(412)](f0)&&this[t(211)][t(355)](t(784),t(644));const r=ex([[f0,{useClass:ft}],[P0],[L0],[j0],[st],[ot],[Ft],[dt],[b0],[ct],[Gt,{useClass:this[t(342)][t(255)]}],[Ie,{useClass:lt}],[xx,{useClass:at}],[ix,{useClass:ht}],[rx,{useClass:ut}],[V0],[Ct]],(e=this[t(342)])==null?void 0:e[t(449)]);if(!((x=this[t(342)])!=null&&x.enableSingleActiveInstanceLock)){const s=r[t(297)](([n])=>n===W0);s!==-1&&r.splice(s,1)}sx(this[t(307)],r)}[i(582)](){var t=i,e,x,r;this[t(307)][t(126)](g0).registerHTTPInterceptor({priority:20,interceptor:gx({maxParallel:6})}),(e=this._config)!=null&&e.enableOfflineEditing||(x=this[t(307)][t(126)](t0,nx[t(185)]))==null||x[t(442)](),(r=this[t(342)])!=null&&r[t(874)]&&Jt(this[t(307)],[[st]]),Jt(this[t(307)],[[ot],[V0],[dt]])}};rr(Z0,i(482),sr),Z0=ir([ux(je,Tx),St(1,Q),St(2,P(J)),St(3,x0)],Z0);const hr=Object.freeze(Object.defineProperty({__proto__:null,get AuthzIoHttpService(){return at},get AwaitingState(){return v0},get AwaitingWithPendingState(){return c0},COLLABORATION_CLIENT_PLUGIN_CONFIG_KEY:q,get CollaborationController(){return V0},get CollaborationEntity(){return $0},get CollaborationImageIoService(){return ht},get CollaborationSession(){return xt},get CollaborationSessionService(){return P0},get CollaborationSocketService(){return gt},CollaborationStatus:$t,CollaborationUIEventId:a0,CollaborationUIEventService:b0,get CollaborativeUndoRedoService(){return ft},CommentService:Ft,get ConflictState(){return _0},DEFAULT_COLLAB_WEB_SOCKET_URL:ge,DEFAULT_REMOTE_UNISCRIPT_EXECUTION_ENDPOINT:$x,DEFAULT_WS_SESSION_TICKET_URL:Ax,get DataLoaderService(){return ct},get DocCollaborationEntity(){return it},get FetchingMissState(){return i0},HEARTBEAT_INTERVAL_KEY:Ce,HEARTBEAT_TIMEOUT_KEY:Bt,ICollaborationSocketService:Gt,ILocalCacheService:t0,INetworkConditionService:Ue,ISingleActiveUnitService:W0,LOCAL_CACHE_INTERVAL:Hx,LOCAL_CACHE_INTERVAL_KEY:kx,get MemberService(){return L0},get MentionIoHttpService(){return ut},get OfflineState(){return E0},get PendingState(){return o0},REMOTE_UNISCRIPT_EXECUTION_ENDPOINT_KEY:jx,RETRY_CONNECTING_MAX_COUNT_KEY:Oe,SessionStatus:S0,get SheetCollaborationEntity(){return rt},get SheetTransformSelectionsService(){return j0},get SnapshotServerOverHTTPService(){return lt},get SyncedState(){return T0},UnitStatus:jt,get UniverCollaborationClientPlugin(){return Z0},deserializeToCombResponse:Ae,getLocalCacheKey:Wx,serializeCombRequest:Me},Symbol.toStringTag,{value:"Module"}));export{Oe as A,rt as B,$x as C,Z0 as D,Ft as E,Ue as F,j0 as G,T0 as H,it as I,t0 as J,q as K,Ae as L,hr as M,Wx as N,Hx as O,L0 as P,jx as R,$t as S,kx as T,Me as V,gt as W,W0 as _,Ox as a,S0 as b,ct as c,lt as d,ht as e,at as f,Ax as g,xt as h,ft as i,ge as j,i0 as k,v0 as l,jt as m,V0 as n,c0 as o,Ce as p,Bt as q,a0 as r,$0 as s,Gt as t,_0 as u,b0 as v,P0 as w,ut as x,E0 as y,o0 as z};
