import{k as U,r as E,h as N,u as K,d as J,m as Q,p as h,o as r,e as t,b as e,Q as u,g as i,V as y,c as V,a0 as x,aR as q,f as o,l as G,j as S,aV as H,F,q as j,T as W,aT as z,x as v,y as A,aQ as R,i as X,a$ as Y,a9 as Z}from"./index-mJOBftNs.js";import{V as C,a as b}from"./VRow-C6N6h8s9.js";import{V as M,a as L,d as ee,b as O,c as te}from"./VCard-DFIDGoOa.js";import{V as oe}from"./VTextField-tFIcna6m.js";import{_ as ae}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se=()=>{const l=U(!1),n=U(""),f=U(null),g=E(new Set);return{loading:l,inputUrl:n,mediaInfo:f,downloadingIndexes:g,reset:()=>{n.value="",f.value=null,g.clear()}}};async function le(l){return N("/api/media-parser/parse",{method:"POST",body:JSON.stringify({url:l})})}async function ne(l,n){try{const g=await(await fetch(l)).blob(),m=document.createElement("a");m.href=URL.createObjectURL(g),m.download=n,document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(m.href)}catch(f){throw console.error("下载失败:",f),f}}const $={tiktok:{code:"tiktok",name:"TikTok",icon:"mdi-music-note",color:"#000000",urlPatterns:[/tiktok\.com\/@[\w.-]+\/video\/\d+/,/vm\.tiktok\.com\/[\w-]+/,/vt\.tiktok\.com\/[\w-]+/]},xiaohongshu:{code:"xiaohongshu",name:"小红书",icon:"mdi-book-open-page-variant",color:"#FF2442",urlPatterns:[/xiaohongshu\.com\/discovery\/item\/[\w-]+/,/xiaohongshu\.com\/explore\/[\w-]+/,/xhslink\.com\/[\w-]+/]},douyin:{code:"douyin",name:"抖音",icon:"mdi-music-note-outline",color:"#000000",urlPatterns:[/douyin\.com\/video\/\d+/,/v\.douyin\.com\/[\w-]+/,/iesdouyin\.com\/share\/video\/\d+/]},instagram:{code:"instagram",name:"Instagram",icon:"mdi-instagram",color:"#E4405F",urlPatterns:[/instagram\.com\/p\/[\w-]+/,/instagram\.com\/reel\/[\w-]+/,/instagram\.com\/tv\/[\w-]+/]}};function re(l){for(const[n,f]of Object.entries($))if(f.urlPatterns.some(g=>g.test(l)))return n;return null}const ie=l=>{const n=K(),f=async()=>{var w;const d=l.inputUrl.value.trim();if(!d){n.show({message:"請輸入媒體鏈接",color:"warning"});return}if(!re(d)){n.show({message:"不支持的平台或鏈接格式",color:"error"});return}l.loading.value=!0,l.mediaInfo.value=null;try{const c=await le(d);c.success&&c.data?(l.mediaInfo.value=c.data,n.show({message:"解析成功",color:"success"})):n.show({message:c.message||"解析失敗",color:"error"})}catch(c){console.error("解析失敗",c);const I=((w=c==null?void 0:c.payload)==null?void 0:w.message)||(c==null?void 0:c.message)||"解析失敗，請稍後重試";n.show({message:I,color:"error"})}finally{l.loading.value=!1}},g=async(d,_)=>{if(l.mediaInfo.value){l.downloadingIndexes.add(_);try{const w=`${l.mediaInfo.value.platform}_${Date.now()}_${_}${s(d)}`;await ne(d,w),n.show({message:"下載成功",color:"success"})}catch(w){console.error("下載失敗",w),n.show({message:"下載失敗，請稍後重試",color:"error"})}finally{l.downloadingIndexes.delete(_)}}},m=async()=>{if(l.mediaInfo.value)for(let d=0;d<l.mediaInfo.value.mediaUrls.length;d++)await g(l.mediaInfo.value.mediaUrls[d],d)},s=d=>{const _=d.match(/\.(jpg|jpeg|png|gif|mp4|mov|avi)(\?.*)?$/i);return _?`.${_[1]}`:""};return{handleParse:f,handleDownload:g,handleDownloadAll:m}},de={class:"media-parser-view"},ce={class:"text-h5"},ue={class:"text-subtitle-1"},me={class:"text-h6 mb-2"},fe={key:0,class:"text-body-2 text-grey-darken-1 mb-3"},pe={class:"d-flex gap-4 mb-4"},ge={key:0,class:"d-flex align-center"},ve={class:"text-caption"},_e={key:1,class:"d-flex align-center"},he={class:"text-caption"},ke={key:2,class:"d-flex align-center"},ye={class:"text-caption"},we={key:3,class:"d-flex align-center"},xe={class:"text-caption"},Ve={class:"media-preview-container"},Ce={class:"media-wrapper"},be=["src","poster"],Ie={class:"text-caption text-grey"},Te={key:0},Pe={class:"mt-1"},Ue=["href"],Se=J({__name:"MediaParserView",setup(l){const n=se(),f=ie(n),{loading:g,inputUrl:m,mediaInfo:s,downloadingIndexes:d}=n,{handleParse:_,handleDownload:w,handleDownloadAll:c}=f,I=Q(()=>Object.values($)),D=k=>$[k],T=k=>k>=1e4?`${(k/1e4).toFixed(1)}萬`:k.toString(),B=k=>{const a=Math.floor(k/60),p=k%60;return`${a}:${p.toString().padStart(2,"0")}`};return(k,a)=>(r(),h("div",de,[t(Y,null,{default:e(()=>[t(C,null,{default:e(()=>[t(b,{cols:"12"},{default:e(()=>[t(M,{elevation:"2"},{default:e(()=>[t(L,null,{default:e(()=>[u("div",ce,[t(y,{class:"mr-2"},{default:e(()=>[...a[1]||(a[1]=[i("mdi-link-variant",-1)])]),_:1}),a[2]||(a[2]=i(" 媒體鏈接解析 ",-1))])]),_:1}),t(ee,null,{default:e(()=>[...a[3]||(a[3]=[i(" 支持解析 TikTok、小紅書、抖音、Instagram 的視頻和圖文內容 ",-1)])]),_:1}),t(O,null,{default:e(()=>[t(C,null,{default:e(()=>[t(b,{cols:"12"},{default:e(()=>[t(oe,{modelValue:o(m),"onUpdate:modelValue":a[0]||(a[0]=p=>G(m)?m.value=p:null),label:"媒體鏈接",placeholder:"請輸入 TikTok、小紅書、抖音或 Instagram 鏈接","prepend-inner-icon":"mdi-link",clearable:"",onKeyup:q(o(_),["enter"])},{append:e(()=>[t(S,{color:"primary",loading:o(g),onClick:o(_)},{default:e(()=>[...a[4]||(a[4]=[i(" 解析 ",-1)])]),_:1},8,["loading","onClick"])]),_:1},8,["modelValue","onKeyup"])]),_:1})]),_:1}),t(C,{class:"mt-2"},{default:e(()=>[t(b,{cols:"12"},{default:e(()=>[t(H,null,{default:e(()=>[(r(!0),h(F,null,j(I.value,p=>(r(),V(A,{key:p.code,color:p.color,variant:"outlined",size:"small"},{default:e(()=>[t(y,{icon:p.icon,start:""},null,8,["icon"]),i(" "+v(p.name),1)]),_:2},1032,["color"]))),128))]),_:1})]),_:1})]),_:1}),o(s)?(r(),V(C,{key:0,class:"mt-4"},{default:e(()=>[t(b,{cols:"12"},{default:e(()=>[t(M,{variant:"outlined"},{default:e(()=>[t(L,{class:"d-flex align-center"},{default:e(()=>[t(W,{size:"32",class:"mr-2"},{default:e(()=>[o(s).authorAvatar?(r(),V(z,{key:0,src:o(s).authorAvatar},null,8,["src"])):(r(),V(y,{key:1},{default:e(()=>[...a[5]||(a[5]=[i("mdi-account-circle",-1)])]),_:1}))]),_:1}),u("div",null,[u("div",ue,v(o(s).author),1),t(A,{color:D(o(s).platform).color,size:"x-small",class:"mt-1"},{default:e(()=>[i(v(D(o(s).platform).name),1)]),_:1},8,["color"])]),t(R),o(s).mediaUrls.length>1?(r(),V(S,{key:0,color:"primary",variant:"outlined",onClick:o(c)},{default:e(()=>[t(y,{start:""},{default:e(()=>[...a[6]||(a[6]=[i("mdi-download-multiple",-1)])]),_:1}),a[7]||(a[7]=i(" 全部下載 ",-1))]),_:1},8,["onClick"])):x("",!0)]),_:1}),t(O,null,{default:e(()=>[u("div",me,v(o(s).title),1),o(s).description?(r(),h("div",fe,v(o(s).description),1)):x("",!0),u("div",pe,[o(s).likeCount!==void 0?(r(),h("div",ge,[t(y,{size:"small",class:"mr-1"},{default:e(()=>[...a[8]||(a[8]=[i("mdi-heart",-1)])]),_:1}),u("span",ve,v(T(o(s).likeCount)),1)])):x("",!0),o(s).commentCount!==void 0?(r(),h("div",_e,[t(y,{size:"small",class:"mr-1"},{default:e(()=>[...a[9]||(a[9]=[i("mdi-comment",-1)])]),_:1}),u("span",he,v(T(o(s).commentCount)),1)])):x("",!0),o(s).shareCount!==void 0?(r(),h("div",ke,[t(y,{size:"small",class:"mr-1"},{default:e(()=>[...a[10]||(a[10]=[i("mdi-share",-1)])]),_:1}),u("span",ye,v(T(o(s).shareCount)),1)])):x("",!0),o(s).duration?(r(),h("div",we,[t(y,{size:"small",class:"mr-1"},{default:e(()=>[...a[11]||(a[11]=[i("mdi-clock-outline",-1)])]),_:1}),u("span",xe,v(B(o(s).duration)),1)])):x("",!0)]),u("div",Ve,[t(C,null,{default:e(()=>[(r(!0),h(F,null,j(o(s).mediaUrls,(p,P)=>(r(),V(b,{key:P,cols:"12",sm:o(s).mediaUrls.length>1?6:12,md:o(s).mediaUrls.length>2?4:o(s).mediaUrls.length>1?6:12},{default:e(()=>[t(M,{variant:"outlined",class:"media-item"},{default:e(()=>[u("div",Ce,[o(s).mediaType==="image"||o(s).mediaType==="carousel"?(r(),V(z,{key:0,src:p,"aspect-ratio":"1",cover:"",class:"media-preview"},{placeholder:e(()=>[t(C,{class:"fill-height ma-0",align:"center",justify:"center"},{default:e(()=>[t(Z,{indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:1},8,["src"])):(r(),h("video",{key:1,src:p,controls:"",class:"media-preview",poster:o(s).coverUrl},null,8,be))]),t(te,null,{default:e(()=>[t(R),t(S,{color:"primary",variant:"tonal",size:"small",loading:o(d).has(P),onClick:Me=>o(w)(p,P)},{default:e(()=>[t(y,{start:""},{default:e(()=>[...a[12]||(a[12]=[i("mdi-download",-1)])]),_:1}),a[13]||(a[13]=i(" 下載 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["sm","md"]))),128))]),_:1})]),t(X,{class:"my-3"}),u("div",Ie,[o(s).publishTime?(r(),h("div",Te," 發布時間："+v(o(s).publishTime),1)):x("",!0),u("div",Pe,[a[14]||(a[14]=i(" 原始鏈接： ",-1)),u("a",{href:o(s).originalUrl,target:"_blank",class:"text-primary"},v(o(s).originalUrl),9,Ue)])])]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}}),Ae=ae(Se,[["__scopeId","data-v-a22c9776"]]);export{Ae as default};
