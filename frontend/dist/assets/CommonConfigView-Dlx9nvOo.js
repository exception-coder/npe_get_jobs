import{r as M,h as B,a as O,d as E,u as T,w as H,c as F,o as N,b as t,e as n,f as r,g as u,V as I,i as k,j}from"./index-mJOBftNs.js";import{V as S,a as A,b as x,c as R}from"./VCard-DFIDGoOa.js";import{V as v}from"./VForm-BTvn18MX.js";import{V as y}from"./VCombobox-By_eq-Hm.js";import{V as J,a as d}from"./VRow-C6N6h8s9.js";import{V as b}from"./VTextField-tFIcna6m.js";import{V as G}from"./VTextarea-34QBZFhW.js";import{V as D}from"./VSelect-CO5xudFf.js";import{V as w}from"./VSwitch-0eeupGzC.js";import"./filter-JDbFQhCL.js";const q=()=>M({loading:!1,saving:!1,showSecret:!1,aiPlatforms:[{label:"Deepseek",value:"deepseek"}],aiConfigsCache:{},aiGreetingMessage:"",form:{jobBlacklist:[],companyBlacklist:[],jobTitle:"",skills:[],yearsOfExperience:"",careerIntent:"",domainExperience:[],highlights:[],resumeImagePath:"",sayHiContent:"",minSalary:"",maxSalary:"",aiPlatform:"deepseek",aiPlatformKey:"",enableAIJobMatch:!1,enableAIGreeting:!1,sendImgResume:!1,recommendJobs:!1,hrStatusKeywords:[]},blacklistForm:null,profileForm:null,initialSnapshot:null,initialAIGreeting:"",rules:{required:a=>!!a&&a.trim().length>0||"该项为必填",minSkill:a=>a&&a.length>0||"请至少添加一项技能",maxHighlights:a=>!a||a.length<=5||"个人亮点最多 5 项",careerIntent:a=>{if(!a||a.trim().length===0)return"职业意向不能为空";const e=a.trim().length;return e>=10&&e<=40||"建议控制在 10-40 个字"}}});async function z(){return O("/api/common/config/get")}async function $(l){return B("/api/common/config/save",{method:"POST",body:JSON.stringify(l)})}const h=l=>Array.isArray(l)?l.map(a=>typeof a=="string"?a.trim():"").filter(a=>a.length>0):l?l.split(/[\n,]/).map(a=>a.trim()).filter(a=>a.length>0):[],K=l=>l.join(","),U=l=>{if(Array.isArray(l))return l.reduce((a,e)=>a.concat(U(e)),[]);if(typeof l=="string"){const a=l.trim();return a?[a]:[]}return[]},L=l=>{if(Array.isArray(l))return U(l);if(typeof l=="string"){const a=l.trim();if(!a)return[];try{const e=JSON.parse(a);if(Array.isArray(e))return U(e)}catch{}return h(a)}return[]},Q=l=>l?Array.isArray(l)?l.map(a=>{if(typeof a=="string"){const e=a.trim();return e?{label:e,value:e}:null}if(a&&typeof a=="object"&&"label"in a&&"value"in a){const e=a;if(typeof e.label=="string"&&typeof e.value=="string")return{label:e.label,value:e.value}}return null}).filter(a=>a!==null):[]:[],W=(l,a)=>{const e=()=>{l.initialSnapshot=JSON.parse(JSON.stringify(l.form)),l.initialAIGreeting=l.aiGreetingMessage},p=()=>{l.initialSnapshot&&(Object.assign(l.form,JSON.parse(JSON.stringify(l.initialSnapshot))),l.aiGreetingMessage=l.initialAIGreeting,a.show({message:"已恢复至上次加载的配置",color:"info"}))},C=async()=>{l.loading=!0;try{console.log("[CommonConfig] 开始加载配置...");const s=await z();console.log("[CommonConfig] 收到响应:",s);const m=(s==null?void 0:s.data)??{};console.log("[CommonConfig] 解析配置数据:",m);const g=Q(s==null?void 0:s.aiPlatforms);console.log("[CommonConfig] 标准化平台列表:",g),Array.isArray(g)&&g.length>0?l.aiPlatforms=g:(!Array.isArray(l.aiPlatforms)||l.aiPlatforms.length===0)&&(l.aiPlatforms=[{label:"Deepseek",value:"deepseek"}]),l.aiConfigsCache=m.aiPlatformConfigs??{};let c=m.aiPlatform??l.form.aiPlatform;l.aiPlatforms.length>0&&(l.aiPlatforms.some(f=>f.value===c)||(c=l.aiPlatforms[0].value));const V=f=>Array.isArray(f)?f.map(P=>String(P??"")).filter(P=>P.length>0):typeof f=="string"&&f.trim()?h(f):[];Object.assign(l.form,{jobBlacklist:h(m.jobBlacklistKeywords),companyBlacklist:h(m.companyBlacklistKeywords),jobTitle:m.jobTitle??"",skills:V(m.skills),yearsOfExperience:m.yearsOfExperience??"",careerIntent:m.careerIntent??"",domainExperience:L(m.domainExperience),highlights:V(m.highlights),resumeImagePath:m.resumeImagePath??"",sayHiContent:m.sayHi??m.sayHiContent??"",aiPlatform:c,minSalary:m.minSalary!=null?String(m.minSalary):"",maxSalary:m.maxSalary!=null?String(m.maxSalary):"",aiPlatformKey:l.aiConfigsCache[c]??"",enableAIJobMatch:m.enableAIJobMatchDetection??m.enableAIJobMatch??!1,enableAIGreeting:m.enableAIGreeting??!1,sendImgResume:m.sendImgResume??!1,recommendJobs:m.recommendJobs??!1,hrStatusKeywords:h(m.hrStatusKeywords)}),l.aiGreetingMessage=m.aiGreetingMessage??"",console.log("[CommonConfig] 表单数据已更新:",l.form),e(),console.log("[CommonConfig] 配置加载完成")}catch(s){console.error("[CommonConfig] 加载公共配置失败",s),a.show({message:"加载公共配置失败",color:"error"})}finally{console.log("[CommonConfig] 设置 loading = false"),l.loading=!1}},o=async()=>{var m,g,c,V;return(await Promise.all([(g=(m=l.blacklistForm)==null?void 0:m.validate)==null?void 0:g.call(m),(V=(c=l.profileForm)==null?void 0:c.validate)==null?void 0:V.call(c)])).every(f=>(f==null?void 0:f.valid)!==!1)},i=()=>{const s={...l.aiConfigsCache};return l.form.aiPlatformKey&&(s[l.form.aiPlatform]=l.form.aiPlatformKey),{jobBlacklistKeywords:K(l.form.jobBlacklist),companyBlacklistKeywords:K(l.form.companyBlacklist),jobTitle:l.form.jobTitle,skills:l.form.skills,yearsOfExperience:l.form.yearsOfExperience,careerIntent:l.form.careerIntent,domainExperience:l.form.domainExperience,highlights:l.form.highlights,resumeImagePath:l.form.resumeImagePath,sayHiContent:l.form.sayHiContent,sayHi:l.form.sayHiContent,minSalary:l.form.minSalary?Number(l.form.minSalary):void 0,maxSalary:l.form.maxSalary?Number(l.form.maxSalary):void 0,aiPlatform:l.form.aiPlatform,aiPlatformConfigs:s,enableAIJobMatch:l.form.enableAIJobMatch,enableAIJobMatchDetection:l.form.enableAIJobMatch,enableAIGreeting:l.form.enableAIGreeting,sendImgResume:l.form.sendImgResume,recommendJobs:l.form.recommendJobs,hrStatusKeywords:K(l.form.hrStatusKeywords)}};return{loadConfig:C,resetForm:p,handleSave:async()=>{if(!await o()){a.show({message:"请先修正表单校验错误",color:"warning"});return}l.saving=!0;try{const s=i();await $(s),a.show({message:"公共配置已保存",color:"success"}),e(),localStorage.setItem("candidateProfile",JSON.stringify(s))}catch(s){console.error("保存公共配置失败",s),a.show({message:"保存失败，请稍后再试",color:"error"})}finally{l.saving=!1}},copyAIGreeting:async()=>{if(!l.aiGreetingMessage){a.show({message:"暂无可复制的 AI 建议内容",color:"warning"});return}try{await navigator.clipboard.writeText(l.aiGreetingMessage),a.show({message:"AI 建议打招呼内容已复制",color:"success"})}catch(s){console.error("复制 AI 建议打招呼内容失败",s),a.show({message:"复制失败，请手动复制",color:"error"})}}}},me=E({__name:"CommonConfigView",setup(l){const a=T(),e=q(),p=W(e,a);return H(()=>e.form.aiPlatform,C=>{e.form.aiPlatformKey=e.aiConfigsCache[C]??""}),p.loadConfig(),(C,o)=>(N(),F(J,{dense:""},{default:t(()=>[n(d,{cols:"12",xl:"7"},{default:t(()=>[n(S,{class:"section-card",loading:r(e).loading,elevation:"2"},{default:t(()=>[n(A,{class:"section-title d-flex align-center"},{default:t(()=>[n(I,{class:"mr-2",color:"primary"},{default:t(()=>[...o[21]||(o[21]=[u("mdi-shield-alert",-1)])]),_:1}),o[22]||(o[22]=u(" 黑名单过滤配置 ",-1))]),_:1}),n(x,null,{default:t(()=>[n(v,{ref:"state.blacklistForm"},{default:t(()=>[n(y,{modelValue:r(e).form.jobBlacklist,"onUpdate:modelValue":o[0]||(o[0]=i=>r(e).form.jobBlacklist=i),label:"岗位黑名单关键字",chips:"",multiple:"","closable-chips":"","hide-selected":"",hint:"职位标题或描述匹配的岗位将被过滤","persistent-hint":"",clearable:"","prepend-inner-icon":"mdi-briefcase-remove"},null,8,["modelValue"]),n(y,{modelValue:r(e).form.companyBlacklist,"onUpdate:modelValue":o[1]||(o[1]=i=>r(e).form.companyBlacklist=i),class:"mt-4",label:"公司黑名单关键字",chips:"",multiple:"","closable-chips":"","hide-selected":"",hint:"公司名称匹配的岗位将被过滤","persistent-hint":"",clearable:"","prepend-inner-icon":"mdi-office-building-remove"},null,8,["modelValue"])]),_:1},512)]),_:1})]),_:1},8,["loading"]),n(S,{class:"section-card mt-6",loading:r(e).loading,elevation:"2"},{default:t(()=>[n(A,{class:"section-title d-flex align-center"},{default:t(()=>[n(I,{class:"mr-2",color:"primary"},{default:t(()=>[...o[23]||(o[23]=[u("mdi-account-badge",-1)])]),_:1}),o[24]||(o[24]=u(" 候选人画像 ",-1))]),_:1}),n(x,null,{default:t(()=>[n(v,{ref:"state.profileForm"},{default:t(()=>[n(J,{dense:""},{default:t(()=>[n(d,{cols:"12",md:"6"},{default:t(()=>[n(b,{modelValue:r(e).form.jobTitle,"onUpdate:modelValue":o[2]||(o[2]=i=>r(e).form.jobTitle=i),label:"目标职位名称",rules:[r(e).rules.required],"prepend-inner-icon":"mdi-briefcase"},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12",md:"6"},{default:t(()=>[n(b,{modelValue:r(e).form.yearsOfExperience,"onUpdate:modelValue":o[3]||(o[3]=i=>r(e).form.yearsOfExperience=i),label:"工作年限",rules:[r(e).rules.required],"prepend-inner-icon":"mdi-timeline-clock"},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12"},{default:t(()=>[n(y,{modelValue:r(e).form.skills,"onUpdate:modelValue":o[4]||(o[4]=i=>r(e).form.skills=i),label:"核心技能",rules:[r(e).rules.minSkill],chips:"",multiple:"","closable-chips":"","hide-selected":"","prepend-inner-icon":"mdi-xml"},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12"},{default:t(()=>[n(G,{modelValue:r(e).form.careerIntent,"onUpdate:modelValue":o[5]||(o[5]=i=>r(e).form.careerIntent=i),label:"职业意向",counter:40,rules:[r(e).rules.careerIntent],rows:"3","auto-grow":"","prepend-inner-icon":"mdi-target-account"},null,8,["modelValue","rules"])]),_:1}),n(d,{cols:"12",md:"6"},{default:t(()=>[n(y,{modelValue:r(e).form.domainExperience,"onUpdate:modelValue":o[6]||(o[6]=i=>r(e).form.domainExperience=i),label:"领域经验",chips:"",multiple:"","closable-chips":"","hide-selected":"","prepend-inner-icon":"mdi-domain"},null,8,["modelValue"])]),_:1}),n(d,{cols:"12",md:"6"},{default:t(()=>[n(y,{modelValue:r(e).form.highlights,"onUpdate:modelValue":o[7]||(o[7]=i=>r(e).form.highlights=i),label:"个人亮点",rules:[r(e).rules.maxHighlights],chips:"",multiple:"","closable-chips":"","hide-selected":"","prepend-inner-icon":"mdi-star-circle"},null,8,["modelValue","rules"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1}),n(d,{cols:"12",xl:"5"},{default:t(()=>[n(S,{class:"section-card",loading:r(e).loading,elevation:"2"},{default:t(()=>[n(A,{class:"section-title d-flex align-center"},{default:t(()=>[n(I,{class:"mr-2",color:"primary"},{default:t(()=>[...o[25]||(o[25]=[u("mdi-ai",-1)])]),_:1}),o[26]||(o[26]=u(" AI 配置 ",-1))]),_:1}),n(x,null,{default:t(()=>[n(v,null,{default:t(()=>[n(D,{modelValue:r(e).form.aiPlatform,"onUpdate:modelValue":o[8]||(o[8]=i=>r(e).form.aiPlatform=i),label:"AI 平台",items:Array.isArray(r(e).aiPlatforms)?r(e).aiPlatforms:[],"item-title":"label","item-value":"value","prepend-inner-icon":"mdi-robot",hint:"当前仅支持 Deepseek","persistent-hint":"",disabled:""},null,8,["modelValue","items"]),n(b,{modelValue:r(e).form.aiPlatformKey,"onUpdate:modelValue":o[9]||(o[9]=i=>r(e).form.aiPlatformKey=i),type:r(e).showSecret?"text":"password",label:"API Key","prepend-inner-icon":"mdi-key","append-inner-icon":r(e).showSecret?"mdi-eye-off":"mdi-eye","onClick:appendInner":o[10]||(o[10]=i=>r(e).showSecret=!r(e).showSecret)},null,8,["modelValue","type","append-inner-icon"]),n(k,{class:"my-4"}),n(w,{modelValue:r(e).form.enableAIJobMatch,"onUpdate:modelValue":o[11]||(o[11]=i=>r(e).form.enableAIJobMatch=i),color:"primary",inset:"",label:"启用 AI 职位匹配"},null,8,["modelValue"]),n(w,{modelValue:r(e).form.enableAIGreeting,"onUpdate:modelValue":o[12]||(o[12]=i=>r(e).form.enableAIGreeting=i),color:"primary",inset:"",label:"启用 AI 智能打招呼"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["loading"]),n(S,{class:"section-card mt-6",loading:r(e).loading,elevation:"2"},{default:t(()=>[n(A,{class:"section-title d-flex align-center"},{default:t(()=>[n(I,{class:"mr-2",color:"primary"},{default:t(()=>[...o[27]||(o[27]=[u("mdi-clipboard-text-outline",-1)])]),_:1}),o[28]||(o[28]=u(" 简历与沟通配置 ",-1))]),_:1}),n(x,null,{default:t(()=>[n(J,{dense:""},{default:t(()=>[n(d,{cols:"12",md:"6"},{default:t(()=>[n(b,{modelValue:r(e).form.minSalary,"onUpdate:modelValue":o[13]||(o[13]=i=>r(e).form.minSalary=i),type:"number",label:"期望薪资下限 (K)","prepend-inner-icon":"mdi-currency-cny"},null,8,["modelValue"])]),_:1}),n(d,{cols:"12",md:"6"},{default:t(()=>[n(b,{modelValue:r(e).form.maxSalary,"onUpdate:modelValue":o[14]||(o[14]=i=>r(e).form.maxSalary=i),type:"number",label:"期望薪资上限 (K)","prepend-inner-icon":"mdi-currency-cny"},null,8,["modelValue"])]),_:1}),n(d,{cols:"12"},{default:t(()=>[n(b,{modelValue:r(e).form.resumeImagePath,"onUpdate:modelValue":o[15]||(o[15]=i=>r(e).form.resumeImagePath=i),label:"简历图片路径","prepend-inner-icon":"mdi-image",placeholder:"如 /Users/xxx/resume.png"},null,8,["modelValue"])]),_:1}),n(d,{cols:"12"},{default:t(()=>[n(G,{modelValue:r(e).form.sayHiContent,"onUpdate:modelValue":o[16]||(o[16]=i=>r(e).form.sayHiContent=i),label:"默认打招呼内容",rows:"3","auto-grow":"","prepend-inner-icon":"mdi-chat-processing"},null,8,["modelValue"]),n(G,{modelValue:r(e).aiGreetingMessage,"onUpdate:modelValue":o[17]||(o[17]=i=>r(e).aiGreetingMessage=i),class:"mt-2",label:"AI 建议打招呼内容",rows:"3","auto-grow":"",readonly:"",variant:"outlined","prepend-inner-icon":"mdi-robot","append-inner-icon":"mdi-content-copy","onClick:appendInner":r(p).copyAIGreeting},null,8,["modelValue","onClick:appendInner"])]),_:1})]),_:1}),n(k,{class:"my-4"}),n(y,{modelValue:r(e).form.hrStatusKeywords,"onUpdate:modelValue":o[18]||(o[18]=i=>r(e).form.hrStatusKeywords=i),label:"HR 状态过滤关键词",chips:"",multiple:"","closable-chips":"","hide-selected":"","prepend-inner-icon":"mdi-account-cancel"},null,8,["modelValue"]),n(k,{class:"my-4"}),n(w,{modelValue:r(e).form.sendImgResume,"onUpdate:modelValue":o[19]||(o[19]=i=>r(e).form.sendImgResume=i),color:"primary",inset:"",label:"投递时发送图片简历"},null,8,["modelValue"]),n(w,{modelValue:r(e).form.recommendJobs,"onUpdate:modelValue":o[20]||(o[20]=i=>r(e).form.recommendJobs=i),color:"primary",inset:"",label:"接收平台推荐"},null,8,["modelValue"])]),_:1}),n(R,{class:"justify-end"},{default:t(()=>[n(j,{variant:"tonal",color:"secondary",onClick:r(p).resetForm,disabled:r(e).loading},{default:t(()=>[...o[29]||(o[29]=[u(" 重置 ",-1)])]),_:1},8,["onClick","disabled"]),n(j,{color:"primary",onClick:r(p).handleSave,loading:r(e).saving,disabled:r(e).loading},{default:t(()=>[...o[30]||(o[30]=[u(" 保存配置 ",-1)])]),_:1},8,["onClick","loading","disabled"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{me as default};
