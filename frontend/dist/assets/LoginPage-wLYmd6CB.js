import{k as g,r as h,a2 as b,h as y,ba as _,bb as S,d as x,u as C,p as k,o as R,e as s,b as a,Q as c,f as t,aQ as T,j as q,g as A,a$ as B}from"./index-mJOBftNs.js";import{V,a as w}from"./VRow-C6N6h8s9.js";import{V as N}from"./VSheet-DbNfniB_.js";import{V as j,a as L,b as E,c as F}from"./VCard-DFIDGoOa.js";import{V as J}from"./VForm-BTvn18MX.js";import{V as v}from"./VTextField-tFIcna6m.js";const O=()=>{const n=g(!1),i=g(),d=h({username:"",password:""});return{loading:n,formRef:i,form:d,rules:{required:r=>r.trim().length>0||"此欄位為必填",password:r=>r.trim().length>=6||"密碼長度至少為 6 位"}}},P=(n,i)=>{const d=b();return{handleSubmit:async()=>{var l,u,f;const r=await((u=(l=n.formRef.value)==null?void 0:l.validate)==null?void 0:u.call(l));if((r==null?void 0:r.valid)===!1){i.show({message:"請先修正表單校驗錯誤",color:"warning"});return}n.loading.value=!0;try{const o={username:n.form.username.trim(),password:n.form.password},e=await y("/api/auth/login",{method:"POST",body:JSON.stringify(o)});if(e.success&&e.data){i.show({message:"登入成功，歡迎回來",color:"success"}),e.data.expiresAt&&(_(e.data.expiresAt),S());const m=d.currentRoute.value.query.redirect;m?d.push(m):d.push("/")}else i.show({message:e.message||"登入失敗，請稍後重試",color:"error"})}catch(o){console.error("登入失敗",o);const e=((f=o==null?void 0:o.payload)==null?void 0:f.message)||(o==null?void 0:o.message)||"登入失敗，請稍後重試";i.show({message:e,color:"error"})}finally{n.loading.value=!1}}}},Q={class:"login-page"},H=x({__name:"LoginPage",setup(n){const i=C(),d=O(),{loading:p,formRef:r,form:l,rules:u}=d,{handleSubmit:f}=P(d,i);return(o,e)=>(R(),k("div",Q,[s(B,{class:"pa-0"},{default:a(()=>[s(V,{justify:"center"},{default:a(()=>[s(w,{cols:"12",md:"8",lg:"6"},{default:a(()=>[s(N,{class:"login-hero-card",color:"transparent",elevation:"0"},{default:a(()=>[...e[2]||(e[2]=[c("div",{class:"mb-4"},[c("div",{class:"login-hero-title"},"移動通訊精準營銷中心"),c("div",{class:"login-hero-subtitle"}," 使用專屬帳號登入以管理平台配置、求職紀錄與進階工具。 ")],-1),c("div",{class:"login-meta"}," 若尚未開通帳號，請聯繫系統管理員。當前版本僅模擬登入流程，用於前端體驗設計與權限場景演示。 ",-1)])]),_:1})]),_:1})]),_:1}),s(V,{justify:"center"},{default:a(()=>[s(w,{cols:"12",md:"6",lg:"4"},{default:a(()=>[s(j,{class:"login-card",elevation:"0"},{default:a(()=>[s(L,null,{default:a(()=>[...e[3]||(e[3]=[c("div",{class:"login-card-title"},"帳號登入",-1),c("div",{class:"login-card-subtitle mt-1"},"請輸入系統分配的登入帳號與密碼",-1)])]),_:1}),s(E,null,{default:a(()=>[s(J,{ref_key:"formRef",ref:r},{default:a(()=>[s(v,{modelValue:t(l).username,"onUpdate:modelValue":e[0]||(e[0]=m=>t(l).username=m),label:"使用者名稱",placeholder:"例如：admin 或 email","prepend-inner-icon":"mdi-account-circle",rules:[t(u).required],autocomplete:"username"},null,8,["modelValue","rules"]),s(v,{modelValue:t(l).password,"onUpdate:modelValue":e[1]||(e[1]=m=>t(l).password=m),label:"密碼",placeholder:"請輸入登入密碼","prepend-inner-icon":"mdi-lock",rules:[t(u).required,t(u).password],type:"password",autocomplete:"current-password"},null,8,["modelValue","rules"])]),_:1},512)]),_:1}),s(F,{class:"px-4 pb-4"},{default:a(()=>[s(T),s(q,{class:"login-primary-btn",color:"primary",loading:t(p),onClick:t(f)},{default:a(()=>[...e[4]||(e[4]=[A(" 登入 ",-1)])]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]))}});export{H as default};
