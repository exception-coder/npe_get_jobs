import{M as ae,L as X,v as D,V as re,w as A,O as an,o as ln,G as Qn,z as wt,S as oe,C as er,m as on,n as Bt,s as tr,W as un,ai as Ce,j as ue,$ as nr,J as Lt,a as xe,F as K,cj as rr,bP as cn,u as le,e as lt,U as dn,Y as te,dj as ir,dl as sr,q as vn,I as F,x as hn}from"./TeamSpreadsheet-DqPQXi__.js";import{nJ as ce,jd as ar,jb as lr,z as Fe,kc as or,u as mn,te as ur,h as cr,or as qt,o9 as dr,p7 as Et,q_ as gn,qO as vr,nq as ot,nl as ut,V as fn,y as pn,L as xn,P as Cn,m as hr,nU as mr,of as jt,f as gr,c as fr,B as pr,H as xr,oJ as _t,d as W,eK as yn,kA as Cr,lG as Ft,w as bn,t6 as yr,qX as br,lr as Ir,nh as ct,qE as Sr,g as Tr,sX as wr,sY as It,e4 as Er,oc as jr,k as _r,G as $t,oY as Rr,mb as Nr,km as Vr,M as In,oS as Mr,n as kr,oU as Ur}from"./index--BQDx9CP.js";import{M as z,A as M,S as U,e as Q,F as L,N as Sn,B as Lr,$ as fe,q as ve,a8 as ke,K as he,w as Ue,y as Fr,l as $r,Z as Ke,H as Tn,k as wn,g as Hr,o as En,P as dt,L as O,f as ye,I as H,W as qe,C as We,v as De,V as Ar,U as Wt,T as Or,J as Pr,j as Br,O as qr,a as se,a6 as Wr,a1 as Dr,_ as Ut,t as Zr,b as Gr,d as jn,Q as Je,s as _n}from"./index-ChzpeWOG.js";import{r as g,j as a,L as ne,v as Dt,R as Zt,ae as zr,i as G,c as Ht,k as Te,e as vt,b as Xr,T as Gt,x as be,V as Yr,s as Kr}from"./facade-DLk4o3Z_.js";import{W as Jr,C as St}from"./index-DNSnhRIr.js";var Qr=Object.defineProperty,ei=(e,t,s)=>t in e?Qr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Se=(e,t,s)=>ei(e,typeof t!="symbol"?t+"":t,s);const Rn={type:ae.COMMAND,id:"sheet.command.add-average-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n,operator:i}=t,l=e.get(z),d=e.get(X),m=e.get(D),u=ce(m);if(!u)return!1;const{unitId:o,subUnitId:c}=u,f=l.createCfId(o,c),p={ranges:s,cfId:f,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.average,operator:i,style:r}};return d.executeCommand(Q.id,{unitId:o,subUnitId:c,rule:p})}},Nn={type:ae.COMMAND,id:"sheet.command.add-color-scale-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,config:r,stopIfTrue:n}=t,i=e.get(z),l=e.get(X),d=e.get(D),m=ce(d);if(!m)return!1;const{unitId:u,subUnitId:o}=m,c=i.createCfId(u,o),f={ranges:s,cfId:c,stopIfTrue:!!n,rule:{type:U.colorScale,config:r}};return l.executeCommand(Q.id,{unitId:u,subUnitId:o,rule:f})}},Vn={type:ae.COMMAND,id:"sheet.command.add-data-bar-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,min:r,max:n,nativeColor:i,positiveColor:l,isGradient:d,stopIfTrue:m,isShowValue:u}=t,o=e.get(z),c=e.get(D),f=ce(c);if(!f)return!1;const{unitId:p,subUnitId:x}=f,y=e.get(X),I=o.createCfId(p,x),b={ranges:s,cfId:I,stopIfTrue:!!m,rule:{type:U.dataBar,isShowValue:u,config:{min:r,max:n,nativeColor:i,positiveColor:l,isGradient:d}}};return y.executeCommand(Q.id,{unitId:p,subUnitId:x,rule:b})}},Mn={type:ae.COMMAND,id:"sheet.command.add-duplicate-values-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n}=t,i=e.get(z),l=e.get(X),d=e.get(D),m=ce(d);if(!m)return!1;const{unitId:u,subUnitId:o}=m,c=i.createCfId(u,o),f={ranges:s,cfId:c,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.duplicateValues,style:r}};return l.executeCommand(Q.id,{unitId:u,subUnitId:o,rule:f})}},kn={type:ae.COMMAND,id:"sheet.command.add-number-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n,operator:i,value:l}=t,d=e.get(z),m=e.get(X),u=e.get(D),o=ce(u);if(!o)return!1;const{unitId:c,subUnitId:f}=o,p=d.createCfId(c,f);let x;if([L.between,L.notBetween].includes(i)){const y=l;if(y.length!==2||!Array.isArray(y))return!1;x={ranges:s,cfId:p,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.number,operator:i,style:r,value:y}}}else{const y=l;if(typeof y!="number")return!1;x={ranges:s,cfId:p,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.number,operator:i,style:r,value:y}}}return m.executeCommand(Q.id,{unitId:c,subUnitId:f,rule:x})}},Un={type:ae.COMMAND,id:"sheet.command.add-rank-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n,isPercent:i,isBottom:l,value:d}=t,m=e.get(z),u=e.get(D),o=e.get(X),c=ce(u);if(!c)return!1;const{unitId:f,subUnitId:p}=c,x=m.createCfId(f,p),y={ranges:s,cfId:x,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.rank,isPercent:i,isBottom:l,style:r,value:d}};return o.executeCommand(Q.id,{unitId:f,subUnitId:p,rule:y})}},Ln={type:ae.COMMAND,id:"sheet.command.add-text-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n,operator:i,value:l}=t,d=e.get(z),m=e.get(D),u=ce(m);if(!u)return!1;const{unitId:o,subUnitId:c}=u,f=e.get(X),p=d.createCfId(o,c),x={ranges:s,cfId:p,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.text,operator:i,style:r,value:l}};return f.executeCommand(Q.id,{unitId:o,subUnitId:c,rule:x})}},Fn={type:ae.COMMAND,id:"sheet.command.add-time-period-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n,operator:i}=t,l=e.get(z),d=e.get(D),m=e.get(X),u=ce(d);if(!u)return!1;const{unitId:o,subUnitId:c}=u,f=l.createCfId(o,c),p={ranges:s,cfId:f,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.timePeriod,operator:i,style:r}};return m.executeCommand(Q.id,{unitId:o,subUnitId:c,rule:p})}},$n={type:ae.COMMAND,id:"sheet.command.add-uniqueValues-conditional-rule",handler(e,t){if(!t)return!1;const{ranges:s,style:r,stopIfTrue:n}=t,i=e.get(z),l=e.get(D),d=e.get(X),m=ce(l);if(!m)return!1;const{unitId:u,subUnitId:o}=m,c=i.createCfId(u,o),f={ranges:s,cfId:c,stopIfTrue:!!n,rule:{type:U.highlightCell,subType:M.uniqueValues,style:r}};return d.executeCommand(Q.id,{unitId:u,subUnitId:o,rule:f})}};function ie({ref:e,...t}){const{icon:s,id:r,className:n,extend:i,...l}=t,d=`univerjs-icon univerjs-icon-${r} ${n||""}`.trim(),m=g.useRef(`_${ri()}`);return Hn(s,`${r}`,{defIds:s.defIds,idSuffix:m.current},{ref:e,className:d,...l},i)}function Hn(e,t,s,r,n){return g.createElement(e.tag,{key:t,...ti(e,s,n),...r},(ni(e,s).children||[]).map((i,l)=>Hn(i,`${t}-${e.tag}-${l}`,s,void 0,n)))}function ti(e,t,s){const r={...e.attrs};s!=null&&s.colorChannel1&&r.fill==="colorChannel1"&&(r.fill=s.colorChannel1),e.tag==="mask"&&r.id&&(r.id=r.id+t.idSuffix),Object.entries(r).forEach(([i,l])=>{i==="mask"&&typeof l=="string"&&(r[i]=l.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))});const{defIds:n}=t;return!n||n.length===0||(e.tag==="use"&&r["xlink:href"]&&(r["xlink:href"]=r["xlink:href"]+t.idSuffix),Object.entries(r).forEach(([i,l])=>{typeof l=="string"&&(r[i]=l.replace(/url\(#(.*)\)/,`url(#$1${t.idSuffix})`))})),r}function ni(e,t){var s;const{defIds:r}=t;return!r||r.length===0?e:e.tag==="defs"&&(s=e.children)!=null&&s.length?{...e,children:e.children.map(n=>typeof n.attrs.id=="string"&&r&&r.includes(n.attrs.id)?{...n,attrs:{...n.attrs,id:n.attrs.id+t.idSuffix}}:n)}:e}function ri(){return Math.random().toString(36).substring(2,8)}ie.displayName="UniverIcon";const ii={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M4.65791 1.30005C3.77355 1.30005 3.05664 2.01696 3.05664 2.90132V12.8588C3.05664 13.8755 3.88086 14.6998 4.89759 14.6998H9.1016C11.2233 14.6998 12.9433 12.9798 12.9433 10.8581C12.9433 9.13925 11.8145 7.68407 10.2578 7.1934C10.8806 6.56856 11.2655 5.70659 11.2655 4.75472C11.2655 2.84676 9.71883 1.30005 7.81087 1.30005H4.65791ZM4.25664 2.90132C4.25664 2.6797 4.4363 2.50005 4.65791 2.50005H7.81087C9.05609 2.50005 10.0655 3.5095 10.0655 4.75472C10.0655 5.99993 9.05609 7.00938 7.81087 7.00938H4.25664V2.90132ZM4.25664 12.8588V8.21636H9.1016C10.5606 8.21636 11.7433 9.39909 11.7433 10.8581C11.7433 12.317 10.5606 13.4998 9.1016 13.4998H4.89759C4.5436 13.4998 4.25664 13.2128 4.25664 12.8588Z",fillRule:"evenodd",clipRule:"evenodd"}}]},An=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"bold-icon",ref:t,icon:ii}))});An.displayName="BoldIcon";const si={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",fillRule:"evenodd",clipRule:"evenodd"}}]},at=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"delete-icon",ref:t,icon:si}))});at.displayName="DeleteIcon";const ai={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"}}]},On=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"increase-icon",ref:t,icon:ai}))});On.displayName="IncreaseIcon";const li={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M9.80385 1.40005H11.9997C12.3311 1.40005 12.5997 1.66868 12.5997 2.00005C12.5997 2.33143 12.3311 2.60005 11.9997 2.60005H10.1185L7.12251 13.4001H9.33324C9.66461 13.4001 9.93324 13.6687 9.93324 14.0001C9.93324 14.3314 9.66461 14.6001 9.33324 14.6001H6.34785C6.33847 14.6003 6.32905 14.6003 6.31962 14.6001H3.9999C3.66853 14.6001 3.3999 14.3314 3.3999 14.0001C3.3999 13.6687 3.66853 13.4001 3.9999 13.4001H5.87719L8.87322 2.60005H6.66641C6.33504 2.60005 6.06641 2.33143 6.06641 2.00005C6.06641 1.66868 6.33504 1.40005 6.66641 1.40005H9.52916C9.61698 1.37929 9.71064 1.3781 9.80385 1.40005Z"}}]},Pn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"italic-icon",ref:t,icon:li}))});Pn.displayName="ItalicIcon";const oi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},At=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"more-down-icon",ref:t,icon:oi}))});At.displayName="MoreDownIcon";const ui={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M6 5C6.55228 5 7 4.55228 7 4C7 3.44772 6.55228 3 6 3C5.44772 3 5 3.44772 5 4C5 4.55228 5.44772 5 6 5Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6 9C6.55228 9 7 8.55229 7 8C7 7.44772 6.55228 7 6 7C5.44772 7 5 7.44772 5 8C5 8.55229 5.44772 9 6 9Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M7 12C7 12.5523 6.55228 13 6 13C5.44772 13 5 12.5523 5 12C5 11.4477 5.44772 11 6 11C6.55228 11 7 11.4477 7 12Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M10 5C10.5523 5 11 4.55228 11 4C11 3.44772 10.5523 3 10 3C9.44771 3 9 3.44772 9 4C9 4.55228 9.44771 5 10 5Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M11 8C11 8.55229 10.5523 9 10 9C9.44771 9 9 8.55229 9 8C9 7.44772 9.44771 7 10 7C10.5523 7 11 7.44772 11 8Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M10 13C10.5523 13 11 12.5523 11 12C11 11.4477 10.5523 11 10 11C9.44771 11 9 11.4477 9 12C9 12.5523 9.44771 13 10 13Z"}}]},Bn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"sequence-icon",ref:t,icon:ui}))});Bn.displayName="SequenceIcon";const ci={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.00033 1.20996C6.43345 1.20996 5.23596 1.88077 4.64804 2.94304C4.06338 3.99943 4.15123 5.32084 4.90099 6.47062C5.08199 6.7482 5.45374 6.82648 5.73131 6.64548C6.00888 6.46448 6.08716 6.09273 5.90616 5.81516C5.36418 4.98402 5.35768 4.13897 5.69797 3.52412C6.035 2.91515 6.78176 2.40996 8.00033 2.40996C9.19423 2.40996 10.0017 2.93409 10.5236 3.46755C10.7871 3.73682 10.9756 4.00712 11.0974 4.20903C11.158 4.30951 11.2013 4.39164 11.2284 4.44625C11.2419 4.47351 11.2514 4.49377 11.2568 4.50588L11.2621 4.51771C11.3901 4.82216 11.7407 4.96686 12.046 4.83992C12.3519 4.71267 12.4968 4.36149 12.3695 4.05552L11.8231 4.28278C12.3695 4.05552 12.3697 4.0558 12.3695 4.05552L12.3691 4.05437L12.3685 4.05298L12.367 4.04953L12.3629 4.03993L12.3498 4.01036C12.3388 3.98619 12.3234 3.95326 12.3033 3.91282C12.2632 3.83203 12.2043 3.72072 12.1249 3.58908C11.9666 3.32674 11.7235 2.97805 11.3814 2.62834C10.6921 1.92381 9.59192 1.20996 8.00033 1.20996Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.11953 8.5999H7.88935C10.1109 9.46549 10.5895 10.7649 10.4268 11.6869C10.2475 12.703 9.26939 13.5898 8.00009 13.5898C6.63323 13.5898 5.77631 13.0502 5.25534 12.528C4.99021 12.2623 4.80823 11.9965 4.69365 11.7993C4.63659 11.7011 4.59698 11.6211 4.5727 11.5686C4.56059 11.5424 4.55236 11.5231 4.54774 11.512L4.54352 11.5016C4.4267 11.193 4.0823 11.0363 3.77279 11.1516C3.46228 11.2673 3.30438 11.6129 3.4201 11.9234L3.9649 11.7203C3.4201 11.9234 3.41998 11.9231 3.4201 11.9234L3.4206 11.9247L3.42118 11.9263L3.42262 11.9301L3.42661 11.9403C3.42977 11.9484 3.43394 11.9588 3.43914 11.9713C3.44956 11.9965 3.46418 12.0304 3.48334 12.0719C3.52161 12.1547 3.57828 12.2682 3.65608 12.4021C3.81124 12.6692 4.0534 13.0223 4.40584 13.3756C5.12 14.0914 6.27196 14.7898 8.00009 14.7898C9.82574 14.7898 11.3236 13.5101 11.6085 11.8955C11.812 10.7422 11.3901 9.55402 10.2665 8.5999H13.8804C14.2117 8.5999 14.4803 8.33127 14.4803 7.9999C14.4803 7.66853 14.2117 7.3999 13.8804 7.3999H8.01411C8.0048 7.39968 7.99551 7.39969 7.98625 7.3999H2.11953C1.78816 7.3999 1.51953 7.66853 1.51953 7.9999C1.51953 8.33127 1.78816 8.5999 2.11953 8.5999Z"}}]},qn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"strikethrough-icon",ref:t,icon:ci}))});qn.displayName="StrikethroughIcon";const di={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M4.46416 2.03237C4.46416 1.701 4.19553 1.43237 3.86416 1.43237C3.53279 1.43237 3.26416 1.701 3.26416 2.03237V7.33338C3.26416 10.0313 5.35834 12.2667 7.9999 12.2667C10.6415 12.2667 12.7356 10.0313 12.7356 7.33338V2.03237C12.7356 1.701 12.467 1.43237 12.1356 1.43237C11.8043 1.43237 11.5356 1.701 11.5356 2.03237V7.33338C11.5356 9.42194 9.92656 11.0667 7.9999 11.0667C6.07325 11.0667 4.46416 9.42194 4.46416 7.33338V2.03237Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.66641 13.4663C2.33504 13.4663 2.06641 13.7349 2.06641 14.0663C2.06641 14.3977 2.33504 14.6663 2.66641 14.6663H13.3331C13.6644 14.6663 13.9331 14.3977 13.9331 14.0663C13.9331 13.7349 13.6644 13.4663 13.3331 13.4663H2.66641Z"}}]},Wn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"underline-icon",ref:t,icon:di}))});Wn.displayName="UnderlineIcon";const vi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M10.3014 1.70389C9.85268 0.479568 8.12109 0.479557 7.67238 1.70389L4.72235 9.75326C4.60832 10.0644 4.76811 10.4091 5.07924 10.5231C5.39038 10.6371 5.73504 10.4773 5.84907 10.1662L6.99975 7.02646C7.03588 7.03324 7.07314 7.03679 7.11123 7.03679H10.9778L12.1247 10.1662C12.2387 10.4773 12.5834 10.6371 12.8945 10.5231C13.2057 10.4091 13.3654 10.0644 13.2514 9.75326L10.3014 1.70389ZM10.538 5.83679L9.17467 2.11682C9.11057 1.94192 8.8632 1.94192 8.7991 2.11682L7.43576 5.83679H10.538Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Dn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"font-color-double-icon",ref:t,icon:vi}))});Dn.displayName="FontColorDoubleIcon";const hi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}}]},Zn=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"paint-bucket-double-icon",ref:t,icon:hi}))});Zn.displayName="PaintBucketDoubleIcon";const mi={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 17",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M2.27177 13.714L13.5855 2.40025L14.434 3.24878L3.1203 14.5625L2.27177 13.714Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M4.2603 1.82495L2.89617 1.82495C2.23343 1.82495 1.69617 2.36221 1.69617 3.02495L1.69617 4.38908L3.02617 4.38908L3.02617 3.15495L4.2603 3.15495L4.2603 1.82495ZM15.0092 4.38908L15.0092 3.02495C15.0092 2.36221 14.4719 1.82495 13.8092 1.82495L12.4451 1.82495L12.4451 3.15495L13.6792 3.15495L13.6792 4.38908L15.0092 4.38908ZM6.98856 1.82495L6.98856 3.15495L9.71681 3.15495L9.71681 1.82495L6.98856 1.82495ZM15.0092 7.11734L13.6792 7.11734L13.6792 9.84559L15.0092 9.84559L15.0092 7.11734ZM15.0092 12.5739L13.6792 12.5739L13.6792 13.808L12.4451 13.808L12.4451 15.138L13.8092 15.138C14.4719 15.138 15.0092 14.6007 15.0092 13.938L15.0092 12.5739ZM9.71681 15.138L9.71681 13.808L6.98856 13.808L6.98856 15.138L9.71681 15.138ZM4.2603 15.138L4.2603 13.808L3.02617 13.808L3.02617 12.5739L1.69617 12.5739L1.69617 13.938C1.69617 14.6007 2.23343 15.138 2.89617 15.138L4.2603 15.138ZM1.69617 9.8456L3.02617 9.8456L3.02617 7.11734L1.69617 7.11734L1.69617 9.8456Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Qe=g.forwardRef(function(e,t){return g.createElement(ie,Object.assign({},e,{id:"slash-double-icon",ref:t,icon:mi}))});Qe.displayName="SlashDoubleIcon";const Ie=e=>{const{color:t,onChange:s,disable:r=!1,Icon:n=Zn,className:i}=e,l=g.useMemo(()=>new dn(t),[t]),d=()=>{const m={className:G("univer-fill-primary-600",r&&i),extend:{colorChannel1:l.isValid?t:""}};return a.jsx(n,{...m})};return r?d():a.jsx(Ht,{overlay:a.jsx("div",{className:"univer-rounded-lg univer-p-4",children:a.jsx(Kr,{value:t,onChange:s})}),children:a.jsx("span",{className:G("univer-flex univer-cursor-pointer univer-items-center univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",i),children:d()})})},$e=e=>{var t,s,r,n,i;const l=e.rule;if(!l)return null;const d=g.useMemo(()=>{if(l.type===U.colorScale){const o=l.config.map((f,p)=>({color:new dn(f.color),value:p})),c=o.length-1;return new Array(5).fill("").map((f,p,x)=>p*c/(x.length-1)).map(f=>Pr(o,f))}return null},[l]),m=g.useMemo(()=>{if(l.type===U.iconSet)return l.config.map(o=>{const c=ye[o.iconType];return c&&c[Number(o.iconId)]})},[l]),u="univer-pointer-events-none univer-flex univer-h-5 univer-min-w-[72px] univer-items-center univer-justify-center univer-text-xs";switch(l.type){case U.dataBar:{const{isGradient:o}=l.config,c=o?`linear-gradient(to right, ${l.config.positiveColor||We}, rgb(255 255 255))`:l.config.positiveColor,f=o?`linear-gradient(to right,  rgb(255 255 255),${l.config.nativeColor||De})`:l.config.nativeColor;return a.jsxs("div",{className:u,children:[a.jsx("div",{className:"univer-h-full univer-w-1/2 univer-border univer-border-solid",style:{background:f,borderColor:(t=l.config.nativeColor)!=null?t:De}}),a.jsx("div",{className:"univer-h-full univer-w-1/2 univer-border univer-border-solid",style:{background:c,borderColor:(s=l.config.positiveColor)!=null?s:We}})]})}case U.colorScale:return d&&a.jsx("div",{className:u,children:d.map((o,c)=>a.jsx("div",{className:"univer-h-full",style:{width:`${100/d.length}%`,background:o}},c))});case U.iconSet:return m&&a.jsx("div",{className:u,children:m.map((o,c)=>o?a.jsx("img",{className:"univer-h-full",src:o,draggable:!1},c):a.jsx(Qe,{},c))});case U.highlightCell:{const{ul:o,st:c,it:f,bl:p,bg:x,cl:y}=l.style,I=(o==null?void 0:o.s)===te.TRUE,b=(c==null?void 0:c.s)===te.TRUE,j=f===te.TRUE,S=p===te.TRUE,w=(r=x==null?void 0:x.rgb)!=null?r:Br,h=(n=y==null?void 0:y.rgb)!=null?n:qr,C={textDecoration:(i=`${I?"underline":""} ${b?"line-through":""}`.replace(/^ /,""))!=null?i:void 0,backgroundColor:w,color:h};return a.jsx("div",{className:G(u,{"univer-font-bold":S,"univer-italic":j}),style:C,children:"123"})}}},et=G("univer-mt-5 univer-px-1 univer-py-2 univer-rounded",Te),pe=(e,t)=>({label:t.t(`sheet.cf.valueType.${e}`),value:e}),Rt=e=>{var t;const{type:s,className:r,onChange:n,id:i,value:l}=e,d=W(D),m=d.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),u=(t=d.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:t.getSheetId(),o=g.useMemo(()=>String(l).startsWith("=")?String(l):"=",[l]),c=g.useMemo(()=>[H.max,H.min,"none"].includes(s)?{disabled:!0}:[H.percent,H.percentile].includes(s)?{min:0,max:100}:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},[s]),f=g.useRef(null),[p,x]=g.useState(!1);return It(y=>{var I;(I=f.current)!=null&&I.isClickOutSide(y)&&x(!1)}),s===H.formula?a.jsx("div",{className:"univer-ml-1 univer-w-full",children:a.jsx(St,{ref:f,className:G("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",Te),initValue:o,unitId:m,subUnitId:u,isFocus:p,onChange:(y="")=>{n(y||"")},onFocus:()=>x(!0)})}):a.jsx(be,{className:r,value:Number(e.value)||0,onChange:y=>e.onChange(y||0),...c})},gi=e=>{var t;const{interceptorManager:s}=e,r=W(K),n=((t=e.rule)==null?void 0:t.type)===U.colorScale?e.rule:void 0,i=[pe(H.num,r),pe(H.percent,r),pe(H.percentile,r),pe(H.formula,r)],l=[pe(H.min,r),...i],d=[pe("none",r),...i],m=[pe(H.max,r),...i],[u,o]=g.useState(()=>{var v;const E=H.min;return n&&((v=n.config[0])==null?void 0:v.value.type)||E}),[c,f]=g.useState(()=>{var v;const E="none";return!n||n.config.length!==3?E:((v=n.config[1])==null?void 0:v.value.type)||E}),[p,x]=g.useState(()=>{var v;const E=H.max;return n&&((v=n.config[n.config.length-1])==null?void 0:v.value.type)||E}),[y,I]=g.useState(()=>{if(!n)return 10;const v=n.config[0];return(v==null?void 0:v.value.value)===void 0?10:v==null?void 0:v.value.value}),[b,j]=g.useState(()=>{var v;if(!n||n.config.length!==3)return 50;const E=(v=n.config[1])==null?void 0:v.value.value;return E===void 0?50:E}),[S,w]=g.useState(()=>{var v;if(!n)return 90;const E=(v=n.config[n.config.length-1])==null?void 0:v.value.value;return E===void 0?90:E}),[h,C]=g.useState(()=>{var v;return n&&((v=n.config[0])==null?void 0:v.color)||"#d0d9fb"}),[T,_]=g.useState(()=>{var v;const E="#7790f3";return!n||n.config.length!==3?E:((v=n.config[1])==null?void 0:v.color)||E}),[R,N]=g.useState(()=>{var v;return n&&((v=n.config[n.config.length-1])==null?void 0:v.color)||"#2e55ef"}),V=g.useMemo(()=>v=>{const{minType:E,medianType:ee,maxType:we,minValue:Ee,medianValue:de,maxValue:je,minColor:_e,medianColor:$,maxColor:B}=v,P=[];return P.push({color:_e,value:{type:E,value:Ee}}),ee!=="none"&&P.push({color:$,value:{type:ee,value:de}}),P.push({color:B,value:{type:we,value:je}}),{config:P.map((Z,Y)=>({...Z,index:Y})),type:U.colorScale}},[]);g.useEffect(()=>s.intercept(s.getInterceptPoints().submit,{handler(){return V({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:S,minColor:h,medianColor:T,maxColor:R})}}),[V,u,c,p,y,b,S,h,T,R,s]);const k=v=>{e.onChange(V(v))};return a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.panel.styleRule")}),a.jsx("div",{className:et,children:a.jsx($e,{rule:V({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:S,minColor:h,medianColor:T,maxColor:R})})}),a.jsx("div",{className:"univer-mt-3 univer-text-xs univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.valueType.min")}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-h-8 univer-items-center",children:[a.jsx(ne,{className:"univer-flex-shrink-0",options:l,value:u,onChange:v=>{o(v);const E=qe(v,10);I(E),k({minType:v,medianType:c,maxType:p,minValue:E,medianValue:b,maxValue:S,minColor:h,medianColor:T,maxColor:R})}}),a.jsx(Rt,{id:"min",className:"univer-ml-1",value:y,type:u,onChange:v=>{I(v),k({minType:u,medianType:c,maxType:p,minValue:v,medianValue:b,maxValue:S,minColor:h,medianColor:T,maxColor:R})}}),a.jsx(Ie,{className:"univer-ml-1",color:h,onChange:v=>{C(v),k({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:S,minColor:v,medianColor:T,maxColor:R})}})]}),a.jsx("div",{className:"univer-text-gray-600dark:!univer-text-gray-200 univer-mt-3 univer-text-xs",children:r.t("sheet.cf.panel.medianValue")}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-h-8 univer-items-center",children:[a.jsx(ne,{className:"univer-flex-shrink-0",options:d,value:c,onChange:v=>{f(v);const E=qe(v,50);j(E),k({minType:u,medianType:v,maxType:p,minValue:y,medianValue:E,maxValue:S,minColor:h,medianColor:T,maxColor:R})}}),a.jsx(Rt,{id:"median",className:"univer-ml-1",value:b,type:c,onChange:v=>{j(v),k({minType:u,medianType:c,maxType:p,minValue:y,medianValue:v,maxValue:S,minColor:h,medianColor:T,maxColor:R})}}),c!=="none"&&a.jsx(Ie,{className:"univer-ml-1",color:T,onChange:v=>{_(v),k({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:S,minColor:h,medianColor:v,maxColor:R})}})]}),a.jsx("div",{className:"univer-mt-3 univer-text-xs univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.valueType.max")}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-h-8 univer-items-center",children:[a.jsx(ne,{className:"univer-flex-shrink-0",options:m,value:p,onChange:v=>{x(v);const E=qe(v,90);w(E),k({minType:u,medianType:c,maxType:v,minValue:y,medianValue:b,maxValue:E,minColor:h,medianColor:T,maxColor:R})}}),a.jsx(Rt,{id:"max",className:"univer-ml-1",value:S,type:p,onChange:v=>{w(v),k({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:v,minColor:h,medianColor:T,maxColor:R})}}),a.jsx(Ie,{className:"univer-ml-1",color:R,onChange:v=>{N(v),k({minType:u,medianType:c,maxType:p,minValue:y,medianValue:b,maxValue:S,minColor:h,medianColor:T,maxColor:v})}})]})]})},Ne=(e,t)=>({label:t.t(`sheet.cf.valueType.${e}`),value:e}),zt=e=>{var t;const{onChange:s,className:r,value:n,type:i,id:l,disabled:d=!1}=e,m=W(D),u=m.getCurrentUnitOfType(A.UNIVER_SHEET).getUnitId(),o=(t=m.getCurrentUnitOfType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:t.getSheetId(),c=g.useRef(null),[f,p]=g.useState(!1);It(I=>{var b;(b=c.current)!=null&&b.isClickOutSide(I)&&p(!1)});const x=g.useRef(n),y=g.useMemo(()=>[H.percentile,H.percent].includes(i)?{max:100,min:0}:{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER},[i]);if(i===H.formula){const I=String(x.current).startsWith("=")?String(x.current)||"":"=";return a.jsx("div",{className:"univer-ml-3 univer-w-full",children:a.jsx(St,{ref:c,className:G("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",Te),initValue:I,unitId:u,subUnitId:o,isFocus:f,onChange:(b="")=>{s(b||"")},onFocus:()=>p(!0)})})}return a.jsx(be,{className:r,value:Number(n)||0,disabled:d,onChange:I=>{s(I||0)},...y})},fi=e=>{var t;const{interceptorManager:s}=e,r=W(K),n=((t=e.rule)==null?void 0:t.type)===U.dataBar?e.rule:void 0,[i,l]=g.useState(()=>{var v;return n&&(v=n.config)!=null&&v.isGradient?"1":"0"}),[d,m]=g.useState(()=>{var v;return n?((v=n.config)==null?void 0:v.positiveColor)||We:We}),[u,o]=g.useState(()=>{var v;return n?((v=n.config)==null?void 0:v.nativeColor)||De:De}),c=[Ne(H.num,r),Ne(H.percent,r),Ne(H.percentile,r),Ne(H.formula,r)],f=[Ne(H.min,r),...c],p=[Ne(H.max,r),...c],[x,y]=g.useState(()=>{var v;const E=f[0].value;return n&&((v=n.config)==null?void 0:v.min.type)||E}),[I,b]=g.useState(()=>{var v;const E=p[0].value;return n&&((v=n.config)==null?void 0:v.max.type)||E}),[j,S]=g.useState(()=>{var v;if(!n)return 0;const E=((v=n.config)==null?void 0:v.min)||{};return E.type===H.formula?E.value||"=":E.value||0}),[w,h]=g.useState(()=>{var v;if(!n)return 100;const E=((v=n.config)==null?void 0:v.max)||{};return E.type===H.formula?E.value||"=":E.value===void 0?100:E.value}),[C,T]=g.useState(()=>n?n.isShowValue===void 0?!0:!!n.isShowValue:!0),_=v=>({config:{min:{type:v.minValueType,value:v.minValue},max:{type:v.maxValueType,value:v.maxValue},isGradient:v.isGradient==="1",positiveColor:v.positiveColor||We,nativeColor:v.nativeColor||De},type:U.dataBar,isShowValue:v.isShowValue});g.useEffect(()=>s.intercept(s.getInterceptPoints().submit,{handler(){return _({isGradient:i,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})}}),[i,j,x,w,I,d,u,s,C]);const R=v=>{e.onChange(_(v))},N=v=>{m(v),R({isGradient:i,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:v,nativeColor:u,isShowValue:C})},V=v=>{o(v),R({isGradient:i,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:v,isShowValue:C})},k=v=>c.map(E=>E.value).includes(v);return a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.panel.styleRule")}),a.jsx("div",{className:et,children:a.jsx($e,{rule:_({isGradient:i,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})})}),a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.panel.fillType")}),a.jsxs("div",{className:"univer-ml-1 univer-mt-3 univer-flex univer-items-center",children:[a.jsxs(Xr,{value:i,onChange:v=>{l(v),R({isGradient:v,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})},children:[a.jsx(Gt,{value:"0",children:a.jsx("span",{className:"univer-text-xs",children:r.t("sheet.cf.panel.pureColor")})}),a.jsx(Gt,{value:"1",children:a.jsx("span",{className:"univer-text-xs",children:r.t("sheet.cf.panel.gradient")})})]}),a.jsxs("div",{className:"univer-ml-6 univer-flex univer-items-center univer-text-xs",children:[a.jsx(vt,{checked:!C,onChange:v=>{T(!v),R({isGradient:v,minValue:j,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:!v})}}),r.t("sheet.cf.panel.onlyShowDataBar")]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.panel.colorSet")}),a.jsxs("div",{className:"univer-ml-1 univer-mt-3 univer-flex univer-items-center",children:[a.jsxs("div",{className:"univer-flex univer-items-center",children:[a.jsx("div",{className:"univer-text-xs",children:r.t("sheet.cf.panel.native")}),a.jsx(Ie,{color:u,onChange:V})]}),a.jsxs("div",{className:"univer-ml-3 univer-flex univer-items-center",children:[a.jsx("div",{className:"univer-text-xs",children:r.t("sheet.cf.panel.positive")}),a.jsx(Ie,{color:d,onChange:N})]})]})]}),a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.valueType.min")}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center",children:[a.jsx(ne,{className:"univer-w-1/2 univer-flex-shrink-0",options:f,value:x,onChange:v=>{y(v);const E=qe(v,10);S(E),R({isGradient:i,minValue:E,minValueType:v,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})}}),a.jsx(zt,{id:"min",className:"univer-ml-3",disabled:!k(x),type:x,value:j,onChange:v=>{S(v||0),R({isGradient:i,minValue:v||0,minValueType:x,maxValue:w,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})}})]}),a.jsx("div",{className:"univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:r.t("sheet.cf.valueType.max")}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center",children:[a.jsx(ne,{className:"univer-w-1/2 univer-flex-shrink-0",options:p,value:I,onChange:v=>{b(v);const E=qe(v,90);h(E),R({isGradient:i,minValue:j,minValueType:x,maxValue:E,maxValueType:v,positiveColor:d,nativeColor:u,isShowValue:C})}}),a.jsx(zt,{className:"univer-ml-3",disabled:!k(I),id:"max",type:I,value:w,onChange:v=>{h(v||0),R({isGradient:i,minValue:j,minValueType:x,maxValue:v||0,maxValueType:I,positiveColor:d,nativeColor:u,isShowValue:C})}})]})]})]})},tt=e=>[te.FALSE,void 0].includes(e)?te.TRUE:te.FALSE,nt=e=>e!==te.FALSE,Ot=e=>{const{style:t,onChange:s,className:r}=e,[n,i]=g.useState(()=>{if(t!=null&&t.bl)return t.bl}),[l,d]=g.useState(()=>{if(t!=null&&t.it)return t.it}),[m,u]=g.useState(()=>{if(t!=null&&t.ul)return t.ul.s}),[o,c]=g.useState(()=>{if(t!=null&&t.st)return t.st.s}),[f,p]=g.useState(()=>{var b;return(b=t==null?void 0:t.cl)!=null&&b.rgb?t.cl.rgb:"#2f56ef"}),[x,y]=g.useState(()=>{var b;return(b=t==null?void 0:t.bg)!=null&&b.rgb?t.bg.rgb:"#e8ecfc"});g.useEffect(()=>{const b={bl:n,it:l};f!==void 0&&(b.cl={rgb:f}),x!==void 0&&(b.bg={rgb:x}),o!==void 0&&(b.st={s:o}),m!==void 0&&(b.ul={s:m}),s(Wr(b))},[n,l,m,o,f,x]);const I="univer-flex univer-cursor-pointer univer-items-center univer-rounded univer-px-1";return a.jsxs("div",{className:G("univer-my-2.5 univer-flex univer-justify-between",r),children:[a.jsx("div",{className:G(I,{"univer-bg-gray-100 dark:!univer-bg-gray-700":nt(n||te.FALSE)}),onClick:()=>i(tt(n)),children:a.jsx(An,{})}),a.jsx("div",{className:G(I,{"univer-bg-gray-100 dark:!univer-bg-gray-700":nt(l||te.FALSE)}),onClick:()=>d(tt(l)),children:a.jsx(Pn,{})}),a.jsx("div",{className:G(I,{"univer-bg-gray-100 dark:!univer-bg-gray-700":nt(m||te.FALSE)}),onClick:()=>u(tt(m)),children:a.jsx(Wn,{})}),a.jsx("div",{className:G(I,{"univer-bg-gray-100 dark:!univer-bg-gray-700":nt(o||te.FALSE)}),onClick:()=>c(tt(o)),children:a.jsx(qn,{})}),a.jsx(Ie,{color:f,onChange:p,Icon:Dn}),a.jsx(Ie,{color:x,onChange:y})]})},pi=e=>{var t;const{onChange:s,interceptorManager:r}=e,n=W(K),i=W(D).getCurrentUnitForType(A.UNIVER_SHEET),l=i.getActiveSheet(),d=((t=e.rule)==null?void 0:t.type)===U.highlightCell?e.rule:void 0,m=g.useRef(null),[u,o]=g.useState(!1),c=g.useRef(null),[f,p]=g.useState({}),[x,y]=g.useState(()=>(d==null?void 0:d.subType)===M.formula?d.value:"="),[I,b]=g.useState(void 0),j=w=>({style:w.style,value:x,type:U.highlightCell,subType:M.formula});g.useEffect(()=>r.intercept(r.getInterceptPoints().submit,{handler(){return j({style:f})}}),[f,x,r]),g.useEffect(()=>r.intercept(r.getInterceptPoints().beforeSubmit,{handler:(w,h,C)=>I||x.length===1||!x.startsWith("=")?(b(n.t("sheet.cf.errorMessage.formulaError")),!1):C(w)}),[I,x]);const S=w=>{s(j(w))};return It(w=>{var h;(h=c.current)!=null&&h.isClickOutSide(w)&&o(!1)}),a.jsxs("div",{ref:m,children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:n.t("sheet.cf.panel.styleRule")}),a.jsx("div",{className:"univer-mt-3",children:a.jsx(St,{ref:c,className:G("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",Te),errorText:I,isFocus:u,initValue:x,unitId:i.getUnitId(),subUnitId:l==null?void 0:l.getSheetId(),onFocus:()=>{o(!0)},onChange:w=>{y(w),S({style:f})},onVerify:(w,h)=>{!w||h.length===1?b(n.t("sheet.cf.errorMessage.formulaError")):b(void 0)}})}),a.jsx("div",{className:et,children:a.jsx($e,{rule:j({style:f})})}),a.jsx(Ot,{style:d==null?void 0:d.style,className:"univer-mt-3",onChange:w=>{p(w),S({style:w})}})]})},rt=e=>a.jsxs("div",{className:"univer-relative",children:[a.jsx("div",{className:"univer-absolute univer-bottom-[-13px] univer-z-[999] univer-text-[10px] univer-text-red-500",children:e.errorText}),e.children]}),q=(e,t)=>({label:t.t(`sheet.cf.operator.${e}`),value:e}),xi=e=>{const{type:t,operator:s,onChange:r,value:n,interceptorManager:i}=e,l=W(K),[d,m]=g.useState(()=>typeof n=="number"?n:0),[u,o]=g.useState(""),[c,f]=g.useState(()=>typeof n=="string"?n:""),[p,x]=g.useState(""),[y,I]=g.useState(()=>Array.isArray(n)?n[0]===void 0?0:n[0]:0),[b,j]=g.useState(""),[S,w]=g.useState(()=>Array.isArray(n)?n[1]===void 0?100:n[1]:100),[h,C]=g.useState("");switch(g.useEffect(()=>{switch(t){case M.text:{[O.beginsWith,O.endsWith,O.containsText,O.notContainsText,O.equal,O.notEqual].includes(s)&&r(c);break}case M.number:{[L.equal,L.notEqual,L.greaterThan,L.greaterThanOrEqual,L.lessThan,L.lessThanOrEqual].includes(s)&&r(d),[L.between,L.notBetween].includes(s)&&r([y,S]);break}}},[t]),g.useEffect(()=>{const T=i.intercept(i.getInterceptPoints().beforeSubmit,{handler:(_,R,N)=>{switch(t){case M.text:if([O.beginsWith,O.containsText,O.endsWith,O.notEqual,O.notContainsText,O.equal].includes(s))return c?N(_):(x(l.t("sheet.cf.errorMessage.notBlank")),!1)}return N(_)}});return()=>{T()}},[t,d,c,s]),t){case M.text:{if([O.beginsWith,O.endsWith,O.containsText,O.notContainsText,O.equal,O.notEqual].includes(s)){const T=_=>{f(_),r(_)};return a.jsx("div",{className:"univer-mt-3",children:a.jsx(rt,{errorText:p,children:a.jsx(Yr,{value:c,onChange:_=>{x(""),T(_)}})})})}break}case M.number:{if([L.equal,L.notEqual,L.greaterThan,L.greaterThanOrEqual,L.lessThan,L.lessThanOrEqual].includes(s)){const T=_=>{m(_||0),r(_||0),o("")};return a.jsx("div",{className:"univer-mt-3",children:a.jsx(rt,{errorText:u,children:a.jsx(be,{className:"univer-w-full",min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,value:d,onChange:T})})})}if([L.between,L.notBetween].includes(s)){const T=R=>{I(R||0),r([R||0,S]),j("")},_=R=>{w(R||0),r([y,R||0]),C("")};return a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center",children:[a.jsx(rt,{errorText:b,children:a.jsx(be,{min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,value:y,onChange:T})}),a.jsx(rt,{errorText:h,children:a.jsx(be,{className:"univer-ml-3",min:Number.MIN_SAFE_INTEGER,max:Number.MAX_SAFE_INTEGER,value:S,onChange:_})})]})}}}return null},Xt=(e,t)=>{switch(e){case M.text:return[q(O.containsText,t),q(O.notContainsText,t),q(O.beginsWith,t),q(O.endsWith,t),q(O.equal,t),q(O.notEqual,t),q(O.containsBlanks,t),q(O.notContainsBlanks,t),q(O.containsErrors,t),q(O.notContainsErrors,t)];case M.number:return[q(L.between,t),q(L.notBetween,t),q(L.equal,t),q(L.notEqual,t),q(L.greaterThan,t),q(L.greaterThanOrEqual,t),q(L.lessThan,t),q(L.lessThanOrEqual,t)];case M.timePeriod:return[q(se.yesterday,t),q(se.today,t),q(se.tomorrow,t),q(se.last7Days,t),q(se.lastWeek,t),q(se.thisWeek,t),q(se.nextWeek,t),q(se.lastMonth,t),q(se.thisMonth,t),q(se.nextMonth,t)]}},Yt=e=>{var t;const{interceptorManager:s,onChange:r}=e,n=W(K),i=((t=e.rule)==null?void 0:t.type)===U.highlightCell?e.rule:void 0,[l,d]=g.useState(()=>{const h=M.text;return i&&i.subType||h}),m=[{value:M.text,label:n.t("sheet.cf.subRuleType.text")},{value:M.number,label:n.t("sheet.cf.subRuleType.number")},{value:M.timePeriod,label:n.t("sheet.cf.subRuleType.timePeriod")},{value:M.duplicateValues,label:n.t("sheet.cf.subRuleType.duplicateValues")},{value:M.uniqueValues,label:n.t("sheet.cf.subRuleType.uniqueValues")}],u=g.useMemo(()=>Xt(l,n),[l]),[o,c]=g.useState(()=>{const h=u?u[0].value:void 0;return i&&i.operator||h}),[f,p]=g.useState(()=>{var h;return i?(h=i.value)!=null?h:dt(i.subType,i.operator):""}),[x,y]=g.useState({}),I=g.useMemo(()=>h=>{var C,T,_,R,N,V,k,v,E,ee,we,Ee,de,je,_e;switch(h.subType||l){case M.text:{if([O.beginsWith,O.endsWith,O.containsText,O.notContainsText,O.equal,O.notEqual].includes(o))return{type:U.highlightCell,subType:(C=h.subType)!=null?C:l,operator:(T=h.operator)!=null?T:o,style:(_=h.style)!=null?_:x,value:(R=h.value)!=null?R:f};break}case M.number:{if([L.equal,L.notEqual,L.greaterThan,L.greaterThanOrEqual,L.lessThan,L.lessThanOrEqual].includes(o))return{type:U.highlightCell,subType:(N=h.subType)!=null?N:l,operator:(V=h.operator)!=null?V:o,style:(k=h.style)!=null?k:x,value:(v=h.value)!=null?v:f};if([L.between,L.notBetween].includes(o))return{type:U.highlightCell,subType:(E=h.subType)!=null?E:l,operator:(ee=h.operator)!=null?ee:o,style:(we=h.style)!=null?we:x,value:(Ee=h.value)!=null?Ee:f};break}}return{type:U.highlightCell,subType:(de=h.subType)!=null?de:l,operator:(je=h.operator)!=null?je:o,style:(_e=h.style)!=null?_e:x}},[l,o,f,x]);g.useEffect(()=>s.intercept(s.getInterceptPoints().submit,{handler(){return I({})}}),[I,s]),g.useEffect(()=>{m.some(h=>h.value===l)||d(m[0].value)},[m]);const b=h=>{const C=h,T=Xt(C,n),_=T&&T[0].value;d(C),c(_),_&&p(dt(C,_)),r(I({subType:C,operator:_}))},j=h=>{const C=h;c(C),r(I({operator:C}))},S=h=>{p(h),r(I({value:h}))},w=g.useMemo(()=>`${l}_${o}_${Math.random()}`,[l,o]);return a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:n.t("sheet.cf.panel.styleRule")}),a.jsxs("div",{className:"univer-flex univer-justify-between univer-gap-4",children:[a.jsx(ne,{className:"univer-mt-3 univer-w-full",onChange:b,value:l,options:m}),(u==null?void 0:u.length)&&a.jsx(ne,{className:"univer-mt-3 univer-w-full",onChange:j,value:o||"",options:u})]}),a.jsx(xi,{value:f,interceptorManager:s,type:l,operator:o,rule:i,onChange:S},w),a.jsx("div",{className:et,children:a.jsx($e,{rule:I({})})}),a.jsx(Ot,{style:i==null?void 0:i.style,className:"univer-ml-1",onChange:h=>{y(h),r(I({style:h}))}})]})},Gn=(e,t)=>(ye[e]||[])[Number(t)]||"",Ci=e=>{var t;const{error:s,type:r,onChange:n}=e,i=W(D),l=i.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),d=(t=i.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:t.getSheetId(),m=g.useRef(null),[u,o]=g.useState(!1);return It(c=>{var f;(f=m.current)!=null&&f.isClickOutSide(c)&&o(!1)}),a.jsx("div",{className:"univer-relative",children:r!==H.formula?a.jsxs(a.Fragment,{children:[a.jsx(be,{className:G({"univer-border-red-500":s}),value:Number(e.value)||0,onChange:c=>n(c??0)}),s&&a.jsx("div",{className:"univer-absolute univer-text-xs univer-text-red-500",children:s})]}):a.jsx("div",{className:"univer-w-full",children:a.jsx(St,{ref:m,className:G("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",Te),initValue:String(e.value),unitId:l,subUnitId:d,isFocus:u,onChange:(c="")=>{n(c||"")},onFocus:()=>o(!0)})})})},Kt=(e,t,s)=>({operator:L.greaterThan,value:{type:H.num,value:(s.length-1-t)*10},iconType:e,iconId:String(t)}),yi=g.forwardRef((e,t)=>{const{onClick:s}=e,r=W(K),n=i=>{s(i)};return a.jsx("div",{ref:t,className:"univer-w-80",children:Dr.map((i,l)=>a.jsxs("div",{className:"univer-mb-3",children:[a.jsx("div",{className:"univer-mb-1 univer-text-sm",children:r.t(i.title)}),a.jsx("div",{className:"univer-flex univer-flex-wrap",children:i.group.map(d=>a.jsx("div",{className:"univer-mb-1 univer-flex univer-w-1/2 univer-items-center",onClick:()=>{n(d.name)},children:a.jsx("a",{className:"univer-cursor-pointer univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",children:d.list.map((m,u)=>a.jsx("img",{className:"univer-size-5",src:m,draggable:!1},u))})},d.name))})]},l))})}),bi=e=>{const{onClick:t}=e,s=g.useMemo(()=>{const n=[];for(const i in ye){const l=ye[i],d=i;l.forEach((m,u)=>{n.push({iconType:d,base64:m,iconId:String(u)})})}return n},[]),r=n=>{t(n.iconType,n.iconId)};return a.jsxs("div",{children:[a.jsxs("div",{className:"univer-mb-2.5 univer-flex univer-cursor-pointer univer-items-center univer-pl-1",onClick:()=>r({iconType:Gr,iconId:""}),children:[a.jsx(Qe,{className:"univer-size-5"}),a.jsx("span",{className:"univer-ml-2",children:"无单元格图标"})]}),a.jsx("div",{className:"univer-flex univer-w-64 univer-flex-wrap",children:s.map(n=>a.jsx("div",{className:"univer-mb-2 univer-mr-2 univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",children:a.jsx("img",{className:"univer-size-5",src:n.base64,draggable:!1,onClick:()=>r(n)})},`${n.iconType}_${n.iconId}`))})]})},Ii=e=>{const{onChange:t,configList:s,errorMap:r={}}=e,n=W(K),i=[{label:n.t(`sheet.cf.symbol.${L.greaterThan}`),value:L.greaterThan},{label:n.t(`sheet.cf.symbol.${L.greaterThanOrEqual}`),value:L.greaterThanOrEqual}],l=[{label:n.t(`sheet.cf.valueType.${H.num}`),value:H.num},{label:n.t(`sheet.cf.valueType.${H.percent}`),value:H.percent},{label:n.t(`sheet.cf.valueType.${H.percentile}`),value:H.percentile},{label:n.t(`sheet.cf.valueType.${H.formula}`),value:H.formula}],d=(o,c)=>{t([String(c),"value","value"],o)},m=(o,c)=>{t([String(c),"operator"],o);const f=dt(M.number,o);d(f,c)},u=(o,c)=>{t([String(c),"value","type"],o);const f=s[c],p=dt(M.number,f.operator);d(p,c)};return g.useMemo(()=>s.map((o,c)=>{const f=r[c],p=Gn(o.iconType,o.iconId),x=c===s.length-1,y=c===0,I=s[c-1],b=(I==null?void 0:I.value.type)===H.formula?n.t("sheet.cf.valueType.formula"):I==null?void 0:I.value.value,j=(S,w)=>{const h={...o,iconId:w,iconType:S};t([String(c)],h)};return a.jsxs("div",{className:c?"univer-mt-6":"univer-mt-3",children:[a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center univer-justify-between univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:[a.jsxs("div",{className:"univer-w-[45%]",children:[n.t("sheet.cf.iconSet.icon"),c+1]}),a.jsx("div",{className:"univer-w-[45%]",children:a.jsxs(a.Fragment,{children:[!y&&!x&&n.t("sheet.cf.iconSet.rule"),!y&&!x&&a.jsxs("span",{className:"univer-font-medium univer-text-gray-600 dark:!univer-text-gray-200",children:[n.t("sheet.cf.iconSet.when"),n.t(`sheet.cf.symbol.${Ut(I.operator)}`),b,x?"":` ${n.t("sheet.cf.iconSet.and")} `]})]})})]}),a.jsxs("div",{className:"univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4",children:[a.jsx("div",{className:"univer-flex univer-items-center",children:a.jsx(Ht,{overlay:a.jsx("div",{className:"univer-rounded-lg univer-p-4",children:a.jsx(bi,{onClick:j,iconId:o.iconId,iconType:o.iconType})}),children:a.jsxs("div",{className:G("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-4 univer-py-2 univer-text-xs univer-text-gray-600 univer-transition-all hover:univer-border-primary-600 dark:!univer-text-gray-200",Te),children:[p?a.jsx("img",{src:p,className:"univer-size-4",draggable:!1}):a.jsx(Qe,{className:"univer-size-4"}),a.jsx(At,{})]})})}),x?a.jsxs("div",{className:"univer-mt-0 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:[n.t("sheet.cf.iconSet.rule"),a.jsxs("span",{className:"univer-font-medium",children:[n.t("sheet.cf.iconSet.when"),n.t(`sheet.cf.symbol.${Ut(I.operator)}`),b,x?"":` ${n.t("sheet.cf.iconSet.and")} `]})]}):a.jsx(ne,{options:i,value:o.operator,onChange:S=>{m(S,c)}})]}),x?a.jsx("div",{}):a.jsxs(a.Fragment,{children:[a.jsxs("div",{className:"univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:[a.jsx("div",{children:n.t("sheet.cf.iconSet.type")}),a.jsx("div",{children:n.t("sheet.cf.iconSet.value")})]}),a.jsxs("div",{className:"univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4",children:[a.jsx(ne,{options:l,value:o.value.type,onChange:S=>{u(S,c)}}),a.jsx(Ci,{id:c,type:o.value.type,error:f,value:o.value.value||"",onChange:S=>{d(S,c)}})]})]})]},c)}),[s,r])},Si=e=>{var t;const{interceptorManager:s}=e,r=((t=e.rule)==null?void 0:t.type)===U.iconSet?e.rule:void 0,n=W(K),[i,l]=g.useState({}),[d,m]=g.useState(()=>{const h=Object.keys(ye)[0];if(r&&r.config.length){const C=r.config[0].iconType;if(!r.config.some(T=>T.iconType!==C))return C}return h}),[u,o]=g.useState(()=>{if(r&&r.config.length)return Lt.deepClone(r==null?void 0:r.config);const h=ye[d]||[];return new Array(h.length).fill("").map((C,T,_)=>T===_.length-1?{operator:L.lessThanOrEqual,value:{type:H.num,value:Number.MAX_SAFE_INTEGER},iconType:d,iconId:String(T)}:Kt(d,T,_))}),[c,f]=g.useState(()=>r?!!r.isShowValue:!0),p=g.useMemo(()=>{const h=u.map(C=>Gn(C.iconType,C.iconId));return a.jsx("div",{className:"univer-flex univer-items-center",children:h.map((C,T)=>C?a.jsx("img",{className:"univer-size-5",src:C},T):a.jsx(Qe,{className:"univer-size-5"},T))})},[u]),x=h=>{if(h.reduce((C,T,_)=>C.preType&&!C.result||h.length-1===_?C:T.value.type===H.formula?{preType:H.formula,result:!1}:C.preType?{result:C.preType===T.value.type,preType:T.value.type}:{result:!0,preType:T.value.type},{result:!0,preType:""}).result&&[H.num,H.percent,H.percentile].includes(h[0].value.type)){const C={};return h.forEach((T,_,R)=>{if(_-1<0||_===R.length-1)return;const N=h[_-1],V=Ut(N.operator);Zr({operator:V,value:N.value.value},T.value.value)||(C[_]=`${n.t(`sheet.cf.form.${V}`,String(N.value.value))} `)}),C}return{}},y=(h,C)=>{ir(u,h)!==C&&(sr(u,h,C),o([...u]),l(x(u)))},I=h=>{m(h);const C=ye[h]||[],T=new Array(C.length).fill("").map((_,R,N)=>Kt(h,R,N));o(T),l(x(T))};g.useEffect(()=>{const h=s.intercept(s.getInterceptPoints().submit,{handler(){return{type:U.iconSet,isShowValue:c,config:u}}});return()=>{h()}},[c,u,s]),g.useEffect(()=>{const h=s.intercept(s.getInterceptPoints().beforeSubmit,{handler(){return Object.keys(i).length===0}});return()=>{h()}},[c,u,s,i]);const b=()=>{const h=u.map(C=>({...C}));u.forEach((C,T)=>{const _=u.length-1-T,R=h[_];C.iconId=R.iconId,C.iconType=R.iconType}),o([...u])},j=W(Tr),[S,w]=g.useState();return wr(S,j.rootContainerElement),a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600",children:n.t("sheet.cf.panel.styleRule")}),a.jsx("div",{className:"univer-mt-3",children:a.jsx(Ht,{overlay:a.jsx("div",{className:"univer-rounded-lg univer-p-4",children:a.jsx(yi,{ref:h=>{!S&&h&&w(h)},iconType:d,onClick:I})}),children:a.jsxs("div",{className:G("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-4 univer-py-2 univer-text-xs univer-text-gray-600 univer-transition-all hover:univer-border-primary-600",Te),children:[p,a.jsx(At,{})]})})}),a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center univer-text-xs",children:[a.jsxs("div",{className:"univer-flex univer-items-center univer-text-xs",children:[a.jsx(vt,{onChange:b}),n.t("sheet.cf.iconSet.reverseIconOrder")]}),a.jsxs("div",{className:"univer-ml-6 univer-flex univer-items-center univer-text-xs",children:[a.jsx(vt,{checked:!c,onChange:h=>{f(!h)}}),n.t("sheet.cf.iconSet.onlyShowIcon")]})]}),a.jsx(Ii,{errorMap:i,onChange:y,configList:u})]})},Ti=e=>{var t;const{onChange:s,interceptorManager:r}=e,n=W(K),i=((t=e.rule)==null?void 0:t.type)===U.highlightCell?e.rule:void 0,l=[{label:n.t("sheet.cf.panel.isNotBottom"),value:"isNotBottom"},{label:n.t("sheet.cf.panel.isBottom"),value:"isBottom"},{label:n.t("sheet.cf.panel.greaterThanAverage"),value:"greaterThanAverage"},{label:n.t("sheet.cf.panel.lessThanAverage"),value:"lessThanAverage"}],[d,m]=g.useState(()=>{const b=l[0].value,j=i==null?void 0:i.type;if(!i)return b;switch(j){case U.highlightCell:switch(i.subType){case M.average:return[L.greaterThan,L.greaterThanOrEqual].includes(i.operator)?"greaterThanAverage":[L.lessThan,L.lessThanOrEqual].includes(i.operator)?"lessThanAverage":b;case M.rank:return i.isBottom?"isBottom":"isNotBottom"}}return b}),[u,o]=g.useState(()=>{const b=i==null?void 0:i.type;if(!i)return 10;switch(b){case U.highlightCell:switch(i.subType){case M.rank:return i.value||10}}return 10}),[c,f]=g.useState(()=>{const b=i==null?void 0:i.type;if(!i)return!1;switch(b){case U.highlightCell:switch(i.subType){case M.rank:return i.isPercent||!1}}return!1}),[p,x]=g.useState({}),y=b=>{const{type:j,isPercent:S,value:w,style:h}=b;if(j==="isNotBottom")return{type:U.highlightCell,subType:M.rank,isPercent:S,isBottom:!1,value:w,style:h};if(j==="isBottom")return{type:U.highlightCell,subType:M.rank,isPercent:S,isBottom:!0,value:w,style:h};if(j==="greaterThanAverage")return{type:U.highlightCell,subType:M.average,operator:L.greaterThan,style:h};if(j==="lessThanAverage")return{type:U.highlightCell,subType:M.average,operator:L.lessThan,style:h}};g.useEffect(()=>r.intercept(r.getInterceptPoints().submit,{handler(){return y({type:d,isPercent:c,value:u,style:p})}}),[d,c,u,p,r]);const I=b=>{s(y(b))};return a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:n.t("sheet.cf.panel.styleRule")}),a.jsx(ne,{className:"univer-mt-3 univer-w-full",value:d,options:l,onChange:b=>{m(b),I({type:b,isPercent:c,value:u,style:p})}}),["isNotBottom","isBottom"].includes(d)&&a.jsxs("div",{className:"univer-mt-3 univer-flex univer-items-center",children:[a.jsx(be,{min:1,max:1e3,value:u,onChange:b=>{const j=b||0;o(j),I({type:d,isPercent:c,value:j,style:p})}}),a.jsxs("div",{className:"univer-ml-3 univer-flex univer-items-center univer-text-xs",children:[a.jsx(vt,{checked:c,onChange:b=>{f(!!b),I({type:d,isPercent:!!b,value:u,style:p})}}),n.t("sheet.cf.valueType.percent")]})]}),a.jsx("div",{className:et,children:a.jsx($e,{rule:y({type:d,isPercent:c,value:u,style:p})})}),a.jsx(Ot,{style:i==null?void 0:i.style,className:"univer-mt-3",onChange:b=>{x(b),I({type:d,isPercent:c,value:u,style:b})}})]})},wi=cn("beforeSubmit"),Ei=cn("submit"),Jt=e=>e.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),Qt=e=>{var t;return(t=e.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:t.getSheetId()},ji=e=>{var t,s,r;const n=W(K),i=W(X),l=W(D),d=W(z),m=W(Fe),u=Jt(l),o=Qt(l),[c,f]=g.useState(void 0),p=g.useRef((s=(t=e.rule)==null?void 0:t.ranges)!=null?s:[]),x=g.useMemo(()=>{var N,V,k;let v=(N=e.rule)==null?void 0:N.ranges;return v!=null&&v.length||(v=(k=(V=m.getCurrentSelections())==null?void 0:V.map(E=>E.range))!=null?k:[]),p.current=v,v!=null&&v.length?v.map(E=>{const ee=yn(E);return ee==="NaN"?"":ee}).filter(E=>!!E).join(","):""},[e.rule]),y=[{label:n.t("sheet.cf.ruleType.highlightCell"),value:"1"},{label:n.t("sheet.cf.panel.rankAndAverage"),value:"2"},{label:n.t("sheet.cf.ruleType.dataBar"),value:"3"},{label:n.t("sheet.cf.ruleType.colorScale"),value:"4"},{label:n.t("sheet.cf.ruleType.formula"),value:"5"},{label:n.t("sheet.cf.ruleType.iconSet"),value:"6"}],[I,b]=g.useState(()=>{var N,V;const k=(N=e.rule)==null?void 0:N.rule.type,v=y[0].value;if(!k)return v;switch(k){case U.highlightCell:{switch((V=e.rule)==null?void 0:V.rule.subType){case M.number:case M.text:case M.duplicateValues:case M.uniqueValues:case M.timePeriod:return"1";case M.average:case M.rank:return"2";case M.formula:return"5"}break}case U.dataBar:return"3";case U.colorScale:return"4";case U.iconSet:return"6"}return v}),j=g.useRef(void 0),S=g.useMemo(()=>new rr({beforeSubmit:wi,submit:Ei}),[]),w=g.useMemo(()=>{switch(I){case"1":return Yt;case"2":return Ti;case"3":return fi;case"4":return gi;case"5":return pi;case"6":return Si;default:return Yt}},[I]);g.useEffect(()=>{const N=i.onCommandExecuted(V=>{if(V.id===Cr.id){const k=V.params;k.subUnitId===o&&k.unitId===u&&e.onCancel()}V.id===Ft.id&&e.onCancel()});return()=>N.dispose()},[]);const h=N=>{j.current=N},C=N=>{const V=N.split(",").filter(k=>!!k).map(Er).map(k=>k.range);p.current=V},T=()=>{if(c)return;const N=(()=>{const V=l.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet();if(!V)throw new Error("No active sheet found");return p.current.map(k=>jr(k,V.getRowCount(),V.getColumnCount())).filter(k=>!(Number.isNaN(k.startRow)||Number.isNaN(k.startColumn)))})();if(S.fetchThroughInterceptors(S.getInterceptPoints().beforeSubmit)(!0,null)){const V=S.fetchThroughInterceptors(S.getInterceptPoints().submit)(null,null);if(V){const k=Jt(l),v=Qt(l);if(!k||!v)throw new Error("No active sheet found");let E={};e.rule&&e.rule.cfId?(E={...e.rule,ranges:N,rule:V},i.executeCommand(Ar.id,{unitId:k,subUnitId:v,rule:E}),e.onCancel()):(E={cfId:d.createCfId(k,v),ranges:N,rule:V,stopIfTrue:!1},i.executeCommand(wn.id,{unitId:k,subUnitId:v,rule:E}),e.onCancel())}}},_=()=>{e.onCancel()},R=(N,V)=>{N?V.length<1?f(n.t("sheet.cf.errorMessage.rangeError")):f(void 0):f(n.t("sheet.cf.errorMessage.rangeError"))};return a.jsxs("div",{children:[a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:n.t("sheet.cf.panel.range")}),a.jsxs("div",{className:"univer-mt-4",children:[a.jsx(Jr,{unitId:u,subUnitId:o,initialValue:x,onChange:(N,V)=>C(V),onVerify:R}),c&&a.jsx("div",{className:"univer-mt-1 univer-text-xs univer-text-red-500",children:c})]}),a.jsx("div",{className:"univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",children:n.t("sheet.cf.panel.styleType")}),a.jsx(ne,{className:"univer-mt-4 univer-w-full",value:I,options:y,onChange:N=>b(N)}),a.jsx(w,{interceptorManager:S,rule:(r=e.rule)==null?void 0:r.rule,onChange:h}),a.jsxs("div",{className:"univer-mt-4 univer-flex univer-justify-end",children:[a.jsx(Dt,{onClick:_,children:n.t("sheet.cf.panel.cancel")}),a.jsx(Dt,{className:"univer-ml-3",variant:"primary",onClick:T,children:n.t("sheet.cf.panel.submit")})]})]})};var _i=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Ri=(e,t)=>(s,r)=>t(s,r,e);let Le=class extends re{constructor(e){super(),Se(this,"_initLocal",()=>{}),Se(this,"_findReplaceIndex",t=>{const s=/\{([^}]+)?\}/g,r=[];let n=s.exec(t);for(;n;)r.push({startIndex:n.index,key:Number(n[1]),endIndex:n.index+n[0].length-1}),n=s.exec(t);return r}),this._localeService=e,this._initLocal()}tWithReactNode(e,...t){const s=this._localeService.getLocales(),r=e.split("."),n=s&&this._localeService.resolveKeyPath(s,r);if(typeof n=="string"){const i=[];return this._findReplaceIndex(n).forEach((l,d,m)=>{const u=m[d-1]||{endIndex:-1};if(u.endIndex+1<l.startIndex){const o=n.slice(u.endIndex+1,l.startIndex);o&&i.push(o)}if(t[l.key]&&i.push(t[l.key]),d===m.length-1){const o=n.slice(l.endIndex+1);o&&i.push(o)}}),i}return[]}};Le=_i([Ri(0,F(K))],Le);const Ni=(e,t)=>{const s=e.rule;switch(s.type){case U.colorScale:return t.t("sheet.cf.ruleType.colorScale");case U.dataBar:return t.t("sheet.cf.ruleType.dataBar");case U.iconSet:return t.t("sheet.cf.ruleType.iconSet");case U.highlightCell:switch(s.subType){case M.average:{const r=s.operator;return t.t(`sheet.cf.preview.describe.${r}`,t.t("sheet.cf.subRuleType.average"))}case M.duplicateValues:return t.t("sheet.cf.subRuleType.duplicateValues");case M.uniqueValues:return t.t("sheet.cf.subRuleType.uniqueValues");case M.number:{const r=s.operator;return t.t(`sheet.cf.preview.describe.${r}`,...Array.isArray(s.value)?s.value.map(n=>String(n)):[String(s.value||"")])}case M.text:{const r=s.operator;return t.t(`sheet.cf.preview.describe.${r}`,s.value||"")}case M.timePeriod:{const r=s.operator;return t.t(`sheet.cf.preview.describe.${r}`)}case M.rank:return s.isPercent?s.isBottom?t.t("sheet.cf.preview.describe.bottomNPercent",String(s.value)):t.t("sheet.cf.preview.describe.topNPercent",String(s.value)):s.isBottom?t.t("sheet.cf.preview.describe.bottomN",String(s.value)):t.t("sheet.cf.preview.describe.topN",String(s.value));case M.formula:return t.t("sheet.cf.ruleType.formula")}}};let en=0;const Vi=e=>{const{onClick:t}=e,s=W(z),r=W(D),n=W(Fe),i=W(X),l=W(K),d=W(le),m=W(bn),u=W(Le),o=yr(()=>r.getCurrentTypeOfUnit$(A.UNIVER_SHEET),void 0,void 0,[]),c=o.getUnitId(),f=o.getActiveSheet();if(!f)throw new Error("No active sheet found");const p=f.getSheetId(),[x,y]=g.useState([]),[I,b]=g.useState("2"),[j,S]=g.useState(0),[w,h]=g.useState(-1),[C,T]=g.useState(en),_=g.useRef(null),R=[{label:l.t("sheet.cf.panel.workSheet"),value:"2"},{label:l.t("sheet.cf.panel.selectedRange"),value:"1"}],N=()=>{const $=s.getSubunitRules(c,p);if(!$||!$.length)return[];if(I==="1"){const B=n.getCurrentLastSelection();if(!B)return[];const P=B.range;return $.filter(Z=>Z.ranges.some(Y=>oe.intersects(Y,P)))}else if(I==="2")return[...$];return[]},[V,k]=g.useState(N);br(x),g.useEffect(()=>{const $=i.onCommandExecuted(B=>{B.id===Ft.id&&S(Math.random())});return()=>$.dispose()}),g.useEffect(()=>{k(N)},[I,j,c,p]),g.useEffect(()=>{if(I==="2")return;const $=new xe(B=>{const P=[Ir.id,Q.id,ve.id,he.id,En.id],Z=i.onCommandExecuted(Y=>{const{id:me,params:ge}=Y,Re=r.getCurrentUnitOfType(A.UNIVER_SHEET).getUnitId();P.includes(me)&&ge.unitId===Re&&B.next(null)});return()=>Z.dispose()}).pipe(lt(16)).subscribe(()=>{k(N)});return()=>{$.unsubscribe()}},[r,I,c,p]),g.useEffect(()=>{const $=s.$ruleChange.subscribe(()=>{S(Math.random())});return()=>$.unsubscribe()},[s]),g.useEffect(()=>{const $=()=>{var P,Z;const Y=Math.max(0,((Z=(P=_.current)==null?void 0:P.getBoundingClientRect().width)!=null?Z:0)-8);return en=Y,Y},B=new xe(P=>{const Z=m.getContainer();if(Z){let Y=setTimeout(()=>{P.next(void 0)},150);const me=()=>{Y&&clearTimeout(Y),Y=null},ge=Re=>{Re.propertyName==="width"&&(me(),P.next(void 0))};return Z.addEventListener("transitionend",ge),()=>{me(),Z.removeEventListener("transitionend",ge)}}}).pipe(lt(16)).subscribe(()=>{T($())});return()=>{B.unsubscribe()}},[]);const v=$=>{var B;const P=r.getCurrentUnitOfType(A.UNIVER_SHEET).getUnitId(),Z=(B=r.getCurrentUnitOfType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:B.getSheetId();if(!P||!Z)throw new Error("No active sheet found");i.executeCommand(Wt.id,{unitId:P,subUnitId:Z,cfId:$.cfId})},E=($,B)=>{h(B.y)},ee=($,B,P)=>{var Z;h(-1);const Y=r.getCurrentUnitOfType(A.UNIVER_SHEET).getUnitId(),me=(Z=r.getCurrentUnitOfType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:Z.getSheetId();if(!Y||!me)throw new Error("No active sheet found");const ge=Kn=>{const Jn=V.length;return Math.min(Jn-1,Math.max(0,Kn))},Re=V[ge(B.y)].cfId,Pt=V[ge(P.y)].cfId;Re!==Pt&&i.executeCommand(Or.id,{unitId:Y,subUnitId:me,start:{id:Re,type:"self"},end:{id:Pt,type:P.y>B.y?"after":"before"}})},we=()=>{e.onCreate()},Ee=()=>{I==="2"?i.executeCommand(Sn.id):I==="1"&&V.map($=>({unitId:c,subUnitId:p,cfId:$.cfId})).forEach($=>{i.executeCommand(Wt.id,$)})},de=g.useMemo(()=>{const $=r.getCurrentUnitOfType(A.UNIVER_SHEET),B=$.getActiveSheet();return V.filter(P=>{const Z=P.ranges;return ct(d,$.getUnitId(),B.getSheetId(),Z)})},[V]),je=de.map(($,B)=>({i:$.cfId,x:0,w:12,y:B,h:1,isResizable:!1})),_e=g.useMemo(()=>{const $=r.getCurrentUnitOfType(A.UNIVER_SHEET),B=$.getActiveSheet();return V.every(P=>{const Z=P.ranges;return ct(d,$.getUnitId(),B.getSheetId(),Z)})},[V]);return a.jsxs("div",{children:[a.jsxs("div",{className:"univer-flex univer-items-center univer-justify-between univer-gap-2 univer-text-sm",children:[a.jsx("div",{className:"univer-flex univer-items-center univer-gap-2",children:u.tWithReactNode("sheet.cf.panel.managerRuleSelect",a.jsx(ne,{className:"univer-w-36",options:R,value:I,onChange:$=>{b($)}})).map(($,B)=>a.jsx("span",{children:$},B))}),a.jsxs("div",{className:"univer-flex univer-justify-end",children:[a.jsx(Zt,{title:l.t("sheet.cf.panel.createRule"),placement:"bottom",children:a.jsx("a",{className:"univer-size-5 univer-cursor-pointer",onClick:we,children:a.jsx(On,{})})}),V.length&&_e?a.jsx(Zt,{title:l.t("sheet.cf.panel.clear"),placement:"bottom",children:a.jsx("a",{className:"univer-size-5 univer-cursor-pointer",onClick:Ee,children:a.jsx(at,{className:"univer-text-red-500"})})}):a.jsx("div",{children:a.jsx(at,{className:"univer-text-gray-300"})})]})]}),a.jsx("div",{ref:_,children:C>0&&a.jsx(zr,{className:"[&_.react-grid-item]:univer-transition-none [&_.react-grid-placeholder]:univer-rounded [&_.react-grid-placeholder]:!univer-bg-gray-200",draggableHandle:".draggableHandle",layout:je,cols:12,rowHeight:60,width:C,margin:[0,10],onDragStop:ee,onDragStart:E,children:de==null?void 0:de.map(($,B)=>a.jsx("div",{children:a.jsxs("div",{className:G("univer-group univer-relative univer-flex univer-items-center univer-justify-between univer-rounded univer-py-2 univer-pl-5 univer-pr-8 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",{"univer-bg-gray-100 dark:!univer-bg-gray-700":w===B}),onMouseMove:()=>{$.ranges!==x&&y($.ranges)},onMouseLeave:()=>y([]),onClick:()=>{t($)},children:[a.jsx("div",{className:G("univer-absolute univer-left-0 univer-hidden univer-size-5 univer-cursor-grab univer-items-center univer-justify-center univer-rounded group-hover:univer-flex","draggableHandle"),onClick:P=>P.stopPropagation(),children:a.jsx(Bn,{})}),a.jsxs("div",{className:"univer-min-w-0 univer-max-w-full univer-flex-shrink univer-overflow-hidden",children:[a.jsx("div",{className:"univer-text-sm univer-text-gray-900 dark:!univer-text-white",children:Ni($,l)}),a.jsx("div",{className:"univer-text-xs univer-text-gray-400",children:$.ranges.map(P=>yn(P)).join(",")})]}),a.jsx("div",{children:a.jsx($e,{rule:$.rule})}),a.jsx("div",{className:G("univer-absolute univer-right-1 univer-hidden univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-rounded group-hover:univer-flex hover:univer-bg-gray-200",{"univer-flex univer-items-center univer-justify-center":w===B}),onClick:P=>{P.stopPropagation(),v($),y([])},children:a.jsx(at,{})})]})},`${$.cfId}`))})})]})},Mi=e=>{const[t,s]=g.useState(e.rule),[r,n]=g.useState(!!e.rule);return a.jsx("div",{className:"univer-flex univer-h-full univer-flex-col univer-justify-between univer-py-4",children:r?a.jsx(ji,{onCancel:()=>{n(!1),s(void 0)},rule:t}):a.jsx(Vi,{onClick:i=>{s(i),n(!0)},onCreate:()=>{n(!0)}})})};var ki=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},He=(e,t)=>(s,r)=>t(s,r,e);const it="sheet.conditional.formatting.panel";let Ze=class extends re{constructor(e,t,s,r,n){super(),Se(this,"_sidebarDisposable",null),this._univerInstanceService=e,this._injector=t,this._componentManager=s,this._sidebarService=r,this._localeService=n,this._initPanel(),this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(i=>{var l;i||(l=this._sidebarDisposable)==null||l.dispose()})),this.disposeWithMe(this._sidebarService.sidebarOptions$.subscribe(i=>{i.id===it&&(i.visible||setTimeout(()=>{this._sidebarService.sidebarOptions$.next({visible:!1})}))}))}openPanel(e){const t={id:it,header:{title:this._localeService.t("sheet.cf.title")},children:{label:it,rule:e,key:er(4)},onClose:()=>this._sidebarDisposable=null};this._sidebarDisposable=this._sidebarService.open(t)}_initPanel(){this.disposeWithMe(this._componentManager.register(it,Mi))}};Ze=ki([He(0,D),He(1,F(le)),He(2,F(_r)),He(3,F(bn)),He(4,F(K))],Ze);var J=(e=>(e[e.createRule=1]="createRule",e[e.viewRule=2]="viewRule",e[e.highlightCell=3]="highlightCell",e[e.rank=4]="rank",e[e.formula=5]="formula",e[e.colorScale=6]="colorScale",e[e.dataBar=7]="dataBar",e[e.icon=8]="icon",e[e.clearRangeRules=9]="clearRangeRules",e[e.clearWorkSheetRules=10]="clearWorkSheetRules",e))(J||{});const Tt={id:"sheet.operation.open.conditional.formatting.panel",type:ae.OPERATION,handler:(e,t)=>{var s;const r=e.get(Ze),n=e.get(Fe),i=e.get(X),l=((s=n.getCurrentSelections())==null?void 0:s.map(d=>d.range))||[];switch(t.value){case 3:{r.openPanel({...fe(),ranges:l});break}case 4:{const d={...fe,ranges:l,rule:{type:U.highlightCell,subType:M.rank}};r.openPanel(d);break}case 5:{const d={...fe,ranges:l,rule:{type:U.highlightCell,subType:M.formula,value:"="}};r.openPanel(d);break}case 6:{const d={...fe,ranges:l,rule:{type:U.colorScale,config:[]}};r.openPanel(d);break}case 7:{const d={...fe,ranges:l,rule:{type:U.dataBar,isShowValue:!0}};r.openPanel(d);break}case 8:{const d={...fe,ranges:l,rule:{type:U.iconSet,config:[],isShowValue:!0}};r.openPanel(d);break}case 2:{r.openPanel();break}case 1:{r.openPanel({...fe(),ranges:l});break}case 9:{i.executeCommand(Lr.id,{ranges:l});break}case 10:{i.executeCommand(Sn.id);break}}return!0}};var Ui=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Ae=(e,t)=>(s,r)=>t(s,r,e);let ht=class extends re{constructor(e,t,s,r,n){super(),this._injector=e,this._univerInstanceService=t,this._sheetInterceptorService=s,this._selectionManagerService=r,this._conditionalFormattingRuleModel=n,this._init()}_init(){this.disposeWithMe(this._sheetInterceptorService.interceptCommand({getMutations:e=>{var t;const s=[],r=[],n={redos:s,undos:r};if([ar.id,lr.id].includes(e.id)){const i=(t=this._selectionManagerService.getCurrentSelections())==null?void 0:t.map(p=>p.range);if(!i)return n;const l=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),d=l.getActiveSheet();if(!d)return n;const m=l.getUnitId(),u=d.getSheetId(),o=this._conditionalFormattingRuleModel.getSubunitRules(m,u);if(!o||!o.length)return n;const{redos:c,undos:f}=tn(this._injector,o,i,m,u);s.push(...c),r.push(...f)}return n}})),this.disposeWithMe(this._sheetInterceptorService.interceptRanges({getMutations:({unitId:e,subUnitId:t,ranges:s})=>{const r=[],n=[],i={redos:r,undos:n};if(!s||!s.length)return i;const l=this._conditionalFormattingRuleModel.getSubunitRules(e,t);if(!l||!l.length)return i;const{redos:d,undos:m}=tn(this._injector,l,s,e,t);return r.push(...d),n.push(...m),i}}))}};ht=Ui([Ae(0,F(le)),Ae(1,F(D)),Ae(2,F($t)),Ae(3,F(Fe)),Ae(4,F(z))],ht);function tn(e,t,s,r,n){const i=[],l=[];return t.filter(d=>s.some(m=>d.ranges.some(u=>oe.getIntersects(u,m)))).forEach(d=>{const m=new or().add(...d.ranges).subtract(...s).merge();if(m.length){const u={id:ve.id,params:{unitId:r,subUnitId:n,rule:{...d,ranges:m}}},o=ke(e,u.params);i.push(u),l.push(...o)}else{const u={id:he.id,params:{unitId:r,subUnitId:n,cfId:d.cfId}},o=Ue(e,u.params);i.push(u),l.push(...o)}}),{redos:i,undos:l}}var Li=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Oe=(e,t)=>(s,r)=>t(s,r,e);let Ge=class extends re{constructor(e,t,s,r,n){super(),Se(this,"_copyInfo"),this._sheetClipboardService=e,this._conditionalFormattingRuleModel=t,this._injector=s,this._conditionalFormattingViewModel=r,this._univerInstanceService=n,this._initClipboardHook()}_initClipboardHook(){this.disposeWithMe(this._sheetClipboardService.addClipboardHook({id:Ke,onBeforeCopy:(e,t,s)=>this._collectConditionalRule(e,t,s),onPasteCells:(e,t,s,r)=>{const{copyType:n=qt.COPY,pasteType:i}=r,{range:l}=e||{},{range:d}=t;return this._generateConditionalFormattingMutations(d,{copyType:n,pasteType:i,copyRange:l})}}))}_collectConditionalRule(e,t,s){const r=new Ce,n={};this._copyInfo={matrix:r,info:{unitId:e,subUnitId:t,cfMap:n}};const i=this._injector.invoke(u=>dr(s,u,e,t));if(!i)return;const{rows:l,cols:d}=i,m=new Set;l.forEach((u,o)=>{d.forEach((c,f)=>{const p=this._conditionalFormattingViewModel.getCellCfs(e,t,u,c);p&&(p.forEach(x=>m.add(x.cfId)),r.setValue(o,f,p.map(x=>x.cfId)))})}),m.forEach(u=>{const o=this._conditionalFormattingRuleModel.getRule(e,t,u);o&&(n[u]=o.rule)})}_generateConditionalFormattingMutations(e,t){const s=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),r=s.getActiveSheet(),n=s.getUnitId();if(!r)return{redos:[],undos:[]};const i=r.getSheetId();if(t.copyType===qt.CUT)return this._copyInfo=null,{redos:[],undos:[]};if(!this._copyInfo||!t.copyRange)return{redos:[],undos:[]};if(![Et.SPECIAL_PASTE_FORMAT,Et.DEFAULT_PASTE,Et.SPECIAL_PASTE_BESIDES_BORDER].includes(t.pasteType))return{redos:[],undos:[]};const{ranges:[l,d],mapFunc:m}=gn([t.copyRange,e]),u=vr(l,d,!0),o={};ue.foreach(d,(S,w)=>{const{row:h,col:C}=m(S,w),T=this._conditionalFormattingViewModel.getCellCfs(n,i,h,C);T&&T.forEach(_=>{if(!o[_.cfId]){const R=new Ce;o[_.cfId]=R;const N=this._conditionalFormattingRuleModel.getRule(n,i,_.cfId);N==null||N.ranges.forEach(V=>{ue.foreach(V,(k,v)=>{R.setValue(k,v,1)})})}o[_.cfId].realDeleteValue(h,C)})});const{matrix:c,info:f}=this._copyInfo,p=[];let x=this._conditionalFormattingRuleModel.createCfId(n,i);const y={},I=S=>{if(y[S])return y[S];const w=f==null?void 0:f.cfMap[S],h=[...this._conditionalFormattingRuleModel.getSubunitRules(n,i)||[],...p].find(C=>Lt.diffValue(C.rule,w));if(h)return y[S]=h,h;{const C={rule:w,cfId:x,ranges:[],stopIfTrue:!1};return y[S]=C,p.push(C),x=`${Number(x)+1}`,C}};u.forEach(S=>{c&&c.forValue((w,h,C)=>{const T=oe.getPositionRange({startRow:w,endRow:w,startColumn:h,endColumn:h},S.startRange),{row:_,col:R}=m(T.startRow,T.startColumn);C.forEach(N=>{if(!o[N]){const V=I(N),k=new Ce;o[N]=k,V.ranges.forEach(v=>{ue.foreach(v,(E,ee)=>{k.setValue(E,ee,1)})})}o[N].setValue(_,R,1)})})});const b=[],j=[];for(const S in o){const w=o[S],h=ot(ut(w));if(!h.length){const C={unitId:n,subUnitId:i,cfId:S};b.push({id:he.id,params:C}),j.push(...Ue(this._injector,C))}if(p.some(C=>C.cfId===S)){const C=I(S),T={unitId:n,subUnitId:i,rule:{...C,ranges:h}};b.push({id:Q.id,params:T}),j.push(Tn(this._injector,T))}else{const C=this._conditionalFormattingRuleModel.getRule(n,i,S);if(!C)continue;const T={unitId:n,subUnitId:i,rule:{...C,ranges:h}};b.push({id:ve.id,params:T}),j.push(...ke(this._injector,T))}}return{redos:b,undos:j}}};Ge=Li([Oe(0,F(Rr)),Oe(1,F(z)),Oe(2,F(le)),Oe(3,F(Je)),Oe(4,F(D))],Ge);var Fi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Nt=(e,t)=>(s,r)=>t(s,r,e);let ze=class extends re{constructor(e,t,s){super(),this._localeService=e,this._commandService=t,this._sheetPermissionCheckController=s,this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{e.id===wn.id&&(this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[Cn],rangeTypes:[xn],worksheetTypes:[fn,pn]},e.params.rule.ranges)||this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localeService.t("permission.dialog.setStyleErr")))}))}};ze=Fi([Nt(0,F(K)),Nt(1,X),Nt(2,F(Nr))],ze);var $i=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},st=(e,t)=>(s,r)=>t(s,r,e);let Xe=class extends re{constructor(e,t,s,r){super(),this._conditionalFormattingRuleModel=e,this._univerInstanceService=t,this._injector=s,this._refRangeService=r,this._initRefRange()}_initRefRange(){const e=new Map,t=(r,n,i)=>`${r}_${n}_${i}`,s=(r,n,i)=>{const l=m=>{const u=[...i.ranges],o=u.map(c=>mr(c,m)).filter(c=>!!c);if(nr(o,u))return{redos:[],undos:[]};if(o.length){const c={unitId:r,subUnitId:n,rule:{...i,ranges:o}},f=[{id:ve.id,params:c}],p=ke(this._injector,c);return{redos:f,undos:p}}else{const c={unitId:r,subUnitId:n,cfId:i.cfId},f=[{id:he.id,params:c}],p=Ue(this._injector,c);return{redos:f,undos:p}}},d=[];i.ranges.forEach(m=>{const u=this._refRangeService.registerRefRange(m,l);d.push(()=>u.dispose())}),e.set(t(r,n,i.cfId),()=>d.forEach(m=>m()))};this.disposeWithMe(this._conditionalFormattingRuleModel.$ruleChange.subscribe(r=>{const{unitId:n,subUnitId:i,rule:l}=r,d=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),m=d.getActiveSheet();if(!(r.unitId!==d.getUnitId()||r.subUnitId!==(m==null?void 0:m.getSheetId())))switch(r.type){case"add":{s(r.unitId,r.subUnitId,r.rule);break}case"delete":{const u=e.get(t(n,i,l.cfId));u&&u();break}case"set":{const u=e.get(t(n,i,l.cfId));u&&u(),s(r.unitId,r.subUnitId,r.rule)}}})),this.disposeWithMe(un(()=>{e.forEach(r=>{r()}),e.clear()}))}};Xe=$i([st(0,F(z)),st(1,F(D)),st(2,F(le)),st(3,F(Vr))],Xe);var Hi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Ve=(e,t)=>(s,r)=>t(s,r,e);let Ye=class extends re{constructor(e,t,s,r,n,i){super(),Se(this,"_ruleChangeCacheMap",new Map),this._sheetInterceptorService=e,this._conditionalFormattingService=t,this._univerInstanceService=s,this._renderManagerService=r,this._conditionalFormattingViewModel=n,this._conditionalFormattingRuleModel=i,this._initViewModelInterceptor(),this._initSkeleton(),this.disposeWithMe(()=>{this._ruleChangeCacheMap.clear()})}_markDirtySkeleton(){var e,t,s;const r=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId();(e=this._renderManagerService.getRenderById(r))==null||e.with(mn).reCalculate(),(s=(t=this._renderManagerService.getRenderById(r))==null?void 0:t.mainComponent)==null||s.makeDirty()}_initSkeleton(){this.disposeWithMe(on(this._conditionalFormattingRuleModel.$ruleChange,this._conditionalFormattingViewModel.markDirty$).pipe(ur(16),Bt(e=>!!e.length),Bt(e=>{const t=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET);if(!t)return!1;const s=t.getActiveSheet();return s?e.filter(r=>r.unitId===t.getUnitId()&&r.subUnitId===s.getSheetId()).length>0:!1})).subscribe(()=>this._markDirtySkeleton()))}_initViewModelInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(cr.CELL_CONTENT,{effect:tr.Style,handler:(e,t,s)=>{const r=this._conditionalFormattingService.composeStyle(t.unitId,t.subUnitId,t.row,t.col);if(!r)return s(e);const n=t.workbook.getStyles(),i=(typeof(e==null?void 0:e.s)=="string"?n.get(e==null?void 0:e.s):e==null?void 0:e.s)||{},l=e===t.rawData?{...t.rawData}:e;if(r.style){const d={...i,...r.style};Object.assign(l,{s:d})}return l.fontRenderExtension||(l.fontRenderExtension={},r.isShowValue!==void 0&&(l.fontRenderExtension.isSkip=!r.isShowValue)),r.dataBar&&(l.dataBar=r.dataBar),r.iconSet&&(l.iconSet=r.iconSet,l.fontRenderExtension.leftOffset=Fr+$r),s(l)},priority:10}))}};Ye=Hi([Ve(0,F($t)),Ve(1,F(_n)),Ve(2,F(D)),Ve(3,F(In)),Ve(4,F(Je)),Ve(5,F(z))],Ye);const zn="sheets-conditional-formatting-ui.config",mt={};var Ai=Object.defineProperty,Oi=(e,t,s)=>t in e?Ai(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Pi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Vt=(e,t)=>(s,r)=>t(s,r,e),Xn=(e,t,s)=>Oi(e,typeof t!="symbol"?t+"":t,s);let gt=class extends an{constructor(e=mt,t,s,r){super(),this._config=e,this._injector=t,this._commandService=s,this._configService=r;const{menu:n,...i}=ln({},mt,this._config);n&&this._configService.setConfig("menu",n,{merge:!0}),this._configService.setConfig(zn,i),this._initCommand(),this._injector.add([Ye]),this._injector.add([Xe]),this._injector.add([Ge]),this._injector.add([ze]),this._injector.add([Le])}_initCommand(){[Rn,Nn,Vn,Mn,kn,Un,Ln,Fn,$n,Tt].forEach(e=>{this._commandService.registerCommand(e)})}};Xn(gt,"pluginName",`${Ke}_MOBILE_UI_PLUGIN`);Xn(gt,"type",A.UNIVER_SHEET);gt=Pi([vn(jn),Vt(1,F(le)),Vt(2,F(X)),Vt(3,hn)],gt);var Bi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Pe=(e,t)=>(s,r)=>t(s,r,e);let ft=class extends re{constructor(e,t,s,r,n){super(),this._injector=e,this._univerInstanceService=t,this._autoFillService=s,this._conditionalFormattingRuleModel=r,this._conditionalFormattingViewModel=n,this._initAutoFill()}_initAutoFill(){const e=()=>({redos:[],undos:[]}),t=(n,i,l,d,m)=>{var u;const o=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getUnitId(),c=(u=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET).getActiveSheet())==null?void 0:u.getSheetId();if(!o||!c)return;const f={startRow:n.row,startColumn:n.col,endColumn:n.col,endRow:n.row},p={startRow:i.row,startColumn:i.col,endColumn:i.col,endRow:i.row};ue.foreach(l,(x,y)=>{const I=oe.getPositionRange({startRow:x,startColumn:y,endColumn:y,endRow:x},f),b=oe.getPositionRange({startRow:x,startColumn:y,endColumn:y,endRow:x},p),{row:j,col:S}=m(I.startRow,I.startColumn),w=this._conditionalFormattingViewModel.getCellCfs(o,c,j,S),{row:h,col:C}=m(b.startRow,b.startColumn),T=this._conditionalFormattingViewModel.getCellCfs(o,c,h,C);T&&T.forEach(_=>{let R=d.get(_.cfId);if(!d.get(_.cfId)){const N=this._conditionalFormattingRuleModel.getRule(o,c,_.cfId);if(!N)return;R=new Ce,N.ranges.forEach(V=>{ue.foreach(V,(k,v)=>{R.setValue(k,v,1)})}),d.set(_.cfId,R)}R.realDeleteValue(h,C)}),w&&w.forEach(_=>{let R=d.get(_.cfId);if(!d.get(_.cfId)){const N=this._conditionalFormattingRuleModel.getRule(o,c,_.cfId);if(!N)return;R=new Ce,N.ranges.forEach(V=>{ue.foreach(V,(k,v)=>{R.setValue(k,v,1)})}),d.set(_.cfId,R)}R.setValue(h,C,1)})})},s=(n,i)=>{var l,d,m;const u=(l=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:l.getUnitId(),o=(m=(d=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:d.getActiveSheet())==null?void 0:m.getSheetId(),c=new Map,f=[],p=[];if(!u||!o)return e();const x=gn([n,i]),[y,I]=x.ranges,{mapFunc:b}=x,j={row:y.startRow,col:y.startColumn};return Sr(y,I).forEach(S=>{t(j,S.repeatStartCell,S.relativeRange,c,b)}),c.forEach((S,w)=>{const h=this._conditionalFormattingRuleModel.getRule(u,o,w);if(!h)return;const C=ot(ut(S));if(C.length){const T={unitId:u,subUnitId:o,rule:{...h,ranges:C}};f.push({id:ve.id,params:T}),p.push(...ke(this._injector,T))}else{const T={unitId:u,subUnitId:o,cfId:h.cfId};f.push({id:he.id,params:T}),p.push(...Ue(this._injector,T))}}),{undos:p,redos:f}},r={id:Ke,onFillData:(n,i,l)=>{if(l===jt.COPY||l===jt.ONLY_FORMAT||l===jt.SERIES){const{source:d,target:m}=n;return s(d,m)}return e()}};this.disposeWithMe(this._autoFillService.addHook(r))}};ft=Bi([Pe(0,F(le)),Pe(1,F(D)),Pe(2,F(Mr)),Pe(3,F(z)),Pe(4,F(Je))],ft);var qi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},nn=(e,t)=>(s,r)=>t(s,r,e);let pt=class extends re{constructor(e,t){super(),this._sheetInterceptorService=e,this._conditionalFormattingService=t,this._initInterceptorEditorEnd()}_initInterceptorEditorEnd(){this.disposeWithMe(un(this._sheetInterceptorService.writeCellInterceptor.intercept(hr,{handler:(e,t,s)=>{var r,n,i;e||s(e);const l=this._conditionalFormattingService.composeStyle(t.unitId,t.subUnitId,t.row,t.col),d=(r=l==null?void 0:l.style)!=null?r:{},m=Object.keys(d);if(e!=null&&e.p)return(i=(n=e.p.body)==null?void 0:n.textRuns)==null||i.forEach(u=>{u.ts&&m.forEach(o=>{var c;(c=u.ts)==null||delete c[o]})}),s(e);{const u={...(typeof(e==null?void 0:e.s)=="string"?t.workbook.getStyles().get(e.s):e==null?void 0:e.s)||{}};m.forEach(c=>{delete u[c]});const o={...e,s:{...u}};return s(o)}}})))}};pt=qi([nn(0,F($t)),nn(1,F(_n))],pt);const rn=[Ft.id,Q.id,ve.id,he.id,En.id],Be=[{label:{name:"sheet.cf.ruleType.highlightCell",selectable:!1},value:J.highlightCell},{label:{name:"sheet.cf.panel.rankAndAverage",selectable:!1},value:J.rank},{label:{name:"sheet.cf.ruleType.formula",selectable:!1},value:J.formula},{label:{name:"sheet.cf.ruleType.colorScale",selectable:!1},value:J.colorScale},{label:{name:"sheet.cf.ruleType.dataBar",selectable:!1},value:J.dataBar},{label:{name:"sheet.cf.ruleType.iconSet",selectable:!1},value:J.icon},{label:{name:"sheet.cf.menu.manageConditionalFormatting",selectable:!1},value:J.viewRule},{label:{name:"sheet.cf.menu.createConditionalFormatting",selectable:!1},value:J.createRule},{label:{name:"sheet.cf.menu.clearRangeRules",selectable:!1},value:J.clearRangeRules,disabled:!1},{label:{name:"sheet.cf.menu.clearWorkSheetRules",selectable:!1},value:J.clearWorkSheetRules}],Wi=e=>{const t=e.get(Fe),s=e.get(X),r=e.get(D),n=e.get(z),i=new xe(m=>on(t.selectionMoveEnd$,t.selectionSet$,new xe(u=>{const o=s.onCommandExecuted(c=>{var f;const{id:p,params:x}=c,y=(f=r.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:f.getUnitId();rn.includes(p)&&x.unitId===y&&u.next(null)});return()=>o.dispose()})).pipe(lt(16)).subscribe(()=>{var u;const o=((u=t.getCurrentSelections())==null?void 0:u.map(x=>x.range))||[],c=r.getCurrentUnitForType(A.UNIVER_SHEET);if(!c)return;const f=c.getActiveSheet();if(!f)return;const p=(n.getSubunitRules(c.getUnitId(),f.getSheetId())||[]).filter(x=>x.ranges.some(y=>o.some(I=>oe.intersects(I,y)))).map(x=>x.ranges).every(x=>ct(e,c.getUnitId(),f.getSheetId(),x));m.next(p)})),l=new xe(m=>new xe(u=>{const o=s.onCommandExecuted(c=>{var f;const{id:p,params:x}=c,y=(f=r.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:f.getUnitId();rn.includes(p)&&x.unitId===y&&u.next(null)});return()=>o.dispose()}).pipe(lt(16)).subscribe(()=>{const u=r.getCurrentUnitForType(A.UNIVER_SHEET);if(!u)return;const o=u.getActiveSheet();if(!o)return;const c=n.getSubunitRules(u.getUnitId(),o.getSheetId())||[];if(!c.length)return m.next(!1),!1;const f=c.map(p=>p.ranges).every(p=>ct(e,u.getUnitId(),o.getSheetId(),p));m.next(f)})),d=new xe(m=>{i.subscribe(u=>{const o=Be.find(c=>c.value===J.clearRangeRules);o&&(o.disabled=!u,m.next(Be))}),l.subscribe(u=>{const o=Be.find(c=>c.value===J.clearWorkSheetRules);o&&(o.disabled=!u,m.next(Be))}),m.next(Be)});return{id:Tt.id,type:xr.SELECTOR,icon:"ConditionsDoubleIcon",tooltip:"sheet.cf.title",selections:d,hidden$:pr(e,A.UNIVER_SHEET),disabled$:fr(e,{workbookTypes:[Cn],worksheetTypes:[pn,fn],rangeTypes:[xn]})}},Di={[gr.RULES]:{[Tt.id]:{order:1,menuItemFactory:Wi}}};var Zi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},sn=(e,t)=>(s,r)=>t(s,r,e);let xt=class extends re{constructor(e,t){super(),Se(this,"_sidebarDisposable",null),this._injector=e,this._menuManagerService=t,this._menuManagerService.mergeMenu(Di)}};xt=Zi([sn(0,F(le)),sn(1,kr)],xt);var Gi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Me=(e,t)=>(s,r)=>t(s,r,e);const zi=(e,t)=>{const s=o=>o.endRow-o.startRow+1,r=o=>o.endColumn-o.startColumn+1,n=s(t)%s(e),i=r(t)%r(e),l=Math.floor(s(t)/s(e)),d=Math.floor(r(t)/r(e)),m=[],u={startRow:0,endRow:s(e)-1,startColumn:0,endColumn:r(e)-1};if(s(t)===1&&r(t)===1){const o={startRow:t.startRow,endRow:t.startRow,startColumn:t.startColumn,endColumn:t.startColumn};return m.push({repeatRelativeRange:u,startRange:o}),m}for(let o=0;o<l+(n?.1:0);o++)for(let c=0;c<d+(i?.1:0);c++){const f=s(e)*o,p=r(e)*c,x={startRow:f+t.startRow,endRow:f+t.startRow,startColumn:p+t.startColumn,endColumn:p+t.startColumn};let y=u;o===l&&n&&(y={...y},y.endRow=y.endRow-(s(e)-n)),c===d&&i&&(y={...y},y.endColumn=y.endColumn-(r(e)-i)),m.push({repeatRelativeRange:y,startRange:x})}return m};let Ct=class extends re{constructor(e,t,s,r,n,i){super(),Se(this,"_painterConfig",null),this._injector=e,this._univerInstanceService=t,this._formatPainterService=s,this._sheetsSelectionsService=r,this._conditionalFormattingRuleModel=n,this._conditionalFormattingViewModel=i,this._initFormattingPainter()}_initFormattingPainter(){const e=()=>({redos:[],undos:[]}),t=(n,i,l,d,m)=>{const{unitId:u,subUnitId:o}=this._painterConfig,{targetUnitId:c,targetSubUnitId:f}=m,p={startRow:n.row,startColumn:n.col,endColumn:n.col,endRow:n.row},x={startRow:i.row,startColumn:i.col,endColumn:i.col,endRow:i.row};ue.foreach(l,(y,I)=>{const b=oe.getPositionRange({startRow:y,startColumn:I,endColumn:I,endRow:y},p),j=oe.getPositionRange({startRow:y,startColumn:I,endColumn:I,endRow:y},x),S=this._conditionalFormattingViewModel.getCellCfs(u,o,b.startRow,b.startColumn),w=this._conditionalFormattingViewModel.getCellCfs(c,f,j.startRow,j.startColumn);w&&w.forEach(h=>{let C=d.get(h.cfId);if(!d.get(h.cfId)){const T=this._conditionalFormattingRuleModel.getRule(c,f,h.cfId);if(!T)return;C=new Ce,T.ranges.forEach(_=>{ue.foreach(_,(R,N)=>{C.setValue(R,N,1)})}),d.set(h.cfId,C)}C.realDeleteValue(j.startRow,j.startColumn)}),S&&S.forEach(h=>{const C=d.get(h.cfId);C&&C.setValue(j.startRow,j.startColumn,1)})})},s=(n,i,l)=>{var d;const{range:m,unitId:u,subUnitId:o}=this._painterConfig,c=n!==u||o!==i,f=new Map,p=[],x=[];if(!n||!i||!u||!o)return e();const y=(d=this._conditionalFormattingRuleModel.getSubunitRules(u,o))!=null?d:[];y==null||y.forEach(b=>{const{ranges:j,cfId:S}=b;if(j.some(w=>oe.intersects(m,w))){const w=new Ce;c||j.forEach(h=>{ue.foreach(h,(C,T)=>{w.setValue(C,T,1)})}),f.set(S,w)}});const I={row:m.startRow,col:m.startColumn};return zi(m,l).forEach(b=>{t(I,{row:b.startRange.startRow,col:b.startRange.startColumn},b.repeatRelativeRange,f,{targetUnitId:n,targetSubUnitId:i})}),f.forEach((b,j)=>{if(c){const S=this._conditionalFormattingRuleModel.getRule(n,i,j),w=ot(ut(b));if(S)if(w.length){const h={unitId:n,subUnitId:i,rule:{...S,ranges:w}};p.push({id:ve.id,params:h}),x.push(...ke(this._injector,h))}else{const h={unitId:n,subUnitId:i,cfId:S.cfId};p.push({id:he.id,params:h}),x.push(...Ue(this._injector,h))}else if(w.length){const h=this._conditionalFormattingRuleModel.getRule(u,o,j);if(h){const C={unitId:n,subUnitId:i,rule:{...Lt.deepClone(h),cfId:this._conditionalFormattingRuleModel.createCfId(n,i),ranges:w}};p.push({id:Q.id,params:C}),x.push(Tn(this._injector,C))}}}else{const S=this._conditionalFormattingRuleModel.getRule(u,o,j);if(!S)return;const w=ot(ut(b));if(w.length){const h={unitId:u,subUnitId:o,rule:{...S,ranges:w}};p.push({id:ve.id,params:h}),x.push(...ke(this._injector,h))}else{const h={unitId:u,subUnitId:o,cfId:S.cfId};p.push({id:he.id,params:h}),x.push(...Ue(this._injector,h))}}}),{undos:x,redos:p}},r={id:Ke,onStatusChange:n=>{var i,l,d;switch(n){case _t.INFINITE:case _t.ONCE:{const m=(i=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:i.getUnitId(),u=(d=(l=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET))==null?void 0:l.getActiveSheet())==null?void 0:d.getSheetId(),o=this._sheetsSelectionsService.getCurrentLastSelection(),c=o==null?void 0:o.range;m&&u&&c&&(this._painterConfig={unitId:m,subUnitId:u,range:c});break}case _t.OFF:{this._painterConfig=null;break}}},onApply:(n,i,l)=>this._painterConfig?s(n,i,l):{redos:[],undos:[]}};this._formatPainterService.addHook(r)}};Ct=Gi([Me(0,F(le)),Me(1,F(D)),Me(2,F(Ur)),Me(3,F(Fe)),Me(4,F(z)),Me(5,F(Je))],Ct);var Xi=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},Mt=(e,t)=>(s,r)=>t(s,r,e);let yt=class extends re{constructor(e,t,s){super(),this._conditionalFormattingViewModel=e,this._univerInstanceService=t,this._renderManagerService=s,this._init()}_init(){const e=this._univerInstanceService.getCurrentUnitForType(A.UNIVER_SHEET),t=s=>{const r=s.getUnitId(),n=this._renderManagerService.getRenderById(r);if(!n)return;const i=n.with(mn);this.disposeWithMe(i.currentSkeleton$.subscribe(l=>{if(l){const d=l.skeleton.rowColumnSegment,m=d.endColumn-d.startColumn+1,u=(d.endRow-d.startRow+1)*m*9,o=Math.max(Hr,u);this._conditionalFormattingViewModel.setCacheLength(o)}}))};e&&t(e),this._univerInstanceService.getCurrentTypeOfUnit$(A.UNIVER_SHEET).subscribe(s=>{s&&t(s)})}};yt=Xi([Mt(0,F(Je)),Mt(1,D),Mt(2,In)],yt);var Yi=Object.defineProperty,Ki=(e,t,s)=>t in e?Yi(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,Ji=(e,t,s,r)=>{for(var n=t,i=e.length-1,l;i>=0;i--)(l=e[i])&&(n=l(n)||n);return n},kt=(e,t)=>(s,r)=>t(s,r,e),Yn=(e,t,s)=>Ki(e,typeof t!="symbol"?t+"":t,s);let bt=class extends an{constructor(e=mt,t,s,r){super(),this._config=e,this._injector=t,this._commandService=s,this._configService=r;const{menu:n,...i}=ln({},mt,this._config);n&&this._configService.setConfig("menu",n,{merge:!0}),this._configService.setConfig(zn,i),this._initCommand()}onStarting(){Qn(this._injector,[[Ye],[Xe],[Ge],[ft],[ze],[Ze],[xt],[Le],[pt],[ht],[Ct],[yt]]),wt(this._injector,[[Ye]])}onReady(){wt(this._injector,[[xt],[Ze]])}onRendered(){wt(this._injector,[[ft],[ht],[Ge],[pt],[Le],[Ct],[ze],[Xe],[yt]])}_initCommand(){[Rn,Nn,Vn,Mn,kn,Un,Ln,Fn,$n,Tt].forEach(e=>{this._commandService.registerCommand(e)})}};Yn(bt,"pluginName",`${Ke}_UI_PLUGIN`);Yn(bt,"type",A.UNIVER_SHEET);bt=Ji([vn(jn),kt(1,F(le)),kt(2,F(X)),kt(3,hn)],bt);export{Nn as $,Mn as A,Ln as B,Vn as D,kn as H,gt as I,Tt as M,Rn as O,Fn as W,Un as j,$n as q,bt as x,ht as y};
