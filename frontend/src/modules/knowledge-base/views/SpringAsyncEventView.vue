<template>
  <div class="spring-async-event-view">
    <v-container fluid class="pa-4">
      <!-- æ ‡é¢˜åŒºåŸŸ -->
      <v-card class="mb-4 title-card" elevation="0">
        <v-card-text class="text-center pa-6">
          <div class="text-h4 font-weight-bold mb-2">
            âš¡ Spring å¼‚æ­¥ä¸äº‹ä»¶é©±åŠ¨
          </div>
          <div class="text-subtitle-1 text-medium-emphasis">
            è®©åº”ç”¨æ›´é«˜æ•ˆï¼Œä»£ç æ›´è§£è€¦ï¼ğŸ¯
          </div>
        </v-card-text>
      </v-card>

      <v-row>
        <!-- å·¦ä¾§ï¼šæ ¸å¿ƒæ¦‚å¿µ -->
        <v-col cols="12" md="4">
          <!-- @Async å¼‚æ­¥ -->
          <v-card class="mb-4 concept-card" elevation="2">
            <v-card-title class="d-flex align-center">
              <span class="text-h6">ğŸš€ @Async å¼‚æ­¥æ‰§è¡Œ</span>
            </v-card-title>
            <v-card-text>
              <p class="text-body-2 mb-3">
                è®©æ–¹æ³•åœ¨<strong>ç‹¬ç«‹çº¿ç¨‹</strong>ä¸­æ‰§è¡Œï¼Œä¸é˜»å¡ä¸»çº¿ç¨‹ï¼
              </p>
              <v-alert type="warning" density="compact" class="mb-3">
                <strong>âš ï¸ é‡è¦æé†’ï¼š</strong><br/>
                é»˜è®¤ä½¿ç”¨ SimpleAsyncTaskExecutor<br/>
                æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°çº¿ç¨‹ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è‡ªå®šä¹‰çº¿ç¨‹æ± ï¼
              </v-alert>
              <div class="use-case-box">
                <div class="text-subtitle-2 mb-2">ğŸ’¡ é€‚ç”¨åœºæ™¯ï¼š</div>
                <v-chip-group>
                  <v-chip size="small" color="primary">å‘é€é‚®ä»¶</v-chip>
                  <v-chip size="small" color="success">æ¶ˆæ¯æ¨é€</v-chip>
                  <v-chip size="small" color="warning">æ—¥å¿—è®°å½•</v-chip>
                  <v-chip size="small" color="info">æ•°æ®ç»Ÿè®¡</v-chip>
                </v-chip-group>
              </div>
            </v-card-text>
          </v-card>

          <!-- Spring Event -->
          <v-card class="mb-4 concept-card" elevation="2">
            <v-card-title class="d-flex align-center">
              <span class="text-h6">ğŸ“¢ Spring Event äº‹ä»¶é©±åŠ¨</span>
            </v-card-title>
            <v-card-text>
              <p class="text-body-2 mb-3">
                å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå®ç°<strong>ä¸šåŠ¡è§£è€¦</strong>ï¼
              </p>
              <v-list density="compact">
                <v-list-item>
                  <template #prepend>
                    <v-icon color="primary">mdi-bullhorn</v-icon>
                  </template>
                  <v-list-item-title><strong>å‘å¸ƒè€…</strong></v-list-item-title>
                  <v-list-item-subtitle>å‘å¸ƒäº‹ä»¶ï¼Œä¸å…³å¿ƒè°ç›‘å¬</v-list-item-subtitle>
                </v-list-item>
                <v-list-item>
                  <template #prepend>
                    <v-icon color="success">mdi-ear-hearing</v-icon>
                  </template>
                  <v-list-item-title><strong>ç›‘å¬è€…</strong></v-list-item-title>
                  <v-list-item-subtitle>è®¢é˜…äº‹ä»¶ï¼Œè‡ªåŠ¨å“åº”</v-list-item-subtitle>
                </v-list-item>
              </v-list>
            </v-card-text>
          </v-card>

          <!-- å¯¹æ¯” -->
          <v-card class="mb-4 concept-card" elevation="2">
            <v-card-title class="d-flex align-center">
              <span class="text-h6">ğŸ”„ å¼‚æ­¥ vs äº‹ä»¶</span>
            </v-card-title>
            <v-card-text>
              <v-list density="compact">
                <v-list-item>
                  <v-list-item-title><strong>@Async</strong></v-list-item-title>
                  <v-list-item-subtitle>å¼‚æ­¥æ‰§è¡Œï¼Œæå‡æ€§èƒ½</v-list-item-subtitle>
                </v-list-item>
                <v-list-item>
                  <v-list-item-title><strong>Event</strong></v-list-item-title>
                  <v-list-item-subtitle>äº‹ä»¶é©±åŠ¨ï¼Œè§£è€¦ä¸šåŠ¡</v-list-item-subtitle>
                </v-list-item>
              </v-list>
              <v-alert type="info" density="compact" class="mt-3">
                ä¸¤è€…å¯ä»¥ç»“åˆä½¿ç”¨ï¼šå¼‚æ­¥äº‹ä»¶ç›‘å¬å™¨
              </v-alert>
            </v-card-text>
          </v-card>
        </v-col>

        <!-- å³ä¾§ï¼šè¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ -->
        <v-col cols="12" md="8">
          <!-- @Async è¯¦è§£ -->
          <v-card class="mb-4" elevation="2">
            <v-card-title>
              <v-icon color="primary" class="mr-2">mdi-code-tags</v-icon>
              <span>ğŸ’» @Async ä½¿ç”¨ç¤ºä¾‹</span>
            </v-card-title>
            <v-card-text>
              <v-tabs v-model="asyncTab" color="primary">
                <v-tab value="wrong">âŒ é”™è¯¯ç”¨æ³•</v-tab>
                <v-tab value="right">âœ… æ­£ç¡®ç”¨æ³•</v-tab>
                <v-tab value="config">çº¿ç¨‹æ± é…ç½®</v-tab>
              </v-tabs>
              <v-window v-model="asyncTab" class="mt-4">
                <v-window-item value="wrong">
                  <pre class="code-block"><code>// âŒ é”™è¯¯ï¼šä½¿ç”¨é»˜è®¤ SimpleAsyncTaskExecutor
@Async
public void sendEmail() {
    // æ¯æ¬¡è°ƒç”¨éƒ½åˆ›å»ºæ–°çº¿ç¨‹
    // é«˜å¹¶å‘ä¸‹ä¼šçº¿ç¨‹çˆ†ç‚¸ï¼
}

// é—®é¢˜ï¼š
// 1. æ— çº¿ç¨‹å¤ç”¨
// 2. æ— æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶
// 3. é«˜å¹¶å‘ä¸‹ OOM é£é™©</code></pre>
                </v-window-item>
                <v-window-item value="right">
                  <pre class="code-block"><code>// âœ… æ­£ç¡®ï¼šæ˜¾å¼æŒ‡å®šçº¿ç¨‹æ± 
@Async("emailExecutor")
public void sendEmail() {
    // ä½¿ç”¨è‡ªå®šä¹‰çº¿ç¨‹æ± 
    // å¯æ§ã€å¯ç›‘æ§
}

// é…ç½®çº¿ç¨‹æ± 
@Configuration
@EnableAsync
public class AsyncConfig {
    @Bean("emailExecutor")
    public Executor emailExecutor() {
        return new ThreadPoolExecutor(
            5, 10, 60L, TimeUnit.SECONDS,
            new LinkedBlockingQueue&lt;&gt;(100),
            new ThreadFactoryBuilder()
                .setNameFormat("email-%d")
                .build()
        );
    }
}</code></pre>
                </v-window-item>
                <v-window-item value="config">
                  <pre class="code-block"><code>// æ¨èé…ç½®
@Bean("taskExecutor")
public Executor taskExecutor() {
    ThreadPoolTaskExecutor executor = 
        new ThreadPoolTaskExecutor();
    executor.setCorePoolSize(5);
    executor.setMaxPoolSize(10);
    executor.setQueueCapacity(100);
    executor.setThreadNamePrefix("async-");
    executor.setRejectedExecutionHandler(
        new ThreadPoolExecutor.CallerRunsPolicy()
    );
    executor.initialize();
    return executor;
}

// ä½¿ç”¨
@Async("taskExecutor")
public CompletableFuture&lt;String&gt; asyncMethod() {
    // å¼‚æ­¥é€»è¾‘
    return CompletableFuture.completedFuture("done");
}</code></pre>
                </v-window-item>
              </v-window>
            </v-card-text>
          </v-card>

          <!-- Spring Event è¯¦è§£ -->
          <v-card class="mb-4" elevation="2">
            <v-card-title>
              <v-icon color="primary" class="mr-2">mdi-bullhorn</v-icon>
              <span>ğŸ“¢ Spring Event å®Œæ•´ç¤ºä¾‹</span>
            </v-card-title>
            <v-card-text>
              <v-tabs v-model="eventTab" color="primary">
                <v-tab value="event">äº‹ä»¶å®šä¹‰</v-tab>
                <v-tab value="publish">å‘å¸ƒäº‹ä»¶</v-tab>
                <v-tab value="listen">ç›‘å¬äº‹ä»¶</v-tab>
              </v-tabs>
              <v-window v-model="eventTab" class="mt-4">
                <v-window-item value="event">
                  <pre class="code-block"><code>// 1. å®šä¹‰äº‹ä»¶
public class UserRegisteredEvent 
        extends ApplicationEvent {
    private final User user;
    
    public UserRegisteredEvent(Object source, User user) {
        super(source);
        this.user = user;
    }
    
    public User getUser() {
        return user;
    }
}</code></pre>
                </v-window-item>
                <v-window-item value="publish">
                  <pre class="code-block"><code>// 2. å‘å¸ƒäº‹ä»¶
@Service
public class UserService {
    @Autowired
    private ApplicationEventPublisher publisher;
    
    public void registerUser(User user) {
        // ä¸šåŠ¡é€»è¾‘
        userDao.save(user);
        
        // å‘å¸ƒäº‹ä»¶ï¼ˆè§£è€¦ï¼‰
        publisher.publishEvent(
            new UserRegisteredEvent(this, user)
        );
    }
}</code></pre>
                </v-window-item>
                <v-window-item value="listen">
                  <pre class="code-block"><code>// 3. ç›‘å¬äº‹ä»¶
@Component
public class EmailListener {
    
    @EventListener
    @Async  // å¼‚æ­¥ç›‘å¬
    public void handleUserRegistered(
            UserRegisteredEvent event) {
        User user = event.getUser();
        // å‘é€æ¬¢è¿é‚®ä»¶
        emailService.sendWelcomeEmail(user);
    }
}

// å¤šä¸ªç›‘å¬å™¨è‡ªåŠ¨æ‰§è¡Œ
@Component
public class SmsListener {
    @EventListener
    public void handleUserRegistered(
            UserRegisteredEvent event) {
        // å‘é€çŸ­ä¿¡
    }
}</code></pre>
                </v-window-item>
              </v-window>
            </v-card-text>
          </v-card>

          <!-- æ³¨æ„äº‹é¡¹ -->
          <v-card class="mb-4" elevation="2">
            <v-card-title>
              <v-icon color="warning" class="mr-2">mdi-alert</v-icon>
              <span>âš ï¸ æ³¨æ„äº‹é¡¹</span>
            </v-card-title>
            <v-card-text>
              <v-list>
                <v-list-item
                  v-for="(note, idx) in importantNotes"
                  :key="idx"
                  :prepend-icon="note.icon"
                >
                  <v-list-item-title>{{ note.text }}</v-list-item-title>
                </v-list-item>
              </v-list>
            </v-card-text>
          </v-card>

          <!-- æœ€ä½³å®è·µ -->
          <v-card elevation="2">
            <v-card-title>
              <v-icon color="success" class="mr-2">mdi-star</v-icon>
              <span>â­ æœ€ä½³å®è·µ</span>
            </v-card-title>
            <v-card-text>
              <v-list>
                <v-list-item
                  v-for="(tip, idx) in bestPractices"
                  :key="idx"
                  :prepend-icon="tip.icon"
                >
                  <v-list-item-title>{{ tip.text }}</v-list-item-title>
                </v-list-item>
              </v-list>
            </v-card-text>
          </v-card>
        </v-col>
      </v-row>
    </v-container>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';

const asyncTab = ref('wrong');
const eventTab = ref('event');

const importantNotes = ref([
  {
    icon: 'mdi-alert-circle',
    text: 'ğŸš¨ @Async é»˜è®¤ä¸æ˜¯çº¿ç¨‹æ± ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»è‡ªå®šä¹‰çº¿ç¨‹æ± ',
  },
  {
    icon: 'mdi-alert-circle',
    text: 'âš ï¸ å¼‚æ­¥æ–¹æ³•çš„äº‹åŠ¡ä¸ä¼šç»§æ‰¿ï¼Œéœ€è¦å•ç‹¬å¤„ç†',
  },
  {
    icon: 'mdi-alert-circle',
    text: 'ğŸ“¢ äº‹ä»¶ç›‘å¬å™¨é»˜è®¤åŒæ­¥æ‰§è¡Œï¼Œéœ€è¦å¼‚æ­¥æ—¶åŠ  @Async',
  },
  {
    icon: 'mdi-alert-circle',
    text: 'ğŸ”„ äº‹ä»¶ç›‘å¬å™¨å¼‚å¸¸ä¸ä¼šå½±å“å‘å¸ƒè€…ï¼Œéœ€è¦è‡ªè¡Œå¤„ç†',
  },
]);

const bestPractices = ref([
  {
    icon: 'mdi-check-circle',
    text: 'ğŸ¯ @Async å¿…é¡»æ˜¾å¼æŒ‡å®šçº¿ç¨‹æ± åç§°ï¼Œé¿å…ä½¿ç”¨é»˜è®¤æ‰§è¡Œå™¨',
  },
  {
    icon: 'mdi-check-circle',
    text: 'ğŸ“Š ç›‘æ§çº¿ç¨‹æ± æŒ‡æ ‡ï¼ˆæ´»è·ƒçº¿ç¨‹ã€é˜Ÿåˆ—é•¿åº¦ç­‰ï¼‰',
  },
  {
    icon: 'mdi-check-circle',
    text: 'âœ… äº‹ä»¶ç›‘å¬å™¨ä½¿ç”¨ @Async å®ç°å¼‚æ­¥å¤„ç†',
  },
  {
    icon: 'mdi-check-circle',
    text: 'ğŸ”’ äº‹ä»¶ç›‘å¬å™¨è¦åšå¥½å¼‚å¸¸å¤„ç†ï¼Œé¿å…å½±å“å…¶ä»–ç›‘å¬å™¨',
  },
  {
    icon: 'mdi-check-circle',
    text: 'âš¡ åˆç†ä½¿ç”¨äº‹ä»¶é©±åŠ¨ï¼Œé¿å…è¿‡åº¦è§£è€¦å¯¼è‡´éš¾ä»¥è¿½è¸ª',
  },
]);
</script>

<style scoped lang="scss">
.spring-async-event-view {
  background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
  min-height: 100vh;
  padding: 20px 0;
}

.title-card {
  background: rgba(255, 255, 255, 0.95) !important;
  border-radius: 20px !important;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1) !important;
}

.concept-card {
  border-radius: 16px;
  transition: transform 0.3s ease;
  
  &:hover {
    transform: translateY(-4px);
  }
}

.use-case-box {
  background: #f5f5f5;
  padding: 12px;
  border-radius: 8px;
  border-left: 4px solid #4facfe;
}

.code-block {
  background: #263238;
  color: #aed581;
  padding: 20px;
  border-radius: 8px;
  overflow-x: auto;
  font-family: 'Courier New', monospace;
  font-size: 13px;
  line-height: 1.6;
  margin: 0;
}
</style>

