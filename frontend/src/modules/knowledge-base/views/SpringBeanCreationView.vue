<template>
  <div class="spring-bean-creation-view">
    <v-container fluid>
      <v-row>
        <!-- å·¦ä¾§ï¼šçŸ¥è¯†ç‚¹è®²è§£ -->
        <v-col cols="12" md="4">
          <v-card class="mb-4" elevation="2">
            <v-card-title class="d-flex align-center">
              <v-icon color="primary" class="mr-2">mdi-book-open-variant</v-icon>
              <span>Bean åˆ›å»ºæ–¹å¼</span>
            </v-card-title>
            <v-card-text>
              <v-tabs v-model="activeTab" color="primary">
                <v-tab value="component">@Component</v-tab>
                <v-tab value="bean">@Bean</v-tab>
                <v-tab value="factory">FactoryBean</v-tab>
                <v-tab value="dynamic">åŠ¨æ€åˆ›å»º</v-tab>
              </v-tabs>
              
              <v-window v-model="activeTab" class="mt-4">
                <!-- @Component æ–¹å¼ -->
                <v-window-item value="component">
                  <div class="knowledge-content">
                    <h3 class="text-h6 mb-3">@Component ç³»åˆ—</h3>
                    <p class="text-body-2 mb-2">
                      <strong>æœ€å¸¸ç”¨çš„åˆ›å»ºæ–¹å¼</strong>ï¼Œé€šè¿‡ç»„ä»¶æ‰«æè‡ªåŠ¨å‘ç°å¹¶æ³¨å†Œ Beanã€‚
                    </p>
                    <v-list density="compact">
                      <v-list-item>
                        <template #prepend>
                          <v-icon size="small" color="success">mdi-check-circle</v-icon>
                        </template>
                        <v-list-item-title>@Component - é€šç”¨ç»„ä»¶</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <template #prepend>
                          <v-icon size="small" color="success">mdi-check-circle</v-icon>
                        </template>
                        <v-list-item-title>@Service - ä¸šåŠ¡å±‚</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <template #prepend>
                          <v-icon size="small" color="success">mdi-check-circle</v-icon>
                        </template>
                        <v-list-item-title>@Repository - æ•°æ®è®¿é—®å±‚</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <template #prepend>
                          <v-icon size="small" color="success">mdi-check-circle</v-icon>
                        </template>
                        <v-list-item-title>@Controller - MVC æ§åˆ¶å™¨</v-list-item-title>
                      </v-list-item>
                    </v-list>
                    <v-alert type="info" density="compact" class="mt-3">
                      <strong>åŸç†ï¼š</strong>ClassPathBeanDefinitionScanner æ‰«ææŒ‡å®šåŒ…è·¯å¾„ï¼Œå‘ç°æ³¨è§£åç”Ÿæˆ BeanDefinition
                    </v-alert>
                  </div>
                </v-window-item>

                <!-- @Bean æ–¹å¼ -->
                <v-window-item value="bean">
                  <div class="knowledge-content">
                    <h3 class="text-h6 mb-3">@Bean + @Configuration</h3>
                    <p class="text-body-2 mb-2">
                      <strong>æ‰‹åŠ¨è£…é…æ–¹å¼</strong>ï¼Œé€‚åˆç¬¬ä¸‰æ–¹ç±»é›†æˆå’Œ Starter è‡ªåŠ¨é…ç½®ã€‚
                    </p>
                    <v-alert type="success" density="compact" class="mb-3">
                      <strong>é€‚ç”¨åœºæ™¯ï¼š</strong>
                      <ul class="mt-2">
                        <li>æ‰‹åŠ¨è£…é…ç¬¬ä¸‰æ–¹ç±»</li>
                        <li>Starter è‡ªåŠ¨é…ç½®</li>
                        <li>å¤šå®ç°ä¸‹çš„æ˜¾å¼ Bean åˆ›å»º</li>
                        <li>éœ€è¦ç²¾ç¡®æ§åˆ¶åˆ›å»ºç»†èŠ‚</li>
                      </ul>
                    </v-alert>
                    <v-alert type="info" density="compact">
                      <strong>æœ¬è´¨ï¼š</strong>æ–¹æ³•è¿”å›å€¼è¢«æ³¨å†Œä¸º BeanDefinition
                    </v-alert>
                  </div>
                </v-window-item>

                <!-- FactoryBean -->
                <v-window-item value="factory">
                  <div class="knowledge-content">
                    <h3 class="text-h6 mb-3">FactoryBean</h3>
                    <p class="text-body-2 mb-2">
                      <strong>ç‰¹æ®Šçš„ Bean</strong>ï¼Œç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡ï¼ˆå¦‚ä»£ç†å¯¹è±¡ã€è¿œç¨‹æœåŠ¡ï¼‰ã€‚
                    </p>
                    <v-list density="compact">
                      <v-list-item>
                        <v-list-item-title><strong>æ ¸å¿ƒç‰¹ç‚¹ï¼š</strong></v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title>getBean() è¿”å› getObject() çš„äº§ç‰©ï¼Œè€Œé FactoryBean æœ¬èº«</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title>è·å– FactoryBean æœ¬èº«ï¼šä½¿ç”¨ &beanName</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title>å¸¸ç”¨äºæ¡†æ¶é›†æˆï¼ˆå¦‚ Dubbo çš„ ReferenceBeanï¼‰</v-list-item-title>
                      </v-list-item>
                    </v-list>
                    <v-alert type="warning" density="compact" class="mt-3">
                      <strong>åŒºåˆ«ï¼š</strong>BeanFactory æ˜¯å®¹å™¨ï¼ŒFactoryBean æ˜¯ Bean åˆ›å»ºç­–ç•¥
                    </v-alert>
                  </div>
                </v-window-item>

                <!-- åŠ¨æ€åˆ›å»º -->
                <v-window-item value="dynamic">
                  <div class="knowledge-content">
                    <h3 class="text-h6 mb-3">åŠ¨æ€ Bean åˆ›å»º</h3>
                    <p class="text-body-2 mb-2">
                      <strong>æ ¹æ®è¿è¡Œæ—¶é…ç½®</strong>å†³å®šæ˜¯å¦åˆ›å»ºã€åˆ›å»ºå¤šå°‘æˆ–åˆ›å»ºä»€ä¹ˆç±»å‹çš„ Beanã€‚
                    </p>
                    <v-list density="compact">
                      <v-list-item>
                        <v-list-item-title><strong>@Conditional</strong> - æ¡ä»¶åŒ–æ³¨å†Œ</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title><strong>@ConfigurationProperties</strong> - é…ç½®é©±åŠ¨</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title><strong>BeanDefinitionRegistryPostProcessor</strong> - ç¼–ç¨‹å¼æ³¨å†Œ</v-list-item-title>
                      </v-list-item>
                      <v-list-item>
                        <v-list-item-title><strong>@Profile</strong> - ç¯å¢ƒçº§åˆ†ç»„</v-list-item-title>
                      </v-list-item>
                    </v-list>
                    <v-alert type="info" density="compact" class="mt-3">
                      <strong>é€‚ç”¨åœºæ™¯ï¼š</strong>å¤šæ•°æ®æºã€æ’ä»¶åŒ–æ¶æ„ã€ç§Ÿæˆ·éš”ç¦»ã€åŠŸèƒ½ç°åº¦
                    </v-alert>
                  </div>
                </v-window-item>
              </v-window>
            </v-card-text>
          </v-card>

          <!-- å…³é”®ç‚¹æ€»ç»“ -->
          <v-card elevation="2">
            <v-card-title>
              <v-icon color="primary" class="mr-2">mdi-lightbulb-on</v-icon>
              <span>å…³é”®ç‚¹</span>
            </v-card-title>
            <v-card-text>
              <v-list density="compact">
                <v-list-item v-for="(point, idx) in keyPoints" :key="idx">
                  <template #prepend>
                    <v-icon size="small" color="primary">mdi-circle-small</v-icon>
                  </template>
                  <v-list-item-title class="text-body-2">{{ point }}</v-list-item-title>
                </v-list-item>
              </v-list>
            </v-card-text>
          </v-card>
        </v-col>

        <!-- å³ä¾§ï¼šåŠ¨ç”»æ¼”ç¤ºåŒºåŸŸ -->
        <v-col cols="12" md="8">
          <v-card elevation="2" class="animation-container">
            <v-card-title class="d-flex align-center justify-space-between">
              <div class="d-flex align-center">
                <v-icon color="primary" class="mr-2">mdi-animation-play</v-icon>
                <span>åŠ¨ç”»æ¼”ç¤º</span>
              </div>
              <div>
                <v-btn
                  color="primary"
                  size="small"
                  prepend-icon="mdi-play"
                  @click="playAnimation"
                  :disabled="isAnimating"
                  class="mr-2"
                >
                  æ’­æ”¾åŠ¨ç”»
                </v-btn>
                <v-btn
                  color="secondary"
                  size="small"
                  prepend-icon="mdi-restore"
                  @click="resetAnimation"
                >
                  é‡ç½®
                </v-btn>
              </div>
            </v-card-title>
            <v-card-text>
              <!-- åŠ¨ç”»ç”»å¸ƒ -->
              <div class="animation-canvas" ref="animationCanvas">
                <!-- Bean åˆ›å»ºæµç¨‹å›¾ -->
                <svg :width="canvasWidth" :height="canvasHeight" class="flow-svg">
                  <!-- èƒŒæ™¯ç½‘æ ¼ -->
                  <defs>
                    <pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse">
                      <path d="M 20 0 L 0 0 0 20" fill="none" stroke="#e0e0e0" stroke-width="0.5"/>
                    </pattern>
                  </defs>
                  <rect width="100%" height="100%" fill="url(#grid)" />

                  <!-- æ­¥éª¤èŠ‚ç‚¹ -->
                  <g v-for="(step, idx) in animationSteps" :key="step.id">
                    <!-- èŠ‚ç‚¹ -->
                    <g
                      :class="['step-node', { 'active': step.active, 'completed': step.completed }]"
                      :style="{ 
                        transform: `translate(${step.x}px, ${step.y}px)`,
                        opacity: step.visible ? 1 : 0,
                        transition: 'all 0.5s ease'
                      }"
                    >
                      <!-- èŠ‚ç‚¹èƒŒæ™¯ -->
                      <rect
                        :width="step.width"
                        :height="step.height"
                        :rx="8"
                        :fill="step.completed ? '#4caf50' : step.active ? '#2196f3' : '#f5f5f5'"
                        :stroke="step.active ? '#1976d2' : '#bdbdbd'"
                        stroke-width="2"
                        class="node-rect"
                      />
                      <!-- èŠ‚ç‚¹å›¾æ ‡ -->
                      <text
                        :x="step.width / 2"
                        :y="step.height / 2 - 10"
                        text-anchor="middle"
                        font-size="24"
                        :fill="step.completed || step.active ? 'white' : '#666'"
                      >
                        {{ step.icon }}
                      </text>
                      <!-- èŠ‚ç‚¹æ ‡ç­¾ -->
                      <text
                        :x="step.width / 2"
                        :y="step.height / 2 + 15"
                        text-anchor="middle"
                        font-size="12"
                        font-weight="bold"
                        :fill="step.completed || step.active ? 'white' : '#666'"
                      >
                        {{ step.label }}
                      </text>
                    </g>

                    <!-- è¿æ¥çº¿ -->
                    <line
                      v-if="idx > 0 && animationSteps[idx - 1].visible"
                      :x1="animationSteps[idx - 1].x + animationSteps[idx - 1].width / 2"
                      :y1="animationSteps[idx - 1].y + animationSteps[idx - 1].height / 2"
                      :x2="step.x + step.width / 2"
                      :y2="step.y + step.height / 2"
                      :stroke="step.completed || step.active ? '#4caf50' : '#bdbdbd'"
                      :stroke-width="step.completed || step.active ? 3 : 1"
                      :stroke-dasharray="step.completed || step.active ? '0' : '5,5'"
                      marker-end="url(#arrowhead)"
                      class="connection-line"
                      :style="{ 
                        opacity: step.visible ? 1 : 0,
                        transition: 'all 0.5s ease'
                      }"
                    />
                  </g>

                  <!-- ç®­å¤´æ ‡è®° -->
                  <defs>
                    <marker
                      id="arrowhead"
                      markerWidth="10"
                      markerHeight="10"
                      refX="9"
                      refY="3"
                      orient="auto"
                    >
                      <polygon points="0 0, 10 3, 0 6" fill="#4caf50" />
                    </marker>
                  </defs>
                </svg>

                <!-- ä»£ç ç¤ºä¾‹åŒºåŸŸ -->
                <div
                  v-if="currentStep"
                  class="code-example-card"
                  :style="{
                    opacity: currentStep.visible ? 1 : 0,
                    transition: 'opacity 0.5s ease'
                  }"
                >
                  <v-card elevation="4">
                    <v-card-title class="text-subtitle-2">
                      {{ currentStep.label }} - ä»£ç ç¤ºä¾‹
                    </v-card-title>
                    <v-card-text>
                      <pre class="code-block"><code>{{ currentStep.code }}</code></pre>
                    </v-card-text>
                  </v-card>
                </div>
              </div>
            </v-card-text>
          </v-card>

          <!-- è¯¦ç»†è¯´æ˜ -->
          <v-card class="mt-4" elevation="2">
            <v-card-title>
              <v-icon color="primary" class="mr-2">mdi-information</v-icon>
              <span>è¯¦ç»†è¯´æ˜</span>
            </v-card-title>
            <v-card-text>
              <v-expansion-panels v-model="expandedPanels" multiple>
                <v-expansion-panel
                  v-for="(detail, idx) in detailedExplanations"
                  :key="idx"
                  :title="detail.title"
                >
                  <v-expansion-panel-text>
                    <div v-html="detail.content"></div>
                  </v-expansion-panel-text>
                </v-expansion-panel>
              </v-expansion-panels>
            </v-card-text>
          </v-card>
        </v-col>
      </v-row>
    </v-container>
  </div>
</template>

<script setup lang="ts">
import { ref, computed, onMounted } from 'vue';

// å“åº”å¼æ•°æ®
const activeTab = ref('component');
const isAnimating = ref(false);
const animationCanvas = ref<HTMLElement | null>(null);
const canvasWidth = ref(800);
const canvasHeight = ref(600);
const expandedPanels = ref<number[]>([]);

// å…³é”®ç‚¹
const keyPoints = ref([
  'æ‰€æœ‰åˆ›å»ºæ–¹å¼æœ€ç»ˆéƒ½å‘ BeanDefinitionRegistry æ±‡èš',
  '@Component åŸºäºæ‰«æï¼Œ@Bean/@Import åŸºäºæ˜¾å¼å£°æ˜',
  '@Import æ‰©å±•èƒ½åŠ›æœ€å¼ºï¼Œæ˜¯è‡ªåŠ¨é…ç½®çš„åº•å±‚æ ¸å¿ƒ',
  'ç¬¬ä¸‰æ–¹æ¡†æ¶é€šè¿‡ BeanFactoryPostProcessor æ‰¹é‡æ³¨å†Œ Bean',
  'Bean åˆ›å»ºæ–¹å¼å¤šæ ·ï¼Œä½†ç”Ÿå‘½å‘¨æœŸç»Ÿä¸€ç”± IoC ç®¡ç†',
]);

// åŠ¨ç”»æ­¥éª¤
const animationSteps = ref([
  {
    id: 'scan',
    label: 'ç»„ä»¶æ‰«æ',
    icon: 'ğŸ”',
    x: 50,
    y: 100,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: true,
    code: `@Component
public class UserService {
    // è‡ªåŠ¨æ‰«æå¹¶æ³¨å†Œä¸º Bean
}`,
  },
  {
    id: 'definition',
    label: 'ç”Ÿæˆ BeanDefinition',
    icon: 'ğŸ“‹',
    x: 220,
    y: 100,
    width: 140,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `BeanDefinition {
    beanClassName: "UserService"
    scope: "singleton"
    // ... å…¶ä»–å…ƒæ•°æ®
}`,
  },
  {
    id: 'register',
    label: 'æ³¨å†Œåˆ°å®¹å™¨',
    icon: 'ğŸ“¦',
    x: 410,
    y: 100,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `BeanDefinitionRegistry
    .registerBeanDefinition(
        "userService",
        beanDefinition
    )`,
  },
  {
    id: 'instantiate',
    label: 'å®ä¾‹åŒ– Bean',
    icon: 'ğŸ—ï¸',
    x: 580,
    y: 100,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `// é€šè¿‡åå°„åˆ›å»ºå®ä¾‹
Object bean = 
    Class.forName(className)
        .newInstance();`,
  },
  {
    id: 'inject',
    label: 'ä¾èµ–æ³¨å…¥',
    icon: 'ğŸ’‰',
    x: 220,
    y: 250,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `// æ³¨å…¥ä¾èµ–
@Autowired
private UserDao userDao;`,
  },
  {
    id: 'init',
    label: 'åˆå§‹åŒ–',
    icon: 'âœ¨',
    x: 410,
    y: 250,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `@PostConstruct
public void init() {
    // åˆå§‹åŒ–é€»è¾‘
}`,
  },
  {
    id: 'ready',
    label: 'Bean å°±ç»ª',
    icon: 'âœ…',
    x: 580,
    y: 250,
    width: 120,
    height: 80,
    active: false,
    completed: false,
    visible: false,
    code: `// Bean å·²å¯ç”¨
ApplicationContext
    .getBean("userService")`,
  },
]);

// å½“å‰æ­¥éª¤
const currentStep = computed(() => {
  return animationSteps.value.find(step => step.active) || animationSteps.value[0];
});

// è¯¦ç»†è¯´æ˜
const detailedExplanations = ref([
  {
    title: '@Component ç³»åˆ— - ç»„ä»¶æ‰«ææœºåˆ¶',
    content: `
      <p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
      <ul>
        <li>Spring é€šè¿‡ ClassPathBeanDefinitionScanner æ‰«ææŒ‡å®šåŒ…è·¯å¾„</li>
        <li>å‘ç°å¸¦æœ‰ @Componentã€@Serviceã€@Repositoryã€@Controller ç­‰æ³¨è§£çš„ç±»</li>
        <li>ä¸ºæ¯ä¸ªç±»ç”Ÿæˆ BeanDefinition å¹¶æ³¨å†Œåˆ°å®¹å™¨</li>
        <li>å®¹å™¨å¯åŠ¨æ—¶å®ä¾‹åŒ–è¿™äº› Bean</li>
      </ul>
      <p><strong>ä¼˜ç‚¹ï¼š</strong>è‡ªåŠ¨å‘ç°ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®</p>
      <p><strong>ç¼ºç‚¹ï¼š</strong>åªèƒ½å¯¹æœ¬ç±»å®ä¾‹åŒ–ï¼Œæ— æ³•ç²¾ç¡®æ§åˆ¶åˆ›å»ºç»†èŠ‚</p>
    `,
  },
  {
    title: '@Bean + @Configuration - æ‰‹åŠ¨è£…é…',
    content: `
      <p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
      <ul>
        <li>åœ¨ @Configuration ç±»ä¸­å®šä¹‰ @Bean æ–¹æ³•</li>
        <li>æ–¹æ³•è¿”å›å€¼è¢«æ³¨å†Œä¸º BeanDefinition</li>
        <li>æ”¯æŒæ¡ä»¶åŒ–åˆ›å»ºï¼ˆ@Conditionalï¼‰</li>
        <li>å¯ä»¥æŒ‡å®šæ„é€ å‚æ•°ã€åˆå§‹åŒ–æ–¹æ³•ç­‰</li>
      </ul>
      <p><strong>é€‚ç”¨åœºæ™¯ï¼š</strong></p>
      <ul>
        <li>ç¬¬ä¸‰æ–¹ç±»é›†æˆï¼ˆå¦‚ RedisTemplateã€RestTemplateï¼‰</li>
        <li>SpringBoot Starter è‡ªåŠ¨é…ç½®</li>
        <li>å¤šå®ç°ä¸‹çš„æ˜¾å¼ Bean åˆ›å»º</li>
      </ul>
    `,
  },
  {
    title: 'FactoryBean - å·¥å‚ Bean',
    content: `
      <p><strong>å·¥ä½œåŸç†ï¼š</strong></p>
      <ul>
        <li>FactoryBean æœ¬èº«æ˜¯ä¸€ä¸ª Bean</li>
        <li>å½“è°ƒç”¨ getBean() æ—¶ï¼Œè¿”å›çš„æ˜¯ getObject() çš„äº§ç‰©</li>
        <li>è¦è·å– FactoryBean æœ¬èº«ï¼Œä½¿ç”¨ &beanName</li>
      </ul>
      <p><strong>å…¸å‹åº”ç”¨ï¼š</strong></p>
      <ul>
        <li>Dubbo çš„ ReferenceBean - åˆ›å»ºè¿œç¨‹æœåŠ¡ä»£ç†</li>
        <li>MyBatis çš„ SqlSessionFactoryBean - åˆ›å»º SqlSessionFactory</li>
        <li>å¤æ‚å¯¹è±¡çš„åˆ›å»ºé€»è¾‘å°è£…</li>
      </ul>
    `,
  },
  {
    title: 'åŠ¨æ€ Bean åˆ›å»º - æ¡ä»¶åŒ–æ³¨å†Œ',
    content: `
      <p><strong>å®ç°æ–¹å¼ï¼š</strong></p>
      <ul>
        <li><strong>@Conditionalï¼š</strong>å®ç° Condition æ¥å£ï¼Œè‡ªå®šä¹‰æ¡ä»¶åˆ¤æ–­</li>
        <li><strong>@ConditionalOnPropertyï¼š</strong>åŸºäºé…ç½®é¡¹æ§åˆ¶æ˜¯å¦åˆ›å»º</li>
        <li><strong>@ConfigurationPropertiesï¼š</strong>é…ç½®ç»‘å®šï¼Œæ ¹æ®é…ç½®ç”Ÿæˆ Bean</li>
        <li><strong>BeanDefinitionRegistryPostProcessorï¼š</strong>ç¼–ç¨‹å¼æ³¨å†Œï¼Œæœ€çµæ´»</li>
        <li><strong>@Profileï¼š</strong>æŒ‰ç¯å¢ƒåˆ†ç»„ï¼Œä¸åŒç¯å¢ƒåŠ è½½ä¸åŒ Bean</li>
      </ul>
      <p><strong>åº”ç”¨åœºæ™¯ï¼š</strong>å¤šæ•°æ®æºã€æ’ä»¶åŒ–æ¶æ„ã€ç§Ÿæˆ·éš”ç¦»ã€åŠŸèƒ½ç°åº¦</p>
    `,
  },
]);

// æ’­æ”¾åŠ¨ç”»
const playAnimation = async () => {
  if (isAnimating.value) return;
  
  isAnimating.value = true;
  
  // é‡ç½®æ‰€æœ‰æ­¥éª¤
  animationSteps.value.forEach(step => {
    step.active = false;
    step.completed = false;
    step.visible = false;
  });
  
  // é€æ­¥æ˜¾ç¤ºå’Œæ¿€æ´»
  for (let i = 0; i < animationSteps.value.length; i++) {
    const step = animationSteps.value[i];
    
    // æ˜¾ç¤ºå½“å‰æ­¥éª¤
    step.visible = true;
    step.active = true;
    
    // ç­‰å¾…åŠ¨ç”»å®Œæˆ
    await new Promise(resolve => setTimeout(resolve, 1500));
    
    // æ ‡è®°ä¸ºå®Œæˆ
    step.completed = true;
    step.active = false;
    
    // ç­‰å¾…ä¸€ä¸‹å†ç»§ç»­
    await new Promise(resolve => setTimeout(resolve, 300));
  }
  
  isAnimating.value = false;
};

// é‡ç½®åŠ¨ç”»
const resetAnimation = () => {
  isAnimating.value = false;
  animationSteps.value.forEach(step => {
    step.active = false;
    step.completed = false;
    step.visible = step.id === 'scan'; // åªæ˜¾ç¤ºç¬¬ä¸€æ­¥
  });
};

// æ ¹æ®é€‰ä¸­çš„æ ‡ç­¾é¡µæ›´æ–°åŠ¨ç”»æ­¥éª¤
const updateAnimationForTab = () => {
  // å¯ä»¥æ ¹æ®ä¸åŒçš„æ ‡ç­¾é¡µæ˜¾ç¤ºä¸åŒçš„åŠ¨ç”»æµç¨‹
  // è¿™é‡Œç®€åŒ–å¤„ç†ï¼Œç»Ÿä¸€ä½¿ç”¨ç›¸åŒçš„æµç¨‹
};

onMounted(() => {
  // åˆå§‹åŒ–ï¼šåªæ˜¾ç¤ºç¬¬ä¸€æ­¥
  resetAnimation();
  
  // ç›‘å¬æ ‡ç­¾é¡µåˆ‡æ¢
  // updateAnimationForTab();
});
</script>

<style scoped lang="scss">
.spring-bean-creation-view {
  padding: 20px;
  background: #f5f5f5;
  min-height: calc(100vh - 64px);
}

.knowledge-content {
  min-height: 300px;
}

.animation-container {
  .animation-canvas {
    position: relative;
    width: 100%;
    height: 600px;
    background: white;
    border-radius: 8px;
    overflow: hidden;
    
    .flow-svg {
      width: 100%;
      height: 100%;
    }
    
    .step-node {
      cursor: pointer;
      
      .node-rect {
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        transition: all 0.3s ease;
      }
      
      &.active .node-rect {
        filter: drop-shadow(0 4px 8px rgba(33, 150, 243, 0.4));
        animation: pulse 1s ease-in-out infinite;
      }
      
      &.completed .node-rect {
        filter: drop-shadow(0 4px 8px rgba(76, 175, 80, 0.4));
      }
      
      &:hover .node-rect {
        transform: scale(1.05);
      }
    }
    
    .connection-line {
      transition: all 0.5s ease;
    }
    
    .code-example-card {
      position: absolute;
      bottom: 20px;
      left: 20px;
      right: 20px;
      max-width: 500px;
      margin: 0 auto;
      
      .code-block {
        background: #263238;
        color: #aed581;
        padding: 16px;
        border-radius: 4px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        font-size: 13px;
        line-height: 1.6;
        margin: 0;
      }
    }
  }
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.05);
  }
}

// å“åº”å¼è®¾è®¡
@media (max-width: 960px) {
  .spring-bean-creation-view {
    .animation-canvas {
      height: 400px;
    }
  }
}
</style>

