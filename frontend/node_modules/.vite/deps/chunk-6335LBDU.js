import {
  G,
  P,
  Qh,
  Qo as Qo2,
  Us2 as Us,
  Wt,
  Zh2 as Zh,
  ba,
  ee2 as ee,
  ha3 as ha,
  ht,
  io,
  li,
  ss,
  to,
  z
} from "./chunk-I7I3GTAS.js";
import {
  BehaviorSubject,
  Fn,
  GC,
  Gi,
  Inject,
  Injector,
  Ls,
  Ms,
  Ns,
  Ol,
  Or,
  Qo,
  Ve,
  eR,
  fn,
  fo,
  ic,
  merge,
  nR,
  of,
  oo,
  pt,
  qR,
  skip,
  sr,
  switchMap,
  tR,
  vr,
  we,
  yp,
  zc
} from "./chunk-RGZYGL3P.js";

// node_modules/@univerjs/sheets-numfmt/lib/es/index.js
var ae = Object.defineProperty;
var ie = (e, n, t) => n in e ? ae(e, n, { enumerable: true, configurable: true, writable: true, value: t }) : e[n] = t;
var L = (e, n, t) => ie(e, typeof n != "symbol" ? n + "" : n, t);
var re = [
  "$",
  "£",
  "¥",
  "¤",
  "֏",
  "؋",
  "৳",
  "฿",
  "៛",
  "₡",
  "₦",
  "₩",
  "₪",
  "₫",
  "€",
  "₭",
  "₮",
  "₱",
  "₲",
  "₴",
  "₸",
  "₹",
  "₺",
  "₼",
  "₽",
  "₾",
  "₿",
  "﷼"
];
var w = /* @__PURE__ */ new Map([
  [Ns.EN_US, "$"],
  [Ns.RU_RU, "₽"],
  [Ns.VI_VN, "₫"],
  [Ns.ZH_CN, "¥"],
  [Ns.ZH_TW, "NT$"],
  [Ns.FR_FR, "€"],
  [Ns.FA_IR, "﷼"],
  [Ns.KO_KR, "₩"],
  [Ns.ES_ES, "€"],
  [Ns.CA_ES, "€"]
]);
function xe(e) {
  switch (e) {
    case Ns.CA_ES:
    case Ns.ES_ES:
    case Ns.FR_FR:
      return {
        icon: "EuroIcon",
        symbol: w.get(e) || "€",
        locale: e
      };
    case Ns.RU_RU:
      return {
        icon: "RoubleIcon",
        symbol: w.get(e) || "₽",
        locale: e
      };
    case Ns.ZH_CN:
      return {
        icon: "RmbIcon",
        symbol: w.get(e) || "¥",
        locale: e
      };
    case Ns.EN_US:
    default:
      return {
        icon: "DollarIcon",
        symbol: "$",
        locale: Ns.EN_US
      };
  }
}
function Y(e) {
  return w.get(e) || "$";
}
function Pe(e, n = 2) {
  let t = n;
  n > 127 && (t = 127);
  let r = "";
  return t > 0 && (r = `.${"0".repeat(t)}`), `"${Y(e)}"#,##0${r}_);[Red]("${Y(e)}"#,##0${r})`;
}
var Fe = [
  {
    label: "1930-08-05",
    suffix: "yyyy-MM-dd"
  },
  {
    label: "1930/08/05",
    suffix: "yyyy/MM/dd"
  },
  {
    label: "1930年08月05日",
    suffix: 'yyyy"年"MM"月"dd"日"'
  },
  {
    label: "08-05",
    suffix: "MM-dd"
  },
  {
    label: "8月5日",
    suffix: 'M"月"d"日"'
  },
  {
    label: "13:30:30",
    suffix: "h:mm:ss"
  },
  {
    label: "13:30",
    suffix: "h:mm"
  },
  {
    label: "下午01:30",
    suffix: "A/P hh:mm"
  },
  {
    label: "下午1:30",
    suffix: "A/P h:mm"
  },
  {
    label: "下午1:30:30",
    suffix: "A/P h:mm:ss"
  },
  {
    label: "08-05 下午 01:30",
    suffix: "MM-dd A/P hh:mm"
  }
];
var De = [
  {
    label: "(1,235)",
    suffix: "#,##0_);(#,##0)"
  },
  {
    label: "(1,235) ",
    suffix: "#,##0_);[Red](#,##0)",
    color: "red"
  },
  {
    label: "1,234.56",
    suffix: "#,##0.00_);#,##0.00"
  },
  {
    label: "1,234.56",
    suffix: "#,##0.00_);[Red]#,##0.00",
    color: "red"
  },
  {
    label: "-1,234.56",
    suffix: "#,##0.00_);-#,##0.00"
  },
  {
    label: "-1,234.56",
    suffix: "#,##0.00_);[Red]-#,##0.00",
    color: "red"
  }
];
var Ae = [
  {
    label: (e) => `${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);"${e}"#,##0.00`
  },
  {
    label: (e) => `${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]"${e}"#,##0.00`,
    color: "red"
  },
  {
    label: (e) => `(${e}1,235)`,
    suffix: (e) => `"${e}"#,##0.00_);("${e}"#,##0.00)`
  },
  {
    label: (e) => `(${e}1,235)`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]("${e}"#,##0.00)`,
    color: "red"
  },
  {
    label: (e) => `-${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);-"${e}"#,##0.00`
  },
  {
    label: (e) => `-${e}1,235`,
    suffix: (e) => `"${e}"#,##0.00_);[Red]-"${e}"#,##0.00`,
    color: "red"
  }
];
var P2 = (e, n = 0) => {
  var r;
  return e && (r = eR.getFormatInfo(e).maxDecimals) != null ? r : n;
};
var q = (e) => new Array(Math.min(Math.max(0, Number(e)), 30)).fill(0).join("");
var F = (e, n) => e.split(";").map((r) => /\.0?/.test(r) ? r.replace(
  /\.0*/g,
  `${n > 0 ? "." : ""}${q(Number(n || 0))}`
) : /0([^0]?)|0$/.test(r) ? r.replace(
  /0([^0]+)|0$/,
  `0${n > 0 ? "." : ""}${q(Number(n || 0))}$1`
) : r).join(";");
var rt = (e) => /\.0?/.test(e) || /0([^0]?)|0$/.test(e);
var O = {
  id: "sheet.command.numfmt.set.numfmt",
  type: Ms.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (e, n) => {
    if (!n)
      return false;
    const t = e.get(Ls), r = e.get(vr), s = e.get(Qo), a = P(r, n);
    if (!a) return false;
    const { unitId: l, subUnitId: o, worksheet: h } = a, u = n.values.filter((i) => !!i.pattern), C = n.values.filter((i) => !i.pattern), y = Us(l, o, u), p = {
      unitId: l,
      subUnitId: o,
      ranges: C.map((i) => ({
        startColumn: i.col,
        startRow: i.row,
        endColumn: i.col,
        endRow: i.row
      }))
    }, b = [], _ = [];
    if (u.length) {
      const i = u.reduce((d, c) => {
        tR(c.pattern) && d.setValue(c.row, c.col, { t: fn.STRING });
        const S = h.getCellRaw(c.row, c.col);
        if (S) {
          const T = io(S.v);
          T !== S.t && d.setValue(c.row, c.col, { t: T });
        }
        return d;
      }, new pt()).getMatrix(), g = new pt();
      new pt(i).forValue((d, c) => {
        const S = h.getCellRaw(d, c);
        S ? g.setValue(d, c, { t: S.t }) : g.setValue(d, c, { t: void 0 });
      }), Object.keys(y.values).forEach((d) => {
        const c = y.values[d];
        c.ranges = Qo2(c.ranges);
      }), b.push({
        id: to.id,
        params: y
      });
      const v = Zh(e, y);
      _.push(...v);
    }
    if (C.length) {
      p.ranges = Qo2(p.ranges);
      const i = C.reduce((d, c) => {
        const S = h.getCellRaw(c.row, c.col);
        if (S) {
          const T = io(S.v);
          T !== S.t && d.setValue(c.row, c.col, { t: T });
        }
        return d;
      }, new pt()).getMatrix(), g = new pt();
      new pt(i).forValue((d, c) => {
        const S = h.getCellRaw(d, c);
        S ? g.setValue(d, c, { t: S.t }) : g.setValue(d, c, { t: void 0 });
      }), b.push({
        id: li.id,
        params: p
      }, {
        id: ee.id,
        params: {
          unitId: l,
          subUnitId: o,
          cellValue: i
        }
      });
      const v = Qh(e, p);
      _.push({
        id: ee.id,
        params: {
          unitId: l,
          subUnitId: o,
          cellValue: g.getMatrix()
        }
      }, ...v);
    }
    const m = fo(b, t).result;
    return m && s.pushUndoRedo({
      unitID: l,
      undoMutations: _,
      redoMutations: b
    }), m;
  }
};
var Ve2 = {
  id: "sheet.command.numfmt.add.decimal.command",
  type: Ms.COMMAND,
  handler: async (e) => {
    const n = e.get(Ls), t = e.get(z), r = e.get(Wt), s = e.get(vr), a = t.getCurrentSelections();
    if (!a || !a.length)
      return false;
    const l = P(s);
    if (!l) return false;
    const { unitId: o, subUnitId: h } = l;
    let u = 0;
    a.forEach((b) => {
      Or.foreach(b.range, (_, m) => {
        const i = r.getValue(o, h, _, m);
        if (!i) {
          const v = l.worksheet.getCellRaw(_, m);
          if (!u && v && v.t === fn.NUMBER && v.v) {
            const d = /\.(\d*)$/.exec(String(v.v));
            if (d) {
              const c = d[1].length;
              if (!c)
                return;
              u = Math.max(u, c);
            }
          }
          return;
        }
        const g = P2(i.pattern);
        u = g > u ? g : u;
      });
    });
    const C = u + 1, y = F(`0${C > 0 ? ".0" : ""}`, C), p = [];
    return a.forEach((b) => {
      Or.foreach(b.range, (_, m) => {
        const i = r.getValue(o, h, _, m);
        if (nR(i == null ? void 0 : i.pattern))
          p.push({
            row: _,
            col: m,
            pattern: y
          });
        else {
          const g = P2(i.pattern), v = F(i.pattern, g + 1);
          v !== i.pattern && p.push({
            row: _,
            col: m,
            pattern: v
          });
        }
      });
    }), p.length ? await n.executeCommand(O.id, { values: p }) : false;
  }
};
var je = {
  id: "sheet.command.numfmt.set.currency",
  type: Ms.COMMAND,
  handler: async (e) => {
    const n = e.get(Ls), t = e.get(z), r = e.get(Fn), s = t.getCurrentSelections();
    if (!s || !s.length)
      return false;
    const a = [], l = xe(r.getCurrentLocale()), o = Pe(l.locale);
    return s.forEach((u) => {
      Or.foreach(u.range, (C, y) => {
        a.push({ row: C, col: y, pattern: o, type: "currency" });
      });
    }), await n.executeCommand(O.id, { values: a });
  }
};
var Le = {
  id: "sheet.command.numfmt.set.percent",
  type: Ms.COMMAND,
  handler: async (e) => {
    const n = e.get(Ls), r = e.get(z).getCurrentSelections();
    if (!r || !r.length)
      return false;
    const s = [], a = "0%";
    return r.forEach((o) => {
      Or.foreach(o.range, (h, u) => {
        s.push({ row: h, col: u, pattern: a, type: "percent" });
      });
    }), await n.executeCommand(O.id, { values: s });
  }
};
var Be = {
  id: "sheet.command.numfmt.subtract.decimal.command",
  type: Ms.COMMAND,
  handler: async (e) => {
    const n = e.get(Ls), t = e.get(z), r = e.get(Wt), s = e.get(vr), a = t.getCurrentSelections();
    if (!a || !a.length)
      return false;
    const l = P(s);
    if (!l) return false;
    const { unitId: o, subUnitId: h } = l;
    let u = 0;
    a.forEach((_) => {
      Or.foreach(_.range, (m, i) => {
        const g = r.getValue(o, h, m, i);
        if (!g) {
          const d = l.worksheet.getCellRaw(m, i);
          if (!u && d && d.t === fn.NUMBER && d.v) {
            const c = /\.(\d*)$/.exec(String(d.v));
            if (c) {
              const S = c[1].length;
              if (!S)
                return;
              u = Math.max(u, S);
            }
          }
          return;
        }
        const v = P2(g.pattern);
        u = v > u ? v : u;
      });
    });
    const C = u - 1, y = F(`0${C > 0 ? ".0" : "."}`, C), p = [];
    return a.forEach((_) => {
      Or.foreach(_.range, (m, i) => {
        const g = r.getValue(o, h, m, i);
        if (nR(g == null ? void 0 : g.pattern))
          p.push({
            row: m,
            col: i,
            pattern: y
          });
        else {
          const v = P2(g.pattern);
          p.push({
            row: m,
            col: i,
            pattern: F(g.pattern, v - 1)
          });
        }
      });
    }), await n.executeCommand(O.id, { values: p });
  }
};
var se = "sheets-numfmt.config";
var X = {};
var st = (e) => eR.getFormatInfo(e).type || "unknown";
var He = (e, n, t = "en") => {
  const r = eR.formatColor(e, n), s = r ? String(r) : void 0, a = eR.format(e, n, { locale: t, throws: false });
  return n < 0 ? {
    result: a,
    color: s
  } : {
    result: a
  };
};
var Ge = (e, n, t) => e === yp ? {
  result: String(ba(n))
  // In Excel, the default General format also needs to handle numeric precision.
} : He(e, n, t);
var We = Object.getOwnPropertyDescriptor;
var Ke = (e, n, t, r) => {
  for (var s = r > 1 ? void 0 : r ? We(n, t) : n, a = e.length - 1, l; a >= 0; a--)
    (l = e[a]) && (s = l(s) || s);
  return s;
};
var E = (e, n) => (t, r) => n(t, r, e);
var Ze = {
  tl: {
    size: 6,
    color: "#409f11"
  }
};
var D = class extends Ve {
  constructor(n, t, r, s, a, l, o) {
    super();
    L(this, "_locale$", new BehaviorSubject("en"));
    L(this, "locale$", this._locale$.asObservable());
    this._instanceService = n, this._sheetInterceptorService = t, this._themeService = r, this._commandService = s, this._numfmtService = a, this._localeService = l, this._configService = o, this._initInterceptorCellContent();
  }
  get locale() {
    const n = this._locale$.getValue();
    if (n)
      return n;
    switch (this._localeService.getCurrentLocale()) {
      case Ns.FR_FR:
        return "fr";
      case Ns.RU_RU:
        return "ru";
      case Ns.VI_VN:
        return "vi";
      case Ns.ZH_CN:
        return "zh-CN";
      case Ns.KO_KR:
        return "ko";
      case Ns.ZH_TW:
        return "zh-TW";
      case Ns.ES_ES:
      case Ns.CA_ES:
        return "es";
      case Ns.EN_US:
      case Ns.FA_IR:
      default:
        return "en";
    }
  }
  // eslint-disable-next-line max-lines-per-function
  _initInterceptorCellContent() {
    const n = new pt();
    this.disposeWithMe(merge(this._locale$, this._localeService.currentLocale$).subscribe(() => {
      n.reset();
    })), this.disposeWithMe(this._sheetInterceptorService.intercept(ht.CELL_CONTENT, {
      effect: sr.Value | sr.Style,
      // eslint-disable-next-line max-lines-per-function, complexity
      handler: (t, r, s) => {
        var b, _;
        if (!t || t.v === void 0 || t.v === null || t.t === fn.BOOLEAN || t.t === fn.FORCE_STRING)
          return s(t);
        const a = r.unitId, l = r.subUnitId;
        let o;
        if (t != null && t.s) {
          const m = r.workbook.getStyles().get(t.s);
          m != null && m.n && (o = m.n);
        }
        if (o || (o = this._numfmtService.getValue(a, l, r.row, r.col)), nR(o == null ? void 0 : o.pattern) || t.t !== fn.NUMBER && io(t.v, t.t) !== fn.NUMBER)
          return s(t);
        const h = t;
        if ((!t || t === r.rawData) && (t = { ...r.rawData }), tR(o == null ? void 0 : o.pattern))
          return (b = this._configService.getConfig(se)) != null && b.disableTextFormatMark ? (t.t = fn.STRING, s(t)) : (t.t = fn.STRING, t.markers = { ...t == null ? void 0 : t.markers, ...Ze }, s(t));
        let u = "";
        const C = n.getValue(r.row, r.col);
        if (C && C.parameters === `${h.v}_${o == null ? void 0 : o.pattern}`)
          return s({ ...t, ...C.result });
        const y = Ge(o == null ? void 0 : o.pattern, Number(h.v), this.locale);
        if (u = y.result, !u)
          return s(t);
        const p = { v: u, t: fn.NUMBER };
        if (y.color) {
          const m = (_ = this._themeService.getColorFromTheme(`${y.color}.500`)) != null ? _ : y.color;
          m && (p.interceptorStyle = { cl: { rgb: m } });
        }
        return n.setValue(r.row, r.col, {
          result: p,
          parameters: `${h.v}_${o == null ? void 0 : o.pattern}`
        }), Object.assign(t, p), s(t);
      },
      priority: ha.NUMFMT
    })), this.disposeWithMe(this._commandService.onCommandExecuted((t) => {
      if (t.id === to.id) {
        const r = t.params;
        Object.keys(r.values).forEach((s) => {
          r.values[s].ranges.forEach((l) => {
            Or.foreach(l, (o, h) => {
              n.realDeleteValue(o, h);
            });
          });
        });
      } else if (t.id === ee.id) {
        const r = t.params;
        new pt(r.cellValue).forValue((s, a) => {
          n.realDeleteValue(s, a);
        });
      }
    })), this.disposeWithMe(
      this._instanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
        switchMap((t) => {
          var r;
          return (r = t == null ? void 0 : t.activeSheet$) != null ? r : of(null);
        }),
        skip(1)
      ).subscribe(() => n.reset())
    );
  }
  setNumfmtLocal(n) {
    this._locale$.next(n);
  }
};
D = Ke([
  E(0, vr),
  E(1, Inject(G)),
  E(2, Inject(Gi)),
  E(3, Inject(Ls)),
  E(4, Inject(Wt)),
  E(5, Inject(Fn)),
  E(6, ic)
], D);
var ze = "SHEET_NUMFMT_PLUGIN";
var ke = Object.defineProperty;
var Ye = Object.getOwnPropertyDescriptor;
var qe = (e, n, t) => n in e ? ke(e, n, { enumerable: true, configurable: true, writable: true, value: t }) : e[n] = t;
var Xe = (e, n, t, r) => {
  for (var s = r > 1 ? void 0 : r ? Ye(n, t) : n, a = e.length - 1, l; a >= 0; a--)
    (l = e[a]) && (s = l(s) || s);
  return s;
};
var B = (e, n) => (t, r) => n(t, r, e);
var oe = (e, n, t) => qe(e, typeof n != "symbol" ? n + "" : n, t);
var A = class extends Ol {
  constructor(e = X, n, t, r) {
    super(), this._config = e, this._injector = n, this._configService = t, this._commandService = r;
    const { ...s } = oo(
      {},
      X,
      this._config
    );
    this._configService.setConfig(se, s);
  }
  onStarting() {
    GC(this._injector, [
      [D]
    ]), zc(this._injector, [
      [D]
    ]);
  }
  onRendered() {
    [
      Ve2,
      Be,
      je,
      Le,
      O
    ].forEach((e) => {
      this.disposeWithMe(this._commandService.registerCommand(e));
    });
  }
};
oe(A, "pluginName", ze);
oe(A, "type", we.UNIVER_SHEET);
A = Xe([
  qR(ss),
  B(1, Inject(Injector)),
  B(2, ic),
  B(3, Ls)
], A);
var ot = (e) => re.find((t) => e.includes(t));
var at = () => re.map((e) => ({ label: e, value: e }));
var it = (e) => Ae.map((n) => ({
  label: n.label(e),
  value: n.suffix(e),
  color: n.color
}));
var ct = () => Fe.map((e) => ({ label: e.label, value: e.suffix }));
var lt = () => De.map((e) => ({ label: e.label, value: e.suffix, color: e.color }));

export {
  re,
  w,
  xe,
  Y,
  Pe,
  Fe,
  De,
  Ae,
  P2 as P,
  q,
  F,
  rt,
  O,
  Ve2 as Ve,
  je,
  Le,
  Be,
  se,
  st,
  He,
  Ge,
  D,
  A,
  ot,
  at,
  it,
  ct,
  lt
};
//# sourceMappingURL=chunk-6335LBDU.js.map
