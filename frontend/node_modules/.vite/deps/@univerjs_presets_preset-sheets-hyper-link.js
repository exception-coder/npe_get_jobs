import {
  At,
  Fn,
  Un,
  Vt,
  Xe,
  Z,
  at,
  ce,
  qe
} from "./chunk-ST7J4VGM.js";
import "./chunk-ZKTLMAEM.js";
import {
  Ct,
  D,
  E,
  It,
  Mt,
  N,
  R,
  Rt,
  St,
  _e,
  de,
  te,
  ve,
  wt,
  ye
} from "./chunk-P747PEZ4.js";
import "./chunk-VAEXAE3K.js";
import {
  C,
  S,
  k
} from "./chunk-FOCXVU2X.js";
import "./chunk-RWMUFXJB.js";
import "./chunk-DZMX4FYO.js";
import "./chunk-I7I3GTAS.js";
import {
  I,
  j
} from "./chunk-YFGUMDM2.js";
import {
  Inject,
  KC,
  Ls,
  ct,
  et,
  pn
} from "./chunk-RGZYGL3P.js";
import "./chunk-DC5AMYBS.js";

// node_modules/@univerjs/sheets-hyper-link/lib/es/facade.js
var I2 = Object.getOwnPropertyDescriptor;
var E2 = (s, e, i, r) => {
  for (var n = r > 1 ? void 0 : r ? I2(e, i) : e, t = s.length - 1, o; t >= 0; t--)
    (o = s[t]) && (n = o(n) || n);
  return n;
};
var H = (s, e) => (i, r) => e(i, r, s);
var m = class {
  constructor(s, e) {
    this._workbook = s, this._parserService = e;
  }
  getRangeUrl(s) {
    return this._parserService.buildHyperLink(this._workbook.getId(), s.getSheetId(), s.getRange()), this;
  }
};
m = E2([
  H(1, Inject(ve))
], m);
var U = class extends C {
  createSheetHyperlink(e, i) {
    return this._injector.get(ve).buildHyperLink(this.getId(), e, i);
  }
  /**
   * Parse the hyperlink string to get the hyperlink info.
   * @param {string} hyperlink the hyperlink string
   * @returns {ISheetHyperLinkInfo} the hyperlink info
   */
  parseSheetHyperlink(e) {
    return this._injector.get(ve).parseHyperLink(e);
  }
};
C.extend(U);
var R2 = class extends S {
  getUrl() {
    return this._injector.get(ve).buildHyperLink(this._workbook.getUnitId(), this._worksheet.getSheetId());
  }
};
S.extend(R2);
var T = class extends k {
  // #region hyperlink
  setHyperLink(e, i) {
    const r = {
      unitId: this.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      link: {
        row: this._range.startRow,
        column: this._range.startColumn,
        payload: e,
        display: i,
        id: et()
      }
    };
    return this._commandService.executeCommand(St.id, r);
  }
  getHyperLinks() {
    var i, r, n;
    const e = this._worksheet.getCellRaw(this._range.startRow, this._range.startColumn);
    return e != null && e.p ? (n = (r = (i = e.p.body) == null ? void 0 : i.customRanges) == null ? void 0 : r.filter((t) => t.rangeType === pn.HYPERLINK).map((t) => {
      var o, h, c, l2, k2;
      return {
        id: `${t.rangeId}`,
        startIndex: t.startIndex,
        endIndex: t.endIndex,
        url: (h = (o = t.properties) == null ? void 0 : o.url) != null ? h : "",
        label: (k2 = (l2 = (c = e.p) == null ? void 0 : c.body) == null ? void 0 : l2.dataStream.slice(t.startIndex, t.endIndex + 1).replaceAll(ct.CUSTOM_RANGE_START, "").replaceAll(ct.CUSTOM_RANGE_END, "")) != null ? k2 : ""
      };
    })) != null ? n : [] : [];
  }
  updateHyperLink(e, i, r) {
    const n = {
      unitId: this.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      row: this._range.startRow,
      column: this._range.startColumn,
      id: e,
      payload: {
        payload: i,
        display: r
      }
    };
    return this._commandService.executeCommand(Ct.id, n);
  }
  cancelHyperLink(e) {
    const i = {
      unitId: this.getUnitId(),
      subUnitId: this._worksheet.getSheetId(),
      row: this._range.startRow,
      column: this._range.startColumn,
      id: e
    };
    return this._commandService.syncExecuteCommand(It.id, i);
  }
  getUrl() {
    return this._injector.get(ve).buildHyperLink(this.getUnitId(), this.getSheetId(), this.getRange());
  }
  // #endregion
};
k.extend(T);
var B = class {
  get BeforeSheetLinkAdd() {
    return "BeforeSheetLinkAdd";
  }
  get BeforeSheetLinkCancel() {
    return "BeforeSheetLinkCancel";
  }
  get BeforeSheetLinkUpdate() {
    return "BeforeSheetLinkUpdate";
  }
};
j.extend(B);
var A = class extends I {
  /**
   * @ignore
   */
  _initialize(e) {
    const i = e.get(Ls);
    this.registerEventHandler(
      this.Event.BeforeSheetLinkAdd,
      () => i.beforeCommandExecuted((r) => {
        if (r.id !== St.id) return;
        const n = this.getCommandSheetTarget(r);
        if (!n) return;
        const t = r.params, o = {
          workbook: n.workbook,
          worksheet: n.worksheet,
          row: t.link.row,
          col: t.link.column,
          link: t.link
        };
        if (this.fireEvent(this.Event.BeforeSheetLinkAdd, o), o.cancel)
          throw new KC();
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetLinkUpdate,
      () => i.beforeCommandExecuted((r) => {
        if (r.id !== Ct.id) return;
        const n = this.getCommandSheetTarget(r);
        if (!n) return;
        const t = r.params, o = {
          workbook: n.workbook,
          worksheet: n.worksheet,
          row: t.row,
          column: t.column,
          id: t.id,
          payload: t.payload
        };
        if (this.fireEvent(this.Event.BeforeSheetLinkUpdate, o), o.cancel)
          throw new KC();
      })
    ), this.registerEventHandler(
      this.Event.BeforeSheetLinkCancel,
      () => i.beforeCommandExecuted((r) => {
        if (r.id !== It.id) return;
        const n = this.getCommandSheetTarget(r);
        if (!n) return;
        const t = r.params, o = {
          workbook: n.workbook,
          worksheet: n.worksheet,
          row: t.row,
          column: t.column,
          id: t.id
        };
        if (this.fireEvent(this.Event.BeforeSheetLinkCancel, o), o.cancel)
          throw new KC();
      })
    );
  }
};
I.extend(A);

// node_modules/@univerjs/sheets-hyper-link-ui/lib/es/facade.js
var p = class extends U {
  // TODO: this should be migrated back to hyperlink ui plugin
  navigateToSheetHyperlink(e) {
    const r = this._injector.get(ve), o = this._injector.get(ce), i = r.parseHyperLink(e);
    o.navigate(i);
  }
};
C.extend(p);

// node_modules/@univerjs/preset-sheets-hyper-link/lib/es/index.js
function l(r = {}) {
  const { urlHandler: e } = r;
  return {
    plugins: [
      de,
      [at, {
        urlHandler: e
      }]
    ].filter((i) => !!i)
  };
}
export {
  St as AddHyperLinkCommand,
  D as AddHyperLinkMutation,
  Rt as AddRichHyperLinkCommand,
  It as CancelHyperLinkCommand,
  Mt as CancelRichHyperLinkCommand,
  Xe as CloseHyperLinkPopupOperation,
  te as ERROR_RANGE,
  R as HyperLinkModel,
  Vt as InsertHyperLinkOperation,
  Fn as InsertLinkShortcut,
  At as OpenHyperLinkEditPanelOperation,
  N as RemoveHyperLinkMutation,
  E as SheetHyperLinkType,
  qe as SheetsHyperLinkCopyPasteController,
  ve as SheetsHyperLinkParserService,
  Z as SheetsHyperLinkPopupService,
  ce as SheetsHyperLinkResolverService,
  Un as SheetsHyperLinkSidePanelService,
  de as UniverSheetsHyperLinkPlugin,
  l as UniverSheetsHyperLinkPreset,
  at as UniverSheetsHyperLinkUIPlugin,
  Ct as UpdateHyperLinkCommand,
  _e as UpdateHyperLinkMutation,
  ye as UpdateHyperLinkRefMutation,
  wt as UpdateRichHyperLinkCommand
};
//# sourceMappingURL=@univerjs_presets_preset-sheets-hyper-link.js.map
