import {
  $1,
  A,
  A2,
  B0,
  D1,
  F,
  H2,
  I,
  K,
  L,
  L2,
  M,
  M1,
  N0,
  N2,
  O1,
  P1,
  Q,
  S,
  S1 as S12,
  T0,
  U0,
  V0,
  V1,
  W1,
  Z2,
  a2,
  f1,
  f2,
  i2,
  j2,
  k,
  k0,
  k2,
  o2,
  r1,
  r2,
  s1 as s12,
  s2,
  w2,
  y1
} from "./chunk-O4VVQILI.js";
import {
  Cc,
  Wr
} from "./chunk-RWMUFXJB.js";
import {
  B1,
  Bi,
  Dn,
  H1,
  Hr,
  Le as Le2,
  S1,
  U1,
  Yn2 as Yn,
  Yy,
  et2,
  fe,
  g5,
  he,
  nn,
  pR,
  r7,
  ue,
  useDependency,
  useObservable,
  we as we2,
  wr2 as wr,
  zt,
  zy
} from "./chunk-DZMX4FYO.js";
import {
  Dr,
  Ft,
  G,
  Ht2 as Ht,
  Le,
  Ls2,
  ME,
  P,
  Pe,
  Ro,
  Sh,
  Ve as Ve2,
  Ws2 as Ws,
  Zo,
  ht,
  ie as ie3,
  kh,
  ku,
  ms,
  mu,
  og,
  pn2 as pn,
  qn,
  xt,
  yr,
  z
} from "./chunk-I7I3GTAS.js";
import {
  LE,
  Rp,
  TE,
  Vx,
  em,
  ib,
  ie as ie2,
  kE,
  kt,
  require_jsx_runtime,
  require_react,
  sE,
  vf as vf2,
  vr as vr2,
  xE
} from "./chunk-YFGUMDM2.js";
import {
  $R,
  En,
  Fn,
  GC,
  Inject,
  Injector,
  J,
  Ls,
  Ms,
  Observable,
  Ol,
  Or,
  Ve,
  We,
  ZC,
  bt,
  bufferTime,
  debounceTime,
  et,
  filter,
  ic,
  ie,
  merge,
  oo,
  pt,
  qC,
  qR,
  s1,
  sr,
  vf,
  vr,
  we,
  zc
} from "./chunk-RGZYGL3P.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/@univerjs/sheets-conditional-formatting-ui/lib/es/index.js
var import_jsx_runtime = __toESM(require_jsx_runtime());
var import_react = __toESM(require_react());
var ar = Object.defineProperty;
var lr = (t, e, n) => e in t ? ar(t, e, { enumerable: true, configurable: true, writable: true, value: n }) : t[e] = n;
var Ie = (t, e, n) => lr(t, typeof e != "symbol" ? e + "" : e, n);
var On = {
  type: Ms.COMMAND,
  id: "sheet.command.add-average-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i, operator: o } = e, s = t.get(M), d = t.get(Ls), a = t.get(vr), h = P(a);
    if (!h) return false;
    const { unitId: l, subUnitId: u } = h, v = s.createCfId(l, u), p = {
      ranges: n,
      cfId: v,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.average,
        operator: o,
        style: r
      }
    };
    return d.executeCommand(a2.id, { unitId: l, subUnitId: u, rule: p });
  }
};
var $n = {
  type: Ms.COMMAND,
  id: "sheet.command.add-color-scale-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, config: r, stopIfTrue: i } = e, o = t.get(M), s = t.get(Ls), d = t.get(vr), a = P(d);
    if (!a) return false;
    const { unitId: h, subUnitId: l } = a, u = o.createCfId(h, l), v = {
      ranges: n,
      cfId: u,
      stopIfTrue: !!i,
      rule: {
        type: S.colorScale,
        config: r
      }
    };
    return s.executeCommand(a2.id, { unitId: h, subUnitId: l, rule: v });
  }
};
var Dn2 = {
  type: Ms.COMMAND,
  id: "sheet.command.add-data-bar-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, min: r, max: i, nativeColor: o, positiveColor: s, isGradient: d, stopIfTrue: a, isShowValue: h } = e, l = t.get(M), u = t.get(vr), v = P(u);
    if (!v) return false;
    const { unitId: p, subUnitId: y } = v, f = t.get(Ls), w = l.createCfId(p, y), I2 = {
      ranges: n,
      cfId: w,
      stopIfTrue: !!a,
      rule: {
        type: S.dataBar,
        isShowValue: h,
        config: {
          min: r,
          max: i,
          nativeColor: o,
          positiveColor: s,
          isGradient: d
        }
      }
    };
    return f.executeCommand(a2.id, { unitId: p, subUnitId: y, rule: I2 });
  }
};
var An = {
  type: Ms.COMMAND,
  id: "sheet.command.add-duplicate-values-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i } = e, o = t.get(M), s = t.get(Ls), d = t.get(vr), a = P(d);
    if (!a) return false;
    const { unitId: h, subUnitId: l } = a, u = o.createCfId(h, l), v = {
      ranges: n,
      cfId: u,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.duplicateValues,
        style: r
      }
    };
    return s.executeCommand(a2.id, { unitId: h, subUnitId: l, rule: v });
  }
};
var Hn = {
  type: Ms.COMMAND,
  id: "sheet.command.add-number-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i, operator: o, value: s } = e, d = t.get(M), a = t.get(Ls), h = t.get(vr), l = P(h);
    if (!l) return false;
    const { unitId: u, subUnitId: v } = l, p = d.createCfId(u, v);
    let y;
    if ([F.between, F.notBetween].includes(o)) {
      const f = s;
      if (f.length !== 2 || !Array.isArray(f))
        return false;
      y = {
        ranges: n,
        cfId: p,
        stopIfTrue: !!i,
        rule: {
          type: S.highlightCell,
          subType: A.number,
          operator: o,
          style: r,
          value: f
        }
      };
    } else {
      const f = s;
      if (typeof f != "number")
        return false;
      y = {
        ranges: n,
        cfId: p,
        stopIfTrue: !!i,
        rule: {
          type: S.highlightCell,
          subType: A.number,
          operator: o,
          style: r,
          value: f
        }
      };
    }
    return a.executeCommand(a2.id, { unitId: u, subUnitId: v, rule: y });
  }
};
var jn = {
  type: Ms.COMMAND,
  id: "sheet.command.add-rank-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i, isPercent: o, isBottom: s, value: d } = e, a = t.get(M), h = t.get(vr), l = t.get(Ls), u = P(h);
    if (!u) return false;
    const { unitId: v, subUnitId: p } = u, y = a.createCfId(v, p), f = {
      ranges: n,
      cfId: y,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.rank,
        isPercent: o,
        isBottom: s,
        style: r,
        value: d
      }
    };
    return l.executeCommand(a2.id, { unitId: v, subUnitId: p, rule: f });
  }
};
var Bn = {
  type: Ms.COMMAND,
  id: "sheet.command.add-text-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i, operator: o, value: s } = e, d = t.get(M), a = t.get(vr), h = P(a);
    if (!h) return false;
    const { unitId: l, subUnitId: u } = h, v = t.get(Ls), p = d.createCfId(l, u), y = {
      ranges: n,
      cfId: p,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.text,
        operator: o,
        style: r,
        value: s
      }
    };
    return v.executeCommand(a2.id, { unitId: l, subUnitId: u, rule: y });
  }
};
var Wn = {
  type: Ms.COMMAND,
  id: "sheet.command.add-time-period-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i, operator: o } = e, s = t.get(M), d = t.get(vr), a = t.get(Ls), h = P(d);
    if (!h) return false;
    const { unitId: l, subUnitId: u } = h, v = s.createCfId(l, u), p = {
      ranges: n,
      cfId: v,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.timePeriod,
        operator: o,
        style: r
      }
    };
    return a.executeCommand(a2.id, { unitId: l, subUnitId: u, rule: p });
  }
};
var qn2 = {
  type: Ms.COMMAND,
  id: "sheet.command.add-uniqueValues-conditional-rule",
  handler(t, e) {
    if (!e)
      return false;
    const { ranges: n, style: r, stopIfTrue: i } = e, o = t.get(M), s = t.get(vr), d = t.get(Ls), a = P(s);
    if (!a) return false;
    const { unitId: h, subUnitId: l } = a, u = o.createCfId(h, l), v = {
      ranges: n,
      cfId: u,
      stopIfTrue: !!i,
      rule: {
        type: S.highlightCell,
        subType: A.uniqueValues,
        style: r
      }
    };
    return d.executeCommand(a2.id, { unitId: h, subUnitId: l, rule: v });
  }
};
function de({ ref: t, ...e }) {
  const { icon: n, id: r, className: i, extend: o, ...s } = e, d = `univerjs-icon univerjs-icon-${r} ${i || ""}`.trim(), a = (0, import_react.useRef)(`_${di()}`);
  return Gn(n, `${r}`, {
    defIds: n.defIds,
    idSuffix: a.current
  }, {
    ref: t,
    className: d,
    ...s
  }, o);
}
function Gn(t, e, n, r, i) {
  return (0, import_react.createElement)(t.tag, {
    key: e,
    ...ci(t, n, i),
    ...r
  }, (ui(t, n).children || []).map((o, s) => Gn(o, `${e}-${t.tag}-${s}`, n, void 0, i)));
}
function ci(t, e, n) {
  const r = { ...t.attrs };
  n != null && n.colorChannel1 && r.fill === "colorChannel1" && (r.fill = n.colorChannel1), t.tag === "mask" && r.id && (r.id = r.id + e.idSuffix), Object.entries(r).forEach(([o, s]) => {
    o === "mask" && typeof s == "string" && (r[o] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  });
  const { defIds: i } = e;
  return !i || i.length === 0 || (t.tag === "use" && r["xlink:href"] && (r["xlink:href"] = r["xlink:href"] + e.idSuffix), Object.entries(r).forEach(([o, s]) => {
    typeof s == "string" && (r[o] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  })), r;
}
function ui(t, e) {
  var r;
  const { defIds: n } = e;
  return !n || n.length === 0 ? t : t.tag === "defs" && ((r = t.children) != null && r.length) ? {
    ...t,
    children: t.children.map((i) => typeof i.attrs.id == "string" && n && n.includes(i.attrs.id) ? {
      ...i,
      attrs: {
        ...i.attrs,
        id: i.attrs.id + e.idSuffix
      }
    } : i)
  } : t;
}
function di() {
  return Math.random().toString(36).substring(2, 8);
}
de.displayName = "UniverIcon";
var hi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M4.65791 1.30005C3.77355 1.30005 3.05664 2.01696 3.05664 2.90132V12.8588C3.05664 13.8755 3.88086 14.6998 4.89759 14.6998H9.1016C11.2233 14.6998 12.9433 12.9798 12.9433 10.8581C12.9433 9.13925 11.8145 7.68407 10.2578 7.1934C10.8806 6.56856 11.2655 5.70659 11.2655 4.75472C11.2655 2.84676 9.71883 1.30005 7.81087 1.30005H4.65791ZM4.25664 2.90132C4.25664 2.6797 4.4363 2.50005 4.65791 2.50005H7.81087C9.05609 2.50005 10.0655 3.5095 10.0655 4.75472C10.0655 5.99993 9.05609 7.00938 7.81087 7.00938H4.25664V2.90132ZM4.25664 12.8588V8.21636H9.1016C10.5606 8.21636 11.7433 9.39909 11.7433 10.8581C11.7433 12.317 10.5606 13.4998 9.1016 13.4998H4.89759C4.5436 13.4998 4.25664 13.2128 4.25664 12.8588Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Zn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "bold-icon",
    ref: n,
    icon: hi
  }));
});
Zn.displayName = "BoldIcon";
var vi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var vt = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "delete-icon",
    ref: n,
    icon: vi
  }));
});
vt.displayName = "DeleteIcon";
var gi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"
    }
  }]
};
var zn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "increase-icon",
    ref: n,
    icon: gi
  }));
});
zn.displayName = "IncreaseIcon";
var mi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M9.80385 1.40005H11.9997C12.3311 1.40005 12.5997 1.66868 12.5997 2.00005C12.5997 2.33143 12.3311 2.60005 11.9997 2.60005H10.1185L7.12251 13.4001H9.33324C9.66461 13.4001 9.93324 13.6687 9.93324 14.0001C9.93324 14.3314 9.66461 14.6001 9.33324 14.6001H6.34785C6.33847 14.6003 6.32905 14.6003 6.31962 14.6001H3.9999C3.66853 14.6001 3.3999 14.3314 3.3999 14.0001C3.3999 13.6687 3.66853 13.4001 3.9999 13.4001H5.87719L8.87322 2.60005H6.66641C6.33504 2.60005 6.06641 2.33143 6.06641 2.00005C6.06641 1.66868 6.33504 1.40005 6.66641 1.40005H9.52916C9.61698 1.37929 9.71064 1.3781 9.80385 1.40005Z"
    }
  }]
};
var Yn2 = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "italic-icon",
    ref: n,
    icon: mi
  }));
});
Yn2.displayName = "ItalicIcon";
var fi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Gt = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "more-down-icon",
    ref: n,
    icon: fi
  }));
});
Gt.displayName = "MoreDownIcon";
var pi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6 5C6.55228 5 7 4.55228 7 4C7 3.44772 6.55228 3 6 3C5.44772 3 5 3.44772 5 4C5 4.55228 5.44772 5 6 5Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6 9C6.55228 9 7 8.55229 7 8C7 7.44772 6.55228 7 6 7C5.44772 7 5 7.44772 5 8C5 8.55229 5.44772 9 6 9Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M7 12C7 12.5523 6.55228 13 6 13C5.44772 13 5 12.5523 5 12C5 11.4477 5.44772 11 6 11C6.55228 11 7 11.4477 7 12Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M10 5C10.5523 5 11 4.55228 11 4C11 3.44772 10.5523 3 10 3C9.44771 3 9 3.44772 9 4C9 4.55228 9.44771 5 10 5Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M11 8C11 8.55229 10.5523 9 10 9C9.44771 9 9 8.55229 9 8C9 7.44772 9.44771 7 10 7C10.5523 7 11 7.44772 11 8Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M10 13C10.5523 13 11 12.5523 11 12C11 11.4477 10.5523 11 10 11C9.44771 11 9 11.4477 9 12C9 12.5523 9.44771 13 10 13Z"
      }
    }
  ]
};
var Kn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "sequence-icon",
    ref: n,
    icon: pi
  }));
});
Kn.displayName = "SequenceIcon";
var Ci = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.00033 1.20996C6.43345 1.20996 5.23596 1.88077 4.64804 2.94304C4.06338 3.99943 4.15123 5.32084 4.90099 6.47062C5.08199 6.7482 5.45374 6.82648 5.73131 6.64548C6.00888 6.46448 6.08716 6.09273 5.90616 5.81516C5.36418 4.98402 5.35768 4.13897 5.69797 3.52412C6.035 2.91515 6.78176 2.40996 8.00033 2.40996C9.19423 2.40996 10.0017 2.93409 10.5236 3.46755C10.7871 3.73682 10.9756 4.00712 11.0974 4.20903C11.158 4.30951 11.2013 4.39164 11.2284 4.44625C11.2419 4.47351 11.2514 4.49377 11.2568 4.50588L11.2621 4.51771C11.3901 4.82216 11.7407 4.96686 12.046 4.83992C12.3519 4.71267 12.4968 4.36149 12.3695 4.05552L11.8231 4.28278C12.3695 4.05552 12.3697 4.0558 12.3695 4.05552L12.3691 4.05437L12.3685 4.05298L12.367 4.04953L12.3629 4.03993L12.3498 4.01036C12.3388 3.98619 12.3234 3.95326 12.3033 3.91282C12.2632 3.83203 12.2043 3.72072 12.1249 3.58908C11.9666 3.32674 11.7235 2.97805 11.3814 2.62834C10.6921 1.92381 9.59192 1.20996 8.00033 1.20996Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M2.11953 8.5999H7.88935C10.1109 9.46549 10.5895 10.7649 10.4268 11.6869C10.2475 12.703 9.26939 13.5898 8.00009 13.5898C6.63323 13.5898 5.77631 13.0502 5.25534 12.528C4.99021 12.2623 4.80823 11.9965 4.69365 11.7993C4.63659 11.7011 4.59698 11.6211 4.5727 11.5686C4.56059 11.5424 4.55236 11.5231 4.54774 11.512L4.54352 11.5016C4.4267 11.193 4.0823 11.0363 3.77279 11.1516C3.46228 11.2673 3.30438 11.6129 3.4201 11.9234L3.9649 11.7203C3.4201 11.9234 3.41998 11.9231 3.4201 11.9234L3.4206 11.9247L3.42118 11.9263L3.42262 11.9301L3.42661 11.9403C3.42977 11.9484 3.43394 11.9588 3.43914 11.9713C3.44956 11.9965 3.46418 12.0304 3.48334 12.0719C3.52161 12.1547 3.57828 12.2682 3.65608 12.4021C3.81124 12.6692 4.0534 13.0223 4.40584 13.3756C5.12 14.0914 6.27196 14.7898 8.00009 14.7898C9.82574 14.7898 11.3236 13.5101 11.6085 11.8955C11.812 10.7422 11.3901 9.55402 10.2665 8.5999H13.8804C14.2117 8.5999 14.4803 8.33127 14.4803 7.9999C14.4803 7.66853 14.2117 7.3999 13.8804 7.3999H8.01411C8.0048 7.39968 7.99551 7.39969 7.98625 7.3999H2.11953C1.78816 7.3999 1.51953 7.66853 1.51953 7.9999C1.51953 8.33127 1.78816 8.5999 2.11953 8.5999Z"
    }
  }]
};
var Xn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "strikethrough-icon",
    ref: n,
    icon: Ci
  }));
});
Xn.displayName = "StrikethroughIcon";
var yi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M4.46416 2.03237C4.46416 1.701 4.19553 1.43237 3.86416 1.43237C3.53279 1.43237 3.26416 1.701 3.26416 2.03237V7.33338C3.26416 10.0313 5.35834 12.2667 7.9999 12.2667C10.6415 12.2667 12.7356 10.0313 12.7356 7.33338V2.03237C12.7356 1.701 12.467 1.43237 12.1356 1.43237C11.8043 1.43237 11.5356 1.701 11.5356 2.03237V7.33338C11.5356 9.42194 9.92656 11.0667 7.9999 11.0667C6.07325 11.0667 4.46416 9.42194 4.46416 7.33338V2.03237Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M2.66641 13.4663C2.33504 13.4663 2.06641 13.7349 2.06641 14.0663C2.06641 14.3977 2.33504 14.6663 2.66641 14.6663H13.3331C13.6644 14.6663 13.9331 14.3977 13.9331 14.0663C13.9331 13.7349 13.6644 13.4663 13.3331 13.4663H2.66641Z"
    }
  }]
};
var Jn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "underline-icon",
    ref: n,
    icon: yi
  }));
});
Jn.displayName = "UnderlineIcon";
var bi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "colorChannel1",
      d: "M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M10.3014 1.70389C9.85268 0.479568 8.12109 0.479557 7.67238 1.70389L4.72235 9.75326C4.60832 10.0644 4.76811 10.4091 5.07924 10.5231C5.39038 10.6371 5.73504 10.4773 5.84907 10.1662L6.99975 7.02646C7.03588 7.03324 7.07314 7.03679 7.11123 7.03679H10.9778L12.1247 10.1662C12.2387 10.4773 12.5834 10.6371 12.8945 10.5231C13.2057 10.4091 13.3654 10.0644 13.2514 9.75326L10.3014 1.70389ZM10.538 5.83679L9.17467 2.11682C9.11057 1.94192 8.8632 1.94192 8.7991 2.11682L7.43576 5.83679H10.538Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Qn = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "font-color-double-icon",
    ref: n,
    icon: bi
  }));
});
Qn.displayName = "FontColorDoubleIcon";
var Ii = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"
      }
    }
  ]
};
var er = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "paint-bucket-double-icon",
    ref: n,
    icon: Ii
  }));
});
er.displayName = "PaintBucketDoubleIcon";
var Si = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 17",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M2.27177 13.714L13.5855 2.40025L14.434 3.24878L3.1203 14.5625L2.27177 13.714Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "colorChannel1",
      d: "M4.2603 1.82495L2.89617 1.82495C2.23343 1.82495 1.69617 2.36221 1.69617 3.02495L1.69617 4.38908L3.02617 4.38908L3.02617 3.15495L4.2603 3.15495L4.2603 1.82495ZM15.0092 4.38908L15.0092 3.02495C15.0092 2.36221 14.4719 1.82495 13.8092 1.82495L12.4451 1.82495L12.4451 3.15495L13.6792 3.15495L13.6792 4.38908L15.0092 4.38908ZM6.98856 1.82495L6.98856 3.15495L9.71681 3.15495L9.71681 1.82495L6.98856 1.82495ZM15.0092 7.11734L13.6792 7.11734L13.6792 9.84559L15.0092 9.84559L15.0092 7.11734ZM15.0092 12.5739L13.6792 12.5739L13.6792 13.808L12.4451 13.808L12.4451 15.138L13.8092 15.138C14.4719 15.138 15.0092 14.6007 15.0092 13.938L15.0092 12.5739ZM9.71681 15.138L9.71681 13.808L6.98856 13.808L6.98856 15.138L9.71681 15.138ZM4.2603 15.138L4.2603 13.808L3.02617 13.808L3.02617 12.5739L1.69617 12.5739L1.69617 13.938C1.69617 14.6007 2.23343 15.138 2.89617 15.138L4.2603 15.138ZM1.69617 9.8456L3.02617 9.8456L3.02617 7.11734L1.69617 7.11734L1.69617 9.8456Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var ot = (0, import_react.forwardRef)(function(e, n) {
  return (0, import_react.createElement)(de, Object.assign({}, e, {
    id: "slash-double-icon",
    ref: n,
    icon: Si
  }));
});
ot.displayName = "SlashDoubleIcon";
var ke = (t) => {
  const { color: e, onChange: n, disable: r = false, Icon: i = er, className: o } = t, s = (0, import_react.useMemo)(() => new bt(e), [e]), d = () => {
    const a = {
      className: ie2("univer-fill-primary-600", r && o),
      extend: { colorChannel1: s.isValid ? e : "" }
    };
    return (0, import_jsx_runtime.jsx)(i, { ...a });
  };
  return r ? d() : (0, import_jsx_runtime.jsx)(
    vf2,
    {
      overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-rounded-lg univer-p-4", children: (0, import_jsx_runtime.jsx)(sE, { value: e, onChange: n }) }),
      children: (0, import_jsx_runtime.jsx)(
        "span",
        {
          className: ie2("univer-flex univer-cursor-pointer univer-items-center univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700", o),
          children: d()
        }
      )
    }
  );
};
var Be = (t) => {
  var o, s, d, a, h;
  const e = t.rule;
  if (!e) return null;
  const n = (0, import_react.useMemo)(() => {
    if (e.type === S.colorScale) {
      const l = e.config.map((p, y) => ({ color: new bt(p.color), value: y })), u = l.length - 1;
      return new Array(5).fill("").map((p, y, f) => y * u / (f.length - 1)).map((p) => s12(l, p));
    }
    return null;
  }, [e]), r = (0, import_react.useMemo)(() => {
    if (e.type === S.iconSet)
      return e.config.map((l) => {
        const u = f2[l.iconType];
        return u && u[Number(l.iconId)];
      });
  }, [e]), i = "univer-pointer-events-none univer-flex univer-h-5 univer-min-w-[72px] univer-items-center univer-justify-center univer-text-xs";
  switch (e.type) {
    case S.dataBar: {
      const { isGradient: l } = e.config, u = l ? `linear-gradient(to right, ${e.config.positiveColor || L2}, rgb(255 255 255))` : e.config.positiveColor, v = l ? `linear-gradient(to right,  rgb(255 255 255),${e.config.nativeColor || k2})` : e.config.nativeColor;
      return (0, import_jsx_runtime.jsxs)("div", { className: i, children: [
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: "univer-h-full univer-w-1/2 univer-border univer-border-solid",
            style: {
              background: v,
              borderColor: (o = e.config.nativeColor) != null ? o : k2
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: "univer-h-full univer-w-1/2 univer-border univer-border-solid",
            style: {
              background: u,
              borderColor: (s = e.config.positiveColor) != null ? s : L2
            }
          }
        )
      ] });
    }
    case S.colorScale:
      return n && (0, import_jsx_runtime.jsx)("div", { className: i, children: n.map((l, u) => (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-h-full",
          style: { width: `${100 / n.length}%`, background: l }
        },
        u
      )) });
    case S.iconSet:
      return r && (0, import_jsx_runtime.jsx)("div", { className: i, children: r.map((l, u) => l ? (0, import_jsx_runtime.jsx)("img", { className: "univer-h-full", src: l, draggable: false }, u) : (0, import_jsx_runtime.jsx)(ot, {}, u)) });
    case S.highlightCell: {
      const { ul: l, st: u, it: v, bl: p, bg: y, cl: f } = e.style, w = (l == null ? void 0 : l.s) === ie.TRUE, I2 = (u == null ? void 0 : u.s) === ie.TRUE, R = v === ie.TRUE, x = p === ie.TRUE, T = (d = y == null ? void 0 : y.rgb) != null ? d : V1, g = (a = f == null ? void 0 : f.rgb) != null ? a : O1, b = {
        textDecoration: (h = `${w ? "underline" : ""} ${I2 ? "line-through" : ""}`.replace(/^ /, "")) != null ? h : void 0,
        backgroundColor: T,
        color: g
      };
      return (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: ie2(i, {
            "univer-font-bold": x,
            "univer-italic": R
          }),
          style: b,
          children: "123"
        }
      );
    }
  }
};
var st = ie2("univer-mt-5 univer-px-1 univer-py-2 univer-rounded", kt);
var xe = (t, e) => ({ label: e.t(`sheet.cf.valueType.${t}`), value: t });
var Ut = (t) => {
  var y;
  const { type: e, className: n, onChange: r, id: i, value: o } = t, s = useDependency(vr), d = s.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId(), a = (y = s.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : y.getSheetId(), h = (0, import_react.useMemo)(() => String(o).startsWith("=") ? String(o) : "=", [o]), l = (0, import_react.useMemo)(() => [I.max, I.min, "none"].includes(e) ? { disabled: true } : [I.percent, I.percentile].includes(e) ? {
    min: 0,
    max: 100
  } : {
    min: Number.MIN_SAFE_INTEGER,
    max: Number.MAX_SAFE_INTEGER
  }, [e]), u = (0, import_react.useRef)(null), [v, p] = (0, import_react.useState)(false);
  return r7((f) => {
    var I2;
    ((I2 = u.current) == null ? void 0 : I2.isClickOutSide(f)) && p(false);
  }), e === I.formula ? (0, import_jsx_runtime.jsx)("div", { className: "univer-ml-1 univer-w-full", children: (0, import_jsx_runtime.jsx)(
    Cc,
    {
      ref: u,
      className: ie2("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
      initValue: h,
      unitId: d,
      subUnitId: a,
      isFocus: v,
      onChange: (f = "") => {
        r(f || "");
      },
      onFocus: () => p(true)
    }
  ) }) : (0, import_jsx_runtime.jsx)(xE, { className: n, value: Number(t.value) || 0, onChange: (f) => t.onChange(f || 0), ...l });
};
var _i = (t) => {
  var O;
  const { interceptorManager: e } = t, n = useDependency(Fn), r = ((O = t.rule) == null ? void 0 : O.type) === S.colorScale ? t.rule : void 0, i = [xe(I.num, n), xe(I.percent, n), xe(I.percentile, n), xe(I.formula, n)], o = [xe(I.min, n), ...i], s = [xe("none", n), ...i], d = [xe(I.max, n), ...i], [a, h] = (0, import_react.useState)(() => {
    var _;
    const m = I.min;
    return r && ((_ = r.config[0]) == null ? void 0 : _.value.type) || m;
  }), [l, u] = (0, import_react.useState)(() => {
    var _;
    const m = "none";
    return !r || r.config.length !== 3 ? m : ((_ = r.config[1]) == null ? void 0 : _.value.type) || m;
  }), [v, p] = (0, import_react.useState)(() => {
    var _;
    const m = I.max;
    return r && ((_ = r.config[r.config.length - 1]) == null ? void 0 : _.value.type) || m;
  }), [y, f] = (0, import_react.useState)(() => {
    if (!r)
      return 10;
    const _ = r.config[0];
    return (_ == null ? void 0 : _.value.value) === void 0 ? 10 : _ == null ? void 0 : _.value.value;
  }), [w, I2] = (0, import_react.useState)(() => {
    var j;
    if (!r || r.config.length !== 3)
      return 50;
    const _ = (j = r.config[1]) == null ? void 0 : j.value.value;
    return _ === void 0 ? 50 : _;
  }), [R, x] = (0, import_react.useState)(() => {
    var j;
    if (!r)
      return 90;
    const _ = (j = r.config[r.config.length - 1]) == null ? void 0 : j.value.value;
    return _ === void 0 ? 90 : _;
  }), [T, g] = (0, import_react.useState)(() => {
    var _;
    const m = "#d0d9fb";
    return r && ((_ = r.config[0]) == null ? void 0 : _.color) || m;
  }), [b, S2] = (0, import_react.useState)(() => {
    var _;
    const m = "#7790f3";
    return !r || r.config.length !== 3 ? m : ((_ = r.config[1]) == null ? void 0 : _.color) || m;
  }), [C, M2] = (0, import_react.useState)(() => {
    var _;
    const m = "#2e55ef";
    return r && ((_ = r.config[r.config.length - 1]) == null ? void 0 : _.color) || m;
  }), E = (0, import_react.useMemo)(() => (m) => {
    const { minType: _, medianType: j, maxType: K2, minValue: fe2, medianValue: pe, maxValue: Le3, minColor: Ue, medianColor: D, maxColor: B } = m, G2 = [];
    return G2.push({ color: Ue, value: { type: _, value: fe2 } }), j !== "none" && G2.push({ color: D, value: { type: j, value: pe } }), G2.push({ color: B, value: { type: K2, value: Le3 } }), { config: G2.map((ee, ne) => ({ ...ee, index: ne })), type: S.colorScale };
  }, []);
  (0, import_react.useEffect)(() => e.intercept(e.getInterceptPoints().submit, {
    handler() {
      return E({ minType: a, medianType: l, maxType: v, minValue: y, medianValue: w, maxValue: R, minColor: T, medianColor: b, maxColor: C });
    }
  }), [E, a, l, v, y, w, R, T, b, C, e]);
  const V = (m) => {
    t.onChange(E(m));
  };
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: n.t("sheet.cf.panel.styleRule")
      }
    ),
    (0, import_jsx_runtime.jsx)("div", { className: st, children: (0, import_jsx_runtime.jsx)(Be, { rule: E({ minType: a, medianType: l, maxType: v, minValue: y, medianValue: w, maxValue: R, minColor: T, medianColor: b, maxColor: C }) }) }),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-3 univer-text-xs univer-text-gray-600 dark:!univer-text-gray-200",
        children: n.t("sheet.cf.valueType.min")
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-h-8 univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-flex-shrink-0",
          options: o,
          value: a,
          onChange: (m) => {
            h(m);
            const _ = W1(m, 10);
            f(_), V({
              minType: m,
              medianType: l,
              maxType: v,
              minValue: _,
              medianValue: w,
              maxValue: R,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        Ut,
        {
          id: "min",
          className: "univer-ml-1",
          value: y,
          type: a,
          onChange: (m) => {
            f(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: m,
              medianValue: w,
              maxValue: R,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        ke,
        {
          className: "univer-ml-1",
          color: T,
          onChange: (m) => {
            g(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: y,
              medianValue: w,
              maxValue: R,
              minColor: m,
              medianColor: b,
              maxColor: C
            });
          }
        }
      )
    ] }),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-text-gray-600dark:!univer-text-gray-200 univer-mt-3 univer-text-xs",
        children: n.t("sheet.cf.panel.medianValue")
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-h-8 univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-flex-shrink-0",
          options: s,
          value: l,
          onChange: (m) => {
            u(m);
            const _ = W1(m, 50);
            I2(_), V({
              minType: a,
              medianType: m,
              maxType: v,
              minValue: y,
              medianValue: _,
              maxValue: R,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        Ut,
        {
          id: "median",
          className: "univer-ml-1",
          value: w,
          type: l,
          onChange: (m) => {
            I2(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: y,
              medianValue: m,
              maxValue: R,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      l !== "none" && (0, import_jsx_runtime.jsx)(
        ke,
        {
          className: "univer-ml-1",
          color: b,
          onChange: (m) => {
            S2(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: y,
              medianValue: w,
              maxValue: R,
              minColor: T,
              medianColor: m,
              maxColor: C
            });
          }
        }
      )
    ] }),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-3 univer-text-xs univer-text-gray-600 dark:!univer-text-gray-200",
        children: n.t("sheet.cf.valueType.max")
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-h-8 univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-flex-shrink-0",
          options: d,
          value: v,
          onChange: (m) => {
            p(m);
            const _ = W1(m, 90);
            x(_), V({
              minType: a,
              medianType: l,
              maxType: m,
              minValue: y,
              medianValue: w,
              maxValue: _,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        Ut,
        {
          id: "max",
          className: "univer-ml-1",
          value: R,
          type: v,
          onChange: (m) => {
            x(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: y,
              medianValue: w,
              maxValue: m,
              minColor: T,
              medianColor: b,
              maxColor: C
            });
          }
        }
      ),
      (0, import_jsx_runtime.jsx)(
        ke,
        {
          className: "univer-ml-1",
          color: C,
          onChange: (m) => {
            M2(m), V({
              minType: a,
              medianType: l,
              maxType: v,
              minValue: y,
              medianValue: w,
              maxValue: R,
              minColor: T,
              medianColor: b,
              maxColor: m
            });
          }
        }
      )
    ] })
  ] });
};
var Pe2 = (t, e) => ({ label: e.t(`sheet.cf.valueType.${t}`), value: t });
var nn2 = (t) => {
  var f;
  const { onChange: e, className: n, value: r, type: i, id: o, disabled: s = false } = t, d = useDependency(vr), a = d.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId(), h = (f = d.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : f.getSheetId(), l = (0, import_react.useRef)(null), [u, v] = (0, import_react.useState)(false);
  r7((w) => {
    var R;
    ((R = l.current) == null ? void 0 : R.isClickOutSide(w)) && v(false);
  });
  const p = (0, import_react.useRef)(r), y = (0, import_react.useMemo)(() => [I.percentile, I.percent].includes(i) ? {
    max: 100,
    min: 0
  } : {
    min: Number.MIN_SAFE_INTEGER,
    max: Number.MAX_SAFE_INTEGER
  }, [i]);
  if (i === I.formula) {
    const w = String(p.current).startsWith("=") ? String(p.current) || "" : "=";
    return (0, import_jsx_runtime.jsx)("div", { className: "univer-ml-3 univer-w-full", children: (0, import_jsx_runtime.jsx)(
      Cc,
      {
        ref: l,
        className: ie2("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
        initValue: w,
        unitId: a,
        subUnitId: h,
        isFocus: u,
        onChange: (I2 = "") => {
          e(I2 || "");
        },
        onFocus: () => v(true)
      }
    ) });
  }
  return (0, import_jsx_runtime.jsx)(
    xE,
    {
      className: n,
      value: Number(r) || 0,
      disabled: s,
      onChange: (w) => {
        e(w || 0);
      },
      ...y
    }
  );
};
var wi = (t) => {
  var O;
  const { interceptorManager: e } = t, n = useDependency(Fn), r = ((O = t.rule) == null ? void 0 : O.type) === S.dataBar ? t.rule : void 0, [i, o] = (0, import_react.useState)(() => {
    var _;
    return r && (_ = r.config) != null && _.isGradient ? "1" : "0";
  }), [s, d] = (0, import_react.useState)(() => {
    var m;
    return r ? ((m = r.config) == null ? void 0 : m.positiveColor) || L2 : L2;
  }), [a, h] = (0, import_react.useState)(() => {
    var m;
    return r ? ((m = r.config) == null ? void 0 : m.nativeColor) || k2 : k2;
  }), l = [
    Pe2(I.num, n),
    Pe2(I.percent, n),
    Pe2(I.percentile, n),
    Pe2(I.formula, n)
  ], u = [Pe2(I.min, n), ...l], v = [Pe2(I.max, n), ...l], [p, y] = (0, import_react.useState)(() => {
    var _;
    const m = u[0].value;
    return r && ((_ = r.config) == null ? void 0 : _.min.type) || m;
  }), [f, w] = (0, import_react.useState)(() => {
    var _;
    const m = v[0].value;
    return r && ((_ = r.config) == null ? void 0 : _.max.type) || m;
  }), [I2, R] = (0, import_react.useState)(() => {
    var j;
    if (!r)
      return 0;
    const _ = ((j = r.config) == null ? void 0 : j.min) || {};
    return _.type === I.formula ? _.value || "=" : _.value || 0;
  }), [x, T] = (0, import_react.useState)(() => {
    var j;
    if (!r)
      return 100;
    const _ = ((j = r.config) == null ? void 0 : j.max) || {};
    return _.type === I.formula ? _.value || "=" : _.value === void 0 ? 100 : _.value;
  }), [g, b] = (0, import_react.useState)(() => r ? r.isShowValue === void 0 ? true : !!r.isShowValue : true), S2 = (m) => ({ config: {
    min: { type: m.minValueType, value: m.minValue },
    max: { type: m.maxValueType, value: m.maxValue },
    isGradient: m.isGradient === "1",
    positiveColor: m.positiveColor || L2,
    nativeColor: m.nativeColor || k2
  }, type: S.dataBar, isShowValue: m.isShowValue });
  (0, import_react.useEffect)(() => e.intercept(e.getInterceptPoints().submit, {
    handler() {
      return S2({ isGradient: i, minValue: I2, minValueType: p, maxValue: x, maxValueType: f, positiveColor: s, nativeColor: a, isShowValue: g });
    }
  }), [i, I2, p, x, f, s, a, e, g]);
  const C = (m) => {
    t.onChange(S2(m));
  }, M2 = (m) => {
    d(m), C({
      isGradient: i,
      minValue: I2,
      minValueType: p,
      maxValue: x,
      maxValueType: f,
      positiveColor: m,
      nativeColor: a,
      isShowValue: g
    });
  }, E = (m) => {
    h(m), C({
      isGradient: i,
      minValue: I2,
      minValueType: p,
      maxValue: x,
      maxValueType: f,
      positiveColor: s,
      nativeColor: m,
      isShowValue: g
    });
  }, V = (m) => l.map((_) => _.value).includes(m);
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: n.t("sheet.cf.panel.styleRule")
      }
    ),
    (0, import_jsx_runtime.jsx)("div", { className: st, children: (0, import_jsx_runtime.jsx)(
      Be,
      {
        rule: S2({
          isGradient: i,
          minValue: I2,
          minValueType: p,
          maxValue: x,
          maxValueType: f,
          positiveColor: s,
          nativeColor: a,
          isShowValue: g
        })
      }
    ) }),
    (0, import_jsx_runtime.jsxs)("div", { children: [
      (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
          children: n.t("sheet.cf.panel.fillType")
        }
      ),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-ml-1 univer-mt-3 univer-flex univer-items-center", children: [
        (0, import_jsx_runtime.jsxs)(
          kE,
          {
            value: i,
            onChange: (m) => {
              o(m), C({
                isGradient: m,
                minValue: I2,
                minValueType: p,
                maxValue: x,
                maxValueType: f,
                positiveColor: s,
                nativeColor: a,
                isShowValue: g
              });
            },
            children: [
              (0, import_jsx_runtime.jsx)(TE, { value: "0", children: (0, import_jsx_runtime.jsx)("span", { className: "univer-text-xs", children: n.t("sheet.cf.panel.pureColor") }) }),
              (0, import_jsx_runtime.jsx)(TE, { value: "1", children: (0, import_jsx_runtime.jsx)("span", { className: "univer-text-xs", children: n.t("sheet.cf.panel.gradient") }) })
            ]
          }
        ),
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-ml-6 univer-flex univer-items-center univer-text-xs", children: [
          (0, import_jsx_runtime.jsx)(
            em,
            {
              checked: !g,
              onChange: (m) => {
                b(!m), C({
                  isGradient: m,
                  minValue: I2,
                  minValueType: p,
                  maxValue: x,
                  maxValueType: f,
                  positiveColor: s,
                  nativeColor: a,
                  isShowValue: !m
                });
              }
            }
          ),
          n.t("sheet.cf.panel.onlyShowDataBar")
        ] })
      ] })
    ] }),
    (0, import_jsx_runtime.jsxs)("div", { children: [
      (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
          children: n.t("sheet.cf.panel.colorSet")
        }
      ),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-ml-1 univer-mt-3 univer-flex univer-items-center", children: [
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center", children: [
          (0, import_jsx_runtime.jsx)("div", { className: "univer-text-xs", children: n.t("sheet.cf.panel.native") }),
          (0, import_jsx_runtime.jsx)(
            ke,
            {
              color: a,
              onChange: E
            }
          )
        ] }),
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-ml-3 univer-flex univer-items-center", children: [
          (0, import_jsx_runtime.jsx)("div", { className: "univer-text-xs", children: n.t("sheet.cf.panel.positive") }),
          (0, import_jsx_runtime.jsx)(
            ke,
            {
              color: s,
              onChange: M2
            }
          )
        ] })
      ] })
    ] }),
    (0, import_jsx_runtime.jsxs)("div", { children: [
      (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
          children: n.t("sheet.cf.valueType.min")
        }
      ),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-items-center", children: [
        (0, import_jsx_runtime.jsx)(
          LE,
          {
            className: "univer-w-1/2 univer-flex-shrink-0",
            options: u,
            value: p,
            onChange: (m) => {
              y(m);
              const _ = W1(m, 10);
              R(_), C({
                isGradient: i,
                minValue: _,
                minValueType: m,
                maxValue: x,
                maxValueType: f,
                positiveColor: s,
                nativeColor: a,
                isShowValue: g
              });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          nn2,
          {
            id: "min",
            className: "univer-ml-3",
            disabled: !V(p),
            type: p,
            value: I2,
            onChange: (m) => {
              R(m || 0), C({
                isGradient: i,
                minValue: m || 0,
                minValueType: p,
                maxValue: x,
                maxValueType: f,
                positiveColor: s,
                nativeColor: a,
                isShowValue: g
              });
            }
          }
        )
      ] }),
      (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-mt-3 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
          children: n.t("sheet.cf.valueType.max")
        }
      ),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-items-center", children: [
        (0, import_jsx_runtime.jsx)(
          LE,
          {
            className: "univer-w-1/2 univer-flex-shrink-0",
            options: v,
            value: f,
            onChange: (m) => {
              w(m);
              const _ = W1(m, 90);
              T(_), C({
                isGradient: i,
                minValue: I2,
                minValueType: p,
                maxValue: _,
                maxValueType: m,
                positiveColor: s,
                nativeColor: a,
                isShowValue: g
              });
            }
          }
        ),
        (0, import_jsx_runtime.jsx)(
          nn2,
          {
            className: "univer-ml-3",
            disabled: !V(f),
            id: "max",
            type: f,
            value: x,
            onChange: (m) => {
              T(m || 0), C({
                isGradient: i,
                minValue: I2,
                minValueType: p,
                maxValue: m || 0,
                maxValueType: f,
                positiveColor: s,
                nativeColor: a,
                isShowValue: g
              });
            }
          }
        )
      ] })
    ] })
  ] });
};
var lt = (t) => [ie.FALSE, void 0].includes(t) ? ie.TRUE : ie.FALSE;
var ct = (t) => t !== ie.FALSE;
var Zt = (t) => {
  const { style: e, onChange: n, className: r } = t, [i, o] = (0, import_react.useState)(() => {
    if (e != null && e.bl)
      return e.bl;
  }), [s, d] = (0, import_react.useState)(() => {
    if (e != null && e.it)
      return e.it;
  }), [a, h] = (0, import_react.useState)(() => {
    if (e != null && e.ul)
      return e.ul.s;
  }), [l, u] = (0, import_react.useState)(() => {
    if (e != null && e.st)
      return e.st.s;
  }), [v, p] = (0, import_react.useState)(() => {
    var R;
    const I2 = "#2f56ef";
    return (R = e == null ? void 0 : e.cl) != null && R.rgb ? e.cl.rgb : I2;
  }), [y, f] = (0, import_react.useState)(() => {
    var R;
    const I2 = "#e8ecfc";
    return (R = e == null ? void 0 : e.bg) != null && R.rgb ? e.bg.rgb : I2;
  });
  (0, import_react.useEffect)(() => {
    const I2 = {
      bl: i,
      it: s
    };
    v !== void 0 && (I2.cl = { rgb: v }), y !== void 0 && (I2.bg = { rgb: y }), l !== void 0 && (I2.st = { s: l }), a !== void 0 && (I2.ul = { s: a }), n(S12(I2));
  }, [i, s, a, l, v, y]);
  const w = "univer-flex univer-cursor-pointer univer-items-center univer-rounded univer-px-1";
  return (0, import_jsx_runtime.jsxs)("div", { className: ie2("univer-my-2.5 univer-flex univer-justify-between", r), children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: ie2(w, {
          "univer-bg-gray-100 dark:!univer-bg-gray-700": ct(i || ie.FALSE)
        }),
        onClick: () => o(lt(i)),
        children: (0, import_jsx_runtime.jsx)(Zn, {})
      }
    ),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: ie2(w, {
          "univer-bg-gray-100 dark:!univer-bg-gray-700": ct(s || ie.FALSE)
        }),
        onClick: () => d(lt(s)),
        children: (0, import_jsx_runtime.jsx)(Yn2, {})
      }
    ),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: ie2(w, {
          "univer-bg-gray-100 dark:!univer-bg-gray-700": ct(a || ie.FALSE)
        }),
        onClick: () => h(lt(a)),
        children: (0, import_jsx_runtime.jsx)(Jn, {})
      }
    ),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: ie2(w, {
          "univer-bg-gray-100 dark:!univer-bg-gray-700": ct(l || ie.FALSE)
        }),
        onClick: () => u(lt(l)),
        children: (0, import_jsx_runtime.jsx)(Xn, {})
      }
    ),
    (0, import_jsx_runtime.jsx)(ke, { color: v, onChange: p, Icon: Qn }),
    (0, import_jsx_runtime.jsx)(ke, { color: y, onChange: f })
  ] });
};
var Ri = (t) => {
  var T;
  const { onChange: e, interceptorManager: n } = t, r = useDependency(Fn), o = useDependency(vr).getCurrentUnitForType(we.UNIVER_SHEET), s = o.getActiveSheet(), d = ((T = t.rule) == null ? void 0 : T.type) === S.highlightCell ? t.rule : void 0, a = (0, import_react.useRef)(null), [h, l] = (0, import_react.useState)(false), u = (0, import_react.useRef)(null), [v, p] = (0, import_react.useState)({}), [y, f] = (0, import_react.useState)(() => (d == null ? void 0 : d.subType) === A.formula ? d.value : "="), [w, I2] = (0, import_react.useState)(void 0), R = (g) => ({
    style: g.style,
    value: y,
    type: S.highlightCell,
    subType: A.formula
  });
  (0, import_react.useEffect)(() => n.intercept(n.getInterceptPoints().submit, {
    handler() {
      return R({ style: v });
    }
  }), [v, y, n]), (0, import_react.useEffect)(() => n.intercept(n.getInterceptPoints().beforeSubmit, {
    handler: (b, S2, C) => w || y.length === 1 || !y.startsWith("=") ? (I2(r.t("sheet.cf.errorMessage.formulaError")), false) : C(b)
  }), [w, y]);
  const x = (g) => {
    e(R(g));
  };
  return r7((g) => {
    var S2;
    ((S2 = u.current) == null ? void 0 : S2.isClickOutSide(g)) && l(false);
  }), (0, import_jsx_runtime.jsxs)("div", { ref: a, children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: r.t("sheet.cf.panel.styleRule")
      }
    ),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3", children: (0, import_jsx_runtime.jsx)(
      Cc,
      {
        ref: u,
        className: ie2("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
        errorText: w,
        isFocus: h,
        initValue: y,
        unitId: o.getUnitId(),
        subUnitId: s == null ? void 0 : s.getSheetId(),
        onFocus: () => {
          l(true);
        },
        onChange: (g) => {
          f(g), x({ style: v });
        },
        onVerify: (g, b) => {
          !g || b.length === 1 ? I2(r.t("sheet.cf.errorMessage.formulaError")) : I2(void 0);
        }
      }
    ) }),
    (0, import_jsx_runtime.jsx)("div", { className: st, children: (0, import_jsx_runtime.jsx)(Be, { rule: R({ style: v }) }) }),
    (0, import_jsx_runtime.jsx)(
      Zt,
      {
        style: d == null ? void 0 : d.style,
        className: "univer-mt-3",
        onChange: (g) => {
          p(g), x({ style: g });
        }
      }
    )
  ] });
};
var ut = (t) => (0, import_jsx_runtime.jsxs)("div", { className: "univer-relative", children: [
  (0, import_jsx_runtime.jsx)(
    "div",
    {
      className: "univer-absolute univer-bottom-[-13px] univer-z-[999] univer-text-[10px] univer-text-red-500",
      children: t.errorText
    }
  ),
  t.children
] });
var W = (t, e) => ({ label: e.t(`sheet.cf.operator.${t}`), value: t });
var Ti = (t) => {
  const { type: e, operator: n, onChange: r, value: i, interceptorManager: o } = t, s = useDependency(Fn), [d, a] = (0, import_react.useState)(() => typeof i == "number" ? i : 0), [h, l] = (0, import_react.useState)(""), [u, v] = (0, import_react.useState)(() => typeof i == "string" ? i : ""), [p, y] = (0, import_react.useState)(""), [f, w] = (0, import_react.useState)(() => Array.isArray(i) ? i[0] === void 0 ? 0 : i[0] : 0), [I2, R] = (0, import_react.useState)(""), [x, T] = (0, import_react.useState)(() => Array.isArray(i) ? i[1] === void 0 ? 100 : i[1] : 100), [g, b] = (0, import_react.useState)("");
  switch ((0, import_react.useEffect)(() => {
    switch (e) {
      case A.text: {
        [L.beginsWith, L.endsWith, L.containsText, L.notContainsText, L.equal, L.notEqual].includes(n) && r(u);
        break;
      }
      case A.number: {
        [F.equal, F.notEqual, F.greaterThan, F.greaterThanOrEqual, F.lessThan, F.lessThanOrEqual].includes(n) && r(d), [F.between, F.notBetween].includes(n) && r([f, x]);
        break;
      }
    }
  }, [e]), (0, import_react.useEffect)(() => {
    const S2 = o.intercept(o.getInterceptPoints().beforeSubmit, {
      handler: (C, M2, E) => {
        switch (e) {
          case A.text:
            if ([L.beginsWith, L.containsText, L.endsWith, L.notEqual, L.notContainsText, L.equal].includes(n))
              return u ? E(C) : (y(s.t("sheet.cf.errorMessage.notBlank")), false);
        }
        return E(C);
      }
    });
    return () => {
      S2();
    };
  }, [e, d, u, n]), e) {
    case A.text: {
      if ([L.beginsWith, L.endsWith, L.containsText, L.notContainsText, L.equal, L.notEqual].includes(n)) {
        const S2 = (C) => {
          v(C), r(C);
        };
        return (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3", children: (0, import_jsx_runtime.jsx)(ut, { errorText: p, children: (0, import_jsx_runtime.jsx)(
          Vx,
          {
            value: u,
            onChange: (C) => {
              y(""), S2(C);
            }
          }
        ) }) });
      }
      break;
    }
    case A.number: {
      if ([F.equal, F.notEqual, F.greaterThan, F.greaterThanOrEqual, F.lessThan, F.lessThanOrEqual].includes(n)) {
        const S2 = (C) => {
          a(C || 0), r(C || 0), l("");
        };
        return (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3", children: (0, import_jsx_runtime.jsx)(ut, { errorText: h, children: (0, import_jsx_runtime.jsx)(
          xE,
          {
            className: "univer-w-full",
            min: Number.MIN_SAFE_INTEGER,
            max: Number.MAX_SAFE_INTEGER,
            value: d,
            onChange: S2
          }
        ) }) });
      }
      if ([F.between, F.notBetween].includes(n)) {
        const S2 = (M2) => {
          w(M2 || 0), r([M2 || 0, x]), R("");
        }, C = (M2) => {
          T(M2 || 0), r([f, M2 || 0]), b("");
        };
        return (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-items-center", children: [
          (0, import_jsx_runtime.jsx)(ut, { errorText: I2, children: (0, import_jsx_runtime.jsx)(xE, { min: Number.MIN_SAFE_INTEGER, max: Number.MAX_SAFE_INTEGER, value: f, onChange: S2 }) }),
          (0, import_jsx_runtime.jsx)(ut, { errorText: g, children: (0, import_jsx_runtime.jsx)(
            xE,
            {
              className: "univer-ml-3",
              min: Number.MIN_SAFE_INTEGER,
              max: Number.MAX_SAFE_INTEGER,
              value: x,
              onChange: C
            }
          ) })
        ] });
      }
    }
  }
  return null;
};
var rn = (t, e) => {
  switch (t) {
    case A.text:
      return [
        W(L.containsText, e),
        W(L.notContainsText, e),
        W(L.beginsWith, e),
        W(L.endsWith, e),
        W(L.equal, e),
        W(L.notEqual, e),
        W(L.containsBlanks, e),
        W(L.notContainsBlanks, e),
        W(L.containsErrors, e),
        W(L.notContainsErrors, e)
      ];
    case A.number:
      return [
        W(F.between, e),
        W(F.notBetween, e),
        W(F.equal, e),
        W(F.notEqual, e),
        W(F.greaterThan, e),
        W(F.greaterThanOrEqual, e),
        W(F.lessThan, e),
        W(F.lessThanOrEqual, e)
      ];
    case A.timePeriod:
      return [
        W(k.yesterday, e),
        W(k.today, e),
        W(k.tomorrow, e),
        W(k.last7Days, e),
        W(k.lastWeek, e),
        W(k.thisWeek, e),
        W(k.nextWeek, e),
        W(k.lastMonth, e),
        W(k.thisMonth, e),
        W(k.nextMonth, e)
      ];
  }
};
var on = (t) => {
  var T;
  const { interceptorManager: e, onChange: n } = t, r = useDependency(Fn), i = ((T = t.rule) == null ? void 0 : T.type) === S.highlightCell ? t.rule : void 0, [o, s] = (0, import_react.useState)(() => {
    const g = A.text;
    return i && i.subType || g;
  }), d = [{
    value: A.text,
    label: r.t("sheet.cf.subRuleType.text")
  }, {
    value: A.number,
    label: r.t("sheet.cf.subRuleType.number")
  }, {
    value: A.timePeriod,
    label: r.t("sheet.cf.subRuleType.timePeriod")
  }, {
    value: A.duplicateValues,
    label: r.t("sheet.cf.subRuleType.duplicateValues")
  }, {
    value: A.uniqueValues,
    label: r.t("sheet.cf.subRuleType.uniqueValues")
  }], a = (0, import_react.useMemo)(() => rn(o, r), [o]), [h, l] = (0, import_react.useState)(() => {
    const g = a ? a[0].value : void 0;
    return i && i.operator || g;
  }), [u, v] = (0, import_react.useState)(() => {
    var S2;
    return i ? (S2 = i.value) != null ? S2 : P1(i.subType, i.operator) : "";
  }), [p, y] = (0, import_react.useState)({}), f = (0, import_react.useMemo)(() => (g) => {
    var b, S2, C, M2, E, V, O, m, _, j, K2, fe2, pe, Le3, Ue;
    switch (g.subType || o) {
      case A.text: {
        if ([L.beginsWith, L.endsWith, L.containsText, L.notContainsText, L.equal, L.notEqual].includes(h))
          return {
            type: S.highlightCell,
            subType: (b = g.subType) != null ? b : o,
            operator: (S2 = g.operator) != null ? S2 : h,
            style: (C = g.style) != null ? C : p,
            value: (M2 = g.value) != null ? M2 : u
          };
        break;
      }
      case A.number: {
        if ([F.equal, F.notEqual, F.greaterThan, F.greaterThanOrEqual, F.lessThan, F.lessThanOrEqual].includes(h))
          return {
            type: S.highlightCell,
            subType: (E = g.subType) != null ? E : o,
            operator: (V = g.operator) != null ? V : h,
            style: (O = g.style) != null ? O : p,
            value: (m = g.value) != null ? m : u
          };
        if ([F.between, F.notBetween].includes(h))
          return {
            type: S.highlightCell,
            subType: (_ = g.subType) != null ? _ : o,
            operator: (j = g.operator) != null ? j : h,
            style: (K2 = g.style) != null ? K2 : p,
            value: (fe2 = g.value) != null ? fe2 : u
          };
        break;
      }
    }
    return {
      type: S.highlightCell,
      subType: (pe = g.subType) != null ? pe : o,
      operator: (Le3 = g.operator) != null ? Le3 : h,
      style: (Ue = g.style) != null ? Ue : p
    };
  }, [o, h, u, p]);
  (0, import_react.useEffect)(() => e.intercept(e.getInterceptPoints().submit, {
    handler() {
      return f({});
    }
  }), [f, e]), (0, import_react.useEffect)(() => {
    d.some((g) => g.value === o) || s(d[0].value);
  }, [d]);
  const w = (g) => {
    const b = g, S2 = rn(b, r), C = S2 && S2[0].value;
    s(b), l(C), C && v(P1(b, C)), n(f({ subType: b, operator: C }));
  }, I2 = (g) => {
    const b = g;
    l(b), n(f({ operator: b }));
  }, R = (g) => {
    v(g), n(f({ value: g }));
  }, x = (0, import_react.useMemo)(() => `${o}_${h}_${Math.random()}`, [o, h]);
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: r.t("sheet.cf.panel.styleRule")
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-justify-between univer-gap-4", children: [
      (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-mt-3 univer-w-full",
          onChange: w,
          value: o,
          options: d
        }
      ),
      (a == null ? void 0 : a.length) && (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-mt-3 univer-w-full",
          onChange: I2,
          value: h || "",
          options: a
        }
      )
    ] }),
    (0, import_jsx_runtime.jsx)(
      Ti,
      {
        value: u,
        interceptorManager: e,
        type: o,
        operator: h,
        rule: i,
        onChange: R
      },
      x
    ),
    (0, import_jsx_runtime.jsx)("div", { className: st, children: (0, import_jsx_runtime.jsx)(Be, { rule: f({}) }) }),
    (0, import_jsx_runtime.jsx)(
      Zt,
      {
        style: i == null ? void 0 : i.style,
        className: "univer-ml-1",
        onChange: (g) => {
          y(g), n(f({ style: g }));
        }
      }
    )
  ] });
};
var tr = (t, e) => (f2[t] || [])[Number(e)] || "";
var xi = (t) => {
  var l;
  const { error: e, type: n, onChange: r } = t, i = useDependency(vr), o = i.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId(), s = (l = i.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : l.getSheetId(), d = (0, import_react.useRef)(null), [a, h] = (0, import_react.useState)(false);
  return r7((u) => {
    var p;
    ((p = d.current) == null ? void 0 : p.isClickOutSide(u)) && h(false);
  }), (0, import_jsx_runtime.jsx)("div", { className: "univer-relative", children: n !== I.formula ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(
      xE,
      {
        className: ie2({
          "univer-border-red-500": e
        }),
        value: Number(t.value) || 0,
        onChange: (u) => r(u != null ? u : 0)
      }
    ),
    e && (0, import_jsx_runtime.jsx)("div", { className: "univer-absolute univer-text-xs univer-text-red-500", children: e })
  ] }) : (0, import_jsx_runtime.jsx)("div", { className: "univer-w-full", children: (0, import_jsx_runtime.jsx)(
    Cc,
    {
      ref: d,
      className: ie2("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
      initValue: String(t.value),
      unitId: o,
      subUnitId: s,
      isFocus: a,
      onChange: (u = "") => {
        r(u || "");
      },
      onFocus: () => h(true)
    }
  ) }) });
};
var sn = (t, e, n) => ({
  operator: F.greaterThan,
  value: { type: I.num, value: (n.length - 1 - e) * 10 },
  iconType: t,
  iconId: String(e)
});
var Ei = (0, import_react.forwardRef)((t, e) => {
  const { onClick: n } = t, r = useDependency(Fn), i = (o) => {
    n(o);
  };
  return (0, import_jsx_runtime.jsx)("div", { ref: e, className: "univer-w-80", children: D1.map((o, s) => (0, import_jsx_runtime.jsxs)("div", { className: "univer-mb-3", children: [
    (0, import_jsx_runtime.jsx)("div", { className: "univer-mb-1 univer-text-sm", children: r.t(o.title) }),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-flex-wrap", children: o.group.map((d) => (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mb-1 univer-flex univer-w-1/2 univer-items-center",
        onClick: () => {
          i(d.name);
        },
        children: (0, import_jsx_runtime.jsx)(
          "a",
          {
            className: "univer-cursor-pointer univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
            children: d.list.map((a, h) => (0, import_jsx_runtime.jsx)(
              "img",
              {
                className: "univer-size-5",
                src: a,
                draggable: false
              },
              h
            ))
          }
        )
      },
      d.name
    )) })
  ] }, s)) });
});
var Ni = (t) => {
  const { onClick: e } = t, n = (0, import_react.useMemo)(() => {
    const i = [];
    for (const o in f2) {
      const s = f2[o], d = o;
      s.forEach((a, h) => {
        i.push({
          iconType: d,
          base64: a,
          iconId: String(h)
        });
      });
    }
    return i;
  }, []), r = (i) => {
    e(i.iconType, i.iconId);
  };
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: "univer-mb-2.5 univer-flex univer-cursor-pointer univer-items-center univer-pl-1",
        onClick: () => r({ iconType: f1, iconId: "" }),
        children: [
          (0, import_jsx_runtime.jsx)(ot, { className: "univer-size-5" }),
          (0, import_jsx_runtime.jsx)("span", { className: "univer-ml-2", children: "" })
        ]
      }
    ),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-w-64 univer-flex-wrap", children: n.map((i) => (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mb-2 univer-mr-2 univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
        children: (0, import_jsx_runtime.jsx)(
          "img",
          {
            className: "univer-size-5",
            src: i.base64,
            draggable: false,
            onClick: () => r(i)
          }
        )
      },
      `${i.iconType}_${i.iconId}`
    )) })
  ] });
};
var Mi = (t) => {
  const { onChange: e, configList: n, errorMap: r = {} } = t, i = useDependency(Fn), o = [{ label: i.t(`sheet.cf.symbol.${F.greaterThan}`), value: F.greaterThan }, { label: i.t(`sheet.cf.symbol.${F.greaterThanOrEqual}`), value: F.greaterThanOrEqual }], s = [
    { label: i.t(`sheet.cf.valueType.${I.num}`), value: I.num },
    { label: i.t(`sheet.cf.valueType.${I.percent}`), value: I.percent },
    { label: i.t(`sheet.cf.valueType.${I.percentile}`), value: I.percentile },
    { label: i.t(`sheet.cf.valueType.${I.formula}`), value: I.formula }
  ], d = (u, v) => {
    e([String(v), "value", "value"], u);
  }, a = (u, v) => {
    e([String(v), "operator"], u);
    const p = P1(A.number, u);
    d(p, v);
  }, h = (u, v) => {
    e([String(v), "value", "type"], u);
    const p = n[v], y = P1(A.number, p.operator);
    d(y, v);
  };
  return (0, import_react.useMemo)(() => n.map((u, v) => {
    const p = r[v], y = tr(u.iconType, u.iconId), f = v === n.length - 1, w = v === 0, I2 = n[v - 1], R = (I2 == null ? void 0 : I2.value.type) === I.formula ? i.t("sheet.cf.valueType.formula") : I2 == null ? void 0 : I2.value.value, x = (T, g) => {
      const b = { ...u, iconId: g, iconType: T };
      e([String(v)], b);
    };
    return (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: v ? "univer-mt-6" : "univer-mt-3",
        children: [
          (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: "univer-mt-3 univer-flex univer-items-center univer-justify-between univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
              children: [
                (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: "univer-w-[45%]",
                    children: [
                      i.t("sheet.cf.iconSet.icon"),
                      v + 1
                    ]
                  }
                ),
                (0, import_jsx_runtime.jsx)("div", { className: "univer-w-[45%]", children: (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
                  !w && !f && i.t("sheet.cf.iconSet.rule"),
                  !w && !f && (0, import_jsx_runtime.jsxs)(
                    "span",
                    {
                      className: "univer-font-medium univer-text-gray-600 dark:!univer-text-gray-200",
                      children: [
                        i.t("sheet.cf.iconSet.when"),
                        i.t(`sheet.cf.symbol.${r1(I2.operator)}`),
                        R,
                        f ? "" : ` ${i.t("sheet.cf.iconSet.and")} `
                      ]
                    }
                  )
                ] }) })
              ]
            }
          ),
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4", children: [
            (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-items-center", children: (0, import_jsx_runtime.jsx)(
              vf2,
              {
                overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-rounded-lg univer-p-4", children: (0, import_jsx_runtime.jsx)(Ni, { onClick: x, iconId: u.iconId, iconType: u.iconType }) }),
                children: (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: ie2("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-4 univer-py-2 univer-text-xs univer-text-gray-600 univer-transition-all hover:univer-border-primary-600 dark:!univer-text-gray-200", kt),
                    children: [
                      y ? (0, import_jsx_runtime.jsx)("img", { src: y, className: "univer-size-4", draggable: false }) : (0, import_jsx_runtime.jsx)(ot, { className: "univer-size-4" }),
                      (0, import_jsx_runtime.jsx)(Gt, {})
                    ]
                  }
                )
              }
            ) }),
            f ? (0, import_jsx_runtime.jsxs)(
              "div",
              {
                className: "univer-mt-0 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
                children: [
                  i.t("sheet.cf.iconSet.rule"),
                  (0, import_jsx_runtime.jsxs)("span", { className: "univer-font-medium", children: [
                    i.t("sheet.cf.iconSet.when"),
                    i.t(`sheet.cf.symbol.${r1(I2.operator)}`),
                    R,
                    f ? "" : ` ${i.t("sheet.cf.iconSet.and")} `
                  ] })
                ]
              }
            ) : (0, import_jsx_runtime.jsx)(
              LE,
              {
                options: o,
                value: u.operator,
                onChange: (T) => {
                  a(T, v);
                }
              }
            )
          ] }),
          f ? (0, import_jsx_runtime.jsx)("div", {}) : (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
            (0, import_jsx_runtime.jsxs)(
              "div",
              {
                className: "univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
                children: [
                  (0, import_jsx_runtime.jsx)("div", { children: i.t("sheet.cf.iconSet.type") }),
                  (0, import_jsx_runtime.jsx)("div", { children: i.t("sheet.cf.iconSet.value") })
                ]
              }
            ),
            (0, import_jsx_runtime.jsxs)(
              "div",
              {
                className: "univer-mt-3 univer-grid univer-grid-cols-2 univer-gap-4",
                children: [
                  (0, import_jsx_runtime.jsx)(
                    LE,
                    {
                      options: s,
                      value: u.value.type,
                      onChange: (T) => {
                        h(T, v);
                      }
                    }
                  ),
                  (0, import_jsx_runtime.jsx)(
                    xi,
                    {
                      id: v,
                      type: u.value.type,
                      error: p,
                      value: u.value.value || "",
                      onChange: (T) => {
                        d(T, v);
                      }
                    }
                  )
                ]
              }
            )
          ] })
        ]
      },
      v
    );
  }), [n, r]);
};
var Vi = (t) => {
  var T;
  const { interceptorManager: e } = t, n = ((T = t.rule) == null ? void 0 : T.type) === S.iconSet ? t.rule : void 0, r = useDependency(Fn), [i, o] = (0, import_react.useState)({}), [s, d] = (0, import_react.useState)(() => {
    const g = Object.keys(f2)[0];
    if (n && n.config.length) {
      const b = n.config[0].iconType;
      if (!n.config.some((C) => C.iconType !== b))
        return b;
    }
    return g;
  }), [a, h] = (0, import_react.useState)(() => {
    if (n && n.config.length)
      return J.deepClone(n == null ? void 0 : n.config);
    const g = f2[s] || [];
    return new Array(g.length).fill("").map((b, S2, C) => S2 === C.length - 1 ? {
      operator: F.lessThanOrEqual,
      value: { type: I.num, value: Number.MAX_SAFE_INTEGER },
      iconType: s,
      iconId: String(S2)
    } : sn(s, S2, C));
  }), [l, u] = (0, import_react.useState)(() => n ? !!n.isShowValue : true), v = (0, import_react.useMemo)(() => {
    const g = a.map((b) => tr(b.iconType, b.iconId));
    return (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-items-center", children: g.map((b, S2) => b ? (0, import_jsx_runtime.jsx)(
      "img",
      {
        className: "univer-size-5",
        src: b
      },
      S2
    ) : (0, import_jsx_runtime.jsx)(ot, { className: "univer-size-5" }, S2)) });
  }, [a]), p = (g) => {
    if (g.reduce((S2, C, M2) => S2.preType && !S2.result || g.length - 1 === M2 ? S2 : C.value.type === I.formula ? {
      preType: I.formula,
      result: false
    } : S2.preType ? {
      result: S2.preType === C.value.type,
      preType: C.value.type
    } : {
      result: true,
      preType: C.value.type
    }, { result: true, preType: "" }).result && [I.num, I.percent, I.percentile].includes(g[0].value.type)) {
      const S2 = {};
      return g.forEach((C, M2, E) => {
        if (M2 - 1 < 0 || M2 === E.length - 1)
          return;
        const O = g[M2 - 1], m = r1(O.operator);
        r2({ operator: m, value: O.value.value }, C.value.value) || (S2[M2] = `${r.t(`sheet.cf.form.${m}`, String(O.value.value))} `);
      }), S2;
    }
    return {};
  }, y = (g, b) => {
    vf(a, g) !== b && (s1(a, g, b), h([...a]), o(p(a)));
  }, f = (g) => {
    d(g);
    const b = f2[g] || [], S2 = new Array(b.length).fill("").map((C, M2, E) => sn(g, M2, E));
    h(S2), o(p(S2));
  };
  (0, import_react.useEffect)(() => {
    const g = e.intercept(e.getInterceptPoints().submit, {
      handler() {
        return { type: S.iconSet, isShowValue: l, config: a };
      }
    });
    return () => {
      g();
    };
  }, [l, a, e]), (0, import_react.useEffect)(() => {
    const g = e.intercept(e.getInterceptPoints().beforeSubmit, {
      handler() {
        return Object.keys(i).length === 0;
      }
    });
    return () => {
      g();
    };
  }, [l, a, e, i]);
  const w = () => {
    const g = a.map((b) => ({ ...b }));
    a.forEach((b, S2) => {
      const C = a.length - 1 - S2, M2 = g[C];
      b.iconId = M2.iconId, b.iconType = M2.iconType;
    }), h([...a]);
  }, I2 = useDependency(U1), [R, x] = (0, import_react.useState)();
  return g5(R, I2.rootContainerElement), (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-4 univer-text-sm univer-text-gray-600", children: r.t("sheet.cf.panel.styleRule") }),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3", children: (0, import_jsx_runtime.jsx)(
      vf2,
      {
        overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-rounded-lg univer-p-4", children: (0, import_jsx_runtime.jsx)(
          Ei,
          {
            ref: (g) => {
              !R && g && x(g);
            },
            iconType: s,
            onClick: f
          }
        ) }),
        children: (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: ie2("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-4 univer-py-2 univer-text-xs univer-text-gray-600 univer-transition-all hover:univer-border-primary-600", kt),
            children: [
              v,
              (0, import_jsx_runtime.jsx)(Gt, {})
            ]
          }
        )
      }
    ) }),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-items-center univer-text-xs", children: [
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-text-xs", children: [
        (0, import_jsx_runtime.jsx)(em, { onChange: w }),
        r.t("sheet.cf.iconSet.reverseIconOrder")
      ] }),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-ml-6 univer-flex univer-items-center univer-text-xs", children: [
        (0, import_jsx_runtime.jsx)(em, { checked: !l, onChange: (g) => {
          u(!g);
        } }),
        r.t("sheet.cf.iconSet.onlyShowIcon")
      ] })
    ] }),
    (0, import_jsx_runtime.jsx)(Mi, { errorMap: i, onChange: y, configList: a })
  ] });
};
var ki = (t) => {
  var w;
  const { onChange: e, interceptorManager: n } = t, r = useDependency(Fn), i = ((w = t.rule) == null ? void 0 : w.type) === S.highlightCell ? t.rule : void 0, o = [{ label: r.t("sheet.cf.panel.isNotBottom"), value: "isNotBottom" }, { label: r.t("sheet.cf.panel.isBottom"), value: "isBottom" }, { label: r.t("sheet.cf.panel.greaterThanAverage"), value: "greaterThanAverage" }, { label: r.t("sheet.cf.panel.lessThanAverage"), value: "lessThanAverage" }], [s, d] = (0, import_react.useState)(() => {
    const I2 = o[0].value, R = i == null ? void 0 : i.type;
    if (!i)
      return I2;
    switch (R) {
      case S.highlightCell:
        switch (i.subType) {
          case A.average:
            return [F.greaterThan, F.greaterThanOrEqual].includes(i.operator) ? "greaterThanAverage" : [F.lessThan, F.lessThanOrEqual].includes(i.operator) ? "lessThanAverage" : I2;
          case A.rank:
            return i.isBottom ? "isBottom" : "isNotBottom";
        }
    }
    return I2;
  }), [a, h] = (0, import_react.useState)(() => {
    const R = i == null ? void 0 : i.type;
    if (!i)
      return 10;
    switch (R) {
      case S.highlightCell:
        switch (i.subType) {
          case A.rank:
            return i.value || 10;
        }
    }
    return 10;
  }), [l, u] = (0, import_react.useState)(() => {
    const R = i == null ? void 0 : i.type;
    if (!i)
      return false;
    switch (R) {
      case S.highlightCell:
        switch (i.subType) {
          case A.rank:
            return i.isPercent || false;
        }
    }
    return false;
  }), [v, p] = (0, import_react.useState)({}), y = (I2) => {
    const { type: R, isPercent: x, value: T, style: g } = I2;
    if (R === "isNotBottom")
      return { type: S.highlightCell, subType: A.rank, isPercent: x, isBottom: false, value: T, style: g };
    if (R === "isBottom")
      return { type: S.highlightCell, subType: A.rank, isPercent: x, isBottom: true, value: T, style: g };
    if (R === "greaterThanAverage")
      return { type: S.highlightCell, subType: A.average, operator: F.greaterThan, style: g };
    if (R === "lessThanAverage")
      return { type: S.highlightCell, subType: A.average, operator: F.lessThan, style: g };
  };
  (0, import_react.useEffect)(() => n.intercept(n.getInterceptPoints().submit, {
    handler() {
      return y({ type: s, isPercent: l, value: a, style: v });
    }
  }), [s, l, a, v, n]);
  const f = (I2) => {
    e(y(I2));
  };
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: r.t("sheet.cf.panel.styleRule")
      }
    ),
    (0, import_jsx_runtime.jsx)(
      LE,
      {
        className: "univer-mt-3 univer-w-full",
        value: s,
        options: o,
        onChange: (I2) => {
          d(I2), f({ type: I2, isPercent: l, value: a, style: v });
        }
      }
    ),
    ["isNotBottom", "isBottom"].includes(s) && (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-flex univer-items-center", children: [
      (0, import_jsx_runtime.jsx)(
        xE,
        {
          min: 1,
          max: 1e3,
          value: a,
          onChange: (I2) => {
            const R = I2 || 0;
            h(R), f({ type: s, isPercent: l, value: R, style: v });
          }
        }
      ),
      (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: "univer-ml-3 univer-flex univer-items-center univer-text-xs",
          children: [
            (0, import_jsx_runtime.jsx)(
              em,
              {
                checked: l,
                onChange: (I2) => {
                  u(!!I2), f({ type: s, isPercent: !!I2, value: a, style: v });
                }
              }
            ),
            r.t("sheet.cf.valueType.percent")
          ]
        }
      )
    ] }),
    (0, import_jsx_runtime.jsx)("div", { className: st, children: (0, import_jsx_runtime.jsx)(Be, { rule: y({ type: s, isPercent: l, value: a, style: v }) }) }),
    (0, import_jsx_runtime.jsx)(
      Zt,
      {
        style: i == null ? void 0 : i.style,
        className: "univer-mt-3",
        onChange: (I2) => {
          p(I2), f({ type: s, isPercent: l, value: a, style: I2 });
        }
      }
    )
  ] });
};
var Fi = qC("beforeSubmit");
var Li = qC("submit");
var an = (t) => t.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId();
var ln = (t) => {
  var e;
  return (e = t.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : e.getSheetId();
};
var Ui = (t) => {
  var S2, C, M2;
  const e = useDependency(Fn), n = useDependency(Ls), r = useDependency(vr), i = useDependency(M), o = useDependency(z), s = an(r), d = ln(r), [a, h] = (0, import_react.useState)(void 0), l = (0, import_react.useRef)((C = (S2 = t.rule) == null ? void 0 : S2.ranges) != null ? C : []), u = (0, import_react.useMemo)(() => {
    var V, O, m;
    let E = (V = t.rule) == null ? void 0 : V.ranges;
    return E != null && E.length || (E = (m = (O = o.getCurrentSelections()) == null ? void 0 : O.map((_) => _.range)) != null ? m : []), l.current = E, E != null && E.length ? E.map((_) => {
      const j = Ft(_);
      return j === "NaN" ? "" : j;
    }).filter((_) => !!_).join(",") : "";
  }, [t.rule]), v = [
    { label: e.t("sheet.cf.ruleType.highlightCell"), value: "1" },
    { label: e.t("sheet.cf.panel.rankAndAverage"), value: "2" },
    { label: e.t("sheet.cf.ruleType.dataBar"), value: "3" },
    { label: e.t("sheet.cf.ruleType.colorScale"), value: "4" },
    { label: e.t("sheet.cf.ruleType.formula"), value: "5" },
    { label: e.t("sheet.cf.ruleType.iconSet"), value: "6" }
  ], [p, y] = (0, import_react.useState)(() => {
    var O, m;
    const E = (O = t.rule) == null ? void 0 : O.rule.type, V = v[0].value;
    if (!E)
      return V;
    switch (E) {
      case S.highlightCell: {
        switch ((m = t.rule) == null ? void 0 : m.rule.subType) {
          case A.number:
          case A.text:
          case A.duplicateValues:
          case A.uniqueValues:
          case A.timePeriod:
            return "1";
          case A.average:
          case A.rank:
            return "2";
          case A.formula:
            return "5";
        }
        break;
      }
      case S.dataBar:
        return "3";
      case S.colorScale:
        return "4";
      case S.iconSet:
        return "6";
    }
    return V;
  }), f = (0, import_react.useRef)(void 0), w = (0, import_react.useMemo)(() => new ZC({ beforeSubmit: Fi, submit: Li }), []), I2 = (0, import_react.useMemo)(() => {
    switch (p) {
      case "1":
        return on;
      case "2":
        return ki;
      case "3":
        return wi;
      case "4":
        return _i;
      case "5":
        return Ri;
      case "6":
        return Vi;
      default:
        return on;
    }
  }, [p]);
  (0, import_react.useEffect)(() => {
    const E = n.onCommandExecuted((V) => {
      if (V.id === Ht.id) {
        const O = V.params;
        O.subUnitId === d && O.unitId === s && t.onCancel();
      }
      V.id === pn.id && t.onCancel();
    });
    return () => E.dispose();
  }, []);
  const R = (E) => {
    f.current = E;
  }, x = (E) => {
    const V = E.split(",").filter((O) => !!O).map(Dr).map((O) => O.range);
    l.current = V;
  }, T = () => {
    if (a)
      return;
    const V = (() => {
      const m = r.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet();
      if (!m)
        throw new Error("No active sheet found");
      return l.current.map((K2) => kh(K2, m.getRowCount(), m.getColumnCount())).filter((K2) => !(Number.isNaN(K2.startRow) || Number.isNaN(K2.startColumn)));
    })();
    if (w.fetchThroughInterceptors(w.getInterceptPoints().beforeSubmit)(true, null)) {
      const m = w.fetchThroughInterceptors(w.getInterceptPoints().submit)(null, null);
      if (m) {
        const _ = an(r), j = ln(r);
        if (!_ || !j)
          throw new Error("No active sheet found");
        let K2 = {};
        t.rule && t.rule.cfId ? (K2 = { ...t.rule, ranges: V, rule: m }, n.executeCommand(V0.id, { unitId: _, subUnitId: j, rule: K2 }), t.onCancel()) : (K2 = { cfId: i.createCfId(_, j), ranges: V, rule: m, stopIfTrue: false }, n.executeCommand(k0.id, { unitId: _, subUnitId: j, rule: K2 }), t.onCancel());
      }
    }
  }, g = () => {
    t.onCancel();
  }, b = (E, V) => {
    E ? V.length < 1 ? h(e.t("sheet.cf.errorMessage.rangeError")) : h(void 0) : h(e.t("sheet.cf.errorMessage.rangeError"));
  };
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: e.t("sheet.cf.panel.range")
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-4", children: [
      (0, import_jsx_runtime.jsx)(
        Wr,
        {
          unitId: s,
          subUnitId: d,
          initialValue: u,
          onChange: (E, V) => x(V),
          onVerify: b
        }
      ),
      a && (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-1 univer-text-xs univer-text-red-500", children: a })
    ] }),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-mt-4 univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
        children: e.t("sheet.cf.panel.styleType")
      }
    ),
    (0, import_jsx_runtime.jsx)(
      LE,
      {
        className: "univer-mt-4 univer-w-full",
        value: p,
        options: v,
        onChange: (E) => y(E)
      }
    ),
    (0, import_jsx_runtime.jsx)(
      I2,
      {
        interceptorManager: w,
        rule: (M2 = t.rule) == null ? void 0 : M2.rule,
        onChange: R
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-4 univer-flex univer-justify-end", children: [
      (0, import_jsx_runtime.jsx)(vr2, { onClick: g, children: e.t("sheet.cf.panel.cancel") }),
      (0, import_jsx_runtime.jsx)(vr2, { className: "univer-ml-3", variant: "primary", onClick: T, children: e.t("sheet.cf.panel.submit") })
    ] })
  ] });
};
var Pi = Object.getOwnPropertyDescriptor;
var Oi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? Pi(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var $i = (t, e) => (n, r) => e(n, r, t);
var He = class extends Ve {
  constructor(e) {
    super();
    Ie(this, "_initLocal", () => {
    });
    Ie(this, "_findReplaceIndex", (e2) => {
      const n = /\{([^}]+)?\}/g, r = [];
      let i = n.exec(e2);
      for (; i; )
        r.push({
          startIndex: i.index,
          key: Number(i[1]),
          endIndex: i.index + i[0].length - 1
        }), i = n.exec(e2);
      return r;
    });
    this._localeService = e, this._initLocal();
  }
  tWithReactNode(e, ...n) {
    const r = this._localeService.getLocales(), i = e.split("."), o = r && this._localeService.resolveKeyPath(r, i);
    if (typeof o == "string") {
      const s = [];
      return this._findReplaceIndex(o).forEach((d, a, h) => {
        const l = h[a - 1] || { endIndex: -1 };
        if (l.endIndex + 1 < d.startIndex) {
          const u = o.slice(l.endIndex + 1, d.startIndex);
          u && s.push(u);
        }
        if (n[d.key] && s.push(n[d.key]), a === h.length - 1) {
          const u = o.slice(d.endIndex + 1);
          u && s.push(u);
        }
      }), s;
    }
    return [];
  }
};
He = Oi([
  $i(0, Inject(Fn))
], He);
var Di = (t, e) => {
  const n = t.rule;
  switch (n.type) {
    case S.colorScale:
      return e.t("sheet.cf.ruleType.colorScale");
    case S.dataBar:
      return e.t("sheet.cf.ruleType.dataBar");
    case S.iconSet:
      return e.t("sheet.cf.ruleType.iconSet");
    case S.highlightCell:
      switch (n.subType) {
        case A.average: {
          const r = n.operator;
          return e.t(`sheet.cf.preview.describe.${r}`, e.t("sheet.cf.subRuleType.average"));
        }
        case A.duplicateValues:
          return e.t("sheet.cf.subRuleType.duplicateValues");
        case A.uniqueValues:
          return e.t("sheet.cf.subRuleType.uniqueValues");
        case A.number: {
          const r = n.operator;
          return e.t(`sheet.cf.preview.describe.${r}`, ...Array.isArray(n.value) ? n.value.map((i) => String(i)) : [String(n.value || "")]);
        }
        case A.text: {
          const r = n.operator;
          return e.t(`sheet.cf.preview.describe.${r}`, n.value || "");
        }
        case A.timePeriod: {
          const r = n.operator;
          return e.t(`sheet.cf.preview.describe.${r}`);
        }
        case A.rank:
          return n.isPercent ? n.isBottom ? e.t("sheet.cf.preview.describe.bottomNPercent", String(n.value)) : e.t("sheet.cf.preview.describe.topNPercent", String(n.value)) : n.isBottom ? e.t("sheet.cf.preview.describe.bottomN", String(n.value)) : e.t("sheet.cf.preview.describe.topN", String(n.value));
        case A.formula:
          return e.t("sheet.cf.ruleType.formula");
      }
  }
};
var cn = 0;
var Ai = (t) => {
  const { onClick: e } = t, n = useDependency(M), r = useDependency(vr), i = useDependency(z), o = useDependency(Ls), s = useDependency(Fn), d = useDependency(Injector), a = useDependency(we2), h = useDependency(He), l = useObservable(() => r.getCurrentTypeOfUnit$(we.UNIVER_SHEET), void 0, void 0, []), u = l.getUnitId(), v = l.getActiveSheet();
  if (!v)
    throw new Error("No active sheet found");
  const p = v.getSheetId(), [y, f] = (0, import_react.useState)([]), [w, I2] = (0, import_react.useState)("2"), [R, x] = (0, import_react.useState)(0), [T, g] = (0, import_react.useState)(-1), [b, S2] = (0, import_react.useState)(cn), C = (0, import_react.useRef)(null), M2 = [
    { label: s.t("sheet.cf.panel.workSheet"), value: "2" },
    { label: s.t("sheet.cf.panel.selectedRange"), value: "1" }
  ], E = () => {
    const D = n.getSubunitRules(u, p);
    if (!D || !D.length)
      return [];
    if (w === "1") {
      const B = i.getCurrentLastSelection();
      if (!B)
        return [];
      const G2 = B.range;
      return D.filter((ee) => ee.ranges.some((ne) => En.intersects(ne, G2)));
    } else if (w === "2")
      return [...D];
    return [];
  }, [V, O] = (0, import_react.useState)(E);
  pR(y), (0, import_react.useEffect)(() => {
    const D = o.onCommandExecuted((B) => {
      B.id === pn.id && x(Math.random());
    });
    return () => D.dispose();
  }), (0, import_react.useEffect)(() => {
    O(E);
  }, [w, R, u, p]), (0, import_react.useEffect)(() => {
    if (w === "2")
      return;
    const D = new Observable((B) => {
      const G2 = [ie3.id, a2.id, o2.id, K.id, i2.id], z2 = o.onCommandExecuted((ee) => {
        const { id: ne, params: we3 } = ee, Re = r.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId();
        G2.includes(ne) && we3.unitId === Re && B.next(null);
      });
      return () => z2.dispose();
    }).pipe(debounceTime(16)).subscribe(() => {
      O(E);
    });
    return () => {
      D.unsubscribe();
    };
  }, [r, w, u, p]), (0, import_react.useEffect)(() => {
    const D = n.$ruleChange.subscribe(() => {
      x(Math.random());
    });
    return () => D.unsubscribe();
  }, [n]), (0, import_react.useEffect)(() => {
    const D = () => {
      var ee, ne;
      const z2 = Math.max(0, ((ne = (ee = C.current) == null ? void 0 : ee.getBoundingClientRect().width) != null ? ne : 0) - 8);
      return cn = z2, z2;
    }, G2 = new Observable((z2) => {
      const ee = a.getContainer();
      if (ee) {
        let ne = setTimeout(() => {
          z2.next(void 0);
        }, 150);
        const we3 = () => {
          ne && clearTimeout(ne), ne = null;
        }, Re = (at) => {
          at.propertyName === "width" && (we3(), z2.next(void 0));
        };
        return ee.addEventListener("transitionend", Re), () => {
          we3(), ee.removeEventListener("transitionend", Re);
        };
      }
    }).pipe(debounceTime(16)).subscribe(() => {
      S2(D());
    });
    return () => {
      G2.unsubscribe();
    };
  }, []);
  const m = (D) => {
    var z2;
    const B = r.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId(), G2 = (z2 = r.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : z2.getSheetId();
    if (!B || !G2)
      throw new Error("No active sheet found");
    o.executeCommand(U0.id, { unitId: B, subUnitId: G2, cfId: D.cfId });
  }, _ = (D, B) => {
    g(B.y);
  }, j = (D, B, G2) => {
    var at;
    g(-1);
    const z2 = r.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId(), ee = (at = r.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : at.getSheetId();
    if (!z2 || !ee)
      throw new Error("No active sheet found");
    const ne = (or) => {
      const sr2 = V.length;
      return Math.min(sr2 - 1, Math.max(0, or));
    }, we3 = V[ne(B.y)].cfId, Re = V[ne(G2.y)].cfId;
    we3 !== Re && o.executeCommand(T0.id, { unitId: z2, subUnitId: ee, start: { id: we3, type: "self" }, end: { id: Re, type: G2.y > B.y ? "after" : "before" } });
  }, K2 = () => {
    t.onCreate();
  }, fe2 = () => {
    w === "2" ? o.executeCommand(N0.id) : w === "1" && V.map((B) => ({ unitId: u, subUnitId: p, cfId: B.cfId })).forEach((B) => {
      o.executeCommand(U0.id, B);
    });
  }, pe = (0, import_react.useMemo)(() => {
    const D = r.getCurrentUnitOfType(we.UNIVER_SHEET), B = D.getActiveSheet();
    return V.filter((G2) => {
      const z2 = G2.ranges;
      return og(d, D.getUnitId(), B.getSheetId(), z2);
    });
  }, [V]), Le3 = pe.map((D, B) => ({ i: D.cfId, x: 0, w: 12, y: B, h: 1, isResizable: false })), Ue = (0, import_react.useMemo)(() => {
    const D = r.getCurrentUnitOfType(we.UNIVER_SHEET), B = D.getActiveSheet();
    return V.every((G2) => {
      const z2 = G2.ranges;
      return og(d, D.getUnitId(), B.getSheetId(), z2);
    });
  }, [V]);
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-justify-between univer-gap-2 univer-text-sm", children: [
      (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-items-center univer-gap-2", children: h.tWithReactNode(
        "sheet.cf.panel.managerRuleSelect",
        (0, import_jsx_runtime.jsx)(
          LE,
          {
            className: "univer-w-36",
            options: M2,
            value: w,
            onChange: (D) => {
              I2(D);
            }
          }
        )
      ).map((D, B) => (0, import_jsx_runtime.jsx)("span", { children: D }, B)) }),
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-justify-end", children: [
        (0, import_jsx_runtime.jsx)(Rp, { title: s.t("sheet.cf.panel.createRule"), placement: "bottom", children: (0, import_jsx_runtime.jsx)(
          "a",
          {
            className: "univer-size-5 univer-cursor-pointer",
            onClick: K2,
            children: (0, import_jsx_runtime.jsx)(zn, {})
          }
        ) }),
        V.length && Ue ? (0, import_jsx_runtime.jsx)(Rp, { title: s.t("sheet.cf.panel.clear"), placement: "bottom", children: (0, import_jsx_runtime.jsx)(
          "a",
          {
            className: "univer-size-5 univer-cursor-pointer",
            onClick: fe2,
            children: (0, import_jsx_runtime.jsx)(vt, { className: "univer-text-red-500" })
          }
        ) }) : (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(vt, { className: "univer-text-gray-300" }) })
      ] })
    ] }),
    (0, import_jsx_runtime.jsx)("div", { ref: C, children: b > 0 && (0, import_jsx_runtime.jsx)(
      ib,
      {
        className: "[&_.react-grid-item]:univer-transition-none [&_.react-grid-placeholder]:univer-rounded [&_.react-grid-placeholder]:!univer-bg-gray-200",
        draggableHandle: ".draggableHandle",
        layout: Le3,
        cols: 12,
        rowHeight: 60,
        width: b,
        margin: [0, 10],
        onDragStop: j,
        onDragStart: _,
        children: pe == null ? void 0 : pe.map((D, B) => (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: ie2("univer-group univer-relative univer-flex univer-items-center univer-justify-between univer-rounded univer-py-2 univer-pl-5 univer-pr-8 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700", {
              "univer-bg-gray-100 dark:!univer-bg-gray-700": T === B
            }),
            onMouseMove: () => {
              D.ranges !== y && f(D.ranges);
            },
            onMouseLeave: () => f([]),
            onClick: () => {
              e(D);
            },
            children: [
              (0, import_jsx_runtime.jsx)(
                "div",
                {
                  className: ie2("univer-absolute univer-left-0 univer-hidden univer-size-5 univer-cursor-grab univer-items-center univer-justify-center univer-rounded group-hover:univer-flex", "draggableHandle"),
                  onClick: (G2) => G2.stopPropagation(),
                  children: (0, import_jsx_runtime.jsx)(Kn, {})
                }
              ),
              (0, import_jsx_runtime.jsxs)(
                "div",
                {
                  className: "univer-min-w-0 univer-max-w-full univer-flex-shrink univer-overflow-hidden",
                  children: [
                    (0, import_jsx_runtime.jsx)(
                      "div",
                      {
                        className: "univer-text-sm univer-text-gray-900 dark:!univer-text-white",
                        children: Di(D, s)
                      }
                    ),
                    (0, import_jsx_runtime.jsx)("div", { className: "univer-text-xs univer-text-gray-400", children: D.ranges.map((G2) => Ft(G2)).join(",") })
                  ]
                }
              ),
              (0, import_jsx_runtime.jsx)("div", { children: (0, import_jsx_runtime.jsx)(Be, { rule: D.rule }) }),
              (0, import_jsx_runtime.jsx)(
                "div",
                {
                  className: ie2("univer-absolute univer-right-1 univer-hidden univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-rounded group-hover:univer-flex hover:univer-bg-gray-200", {
                    "univer-flex univer-items-center univer-justify-center": T === B
                  }),
                  onClick: (G2) => {
                    G2.stopPropagation(), m(D), f([]);
                  },
                  children: (0, import_jsx_runtime.jsx)(vt, {})
                }
              )
            ]
          }
        ) }, `${D.cfId}`))
      }
    ) })
  ] });
};
var Hi = (t) => {
  const [e, n] = (0, import_react.useState)(t.rule), [r, i] = (0, import_react.useState)(!!t.rule);
  return (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-h-full univer-flex-col univer-justify-between univer-py-4", children: r ? (0, import_jsx_runtime.jsx)(Ui, { onCancel: () => {
    i(false), n(void 0);
  }, rule: e }) : (0, import_jsx_runtime.jsx)(Ai, { onClick: (a) => {
    n(a), i(true);
  }, onCreate: () => {
    i(true);
  } }) });
};
var ji = Object.getOwnPropertyDescriptor;
var Bi2 = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? ji(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var We2 = (t, e) => (n, r) => e(n, r, t);
var dt = "sheet.conditional.formatting.panel";
var Je = class extends Ve {
  constructor(e, n, r, i, o) {
    super();
    Ie(this, "_sidebarDisposable", null);
    this._univerInstanceService = e, this._injector = n, this._componentManager = r, this._sidebarService = i, this._localeService = o, this._initPanel(), this.disposeWithMe(
      this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((s) => {
        var d;
        s || (d = this._sidebarDisposable) == null || d.dispose();
      })
    ), this.disposeWithMe(this._sidebarService.sidebarOptions$.subscribe((s) => {
      s.id === dt && (s.visible || setTimeout(() => {
        this._sidebarService.sidebarOptions$.next({ visible: false });
      }));
    }));
  }
  openPanel(e) {
    const n = {
      id: dt,
      header: { title: this._localeService.t("sheet.cf.title") },
      children: {
        label: dt,
        rule: e,
        key: et(4)
      },
      onClose: () => this._sidebarDisposable = null
    };
    this._sidebarDisposable = this._sidebarService.open(n);
  }
  _initPanel() {
    this.disposeWithMe(
      this._componentManager.register(dt, Hi)
    );
  }
};
Je = Bi2([
  We2(0, vr),
  We2(1, Inject(Injector)),
  We2(2, Inject(S1)),
  We2(3, Inject(we2)),
  We2(4, Inject(Fn))
], Je);
var ie4 = ((t) => (t[t.createRule = 1] = "createRule", t[t.viewRule = 2] = "viewRule", t[t.highlightCell = 3] = "highlightCell", t[t.rank = 4] = "rank", t[t.formula = 5] = "formula", t[t.colorScale = 6] = "colorScale", t[t.dataBar = 7] = "dataBar", t[t.icon = 8] = "icon", t[t.clearRangeRules = 9] = "clearRangeRules", t[t.clearWorkSheetRules = 10] = "clearWorkSheetRules", t))(ie4 || {});
var Mt = {
  id: "sheet.operation.open.conditional.formatting.panel",
  type: Ms.OPERATION,
  handler: (t, e) => {
    var d;
    const n = t.get(Je), r = t.get(z), i = t.get(Ls), o = ((d = r.getCurrentSelections()) == null ? void 0 : d.map((a) => a.range)) || [];
    switch (e.value) {
      case 3: {
        n.openPanel({ ...$1(), ranges: o });
        break;
      }
      case 4: {
        const a = {
          ...$1,
          ranges: o,
          rule: {
            type: S.highlightCell,
            subType: A.rank
          }
        };
        n.openPanel(a);
        break;
      }
      case 5: {
        const a = {
          ...$1,
          ranges: o,
          rule: {
            type: S.highlightCell,
            subType: A.formula,
            value: "="
          }
        };
        n.openPanel(a);
        break;
      }
      case 6: {
        const a = {
          ...$1,
          ranges: o,
          rule: {
            type: S.colorScale,
            config: []
          }
        };
        n.openPanel(a);
        break;
      }
      case 7: {
        const a = {
          ...$1,
          ranges: o,
          rule: {
            type: S.dataBar,
            isShowValue: true
          }
        };
        n.openPanel(a);
        break;
      }
      case 8: {
        const a = {
          ...$1,
          ranges: o,
          rule: {
            type: S.iconSet,
            config: [],
            isShowValue: true
          }
        };
        n.openPanel(a);
        break;
      }
      case 2: {
        n.openPanel();
        break;
      }
      case 1: {
        n.openPanel({ ...$1(), ranges: o });
        break;
      }
      case 9: {
        i.executeCommand(B0.id, { ranges: o });
        break;
      }
      case 10: {
        i.executeCommand(N0.id);
        break;
      }
    }
    return true;
  }
};
var Wi = Object.getOwnPropertyDescriptor;
var qi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? Wi(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var qe = (t, e) => (n, r) => e(n, r, t);
var yt = class extends Ve {
  constructor(t, e, n, r, i) {
    super(), this._injector = t, this._univerInstanceService = e, this._sheetInterceptorService = n, this._selectionManagerService = r, this._conditionalFormattingRuleModel = i, this._init();
  }
  _init() {
    this.disposeWithMe(this._sheetInterceptorService.interceptCommand({
      getMutations: (t) => {
        var i;
        const e = [], n = [], r = { redos: e, undos: n };
        if ([Ls2.id, Ws.id].includes(t.id)) {
          const o = (i = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : i.map((p) => p.range);
          if (!o)
            return r;
          const s = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), d = s.getActiveSheet();
          if (!d)
            return r;
          const a = s.getUnitId(), h = d.getSheetId(), l = this._conditionalFormattingRuleModel.getSubunitRules(a, h);
          if (!l || !l.length)
            return r;
          const { redos: u, undos: v } = un(this._injector, l, o, a, h);
          e.push(...u), n.push(...v);
        }
        return r;
      }
    })), this.disposeWithMe(this._sheetInterceptorService.interceptRanges({
      getMutations: ({ unitId: t, subUnitId: e, ranges: n }) => {
        const r = [], i = [], o = { redos: r, undos: i };
        if (!n || !n.length)
          return o;
        const s = this._conditionalFormattingRuleModel.getSubunitRules(t, e);
        if (!s || !s.length)
          return o;
        const { redos: d, undos: a } = un(this._injector, s, n, t, e);
        return r.push(...d), i.push(...a), o;
      }
    }));
  }
};
yt = qi([
  qe(0, Inject(Injector)),
  qe(1, Inject(vr)),
  qe(2, Inject(G)),
  qe(3, Inject(z)),
  qe(4, Inject(M))
], yt);
function un(t, e, n, r, i) {
  const o = [], s = [];
  return e.filter((d) => n.some((a) => d.ranges.some((h) => En.getIntersects(h, a)))).forEach((d) => {
    const h = new Sh().add(...d.ranges).subtract(...n).merge();
    if (h.length) {
      const l = {
        id: o2.id,
        params: {
          unitId: r,
          subUnitId: i,
          rule: { ...d, ranges: h }
        }
      }, u = j2(t, l.params);
      o.push(l), s.push(...u);
    } else {
      const l = {
        id: K.id,
        params: {
          unitId: r,
          subUnitId: i,
          cfId: d.cfId
        }
      }, u = w2(t, l.params);
      o.push(l), s.push(...u);
    }
  }), { redos: o, undos: s };
}
var Gi = Object.getOwnPropertyDescriptor;
var Zi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? Gi(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Ge = (t, e) => (n, r) => e(n, r, t);
var Qe = class extends Ve {
  constructor(e, n, r, i, o) {
    super();
    Ie(this, "_copyInfo");
    this._sheetClipboardService = e, this._conditionalFormattingRuleModel = n, this._injector = r, this._conditionalFormattingViewModel = i, this._univerInstanceService = o, this._initClipboardHook();
  }
  _initClipboardHook() {
    this.disposeWithMe(
      this._sheetClipboardService.addClipboardHook({
        id: Z2,
        onBeforeCopy: (e, n, r) => this._collectConditionalRule(e, n, r),
        onPasteCells: (e, n, r, i) => {
          const { copyType: o = Yn.COPY, pasteType: s } = i, { range: d } = e || {}, { range: a } = n;
          return this._generateConditionalFormattingMutations(a, { copyType: o, pasteType: s, copyRange: d });
        }
      })
    );
  }
  _collectConditionalRule(e, n, r) {
    const i = new pt(), o = {};
    this._copyInfo = {
      matrix: i,
      info: {
        unitId: e,
        subUnitId: n,
        cfMap: o
      }
    };
    const s = this._injector.invoke((l) => ku(r, l, e, n));
    if (!s)
      return;
    const { rows: d, cols: a } = s, h = /* @__PURE__ */ new Set();
    d.forEach((l, u) => {
      a.forEach((v, p) => {
        const y = this._conditionalFormattingViewModel.getCellCfs(e, n, l, v);
        y && (y.forEach((f) => h.add(f.cfId)), i.setValue(u, p, y.map((f) => f.cfId)));
      });
    }), h.forEach((l) => {
      const u = this._conditionalFormattingRuleModel.getRule(e, n, l);
      u && (o[l] = u.rule);
    });
  }
  // eslint-disable-next-line max-lines-per-function
  _generateConditionalFormattingMutations(e, n) {
    const r = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), i = r.getActiveSheet(), o = r.getUnitId();
    if (!i) return { redos: [], undos: [] };
    const s = i.getSheetId();
    if (n.copyType === Yn.CUT)
      return this._copyInfo = null, { redos: [], undos: [] };
    if (!this._copyInfo || !n.copyRange)
      return { redos: [], undos: [] };
    if (![
      et2.SPECIAL_PASTE_FORMAT,
      et2.DEFAULT_PASTE,
      et2.SPECIAL_PASTE_BESIDES_BORDER
    ].includes(
      n.pasteType
    ))
      return { redos: [], undos: [] };
    const { ranges: [a, h], mapFunc: l } = wr([n.copyRange, e]), u = Yy(a, h, true), v = {};
    Or.foreach(h, (g, b) => {
      const { row: S2, col: C } = l(g, b), M2 = this._conditionalFormattingViewModel.getCellCfs(o, s, S2, C);
      M2 && M2.forEach((E) => {
        if (!v[E.cfId]) {
          const V = new pt();
          v[E.cfId] = V;
          const O = this._conditionalFormattingRuleModel.getRule(o, s, E.cfId);
          O == null || O.ranges.forEach((m) => {
            Or.foreach(m, (_, j) => {
              V.setValue(_, j, 1);
            });
          });
        }
        v[E.cfId].realDeleteValue(S2, C);
      });
    });
    const { matrix: p, info: y } = this._copyInfo, f = [];
    let w = this._conditionalFormattingRuleModel.createCfId(o, s);
    const I2 = {}, R = (g) => {
      if (I2[g])
        return I2[g];
      const b = y == null ? void 0 : y.cfMap[g], S2 = [...this._conditionalFormattingRuleModel.getSubunitRules(o, s) || [], ...f].find((C) => J.diffValue(C.rule, b));
      if (S2)
        return I2[g] = S2, S2;
      {
        const C = {
          rule: b,
          cfId: w,
          ranges: [],
          stopIfTrue: false
        };
        return I2[g] = C, f.push(C), w = `${Number(w) + 1}`, C;
      }
    };
    u.forEach((g) => {
      p && p.forValue((b, S2, C) => {
        const M2 = En.getPositionRange(
          {
            startRow: b,
            endRow: b,
            startColumn: S2,
            endColumn: S2
          },
          g.startRange
        ), { row: E, col: V } = l(M2.startRow, M2.startColumn);
        C.forEach((O) => {
          if (!v[O]) {
            const m = R(O), _ = new pt();
            v[O] = _, m.ranges.forEach((j) => {
              Or.foreach(j, (K2, fe2) => {
                _.setValue(K2, fe2, 1);
              });
            });
          }
          v[O].setValue(E, V, 1);
        });
      });
    });
    const x = [], T = [];
    for (const g in v) {
      const b = v[g], S2 = Zo(mu(b));
      if (!S2.length) {
        const C = {
          unitId: o,
          subUnitId: s,
          cfId: g
        };
        x.push({ id: K.id, params: C }), T.push(...w2(this._injector, C));
      }
      if (f.some((C) => C.cfId === g)) {
        const C = R(g), M2 = {
          unitId: o,
          subUnitId: s,
          rule: { ...C, ranges: S2 }
        };
        x.push({ id: a2.id, params: M2 }), T.push(H2(this._injector, M2));
      } else {
        const C = this._conditionalFormattingRuleModel.getRule(o, s, g);
        if (!C)
          continue;
        const M2 = {
          unitId: o,
          subUnitId: s,
          rule: { ...C, ranges: S2 }
        };
        x.push({ id: o2.id, params: M2 }), T.push(...j2(this._injector, M2));
      }
    }
    return {
      redos: x,
      undos: T
    };
  }
};
Qe = Zi([
  Ge(0, Inject(nn)),
  Ge(1, Inject(M)),
  Ge(2, Inject(Injector)),
  Ge(3, Inject(Q)),
  Ge(4, Inject(vr))
], Qe);
var zi = Object.getOwnPropertyDescriptor;
var Yi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? zi(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Pt = (t, e) => (n, r) => e(n, r, t);
var et3 = class extends Ve {
  constructor(t, e, n) {
    super(), this._localeService = t, this._commandService = e, this._sheetPermissionCheckController = n, this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((t) => {
        t.id === k0.id && (this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [Pe],
          rangeTypes: [Le],
          worksheetTypes: [Ve2, yr]
        }, t.params.rule.ranges) || this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localeService.t("permission.dialog.setStyleErr")));
      })
    );
  }
};
et3 = Yi([
  Pt(0, Inject(Fn)),
  Pt(1, Ls),
  Pt(2, Inject(qn))
], et3);
var Ki = Object.getOwnPropertyDescriptor;
var Xi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? Ki(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var ht2 = (t, e) => (n, r) => e(n, r, t);
var tt = class extends Ve {
  constructor(t, e, n, r) {
    super(), this._conditionalFormattingRuleModel = t, this._univerInstanceService = e, this._injector = n, this._refRangeService = r, this._initRefRange();
  }
  _initRefRange() {
    const t = /* @__PURE__ */ new Map(), e = (r, i, o) => `${r}_${i}_${o}`, n = (r, i, o) => {
      const s = (a) => {
        const h = [...o.ranges], l = h.map((v) => Ro(v, a)).filter((v) => !!v);
        if ($R(l, h))
          return { redos: [], undos: [] };
        if (l.length) {
          const v = { unitId: r, subUnitId: i, rule: { ...o, ranges: l } }, p = [{ id: o2.id, params: v }], y = j2(this._injector, v);
          return { redos: p, undos: y };
        } else {
          const v = { unitId: r, subUnitId: i, cfId: o.cfId }, p = [{ id: K.id, params: v }], y = w2(this._injector, v);
          return { redos: p, undos: y };
        }
      }, d = [];
      o.ranges.forEach((a) => {
        const h = this._refRangeService.registerRefRange(a, s);
        d.push(() => h.dispose());
      }), t.set(e(r, i, o.cfId), () => d.forEach((a) => a()));
    };
    this.disposeWithMe(this._conditionalFormattingRuleModel.$ruleChange.subscribe((r) => {
      const { unitId: i, subUnitId: o, rule: s } = r, d = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), a = d.getActiveSheet();
      if (!(r.unitId !== d.getUnitId() || r.subUnitId !== (a == null ? void 0 : a.getSheetId())))
        switch (r.type) {
          case "add": {
            n(r.unitId, r.subUnitId, r.rule);
            break;
          }
          case "delete": {
            const h = t.get(e(i, o, s.cfId));
            h && h();
            break;
          }
          case "set": {
            const h = t.get(e(i, o, s.cfId));
            h && h(), n(r.unitId, r.subUnitId, r.rule);
          }
        }
    })), this.disposeWithMe(We(() => {
      t.forEach((r) => {
        r();
      }), t.clear();
    }));
  }
};
tt = Xi([
  ht2(0, Inject(M)),
  ht2(1, Inject(vr)),
  ht2(2, Inject(Injector)),
  ht2(3, Inject(xt))
], tt);
var Ji = Object.getOwnPropertyDescriptor;
var Qi = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? Ji(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Oe = (t, e) => (n, r) => e(n, r, t);
var nt = class extends Ve {
  constructor(e, n, r, i, o, s) {
    super();
    Ie(this, "_ruleChangeCacheMap", /* @__PURE__ */ new Map());
    this._sheetInterceptorService = e, this._conditionalFormattingService = n, this._univerInstanceService = r, this._renderManagerService = i, this._conditionalFormattingViewModel = o, this._conditionalFormattingRuleModel = s, this._initViewModelInterceptor(), this._initSkeleton(), this.disposeWithMe(() => {
      this._ruleChangeCacheMap.clear();
    });
  }
  _markDirtySkeleton() {
    var n, r, i;
    const e = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId();
    (n = this._renderManagerService.getRenderById(e)) == null || n.with(ue).reCalculate(), (i = (r = this._renderManagerService.getRenderById(e)) == null ? void 0 : r.mainComponent) == null || i.makeDirty();
  }
  _initSkeleton() {
    this.disposeWithMe(merge(this._conditionalFormattingRuleModel.$ruleChange, this._conditionalFormattingViewModel.markDirty$).pipe(
      bufferTime(16),
      filter((e) => !!e.length),
      filter((e) => {
        const n = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
        if (!n) return false;
        const r = n.getActiveSheet();
        return r ? e.filter((i) => i.unitId === n.getUnitId() && i.subUnitId === r.getSheetId()).length > 0 : false;
      })
    ).subscribe(() => this._markDirtySkeleton()));
  }
  _initViewModelInterceptor() {
    this.disposeWithMe(this._sheetInterceptorService.intercept(ht.CELL_CONTENT, {
      effect: sr.Style,
      handler: (e, n, r) => {
        const i = this._conditionalFormattingService.composeStyle(n.unitId, n.subUnitId, n.row, n.col);
        if (!i)
          return r(e);
        const o = n.workbook.getStyles(), s = (typeof (e == null ? void 0 : e.s) == "string" ? o.get(e == null ? void 0 : e.s) : e == null ? void 0 : e.s) || {}, d = e === n.rawData ? { ...n.rawData } : e;
        if (i.style) {
          const a = {
            ...s,
            ...i.style
          };
          Object.assign(d, { s: a });
        }
        return d.fontRenderExtension || (d.fontRenderExtension = {}, i.isShowValue !== void 0 && (d.fontRenderExtension.isSkip = !i.isShowValue)), i.dataBar && (d.dataBar = i.dataBar), i.iconSet && (d.iconSet = i.iconSet, d.fontRenderExtension.leftOffset = y1 + M1), r(d);
      },
      priority: 10
    }));
  }
};
nt = Qi([
  Oe(0, Inject(G)),
  Oe(1, Inject(s2)),
  Oe(2, Inject(vr)),
  Oe(3, Inject(ME)),
  Oe(4, Inject(Q)),
  Oe(5, Inject(M))
], nt);
var nr = "sheets-conditional-formatting-ui.config";
var bt2 = {};
var eo = Object.defineProperty;
var to = Object.getOwnPropertyDescriptor;
var no = (t, e, n) => e in t ? eo(t, e, { enumerable: true, configurable: true, writable: true, value: n }) : t[e] = n;
var ro = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? to(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Ot = (t, e) => (n, r) => e(n, r, t);
var rr = (t, e, n) => no(t, typeof e != "symbol" ? e + "" : e, n);
var It = class extends Ol {
  constructor(t = bt2, e, n, r) {
    super(), this._config = t, this._injector = e, this._commandService = n, this._configService = r;
    const { menu: i, ...o } = oo(
      {},
      bt2,
      this._config
    );
    i && this._configService.setConfig("menu", i, { merge: true }), this._configService.setConfig(nr, o), this._initCommand(), this._injector.add([nt]), this._injector.add([tt]), this._injector.add([Qe]), this._injector.add([et3]), this._injector.add([He]);
  }
  _initCommand() {
    [
      On,
      $n,
      Dn2,
      An,
      Hn,
      jn,
      Bn,
      Wn,
      qn2,
      Mt
    ].forEach((t) => {
      this._commandService.registerCommand(t);
    });
  }
};
rr(It, "pluginName", `${Z2}_MOBILE_UI_PLUGIN`);
rr(It, "type", we.UNIVER_SHEET);
It = ro([
  qR(N2),
  Ot(1, Inject(Injector)),
  Ot(2, Inject(Ls)),
  Ot(3, ic)
], It);
var io = Object.getOwnPropertyDescriptor;
var oo2 = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? io(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Ze = (t, e) => (n, r) => e(n, r, t);
var St = class extends Ve {
  constructor(t, e, n, r, i) {
    super(), this._injector = t, this._univerInstanceService = e, this._autoFillService = n, this._conditionalFormattingRuleModel = r, this._conditionalFormattingViewModel = i, this._initAutoFill();
  }
  // eslint-disable-next-line max-lines-per-function
  _initAutoFill() {
    const t = () => ({ redos: [], undos: [] }), e = (i, o, s, d, a) => {
      var p;
      const h = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getUnitId(), l = (p = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : p.getSheetId();
      if (!h || !l)
        return;
      const u = {
        startRow: i.row,
        startColumn: i.col,
        endColumn: i.col,
        endRow: i.row
      }, v = {
        startRow: o.row,
        startColumn: o.col,
        endColumn: o.col,
        endRow: o.row
      };
      Or.foreach(s, (y, f) => {
        const w = En.getPositionRange(
          {
            startRow: y,
            startColumn: f,
            endColumn: f,
            endRow: y
          },
          u
        ), I2 = En.getPositionRange(
          {
            startRow: y,
            startColumn: f,
            endColumn: f,
            endRow: y
          },
          v
        ), { row: R, col: x } = a(w.startRow, w.startColumn), T = this._conditionalFormattingViewModel.getCellCfs(
          h,
          l,
          R,
          x
        ), { row: g, col: b } = a(I2.startRow, I2.startColumn), S2 = this._conditionalFormattingViewModel.getCellCfs(
          h,
          l,
          g,
          b
        );
        S2 && S2.forEach((C) => {
          let M2 = d.get(C.cfId);
          if (!d.get(C.cfId)) {
            const E = this._conditionalFormattingRuleModel.getRule(h, l, C.cfId);
            if (!E)
              return;
            M2 = new pt(), E.ranges.forEach((V) => {
              Or.foreach(V, (O, m) => {
                M2.setValue(O, m, 1);
              });
            }), d.set(C.cfId, M2);
          }
          M2.realDeleteValue(g, b);
        }), T && T.forEach((C) => {
          let M2 = d.get(C.cfId);
          if (!d.get(C.cfId)) {
            const E = this._conditionalFormattingRuleModel.getRule(h, l, C.cfId);
            if (!E)
              return;
            M2 = new pt(), E.ranges.forEach((V) => {
              Or.foreach(V, (O, m) => {
                M2.setValue(O, m, 1);
              });
            }), d.set(C.cfId, M2);
          }
          M2.setValue(g, b, 1);
        });
      });
    }, n = (i, o) => {
      var I2, R, x;
      const s = (I2 = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : I2.getUnitId(), d = (x = (R = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : R.getActiveSheet()) == null ? void 0 : x.getSheetId(), a = /* @__PURE__ */ new Map(), h = [], l = [];
      if (!s || !d)
        return t();
      const u = wr([i, o]), [v, p] = u.ranges, { mapFunc: y } = u, f = {
        row: v.startRow,
        col: v.startColumn
      };
      return zy(v, p).forEach((T) => {
        e(f, T.repeatStartCell, T.relativeRange, a, y);
      }), a.forEach((T, g) => {
        const b = this._conditionalFormattingRuleModel.getRule(s, d, g);
        if (!b)
          return;
        const S2 = Zo(mu(T));
        if (S2.length) {
          const C = {
            unitId: s,
            subUnitId: d,
            rule: { ...b, ranges: S2 }
          };
          h.push({ id: o2.id, params: C }), l.push(...j2(this._injector, C));
        } else {
          const C = {
            unitId: s,
            subUnitId: d,
            cfId: b.cfId
          };
          h.push({ id: K.id, params: C }), l.push(...w2(this._injector, C));
        }
      }), {
        undos: l,
        redos: h
      };
    }, r = {
      id: Z2,
      onFillData: (i, o, s) => {
        if (s === Le2.COPY || s === Le2.ONLY_FORMAT || s === Le2.SERIES) {
          const { source: d, target: a } = i;
          return n(d, a);
        }
        return t();
      }
    };
    this.disposeWithMe(this._autoFillService.addHook(r));
  }
};
St = oo2([
  Ze(0, Inject(Injector)),
  Ze(1, Inject(vr)),
  Ze(2, Inject(Hr)),
  Ze(3, Inject(M)),
  Ze(4, Inject(Q))
], St);
var so = Object.getOwnPropertyDescriptor;
var ao = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? so(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var dn = (t, e) => (n, r) => e(n, r, t);
var _t = class extends Ve {
  constructor(t, e) {
    super(), this._sheetInterceptorService = t, this._conditionalFormattingService = e, this._initInterceptorEditorEnd();
  }
  /**
   * Process the  values after  edit
   * @private
   * @memberof NumfmtService
   */
  _initInterceptorEditorEnd() {
    this.disposeWithMe(
      We(
        this._sheetInterceptorService.writeCellInterceptor.intercept(
          ms,
          {
            handler: (t, e, n) => {
              var s, d, a;
              t || n(t);
              const r = this._conditionalFormattingService.composeStyle(e.unitId, e.subUnitId, e.row, e.col), i = (s = r == null ? void 0 : r.style) != null ? s : {}, o = Object.keys(i);
              if (t != null && t.p)
                return (a = (d = t.p.body) == null ? void 0 : d.textRuns) == null || a.forEach((h) => {
                  h.ts && o.forEach((l) => {
                    var u;
                    (u = h.ts) == null || delete u[l];
                  });
                }), n(t);
              {
                const h = { ...(typeof (t == null ? void 0 : t.s) == "string" ? e.workbook.getStyles().get(t.s) : t == null ? void 0 : t.s) || {} };
                o.forEach((u) => {
                  delete h[u];
                });
                const l = { ...t, s: { ...h } };
                return n(l);
              }
            }
          }
        )
      )
    );
  }
};
_t = ao([
  dn(0, Inject(G)),
  dn(1, Inject(s2))
], _t);
var hn = [
  pn.id,
  a2.id,
  o2.id,
  K.id,
  i2.id
];
var ze = [
  {
    label: {
      name: "sheet.cf.ruleType.highlightCell",
      selectable: false
    },
    value: ie4.highlightCell
  },
  {
    label: {
      name: "sheet.cf.panel.rankAndAverage",
      selectable: false
    },
    value: ie4.rank
  },
  {
    label: {
      name: "sheet.cf.ruleType.formula",
      selectable: false
    },
    value: ie4.formula
  },
  {
    label: {
      name: "sheet.cf.ruleType.colorScale",
      selectable: false
    },
    value: ie4.colorScale
  },
  {
    label: {
      name: "sheet.cf.ruleType.dataBar",
      selectable: false
    },
    value: ie4.dataBar
  },
  {
    label: {
      name: "sheet.cf.ruleType.iconSet",
      selectable: false
    },
    value: ie4.icon
  },
  {
    label: {
      name: "sheet.cf.menu.manageConditionalFormatting",
      selectable: false
    },
    value: ie4.viewRule
  },
  {
    label: {
      name: "sheet.cf.menu.createConditionalFormatting",
      selectable: false
    },
    value: ie4.createRule
  },
  {
    label: {
      name: "sheet.cf.menu.clearRangeRules",
      selectable: false
    },
    value: ie4.clearRangeRules,
    disabled: false
  },
  {
    label: {
      name: "sheet.cf.menu.clearWorkSheetRules",
      selectable: false
    },
    value: ie4.clearWorkSheetRules
  }
];
var lo = (t) => {
  const e = t.get(z), n = t.get(Ls), r = t.get(vr), i = t.get(M), o = new Observable((a) => merge(
    e.selectionMoveEnd$,
    e.selectionSet$,
    new Observable((h) => {
      const l = n.onCommandExecuted((u) => {
        var f;
        const { id: v, params: p } = u, y = (f = r.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : f.getUnitId();
        hn.includes(v) && p.unitId === y && h.next(null);
      });
      return () => l.dispose();
    })
  ).pipe(debounceTime(16)).subscribe(() => {
    var f;
    const h = ((f = e.getCurrentSelections()) == null ? void 0 : f.map((w) => w.range)) || [], l = r.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!l) return;
    const u = l.getActiveSheet();
    if (!u) return;
    const y = (i.getSubunitRules(l.getUnitId(), u.getSheetId()) || []).filter((w) => w.ranges.some((I2) => h.some((R) => En.intersects(R, I2)))).map((w) => w.ranges).every((w) => og(t, l.getUnitId(), u.getSheetId(), w));
    a.next(y);
  })), s = new Observable(
    (a) => new Observable((h) => {
      const l = n.onCommandExecuted((u) => {
        var f;
        const { id: v, params: p } = u, y = (f = r.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : f.getUnitId();
        hn.includes(v) && p.unitId === y && h.next(null);
      });
      return () => l.dispose();
    }).pipe(debounceTime(16)).subscribe(() => {
      const h = r.getCurrentUnitForType(we.UNIVER_SHEET);
      if (!h) return;
      const l = h.getActiveSheet();
      if (!l) return;
      const u = i.getSubunitRules(h.getUnitId(), l.getSheetId()) || [];
      if (!u.length)
        return a.next(false), false;
      const v = u.map((p) => p.ranges).every((p) => og(t, h.getUnitId(), l.getSheetId(), p));
      a.next(v);
    })
  ), d = new Observable((a) => {
    o.subscribe((h) => {
      const l = ze.find((u) => u.value === ie4.clearRangeRules);
      l && (l.disabled = !h, a.next(ze));
    }), s.subscribe((h) => {
      const l = ze.find((u) => u.value === ie4.clearWorkSheetRules);
      l && (l.disabled = !h, a.next(ze));
    }), a.next(ze);
  });
  return {
    id: Mt.id,
    type: H1.SELECTOR,
    icon: "ConditionsDoubleIcon",
    tooltip: "sheet.cf.title",
    selections: d,
    hidden$: Bi(t, we.UNIVER_SHEET),
    disabled$: he(t, { workbookTypes: [Pe], worksheetTypes: [yr, Ve2], rangeTypes: [Le] })
  };
};
var co = {
  [fe.RULES]: {
    [Mt.id]: {
      order: 1,
      menuItemFactory: lo
    }
  }
};
var uo = Object.getOwnPropertyDescriptor;
var ho = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? uo(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var vn = (t, e) => (n, r) => e(n, r, t);
var wt = class extends Ve {
  constructor(e, n) {
    super();
    Ie(this, "_sidebarDisposable", null);
    this._injector = e, this._menuManagerService = n, this._menuManagerService.mergeMenu(co);
  }
};
wt = ho([
  vn(0, Inject(Injector)),
  vn(1, B1)
], wt);
var vo = Object.getOwnPropertyDescriptor;
var go = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? vo(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var $e = (t, e) => (n, r) => e(n, r, t);
var mo = (t, e) => {
  const n = (l) => l.endRow - l.startRow + 1, r = (l) => l.endColumn - l.startColumn + 1, i = n(e) % n(t), o = r(e) % r(t), s = Math.floor(n(e) / n(t)), d = Math.floor(r(e) / r(t)), a = [], h = {
    startRow: 0,
    endRow: n(t) - 1,
    startColumn: 0,
    endColumn: r(t) - 1
  };
  if (n(e) === 1 && r(e) === 1) {
    const l = {
      startRow: e.startRow,
      endRow: e.startRow,
      startColumn: e.startColumn,
      endColumn: e.startColumn
    };
    return a.push({ repeatRelativeRange: h, startRange: l }), a;
  }
  for (let l = 0; l < s + (i ? 0.1 : 0); l++)
    for (let u = 0; u < d + (o ? 0.1 : 0); u++) {
      const v = n(t) * l, p = r(t) * u, y = {
        startRow: v + e.startRow,
        endRow: v + e.startRow,
        startColumn: p + e.startColumn,
        endColumn: p + e.startColumn
      };
      let f = h;
      l === s && i && (f = { ...f }, f.endRow = f.endRow - (n(t) - i)), u === d && o && (f = { ...f }, f.endColumn = f.endColumn - (r(t) - o)), a.push({ repeatRelativeRange: f, startRange: y });
    }
  return a;
};
var Rt = class extends Ve {
  constructor(e, n, r, i, o, s) {
    super();
    Ie(this, "_painterConfig", null);
    this._injector = e, this._univerInstanceService = n, this._formatPainterService = r, this._sheetsSelectionsService = i, this._conditionalFormattingRuleModel = o, this._conditionalFormattingViewModel = s, this._initFormattingPainter();
  }
  // eslint-disable-next-line max-lines-per-function
  _initFormattingPainter() {
    const e = () => ({ redos: [], undos: [] }), n = (o, s, d, a, h) => {
      const { unitId: l, subUnitId: u } = this._painterConfig, { targetUnitId: v, targetSubUnitId: p } = h, y = {
        startRow: o.row,
        startColumn: o.col,
        endColumn: o.col,
        endRow: o.row
      }, f = {
        startRow: s.row,
        startColumn: s.col,
        endColumn: s.col,
        endRow: s.row
      };
      Or.foreach(d, (w, I2) => {
        const R = En.getPositionRange(
          {
            startRow: w,
            startColumn: I2,
            endColumn: I2,
            endRow: w
          },
          y
        ), x = En.getPositionRange(
          {
            startRow: w,
            startColumn: I2,
            endColumn: I2,
            endRow: w
          },
          f
        ), T = this._conditionalFormattingViewModel.getCellCfs(
          l,
          u,
          R.startRow,
          R.startColumn
        ), g = this._conditionalFormattingViewModel.getCellCfs(
          v,
          p,
          x.startRow,
          x.startColumn
        );
        g && g.forEach((b) => {
          let S2 = a.get(b.cfId);
          if (!a.get(b.cfId)) {
            const C = this._conditionalFormattingRuleModel.getRule(v, p, b.cfId);
            if (!C)
              return;
            S2 = new pt(), C.ranges.forEach((M2) => {
              Or.foreach(M2, (E, V) => {
                S2.setValue(E, V, 1);
              });
            }), a.set(b.cfId, S2);
          }
          S2.realDeleteValue(x.startRow, x.startColumn);
        }), T && T.forEach((b) => {
          const S2 = a.get(b.cfId);
          S2 && S2.setValue(x.startRow, x.startColumn, 1);
        });
      });
    }, r = (o, s, d) => {
      var R;
      const { range: a, unitId: h, subUnitId: l } = this._painterConfig, u = o !== h || l !== s, v = /* @__PURE__ */ new Map(), p = [], y = [];
      if (!o || !s || !h || !l)
        return e();
      const f = (R = this._conditionalFormattingRuleModel.getSubunitRules(h, l)) != null ? R : [];
      f == null || f.forEach((x) => {
        const { ranges: T, cfId: g } = x;
        if (T.some((b) => En.intersects(a, b))) {
          const b = new pt();
          u || T.forEach((S2) => {
            Or.foreach(S2, (C, M2) => {
              b.setValue(C, M2, 1);
            });
          }), v.set(g, b);
        }
      });
      const w = {
        row: a.startRow,
        col: a.startColumn
      };
      return mo(a, d).forEach((x) => {
        n(w, { row: x.startRange.startRow, col: x.startRange.startColumn }, x.repeatRelativeRange, v, { targetUnitId: o, targetSubUnitId: s });
      }), v.forEach((x, T) => {
        if (u) {
          const g = this._conditionalFormattingRuleModel.getRule(o, s, T), b = Zo(mu(x));
          if (g)
            if (b.length) {
              const S2 = {
                unitId: o,
                subUnitId: s,
                rule: { ...g, ranges: b }
              };
              p.push({ id: o2.id, params: S2 }), y.push(...j2(this._injector, S2));
            } else {
              const S2 = {
                unitId: o,
                subUnitId: s,
                cfId: g.cfId
              };
              p.push({ id: K.id, params: S2 }), y.push(...w2(this._injector, S2));
            }
          else if (b.length) {
            const S2 = this._conditionalFormattingRuleModel.getRule(h, l, T);
            if (S2) {
              const C = {
                unitId: o,
                subUnitId: s,
                rule: {
                  ...J.deepClone(S2),
                  cfId: this._conditionalFormattingRuleModel.createCfId(o, s),
                  ranges: b
                }
              };
              p.push({ id: a2.id, params: C }), y.push(H2(this._injector, C));
            }
          }
        } else {
          const g = this._conditionalFormattingRuleModel.getRule(h, l, T);
          if (!g)
            return;
          const b = Zo(mu(x));
          if (b.length) {
            const S2 = {
              unitId: h,
              subUnitId: l,
              rule: { ...g, ranges: b }
            };
            p.push({ id: o2.id, params: S2 }), y.push(...j2(this._injector, S2));
          } else {
            const S2 = {
              unitId: h,
              subUnitId: l,
              cfId: g.cfId
            };
            p.push({ id: K.id, params: S2 }), y.push(...w2(this._injector, S2));
          }
        }
      }), {
        undos: y,
        redos: p
      };
    }, i = {
      id: Z2,
      onStatusChange: (o) => {
        var s, d, a;
        switch (o) {
          case zt.INFINITE:
          case zt.ONCE: {
            const h = (s = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : s.getUnitId(), l = (a = (d = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : d.getActiveSheet()) == null ? void 0 : a.getSheetId(), u = this._sheetsSelectionsService.getCurrentLastSelection(), v = u == null ? void 0 : u.range;
            h && l && v && (this._painterConfig = { unitId: h, subUnitId: l, range: v });
            break;
          }
          case zt.OFF: {
            this._painterConfig = null;
            break;
          }
        }
      },
      onApply: (o, s, d) => this._painterConfig ? r(o, s, d) : {
        redos: [],
        undos: []
      }
    };
    this._formatPainterService.addHook(i);
  }
};
Rt = go([
  $e(0, Inject(Injector)),
  $e(1, Inject(vr)),
  $e(2, Inject(Dn)),
  $e(3, Inject(z)),
  $e(4, Inject(M)),
  $e(5, Inject(Q))
], Rt);
var fo = Object.getOwnPropertyDescriptor;
var po = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? fo(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var $t = (t, e) => (n, r) => e(n, r, t);
var Tt = class extends Ve {
  constructor(t, e, n) {
    super(), this._conditionalFormattingViewModel = t, this._univerInstanceService = e, this._renderManagerService = n, this._init();
  }
  _init() {
    const t = this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET), e = (n) => {
      const r = n.getUnitId(), i = this._renderManagerService.getRenderById(r);
      if (!i)
        return;
      const o = i.with(ue);
      this.disposeWithMe(o.currentSkeleton$.subscribe((s) => {
        if (s) {
          const d = s.skeleton.rowColumnSegment, a = d.endColumn - d.startColumn + 1, l = (d.endRow - d.startRow + 1) * a * 9, u = Math.max(A2, l);
          this._conditionalFormattingViewModel.setCacheLength(u);
        }
      }));
    };
    t && e(t), this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).subscribe((n) => {
      n && e(n);
    });
  }
};
Tt = po([
  $t(0, Inject(Q)),
  $t(1, vr),
  $t(2, ME)
], Tt);
var Co = Object.defineProperty;
var yo = Object.getOwnPropertyDescriptor;
var bo = (t, e, n) => e in t ? Co(t, e, { enumerable: true, configurable: true, writable: true, value: n }) : t[e] = n;
var Io = (t, e, n, r) => {
  for (var i = r > 1 ? void 0 : r ? yo(e, n) : e, o = t.length - 1, s; o >= 0; o--)
    (s = t[o]) && (i = s(i) || i);
  return i;
};
var Dt = (t, e) => (n, r) => e(n, r, t);
var ir = (t, e, n) => bo(t, typeof e != "symbol" ? e + "" : e, n);
var xt2 = class extends Ol {
  constructor(t = bt2, e, n, r) {
    super(), this._config = t, this._injector = e, this._commandService = n, this._configService = r;
    const { menu: i, ...o } = oo(
      {},
      bt2,
      this._config
    );
    i && this._configService.setConfig("menu", i, { merge: true }), this._configService.setConfig(nr, o), this._initCommand();
  }
  onStarting() {
    GC(this._injector, [
      [nt],
      [tt],
      [Qe],
      [St],
      [et3],
      [Je],
      [wt],
      [He],
      [_t],
      [yt],
      [Rt],
      [Tt]
    ]), zc(this._injector, [
      [nt]
    ]);
  }
  onReady() {
    zc(this._injector, [
      [wt],
      [Je]
    ]);
  }
  onRendered() {
    zc(this._injector, [
      [St],
      [yt],
      [Qe],
      [_t],
      [He],
      [Rt],
      [et3],
      [tt],
      [Tt]
    ]);
  }
  _initCommand() {
    [
      On,
      $n,
      Dn2,
      An,
      Hn,
      jn,
      Bn,
      Wn,
      qn2,
      Mt
    ].forEach((t) => {
      this._commandService.registerCommand(t);
    });
  }
};
ir(xt2, "pluginName", `${Z2}_UI_PLUGIN`);
ir(xt2, "type", we.UNIVER_SHEET);
xt2 = Io([
  qR(N2),
  Dt(1, Inject(Injector)),
  Dt(2, Inject(Ls)),
  Dt(3, ic)
], xt2);

export {
  On,
  $n,
  Dn2 as Dn,
  An,
  Hn,
  jn,
  Bn,
  Wn,
  qn2 as qn,
  Mt,
  yt,
  It,
  xt2 as xt
};
//# sourceMappingURL=chunk-Y7AJ2W7V.js.map
