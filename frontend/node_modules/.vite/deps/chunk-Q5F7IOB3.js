import {
  C,
  Ea,
  Ee,
  F as F2,
  Ie,
  Ja,
  K,
  Ka,
  Q as Q2,
  Ra,
  Sa,
  Te,
  Ue,
  Ve as Ve4,
  Za,
  _e,
  ar,
  er,
  fa,
  fe as fe2,
  ga,
  ma,
  ne,
  oe,
  pa,
  tr,
  we as we3,
  za
} from "./chunk-ZKTLMAEM.js";
import {
  Ce,
  F,
  Q,
  Ve as Ve3,
  h,
  j,
  pe
} from "./chunk-VAEXAE3K.js";
import {
  st as st2
} from "./chunk-6335LBDU.js";
import {
  Cc,
  Wr
} from "./chunk-RWMUFXJB.js";
import {
  B1 as B12,
  Bi,
  Do2 as Do,
  H1,
  Hr,
  Le as Le2,
  Mr,
  Op,
  S1 as S12,
  Wi2 as Wi,
  Yn2 as Yn,
  Yy,
  ct,
  et2,
  fe,
  he,
  hi,
  nn,
  po,
  q1,
  qe2 as qe,
  r7,
  re,
  st,
  tt3 as tt,
  ue,
  useDependency,
  useObservable,
  we as we2,
  wr2 as wr,
  zy
} from "./chunk-DZMX4FYO.js";
import {
  B1,
  Dr,
  Ft,
  G,
  I1,
  IE,
  Kv,
  Le,
  ME,
  P,
  Pe,
  S1,
  Sn2 as Sn,
  Ve as Ve2,
  Z,
  Z4,
  fs2 as fs,
  g3,
  ha3 as ha,
  ht,
  ku,
  m6,
  og,
  qn,
  v1,
  v4,
  x3,
  yr,
  z
} from "./chunk-I7I3GTAS.js";
import {
  LE,
  TE,
  Vx,
  em,
  gE,
  hE,
  ie,
  kE,
  kt,
  require_jsx_runtime,
  require_react,
  vf,
  vr as vr2
} from "./chunk-YFGUMDM2.js";
import {
  BehaviorSubject,
  Bn,
  C1,
  En,
  Fn,
  Gg,
  Gi,
  HR,
  Inject,
  Injector,
  Ls,
  Ms,
  NC,
  Ol,
  Optional,
  Or,
  Subject,
  TC,
  Ut,
  Vc,
  Ve,
  We,
  _C,
  _R,
  ao,
  bt,
  bufferTime,
  debounceTime,
  distinctUntilChanged,
  eR,
  et,
  filter,
  fn,
  fo,
  gC,
  h1,
  ic,
  n1,
  of,
  oo,
  pt,
  qR,
  rt,
  sr,
  tn,
  vC,
  vr,
  we,
  xn,
  yC
} from "./chunk-RGZYGL3P.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/@univerjs/sheets-data-validation-ui/lib/es/index.js
var import_react = __toESM(require_react());
var import_jsx_runtime = __toESM(require_jsx_runtime());
var Tr = Object.defineProperty;
var Or2 = (e, t, n) => t in e ? Tr(e, t, { enumerable: true, configurable: true, writable: true, value: n }) : e[t] = n;
var V = (e, t, n) => Or2(e, typeof t != "symbol" ? t + "" : t, n);
var Ao = Object.getOwnPropertyDescriptor;
var Po = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Ao(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var kn = (e, t) => (n, r) => t(n, r, e);
var me = class extends Ve {
  constructor(t, n) {
    super();
    V(this, "_open$", new BehaviorSubject(false));
    V(this, "open$", this._open$.pipe(distinctUntilChanged()));
    V(this, "_activeRule");
    V(this, "_activeRule$", new BehaviorSubject(void 0));
    V(this, "activeRule$", this._activeRule$.asObservable());
    V(this, "_closeDisposable", null);
    this._univerInstanceService = t, this._sidebarService = n, this.disposeWithMe(
      this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(filter((r) => !r)).subscribe(() => {
        this.close();
      })
    ), this.disposeWithMe(this._sidebarService.sidebarOptions$.subscribe((r) => {
      r.id === Mt && (r.visible || setTimeout(() => {
        this._sidebarService.sidebarOptions$.next({ visible: false });
      }));
    }));
  }
  get activeRule() {
    return this._activeRule;
  }
  get isOpen() {
    return this._open$.getValue();
  }
  dispose() {
    var t;
    super.dispose(), this._open$.next(false), this._open$.complete(), this._activeRule$.complete(), (t = this._closeDisposable) == null || t.dispose();
  }
  open() {
    this._open$.next(true);
  }
  close() {
    var t;
    this._open$.next(false), (t = this._closeDisposable) == null || t.dispose();
  }
  setCloseDisposable(t) {
    this._closeDisposable = We(() => {
      t.dispose(), this._closeDisposable = null;
    });
  }
  setActiveRule(t) {
    this._activeRule = t, this._activeRule$.next(t);
  }
};
me = Po([
  kn(0, vr),
  kn(1, we2)
], me);
var Te2 = "#ECECEC";
var _n = "sheets-data-validation-ui.config";
var yt = {};
var Lo = Object.getOwnPropertyDescriptor;
var ko = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Lo(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var xe = (e, t) => (n, r) => t(n, r, e);
var Ge = class extends Ve {
  constructor(e, t, n, r, o, i) {
    super(), this._sheetInterceptorService = e, this._dataValidationModel = t, this._dataValidatorRegistryService = n, this._dialogService = r, this._localeService = o, this._sheetsDataValidationValidatorService = i, this._initEditorBridgeInterceptor();
  }
  _initEditorBridgeInterceptor() {
    this.disposeWithMe(this._sheetInterceptorService.writeCellInterceptor.intercept(
      fs,
      {
        handler: async (e, t, n) => {
          const r = await e, { row: o, col: i, unitId: a, subUnitId: l } = t, s = this._dataValidationModel.getRuleIdByLocation(a, l, o, i), d = s ? this._dataValidationModel.getRuleById(a, l, s) : void 0;
          if (r === false)
            return n(Promise.resolve(false));
          if (!d || d.errorStyle !== vC.STOP)
            return n(Promise.resolve(true));
          const u = this._dataValidatorRegistryService.getValidatorItem(d.type);
          return !u || await this._sheetsDataValidationValidatorService.validatorCell(a, l, o, i) === NC.VALID ? n(Promise.resolve(true)) : (this._dialogService.open({
            width: 368,
            title: {
              title: this._localeService.t("dataValidation.alert.title")
            },
            id: "reject-input-dialog",
            children: {
              title: u.getRuleFinalError(d, { row: o, col: i, unitId: a, subUnitId: l })
            },
            footer: {
              title: (0, import_react.createElement)(
                vr2,
                {
                  variant: "primary",
                  onClick: () => this._dialogService.close("reject-input-dialog")
                },
                this._localeService.t("dataValidation.alert.ok")
              )
            },
            onClose: () => {
              this._dialogService.close("reject-input-dialog");
            }
          }), n(Promise.resolve(false)));
        }
      }
    ));
  }
  showReject(e) {
    this._dialogService.open({
      width: 368,
      title: {
        title: this._localeService.t("dataValidation.alert.title")
      },
      id: "reject-input-dialog",
      children: {
        title: e
      },
      footer: {
        title: (0, import_react.createElement)(
          vr2,
          {
            variant: "primary",
            onClick: () => this._dialogService.close("reject-input-dialog")
          },
          this._localeService.t("dataValidation.alert.ok")
        )
      },
      onClose: () => {
        this._dialogService.close("reject-input-dialog");
      }
    });
  }
};
Ge = ko([
  xe(0, Inject(G)),
  xe(1, Inject(F2)),
  xe(2, Inject(F)),
  xe(3, ct),
  xe(4, Inject(Fn)),
  xe(5, Inject(we3))
], Ge);
var No = Object.getOwnPropertyDescriptor;
var Uo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? No(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var ue2 = (e, t) => (n, r) => t(n, r, e);
var Ft2 = (e) => {
  if (e == null || typeof e == "boolean")
    return;
  if (e === "") return tn();
  if (typeof e == "number" || !Number.isNaN(+e))
    return tn(eR.format("yyyy-MM-dd HH:mm:ss", Number(e)));
  const t = tn(e);
  if (t.isValid())
    return t;
};
function Fo(e, t) {
  const n = st2(t);
  if (e === n)
    return t;
  switch (e) {
    case "datetime":
      return "yyyy-MM-dd hh:mm:ss";
    case "date":
      return "yyyy-MM-dd";
    case "time":
      return "HH:mm:ss";
  }
}
var Ne = class extends Ve {
  constructor(t, n, r, o, i, a, l, s, d, u, p) {
    super();
    V(this, "_activeDropdown");
    V(this, "_activeDropdown$", new Subject());
    V(this, "_currentPopup", null);
    V(this, "activeDropdown$", this._activeDropdown$.asObservable());
    V(this, "_zenVisible", false);
    this._univerInstanceService = t, this._dataValidatorRegistryService = n, this._zenZoneService = r, this._dataValidationModel = o, this._sheetsSelectionsService = i, this._cellDropdownManagerService = a, this._sheetDataValidationModel = l, this._commandService = s, this._editorBridgeService = d, this._injector = u, this._configService = p, this._init(), this._initSelectionChange(), this.disposeWithMe(() => {
      this._activeDropdown$.complete();
    });
  }
  get activeDropdown() {
    return this._activeDropdown;
  }
  _init() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((t) => {
      this._zenVisible = t, t && this.hideDropdown();
    }));
  }
  _getDropdownByCell(t, n, r, o) {
    const i = t ? this._univerInstanceService.getUnit(t, we.UNIVER_SHEET) : this._univerInstanceService.getCurrentUnitForType(we.UNIVER_SHEET);
    if (!i)
      return;
    const a = n ? i.getSheetBySheetId(n) : i.getActiveSheet();
    if (!a)
      return;
    const l = this._dataValidationModel.getRuleByLocation(i.getUnitId(), a.getSheetId(), r, o);
    if (!l)
      return;
    const s = this._dataValidatorRegistryService.getValidatorItem(l.type);
    return s == null ? void 0 : s.dropdownType;
  }
  _initSelectionChange() {
    this.disposeWithMe(this._sheetsSelectionsService.selectionMoveEnd$.subscribe((t) => {
      t && t.every((n) => !(n.primary && this._getDropdownByCell(n.primary.unitId, n.primary.sheetId, n.primary.actualRow, n.primary.actualColumn))) && this.hideDropdown();
    }));
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  showDropdown(t) {
    var b, y, w, S;
    const { location: n } = t, { row: r, col: o, unitId: i, subUnitId: a, workbook: l, worksheet: s } = n;
    if (this._currentPopup && this._currentPopup.dispose(), this._zenVisible)
      return;
    this._activeDropdown = t, this._activeDropdown$.next(this._activeDropdown);
    const d = this._sheetDataValidationModel.getRuleByLocation(i, a, r, o);
    if (!d)
      return;
    const u = this._dataValidatorRegistryService.getValidatorItem(d.type);
    if (!(u != null && u.dropdownType))
      return;
    let p;
    const c = async (g, I) => {
      var D, O, k;
      if (!g)
        return true;
      const _ = g, v = s.getCell(r, o), R = _.format(I === "date" ? "YYYY-MM-DD 00:00:00" : "YYYY-MM-DD HH:mm:ss"), P2 = (D = eR.parseDate(R)) == null ? void 0 : D.v, N = I === "time" ? P2 % 1 : P2, T = l.getStyles().getStyleByCell(v), L = (k = (O = T == null ? void 0 : T.n) == null ? void 0 : O.pattern) != null ? k : "";
      return d.errorStyle !== vC.STOP || await u.validator({
        value: N,
        unitId: i,
        subUnitId: a,
        row: r,
        column: o,
        worksheet: s,
        workbook: l,
        interceptValue: R.replace("Z", "").replace("T", " "),
        t: fn.NUMBER
      }, d) ? (await this._commandService.executeCommand(Sn.id, {
        unitId: i,
        subUnitId: a,
        range: {
          startColumn: o,
          endColumn: o,
          startRow: r,
          endRow: r
        },
        value: {
          v: N,
          t: 2,
          p: null,
          f: null,
          si: null,
          s: {
            n: {
              pattern: Fo(I, L)
            }
          }
        }
      }), await this._commandService.executeCommand(tt.id, {
        visible: false,
        eventType: Kv.Keyboard,
        unitId: i,
        keycode: q1.ESC
      }), true) : (this._injector.has(Ge) && this._injector.get(Ge).showReject(u.getRuleFinalError(d, { row: r, col: o, unitId: i, subUnitId: a })), false);
    };
    let m;
    switch (u.dropdownType) {
      case Ve3.DATE: {
        const g = ne(s.getCellRaw(r, o)), I = Ft2(g), _ = !!((b = d.bizInfo) != null && b.showTime);
        m = {
          location: n,
          type: "datepicker",
          props: {
            showTime: _,
            onChange: (v) => c(v, _ ? "datetime" : "date"),
            defaultValue: I,
            patternType: "date"
          }
        };
        break;
      }
      case Ve3.TIME: {
        const g = ne(s.getCellRaw(r, o)), I = Ft2(g);
        m = {
          location: n,
          type: "datepicker",
          props: {
            onChange: (_) => c(_, "time"),
            defaultValue: I,
            patternType: "time"
          }
        };
        break;
      }
      case Ve3.DATETIME: {
        const g = ne(s.getCellRaw(r, o)), I = Ft2(g);
        m = {
          location: n,
          type: "datepicker",
          props: {
            onChange: (_) => c(_, "datetime"),
            defaultValue: I,
            patternType: "datetime"
          }
        };
        break;
      }
      case Ve3.LIST:
      case Ve3.MULTIPLE_LIST: {
        const g = u.dropdownType === Ve3.MULTIPLE_LIST, I = async (T) => {
          const L = Ka(T), D = {
            unitId: i,
            subUnitId: a,
            range: {
              startColumn: o,
              endColumn: o,
              startRow: r,
              endRow: r
            },
            value: {
              v: L,
              p: null,
              f: null,
              si: null
            }
          };
          return this._commandService.executeCommand(Sn.id, D), this._editorBridgeService.isVisible().visible && await this._commandService.executeCommand(tt.id, {
            visible: false,
            eventType: Kv.Keyboard,
            unitId: i,
            keycode: q1.ESC
          }), !g;
        }, _ = (d == null ? void 0 : d.renderMode) === yC.CUSTOM || (d == null ? void 0 : d.renderMode) === void 0, v = u.getListWithColor(d, i, a), R = za(s.getCellRaw(r, o)), P2 = () => {
          this._commandService.executeCommand(Fe.id, {
            ruleId: d.uid
          }), p == null || p.dispose();
        }, N = v.map((T) => ({
          label: T.label,
          value: T.label,
          color: _ || T.color ? T.color || Te2 : "transparent"
        }));
        m = {
          location: n,
          type: "list",
          props: {
            onChange: (T) => I(T),
            options: N,
            onEdit: P2,
            defaultValue: R,
            multiple: g,
            showEdit: (w = (y = this._configService.getConfig(_n)) == null ? void 0 : y.showEditOnDropdown) != null ? w : true
          }
        };
        break;
      }
      case Ve3.CASCADE: {
        m = {
          type: "cascader",
          props: {
            onChange: (I) => {
              const _ = {
                unitId: i,
                subUnitId: a,
                range: {
                  startColumn: o,
                  endColumn: o,
                  startRow: r,
                  endRow: r
                },
                value: {
                  v: I.join("/"),
                  p: null,
                  f: null,
                  si: null
                }
              };
              return this._commandService.syncExecuteCommand(Sn.id, _), this._editorBridgeService.isVisible().visible && this._commandService.syncExecuteCommand(tt.id, {
                visible: false,
                eventType: Kv.Keyboard,
                unitId: i,
                keycode: q1.ESC
              }), true;
            },
            defaultValue: za(s.getCellRaw(r, o)).split("/"),
            options: JSON.parse((S = d.formula1) != null ? S : "[]")
          },
          location: n
        };
        break;
      }
      case Ve3.COLOR: {
        m = {
          type: "color",
          props: {
            onChange: (I) => {
              const _ = {
                unitId: i,
                subUnitId: a,
                range: {
                  startColumn: o,
                  endColumn: o,
                  startRow: r,
                  endRow: r
                },
                value: {
                  v: I,
                  p: null,
                  f: null,
                  si: null
                }
              };
              return this._commandService.syncExecuteCommand(Sn.id, _), this._editorBridgeService.isVisible().visible && this._commandService.syncExecuteCommand(tt.id, {
                visible: false,
                eventType: Kv.Keyboard,
                unitId: i,
                keycode: q1.ESC
              }), true;
            },
            defaultValue: za(s.getCellRaw(r, o))
          },
          location: n
        };
        break;
      }
      default:
        throw new Error("[DataValidationDropdownManagerService]: unknown type!");
    }
    if (p = this._cellDropdownManagerService.showDropdown({
      ...m,
      onHide: () => {
        this._activeDropdown = null, this._activeDropdown$.next(null);
      }
    }), !p)
      throw new Error("[DataValidationDropdownManagerService]: cannot show dropdown!");
    const h2 = new ao();
    h2.add(p), h2.add({
      dispose: () => {
        var g, I;
        (I = (g = this._activeDropdown) == null ? void 0 : g.onHide) == null || I.call(g);
      }
    }), this._currentPopup = h2;
  }
  hideDropdown() {
    this._activeDropdown && (this._currentPopup && this._currentPopup.dispose(), this._currentPopup = null, this._activeDropdown = null, this._activeDropdown$.next(null));
  }
  showDataValidationDropdown(t, n, r, o, i) {
    const a = this._univerInstanceService.getUnit(t, we.UNIVER_SHEET);
    if (!a)
      return;
    const l = a.getSheetBySheetId(n);
    if (!l)
      return;
    const s = this._dataValidationModel.getRuleByLocation(a.getUnitId(), l.getSheetId(), r, o);
    if (!s)
      return;
    const d = this._dataValidatorRegistryService.getValidatorItem(s.type);
    if (!d || !d.dropdownType) {
      this.hideDropdown();
      return;
    }
    this.showDropdown({
      location: {
        workbook: a,
        worksheet: l,
        row: r,
        col: o,
        unitId: t,
        subUnitId: n
      },
      onHide: i
    });
  }
};
Ne = Uo([
  ue2(0, vr),
  ue2(1, Inject(F)),
  ue2(2, st),
  ue2(3, Inject(F2)),
  ue2(4, Inject(z)),
  ue2(5, Inject(Op)),
  ue2(6, Inject(F2)),
  ue2(7, Ls),
  ue2(8, qe),
  ue2(9, Inject(Injector)),
  ue2(10, ic)
], Ne);
var Mt = "DataValidationPanel";
var Fe = {
  id: "data-validation.operation.open-validation-panel",
  type: Ms.OPERATION,
  handler(e, t) {
    if (!t)
      return false;
    const { ruleId: n, isAdd: r } = t, o = e.get(me), i = e.get(h), a = e.get(vr), l = e.get(we2), s = P(a);
    if (!s) return false;
    const { unitId: d, subUnitId: u } = s, p = n ? i.getRuleById(d, u, n) : void 0;
    o.open(), o.setActiveRule(p && {
      unitId: d,
      subUnitId: u,
      rule: p
    });
    const c = l.open({
      id: Mt,
      header: { title: r ? "dataValidation.panel.addTitle" : "dataValidation.panel.title" },
      children: { label: Mt },
      width: 312,
      onClose: () => o.close()
    });
    return o.setCloseDisposable(c), true;
  }
};
var Cn = {
  id: "data-validation.operation.close-validation-panel",
  type: Ms.OPERATION,
  handler(e) {
    return e.get(me).close(), true;
  }
};
var mr = {
  id: "data-validation.operation.toggle-validation-panel",
  type: Ms.OPERATION,
  handler(e) {
    const t = e.get(Ls), n = e.get(me);
    return n.open(), n.isOpen ? t.executeCommand(Cn.id) : t.executeCommand(Fe.id), true;
  }
};
var Pt = {
  type: Ms.OPERATION,
  id: "sheet.operation.show-data-validation-dropdown",
  handler(e, t) {
    if (!t)
      return false;
    const n = e.get(Ne), { unitId: r, subUnitId: o, row: i, column: a } = t, l = n.activeDropdown, s = l == null ? void 0 : l.location;
    return s && s.unitId === r && s.subUnitId === o && s.row === i && s.col === a || n.showDataValidationDropdown(
      r,
      o,
      i,
      a
    ), true;
  }
};
var fr = {
  type: Ms.OPERATION,
  id: "sheet.operation.hide-data-validation-dropdown",
  handler(e, t) {
    return t ? (e.get(Ne).hideDropdown(), true) : false;
  }
};
var Lt = {
  type: Ms.COMMAND,
  id: "data-validation.command.addRuleAndOpen",
  handler(e) {
    const t = e.get(vr), n = P(t);
    if (!n) return false;
    const { workbook: r, worksheet: o } = n, i = Za(e), a = e.get(Ls), l = r.getUnitId(), s = o.getSheetId(), d = {
      rule: i,
      unitId: l,
      subUnitId: s
    };
    return a.syncExecuteCommand(ga.id, d) ? (a.syncExecuteCommand(Fe.id, {
      ruleId: i.uid,
      isAdd: true
    }), true) : false;
  }
};
var $o = Object.getOwnPropertyDescriptor;
var xo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? $o(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Be = (e, t) => (n, r) => t(n, r, e);
var be = "SHEET_DATA_VALIDATION_ALERT";
var ut = class extends Ve {
  constructor(e, t, n, r, o, i) {
    super(), this._hoverManagerService = e, this._cellAlertManagerService = t, this._univerInstanceService = n, this._localeService = r, this._zenZoneService = o, this._dataValidationModel = i, this._init();
  }
  _init() {
    this._initCellAlertPopup(), this._initZenService();
  }
  _initCellAlertPopup() {
    this.disposeWithMe(this._hoverManagerService.currentCell$.pipe(debounceTime(100)).subscribe((e) => {
      var t;
      if (e) {
        const n = this._univerInstanceService.getUnit(e.location.unitId, we.UNIVER_SHEET), r = n.getSheetBySheetId(e.location.subUnitId);
        if (!r) return;
        const o = this._dataValidationModel.getRuleByLocation(e.location.unitId, e.location.subUnitId, e.location.row, e.location.col);
        if (!o) {
          this._cellAlertManagerService.removeAlert(be);
          return;
        }
        if (this._dataValidationModel.validator(o, { ...e.location, workbook: n, worksheet: r }) === NC.INVALID) {
          const a = this._cellAlertManagerService.currentAlert.get(be), l = (t = a == null ? void 0 : a.alert) == null ? void 0 : t.location;
          if (l && l.row === e.location.row && l.col === e.location.col && l.subUnitId === e.location.subUnitId && l.unitId === e.location.unitId) {
            this._cellAlertManagerService.removeAlert(be);
            return;
          }
          const s = this._dataValidationModel.getValidator(o.type);
          if (!s) {
            this._cellAlertManagerService.removeAlert(be);
            return;
          }
          this._cellAlertManagerService.showAlert({
            type: po.ERROR,
            title: this._localeService.t("dataValidation.error.title"),
            message: s == null ? void 0 : s.getRuleFinalError(o, e.location),
            location: e.location,
            width: 200,
            height: 74,
            key: be
          });
          return;
        }
      }
      this._cellAlertManagerService.removeAlert(be);
    }));
  }
  _initZenService() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((e) => {
      e && this._cellAlertManagerService.removeAlert(be);
    }));
  }
};
ut = xo([
  Be(0, Inject(Mr)),
  Be(1, Inject(Do)),
  Be(2, vr),
  Be(3, Inject(Fn)),
  Be(4, st),
  Be(5, Inject(F2))
], ut);
var Bo = Object.getOwnPropertyDescriptor;
var Wo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Bo(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var $t = (e, t) => (n, r) => t(n, r, e);
var ze = class extends Ve {
  constructor(e, t, n) {
    super(), this._autoFillService = e, this._sheetDataValidationModel = t, this._injector = n, this._initAutoFill();
  }
  // eslint-disable-next-line max-lines-per-function
  _initAutoFill() {
    const e = () => ({ redos: [], undos: [] }), t = (r, o) => {
      const { source: i, target: a, unitId: l, subUnitId: s } = r, d = this._sheetDataValidationModel.getRuleObjectMatrix(l, s).clone(), u = wr([i, a]), [p, c] = u.ranges, { mapFunc: m } = u, h2 = {
        row: p.startRow,
        col: p.startColumn
      }, b = zy(p, c), y = new pt(), w = /* @__PURE__ */ new Set();
      b.forEach((v) => {
        const R = v.repeatStartCell, P2 = v.relativeRange, N = {
          startRow: h2.row,
          startColumn: h2.col,
          endColumn: h2.col,
          endRow: h2.row
        }, T = {
          startRow: R.row,
          startColumn: R.col,
          endColumn: R.col,
          endRow: R.row
        };
        Or.foreach(P2, (L, D) => {
          const O = En.getPositionRange(
            {
              startRow: L,
              startColumn: D,
              endColumn: D,
              endRow: L
            },
            N
          ), { row: k, col: x } = m(O.startRow, O.startColumn), G2 = this._sheetDataValidationModel.getRuleIdByLocation(l, s, k, x) || "", te = En.getPositionRange(
            {
              startRow: L,
              startColumn: D,
              endColumn: D,
              endRow: L
            },
            T
          ), { row: B, col: ne2 } = m(te.startRow, te.startColumn);
          y.setValue(B, ne2, G2), w.add(G2);
        });
      });
      const S = Array.from(w).map((v) => ({ id: v, ranges: _R(y, (R) => R === v) }));
      d.addRangeRules(S);
      const g = d.diff(this._sheetDataValidationModel.getRules(l, s)), { redoMutations: I, undoMutations: _ } = Ue(l, s, g, this._injector, "patched", o === Le2.ONLY_FORMAT);
      return {
        undos: _,
        redos: I
      };
    }, n = {
      id: Ea,
      onBeforeFillData: (r) => {
        const { source: o, unitId: i, subUnitId: a } = r;
        for (const l of o.rows)
          for (const s of o.cols) {
            const d = this._sheetDataValidationModel.getRuleByLocation(i, a, l, s);
            if (d && d.type === TC.CHECKBOX) {
              this._autoFillService.setDisableApplyType(Le2.SERIES, true);
              return;
            }
          }
      },
      onFillData: (r, o, i) => i === Le2.COPY || i === Le2.ONLY_FORMAT || i === Le2.SERIES ? t(r, i) : e(),
      onAfterFillData: () => {
      }
    };
    this.disposeWithMe(this._autoFillService.addHook(n));
  }
};
ze = Wo([
  $t(0, Hr),
  $t(1, Inject(F2)),
  $t(2, Inject(Injector))
], ze);
var Ho = Object.getOwnPropertyDescriptor;
var jo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Ho(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var xt = (e, t) => (n, r) => t(n, r, e);
var qe2 = class extends Ve {
  constructor(t, n, r) {
    super();
    V(this, "_copyInfo");
    this._sheetClipboardService = t, this._sheetDataValidationModel = n, this._injector = r, this._initCopyPaste();
  }
  _initCopyPaste() {
    this._sheetClipboardService.addClipboardHook({
      id: Ea,
      onBeforeCopy: (t, n, r) => this._collect(t, n, r),
      onPasteCells: (t, n, r, o) => {
        const { copyType: i = Yn.COPY, pasteType: a } = o, { range: l } = t || {}, { range: s, unitId: d, subUnitId: u } = n;
        return this._generateMutations(s, { copyType: i, pasteType: a, copyRange: l, unitId: d, subUnitId: u });
      }
    });
  }
  _collect(t, n, r) {
    const o = new pt();
    this._copyInfo = {
      unitId: t,
      subUnitId: n,
      matrix: o
    };
    const i = this._injector.invoke((s) => ku(r, s, t, n));
    if (!i)
      return;
    const { rows: a, cols: l } = i;
    a.forEach((s, d) => {
      l.forEach((u, p) => {
        const c = this._sheetDataValidationModel.getRuleIdByLocation(t, n, s, u);
        o.setValue(d, p, c != null ? c : "");
      });
    });
  }
  // eslint-disable-next-line max-lines-per-function
  _generateMutations(t, n) {
    if (!this._copyInfo)
      return { redos: [], undos: [] };
    if (n.copyType === Yn.CUT)
      return this._copyInfo = null, { redos: [], undos: [] };
    if (!this._copyInfo || !this._copyInfo.matrix.getSizeOf() || !n.copyRange)
      return { redos: [], undos: [] };
    if ([
      et2.SPECIAL_PASTE_COL_WIDTH,
      et2.SPECIAL_PASTE_VALUE,
      et2.SPECIAL_PASTE_FORMAT,
      et2.SPECIAL_PASTE_FORMULA
    ].includes(n.pasteType))
      return { redos: [], undos: [] };
    const { unitId: o, subUnitId: i } = this._copyInfo;
    if (n.unitId !== o || i !== n.subUnitId) {
      const a = this._sheetDataValidationModel.getRuleObjectMatrix(n.unitId, n.subUnitId).clone(), l = new pt(), s = /* @__PURE__ */ new Set(), { ranges: [d, u], mapFunc: p } = wr([n.copyRange, t]), c = Yy(d, u, true), m = /* @__PURE__ */ new Map();
      c.forEach(({ startRange: w }) => {
        var S;
        (S = this._copyInfo) == null || S.matrix.forValue((g, I, _) => {
          const v = En.getPositionRange(
            {
              startRow: g,
              endRow: g,
              startColumn: I,
              endColumn: I
            },
            w
          ), R = `${i}-${_}`, P2 = this._sheetDataValidationModel.getRuleById(o, i, _);
          !this._sheetDataValidationModel.getRuleById(n.unitId, n.subUnitId, R) && P2 && m.set(R, { ...P2, uid: R });
          const { row: N, col: T } = p(v.startRow, v.startColumn);
          s.add(R), l.setValue(N, T, R);
        });
      });
      const h2 = Array.from(s).map((w) => ({ id: w, ranges: _R(l, (S) => S === w) }));
      a.addRangeRules(h2);
      const { redoMutations: b, undoMutations: y } = Ue(
        n.unitId,
        n.subUnitId,
        a.diffWithAddition(this._sheetDataValidationModel.getRules(n.unitId, n.subUnitId), m.values()),
        this._injector,
        "patched",
        false
      );
      return {
        redos: b,
        undos: y
      };
    } else {
      const a = this._sheetDataValidationModel.getRuleObjectMatrix(o, i).clone(), l = new pt(), s = /* @__PURE__ */ new Set(), { ranges: [d, u], mapFunc: p } = wr([n.copyRange, t]);
      Yy(d, u, true).forEach(({ startRange: y }) => {
        var w;
        (w = this._copyInfo) == null || w.matrix.forValue((S, g, I) => {
          const _ = En.getPositionRange(
            {
              startRow: S,
              endRow: S,
              startColumn: g,
              endColumn: g
            },
            y
          ), { row: v, col: R } = p(_.startRow, _.startColumn);
          l.setValue(v, R, I), s.add(I);
        });
      });
      const m = Array.from(s).map((y) => ({ id: y, ranges: _R(l, (w) => w === y) }));
      a.addRangeRules(m);
      const { redoMutations: h2, undoMutations: b } = Ue(
        o,
        i,
        a.diff(this._sheetDataValidationModel.getRules(o, i)),
        this._injector,
        "patched",
        false
      );
      return {
        redos: h2,
        undos: b
      };
    }
  }
};
qe2 = jo([
  xt(0, nn),
  xt(1, Inject(F2)),
  xt(2, Inject(Injector))
], qe2);
var Yo = Object.getOwnPropertyDescriptor;
var Xo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Yo(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Bt = (e, t) => (n, r) => t(n, r, e);
var Je = class extends Ve {
  constructor(e, t, n) {
    super(), this._localeService = e, this._commandService = t, this._sheetPermissionCheckController = n, this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((e) => {
        e.id === ga.id && (this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [Pe],
          rangeTypes: [Le],
          worksheetTypes: [Ve2, yr]
        }) || this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localeService.t("permission.dialog.setStyleErr"))), e.id === ma.id && (this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [Pe],
          rangeTypes: [Le],
          worksheetTypes: [Ve2, yr]
        }, e.params.ranges) || this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localeService.t("permission.dialog.setStyleErr")));
      })
    );
  }
};
Je = Xo([
  Bt(0, Inject(Fn)),
  Bt(1, Ls),
  Bt(2, Inject(qn))
], Je);
var _r = "sheet.menu.data-validation";
function Zo(e) {
  return {
    id: _r,
    type: H1.SUBITEMS,
    icon: "DataValidationIcon",
    tooltip: "dataValidation.title",
    hidden$: Bi(e, we.UNIVER_SHEET),
    disabled$: he(e, { workbookTypes: [Pe], worksheetTypes: [yr, Ve2], rangeTypes: [Le] })
  };
}
function Ko(e) {
  return {
    id: Fe.id,
    title: "dataValidation.panel.title",
    type: H1.BUTTON
  };
}
function Go(e) {
  return {
    id: Lt.id,
    title: "dataValidation.panel.add",
    type: H1.BUTTON
  };
}
var zo = {
  [fe.RULES]: {
    [_r]: {
      order: 0,
      menuItemFactory: Zo,
      [Fe.id]: {
        order: 0,
        menuItemFactory: Ko
      },
      [Lt.id]: {
        order: 1,
        menuItemFactory: Go
      }
    }
  }
};
var qo = Object.getOwnPropertyDescriptor;
var Cr = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? qo(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var K2 = (e, t) => (n, r) => t(n, r, e);
var Sr = {
  tr: {
    size: 6,
    color: "#fe4b4b"
  }
};
var Qe = class extends h1 {
  constructor(e, t, n, r, o, i, a, l, s, d, u) {
    super(), this._commandService = e, this._menuManagerService = t, this._renderManagerService = n, this._univerInstanceService = r, this._autoHeightController = o, this._dropdownManagerService = i, this._sheetDataValidationModel = a, this._dataValidatorRegistryService = l, this._sheetInterceptorService = s, this._dataValidationCacheService = d, this._editorBridgeService = u, this._initMenu(), this._initDropdown(), this._initViewModelIntercept(), this._initAutoHeight();
  }
  _initMenu() {
    this._menuManagerService.mergeMenu(zo);
  }
  _initDropdown() {
    this._editorBridgeService && this.disposeWithMe(this._editorBridgeService.visible$.subscribe((e) => {
      var n;
      if (!e.visible) {
        ((n = this._dropdownManagerService.activeDropdown) == null ? void 0 : n.trigger) === "editor-bridge" && this._dropdownManagerService.hideDropdown();
        return;
      }
      const t = this._editorBridgeService.getEditCellState();
      if (t) {
        const { unitId: r, sheetId: o, row: i, column: a } = t, l = this._univerInstanceService.getUniverSheetInstance(r);
        if (!l)
          return;
        const s = this._sheetDataValidationModel.getRuleByLocation(r, o, i, a);
        if (!s)
          return;
        const d = this._dataValidatorRegistryService.getValidatorItem(s.type);
        if (!(d != null && d.dropdownType))
          return;
        const u = l.getActiveSheet();
        if (!u) return;
        const p = this._dropdownManagerService.activeDropdown, c = p == null ? void 0 : p.location;
        if (c && c.unitId === r && c.subUnitId === o && c.row === i && c.col === a)
          return;
        this._dropdownManagerService.showDropdown(
          {
            location: {
              unitId: r,
              subUnitId: o,
              row: i,
              col: a,
              workbook: l,
              worksheet: u
            },
            trigger: "editor-bridge",
            closeOnOutSide: false
          }
        );
      }
    }));
  }
  // eslint-disable-next-line max-lines-per-function
  _initViewModelIntercept() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(
        ht.CELL_CONTENT,
        {
          effect: sr.Style,
          // must be after numfmt
          priority: ha.DATA_VALIDATION,
          // eslint-disable-next-line max-lines-per-function, complexity
          handler: (e, t, n) => {
            var w, S, g, I, _;
            const { row: r, col: o, unitId: i, subUnitId: a, workbook: l, worksheet: s } = t, d = this._sheetDataValidationModel.getRuleIdByLocation(i, a, r, o);
            if (!d)
              return n(e);
            const u = this._sheetDataValidationModel.getRuleById(i, a, d);
            if (!u)
              return n(e);
            const p = (w = this._dataValidationCacheService.getValue(i, a, r, o)) != null ? w : NC.VALID, c = this._dataValidatorRegistryService.getValidatorItem(u.type), m = t.rawData;
            let h2;
            const b = {
              get value() {
                var v;
                return h2 !== void 0 || (h2 = (v = ne(m)) != null ? v : null), h2;
              }
            }, y = {
              get value() {
                var v;
                return `${(v = b.value) != null ? v : ""}`;
              }
            };
            return (!e || e === t.rawData) && (e = { ...t.rawData }), e.markers = {
              ...e == null ? void 0 : e.markers,
              ...p === NC.INVALID ? Sr : null
            }, e.customRender = [
              ...(S = e == null ? void 0 : e.customRender) != null ? S : [],
              ...c != null && c.canvasRender ? [c.canvasRender] : []
            ], e.fontRenderExtension = {
              ...e == null ? void 0 : e.fontRenderExtension,
              isSkip: ((g = e == null ? void 0 : e.fontRenderExtension) == null ? void 0 : g.isSkip) || ((I = c == null ? void 0 : c.skipDefaultFontRender) == null ? void 0 : I.call(c, u, b.value, t))
            }, e.interceptorStyle = {
              ...e == null ? void 0 : e.interceptorStyle,
              ...c == null ? void 0 : c.getExtraStyle(u, y.value, {
                get style() {
                  const v = l.getStyles();
                  return (typeof (e == null ? void 0 : e.s) == "string" ? v.get(e == null ? void 0 : e.s) : e == null ? void 0 : e.s) || {};
                }
              }, r, o)
            }, e.interceptorAutoHeight = () => {
              var N, T, L, D, O, k;
              const v = (T = (N = this._renderManagerService.getRenderById(i)) == null ? void 0 : N.with(ue).getSkeletonParam(a)) == null ? void 0 : T.skeleton;
              if (!v)
                return;
              const R = v.worksheet.getMergedCell(r, o), P2 = {
                data: e,
                style: v.getStyles().getStyleByCell(e),
                primaryWithCoord: v.getCellWithCoordByIndex((L = R == null ? void 0 : R.startRow) != null ? L : r, (D = R == null ? void 0 : R.startColumn) != null ? D : o),
                unitId: i,
                subUnitId: a,
                row: r,
                col: o,
                workbook: l,
                worksheet: s
              };
              return (k = (O = c == null ? void 0 : c.canvasRender) == null ? void 0 : O.calcCellAutoHeight) == null ? void 0 : k.call(O, P2);
            }, e.interceptorAutoWidth = () => {
              var N, T, L, D, O, k;
              const v = (T = (N = this._renderManagerService.getRenderById(i)) == null ? void 0 : N.with(ue).getSkeletonParam(a)) == null ? void 0 : T.skeleton;
              if (!v)
                return;
              const R = v.worksheet.getMergedCell(r, o), P2 = {
                data: e,
                style: v.getStyles().getStyleByCell(e),
                primaryWithCoord: v.getCellWithCoordByIndex((L = R == null ? void 0 : R.startRow) != null ? L : r, (D = R == null ? void 0 : R.startColumn) != null ? D : o),
                unitId: i,
                subUnitId: a,
                row: r,
                col: o,
                workbook: l,
                worksheet: s
              };
              return (k = (O = c == null ? void 0 : c.canvasRender) == null ? void 0 : O.calcCellAutoWidth) == null ? void 0 : k.call(O, P2);
            }, e.coverable = ((_ = e == null ? void 0 : e.coverable) != null ? _ : true) && !(u.type === TC.LIST || u.type === TC.LIST_MULTIPLE), n(e);
          }
        }
      )
    );
  }
  _initAutoHeight() {
    this._sheetDataValidationModel.ruleChange$.pipe(
      // patched data-validation change don't need to re-calc row height
      // re-calc of row height will be triggered precisely by the origin command
      filter((e) => e.source === "command"),
      bufferTime(100)
    ).subscribe((e) => {
      if (e.length === 0)
        return;
      const t = [];
      if (e.forEach((n) => {
        var r;
        (n.rule.type === TC.LIST_MULTIPLE || n.rule.type === TC.LIST) && (r = n.rule) != null && r.ranges && t.push(...n.rule.ranges);
      }), t.length) {
        const n = this._autoHeightController.getUndoRedoParamsOfAutoHeight(t);
        fo(n.redos, this._commandService);
      }
    });
  }
};
Qe = Cr([
  K2(0, Ls),
  K2(1, B12),
  K2(2, ME),
  K2(3, vr),
  K2(4, Inject(hi)),
  K2(5, Inject(Ne)),
  K2(6, Inject(F2)),
  K2(7, Inject(F)),
  K2(8, Inject(G)),
  K2(9, Inject(Q2)),
  K2(10, Optional(qe))
], Qe);
var Nn = class extends h1 {
  constructor(e, t, n, r, o, i, a) {
    super(), this._commandService = e, this._renderManagerService = t, this._autoHeightController = n, this._dataValidatorRegistryService = r, this._sheetInterceptorService = o, this._sheetDataValidationModel = i, this._dataValidationCacheService = a, this._initViewModelIntercept(), this._initAutoHeight();
  }
  // eslint-disable-next-line max-lines-per-function
  _initViewModelIntercept() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(
        ht.CELL_CONTENT,
        {
          effect: sr.Style,
          // must be after numfmt
          priority: ha.DATA_VALIDATION,
          // eslint-disable-next-line complexity, max-lines-per-function
          handler: (e, t, n) => {
            var y, w, S, g, I;
            const { row: r, col: o, unitId: i, subUnitId: a, workbook: l, worksheet: s } = t, d = this._sheetDataValidationModel.getRuleIdByLocation(i, a, r, o);
            if (!d)
              return n(e);
            const u = this._sheetDataValidationModel.getRuleById(i, a, d);
            if (!u)
              return n(e);
            const p = (y = this._dataValidationCacheService.getValue(i, a, r, o)) != null ? y : NC.VALID, c = this._dataValidatorRegistryService.getValidatorItem(u.type), m = s.getCellRaw(r, o), h2 = ne(m), b = `${h2 != null ? h2 : ""}`;
            return (!e || e === t.rawData) && (e = { ...t.rawData }), e.markers = {
              ...e == null ? void 0 : e.markers,
              ...p === NC.INVALID ? Sr : null
            }, e.customRender = [
              ...(w = e == null ? void 0 : e.customRender) != null ? w : [],
              ...c != null && c.canvasRender ? [c.canvasRender] : []
            ], e.fontRenderExtension = {
              ...e == null ? void 0 : e.fontRenderExtension,
              isSkip: ((S = e == null ? void 0 : e.fontRenderExtension) == null ? void 0 : S.isSkip) || ((g = c == null ? void 0 : c.skipDefaultFontRender) == null ? void 0 : g.call(c, u, h2, t))
            }, e.interceptorStyle = {
              ...e == null ? void 0 : e.interceptorStyle,
              ...c == null ? void 0 : c.getExtraStyle(u, b, {
                get style() {
                  const _ = l.getStyles();
                  return (typeof (e == null ? void 0 : e.s) == "string" ? _.get(e == null ? void 0 : e.s) : e == null ? void 0 : e.s) || {};
                }
              }, r, o)
            }, e.interceptorAutoHeight = () => {
              var P2, N, T, L, D, O;
              const _ = (N = (P2 = this._renderManagerService.getRenderById(i)) == null ? void 0 : P2.with(ue).getSkeletonParam(a)) == null ? void 0 : N.skeleton;
              if (!_)
                return;
              const v = _.worksheet.getMergedCell(r, o), R = {
                data: e,
                style: _.getStyles().getStyleByCell(e),
                primaryWithCoord: _.getCellWithCoordByIndex((T = v == null ? void 0 : v.startRow) != null ? T : r, (L = v == null ? void 0 : v.startColumn) != null ? L : o),
                unitId: i,
                subUnitId: a,
                row: r,
                col: o,
                workbook: l,
                worksheet: s
              };
              return (O = (D = c == null ? void 0 : c.canvasRender) == null ? void 0 : D.calcCellAutoHeight) == null ? void 0 : O.call(D, R);
            }, e.interceptorAutoWidth = () => {
              var P2, N, T, L, D, O;
              const _ = (N = (P2 = this._renderManagerService.getRenderById(i)) == null ? void 0 : P2.with(ue).getSkeletonParam(a)) == null ? void 0 : N.skeleton;
              if (!_)
                return;
              const v = _.worksheet.getMergedCell(r, o), R = {
                data: e,
                style: _.getStyles().getStyleByCell(e),
                primaryWithCoord: _.getCellWithCoordByIndex((T = v == null ? void 0 : v.startRow) != null ? T : r, (L = v == null ? void 0 : v.startColumn) != null ? L : o),
                unitId: i,
                subUnitId: a,
                row: r,
                col: o,
                workbook: l,
                worksheet: s
              };
              return (O = (D = c == null ? void 0 : c.canvasRender) == null ? void 0 : D.calcCellAutoWidth) == null ? void 0 : O.call(D, R);
            }, e.coverable = ((I = e == null ? void 0 : e.coverable) != null ? I : true) && !(u.type === TC.LIST || u.type === TC.LIST_MULTIPLE), n(e);
          }
        }
      )
    );
  }
  _initAutoHeight() {
    this._sheetDataValidationModel.ruleChange$.pipe(
      filter((e) => e.source === "command"),
      bufferTime(16)
    ).subscribe((e) => {
      const t = [];
      if (e.forEach((n) => {
        var r;
        (n.rule.type === TC.LIST_MULTIPLE || n.rule.type === TC.LIST) && (r = n.rule) != null && r.ranges && t.push(...n.rule.ranges);
      }), t.length) {
        const n = this._autoHeightController.getUndoRedoParamsOfAutoHeight(t);
        fo(n.redos, this._commandService);
      }
    });
  }
};
Nn = Cr([
  K2(0, Ls),
  K2(1, ME),
  K2(2, Inject(hi)),
  K2(3, Inject(F)),
  K2(4, Inject(G)),
  K2(5, Inject(F2)),
  K2(6, Inject(Q2))
], Nn);
var Jo = Object.getOwnPropertyDescriptor;
var Qo = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Jo(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Un = (e, t) => (n, r) => t(n, r, e);
var bt2 = class extends Ve {
  constructor(e, t, n) {
    super(), this._context = e, this._sheetDataValidationModel = t, this._sheetSkeletonManagerService = n, this._initSkeletonChange();
  }
  _initSkeletonChange() {
    const e = (t) => {
      var r;
      if (!t.length)
        return;
      const n = /* @__PURE__ */ new Set();
      t.forEach((o) => {
        n.add(o.subUnitId);
      }), n.forEach((o) => {
        var i;
        (i = this._sheetSkeletonManagerService.getSkeletonParam(o)) == null || i.skeleton.makeDirty(true);
      }), (r = this._context.mainComponent) == null || r.makeForceDirty();
    };
    this.disposeWithMe(this._sheetDataValidationModel.validStatusChange$.pipe(C1(16)).subscribe(e));
  }
};
bt2 = Qo([
  Un(1, Inject(F2)),
  Un(2, Inject(ue))
], bt2);
function $e({ ref: e, ...t }) {
  const { icon: n, id: r, className: o, extend: i, ...a } = t, l = `univerjs-icon univerjs-icon-${r} ${o || ""}`.trim(), s = (0, import_react.useRef)(`_${ni()}`);
  return wr2(n, `${r}`, {
    defIds: n.defIds,
    idSuffix: s.current
  }, {
    ref: e,
    className: l,
    ...a
  }, i);
}
function wr2(e, t, n, r, o) {
  return (0, import_react.createElement)(e.tag, {
    key: t,
    ...ei(e, n, o),
    ...r
  }, (ti(e, n).children || []).map((i, a) => wr2(i, `${t}-${e.tag}-${a}`, n, void 0, o)));
}
function ei(e, t, n) {
  const r = { ...e.attrs };
  n != null && n.colorChannel1 && r.fill === "colorChannel1" && (r.fill = n.colorChannel1), e.tag === "mask" && r.id && (r.id = r.id + t.idSuffix), Object.entries(r).forEach(([i, a]) => {
    i === "mask" && typeof a == "string" && (r[i] = a.replace(/url\(#(.*)\)/, `url(#$1${t.idSuffix})`));
  });
  const { defIds: o } = t;
  return !o || o.length === 0 || (e.tag === "use" && r["xlink:href"] && (r["xlink:href"] = r["xlink:href"] + t.idSuffix), Object.entries(r).forEach(([i, a]) => {
    typeof a == "string" && (r[i] = a.replace(/url\(#(.*)\)/, `url(#$1${t.idSuffix})`));
  })), r;
}
function ti(e, t) {
  var r;
  const { defIds: n } = t;
  return !n || n.length === 0 ? e : e.tag === "defs" && ((r = e.children) != null && r.length) ? {
    ...e,
    children: e.children.map((o) => typeof o.attrs.id == "string" && n && n.includes(o.attrs.id) ? {
      ...o,
      attrs: {
        ...o.attrs,
        id: o.attrs.id + t.idSuffix
      }
    } : o)
  } : e;
}
function ni() {
  return Math.random().toString(36).substring(2, 8);
}
$e.displayName = "UniverIcon";
var ri = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.4917 3.07803C1.4917 2.19437 2.20804 1.47803 3.0917 1.47803H5.6917C6.57536 1.47803 7.2917 2.19437 7.2917 3.07803V5.67803C7.2917 6.56168 6.57535 7.27803 5.6917 7.27803H3.0917C2.20804 7.27803 1.4917 6.56168 1.4917 5.67803V3.07803ZM3.0917 2.67803C2.87078 2.67803 2.6917 2.85711 2.6917 3.07803V5.67803C2.6917 5.89894 2.87079 6.07803 3.0917 6.07803H5.6917C5.91261 6.07803 6.0917 5.89894 6.0917 5.67803V3.07803C6.0917 2.85711 5.91261 2.67803 5.6917 2.67803H3.0917Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.6175 2.45279C14.8518 2.68711 14.8518 3.06701 14.6175 3.30132L11.6151 6.30365C11.3957 6.52307 11.0451 6.53897 10.8067 6.34031L8.80915 4.67566C8.55458 4.46352 8.52019 4.08518 8.73233 3.83062C8.94447 3.57605 9.32281 3.54166 9.57737 3.7538L11.154 5.06767L13.769 2.45278C14.0033 2.21847 14.3832 2.21848 14.6175 2.45279Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.1175 9.19746C14.3518 9.43178 14.3518 9.81168 14.1175 10.046L12.5418 11.6217L14.1175 13.1975C14.3518 13.4318 14.3518 13.8117 14.1175 14.046C13.8832 14.2803 13.5033 14.2803 13.269 14.046L11.6933 12.4703L10.1175 14.046C9.88321 14.2803 9.50331 14.2803 9.269 14.046C9.03468 13.8117 9.03468 13.4318 9.269 13.1975L10.8447 11.6217L9.269 10.046C9.03468 9.81168 9.03468 9.43178 9.269 9.19746C9.50331 8.96315 9.88321 8.96315 10.1175 9.19746L11.6933 10.7732L13.269 9.19746C13.5033 8.96315 13.8832 8.96315 14.1175 9.19746Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M3.0917 8.72168C2.20804 8.72168 1.4917 9.43802 1.4917 10.3217V12.9217C1.4917 13.8053 2.20804 14.5217 3.0917 14.5217H5.6917C6.57535 14.5217 7.2917 13.8053 7.2917 12.9217V10.3217C7.2917 9.43802 6.57536 8.72168 5.6917 8.72168H3.0917ZM2.6917 10.3217C2.6917 10.1008 2.87078 9.92168 3.0917 9.92168H5.6917C5.91261 9.92168 6.0917 10.1008 6.0917 10.3217V12.9217C6.0917 13.1426 5.91261 13.3217 5.6917 13.3217H3.0917C2.87079 13.3217 2.6917 13.1426 2.6917 12.9217V10.3217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var Ir = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "data-validation-icon",
    ref: n,
    icon: ri
  }));
});
Ir.displayName = "DataValidationIcon";
var oi = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var Sn2 = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "delete-icon",
    ref: n,
    icon: oi
  }));
});
Sn2.displayName = "DeleteIcon";
var ii = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"
    }
  }]
};
var Rr = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "increase-icon",
    ref: n,
    icon: ii
  }));
});
Rr.displayName = "IncreaseIcon";
var ai = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var wn = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "more-down-icon",
    ref: n,
    icon: ai
  }));
});
wn.displayName = "MoreDownIcon";
var si = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M4.64645 9.85355C4.45118 9.65829 4.45118 9.34171 4.64645 9.14645L7.64645 6.14645C7.84171 5.95118 8.15829 5.95118 8.35355 6.14645L11.3536 9.14645C11.5488 9.34171 11.5488 9.65829 11.3536 9.85355C11.1583 10.0488 10.8417 10.0488 10.6464 9.85355L8 7.20711L5.35355 9.85355C5.15829 10.0488 4.84171 10.0488 4.64645 9.85355Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var yr2 = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "more-up-icon",
    ref: n,
    icon: si
  }));
});
yr2.displayName = "MoreUpIcon";
var li = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6 5C6.55228 5 7 4.55228 7 4C7 3.44772 6.55228 3 6 3C5.44772 3 5 3.44772 5 4C5 4.55228 5.44772 5 6 5Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6 9C6.55228 9 7 8.55229 7 8C7 7.44772 6.55228 7 6 7C5.44772 7 5 7.44772 5 8C5 8.55229 5.44772 9 6 9Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M7 12C7 12.5523 6.55228 13 6 13C5.44772 13 5 12.5523 5 12C5 11.4477 5.44772 11 6 11C6.55228 11 7 11.4477 7 12Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M10 5C10.5523 5 11 4.55228 11 4C11 3.44772 10.5523 3 10 3C9.44771 3 9 3.44772 9 4C9 4.55228 9.44771 5 10 5Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M11 8C11 8.55229 10.5523 9 10 9C9.44771 9 9 8.55229 9 8C9 7.44772 9.44771 7 10 7C10.5523 7 11 7.44772 11 8Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M10 13C10.5523 13 11 12.5523 11 12C11 11.4477 10.5523 11 10 11C9.44771 11 9 11.4477 9 12C9 12.5523 9.44771 13 10 13Z"
      }
    }
  ]
};
var Mr2 = (0, import_react.forwardRef)(function(t, n) {
  return (0, import_react.createElement)($e, Object.assign({}, t, {
    id: "sequence-icon",
    ref: n,
    icon: li
  }));
});
Mr2.displayName = "SequenceIcon";
function di(e) {
  var d;
  const t = useDependency(Fn), n = useDependency(S12), { value: r, onChange: o, extraComponent: i } = e, [a, l] = (0, import_react.useState)(false), s = i ? n.get(i) : null;
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: "univer-mb-3 univer-flex univer-cursor-pointer univer-items-center univer-text-sm univer-text-gray-900 dark:!univer-text-white",
        onClick: () => l(!a),
        children: [
          t.t("dataValidation.panel.options"),
          a ? (0, import_jsx_runtime.jsx)(yr2, { className: "univer-ml-1" }) : (0, import_jsx_runtime.jsx)(wn, { className: "univer-ml-1" })
        ]
      }
    ),
    a && (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
      s ? (0, import_jsx_runtime.jsx)(s, { value: r, onChange: o }) : null,
      (0, import_jsx_runtime.jsx)(
        gE,
        {
          label: t.t("dataValidation.panel.invalid"),
          children: (0, import_jsx_runtime.jsxs)(
            kE,
            {
              value: `${(d = r.errorStyle) != null ? d : vC.WARNING}`,
              onChange: (u) => o({ ...r, errorStyle: +u }),
              children: [
                (0, import_jsx_runtime.jsx)(TE, { value: `${vC.WARNING}`, children: t.t("dataValidation.panel.showWarning") }),
                (0, import_jsx_runtime.jsx)(TE, { value: `${vC.STOP}`, children: t.t("dataValidation.panel.rejectInput") })
              ]
            }
          )
        }
      ),
      (0, import_jsx_runtime.jsx)(
        gE,
        {
          label: t.t("dataValidation.panel.messageInfo"),
          children: (0, import_jsx_runtime.jsx)(
            em,
            {
              checked: r.showErrorMessage,
              onChange: () => o({
                ...r,
                showErrorMessage: !r.showErrorMessage
              }),
              children: t.t("dataValidation.panel.showInfo")
            }
          )
        }
      ),
      r.showErrorMessage ? (0, import_jsx_runtime.jsx)(gE, { children: (0, import_jsx_runtime.jsx)(Vx, { value: r.error, onChange: (u) => o({ ...r, error: u }) }) }) : null
    ] })
  ] });
}
var ci = (e) => n1(
  async (t, n, r, o) => {
    const i = await e.executeCommand(t, n, r);
    o == null || o(i);
  },
  1e3
);
function ui(e, t, n) {
  var r, o, i, a;
  return t ? ((o = (r = e.getUnit(t)) == null ? void 0 : r.getSheetBySheetName(n)) == null ? void 0 : o.getSheetId()) || "" : ((a = (i = e.getCurrentUnitForType(we.UNIVER_SHEET)) == null ? void 0 : i.getSheetBySheetName(n)) == null ? void 0 : a.getSheetId()) || "";
}
function hi2() {
  var M, U;
  const [e, t] = (0, import_react.useState)(0), n = useDependency(me), r = useObservable(n.activeRule$, n.activeRule), { unitId: o, subUnitId: i, rule: a } = r || {}, l = a.uid, s = useDependency(F), d = useDependency(vr), u = useDependency(S12), p = useDependency(Ls), c = useDependency(h), m = useDependency(Fn), [h2, b] = (0, import_react.useState)(a), y = s.getValidatorItem(h2.type), [w, S] = (0, import_react.useState)(false), g = s.getValidatorsByScope(pe.SHEET), [I, _] = (0, import_react.useState)(() => h2.ranges.map((f) => ({ unitId: "", sheetId: "", range: f }))), v = (0, import_react.useMemo)(() => ci(p), [p]), [R, P2] = (0, import_react.useState)(false), [N, T] = (0, import_react.useState)(false), L = (0, import_react.useRef)(null), D = useDependency(z);
  if ((0, import_react.useEffect)(() => () => {
    const f = D.getCurrentLastSelection();
    f && D.setSelections([f]);
  }, [D]), (0, import_react.useEffect)(() => {
    p.onCommandExecuted((f) => {
      (f.id === gC.id || f.id === _C.id) && setTimeout(() => {
        const A = c.getRuleById(o, i, l);
        t(($) => $ + 1), A && (b(A), _(A.ranges.map(($) => ({ unitId: "", sheetId: "", range: $ }))));
      }, 20);
    });
  }, [p, c, l, i, o]), !y)
    return null;
  const O = y.operators, k = y.operatorNames, x = h2.operator ? Ce.includes(h2.operator) : false, G2 = () => {
    var f, A, $;
    (A = (f = L.current) == null ? void 0 : f.editor) != null && A.isFocus() && te(($ = L.current) == null ? void 0 : $.getValue()), !(!h2.ranges.length || R) && (y.validatorFormula(h2, o, i).success ? n.setActiveRule(null) : S(true));
  }, te = re((f) => {
    const A = f.split(",").filter(Boolean).map(Dr).map((J) => {
      const In = J.sheetName;
      if (In) {
        const Vr = ui(d, J.unitId, In);
        return { ...J, sheetId: Vr };
      }
      return {
        ...J,
        sheetId: ""
      };
    });
    if (HR(A, I))
      return;
    _(A);
    const $ = A.filter((J) => (!J.unitId || J.unitId === o) && (!J.sheetId || J.sheetId === i)).map((J) => J.range);
    if (b({
      ...h2,
      ranges: $
    }), $.length === 0)
      return;
    const ce = {
      unitId: o,
      subUnitId: i,
      ruleId: l,
      ranges: $
    };
    v(ma.id, ce);
  }), B = (f) => {
    if (Vc(f, Q(h2)))
      return;
    b({
      ...h2,
      ...f
    });
    const A = {
      unitId: o,
      subUnitId: i,
      ruleId: l,
      setting: f
    };
    v(
      pa.id,
      A,
      void 0
    );
  }, ne2 = async () => {
    await p.executeCommand(Sa.id, {
      ruleId: l,
      unitId: o,
      subUnitId: i
    }), n.setActiveRule(null);
  }, ie2 = {
    type: h2.type,
    operator: h2.operator,
    formula1: h2.formula1,
    formula2: h2.formula2,
    allowBlank: h2.allowBlank
  }, _e2 = (f) => {
    const A = s.getValidatorItem(f);
    if (!A)
      return;
    const $ = A.operators, ce = c.getRuleById(o, i, l), J = f === (ce == null ? void 0 : ce.type) || f.includes("list") && (ce != null && ce.type.includes("list")) ? {
      ...ce,
      type: f
    } : {
      ...h2,
      type: f,
      operator: $[0],
      formula1: void 0,
      formula2: void 0
    };
    b(J), p.executeCommand(pa.id, {
      unitId: o,
      subUnitId: i,
      ruleId: h2.uid,
      setting: Q(J)
    });
  }, Ce2 = u.get(y.formulaInput), z2 = (0, import_react.useMemo)(() => I.map((f) => Ft(f.range)).join(","), []), Z2 = j(h2), ge = (f) => {
    Vc(f, j(h2)) || (b({
      ...h2,
      ...f
    }), v(
      fa.id,
      {
        unitId: o,
        subUnitId: i,
        ruleId: l,
        options: f
      }
    ));
  }, q = O.length && !h2.operator;
  return (0, import_jsx_runtime.jsxs)("div", { "data-u-comp": "data-validation-detail", className: "univer-py-2", children: [
    (0, import_jsx_runtime.jsx)(
      gE,
      {
        label: m.t("dataValidation.panel.range"),
        error: !h2.ranges.length || R ? m.t("dataValidation.panel.rangeError") : "",
        children: (0, import_jsx_runtime.jsx)(
          Wr,
          {
            selectorRef: L,
            unitId: o,
            subUnitId: i,
            initialValue: z2,
            onChange: (f, A) => {
              var $;
              !N && (($ = L.current) != null && $.verify()) && te(A);
            },
            onFocusChange: (f, A) => {
              var $;
              T(f), !f && A && (($ = L.current) != null && $.verify()) && te(A);
            },
            onVerify: (f) => P2(!f)
          }
        )
      }
    ),
    (0, import_jsx_runtime.jsx)(gE, { label: m.t("dataValidation.panel.type"), children: (0, import_jsx_runtime.jsx)(
      LE,
      {
        className: "univer-w-full",
        value: h2.type,
        options: (M = g == null ? void 0 : g.sort((f, A) => f.order - A.order)) == null ? void 0 : M.map((f) => ({
          label: m.t(f.title),
          value: f.id
        })),
        onChange: _e2
      }
    ) }),
    O != null && O.length ? (0, import_jsx_runtime.jsx)(gE, { label: m.t("dataValidation.panel.operator"), children: (0, import_jsx_runtime.jsx)(
      LE,
      {
        className: "univer-w-full",
        value: `${h2.operator}`,
        options: [
          {
            value: "",
            label: m.t("dataValidation.operators.legal")
          },
          ...O.map((f, A) => ({
            value: `${f}`,
            label: k[A]
          }))
        ],
        onChange: (f) => {
          B({
            ...ie2,
            operator: f
          });
        }
      }
    ) }) : null,
    Ce2 && !q ? (0, import_jsx_runtime.jsx)(
      Ce2,
      {
        isTwoFormula: x,
        value: {
          formula1: h2.formula1,
          formula2: h2.formula2
        },
        onChange: (f) => {
          B({
            ...ie2,
            ...f
          });
        },
        showError: w,
        validResult: y.validatorFormula(h2, o, i),
        unitId: o,
        subUnitId: i,
        ruleId: l
      },
      e + h2.type
    ) : null,
    (0, import_jsx_runtime.jsx)(gE, { children: (0, import_jsx_runtime.jsx)(
      em,
      {
        checked: (U = h2.allowBlank) != null ? U : true,
        onChange: () => {
          var f;
          return B({
            ...ie2,
            allowBlank: !((f = h2.allowBlank) == null || f)
          });
        },
        children: m.t("dataValidation.panel.allowBlank")
      }
    ) }),
    (0, import_jsx_runtime.jsx)(di, { value: Z2, onChange: ge, extraComponent: y.optionsInput }),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-5 univer-flex univer-flex-row univer-justify-end", children: [
      (0, import_jsx_runtime.jsx)(vr2, { className: "univer-ml-3", onClick: ne2, children: m.t("dataValidation.panel.removeRule") }),
      (0, import_jsx_runtime.jsx)(vr2, { className: "univer-ml-3", variant: "primary", onClick: G2, children: m.t("dataValidation.panel.done") })
    ] })
  ] });
}
var pi = (e) => {
  const { rule: t, onClick: n, unitId: r, subUnitId: o, disable: i } = e, a = useDependency(F), l = useDependency(Ls), s = useDependency(Wi), d = a.getValidatorItem(t.type), u = (0, import_react.useRef)(void 0), [p, c] = (0, import_react.useState)(false), m = useDependency(Gi), h2 = useObservable(m.currentTheme$), b = (0, import_react.useMemo)(() => {
    var _;
    const w = m.getColorFromTheme("primary.600"), S = m.getColorFromTheme("loop-color.2"), g = (_ = m.getColorFromTheme(S)) != null ? _ : w, I = new bt(g).toRgb();
    return {
      fill: `rgba(${I.r}, ${I.g}, ${I.b}, 0.1)`,
      stroke: g
    };
  }, [h2]), y = (w) => {
    l.executeCommand(Sa.id, {
      ruleId: t.uid,
      unitId: r,
      subUnitId: o
    }), w.stopPropagation();
  };
  return (0, import_react.useEffect)(() => () => {
    var w;
    u.current && ((w = u.current) == null || w.forEach((S) => {
      S && s.removeShape(S);
    }));
  }, [s]), (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: ie(
        `
                  univer-bg-secondary univer-relative univer--ml-2 univer--mr-2 univer-box-border univer-flex
                  univer-w-[287px] univer-cursor-pointer univer-flex-col univer-justify-between univer-overflow-hidden
                  univer-rounded-md univer-p-2 univer-pr-9
                `,
        {
          "hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700": !i,
          "univer-opacity-50": i
        }
      ),
      onClick: n,
      onMouseEnter: () => {
        i || (c(true), u.current = t.ranges.map((w) => s.addShape({
          range: w,
          style: b,
          primary: null
        })));
      },
      onMouseLeave: () => {
        var w;
        c(false), (w = u.current) == null || w.forEach((S) => {
          S && s.removeShape(S);
        }), u.current = void 0;
      },
      children: [
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: "univer-truncate univer-text-sm univer-font-medium univer-leading-[22px] univer-text-gray-900 dark:!univer-text-white",
            children: d == null ? void 0 : d.generateRuleName(t)
          }
        ),
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: "univer-text-secondary univer-truncate univer-text-xs univer-leading-[18px] dark:!univer-text-gray-300",
            children: t.ranges.map((w) => Ft(w)).join(",")
          }
        ),
        p ? (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: "univer-absolute univer-right-2 univer-top-[19px] univer-flex univer-h-5 univer-w-5 univer-items-center univer-justify-center univer-rounded hover:univer-bg-gray-200 dark:!univer-text-gray-300 dark:hover:!univer-bg-gray-700",
            onClick: y,
            children: (0, import_jsx_runtime.jsx)(Sn2, {})
          }
        ) : null
      ]
    }
  );
};
function gi(e) {
  const t = useDependency(F2), n = useDependency(vr), r = useDependency(Ls), o = useDependency(Injector), i = useDependency(me), a = useDependency(Fn), [l, s] = (0, import_react.useState)([]), { workbook: d } = e, u = useObservable(d.activeSheet$, void 0, true), p = d.getUnitId(), c = u == null ? void 0 : u.getSheetId();
  (0, import_react.useEffect)(() => {
    s(t.getRules(p, c));
    const S = t.ruleChange$.subscribe((g) => {
      g.unitId === p && g.subUnitId === c && s(t.getRules(p, c));
    });
    return () => {
      S.unsubscribe();
    };
  }, [p, c, t]);
  const m = async () => {
    const S = Za(o), g = {
      unitId: p,
      subUnitId: c,
      rule: S
    };
    await r.executeCommand(ga.id, g), i.setActiveRule({
      unitId: p,
      subUnitId: c,
      rule: S
    });
  }, h2 = () => {
    r.executeCommand(Ra.id, {
      unitId: p,
      subUnitId: c
    });
  }, y = ((S) => {
    const g = n.getCurrentUnitForType(we.UNIVER_SHEET), I = g.getActiveSheet(), _ = g.getUnitId(), v = I.getSheetId();
    return S.map((P2) => og(o, _, v, P2.ranges) ? { ...P2 } : { ...P2, disable: true });
  })(l), w = y == null ? void 0 : y.some((S) => S.disable);
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-pb-4", children: [
    y == null ? void 0 : y.map((S) => {
      var g;
      return (0, import_jsx_runtime.jsx)(
        pi,
        {
          unitId: p,
          subUnitId: c,
          onClick: () => {
            S.disable || i.setActiveRule({
              unitId: p,
              subUnitId: c,
              rule: S
            });
          },
          rule: S,
          disable: (g = S.disable) != null ? g : false
        },
        S.uid
      );
    }),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-4 univer-flex univer-flex-row univer-justify-end univer-gap-2", children: [
      l.length && !w ? (0, import_jsx_runtime.jsx)(vr2, { onClick: h2, children: a.t("dataValidation.panel.removeAll") }) : null,
      (0, import_jsx_runtime.jsx)(vr2, { variant: "primary", onClick: m, children: a.t("dataValidation.panel.add") })
    ] })
  ] });
}
var vi = () => {
  const e = useDependency(me), t = useObservable(e.activeRule$, e.activeRule), n = useDependency(vr), r = useObservable(
    () => n.getCurrentTypeOfUnit$(we.UNIVER_SHEET),
    void 0,
    void 0,
    []
  ), o = useObservable(() => {
    var i;
    return (i = r == null ? void 0 : r.activeSheet$) != null ? i : of(null);
  }, void 0, void 0, []);
  return !r || !o ? null : t && t.subUnitId === o.getSheetId() ? (0, import_jsx_runtime.jsx)(hi2, {}, t.rule.uid) : (0, import_jsx_runtime.jsx)(gi, { workbook: r });
};
var mi = (e) => {
  const { isTwoFormula: t = false, value: n, onChange: r, showError: o, validResult: i } = e, a = useDependency(Fn), l = o ? i == null ? void 0 : i.formula1 : "", s = o ? i == null ? void 0 : i.formula2 : "";
  return t ? (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(gE, { error: l, children: (0, import_jsx_runtime.jsx)(
      Vx,
      {
        className: "univer-w-full",
        placeholder: a.t("dataValidation.panel.formulaPlaceholder"),
        value: n == null ? void 0 : n.formula1,
        onChange: (d) => {
          r == null || r({
            ...n,
            formula1: d
          });
        }
      }
    ) }),
    (0, import_jsx_runtime.jsx)("div", { className: "-univer-mt-2 univer-mb-1 univer-text-sm univer-text-gray-400", children: a.t("dataValidation.panel.formulaAnd") }),
    (0, import_jsx_runtime.jsx)(gE, { error: s, children: (0, import_jsx_runtime.jsx)(
      Vx,
      {
        className: "univer-w-full",
        placeholder: a.t("dataValidation.panel.formulaPlaceholder"),
        value: n == null ? void 0 : n.formula2,
        onChange: (d) => {
          r == null || r({
            ...n,
            formula2: d
          });
        }
      }
    ) })
  ] }) : (0, import_jsx_runtime.jsx)(gE, { error: l, children: (0, import_jsx_runtime.jsx)(
    Vx,
    {
      className: "univer-w-full",
      placeholder: a.t("dataValidation.panel.formulaPlaceholder"),
      value: n == null ? void 0 : n.formula1,
      onChange: (d) => {
        r == null || r({ formula1: d });
      }
    }
  ) });
};
function fi(e) {
  const { value: t, onChange: n, showError: r, validResult: o } = e, i = useDependency(Fn), a = r ? o == null ? void 0 : o.formula1 : "", l = r ? o == null ? void 0 : o.formula2 : "", [s, d] = (0, import_react.useState)(!((t == null ? void 0 : t.formula1) === void 0 && (t == null ? void 0 : t.formula2) === void 0));
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(gE, { children: (0, import_jsx_runtime.jsx)(
      em,
      {
        checked: s,
        onChange: (u) => {
          u ? d(true) : (d(false), n == null || n({
            ...t,
            formula1: void 0,
            formula2: void 0
          }));
        },
        children: i.t("dataValidation.checkbox.tips")
      }
    ) }),
    s ? (0, import_jsx_runtime.jsx)(gE, { label: i.t("dataValidation.checkbox.checked"), error: a, children: (0, import_jsx_runtime.jsx)(
      Vx,
      {
        className: "univer-w-full",
        placeholder: i.t("dataValidation.panel.valuePlaceholder"),
        value: t == null ? void 0 : t.formula1,
        onChange: (u) => {
          n == null || n({
            ...t,
            formula1: u || void 0
          });
        }
      }
    ) }) : null,
    s ? (0, import_jsx_runtime.jsx)(gE, { label: i.t("dataValidation.checkbox.unchecked"), error: l, children: (0, import_jsx_runtime.jsx)(
      Vx,
      {
        className: "univer-w-full",
        placeholder: i.t("dataValidation.panel.valuePlaceholder"),
        value: t == null ? void 0 : t.formula2,
        onChange: (u) => {
          n == null || n({
            ...t,
            formula2: u || void 0
          });
        }
      }
    ) }) : null
  ] });
}
function _i(e) {
  var p;
  const { unitId: t, subUnitId: n, value: r, onChange: o, showError: i, validResult: a } = e, l = i ? a == null ? void 0 : a.formula1 : void 0, s = (0, import_react.useRef)(null), [d, u] = (0, import_react.useState)(false);
  return r7((c) => {
    var h2;
    ((h2 = s.current) == null ? void 0 : h2.isClickOutSide(c)) && u(false);
  }), (0, import_jsx_runtime.jsx)(gE, { error: l, children: (0, import_jsx_runtime.jsx)(
    Cc,
    {
      ref: s,
      className: ie("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
      initValue: (p = r == null ? void 0 : r.formula1) != null ? p : "=",
      unitId: t,
      subUnitId: n,
      isFocus: d,
      isSupportAcrossSheet: true,
      onChange: (c) => {
        const m = (c != null ? c : "").trim();
        m !== (r == null ? void 0 : r.formula1) && (o == null || o({
          ...r,
          formula1: m
        }));
      },
      onFocus: () => u(true)
    }
  ) });
}
var Ci = [
  "#FFFFFF",
  "#FEE7E7",
  "#FEF0E6",
  "#EFFBD0",
  "#E4F4FE",
  "#E8ECFD",
  "#F1EAFA",
  "#FDE8F3",
  "#E5E5E5",
  "#FDCECE",
  "#FDC49B",
  "#DEF6A2",
  "#9FDAFF",
  "#D0D9FB",
  "#E3D5F6",
  "#FBD0E8",
  "#656565",
  "#FE4B4B",
  "#FF8C51",
  "#8BBB11",
  "#0B9EFB",
  "#3A60F7",
  "#9E6DE3",
  "#F248A6"
];
var Si = (e) => {
  const { value: t, onChange: n, disabled: r } = e, [o, i] = (0, import_react.useState)(false);
  return (0, import_jsx_runtime.jsx)(
    vf,
    {
      align: "start",
      disabled: r,
      open: o,
      onOpenChange: i,
      overlay: (0, import_jsx_runtime.jsx)(
        "div",
        {
          className: "univer-box-border univer-grid univer-w-fit univer-grid-cols-6 univer-flex-wrap univer-gap-2 univer-p-1.5",
          children: Ci.map(
            (a) => (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie("univer-box-border univer-size-4 univer-cursor-pointer univer-rounded", kt),
                style: { background: a },
                onClick: () => {
                  n(a), i(false);
                }
              },
              a
            )
          )
        }
      ),
      children: (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: ie("univer-box-border univer-inline-flex univer-h-8 univer-w-16 univer-cursor-pointer univer-items-center univer-justify-between univer-gap-2 univer-rounded-lg univer-bg-white univer-px-2.5 univer-transition-colors univer-duration-200 hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white", kt),
          children: [
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: "univer-box-border univer-h-4 univer-w-4 univer-rounded univer-text-base",
                style: { background: t }
              }
            ),
            (0, import_jsx_runtime.jsx)(wn, {})
          ]
        }
      )
    }
  );
};
var Fn2 = (e) => {
  const { item: t, commonProps: n, className: r } = e, { onItemChange: o, onItemDelete: i } = n;
  return (0, import_jsx_runtime.jsxs)("div", { className: ie("univer-flex univer-items-center univer-gap-2", r), children: [
    !t.isRef && (0, import_jsx_runtime.jsx)("div", { className: ie("univer-cursor-move", "draggableHandle"), children: (0, import_jsx_runtime.jsx)(Mr2, {}) }),
    (0, import_jsx_runtime.jsx)(
      Si,
      {
        value: t.color,
        onChange: (a) => {
          o(t.id, t.label, a);
        }
      }
    ),
    (0, import_jsx_runtime.jsx)(
      Vx,
      {
        disabled: t.isRef,
        value: t.label,
        onChange: (a) => {
          o(t.id, a, t.color);
        }
      }
    ),
    t.isRef ? null : (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: "univer-ml-1 univer-cursor-pointer univer-rounded univer-text-base hover:univer-bg-gray-200",
        children: (0, import_jsx_runtime.jsx)(Sn2, { onClick: () => i(t.id) })
      }
    )
  ] });
};
function wi(e) {
  const { value: t, onChange: n = () => {
  }, unitId: r, subUnitId: o, validResult: i, showError: a, ruleId: l } = e, { formula1: s = "", formula2: d = "" } = t || {}, [u, p] = (0, import_react.useState)(() => Gg(s) ? "1" : "0"), [c, m] = (0, import_react.useState)(u === "1" ? s : "="), [h2, b] = (0, import_react.useState)(u === "1" ? s : "="), y = useDependency(Fn), w = useDependency(F), S = useDependency(h), g = useDependency(Te), [I, _] = (0, import_react.useState)(() => d.split(",")), v = w.getValidatorItem(TC.LIST), [R, P2] = (0, import_react.useState)([]), [N, T] = (0, import_react.useState)(""), L = a ? i == null ? void 0 : i.formula1 : "", D = (0, import_react.useMemo)(() => S.ruleChange$.pipe(debounceTime(16)), []), O = useObservable(D), k = re(n);
  (0, import_react.useEffect)(() => {
    (async () => {
      await new Promise((f) => {
        setTimeout(() => f(true), 100);
      });
      const M = S.getRuleById(r, o, l), U = M == null ? void 0 : M.formula1;
      if (Gg(U) && v && M) {
        const f = await v.getListAsync(M, r, o);
        P2(f);
      }
    })();
  }, [S, O, v, l, o, r]), (0, import_react.useEffect)(() => {
    Gg(s) && s !== h2 && (m(s), b(h2));
  }, [h2, s]);
  const [x, G2] = (0, import_react.useState)(() => {
    const M = u !== "1" ? _e(s) : [], U = d.split(",");
    return M.map((f, A) => ({
      label: f,
      color: U[A] || Te2,
      isRef: false,
      id: et(4)
    }));
  }), te = (M, U, f) => {
    const A = x.find(($) => $.id === M);
    A && (A.label = U, A.color = f, G2([...x]));
  }, B = (M) => {
    const U = x.findIndex((f) => f.id === M);
    U !== -1 && (x.splice(U, 1), G2([...x]));
  }, ne2 = d.split(","), ie2 = (0, import_react.useMemo)(() => R.map((M, U) => ({
    label: M,
    color: ne2[U] || Te2,
    id: `${U}`,
    isRef: true
  })), [ne2, R]), _e2 = (M, U, f) => {
    const A = [...I];
    A[+M] = f, _(A), k({
      formula1: s,
      formula2: A.join(",")
    });
  }, Ce2 = () => {
    G2([
      ...x,
      {
        label: "",
        color: Te2,
        isRef: false,
        id: et(4)
      }
    ]);
  };
  (0, import_react.useEffect)(() => {
    if (u === "1")
      return;
    const M = /* @__PURE__ */ new Set(), U = [];
    x.map((f) => ({
      labelList: f.label.split(","),
      item: f
    })).forEach(({ item: f, labelList: A }) => {
      A.forEach(($) => {
        M.has($) || (M.add($), U.push({
          label: $,
          color: f.color
        }));
      });
    }), k({
      formula1: Ka(U.map((f) => f.label)),
      formula2: U.map((f) => f.color === Te2 ? "" : f.color).join(",")
    });
  }, [x, k, u, h2, I]);
  const z2 = re(async (M) => {
    if (!Gg(M)) {
      k == null || k({
        formula1: "",
        formula2: d
      });
      return;
    }
    g.getFormulaRefCheck(M) ? (k == null || k({
      formula1: Gg(M) ? M : "",
      formula2: d
    }), T("")) : (k == null || k({
      formula1: "",
      formula2: d
    }), m("="), T(y.t("dataValidation.validFail.formulaError")));
  }), Z2 = (0, import_react.useRef)(null), [ge, q] = (0, import_react.useState)(false);
  return r7((M) => {
    var f;
    ((f = Z2.current) == null ? void 0 : f.isClickOutSide(M)) && q(false);
  }), (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(gE, { label: y.t("dataValidation.list.options"), children: (0, import_jsx_runtime.jsxs)(
      kE,
      {
        value: u,
        onChange: (M) => {
          p(M), m(h2), M === "1" && k({
            formula1: h2 === "=" ? "" : h2,
            formula2: I.join(",")
          });
        },
        children: [
          (0, import_jsx_runtime.jsx)(TE, { value: "0", children: y.t("dataValidation.list.customOptions") }),
          (0, import_jsx_runtime.jsx)(TE, { value: "1", children: y.t("dataValidation.list.refOptions") })
        ]
      }
    ) }),
    u === "1" ? (0, import_jsx_runtime.jsxs)(gE, { error: L || N || void 0, children: [
      (0, import_jsx_runtime.jsx)(
        Cc,
        {
          ref: Z2,
          className: ie("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", kt),
          initValue: c,
          unitId: r,
          subUnitId: o,
          isFocus: ge,
          isSupportAcrossSheet: true,
          onFocus: () => q(true),
          onChange: (M = "") => {
            const U = (M != null ? M : "").trim();
            b(U), z2(U);
          }
        }
      ),
      ie2.length > 0 && (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3", children: ie2.map((M) => (0, import_jsx_runtime.jsx)(
        Fn2,
        {
          className: "univer-mb-3",
          item: M,
          commonProps: { onItemChange: _e2 }
        },
        M.id
      )) })
    ] }) : (0, import_jsx_runtime.jsx)(gE, { error: L, children: (0, import_jsx_runtime.jsxs)("div", { className: "-univer-mt-3", children: [
      (0, import_jsx_runtime.jsx)(
        hE,
        {
          list: x,
          onListChange: G2,
          rowHeight: 28,
          margin: [0, 12],
          draggableHandle: ".draggableHandle",
          itemRender: (M) => (0, import_jsx_runtime.jsx)(
            Fn2,
            {
              item: M,
              commonProps: {
                onItemChange: te,
                onItemDelete: B
              }
            },
            M.id
          ),
          idKey: "id"
        }
      ),
      (0, import_jsx_runtime.jsxs)(
        "a",
        {
          className: "univer-text-primary univer-flex univer-w-fit univer-cursor-pointer univer-flex-row univer-items-center univer-rounded univer-p-1 univer-px-2 univer-text-sm hover:univer-bg-primary-50 dark:hover:!univer-bg-gray-800",
          onClick: Ce2,
          children: [
            (0, import_jsx_runtime.jsx)(Rr, { className: "univer-mr-1" }),
            y.t("dataValidation.list.add")
          ]
        }
      )
    ] }) })
  ] });
}
var Ii = [
  [
    Ja,
    _i
  ],
  [
    er,
    mi
  ],
  [
    tr,
    wi
  ],
  [
    ar,
    fi
  ]
];
var Ri = "LIST_RENDER_MODE_OPTION_INPUT";
function Et(e) {
  var o;
  const { value: t, onChange: n } = e, r = useDependency(Fn);
  return (0, import_jsx_runtime.jsx)(gE, { label: r.t("dataValidation.renderMode.label"), children: (0, import_jsx_runtime.jsxs)(kE, { value: `${(o = t.renderMode) != null ? o : yC.CUSTOM}`, onChange: (i) => n({ ...t, renderMode: +i }), children: [
    (0, import_jsx_runtime.jsx)(TE, { value: `${yC.CUSTOM}`, children: r.t("dataValidation.renderMode.chip") }),
    (0, import_jsx_runtime.jsx)(TE, { value: `${yC.ARROW}`, children: r.t("dataValidation.renderMode.arrow") }),
    (0, import_jsx_runtime.jsx)(TE, { value: `${yC.TEXT}`, children: r.t("dataValidation.renderMode.text") })
  ] }) });
}
Et.componentKey = Ri;
var yi = "DATE_SHOW_TIME_OPTION";
function Dt(e) {
  var o;
  const { value: t, onChange: n } = e, r = useDependency(Fn);
  return (0, import_jsx_runtime.jsx)(gE, { children: (0, import_jsx_runtime.jsx)(
    em,
    {
      checked: (o = t.bizInfo) == null ? void 0 : o.showTime,
      onChange: (i) => {
        n({
          ...t,
          bizInfo: {
            ...t.bizInfo,
            showTime: i
          }
        });
      },
      children: r.t("dataValidation.showTime.label")
    }
  ) });
}
Dt.componentKey = yi;
var Mi = Object.getOwnPropertyDescriptor;
var bi = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Mi(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var We2 = (e, t) => (n, r) => t(n, r, e);
var ft = 6;
var rn = class {
  constructor(e, t, n, r, o, i) {
    this._commandService = e, this._univerInstanceService = t, this._formulaService = n, this._themeService = r, this._renderManagerService = o, this._dataValidationModel = i;
  }
  _calc(e, t) {
    var d, u, p;
    const { vt: n, ht: r } = t || {}, o = e.endX - e.startX - ft * 2, i = e.endY - e.startY, a = ((d = t == null ? void 0 : t.fs) != null ? d : 10) * 1.6;
    let l = 0, s = 0;
    switch (n) {
      case xn.TOP:
        s = 0;
        break;
      case xn.BOTTOM:
        s = 0 + (i - a);
        break;
      default:
        s = 0 + (i - a) / 2;
        break;
    }
    switch (r) {
      case Ut.LEFT:
        l = ft;
        break;
      case Ut.RIGHT:
        l = ft + (o - a);
        break;
      default:
        l = ft + (o - a) / 2;
        break;
    }
    return {
      left: e.startX + l,
      top: e.startY + s,
      width: ((u = t == null ? void 0 : t.fs) != null ? u : 10) * 1.6,
      height: ((p = t == null ? void 0 : t.fs) != null ? p : 10) * 1.6
    };
  }
  calcCellAutoHeight(e) {
    var n;
    const { style: t } = e;
    return ((n = t == null ? void 0 : t.fs) != null ? n : 10) * 1.6;
  }
  calcCellAutoWidth(e) {
    var n;
    const { style: t } = e;
    return ((n = t == null ? void 0 : t.fs) != null ? n : 10) * 1.6;
  }
  async _parseFormula(e, t, n) {
    var d, u, p, c, m, h2, b, y, w;
    const { formula1: r = Ee, formula2: o = Ve4 } = e, i = await this._formulaService.getRuleFormulaResult(t, n, e.uid), a = oe((p = (u = (d = i == null ? void 0 : i[0]) == null ? void 0 : d.result) == null ? void 0 : u[0]) == null ? void 0 : p[0]), l = oe((h2 = (m = (c = i == null ? void 0 : i[1]) == null ? void 0 : c.result) == null ? void 0 : m[0]) == null ? void 0 : h2[0]), s = C(String(a)) && C(String(l));
    return {
      formula1: Gg(r) ? oe((w = (y = (b = i == null ? void 0 : i[0]) == null ? void 0 : b.result) == null ? void 0 : y[0]) == null ? void 0 : w[0]) : r,
      formula2: Gg(o) ? l : o,
      isFormulaValid: s
    };
  }
  drawWith(e, t) {
    var L, D, O, k;
    const { style: n, primaryWithCoord: r, unitId: o, subUnitId: i, worksheet: a, row: l, col: s } = t, d = r.isMergedMainCell ? r.mergeInfo : r, u = ne(a.getCellRaw(l, s)), p = this._dataValidationModel.getRuleByLocation(o, i, l, s);
    if (!p)
      return;
    const c = this._dataValidationModel.getValidator(p.type);
    if (!c || !((L = c.skipDefaultFontRender) != null && L.call(c, p, u, { unitId: o, subUnitId: i, row: l, column: s })))
      return;
    const m = c.parseFormulaSync(p, o, i), { formula1: h2 } = m, b = this._calc(d, n), { a: y, d: w } = e.getTransform(), S = Z(b.left, y), g = Z(b.top, w), I = B1.create().composeMatrix({
      left: S,
      top: g,
      scaleX: 1,
      scaleY: 1,
      angle: 0,
      skewX: 0,
      skewY: 0,
      flipX: false,
      flipY: false
    }), _ = d.endX - d.startX, v = d.endY - d.startY;
    e.save(), e.beginPath(), e.rect(d.startX, d.startY, _, v), e.clip();
    const R = I.getMatrix();
    e.transform(R[0], R[1], R[2], R[3], R[4], R[5]);
    const P2 = ((D = n == null ? void 0 : n.fs) != null ? D : 10) * 1.6, N = String(u) === String(h2), T = this._themeService.getColorFromTheme("primary.600");
    m6.drawWith(e, {
      checked: N,
      width: P2,
      height: P2,
      fill: (k = (O = n == null ? void 0 : n.cl) == null ? void 0 : O.rgb) != null ? k : T
    }), e.restore();
  }
  isHit(e, t) {
    const n = t.primaryWithCoord.isMergedMainCell ? t.primaryWithCoord.mergeInfo : t.primaryWithCoord, r = this._calc(n, t.style), o = r.top, i = r.top + r.height, a = r.left, l = r.left + r.width, { x: s, y: d } = e;
    return s <= l && s >= a && d <= i && d >= o;
  }
  async onPointerDown(e, t) {
    var h2;
    if (t.button === 2)
      return;
    const { primaryWithCoord: n, unitId: r, subUnitId: o, worksheet: i, row: a, col: l } = e, s = ne(i.getCellRaw(a, l)), d = this._dataValidationModel.getRuleByLocation(r, o, a, l);
    if (!d)
      return;
    const u = this._dataValidationModel.getValidator(d.type);
    if (!u || !((h2 = u.skipDefaultFontRender) != null && h2.call(u, d, s, { unitId: r, subUnitId: o, row: a, column: l })))
      return;
    const { formula1: p, formula2: c } = await this._parseFormula(d, r, o), m = {
      range: {
        startColumn: n.actualColumn,
        endColumn: n.actualColumn,
        startRow: n.actualRow,
        endRow: n.actualRow
      },
      value: {
        v: String(s) === fe2(String(p)) ? c : p,
        p: null
      }
    };
    this._commandService.executeCommand(
      Sn.id,
      m
    );
  }
  onPointerEnter(e, t) {
    var n, r;
    (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null || r.setCursor(v1.POINTER);
  }
  onPointerLeave(e, t) {
    var n, r;
    (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null || r.setCursor(v1.DEFAULT);
  }
};
rn = bi([
  We2(0, Ls),
  We2(1, vr),
  We2(2, Inject(K)),
  We2(3, Inject(Gi)),
  We2(4, Inject(ME)),
  We2(5, Inject(F2))
], rn);
var Ei = Object.getOwnPropertyDescriptor;
var Di = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Ei(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Vi = (e, t) => (n, r) => t(n, r, e);
var fe3 = class {
  constructor(e) {
    V(this, "canvasRender", null);
    V(this, "dropdownType");
    V(this, "optionsInput");
    V(this, "formulaInput", tr);
    this.injector = e;
  }
};
fe3 = Di([
  Vi(0, Inject(Injector))
], fe3);
var Ti = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.CHECKBOX);
    V(this, "canvasRender", this.injector.createInstance(rn));
    V(this, "formulaInput", ar);
  }
};
var Oi = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.CUSTOM);
    V(this, "formulaInput", Ja);
  }
};
var Ai = "data-validation.formula-input";
var Pi = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.DATE);
    V(this, "formulaInput", Ai);
    V(this, "optionsInput", Dt.componentKey);
    V(this, "dropdownType", Ve3.DATE);
  }
};
var Li = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.DECIMAL);
    V(this, "formulaInput", er);
  }
};
var br = 4;
var ki = 0;
var Wt = 4;
var Er = 4;
var on = 6;
var Vt = 6;
var Ee2 = 14;
function Ni(e, t) {
  const n = S1.getTextSize(e, t), r = n.width + br * 2, { ba: o, bd: i } = n, a = o + i;
  return {
    width: r,
    height: a + ki * 2,
    ba: o
  };
}
function Ht(e, t, n, r) {
  const o = Ee2 + on * 2, i = n - o, a = r - Vt * 2, l = e.map((c) => ({
    layout: Ni(c, t),
    text: c
  }));
  let s;
  const d = [];
  l.forEach((c) => {
    const { layout: m } = c, { width: h2, height: b } = m;
    !s || s.width + h2 + Wt > i ? (s = {
      width: h2,
      height: b,
      items: [{
        ...c,
        left: 0
      }]
    }, d.push(s)) : (s.items.push({
      ...c,
      left: s.width + Wt
    }), s.width = s.width + h2 + Wt);
  });
  let u = 0, p = 0;
  return d.forEach((c, m) => {
    p = Math.max(p, c.width), m === d.length - 1 ? u += c.height : u += c.height + Er;
  }), {
    lines: d,
    totalHeight: u,
    contentWidth: i,
    contentHeight: a,
    cellAutoHeight: u + Vt * 2,
    calcAutoWidth: p + o
  };
}
var Ui = 8;
var Fi = class extends x3 {
  static drawWith(t, n) {
    const { fontString: r, info: o, fill: i, color: a } = n, { layout: l, text: s } = o;
    t.save(), I1.drawWith(t, {
      width: l.width,
      height: l.height,
      radius: Ui,
      fill: i || Te2
    }), t.translateWithPrecision(br, l.ba), t.font = r, t.fillStyle = a, t.fillText(s, 0, 0), t.restore();
  }
};
var $i = Object.getOwnPropertyDescriptor;
var xi = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? $i(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var _t = (e, t) => (n, r) => t(n, r, e);
var Bi2 = new Path2D("M3.32201 4.84556C3.14417 5.05148 2.85583 5.05148 2.67799 4.84556L0.134292 1.90016C-0.152586 1.56798 0.0505937 1 0.456301 1L5.5437 1C5.94941 1 6.15259 1.56798 5.86571 1.90016L3.32201 4.84556Z");
var an = class {
  constructor(e, t, n, r) {
    V(this, "zIndex");
    V(this, "_dropdownInfoMap", /* @__PURE__ */ new Map());
    this._commandService = e, this._univerInstanceService = t, this._renderManagerService = n, this._dataValidationModel = r;
  }
  _ensureMap(e) {
    let t = this._dropdownInfoMap.get(e);
    return t || (t = /* @__PURE__ */ new Map(), this._dropdownInfoMap.set(e, t)), t;
  }
  _generateKey(e, t) {
    return `${e}.${t}`;
  }
  _drawDownIcon(e, t, n, r, o) {
    const i = n - Ee2 + 4;
    let a = 4;
    switch (o) {
      case xn.MIDDLE:
        a = (r - Ee2) / 2 + 4;
        break;
      case xn.BOTTOM:
        a = r - Ee2 + 4;
        break;
    }
    e.save(), e.translateWithPrecision(t.startX + i, t.startY + a), e.fillStyle = "#565656", e.fill(Bi2), e.restore();
  }
  // eslint-disable-next-line max-lines-per-function
  drawWith(e, t, n, r) {
    var ie2, _e2;
    const { primaryWithCoord: o, row: i, col: a, style: l, data: s, subUnitId: d } = t, u = o.isMergedMainCell ? o.mergeInfo : o, p = s == null ? void 0 : s.fontRenderExtension, { leftOffset: c = 0, rightOffset: m = 0, topOffset: h2 = 0, downOffset: b = 0 } = p || {}, y = this._ensureMap(d), w = this._generateKey(i, a), S = o.isMergedMainCell ? o.mergeInfo.startRow : i, g = o.isMergedMainCell ? o.mergeInfo.startColumn : a, I = this._dataValidationModel.getRuleByLocation(t.unitId, t.subUnitId, S, g);
    if (!I)
      return;
    const _ = this._dataValidationModel.getValidator(I.type);
    if (!_)
      return;
    const v = {
      startX: u.startX + c,
      endX: u.endX - m,
      startY: u.startY + h2,
      endY: u.endY - b
    }, R = v.endX - v.startX, P2 = v.endY - v.startY, { cl: N } = l || {}, T = (ie2 = typeof N == "object" ? N == null ? void 0 : N.rgb : N) != null ? ie2 : "#000", L = g3(l != null ? l : void 0), { vt: D, ht: O } = l || {}, k = D != null ? D : xn.MIDDLE, x = (_e2 = ne(s)) != null ? _e2 : "", G2 = _.parseCellValue(x), te = _.getListWithColorMap(I), B = Ht(G2, L, R, P2);
    this._drawDownIcon(e, v, R, P2, k), e.save(), e.translateWithPrecision(v.startX, v.startY), e.beginPath(), e.rect(0, 0, R - Ee2, P2), e.clip(), e.translateWithPrecision(on, Vt);
    let ne2 = 0;
    switch (k) {
      case xn.MIDDLE:
        ne2 = (B.contentHeight - B.totalHeight) / 2;
        break;
      case xn.BOTTOM:
        ne2 = B.contentHeight - B.totalHeight;
        break;
    }
    e.translateWithPrecision(0, ne2), B.lines.forEach((Ce2, z2) => {
      e.save();
      const { width: Z2, height: ge, items: q } = Ce2;
      let M = 0;
      switch (O) {
        case Ut.RIGHT:
          M = B.contentWidth - Z2;
          break;
        case Ut.CENTER:
          M = (B.contentWidth - Z2) / 2;
          break;
      }
      e.translate(M, z2 * (ge + Er)), q.forEach((U) => {
        e.save(), e.translateWithPrecision(U.left, 0), Fi.drawWith(e, {
          ...L,
          info: U,
          color: T,
          fill: te[U.text]
        }), e.restore();
      }), e.restore();
    }), e.restore(), y.set(w, {
      left: v.startX,
      top: v.startY,
      width: B.contentWidth + on + Ee2,
      height: B.contentHeight + Vt * 2
    });
  }
  calcCellAutoHeight(e) {
    var _;
    const { primaryWithCoord: t, style: n, data: r, row: o, col: i } = e, a = r == null ? void 0 : r.fontRenderExtension, { leftOffset: l = 0, rightOffset: s = 0, topOffset: d = 0, downOffset: u = 0 } = a || {}, p = t.isMergedMainCell ? t.mergeInfo : t, c = {
      startX: p.startX + l,
      endX: p.endX - s,
      startY: p.startY + d,
      endY: p.endY - u
    }, m = this._dataValidationModel.getRuleByLocation(e.unitId, e.subUnitId, o, i);
    if (!m)
      return;
    const h2 = this._dataValidationModel.getValidator(m.type);
    if (!h2)
      return;
    const b = c.endX - c.startX, y = c.endY - c.startY, w = (_ = ne(r)) != null ? _ : "", S = h2.parseCellValue(w), g = g3(n != null ? n : void 0);
    return Ht(S, g, b, y).cellAutoHeight;
  }
  calcCellAutoWidth(e) {
    var _;
    const { primaryWithCoord: t, style: n, data: r, row: o, col: i } = e, a = r == null ? void 0 : r.fontRenderExtension, { leftOffset: l = 0, rightOffset: s = 0, topOffset: d = 0, downOffset: u = 0 } = a || {}, p = t.isMergedMainCell ? t.mergeInfo : t, c = {
      startX: p.startX + l,
      endX: p.endX - s,
      startY: p.startY + d,
      endY: p.endY - u
    }, m = this._dataValidationModel.getRuleByLocation(e.unitId, e.subUnitId, o, i);
    if (!m)
      return;
    const h2 = this._dataValidationModel.getValidator(m.type);
    if (!h2)
      return;
    const b = c.endX - c.startX, y = c.endY - c.startY, w = (_ = ne(r)) != null ? _ : "", S = h2.parseCellValue(w), g = g3(n != null ? n : void 0);
    return Ht(S, g, b, y).calcAutoWidth;
  }
  isHit(e, t) {
    const { primaryWithCoord: n } = t, r = n.isMergedMainCell ? n.mergeInfo : n, { endX: o } = r, { x: i } = e;
    return i >= o - Ee2 && i <= o;
  }
  onPointerDown(e, t) {
    if (t.button === 2)
      return;
    const { unitId: n, subUnitId: r, row: o, col: i } = e, a = {
      unitId: n,
      subUnitId: r,
      row: o,
      column: i
    };
    this._commandService.executeCommand(Pt.id, a);
  }
  onPointerEnter(e, t) {
    var n, r;
    return (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null ? void 0 : r.setCursor(v1.POINTER);
  }
  onPointerLeave(e, t) {
    var n, r;
    return (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null ? void 0 : r.setCursor(v1.DEFAULT);
  }
};
an = xi([
  _t(0, Ls),
  _t(1, vr),
  _t(2, Inject(ME)),
  _t(3, Inject(F2))
], an);
var Wi2 = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.LIST_MULTIPLE);
    V(this, "canvasRender", this.injector.createInstance(an));
    V(this, "dropdownType", Ve3.MULTIPLE_LIST);
  }
};
var Hi = Object.getOwnPropertyDescriptor;
var ji = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Hi(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var it = (e, t) => (n, r) => t(n, r, e);
var He = 4;
var Ct = 4;
var he2 = 14;
var jt = 1;
var Se = 6;
var je = 3;
var Yt = 8;
var Yi = "#565656";
var $n = new Path2D("M3.32201 4.84556C3.14417 5.05148 2.85583 5.05148 2.67799 4.84556L0.134292 1.90016C-0.152586 1.56798 0.0505937 1 0.456301 1L5.5437 1C5.94941 1 6.15259 1.56798 5.86571 1.90016L3.32201 4.84556Z");
function xn2(e, t, n, r, o, i, a = true) {
  let l = 0;
  const s = a ? je : 0;
  switch (o) {
    case xn.BOTTOM:
      l = t - r - s;
      break;
    case xn.MIDDLE:
      l = (t - r) / 2;
      break;
    default:
      l = s;
      break;
  }
  l = Math.max(je, l);
  let d = 0;
  switch (i) {
    case Ut.CENTER:
      d = (e - n) / 2;
      break;
    case Ut.RIGHT:
      d = e - n;
      break;
  }
  return d = Math.max(Se, d), {
    paddingLeft: d,
    paddingTop: l
  };
}
var sn = class {
  constructor(e, t, n, r, o) {
    V(this, "_dropdownInfoMap", /* @__PURE__ */ new Map());
    V(this, "zIndex");
    this._univerInstanceService = e, this._localeService = t, this._commandService = n, this._renderManagerService = r, this._dataValidationModel = o;
  }
  _ensureMap(e) {
    let t = this._dropdownInfoMap.get(e);
    return t || (t = /* @__PURE__ */ new Map(), this._dropdownInfoMap.set(e, t)), t;
  }
  _generateKey(e, t) {
    return `${e}.${t}`;
  }
  _drawDownIcon(e, t, n, r, o, i, a) {
    const { t: l = rt.pd.t, b: s = rt.pd.b } = a, d = n - he2;
    let u;
    switch (i) {
      case xn.MIDDLE:
        u = (r - Ct) / 2;
        break;
      case xn.BOTTOM:
        u = r - s - o - je + (o / 2 - Ct / 2);
        break;
      default:
        u = l + je + (o / 2 - Ct / 2);
        break;
    }
    e.save(), e.translateWithPrecision(t.startX + d, t.startY + u), e.fillStyle = "#565656", e.fill($n), e.restore();
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  drawWith(e, t, n) {
    var te, B, ne2, ie2, _e2, Ce2;
    const { primaryWithCoord: r, row: o, col: i, style: a, data: l, subUnitId: s } = t, d = r.isMergedMainCell ? r.mergeInfo : r, u = r.isMergedMainCell ? r.mergeInfo.startRow : o, p = r.isMergedMainCell ? r.mergeInfo.startColumn : i, c = this._dataValidationModel.getRuleByLocation(t.unitId, t.subUnitId, u, p);
    if (!c)
      return;
    const m = this._dataValidationModel.getValidator(c.type);
    if (!m)
      return;
    const h2 = l == null ? void 0 : l.fontRenderExtension, { leftOffset: b = 0, rightOffset: y = 0, topOffset: w = 0, downOffset: S = 0 } = h2 || {};
    if (!c || !m || !m || m.id.indexOf(TC.LIST) !== 0 || !m.skipDefaultFontRender(c))
      return;
    const g = {
      startX: d.startX + b,
      endX: d.endX - y,
      startY: d.startY + w,
      endY: d.endY - S
    }, I = g.endX - g.startX, _ = g.endY - g.startY, v = this._ensureMap(s), R = this._generateKey(o, i), P2 = m.getListWithColor(c), N = ne(l), T = `${N != null ? N : ""}`, L = P2.find((z2) => z2.label === T);
    let { tb: D, vt: O, ht: k, pd: x } = a || {};
    D = D != null ? D : Bn.WRAP, O = O != null ? O : xn.BOTTOM, k = k != null ? k : rt.ht, x = x != null ? x : rt.pd;
    const G2 = g3(a).fontCache;
    if (c.renderMode === yC.ARROW) {
      const { l: z2 = rt.pd.l, t: Z2 = rt.pd.t, r: ge = rt.pd.r, b: q = rt.pd.b } = x, M = I - z2 - ge - he2 - 4, U = new v4(
        T,
        G2,
        D === Bn.WRAP,
        M,
        1 / 0
      );
      U.calculate();
      const f = U.getTotalWidth(), A = U.getTotalHeight(), { paddingTop: $, paddingLeft: ce } = xn2(M, _ - Z2 - q, f, A, O, k, true);
      this._drawDownIcon(e, g, I, _, A, O, x), e.save(), e.translateWithPrecision(g.startX + z2, g.startY + Z2), e.beginPath(), e.rect(0, 0, I - z2 - ge, _ - Z2 - q), e.clip(), e.translateWithPrecision(0, $), e.save(), e.translateWithPrecision(ce, 0), e.beginPath(), e.rect(0, 0, M, A), e.clip(), Z4.drawWith(e, {
        text: T,
        fontStyle: G2,
        width: M,
        height: A,
        color: (te = a == null ? void 0 : a.cl) == null ? void 0 : te.rgb,
        strokeLine: !!((B = a == null ? void 0 : a.st) != null && B.s),
        underline: !!((ne2 = a == null ? void 0 : a.ul) != null && ne2.s),
        warp: D === Bn.WRAP,
        hAlign: Ut.LEFT
      }, U), e.restore(), e.restore(), v.set(R, {
        left: g.endX - he2 + n.rowHeaderWidth,
        top: g.startY + Z2 + n.columnHeaderHeight,
        width: he2,
        height: _ - Z2 - q
      });
    } else {
      e.save(), e.translateWithPrecision(g.startX, g.startY), e.beginPath(), e.rect(0, 0, I, _), e.clip();
      const z2 = I - Se * 2 - He - he2 - 4, Z2 = new v4(
        T,
        G2,
        D === Bn.WRAP,
        z2,
        1 / 0
      );
      Z2.calculate();
      const ge = Z2.getTotalWidth(), q = Z2.getTotalHeight(), M = q + jt * 2, U = Math.max(I - Se * 2, 1), { paddingTop: f } = xn2(U, _, ge, M, O, k);
      e.translateWithPrecision(Se, f), I1.drawWith(e, {
        width: U,
        height: M,
        fill: (L == null ? void 0 : L.color) || Te2,
        radius: Yt
      }), e.save(), e.translateWithPrecision(He, jt), e.beginPath(), e.rect(0, 0, z2, q), e.clip(), Z4.drawWith(e, {
        text: T,
        fontStyle: G2,
        width: z2,
        height: q,
        color: (ie2 = a == null ? void 0 : a.cl) == null ? void 0 : ie2.rgb,
        strokeLine: !!((_e2 = a == null ? void 0 : a.st) != null && _e2.s),
        underline: !!((Ce2 = a == null ? void 0 : a.ul) != null && Ce2.s),
        warp: D === Bn.WRAP,
        hAlign: Ut.LEFT
      }, Z2), e.restore(), e.translateWithPrecision(z2 + He + 4, (q - Ct) / 2), e.fillStyle = Yi, e.fill($n), e.restore(), v.set(R, {
        left: g.startX + Se + n.rowHeaderWidth,
        top: g.startY + f + n.columnHeaderHeight,
        width: U,
        height: M
      });
    }
  }
  calcCellAutoHeight(e) {
    const { primaryWithCoord: t, style: n, data: r, row: o, col: i } = e, a = t.isMergedMainCell ? t.mergeInfo : t, l = r == null ? void 0 : r.fontRenderExtension, { leftOffset: s = 0, rightOffset: d = 0, topOffset: u = 0, downOffset: p = 0 } = l || {}, c = this._dataValidationModel.getRuleByLocation(e.unitId, e.subUnitId, o, i);
    if (!c || c.renderMode === yC.TEXT)
      return;
    const m = {
      startX: a.startX + s,
      endX: a.endX - d,
      startY: a.startY + u,
      endY: a.endY - p
    }, h2 = m.endX - m.startX, b = ne(r), y = `${b != null ? b : ""}`;
    let { tb: w, pd: S } = n || {};
    const { t: g = rt.pd.t, b: I = rt.pd.b } = S != null ? S : {};
    if (w = w != null ? w : Bn.WRAP, c.renderMode === yC.ARROW) {
      const { l: _ = rt.pd.l, r: v = rt.pd.r } = S != null ? S : {}, R = h2 - _ - v - he2 - 4, P2 = new v4(
        y,
        g3(n).fontCache,
        w === Bn.WRAP,
        R,
        1 / 0
      );
      return P2.calculate(), P2.getTotalHeight() + g + I + je * 2;
    } else {
      const _ = Math.max(h2 - Se * 2 - He - he2 - 4, 10), v = new v4(
        y,
        g3(n).fontCache,
        w === Bn.WRAP,
        _,
        1 / 0
      );
      return v.calculate(), v.getTotalHeight() + je * 2 + jt * 2;
    }
  }
  calcCellAutoWidth(e) {
    const { primaryWithCoord: t, style: n, data: r, row: o, col: i } = e, a = t.isMergedMainCell ? t.mergeInfo : t, l = r == null ? void 0 : r.fontRenderExtension, { leftOffset: s = 0, rightOffset: d = 0, topOffset: u = 0, downOffset: p = 0 } = l || {}, c = this._dataValidationModel.getRuleByLocation(e.unitId, e.subUnitId, o, i);
    if (!c || c.renderMode === yC.TEXT)
      return;
    const m = {
      startX: a.startX + s,
      endX: a.endX - d,
      startY: a.startY + u,
      endY: a.endY - p
    }, h2 = m.endX - m.startX, b = ne(r), y = `${b != null ? b : ""}`;
    let { tb: w, pd: S } = n || {};
    const { l: g = rt.pd.l, r: I = rt.pd.r } = S != null ? S : {};
    w = w != null ? w : Bn.WRAP;
    let _ = Se * 2 + he2;
    switch (c.renderMode) {
      case yC.ARROW:
        _ = he2 + 4 + I + g;
        break;
      case yC.CUSTOM:
        _ = he2 + Se * 2 + He * 2 + I + g + Yt / 2 + 1;
        break;
      default:
        _ = he2 + Se * 2 + He * 2 + I + g + Yt / 2 + 1;
    }
    const v = h2 - _, R = new v4(
      y,
      g3(n).fontCache,
      w === Bn.WRAP,
      v,
      1 / 0
    );
    return R.calculate(), R.getTotalWidth() + _;
  }
  isHit(e, t) {
    const { subUnitId: n, row: r, col: o } = t, a = this._ensureMap(n).get(this._generateKey(r, o)), l = this._dataValidationModel.getRuleByLocation(t.unitId, t.subUnitId, r, o);
    if (!l || !a || l.renderMode === yC.TEXT)
      return false;
    const { top: s, left: d, width: u, height: p } = a, { x: c, y: m } = e;
    return c >= d && c <= d + u && m >= s && m <= s + p;
  }
  onPointerDown(e, t) {
    if (t.button === 2)
      return;
    const { unitId: n, subUnitId: r, row: o, col: i } = e, a = {
      unitId: n,
      subUnitId: r,
      row: o,
      column: i
    };
    this._commandService.executeCommand(Pt.id, a);
  }
  onPointerEnter(e, t) {
    var n, r;
    (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null || r.setCursor(v1.POINTER);
  }
  onPointerLeave(e, t) {
    var n, r;
    (r = (n = IE(we.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService)) == null ? void 0 : n.mainComponent) == null || r.setCursor(v1.DEFAULT);
  }
};
sn = ji([
  it(0, vr),
  it(1, Inject(Fn)),
  it(2, Ls),
  it(3, Inject(ME)),
  it(4, Inject(F2))
], sn);
var Xi = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.LIST);
    V(this, "canvasRender", this.injector.createInstance(sn));
    V(this, "dropdownType", Ve3.LIST);
    V(this, "optionsInput", Et.componentKey);
    V(this, "formulaInput", tr);
  }
};
var Zi = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.TEXT_LENGTH);
    V(this, "formulaInput", er);
  }
};
var Ki = class extends fe3 {
  constructor() {
    super(...arguments);
    V(this, "id", TC.WHOLE);
    V(this, "formulaInput", er);
  }
};
var Gi2 = Object.getOwnPropertyDescriptor;
var zi = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? Gi2(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Xt = (e, t) => (n, r) => t(n, r, e);
var et3 = class extends h1 {
  constructor(e, t, n) {
    super(), this._injector = e, this._componentManger = t, this._dataValidatorRegistryService = n, this._initComponents(), this._registerValidatorViews();
  }
  _initComponents() {
    [
      ["DataValidationIcon", Ir],
      [Mt, vi],
      [Et.componentKey, Et],
      [Dt.componentKey, Dt],
      ...Ii
    ].forEach(([e, t]) => {
      this.disposeWithMe(this._componentManger.register(
        e,
        t
      ));
    });
  }
  _registerValidatorViews() {
    [
      Li,
      Ki,
      Zi,
      Pi,
      Ti,
      Xi,
      Wi2,
      Oi
    ].forEach((e) => {
      const t = this._injector.createInstance(e), n = this._dataValidatorRegistryService.getValidatorItem(t.id);
      n && (n.formulaInput = t.formulaInput, n.canvasRender = t.canvasRender, n.dropdownType = t.dropdownType, n.optionsInput = t.optionsInput);
    });
  }
};
et3 = zi([
  Xt(0, Inject(Injector)),
  Xt(1, Inject(S12)),
  Xt(2, Inject(F))
], et3);
var qi = Object.getOwnPropertyDescriptor;
var Ji = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? qi(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Zt = (e, t) => (n, r) => t(n, r, e);
var Qi = "SHEET_DATA_VALIDATION_UI_PLUGIN";
var St;
var Bn2 = (St = class extends Ol {
  constructor(e = yt, t, n, r) {
    super(), this._config = e, this._injector = t, this._commandService = n, this._configService = r;
    const { menu: o, ...i } = oo(
      {},
      yt,
      this._config
    );
    o && this._configService.setConfig("menu", o, { merge: true }), this._configService.setConfig(_n, i);
  }
  onStarting() {
    [
      [me],
      [Ne],
      [ut],
      [ze],
      [Qe],
      [Je],
      [qe2],
      [et3]
    ].forEach((e) => {
      this._injector.add(e);
    }), [
      Lt,
      Pt,
      fr,
      Cn,
      Fe,
      mr
    ].forEach((e) => {
      this._commandService.registerCommand(e);
    });
  }
  onReady() {
    this._injector.get(qe2), this._injector.get(Je), this._injector.get(ME).registerRenderModule(
      we.UNIVER_SHEET,
      [bt2]
    );
  }
  onRendered() {
    this._injector.get(et3), this._injector.get(Qe);
  }
  onSteady() {
    this._injector.get(ze);
  }
}, V(St, "pluginName", Qi), V(St, "type", we.UNIVER_SHEET), St);
Bn2 = Ji([
  Zt(1, Inject(Injector)),
  Zt(2, Ls),
  Zt(3, ic)
], Bn2);
var ea = Object.defineProperty;
var ta = Object.getOwnPropertyDescriptor;
var na = (e, t, n) => t in e ? ea(e, t, { enumerable: true, configurable: true, writable: true, value: n }) : e[t] = n;
var ra = (e, t, n, r) => {
  for (var o = r > 1 ? void 0 : r ? ta(t, n) : t, i = e.length - 1, a; i >= 0; i--)
    (a = e[i]) && (o = a(o) || o);
  return o;
};
var Kt = (e, t) => (n, r) => t(n, r, e);
var Dr2 = (e, t, n) => na(e, typeof t != "symbol" ? t + "" : t, n);
var oa = "SHEET_DATA_VALIDATION_UI_PLUGIN";
var Tt = class extends Ol {
  constructor(e = yt, t, n, r) {
    super(), this._config = e, this._injector = t, this._commandService = n, this._configService = r;
    const { menu: o, ...i } = oo(
      {},
      yt,
      this._config
    );
    o && this._configService.setConfig("menu", o, { merge: true }), this._configService.setConfig(_n, i);
  }
  onStarting() {
    [
      [me],
      [Ne],
      [ut],
      [ze],
      [Qe],
      [Je],
      [qe2],
      [Ge],
      [et3]
    ].forEach((e) => {
      this._injector.add(e);
    }), [
      Lt,
      Pt,
      fr,
      Cn,
      Fe,
      mr
    ].forEach((e) => {
      this._commandService.registerCommand(e);
    });
  }
  onReady() {
    this._injector.get(qe2), this._injector.get(Je), this._injector.get(Ge), this._injector.get(ut), this._injector.get(ME).registerRenderModule(
      we.UNIVER_SHEET,
      [bt2]
    );
  }
  onRendered() {
    this._injector.get(et3), this._injector.get(Qe);
  }
  onSteady() {
    this._injector.get(ze);
  }
};
Dr2(Tt, "pluginName", oa);
Dr2(Tt, "type", we.UNIVER_SHEET);
Tt = ra([
  qR(Ie),
  Kt(1, Inject(Injector)),
  Kt(2, Ls),
  Kt(3, ic)
], Tt);

export {
  fe3 as fe,
  Bn2 as Bn,
  Tt
};
//# sourceMappingURL=chunk-Q5F7IOB3.js.map
