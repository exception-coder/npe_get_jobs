import {
  M,
  m
} from "./chunk-2GFBUOZM.js";
import {
  C,
  S
} from "./chunk-FOCXVU2X.js";
import {
  Wr
} from "./chunk-RWMUFXJB.js";
import {
  B1,
  Bi,
  D1,
  Et2 as Et,
  H1,
  Jt2 as Jt,
  Ra,
  S1,
  Y1,
  a1,
  c1,
  connectInjector,
  ct,
  en2 as en,
  fe,
  gn,
  he,
  lh,
  ue,
  useDependency,
  useObservable,
  we as we2,
  yi2 as yi
} from "./chunk-DZMX4FYO.js";
import {
  Ct,
  Dr,
  Eo,
  Ft,
  G,
  I1,
  ME,
  Me,
  NB,
  P,
  PB,
  Pe,
  Rd,
  Te,
  Th2 as Th,
  Ts,
  Ue,
  Vs,
  Xe2 as Xe,
  Xs2 as Xs,
  Ye,
  Yn,
  _e2 as _e,
  cs,
  dd,
  dn,
  ds,
  ee2 as ee,
  fd,
  ht,
  ie as ie2,
  k2,
  ke,
  ph,
  qr,
  ve2 as ve,
  x3,
  xt,
  z,
  zc as zc2
} from "./chunk-I7I3GTAS.js";
import {
  IE,
  LE,
  O,
  Vx,
  XS,
  cE,
  em,
  ie,
  kt,
  lE,
  oE,
  pr,
  require_jsx_runtime,
  require_react,
  sE,
  vf,
  vr as vr2,
  xE
} from "./chunk-YFGUMDM2.js";
import {
  BehaviorSubject,
  En,
  Fn,
  GC,
  Gi,
  Inject,
  Injector,
  JR,
  Jo,
  Le,
  Ls,
  Ms,
  Nr,
  Ol,
  QR,
  Qo,
  Subject,
  V1,
  Ve,
  _E,
  bt,
  debounceTime,
  distinctUntilChanged,
  eC,
  et,
  filter,
  fn,
  fo,
  h1,
  ic,
  m1,
  map,
  merge,
  of,
  oo,
  pt,
  qR,
  sr,
  startWith,
  switchMap,
  takeUntil,
  vr,
  we,
  xn,
  yt,
  zc
} from "./chunk-RGZYGL3P.js";
import {
  __toESM
} from "./chunk-DC5AMYBS.js";

// node_modules/@univerjs/sheets-table/lib/es/index.js
var et2 = Object.defineProperty;
var tt = (t, e, n) => e in t ? et2(t, e, { enumerable: true, configurable: true, writable: true, value: n }) : t[e] = n;
var b = (t, e, n) => tt(t, typeof e != "symbol" ? e + "" : e, n);
var M2 = ((t) => (t.Insert = "insert", t.Delete = "delete", t))(M2 || {});
var y = ((t) => (t.Row = "row", t.Col = "column", t))(y || {});
var Ye2 = ((t) => (t.None = "none", t.String = "string", t.Number = "number", t.Date = "date", t.Bool = "bool", t.Checkbox = "checkbox", t.List = "list", t))(Ye2 || {});
var ne = ((t) => (t.manual = "manual", t.condition = "condition", t))(ne || {});
var O2 = ((t) => (t.Date = "date", t.Number = "number", t.String = "string", t.Logic = "logic", t))(O2 || {});
var F = ((t) => (t.Equal = "equal", t.NotEqual = "notEqual", t.GreaterThan = "greaterThan", t.GreaterThanOrEqual = "greaterThanOrEqual", t.LessThan = "lessThan", t.LessThanOrEqual = "lessThanOrEqual", t.Between = "between", t.NotBetween = "notBetween", t.Above = "above", t.Below = "below", t.TopN = "topN", t))(F || {});
var V = ((t) => (t.Equal = "equal", t.NotEqual = "notEqual", t.Contains = "contains", t.NotContains = "notContains", t.StartsWith = "startsWith", t.EndsWith = "endsWith", t))(V || {});
var m2 = ((t) => (t.Equal = "equal", t.NotEqual = "notEqual", t.After = "after", t.AfterOrEqual = "afterOrEqual", t.Before = "before", t.BeforeOrEqual = "beforeOrEqual", t.Between = "between", t.NotBetween = "notBetween", t.Today = "today", t.Yesterday = "yesterday", t.Tomorrow = "tomorrow", t.ThisWeek = "thisWeek", t.LastWeek = "lastWeek", t.NextWeek = "nextWeek", t.ThisMonth = "thisMonth", t.LastMonth = "lastMonth", t.NextMonth = "nextMonth", t.ThisQuarter = "thisQuarter", t.LastQuarter = "lastQuarter", t.NextQuarter = "nextQuarter", t.ThisYear = "thisYear", t.LastYear = "lastYear", t.NextYear = "nextYear", t.YearToDate = "yearToDate", t.Quarter = "quarter", t.Month = "month", t.M1 = "m1", t.M2 = "m2", t.M3 = "m3", t.M4 = "m4", t.M5 = "m5", t.M6 = "m6", t.M7 = "m7", t.M8 = "m8", t.M9 = "m9", t.M10 = "m10", t.M11 = "m11", t.M12 = "m12", t.Q1 = "q1", t.Q2 = "q2", t.Q3 = "q3", t.Q4 = "q4", t))(m2 || {});
var P2 = ((t) => (t[t.FilteredSortNone = 1] = "FilteredSortNone", t[t.FilteredSortAsc = 2] = "FilteredSortAsc", t[t.FilteredSortDesc = 3] = "FilteredSortDesc", t[t.FilterNoneSortNone = 4] = "FilterNoneSortNone", t[t.FilterNoneSortAsc = 5] = "FilterNoneSortAsc", t[t.FilterNoneSortDesc = 6] = "FilterNoneSortDesc", t))(P2 || {});
var G2 = ((t) => (t.Asc = "asc", t.Desc = "desc", t.None = "none", t))(G2 || {});
function te(t, e) {
  return `${e} ${t}`;
}
var ve2 = "TRUE";
var Fe = "FALSE";
var pt2 = (t) => {
  var n;
  return ((n = t.body) == null ? void 0 : n.dataStream.replace(/\r\n$/, "")) || "";
};
function Ge(t) {
  if (t) {
    const { v: e, t: n, p: s } = t;
    return s ? pt2(s) : (n === fn.FORCE_STRING || n === fn.STRING) && e !== void 0 && e !== null ? String(e) : n === fn.BOOLEAN ? e ? ve2 : Fe : n === fn.NUMBER ? String(e) : typeof e === "boolean" ? e ? ve2 : Fe : e == null ? "" : String(e);
  }
  return "";
}
function _t(t, e) {
  if (t != null)
    switch (e) {
      case G2.Asc:
        return P2.FilteredSortAsc;
      case G2.Desc:
        return P2.FilteredSortDesc;
      default:
        return P2.FilteredSortNone;
    }
  else
    switch (e) {
      case G2.Asc:
        return P2.FilterNoneSortAsc;
      case G2.Desc:
        return P2.FilterNoneSortDesc;
      default:
        return P2.FilterNoneSortNone;
    }
}
function Tt(t) {
  return t ? t.filterType === ne.condition : false;
}
function rs(t) {
  return t ? t.filterType === ne.manual : false;
}
var D = {
  s: Le.THIN,
  cl: {
    rgb: "rgb(95, 101, 116)"
  }
};
var ze = "sheets-table.config";
var ye = {};
var as = {
  headerRowStyle: {
    bd: {
      t: D
    }
  },
  headerColumnStyle: {
    bd: {
      l: D
    }
  },
  lastColumnStyle: {
    bd: {
      r: D
    }
  },
  lastRowStyle: {
    bd: {
      b: D
    }
  }
};
var os = (t, e) => {
  if (t === "headerRowStyle") {
    if (!e.bd)
      return {
        ...e,
        bd: {
          t: D
        }
      };
  } else if (t === "lastRowStyle") {
    if (!e.bd)
      return {
        ...e,
        bd: {
          b: D
        }
      };
  } else if (t === "lastColumnStyle") {
    if (!e.bd)
      return {
        ...e,
        bd: {
          r: D
        }
      };
  } else if (t === "headerColumnStyle" && !e.bd)
    return {
      ...e,
      bd: {
        l: D
      }
    };
  return e;
};
var It = [
  [["#6280F9", "#FFFFFF", "#BAC6F8", "#D2DAFA"], ["#fff"]],
  [["#16BDCA", "#FFFFFF", "#EDFAFA", "#AFECEF"], ["#000"]],
  [["#31C48D", "#FFFFFF", "#F3FAF7", "#BCF0DA"], ["#fff"]],
  [["#AC94FA", "#FFFFFF", "#F6F5FF", "#EDEBFE"], ["#fff"]],
  [["#F17EBB", "#FFFFFF", "#FDF2F8", "#FCE8F3"], ["#fff"]],
  [["#F98080", "#FFFFFF", "#FDF2F2", "#FDE8E8"], ["#fff"]]
];
var je = It.map((t, e) => {
  const [n, s] = t, [r, a, o, u] = n, [l3] = s;
  return {
    name: `table-default-${e}`,
    style: {
      headerRowStyle: {
        bg: {
          rgb: r
        },
        cl: {
          rgb: l3
        },
        bd: {
          t: D
        }
      },
      headerColumnStyle: {
        bd: {
          l: D
        }
      },
      firstRowStyle: {
        bg: {
          rgb: a
        }
      },
      secondRowStyle: {
        bg: {
          rgb: o
        }
      },
      lastRowStyle: {
        bg: {
          rgb: u
        },
        bd: {
          b: D
        }
      },
      lastColumnStyle: {
        bd: {
          r: D
        }
      }
    }
  };
});
var j = class {
  constructor(e, n) {
    b(this, "dataType");
    b(this, "id");
    b(this, "displayName");
    b(this, "formula");
    b(this, "meta");
    b(this, "style");
    this.id = e, this.displayName = n, this.dataType = Ye2.String, this.formula = "", this.meta = {}, this.style = {};
  }
  getMeta() {
    return this.meta;
  }
  setMeta(e) {
    this.meta = e;
  }
  getDisplayName() {
    return this.displayName;
  }
  toJSON() {
    return {
      id: this.id,
      displayName: this.displayName,
      dataType: this.dataType,
      formula: this.formula,
      meta: this.meta,
      style: this.style
    };
  }
  fromJSON(e) {
    this.id = e.id, this.displayName = e.displayName, this.dataType = e.dataType, this.formula = e.formula, this.meta = e.meta, this.style = e.style;
  }
};
var Mt = (t) => t.getMonth() <= 2;
var vt = (t) => {
  const e = t.getMonth();
  return e > 2 && e <= 5;
};
var Ft2 = (t) => {
  const e = t.getMonth();
  return e > 5 && e <= 8;
};
var yt2 = (t) => {
  const e = t.getMonth();
  return e > 8 && e <= 11;
};
var Nt = (t) => t.getMonth() === 0;
var Dt = (t) => t.getMonth() === 1;
var xt2 = (t) => t.getMonth() === 2;
var Ot = (t) => t.getMonth() === 3;
var Ut = (t) => t.getMonth() === 4;
var $t = (t) => t.getMonth() === 5;
var At = (t) => t.getMonth() === 6;
var Et2 = (t) => t.getMonth() === 7;
var Bt = (t) => t.getMonth() === 8;
var Lt = (t) => t.getMonth() === 9;
var Wt = (t) => t.getMonth() === 10;
var Ht = (t) => t.getMonth() === 11;
var Vt = (t, e = /* @__PURE__ */ new Date()) => t.toDateString() === e.toDateString();
var Pt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = new Date(e);
  return n.setDate(n.getDate() + 1), t.toDateString() === n.toDateString();
};
var qt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = new Date(e);
  return n.setDate(n.getDate() - 1), t.toDateString() === n.toDateString();
};
var K = (t) => {
  const e = t.getDay(), n = t.getDate() - e + (e === 0 ? -6 : 1), s = new Date(t);
  return s.setDate(n), s;
};
var Ke = 10080 * 60 * 1e3;
var Jt2 = (t, e = /* @__PURE__ */ new Date()) => {
  const n = K(t), s = K(e);
  return n.toDateString() === s.toDateString();
};
var kt2 = (t, e = /* @__PURE__ */ new Date()) => {
  const n = K(t), s = new Date(K(e).getTime() + Ke);
  return n.toDateString() === s.toDateString();
};
var Qt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = K(t), s = new Date(K(e).getTime() - Ke);
  return n.toDateString() === s.toDateString();
};
var Yt = (t, e = /* @__PURE__ */ new Date()) => t.getFullYear() === e.getFullYear() && t.getMonth() === e.getMonth();
var Gt = (t) => {
  const e = new Date(t);
  return e.setHours(0, 0, 0, 0), e.setDate(1), e;
};
var zt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = new Date(e);
  n.setHours(0, 0, 0, 0), n.setMonth(n.getMonth() + 1, 1);
  const s = new Date(n);
  s.setMonth(s.getMonth() + 1, 0);
  const r = t.getTime();
  return r >= n.getTime() && r < s.getTime();
};
var jt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = Gt(e), s = new Date(n);
  s.setMonth(s.getMonth() + 1, 0);
  const r = t.getTime();
  return r >= n.getTime() && r < s.getTime();
};
var _e2 = (t) => {
  const e = new Date(t);
  e.setHours(0, 0, 0, 0), e.setDate(1);
  const n = e.getMonth();
  return e.setMonth(n - n % 3), e;
};
var Kt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = _e2(e), s = new Date(n);
  s.setMonth(s.getMonth() + 3);
  const r = t.getTime();
  return r >= n.getTime() && r < s.getTime();
};
var Xt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = _e2(e), s = new Date(n);
  s.setMonth(s.getMonth() + 3);
  const r = new Date(s);
  r.setMonth(r.getMonth() + 3, 0);
  const a = t.getTime();
  return a >= s.getTime() && a < r.getTime();
};
var Zt = (t, e = /* @__PURE__ */ new Date()) => {
  const n = _e2(e), s = new Date(n);
  s.setMonth(s.getMonth() - 3);
  const r = new Date(n);
  r.setDate(0);
  const a = t.getTime();
  return a >= s.getTime() && a < r.getTime();
};
var en2 = (t, e = /* @__PURE__ */ new Date()) => t.getFullYear() === e.getFullYear();
var tn = (t, e = /* @__PURE__ */ new Date()) => t.getFullYear() === e.getFullYear() + 1;
var nn = (t, e = /* @__PURE__ */ new Date()) => t.getFullYear() === e.getFullYear() - 1;
var sn = (t, e = /* @__PURE__ */ new Date()) => {
  const n = new Date(e);
  n.setHours(0, 0, 0, 0), n.setMonth(0, 1);
  const s = t.getTime();
  return s >= n.getTime() && s < e.getTime();
};
function rn(t) {
  switch (t.compareType) {
    case m2.Equal: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() === e.getTime();
    }
    case m2.NotEqual: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() !== e.getTime();
    }
    case m2.After: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() > e.getTime();
    }
    case m2.Before: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() < e.getTime();
    }
    case m2.AfterOrEqual: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() >= e.getTime();
    }
    case m2.BeforeOrEqual: {
      const e = new Date(t.expectedValue);
      return (n) => n.getTime() <= e.getTime();
    }
    case m2.Between:
      return (e) => {
        const [n, s] = t.expectedValue;
        return e.getTime() >= new Date(n).getTime() && e.getTime() <= new Date(s).getTime();
      };
    case m2.NotBetween:
      return (e) => {
        const [n, s] = t.expectedValue;
        return e.getTime() < new Date(n).getTime() || e.getTime() > new Date(s).getTime();
      };
    case m2.Today: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Vt(n, e);
    }
    case m2.Yesterday: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => qt(n, e);
    }
    case m2.Tomorrow: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Pt(n, e);
    }
    case m2.ThisWeek: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Jt2(n, e);
    }
    case m2.LastWeek: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Qt(n, e);
    }
    case m2.NextWeek: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => kt2(n, e);
    }
    case m2.ThisMonth: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Yt(n, e);
    }
    case m2.LastMonth: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => jt(n, e);
    }
    case m2.NextMonth: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => zt(n, e);
    }
    case m2.ThisQuarter: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Kt(n, e);
    }
    case m2.LastQuarter: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Zt(n, e);
    }
    case m2.NextQuarter: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => Xt(n, e);
    }
    case m2.ThisYear: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => en2(n, e);
    }
    case m2.LastYear: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => nn(n, e);
    }
    case m2.NextYear: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => tn(n, e);
    }
    case m2.YearToDate: {
      const e = t.anchorTime ? new Date(t.anchorTime) : /* @__PURE__ */ new Date();
      return (n) => sn(n, e);
    }
    case m2.M1:
      return Nt;
    case m2.M2:
      return Dt;
    case m2.M3:
      return xt2;
    case m2.M4:
      return Ot;
    case m2.M5:
      return Ut;
    case m2.M6:
      return $t;
    case m2.M7:
      return At;
    case m2.M8:
      return Et2;
    case m2.M9:
      return Bt;
    case m2.M10:
      return Lt;
    case m2.M11:
      return Wt;
    case m2.M12:
      return Ht;
    case m2.Q1:
      return Mt;
    case m2.Q2:
      return vt;
    case m2.Q3:
      return Ft2;
    case m2.Q4:
      return yt2;
    default:
      throw new Error("Unsupported compare type");
  }
}
var an = class {
  /**
   * Initializes a new instance of the Heap class.
   */
  constructor() {
    b(this, "heap");
    this.heap = [];
  }
  /**
   * Swaps the elements at the given indices in the heap.
   * @param index1 The index of the first element.
   * @param index2 The index of the second element.
   */
  swap(e, n) {
    const s = this.heap[e];
    this.heap[e] = this.heap[n], this.heap[n] = s;
  }
  /**
   * Returns the index of the parent node for the given index.
   * @param index The index of the node.
   * @returns The index of the parent node.
   */
  getParentIndex(e) {
    return Math.floor((e - 1) / 2);
  }
  /**
   * Returns the index of the left child node for the given index.
   * @param index The index of the node.
   * @returns The index of the left child node.
   */
  getLeftIndex(e) {
    return e * 2 + 1;
  }
  /**
   * Returns the index of the right child node for the given index.
   * @param index The index of the node.
   * @returns The index of the right child node.
   */
  getRightIndex(e) {
    return e * 2 + 2;
  }
  /**
   * Returns the number of elements in the heap.
   * @returns The number of elements in the heap.
   */
  size() {
    return this.heap.length;
  }
  /**
   * Returns the minimum value in the heap without removing it.
   * @returns The minimum value in the heap.
   */
  peek() {
    return this.heap[0];
  }
  /**
   * @description Returns whether the heap includes the given value.
   * @param {number} value  The value to be checked.
   * @returns {boolean} return true if the heap includes the given value
   */
  include(e) {
    return this.heap.includes(e);
  }
};
var on = class extends an {
  /**
   * Initializes a new instance of the MinHeap class.
   */
  constructor() {
    super();
  }
  /**
   * Moves the element at the given index up the heap until it satisfies the min heap property.
   * @param index The index of the element to be shifted up.
   */
  shiftUp(e) {
    if (e === 0)
      return;
    const n = this.getParentIndex(e);
    this.heap[n] > this.heap[e] && (this.swap(n, e), this.shiftUp(n));
  }
  /**
   * Moves the element at the given index down the heap until it satisfies the min heap property.
   * @param index The index of the element to be shifted down.
   */
  shiftDown(e) {
    const n = this.getLeftIndex(e), s = this.getRightIndex(e);
    this.heap[n] < this.heap[e] && (this.swap(n, e), this.shiftDown(n)), this.heap[s] < this.heap[e] && (this.swap(s, e), this.shiftDown(s));
  }
  /**
   * Inserts a new value into the min heap.
   * @param value The value to be inserted.
   */
  insert(e) {
    this.heap.push(e), this.shiftUp(this.heap.length - 1);
  }
  /**
   * Removes and returns the minimum value from the min heap.
   */
  pop() {
    this.heap[0] = this.heap.pop(), this.shiftDown(0);
  }
};
var ln = (t, e) => {
  const n = new on();
  for (const s of t)
    n.insert(s), n.size() > e && n.pop();
  return n.heap;
};
var un = (t, e) => t > e;
var cn = (t, e) => t < e;
var dn2 = (t, e, n) => ln(t, e).includes(n);
function hn(t, e) {
  switch (t.compareType) {
    case F.Equal: {
      const n = Number(t.expectedValue);
      return (s) => s === n;
    }
    case F.NotEqual: {
      const n = Number(t.expectedValue);
      return (s) => s !== n;
    }
    case F.GreaterThan: {
      const n = Number(t.expectedValue);
      return (s) => s > n;
    }
    case F.GreaterThanOrEqual: {
      const n = Number(t.expectedValue);
      return (s) => s >= n;
    }
    case F.LessThan: {
      const n = Number(t.expectedValue);
      return (s) => s < n;
    }
    case F.LessThanOrEqual: {
      const n = Number(t.expectedValue);
      return (s) => s <= n;
    }
    case F.Between: {
      const [n, s] = t.expectedValue, r = Number(n), a = Number(s);
      return r > a ? (o) => o >= a && o <= r : (o) => o >= r && o <= a;
    }
    case F.NotBetween: {
      const [n, s] = t.expectedValue, r = Number(n), a = Number(s);
      return r > a ? (o) => o < a || o > r : (o) => o < r || o > a;
    }
    case F.Above: {
      const n = e.average;
      return (s) => un(s, n);
    }
    case F.Below: {
      const n = e.average;
      return (s) => cn(s, n);
    }
    case F.TopN: {
      const n = e.list, s = Number(t.expectedValue);
      return (r) => dn2(n, s, r);
    }
  }
}
var gn2 = (t, e) => m1(e).test(t);
var mn = (t, e) => !m1(e).test(t);
var bn = (t, e) => m1(`*${e}*`).test(t);
var wn = (t, e) => !m1(`*${e}*`).test(t);
var fn2 = (t, e) => m1(`${e}*`).test(t);
var Rn = (t, e) => m1(`*${e}`).test(t);
function Sn(t) {
  switch (t.compareType) {
    case V.Equal:
      return (e) => gn2(e, t.expectedValue);
    case V.NotEqual:
      return (e) => mn(e, t.expectedValue);
    case V.Contains:
      return (e) => bn(e, t.expectedValue);
    case V.NotContains:
      return (e) => wn(e, t.expectedValue);
    case V.StartsWith:
      return (e) => fn2(e, t.expectedValue);
    case V.EndsWith:
      return (e) => Rn(e, t.expectedValue);
    default:
      return console.error(`Unknown filter operator: ${t.compareType}`), (e) => true;
  }
}
var Cn = /* @__PURE__ */ new Set([
  F.Above,
  F.Below,
  F.TopN
]);
m2.Today, m2.Yesterday, m2.Tomorrow, m2.ThisWeek, m2.LastWeek, m2.NextWeek, m2.ThisMonth, m2.LastMonth, m2.NextMonth, m2.ThisQuarter, m2.LastQuarter, m2.NextQuarter, m2.NextYear, m2.ThisYear, m2.LastYear, m2.YearToDate;
function Xe2(t) {
  return Cn.has(t);
}
function pn(t, e) {
  if (Xe2(t.filterInfo.compareType))
    return (n) => true;
  switch (t.filterInfo.conditionType) {
    case O2.Date:
      return rn(t.filterInfo);
    case O2.Number:
      return hn(t.filterInfo, e);
    case O2.String:
      return Sn(t.filterInfo);
    case O2.Logic:
    default:
      return (n) => true;
  }
}
function ue2(t, e, n, s) {
  switch (s) {
    case O2.Date: {
      const r = Ne(t, e, n);
      return r ? In(r) : null;
    }
    case O2.Number:
      return Ne(t, e, n);
    case O2.String:
    default:
      return Tn(t, e, n);
  }
}
var _n = (t) => {
  var n;
  return ((n = t.body) == null ? void 0 : n.dataStream.replace(/\r\n$/, "")) || "";
};
function Tn(t, e, n) {
  const s = t.getCell(e, n);
  if (!s) return null;
  const { v: r, t: a, p: o } = s;
  if (o)
    return _n(o);
  if (typeof r == "string")
    return a === fn.BOOLEAN ? r.toUpperCase() : r;
  if (typeof r == "number")
    return a === fn.BOOLEAN ? r ? "TRUE" : "FALSE" : r;
  if (typeof r == "boolean") return r ? "TRUE" : "FALSE";
  if (r !== void 0)
    return String(r);
}
function Ne(t, e, n) {
  const s = t.getCell(e, n);
  if (!s) return null;
  const { v: r, t: a, p: o } = s;
  return o ? null : typeof r == "string" && a === fn.NUMBER ? Number(t.getCellRaw(e, n).v) : Number(r);
}
function In(t) {
  const e = new Date(Date.UTC(1900, 0, 1, 0, 0, 0)), n = new Date(Date.UTC(1900, 1, 28, 0, 0, 0));
  let s = t - 1;
  return s > (n.getTime() - e.getTime()) / (1e3 * 3600 * 24) && (s -= 1), s < 0 && (s = t), new Date(e.getTime() + s * (1e3 * 3600 * 24));
}
var De = class {
  constructor() {
    b(this, "_tableColumnFilterList");
    b(this, "_tableSortInfo");
    b(this, "_filterOutRows");
    this._tableColumnFilterList = [];
  }
  setColumnFilter(e, n) {
    n ? this._tableColumnFilterList[e] = n : this._tableColumnFilterList[e] = void 0;
  }
  setSortState(e, n) {
    this._tableSortInfo = { columnIndex: e, sortState: n };
  }
  getColumnFilter(e) {
    return this._tableColumnFilterList[e];
  }
  getFilterState(e) {
    var s;
    const n = ((s = this._tableSortInfo) == null ? void 0 : s.columnIndex) === e ? this._tableSortInfo.sortState : G2.None;
    return _t(this._tableColumnFilterList[e], n);
  }
  getSortState() {
    var e;
    return (e = this._tableSortInfo) != null ? e : {};
  }
  getFilterStates(e) {
    const n = [], { startColumn: s, endColumn: r } = e;
    for (let a = s; a <= r; a++)
      n.push(this.getFilterState(a - s));
    return n;
  }
  getFilterOutRows() {
    return this._filterOutRows;
  }
  doFilter(e, n) {
    const s = /* @__PURE__ */ new Set(), r = this._tableColumnFilterList;
    for (let a = 0; a < r.length; a++)
      r[a] && this.doColumnFilter(e, n, a, s);
    return this._filterOutRows = s, s;
  }
  doColumnFilter(e, n, s, r) {
    const a = this._tableColumnFilterList[s];
    if (a && e) {
      const { startRow: o, endRow: u, startColumn: l3 } = n, i = l3 + s, h = this.getExecuteFunc(e, n, s, a);
      for (let d = o; d <= u; d++) {
        const c = Tt(a) ? a.filterInfo.conditionType : O2.String;
        ue2(e, d, i, c) === null ? r.add(d) : h(ue2(e, d, i, c)) || r.add(d);
      }
    }
  }
  _getNumberCalculatedOptions(e, n, s) {
    const { startRow: r, endRow: a, startColumn: o } = n, u = o + s, l3 = [];
    let i = 0, h = 0;
    for (let d = r; d <= a; d++) {
      const c = ue2(e, d, u, O2.Number);
      c !== null && (l3.push(c), i++, h += c);
    }
    return {
      list: l3,
      average: i > 0 ? h / i : 0
    };
  }
  getExecuteFunc(e, n, s, r) {
    if (r.filterType === ne.manual) {
      const a = new Set(r.values);
      return (o) => a.has(o);
    } else if (r.filterType === ne.condition) {
      const o = Xe2(r.filterInfo.compareType) ? this._getNumberCalculatedOptions(e, n, s) : void 0;
      return pn(r, o);
    } else
      return (a) => true;
  }
  toJSON() {
    return {
      tableColumnFilterList: this._tableColumnFilterList,
      tableSortInfo: this._tableSortInfo
    };
  }
  fromJSON(e) {
    var n;
    this._tableColumnFilterList = (n = e.tableColumnFilterList) != null ? n : [], e.tableSortInfo && (this._tableSortInfo = e.tableSortInfo);
  }
  dispose() {
    this._tableColumnFilterList = [];
  }
};
var xe = class {
  constructor(e, n, s, r, a = {}) {
    b(this, "_id");
    b(this, "_name");
    b(this, "_tableStyleId");
    b(this, "_showHeader");
    b(this, "_showFooter");
    b(this, "_range");
    b(this, "_columns", /* @__PURE__ */ new Map());
    b(this, "_columnOrder", []);
    b(this, "tableMeta");
    b(this, "_tableFilters");
    b(this, "_subUnitId");
    this._id = e, this._range = s, this._name = n, this._tableFilters = new De(), this._init(r, a);
  }
  _init(e, n) {
    var o, u;
    this._tableStyleId = n == null ? void 0 : n.tableStyleId, this._showHeader = (o = n == null ? void 0 : n.showHeader) != null ? o : true, this._showFooter = false;
    const s = this.getRange(), r = s.startColumn, a = s.endColumn;
    for (let l3 = r; l3 <= a; l3++) {
      const i = l3 - r;
      let h, d;
      (u = n.columns) != null && u[i] ? (h = n.columns[i].id, d = n.columns[i].displayName) : (h = et(), d = e[l3 - r]);
      const c = new j(h, d);
      this._columns.set(h, c), this._columnOrder.push(h);
    }
    n.filters && n.filters.forEach((i, h) => {
      i && this._tableFilters.setColumnFilter(h, i);
    });
  }
  setTableFilterColumn(e, n) {
    this._tableFilters.setColumnFilter(e, n);
  }
  getTableFilterColumn(e) {
    return this._tableFilters.getColumnFilter(e);
  }
  getTableFilters() {
    return this._tableFilters;
  }
  getTableFilterRange() {
    const e = this.getRange(), n = this.isShowHeader(), s = this.isShowFooter(), { startRow: r, startColumn: a, endRow: o, endColumn: u } = e, l3 = n ? r + 1 : r, i = s ? o - 1 : o;
    return {
      startRow: l3,
      startColumn: a,
      endRow: i,
      endColumn: u
    };
  }
  setColumns(e) {
    this._columns.clear(), this._columnOrder = [], e.forEach((n) => {
      const s = new j(n.id, n.displayName);
      s.fromJSON(n), this._columns.set(n.id, s), this._columnOrder.push(n.id);
    });
  }
  getColumnsCount() {
    return this._columnOrder.length;
  }
  insertColumn(e, n) {
    const s = n.id;
    this._columns.set(s, n), this._columnOrder.splice(e, 0, s);
  }
  removeColumn(e) {
    const n = this._columnOrder[e];
    this._columns.delete(n), this._columnOrder.splice(e, 1);
  }
  setTableMeta(e) {
    this.tableMeta = e;
  }
  getTableMeta() {
    return this.tableMeta;
  }
  getColumn(e) {
    return this._columns.get(e);
  }
  getTableColumnByIndex(e) {
    const n = this._columnOrder[e];
    return this.getColumn(n);
  }
  getColumnNameByIndex(e) {
    var s;
    const n = this._columnOrder[e];
    return ((s = this.getColumn(n)) == null ? void 0 : s.getDisplayName()) || "";
  }
  getId() {
    return this._id;
  }
  getRangeInfo() {
    return {
      ...this._range
    };
  }
  getRange() {
    return { ...this._range };
  }
  setRange(e) {
    this._range = e;
  }
  setDisplayName(e) {
    this._name = e;
  }
  getDisplayName() {
    return this._name;
  }
  getSubunitId() {
    return this._subUnitId;
  }
  setSubunitId(e) {
    this._subUnitId = e;
  }
  getTableStyleId() {
    var e;
    return (e = this._tableStyleId) != null ? e : je[0].name;
  }
  setTableStyleId(e) {
    this._tableStyleId = e;
  }
  isShowHeader() {
    var e;
    return (e = this._showHeader) != null ? e : true;
  }
  setShowHeader(e) {
    this._showHeader = e;
  }
  isShowFooter() {
    var e;
    return (e = this._showFooter) != null ? e : false;
  }
  getTableInfo() {
    return {
      id: this._id,
      subUnitId: this._subUnitId,
      name: this._name,
      range: this.getRangeInfo(),
      meta: this.tableMeta,
      showHeader: this._showHeader,
      columns: this._columnOrder.map((e) => this._columns.get(e).toJSON())
    };
  }
  getTableConfig() {
    return {
      name: this.getDisplayName(),
      range: this.getRangeInfo(),
      options: {
        showHeader: this._showHeader,
        showFooter: this._showFooter
      },
      tableStyleId: this._tableStyleId
    };
  }
  getFilterStates(e) {
    return this._tableFilters.getFilterStates(e);
  }
  toJSON() {
    const e = [];
    return this._columns.forEach((n) => {
      e.push(n.toJSON());
    }), {
      id: this._id,
      name: this._name,
      range: this.getRangeInfo(),
      options: {
        showHeader: this._showHeader,
        showFooter: this._showFooter,
        tableStyleId: this._tableStyleId
      },
      // TODO: support filter
      filters: this._tableFilters.toJSON(),
      columns: e,
      meta: this.tableMeta
    };
  }
  fromJSON(e) {
    var s, r;
    this._id = e.id, this._name = e.name, this._range = e.range, this.tableMeta = e.meta, this._tableStyleId = e.options.tableStyleId || "", this._showHeader = (s = e.options.showHeader) != null ? s : true, this._showFooter = (r = e.options.showFooter) != null ? r : true, e.columns.forEach((a) => {
      const o = new j(a.id, a.displayName);
      o.fromJSON(a), this._columns.set(a.id, o), this._columnOrder.push(a.id);
    }), this._tableFilters = new De(), this._tableFilters.fromJSON(e.filters);
  }
  dispose() {
    this._id = "", this._name = "", this._tableStyleId = "", this._showHeader = true, this._showFooter = true, delete this._range, this._columns.clear(), this._columnOrder = [];
  }
};
var Mn = Object.getOwnPropertyDescriptor;
var vn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? Mn(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var Oe = (t, e) => (n, s) => e(n, s, t);
var T = class extends Ve {
  constructor(e, n) {
    super();
    b(this, "_tableMap");
    b(this, "_tableAdd$", new Subject());
    b(this, "tableAdd$", this._tableAdd$.asObservable());
    b(this, "_tableDelete$", new Subject());
    b(this, "tableDelete$", this._tableDelete$.asObservable());
    b(this, "_tableNameChanged$", new Subject());
    b(this, "tableNameChanged$", this._tableNameChanged$.asObservable());
    b(this, "_tableRangeChanged$", new Subject());
    b(this, "tableRangeChanged$", this._tableRangeChanged$.asObservable());
    b(this, "_tableThemeChanged$", new Subject());
    b(this, "tableThemeChanged$", this._tableThemeChanged$.asObservable());
    b(this, "_tableFilterChanged$", new Subject());
    b(this, "tableFilterChanged$", this._tableFilterChanged$.asObservable());
    b(this, "_tableInitStatus", new BehaviorSubject(false));
    b(this, "tableInitStatus$", this._tableInitStatus.asObservable());
    this._univerInstanceService = e, this._localeService = n, this._tableMap = /* @__PURE__ */ new Map();
  }
  _ensureUnit(e) {
    return this._tableMap.has(e) || this._tableMap.set(e, /* @__PURE__ */ new Map()), this._tableMap.get(e);
  }
  getColumnHeader(e, n, s, r) {
    var d;
    const a = (d = this._univerInstanceService.getUnit(e)) == null ? void 0 : d.getSheetBySheetId(n), { startRow: o, startColumn: u, endColumn: l3 } = s, i = [], h = r != null ? r : "Column";
    for (let c = u; c <= l3; c++)
      i.push(Ge(a == null ? void 0 : a.getCell(o, c)) || te(c - u + 1, h));
    return i;
  }
  /**
   * Add a table to univer.
   * @param {string} unitId The unit id of the table.
   * @param {string} subUnitId The subunit id of the table.
   * @param {string} name The table name, it should be unique in the unit or it will be appended with a number.
   * @param {ITableRange} range The range of the table, it contains the unit id and subunit id.
   * @param {string[]} [header] The header of the table, if not provided, it will be generated based on the range.
   * @param {string} [initId] The initial id of the table, if not provided, a random id will be generated.
   * @param {ITableOptions} [options] Other options of the table.
   * @returns {string} The table id.
   */
  addTable(e, n, s, r, a, o, u) {
    var c;
    const l3 = o != null ? o : et(), i = a || this.getColumnHeader(e, n, r), h = new xe(l3, s, r, i, u);
    if (h.setSubunitId(n), this._ensureUnit(e).set(l3, h), this._tableAdd$.next({
      unitId: e,
      subUnitId: n,
      range: r,
      tableName: s,
      tableId: l3,
      tableStyleId: u == null ? void 0 : u.tableStyleId
    }), u != null && u.filters) {
      const g = (c = this._univerInstanceService.getUnit(e)) == null ? void 0 : c.getSheetBySheetId(n);
      h.getTableFilters().doFilter(g, r), this._tableFilterChanged$.next({
        unitId: e,
        subUnitId: n,
        tableId: l3
      });
    }
    return l3;
  }
  addFilter(e, n, s, r) {
    const a = this.getTable(e, n);
    if (a) {
      a.getTableFilters().setColumnFilter(s, r);
      const u = a.getSubunitId();
      this._tableFilterChanged$.next({
        unitId: e,
        subUnitId: u,
        tableId: n
      });
    }
  }
  getFilterRanges(e, n) {
    const s = this._tableMap.get(e);
    if (!s)
      return [];
    const r = [];
    return s.forEach((a) => {
      a.getSubunitId() === n && a.isShowHeader() && r.push(a.getRange());
    }), r;
  }
  getSheetFilterRangeWithState(e, n) {
    const s = this._tableMap.get(e);
    if (!s)
      return [];
    const r = [];
    return s.forEach((a) => {
      a.getSubunitId() === n && a.isShowHeader() && r.push({
        tableId: a.getId(),
        range: a.getRange(),
        states: a.getFilterStates(a.getRange())
      });
    }), r;
  }
  getTable(e, n) {
    const s = this._tableMap.get(e);
    if (s)
      return s.get(n);
  }
  /**
   * Get the unique table name, in excel, the table name should be unique because it is used as a reference.
   * @param {string} unitId The unit id of the table.
   * @param {string} baseName The base name of the table.
   * @returns {string} The unique table name
   */
  getUniqueTableName(e, n) {
    const s = this._tableMap.get(e);
    if (!s)
      return n;
    const r = new Set(Array.from(s.values()).map((u) => u.getDisplayName()));
    let a = n, o = 1;
    for (; r.has(a); )
      a = `${n}-${o}`, o++;
    return a;
  }
  /**
   * Get table by unit id and table id.
   * @param {string} unitId  The unit id of the table.
   * @param {string} tableId The table id.
   * @returns {Table} The table.
   */
  getTableById(e, n) {
    return this.getTable(e, n);
  }
  getTableList(e) {
    const n = this._tableMap.get(e);
    return n ? Array.from(n.values()).map((s) => ({ ...s.getTableInfo(), unitId: e })) : [];
  }
  /**
   * Get the table list by unit id and subunit id.
   * @param {string} unitId The unit id of the table.
   * @param {string} subUnitId The subunit id of the table.
   * @returns {Table[]} The table list.
   */
  getTablesBySubunitId(e, n) {
    const s = this._tableMap.get(e);
    return s ? Array.from(s.values()).filter((r) => r.getSubunitId() === n) : [];
  }
  getTablesInfoBySubunitId(e, n) {
    return this.getTablesBySubunitId(e, n).map((s) => ({
      id: s.getId(),
      name: s.getDisplayName(),
      range: s.getRange()
    }));
  }
  deleteTable(e, n) {
    const s = this._tableMap.get(e), r = s == null ? void 0 : s.get(n);
    if (r) {
      const a = r.getTableInfo(), o = r.getTableStyleId();
      s == null || s.delete(n);
      const { subUnitId: u, range: l3, name: i } = a;
      this._tableDelete$.next({
        unitId: e,
        subUnitId: u,
        tableId: n,
        range: l3,
        tableName: i,
        tableStyleId: o
      });
    }
  }
  operationTableRowCol(e, n, s) {
    const r = this.getTableById(e, n);
    if (!r) return;
    const { operationType: a, rowColType: o, index: u, count: l3, columnsJson: i } = s, h = r.getRange(), d = { ...h };
    if (a === M2.Insert) {
      if (o === "row")
        d.endRow += l3;
      else if (o === "column") {
        d.endColumn += l3;
        for (let c = 0; c < l3; c++) {
          const g = this._localeService.t("sheets-table.columnPrefix"), C2 = new j(et(), te(r.getColumnsCount() + 1 + c, g));
          i != null && i[c] && C2.fromJSON(i[c]);
          const w = u + c - h.startColumn;
          r.insertColumn(w, C2);
        }
      }
    } else if (o === "row")
      d.endRow -= l3;
    else if (o === "column") {
      d.endColumn -= l3;
      for (let c = l3 - 1; c >= 0; c--) {
        const g = u + c - h.startColumn;
        r.removeColumn(g);
      }
    }
    r.setRange(d), this._tableRangeChanged$.next({
      unitId: e,
      subUnitId: r.getSubunitId(),
      tableId: n,
      range: d,
      oldRange: h
    });
  }
  updateTableRange(e, n, s) {
    const r = this.getTableById(e, n);
    if (!r) return;
    const a = r.getRange(), o = s.newRange;
    if (o.startColumn < a.startColumn) {
      const u = a.startColumn - o.startColumn, l3 = this._localeService.t("sheets-table.columnPrefix");
      for (let i = 0; i < u; i++)
        r.insertColumn(a.startColumn, new j(et(), te(r.getColumnsCount() + 1, l3)));
    } else if (o.startColumn > a.startColumn) {
      const u = o.startColumn - a.startColumn;
      for (let l3 = u - 1; l3 >= 0; l3--) {
        const i = o.startColumn + l3 - a.startColumn;
        r.removeColumn(i);
      }
    }
    if (o.endColumn < a.endColumn) {
      const u = a.endColumn - o.endColumn;
      for (let l3 = u - 1; l3 >= 0; l3--) {
        const i = o.endColumn + l3 - a.startColumn;
        r.removeColumn(i);
      }
    } else if (o.endColumn > a.endColumn) {
      const u = o.endColumn - a.endColumn;
      for (let l3 = 0; l3 < u; l3++)
        r.insertColumn(a.endColumn, new j(et(), te(r.getColumnsCount() + 1, "Column")));
    }
    r.setRange(o), this._tableRangeChanged$.next({
      unitId: e,
      subUnitId: r.getSubunitId(),
      tableId: n,
      range: o,
      oldRange: a
    });
  }
  setTableByConfig(e, n, s) {
    var c;
    const r = this._tableMap.get(e), a = r == null ? void 0 : r.get(n);
    if (!a) return;
    const o = a.getSubunitId(), { name: u, updateRange: l3, rowColOperation: i, theme: h, options: d } = s;
    if (u) {
      const g = a.getDisplayName();
      a.setDisplayName(u), this._tableNameChanged$.next({
        unitId: e,
        subUnitId: o,
        tableId: n,
        tableName: u,
        oldTableName: g
      });
    }
    if (i && this.operationTableRowCol(e, n, i), l3 && this.updateTableRange(e, n, l3), h) {
      const g = (c = a.getTableStyleId()) != null ? c : "default";
      a.setTableStyleId(h), this._tableThemeChanged$.next({
        unitId: e,
        subUnitId: o,
        tableId: n,
        theme: h,
        oldTheme: g
      });
    }
    d && d.showHeader !== void 0 && a.setShowHeader(d.showHeader);
  }
  toJSON(e) {
    const n = {}, s = this._tableMap.get(e);
    return s && s.forEach((r) => {
      const a = r.getSubunitId();
      if (!n[a]) {
        const o = /* @__PURE__ */ new Set();
        this.getTablesBySubunitId(e, a).forEach((l3) => {
          const i = l3.getTableFilters().getFilterOutRows();
          if (i)
            for (const h of i)
              o.add(h);
        }), n[a] = {
          tables: [],
          tableFilteredOutRows: Array.from(o)
        };
      }
      n[a].tables.push(r.toJSON());
    }), n;
  }
  fromJSON(e, n) {
    const s = this._ensureUnit(e);
    Object.keys(n).forEach((a) => {
      const o = P(this._univerInstanceService, { unitId: e, subUnitId: a });
      if (!o)
        return;
      const u = o.worksheet;
      let l3;
      n[a].tables ? l3 = n[a].tables : Array.isArray(n[a]) && (l3 = n[a]), l3 && l3.forEach((i) => {
        const h = this.getColumnHeader(e, a, i.range), d = new xe(i.id, i.name, i.range, h, i.options);
        if (d.setTableMeta(i.meta), i.columns.length && d.setColumns(i.columns), i.filters) {
          const c = d.getTableFilters();
          c.fromJSON(i.filters), c.doFilter(u, d.getTableFilterRange());
        }
        d.setSubunitId(a), s.set(i.id, d), this._tableAdd$.next({
          unitId: e,
          subUnitId: a,
          range: i.range,
          tableName: i.name,
          tableId: i.id
        });
      });
    }), this._tableInitStatus.next(true);
  }
  deleteUnitId(e) {
    this._tableMap.delete(e);
  }
  dispose() {
    super.dispose(), this._tableMap.forEach((e) => {
      e.forEach((n) => n.dispose()), e.clear();
    }), this._tableMap.clear();
  }
};
T = vn([
  Oe(0, vr),
  Oe(1, Inject(Fn))
], T);
var Fn2 = Object.getOwnPropertyDescriptor;
var yn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? Fn2(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var Nn = (t, e) => (n, s) => e(n, s, t);
var X = class extends Ve {
  constructor(t) {
    super(), this._tableManager = t;
  }
  getTableInfo(t, e) {
    const n = this._tableManager.getTable(t, e);
    if (n)
      return {
        unitId: t,
        ...n.getTableInfo()
      };
  }
  getTableList(t) {
    return this._tableManager.getTableList(t);
  }
  addTable(t, e, n, s, r, a, o) {
    return this._tableManager.addTable(t, e, n, s, r, a, o);
  }
  deleteTable(t, e, n) {
    this._tableManager.deleteTable(t, n);
  }
  getTableMeta(t, e) {
    var n;
    return (n = this._tableManager.getTable(t, e)) == null ? void 0 : n.getTableMeta();
  }
  setTableMeta(t, e, n) {
    var s;
    (s = this._tableManager.getTable(t, e)) == null || s.setTableMeta(n);
  }
  getTableColumnMeta(t, e, n) {
    var s, r;
    return (r = (s = this._tableManager.getTable(t, e)) == null ? void 0 : s.getTableColumnByIndex(n)) == null ? void 0 : r.getMeta();
  }
  selTableColumnMeta(t, e, n, s) {
    var r, a;
    (a = (r = this._tableManager.getTable(t, e)) == null ? void 0 : r.getTableColumnByIndex(n)) == null || a.setMeta(s);
  }
  addFilter(t, e, n, s) {
    this._tableManager.addFilter(t, e, n, s);
  }
  getCellValueWithConditionType(t, e, n, s = O2.String) {
    return ue2(t, e, n, s);
  }
};
X = yn([
  Nn(0, Inject(T))
], X);
var J = {
  id: "sheet.mutation.add-table",
  type: Ms.MUTATION,
  handler: (t, e) => {
    const { tableId: n, unitId: s, subUnitId: r, name: a, range: o, header: u, options: l3 } = e;
    return t.get(X).addTable(s, r, a, o, u, n, l3), true;
  }
};
var k = {
  id: "sheet.mutation.delete-table",
  type: Ms.MUTATION,
  handler: (t, e) => {
    const { unitId: n, subUnitId: s, tableId: r } = e;
    return t.get(X).deleteTable(n, s, r), true;
  }
};
var Dn = {
  id: "sheet.command.add-table",
  type: Ms.COMMAND,
  handler: (t, e) => {
    var w;
    if (!e)
      return false;
    const n = t.get(Qo), s = t.get(Ls), r = t.get(Fn), a = (w = e.id) != null ? w : et();
    let o = e.name;
    if (!o) {
      const f = t.get(T).getTableList(e.unitId).length;
      o = `${r.t("sheets-table.tablePrefix")}${f + 1}`;
    }
    const u = [], l3 = [], i = t.get(T), { unitId: h, subUnitId: d, range: c } = e, g = i.getColumnHeader(h, d, c, r.t("sheets-table.columnPrefix"));
    return u.push({ id: J.id, params: { ...e, tableId: a, name: o, header: g } }), l3.push({ id: k.id, params: { tableId: a, unitId: e.unitId } }), fo(u, s) && n.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: l3,
      redoMutations: u
    }), true;
  }
};
var xn2 = {
  id: "sheet.command.delete-table",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const n = t.get(Qo), s = t.get(Ls), r = t.get(T), a = t.get(yt), o = [], u = [], l3 = r.getTable(e.unitId, e.tableId), i = l3 == null ? void 0 : l3.toJSON();
    return i ? (o.push({ id: k.id, params: { ...e } }), u.push({
      id: J.id,
      params: {
        unitId: e.unitId,
        subUnitId: e.subUnitId,
        tableId: e.tableId,
        name: i.name,
        range: i.range,
        options: i.options
      }
    }), fo(o, s) && n.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: u,
      redoMutations: o
    }), true) : (a.error("[TableManager]: Table not found"), false);
  }
};
var Ce = {
  id: "sheet.mutation.set-table-filter",
  type: Ms.MUTATION,
  handler: (t, e) => {
    const { tableId: n, unitId: s, column: r, tableFilter: a } = e;
    return t.get(T).addFilter(s, n, r, a), true;
  }
};
var On = {
  id: "sheet.command.set-table-filter",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const n = t.get(Qo), s = t.get(Ls), r = e.tableId || et(), a = [], o = [];
    return a.push({ id: Ce.id, params: { ...e, tableId: r } }), o.push({ id: Ce.id, params: { ...e, tableId: r, tableFilter: void 0 } }), fo(a, s) && n.pushUndoRedo({
      unitID: e.unitId,
      undoMutations: o,
      redoMutations: a
    }), true;
  }
};
var Ze = "SHEET_TABLE_PLUGIN";
var re = "SHEET_TABLE";
var Un = "table-custom";
var $n = Object.getOwnPropertyDescriptor;
var An = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? $n(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var ae = (t, e) => (n, s) => e(n, s, t);
var W = class extends Ve {
  constructor(e, n, s, r) {
    super();
    b(this, "_tableRangeRTree", /* @__PURE__ */ new Map());
    this._univerInstanceService = e, this._sheetInterceptorService = n, this._tableManager = s, this._resourceManagerService = r, this._initSnapshot(), this._initSheetChange(), this.registerTableChangeEvent(), this.registerTableHeaderInterceptor();
  }
  getContainerTableWithRange(e, n, s) {
    const r = this._ensureTableRangeRTree(e), o = Array.from(r.bulkSearch([{ unitId: e, sheetId: n, range: s }])).find((u) => {
      const l3 = this._tableManager.getTable(e, String(u));
      return l3 ? En.contains(l3.getRange(), s) : false;
    });
    if (o)
      return this._tableManager.getTable(e, String(o));
  }
  _ensureTableRangeRTree(e) {
    return this._tableRangeRTree.has(e) || this._tableRangeRTree.set(e, new QR()), this._tableRangeRTree.get(e);
  }
  registerTableChangeEvent() {
    this.disposeWithMe(
      this._tableManager.tableAdd$.subscribe((e) => {
        const { range: n, tableId: s, unitId: r, subUnitId: a } = e;
        this._ensureTableRangeRTree(r).insert({
          unitId: r,
          sheetId: a,
          id: s,
          range: { ...n }
        });
      })
    ), this.disposeWithMe(
      this._tableManager.tableRangeChanged$.subscribe((e) => {
        const { range: n, tableId: s, unitId: r, subUnitId: a, oldRange: o } = e, u = this._ensureTableRangeRTree(r);
        u.remove({
          unitId: r,
          sheetId: a,
          id: s,
          range: { ...o }
        }), u.insert({
          unitId: r,
          sheetId: a,
          id: s,
          range: { ...n }
        });
      })
    ), this.disposeWithMe(
      this._tableManager.tableDelete$.subscribe((e) => {
        const { tableId: n, unitId: s, subUnitId: r, range: a } = e;
        this._ensureTableRangeRTree(s).remove({
          unitId: s,
          sheetId: r,
          id: n,
          range: { ...a }
        });
      })
    );
  }
  registerTableHeaderInterceptor() {
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(ht.CELL_CONTENT, {
        effect: sr.Value,
        handler: (e, n, s) => {
          const { row: r, col: a, unitId: o, subUnitId: u } = n, l3 = this._ensureTableRangeRTree(o);
          if ((e == null ? void 0 : e.v) === void 0 && l3) {
            const h = Array.from(l3.bulkSearch([{ unitId: o, sheetId: u, range: { startColumn: a, endColumn: a, startRow: r, endRow: r } }]));
            if (h.length > 0) {
              const d = this._tableManager.getTable(o, h[0]);
              if (d) {
                const c = d.getRange(), g = a - c.startColumn;
                if (c.startRow === r) {
                  const w = d.getColumnNameByIndex(g);
                  return (!e || e === n.rawData) && (e = { ...n.rawData }), e.v = w, s(e);
                }
              }
            }
          }
          return s(e);
        }
      })
    );
  }
  _toJson(e) {
    return this._tableManager.toJSON(e);
  }
  _fromJSON(e, n) {
    return this._tableManager.fromJSON(e, n);
  }
  _deleteUnitId(e) {
    this._tableManager.deleteUnitId(e);
  }
  _initSnapshot() {
    this.disposeWithMe(this._resourceManagerService.registerPluginResource({
      toJson: (e) => JSON.stringify(this._toJson(e)),
      parseJson: (e) => {
        if (!e)
          return {};
        try {
          return JSON.parse(e);
        } catch {
          return {};
        }
      },
      businesses: [we.UNIVER_SHEET],
      pluginName: Ze,
      onLoad: (e, n) => {
        this._fromJSON(e, n);
      },
      onUnLoad: (e) => {
        this._deleteUnitId(e);
      }
    }));
  }
  // eslint-disable-next-line max-lines-per-function
  _initSheetChange() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        // eslint-disable-next-line max-lines-per-function
        getMutations: (e) => {
          var n;
          if (e.id === Xs.id) {
            const s = e.params, r = s.unitId || this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId(), a = s.subUnitId || ((n = this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : n.getSheetId());
            if (!r || !a)
              return { redos: [], undos: [] };
            const o = this._tableManager.getTablesBySubunitId(r, a);
            if (o.length === 0)
              return { redos: [], undos: [] };
            const u = [], l3 = [];
            return o.forEach((i) => {
              const h = i.toJSON();
              u.push({
                id: k.id,
                params: {
                  unitId: r,
                  subUnitId: a,
                  tableId: h.id
                }
              }), l3.push({
                id: J.id,
                params: {
                  unitId: r,
                  subUnitId: a,
                  name: h.name,
                  range: h.range,
                  tableId: h.id,
                  options: {
                    ...h.options,
                    columns: h.columns,
                    filters: h.filters.tableColumnFilterList
                  }
                }
              });
            }), { redos: u, undos: l3 };
          } else if (e.id === qr.id) {
            const s = e.params, { unitId: r, subUnitId: a, targetSubUnitId: o } = s;
            if (!r || !a || !o)
              return { redos: [], undos: [] };
            const u = this._tableManager.getTablesBySubunitId(r, a);
            if (u.length === 0)
              return { redos: [], undos: [] };
            const l3 = [], i = [];
            return u.forEach((h) => {
              const d = h.toJSON(), c = et();
              l3.push({
                id: J.id,
                params: {
                  unitId: r,
                  subUnitId: o,
                  name: d.name,
                  range: {
                    ...d.range,
                    sheetId: o
                  },
                  tableId: c,
                  options: {
                    ...d.options,
                    columns: d.columns,
                    filters: d.filters.tableColumnFilterList
                  }
                }
              }), i.push({
                id: k.id,
                params: {
                  unitId: r,
                  subUnitId: o,
                  tableId: c
                }
              });
            }), { redos: l3, undos: i };
          }
          return { redos: [], undos: [] };
        }
      })
    );
  }
  dispose() {
    super.dispose(), this._tableRangeRTree.clear();
  }
};
W = An([
  ae(0, Inject(vr)),
  ae(1, Inject(G)),
  ae(2, Inject(T)),
  ae(3, Inject(Jo))
], W);
var S2 = {
  id: "sheet.mutation.set-sheet-table",
  type: Ms.MUTATION,
  handler: (t, e) => {
    if (!e)
      return false;
    const { unitId: n, tableId: s, config: r } = e;
    return t.get(T).setTableByConfig(n, s, r), true;
  }
};
var En2 = {
  id: "sheet.command.add-table-theme",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const n = t.get(T), { unitId: s, tableId: r, themeStyle: a } = e, o = [], u = [], l3 = n.getTableById(s, r);
    if (!l3) return false;
    const i = l3.getSubunitId();
    o.push({
      id: dd.id,
      params: {
        unitId: s,
        subUnitId: i,
        styleJSON: a.toJson()
      }
    }), o.push({
      id: S2.id,
      params: {
        unitId: s,
        subUnitId: i,
        tableId: r,
        config: {
          theme: a.getName()
        }
      }
    }), u.push({
      id: S2.id,
      params: {
        unitId: s,
        subUnitId: i,
        tableId: r,
        config: {
          themeStyle: l3.getTableStyleId()
        }
      }
    }), u.push({
      id: fd.id,
      params: {
        unitId: s,
        subUnitId: i,
        styleName: a.getName()
      }
    });
    const h = t.get(Ls);
    return fo(o, h) && t.get(Qo).pushUndoRedo({
      unitID: s,
      undoMutations: u,
      redoMutations: o
    }), true;
  }
};
var Bn = {
  id: "sheet.command.remove-table-theme",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const { unitId: n, tableId: s, themeName: r } = e, a = t.get(T), o = t.get(ve), u = a.getTableById(n, s);
    if (!u) return false;
    const l3 = u.getSubunitId(), i = [], h = [], d = o.getRegisteredRangeThemes().filter((f) => f == null ? void 0 : f.startsWith("table-default"));
    let g = o.getRegisteredRangeThemes().filter((f) => f == null ? void 0 : f.startsWith(Un)).find((f) => f !== r);
    g || (g = d[0]), i.push({ id: S2.id, params: { unitId: n, subUnitId: l3, tableId: s, config: { theme: g } } }), i.push({ id: fd.id, params: { unitId: n, subUnitId: l3, styleName: r } });
    const C2 = o.getDefaultRangeThemeStyle(r);
    C2 && (h.push({ id: dd.id, params: { unitId: n, subUnitId: l3, styleJSON: C2.toJson() } }), h.push({ id: S2.id, params: { unitId: n, subUnitId: l3, tableId: s, config: { theme: r } } }));
    const w = t.get(Ls);
    return fo(i, w) && t.get(Qo).pushUndoRedo({
      unitID: n,
      redoMutations: i,
      undoMutations: h
    }), true;
  }
};
var Ln = {
  id: "sheet.command.set-table-config",
  type: Ms.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: (t, e) => {
    if (!e)
      return false;
    const { unitId: n, tableId: s, name: r, updateRange: a, rowColOperation: o, theme: u } = e, l3 = t.get(T), i = l3.getTableById(n, s);
    if (!i) return false;
    const h = {}, d = {}, c = t.get(Fn), C2 = t.get(vr).getCurrentUnitOfType(we.UNIVER_SHEET), w = /* @__PURE__ */ new Set();
    if (C2 && (C2.getSheets().forEach((_) => {
      w.add(_.getName());
    }), l3.getTableList(n).forEach((_) => {
      w.add(_.name);
    })), r) {
      if (!JR(r, w))
        return t.get(yt).warn(c.t("sheets-table.tableNameError")), false;
      h.name = i.getDisplayName(), d.name = r;
    }
    o && (h.rowColOperation = {
      operationType: o.operationType === M2.Insert ? M2.Delete : M2.Insert,
      rowColType: o.rowColType,
      index: o.index,
      count: o.count
    }, d.rowColOperation = o), a && (h.updateRange = {
      newRange: i.getRange()
    }, d.updateRange = a), u && (h.theme = i.getTableStyleId(), d.theme = u);
    const R = {
      unitId: n,
      subUnitId: i.getSubunitId(),
      tableId: s,
      config: d
    };
    return t.get(Ls).executeCommand(S2.id, R), t.get(Qo).pushUndoRedo({
      unitID: n,
      undoMutations: [
        {
          id: S2.id,
          params: {
            unitId: n,
            subUnitId: i.getSubunitId(),
            tableId: s,
            config: h
          }
        }
      ],
      redoMutations: [
        {
          id: S2.id,
          params: R
        }
      ]
    }), true;
  }
};
var Wn = {
  id: "sheet.command.table-insert-row",
  type: Ms.COMMAND,
  handler: (t) => {
    const e = t.get(vr), n = P(e);
    if (!n)
      return false;
    const { workbook: s, worksheet: r, unitId: a, subUnitId: o } = n, l3 = t.get(z).getCurrentSelections();
    if (!l3.length || l3.length > 1)
      return false;
    t.get(T);
    const h = l3[0].range, c = t.get(W).getContainerTableWithRange(a, o, h);
    if (!c) return false;
    const g = h.endRow - h.startRow + 1, w = r.getRowCount() - 1, R = r.getCellMatrix().getDataRange().endRow, f = [], I = [];
    if (w - R < g)
      f.push({
        id: Ue.id,
        params: {
          unitId: a,
          subUnitId: o,
          range: { ...h }
        }
      }), f.push({
        id: S2.id,
        params: {
          unitId: a,
          subUnitId: o,
          tableId: c.getId(),
          config: {
            updateRange: {
              newRange: {
                ...c.getRange(),
                endRow: c.getRange().endRow + g
              }
            }
          }
        }
      }), I.push({
        id: S2.id,
        params: {
          unitId: a,
          subUnitId: o,
          tableId: c.getId(),
          config: {
            updateRange: {
              newRange: c.getRange()
            }
          }
        }
      }), I.push({
        id: Te.id,
        params: {
          unitId: a,
          subUnitId: o,
          range: { ...h }
        }
      });
    else {
      const v = { ...c.getRange() };
      f.push({
        id: S2.id,
        params: {
          unitId: a,
          subUnitId: o,
          tableId: c.getId(),
          config: {
            updateRange: {
              newRange: {
                ...v,
                endRow: v.endRow + g
              }
            }
          }
        }
      }), I.push({
        id: S2.id,
        params: {
          unitId: a,
          subUnitId: o,
          tableId: c.getId(),
          config: {
            updateRange: {
              newRange: { ...v }
            }
          }
        }
      });
      const ee3 = Vs(
        t,
        {
          unitId: a,
          subUnitId: o,
          range: {
            startRow: h.startRow,
            endRow: R,
            startColumn: v.startColumn,
            endColumn: v.endColumn
          }
        },
        {
          unitId: a,
          subUnitId: o,
          range: {
            startRow: h.startRow + g,
            endRow: R + g,
            startColumn: v.startColumn,
            endColumn: v.endColumn
          }
        }
      );
      ee3 && (f.push(...ee3.redos), I.push(...ee3.undos));
    }
    const U2 = t.get(Ls);
    return fo(f, U2) && t.get(Qo).pushUndoRedo({
      unitID: a,
      undoMutations: I,
      redoMutations: f
    }), true;
  }
};
var Hn = {
  id: "sheet.command.table-insert-col",
  type: Ms.COMMAND,
  handler: (t) => {
    const e = t.get(vr), n = P(e);
    if (!n)
      return false;
    const { worksheet: s, unitId: r, subUnitId: a } = n, u = t.get(z).getCurrentSelections();
    if (!u.length || u.length > 1)
      return false;
    const i = u[0].range, d = t.get(W).getContainerTableWithRange(r, a, i);
    if (!d) return false;
    const c = i.endColumn - i.startColumn + 1, C2 = s.getColumnCount() - 1, w = s.getCellMatrix().getDataRange().endColumn, R = [], f = [];
    if (C2 - w < c)
      R.push({
        id: ke.id,
        params: {
          unitId: r,
          subUnitId: a,
          range: { ...i }
        }
      }), R.push({
        id: S2.id,
        params: {
          unitId: r,
          subUnitId: a,
          tableId: d.getId(),
          config: {
            rowColOperation: {
              operationType: M2.Insert,
              rowColType: y.Col,
              index: i.startColumn,
              count: c
            }
          }
        }
      }), f.push({
        id: S2.id,
        params: {
          unitId: r,
          subUnitId: a,
          tableId: d.getId(),
          config: {
            rowColOperation: {
              operationType: M2.Delete,
              rowColType: y.Col,
              index: i.startColumn,
              count: c
            }
          }
        }
      }), f.push({
        id: Me.id,
        params: {
          unitId: r,
          subUnitId: a,
          range: { ...i }
        }
      });
    else {
      const _ = d.getRange();
      R.push({
        id: S2.id,
        params: {
          unitId: r,
          subUnitId: a,
          tableId: d.getId(),
          config: {
            rowColOperation: {
              operationType: M2.Insert,
              rowColType: y.Col,
              index: i.startColumn,
              count: c
            }
          }
        }
      }), f.push({
        id: S2.id,
        params: {
          unitId: r,
          subUnitId: a,
          tableId: d.getId(),
          config: {
            rowColOperation: {
              operationType: M2.Delete,
              rowColType: y.Col,
              index: i.startColumn,
              count: c
            }
          }
        }
      });
      const v = Vs(
        t,
        {
          unitId: r,
          subUnitId: a,
          range: {
            startRow: _.startRow,
            endRow: _.endRow,
            startColumn: i.startColumn,
            endColumn: w
          }
        },
        {
          unitId: r,
          subUnitId: a,
          range: {
            startRow: _.startRow,
            endRow: _.endRow,
            startColumn: i.startColumn + c,
            endColumn: w + c
          }
        }
      );
      v && (R.push(...v.redos), f.push(...v.undos));
    }
    const I = t.get(Ls);
    return fo(R, I) && t.get(Qo).pushUndoRedo({
      unitID: r,
      undoMutations: f,
      redoMutations: R
    }), true;
  }
};
var Vn = {
  id: "sheet.command.table-remove-row",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const n = t.get(vr), s = P(n);
    if (!s)
      return false;
    const { unitId: r, subUnitId: a } = s, u = t.get(z).getCurrentSelections();
    if (!u.length || u.length > 1)
      return false;
    const i = u[0].range, d = t.get(W).getContainerTableWithRange(r, a, i);
    if (!d) return false;
    const c = i.endRow - i.startRow + 1, g = [], C2 = [], w = d.getRange();
    g.push({
      id: S2.id,
      params: {
        unitId: r,
        subUnitId: a,
        tableId: d.getId(),
        config: {
          updateRange: {
            newRange: {
              ...w,
              endRow: w.endRow - c
            }
          }
        }
      }
    }), C2.push({
      id: S2.id,
      params: {
        unitId: r,
        subUnitId: a,
        tableId: d.getId(),
        config: {
          updateRange: {
            newRange: { ...w }
          }
        }
      }
    });
    const f = s.worksheet.getCellMatrix().getDataRange().endRow, I = Vs(
      t,
      {
        unitId: r,
        subUnitId: a,
        range: {
          startRow: i.endRow + 1,
          endRow: f,
          startColumn: w.startColumn,
          endColumn: w.endColumn
        }
      },
      {
        unitId: r,
        subUnitId: a,
        range: {
          startRow: i.startRow,
          endRow: f - c,
          startColumn: w.startColumn,
          endColumn: w.endColumn
        }
      }
    );
    I && (g.push(...I.redos), C2.push(...I.undos));
    const U2 = t.get(Ls);
    return fo(g, U2) && t.get(Qo).pushUndoRedo({
      unitID: r,
      undoMutations: C2,
      redoMutations: g
    }), true;
  }
};
var Pn = {
  id: "sheet.command.table-remove-col",
  type: Ms.COMMAND,
  handler: (t, e) => {
    if (!e)
      return false;
    const n = t.get(vr), s = P(n);
    if (!s)
      return false;
    const { workbook: r, unitId: a, subUnitId: o } = s;
    t.get(T);
    const l3 = t.get(z).getCurrentSelections();
    if (!l3.length || l3.length > 1)
      return false;
    const h = l3[0].range, c = t.get(W).getContainerTableWithRange(a, o, h);
    if (!c) return false;
    const g = h.endColumn - h.startColumn + 1, C2 = [], w = [], R = c.getRange();
    C2.push({
      id: S2.id,
      params: {
        unitId: a,
        subUnitId: o,
        tableId: c.getId(),
        config: {
          rowColOperation: {
            operationType: M2.Delete,
            rowColType: y.Col,
            index: h.startColumn,
            count: g
          }
        }
      }
    });
    const f = [], I = h.startColumn - R.startColumn;
    for (let se = 0; se < g; se++) {
      const Te2 = c.getTableInfo().columns[I + se];
      Te2 && f.push(Te2);
    }
    w.push({
      id: S2.id,
      params: {
        unitId: a,
        subUnitId: o,
        tableId: c.getId(),
        config: {
          rowColOperation: {
            operationType: M2.Insert,
            rowColType: y.Col,
            index: h.startColumn,
            count: g,
            columnsJson: f
          }
        }
      }
    });
    const _ = s.worksheet.getCellMatrix().getDataRange().endColumn, v = Vs(
      t,
      {
        unitId: a,
        subUnitId: o,
        range: {
          startRow: R.startRow,
          endRow: R.endRow,
          startColumn: h.endColumn + 1,
          endColumn: _
        }
      },
      {
        unitId: a,
        subUnitId: o,
        range: {
          startRow: R.startRow,
          endRow: R.endRow,
          startColumn: h.startColumn,
          endColumn: _ - g
        }
      }
    );
    v && (C2.push(...v.redos), w.push(...v.undos));
    const ee3 = t.get(Ls);
    return fo(C2, ee3) && t.get(Qo).pushUndoRedo({
      unitID: a,
      undoMutations: w,
      redoMutations: C2
    }), true;
  }
};
var qn = Object.getOwnPropertyDescriptor;
var Jn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? qn(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var Ue2 = (t, e) => (n, s) => e(n, s, t);
var ce = class extends Ve {
  constructor(t, e) {
    super(), this._tableManager = t, this._exclusiveRangeService = e, this._initRangeListener();
  }
  _initRangeListener() {
    this.disposeWithMe(
      this._tableManager.tableRangeChanged$.subscribe((t) => {
        const { range: e, tableId: n, unitId: s, subUnitId: r } = t;
        this._exclusiveRangeService.clearExclusiveRangesByGroupId(s, r, re, n), this._exclusiveRangeService.addExclusiveRange(s, r, re, [{
          range: { ...e },
          groupId: n
        }]);
      })
    ), this.disposeWithMe(
      this._tableManager.tableAdd$.subscribe((t) => {
        const { tableId: e, unitId: n, subUnitId: s, range: r } = t;
        this._exclusiveRangeService.addExclusiveRange(n, s, re, [{
          range: { ...r },
          groupId: e
        }]);
      })
    ), this.disposeWithMe(
      this._tableManager.tableDelete$.subscribe((t) => {
        const { tableId: e, unitId: n, subUnitId: s } = t;
        this._exclusiveRangeService.clearExclusiveRangesByGroupId(n, s, re, e);
      })
    );
  }
};
ce = Jn([
  Ue2(0, Inject(T)),
  Ue2(1, Inject(Eo))
], ce);
var kn = Object.getOwnPropertyDescriptor;
var Qn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? kn(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var H = (t, e) => (n, s) => e(n, s, t);
var de = class extends Ve {
  constructor(t, e, n, s, r, a, o) {
    super(), this._commandService = t, this._refRangeService = e, this._univerInstanceService = n, this._injector = s, this._sheetInterceptorService = r, this._tableManager = a, this._localeService = o, this._initCommandInterceptor(), this._initCommandListener();
  }
  _initCommandInterceptor() {
    const t = this;
    this._sheetInterceptorService.interceptCommand({
      getMutations(e) {
        const n = { redos: [], undos: [] }, { id: s, params: r } = e;
        switch (s) {
          case Ye.id:
            return t._generateTableMutationWithInsertRow(r);
          case Xe.id:
            return t._generateTableMutationWithInsertCol(r);
          case cs.id:
            return t._generateTableMutationWithRemoveRow(r);
          case ds.id:
            return t._generateTableMutationWithRemoveCol(r);
        }
        return n;
      }
    });
  }
  _generateTableMutationWithInsertRow(t) {
    const e = [], n = [], s = P(this._univerInstanceService);
    if (!s)
      return { undos: e, redos: n };
    const { unitId: r, subUnitId: a } = s, o = this._tableManager.getTablesBySubunitId(r, a);
    if (!o.length)
      return { undos: e, redos: n };
    const { range: u } = t;
    return o.forEach((l3) => {
      const i = l3.getRange();
      if (u.startRow > i.startRow && u.startRow <= i.endRow) {
        const h = u.endRow - u.startRow + 1;
        n.push({
          id: S2.id,
          params: {
            unitId: r,
            subUnitId: a,
            tableId: l3.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...i,
                  endRow: i.endRow + h
                }
              }
            }
          }
        }), e.push({
          id: S2.id,
          params: {
            unitId: r,
            subUnitId: a,
            tableId: l3.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...i
                }
              }
            }
          }
        });
      }
    }), { undos: e, redos: n };
  }
  _generateTableMutationWithInsertCol(t) {
    const e = [], n = [], s = P(this._univerInstanceService);
    if (!s)
      return { undos: e, redos: n };
    const { unitId: r, subUnitId: a } = s, o = this._tableManager.getTablesBySubunitId(r, a);
    if (!o.length)
      return { undos: e, redos: n };
    const { range: u } = t;
    return o.forEach((l3) => {
      const i = l3.getRange();
      if (u.startColumn > i.startColumn && u.startColumn <= i.endColumn) {
        const h = u.endColumn - u.startColumn + 1;
        n.push({
          id: S2.id,
          params: {
            unitId: r,
            subUnitId: a,
            tableId: l3.getId(),
            config: {
              rowColOperation: {
                operationType: M2.Insert,
                rowColType: y.Col,
                index: u.startColumn,
                count: h
              }
            }
          }
        }), e.push({
          id: S2.id,
          params: {
            unitId: r,
            subUnitId: a,
            tableId: l3.getId(),
            config: {
              rowColOperation: {
                operationType: M2.Delete,
                rowColType: y.Col,
                index: u.startColumn,
                count: h
              }
            }
          }
        });
      }
    }), { undos: e, redos: n };
  }
  _generateTableMutationWithRemoveRow(t) {
    const e = [], n = [], s = [], r = [], a = P(this._univerInstanceService);
    if (!a)
      return { undos: e, redos: n, preRedos: s, preUndos: r };
    const { unitId: o, subUnitId: u } = a, l3 = this._tableManager.getTablesBySubunitId(o, u);
    if (!l3.length)
      return { undos: e, redos: n, preRedos: s, preUndos: r };
    const { range: i } = t, h = i.endRow - i.startRow + 1;
    return l3.forEach((d) => {
      const c = d.getRange();
      if (En.intersects(c, i))
        if (i.startRow <= c.startRow && i.endRow >= c.startRow) {
          s.push({
            id: k.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId()
            }
          });
          const g = d.toJSON();
          e.push({
            id: J.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: g.id,
              name: g.name,
              range: g.range,
              options: g.options
            }
          });
        } else i.startRow > c.startRow && i.startRow <= c.endRow ? (n.push({
          id: S2.id,
          params: {
            unitId: o,
            subUnitId: u,
            tableId: d.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...c,
                  endRow: c.endRow - h
                }
              }
            }
          }
        }), e.push({
          id: S2.id,
          params: {
            unitId: o,
            subUnitId: u,
            tableId: d.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...c
                }
              }
            }
          }
        })) : i.startRow < c.endRow && i.endRow >= c.endRow && (n.push({
          id: S2.id,
          params: {
            unitId: o,
            subUnitId: u,
            tableId: d.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...c,
                  endRow: i.startRow - 1
                }
              }
            }
          }
        }), e.push({
          id: S2.id,
          params: {
            unitId: o,
            subUnitId: u,
            tableId: d.getId(),
            config: {
              updateRange: {
                newRange: {
                  ...c
                }
              }
            }
          }
        }));
    }), { undos: e, redos: n, preRedos: s, preUndos: r };
  }
  _generateTableMutationWithRemoveCol(t) {
    const e = [], n = [], s = [], r = [], a = P(this._univerInstanceService);
    if (!a)
      return { undos: e, redos: n, preRedos: s, preUndos: r };
    const { unitId: o, subUnitId: u } = a, l3 = this._tableManager.getTablesBySubunitId(o, u);
    if (!l3.length)
      return { undos: e, redos: n, preRedos: s, preUndos: r };
    const { range: i } = t, h = i.endColumn - i.startColumn + 1;
    return l3.forEach((d) => {
      const c = d.getRange();
      if (En.intersects(c, i)) {
        if (i.startColumn <= c.startColumn && i.endColumn >= c.endColumn) {
          s.push({
            id: k.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId()
            }
          });
          const g = d.toJSON(), { startRow: C2, startColumn: w, endColumn: R } = g.range, f = this._univerInstanceService.getUnit(o), I = f == null ? void 0 : f.getSheetBySheetId(u);
          if (!I)
            return { undos: e, redos: n, preRedos: s, preUndos: r };
          const U2 = [];
          for (let _ = w; _ <= R; _++)
            U2.push(Ge(I == null ? void 0 : I.getCell(C2, _)) || te(_ - w + 1, this._localeService.t("sheets-table.columnPrefix")));
          e.push({
            id: J.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: g.id,
              name: g.name,
              header: U2,
              range: g.range,
              options: g.options
            }
          });
        } else if (i.startColumn <= c.startColumn && i.endColumn >= c.startColumn) {
          const g = i.endColumn - c.startColumn + 1;
          n.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Delete,
                  rowColType: y.Col,
                  index: c.startColumn,
                  count: g
                }
              }
            }
          });
          const C2 = [];
          for (let w = 0; w < g; w++) {
            const R = d.getTableColumnByIndex(w);
            R && C2.push(R.toJSON());
          }
          e.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Insert,
                  rowColType: y.Col,
                  index: c.startColumn,
                  count: g,
                  columnsJson: C2
                }
              }
            }
          });
        } else if (i.startColumn > c.startColumn && i.endColumn > c.endColumn) {
          const g = c.endColumn - i.startColumn + 1;
          n.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Delete,
                  rowColType: y.Col,
                  index: i.startColumn,
                  count: g
                }
              }
            }
          });
          const C2 = [], w = i.startColumn - c.startColumn;
          for (let R = 0; R < g; R++) {
            const f = d.getTableColumnByIndex(R + w);
            f && C2.push(f.toJSON());
          }
          e.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Insert,
                  rowColType: y.Col,
                  index: i.startColumn,
                  count: h,
                  columnsJson: C2
                }
              }
            }
          });
        } else if (i.startColumn > c.startColumn && i.endColumn <= c.endColumn) {
          n.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Delete,
                  rowColType: y.Col,
                  index: i.startColumn,
                  count: h
                }
              }
            }
          });
          const g = [], C2 = i.startColumn - c.startColumn;
          for (let w = 0; w < h; w++) {
            const R = d.getTableColumnByIndex(w + C2);
            R && g.push(R.toJSON());
          }
          e.push({
            id: S2.id,
            params: {
              unitId: o,
              subUnitId: u,
              tableId: d.getId(),
              config: {
                rowColOperation: {
                  operationType: M2.Insert,
                  rowColType: y.Col,
                  index: i.startColumn,
                  count: h,
                  columnsJson: g
                }
              }
            }
          });
        }
      }
    }), { undos: e, redos: n, preRedos: s, preUndos: r };
  }
  _initCommandListener() {
    this._commandService.onCommandExecuted((t) => {
      if (t.id === Ue.id) {
        const e = t.params, { unitId: n, subUnitId: s, range: r } = e, a = r.endRow - r.startRow + 1;
        this._tableManager.getTablesBySubunitId(n, s).forEach((u) => {
          const l3 = u.getRange();
          r.startRow <= l3.startRow && this._tableManager.updateTableRange(n, u.getId(), {
            newRange: {
              ...l3,
              startRow: l3.startRow + a,
              endRow: l3.endRow + a
            }
          });
        });
      } else if (t.id === ke.id) {
        const e = t.params, { unitId: n, subUnitId: s, range: r } = e, a = r.endColumn - r.startColumn + 1;
        this._tableManager.getTablesBySubunitId(n, s).forEach((u) => {
          const l3 = u.getRange();
          r.startColumn <= l3.startColumn && this._tableManager.updateTableRange(n, u.getId(), {
            newRange: {
              ...l3,
              startColumn: l3.startColumn + a,
              endColumn: l3.endColumn + a
            }
          });
        });
      } else if (t.id === Te.id) {
        const e = t.params, { unitId: n, subUnitId: s, range: r } = e, a = r.endRow - r.startRow + 1;
        this._tableManager.getTablesBySubunitId(n, s).forEach((u) => {
          const l3 = u.getRange();
          r.startRow < l3.startRow && this._tableManager.updateTableRange(n, u.getId(), {
            newRange: {
              ...l3,
              startRow: l3.startRow - a,
              endRow: l3.endRow - a
            }
          });
        });
      } else if (t.id === Me.id) {
        const e = t.params, { unitId: n, subUnitId: s, range: r } = e, a = r.endColumn - r.startColumn + 1;
        this._tableManager.getTablesBySubunitId(n, s).forEach((u) => {
          const l3 = u.getRange();
          r.startColumn < l3.startColumn && this._tableManager.updateTableRange(n, u.getId(), {
            newRange: {
              ...l3,
              startColumn: l3.startColumn - a,
              endColumn: l3.endColumn - a
            }
          });
        });
      }
    });
  }
};
de = Qn([
  H(0, Inject(Ls)),
  H(1, Inject(xt)),
  H(2, Inject(vr)),
  H(3, Inject(Injector)),
  H(4, Inject(G)),
  H(5, Inject(T)),
  H(6, Inject(Fn))
], de);
var Yn2 = Object.getOwnPropertyDescriptor;
var Gn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? Yn2(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var oe = (t, e) => (n, s) => e(n, s, t);
var he2 = class extends Ve {
  constructor(e, n, s, r) {
    super();
    b(this, "_defaultThemeIndex", 0);
    b(this, "_allThemes", []);
    this._tableManager = e, this._sheetRangeThemeService = n, this._sheetRangeThemeModel = s, this._configService = r, this._initUserTableTheme(), this.registerTableChangeEvent(), this._initDefaultTableTheme();
  }
  registerTableChangeEvent() {
    this.disposeWithMe(
      this._tableManager.tableAdd$.subscribe((e) => {
        const { range: n, tableId: s, unitId: r, subUnitId: a, tableStyleId: o } = e, u = this._tableManager.getTable(r, s), l3 = o || this._allThemes[this._defaultThemeIndex].name;
        u.setTableStyleId(l3), this._sheetRangeThemeService.registerRangeThemeStyle(l3, {
          unitId: r,
          subUnitId: a,
          range: { ...n }
        });
      })
    ), this.disposeWithMe(
      this._tableManager.tableRangeChanged$.subscribe((e) => {
        const { range: n, oldRange: s, tableId: r, unitId: a, subUnitId: o } = e, u = this._tableManager.getTable(a, r);
        let l3 = u.getTableStyleId();
        l3 || (l3 = this._allThemes[this._defaultThemeIndex].name, u.setTableStyleId(l3)), this._sheetRangeThemeService.removeRangeThemeRule(l3, {
          unitId: a,
          subUnitId: o,
          range: { ...s }
        }), this._sheetRangeThemeService.registerRangeThemeStyle(l3, {
          unitId: a,
          subUnitId: o,
          range: { ...n }
        });
      })
    ), this.disposeWithMe(
      this._tableManager.tableThemeChanged$.subscribe((e) => {
        const { theme: n, oldTheme: s, tableId: r, unitId: a, subUnitId: o } = e, l3 = this._tableManager.getTable(a, r).getRange();
        this._sheetRangeThemeService.removeRangeThemeRule(s, {
          unitId: a,
          subUnitId: o,
          range: { ...l3 }
        }), this._sheetRangeThemeService.registerRangeThemeStyle(n, {
          unitId: a,
          subUnitId: o,
          range: { ...l3 }
        });
      })
    ), this.disposeWithMe(
      this._tableManager.tableDelete$.subscribe((e) => {
        const { range: n, unitId: s, subUnitId: r, tableStyleId: a = this._allThemes[this._defaultThemeIndex].name } = e;
        this._sheetRangeThemeService.removeRangeThemeRule(a, {
          unitId: s,
          subUnitId: r,
          range: { ...n }
        });
      })
    );
  }
  _initUserTableTheme() {
    const e = this._configService.getConfig(ze) || {}, n = e.defaultThemeIndex || 0, s = e.userThemes || [];
    this._defaultThemeIndex = n, this._allThemes = s.concat(je);
  }
  _initDefaultTableTheme() {
    for (let e = 0; e < this._allThemes.length; e++) {
      const { name: n, style: s } = this._allThemes[e], r = new Ct(n, s);
      this._sheetRangeThemeModel.registerDefaultRangeTheme(r);
    }
  }
  dispose() {
    super.dispose(), this._allThemes = [], this._defaultThemeIndex = 0;
  }
};
he2 = Gn([
  oe(0, Inject(T)),
  oe(1, Inject(Ts)),
  oe(2, Inject(ve)),
  oe(3, ic)
], he2);
var zn = Object.getOwnPropertyDescriptor;
var jn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? zn(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var ie3 = (t, e) => (n, s) => e(n, s, t);
var ge = class extends Ve {
  constructor(e, n, s, r) {
    super();
    b(this, "_tableFilteredOutRows$", new BehaviorSubject(/* @__PURE__ */ new Set()));
    b(this, "tableFilteredOutRows$", this._tableFilteredOutRows$.asObservable());
    b(this, "_subscription", null);
    this._tableManager = e, this._sheetInterceptorService = n, this._univerInstanceService = s, this._zebraCrossingCacheController = r, this.registerFilterChangeEvent(), this.initTableHiddenRowIntercept(), this._initFilteredOutRows();
  }
  get tableFilteredOutRows() {
    return this._tableFilteredOutRows$.value;
  }
  set tableFilteredOutRows(e) {
    this._tableFilteredOutRows$.next(e);
  }
  initTableHiddenRowIntercept() {
    this.disposeWithMe(this._sheetInterceptorService.intercept(ht.ROW_FILTERED, {
      // sheetnext,interceptor
      priority: 100,
      handler: (e, n, s) => {
        if (e) return true;
        const r = this.tableFilteredOutRows.has(n.row);
        return r ? true : s(r);
      }
    }));
  }
  _initFilteredOutRows() {
    this._tableManager.tableInitStatus$.pipe(
      filter((e) => e),
      switchMap(() => this._univerInstanceService.getCurrentTypeOfUnit$(we.UNIVER_SHEET)),
      filter((e) => e != null),
      switchMap((e) => e.activeSheet$),
      filter((e) => e != null)
    ).subscribe(() => {
      const e = P(this._univerInstanceService);
      if (!e)
        return;
      const { unitId: n, subUnitId: s } = e;
      this.tableFilteredOutRows.clear(), this._tableManager.getTablesBySubunitId(n, s).forEach((a) => {
        const o = a.getTableFilters().getFilterOutRows();
        if (o)
          for (const u of o)
            this.tableFilteredOutRows.add(u);
      });
    });
  }
  registerFilterChangeEvent() {
    this.disposeWithMe(
      this._tableManager.tableFilterChanged$.subscribe((e) => {
        var i;
        const { unitId: n, subUnitId: s, tableId: r } = e, a = (i = this._univerInstanceService.getUnit(n)) == null ? void 0 : i.getSheetBySheetId(s), o = this._tableManager.getTable(n, r);
        if (!a || !o)
          return;
        this.tableFilteredOutRows.clear(), o.getTableFilters().doFilter(a, o.getTableFilterRange()), this._tableManager.getTablesBySubunitId(n, s).forEach((h) => {
          const d = h.getTableFilters().getFilterOutRows();
          if (d)
            for (const c of d)
              this.tableFilteredOutRows.add(c);
        }), this._zebraCrossingCacheController.updateZebraCrossingCache(n, s);
      })
    );
  }
  dispose() {
    var e;
    super.dispose(), (e = this._subscription) == null || e.unsubscribe();
  }
};
ge = jn([
  ie3(0, Inject(T)),
  ie3(1, Inject(G)),
  ie3(2, Inject(vr)),
  ie3(3, Inject(Yn))
], ge);
var Kn = Object.getOwnPropertyDescriptor;
var Xn = (t, e, n, s) => {
  for (var r = s > 1 ? void 0 : s ? Kn(e, n) : e, a = t.length - 1, o; a >= 0; a--)
    (o = t[a]) && (r = o(r) || r);
  return r;
};
var Re = (t, e) => (n, s) => e(n, s, t);
var le;
var $e = (le = class extends Ol {
  constructor(t = ye, e, n, s) {
    super(), this._config = t, this._injector = e, this._configService = n, this._commandService = s;
    const { ...r } = oo(
      {},
      ye,
      this._config
    );
    this._configService.setConfig(ze, r), this._initRegisterCommand();
  }
  onStarting() {
    GC(this._injector, [
      [T],
      [he2],
      [W],
      [X],
      [ge],
      [ce],
      [de]
    ]), zc(this._injector, [
      [ce],
      [de],
      [he2],
      [W],
      [X],
      [ge]
    ]);
  }
  onReady() {
    zc(this._injector, [
      [T]
    ]);
  }
  _initRegisterCommand() {
    [
      Dn,
      J,
      xn2,
      k,
      Ce,
      On,
      Ln,
      S2,
      En2,
      Bn,
      Wn,
      Hn,
      Vn,
      Pn
    ].forEach((t) => this._commandService.registerCommand(t));
  }
}, b(le, "pluginName", Ze), b(le, "type", we.UNIVER_SHEET), le);
$e = Xn([
  Re(1, Inject(Injector)),
  Re(2, ic),
  Re(3, Inject(Ls))
], $e);

// node_modules/@univerjs/sheets-table-ui/lib/es/index.js
var import_jsx_runtime = __toESM(require_jsx_runtime());
var import_react = __toESM(require_react());
var En3 = Object.defineProperty;
var $n2 = (r, e, t) => e in r ? En3(r, e, { enumerable: true, configurable: true, writable: true, value: t }) : r[e] = t;
var U = (r, e, t) => $n2(r, typeof e != "symbol" ? e + "" : e, t);
var Ar = "SHEET_TABLE_UI_PLUGIN";
var ge2 = "SHEETS_TABLE_FILTER_PANEL_OPENED_KEY";
var Ur = "UNIVER_SHEET_Table_FILTER_PANEL_ID";
var hn2 = "TABLE_TOOLBAR_BUTTON";
var xe2 = "TABLE_SELECTOR_DIALOG";
var Wr2 = "SHEET_TABLE_THEME_PANEL_ID";
var vn2 = "SHEET_TABLE_THEME_PANEL";
var bt2 = "table-custom-";
var Zr = "table-default-";
var ve3 = "rgb(255, 255, 255)";
var X2 = "none";
var Je = "1px solid rgb(var(--grey-200))";
function ae2({ ref: r, ...e }) {
  const { icon: t, id: n, className: i, extend: a, ...s } = e, c = `univerjs-icon univerjs-icon-${n} ${i || ""}`.trim(), u = (0, import_react.useRef)(`_${Yr()}`);
  return gn3(t, `${n}`, {
    defIds: t.defIds,
    idSuffix: u.current
  }, {
    ref: r,
    className: c,
    ...s
  }, a);
}
function gn3(r, e, t, n, i) {
  return (0, import_react.createElement)(r.tag, {
    key: e,
    ...jr(r, t, i),
    ...n
  }, (qr2(r, t).children || []).map((a, s) => gn3(a, `${e}-${r.tag}-${s}`, t, void 0, i)));
}
function jr(r, e, t) {
  const n = { ...r.attrs };
  t != null && t.colorChannel1 && n.fill === "colorChannel1" && (n.fill = t.colorChannel1), r.tag === "mask" && n.id && (n.id = n.id + e.idSuffix), Object.entries(n).forEach(([a, s]) => {
    a === "mask" && typeof s == "string" && (n[a] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  });
  const { defIds: i } = e;
  return !i || i.length === 0 || (r.tag === "use" && n["xlink:href"] && (n["xlink:href"] = n["xlink:href"] + e.idSuffix), Object.entries(n).forEach(([a, s]) => {
    typeof s == "string" && (n[a] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  })), n;
}
function qr2(r, e) {
  var n;
  const { defIds: t } = e;
  return !t || t.length === 0 ? r : r.tag === "defs" && ((n = r.children) != null && n.length) ? {
    ...r,
    children: r.children.map((i) => typeof i.attrs.id == "string" && t && t.includes(i.attrs.id) ? {
      ...i,
      attrs: {
        ...i.attrs,
        id: i.attrs.id + e.idSuffix
      }
    } : i)
  } : r;
}
function Yr() {
  return Math.random().toString(36).substring(2, 8);
}
ae2.displayName = "UniverIcon";
var Qr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M12.4208 14.4667C12.4208 14.798 12.1522 15.0667 11.8208 15.0667C11.4895 15.0667 11.2208 14.798 11.2208 14.4667V2.98193L9.97861 4.22417C9.7443 4.45848 9.3644 4.45848 9.13008 4.22417C8.89577 3.98985 8.89577 3.60995 9.13008 3.37564L11.3967 1.10897C11.6311 0.874657 12.011 0.874657 12.2453 1.10897L14.5119 3.37564C14.7463 3.60995 14.7463 3.98985 14.5119 4.22417C14.2776 4.45848 13.8977 4.45848 13.6634 4.22417L12.4208 2.9816V14.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.98967 10.2798C1.6583 10.2798 1.38967 10.0112 1.38967 9.67983C1.38967 9.34846 1.6583 9.07983 1.98967 9.07983H6.50138C6.74406 9.07983 6.96284 9.22602 7.05571 9.45022C7.14858 9.67443 7.09725 9.9325 6.92565 10.1041L3.43819 13.5916H6.50138C6.83276 13.5916 7.10138 13.8602 7.10138 14.1916C7.10138 14.5229 6.83276 14.7916 6.50138 14.7916H1.98967C1.74699 14.7916 1.52821 14.6454 1.43534 14.4212C1.34247 14.197 1.3938 13.9389 1.5654 13.7673L5.05286 10.2798H1.98967Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.1846 1.86439C4.8641 0.989866 3.62725 0.989866 3.30674 1.86439L1.34882 7.20672C1.23479 7.51786 1.39458 7.86252 1.70571 7.97655C2.01684 8.09058 2.3615 7.93079 2.47553 7.61966L3.06159 6.02055L3.06338 6.02056H5.42975L6.01581 7.61966C6.12984 7.93079 6.4745 8.09058 6.78563 7.97655C7.09677 7.86252 7.25655 7.51786 7.14252 7.20672L5.1846 1.86439ZM4.98996 4.82056L4.24567 2.78971L3.50138 4.82056H4.98996Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var bn2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "ascending-icon",
    ref: t,
    icon: Qr
  }));
});
bn2.displayName = "AscendingIcon";
var Gr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var mn2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "delete-icon",
    ref: t,
    icon: Gr
  }));
});
mn2.displayName = "DeleteIcon";
var Xr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M12.4208 1.53335C12.4208 1.20198 12.1522 0.93335 11.8208 0.93335C11.4895 0.93335 11.2208 1.20198 11.2208 1.53335V13.0181L9.97861 11.7758C9.7443 11.5415 9.3644 11.5415 9.13008 11.7758C8.89577 12.0101 8.89577 12.39 9.13008 12.6244L11.3967 14.891C11.6311 15.1253 12.011 15.1253 12.2453 14.891L14.5119 12.6244C14.7463 12.39 14.7463 12.0101 14.5119 11.7758C14.2776 11.5415 13.8977 11.5415 13.6634 11.7758L12.4208 13.0184V1.53335Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.98967 10.2798C1.6583 10.2798 1.38967 10.0112 1.38967 9.67983C1.38967 9.34846 1.6583 9.07983 1.98967 9.07983H6.50138C6.74406 9.07983 6.96284 9.22602 7.05571 9.45022C7.14858 9.67443 7.09725 9.9325 6.92565 10.1041L3.43819 13.5916H6.50138C6.83276 13.5916 7.10138 13.8602 7.10138 14.1916C7.10138 14.5229 6.83276 14.7916 6.50138 14.7916H1.98967C1.74699 14.7916 1.52821 14.6454 1.43534 14.4212C1.34247 14.197 1.3938 13.9389 1.5654 13.7673L5.05286 10.2798H1.98967Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.1846 1.86439C4.8641 0.989866 3.62725 0.989866 3.30674 1.86439L1.34882 7.20672C1.23479 7.51786 1.39458 7.86252 1.70571 7.97655C2.01684 8.09058 2.3615 7.93079 2.47553 7.61966L3.06159 6.02055L3.06338 6.02056H5.42975L6.01581 7.61966C6.12984 7.93079 6.4745 8.09058 6.78563 7.97655C7.09677 7.86252 7.25655 7.51786 7.14252 7.20672L5.1846 1.86439ZM4.98996 4.82056L4.24567 2.78971L3.50138 4.82056H4.98996Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
};
var pn2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "descending-icon",
    ref: t,
    icon: Xr
  }));
});
pn2.displayName = "DescendingIcon";
var zr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"
    }
  }]
};
var je2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "dropdown-icon",
    ref: t,
    icon: zr
  }));
});
je2.displayName = "DropdownIcon";
var Kr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M3.33333 3.33333V6H6V3.33333H3.33333ZM2 3.238C2 2.55427 2.55427 2 3.238 2H6.09533C6.77906 2 7.33333 2.55427 7.33333 3.238V6.09533C7.33333 6.77906 6.77906 7.33333 6.09533 7.33333H3.238C2.55427 7.33333 2 6.77906 2 6.09533V3.238ZM10 3.33333V6H12.6667V3.33333H10ZM8.66667 3.238C8.66667 2.55427 9.22094 2 9.90467 2H12.762C13.4457 2 14 2.55427 14 3.238V6.09533C14 6.77906 13.4457 7.33333 12.762 7.33333H9.90467C9.22094 7.33333 8.66667 6.77906 8.66667 6.09533V3.238ZM3.33333 10V12.6667H6V10H3.33333ZM2 9.90467C2 9.22094 2.55427 8.66667 3.238 8.66667H6.09533C6.77906 8.66667 7.33333 9.22094 7.33333 9.90467V12.762C7.33333 13.4457 6.77906 14 6.09533 14H3.238C2.55427 14 2 13.4457 2 12.762V9.90467ZM10 10V12.6667H12.6667V10H10ZM8.66667 9.90467C8.66667 9.22094 9.22094 8.66667 9.90467 8.66667H12.762C13.4457 8.66667 14 9.22094 14 9.90467V12.762C14 13.4457 13.4457 14 12.762 14H9.90467C9.22094 14 8.66667 13.4457 8.66667 12.762V9.90467Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var fn3 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "grid-outline-icon",
    ref: t,
    icon: Kr
  }));
});
fn3.displayName = "GridOutlineIcon";
var Jr = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Mt2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "more-down-icon",
    ref: t,
    icon: Jr
  }));
});
Mt2.displayName = "MoreDownIcon";
var ei = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M3.80068 2.57257L7.27955 2.57256C7.61092 2.57256 7.87954 2.30393 7.87954 1.97256C7.87954 1.64119 7.61091 1.37256 7.27954 1.37256L3.80068 1.37257C2.36473 1.37257 1.20067 2.53665 1.20068 3.97259L1.20074 12.3001C1.20075 13.736 2.36481 14.9 3.80074 14.9H12.1282C13.5641 14.9 14.7282 13.736 14.7282 12.3V8.82116C14.7282 8.48979 14.4595 8.22116 14.1282 8.22116C13.7968 8.22116 13.5282 8.48979 13.5282 8.82116V12.3C13.5282 13.0732 12.9014 13.7 12.1282 13.7H3.80074C3.02754 13.7 2.40074 13.0732 2.40074 12.3001L2.40068 3.97258C2.40068 3.19938 3.02748 2.57257 3.80068 2.57257Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.0072 2.0955C13.0997 1.18757 11.6278 1.18794 10.7207 2.09632L6.17749 6.646C6.10294 6.72065 6.04543 6.81056 6.00889 6.90954L4.59817 10.7315C4.51713 10.951 4.57116 11.1977 4.73657 11.3633C4.90198 11.5288 5.14858 11.5831 5.36823 11.5023L9.20237 10.0916C9.30186 10.055 9.3922 9.99722 9.46714 9.92224L14.0073 5.37972C14.9139 4.47266 14.9138 3.00252 14.0072 2.0955ZM11.5698 2.94424C12.0083 2.50513 12.7198 2.50496 13.1585 2.94384C13.5968 3.38229 13.5968 4.09294 13.1585 4.53141L8.69127 9.00102L6.1742 9.92713L7.09912 7.42132L11.5698 2.94424Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Cn2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "rename-icon",
    ref: t,
    icon: ei
  }));
});
Cn2.displayName = "RenameIcon";
var ti = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.7643 4.13354C1.7643 2.82523 2.82488 1.76465 4.13319 1.76465H11.8665C13.1748 1.76465 14.2354 2.82524 14.2354 4.13354V11.8669C14.2354 13.1752 13.1748 14.2358 11.8665 14.2358H4.13318C2.82488 14.2358 1.7643 13.1752 1.7643 11.8669V6.1462C1.76388 6.13711 1.76367 6.12797 1.76367 6.11878C1.76367 6.10959 1.76388 6.10045 1.7643 6.09136V4.13354ZM2.94652 6.70989V11.8669C2.94652 12.5222 3.47781 13.0535 4.13318 13.0535H5.52732V6.70989H2.94652ZM5.52732 5.52767H2.94652V4.13354C2.94652 3.47816 3.47781 2.94687 4.13319 2.94687H5.52732V5.52767ZM6.70954 6.70989V13.0535H11.8665C12.5219 13.0535 13.0532 12.5222 13.0532 11.8669V6.70989L6.70954 6.70989ZM13.0532 5.52767L6.70954 5.52767V2.94687H11.8665C12.5219 2.94687 13.0532 3.47816 13.0532 4.13354V5.52767Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
};
var Sn2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "table-icon",
    ref: t,
    icon: ti
  }));
});
Sn2.displayName = "TableIcon";
var ni = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"
      }
    }
  ]
};
var _n2 = (0, import_react.forwardRef)(function(e, t) {
  return (0, import_react.createElement)(ae2, Object.assign({}, e, {
    id: "paint-bucket-double-icon",
    ref: t,
    icon: ni
  }));
});
_n2.displayName = "PaintBucketDoubleIcon";
var me = ((r) => (r.Items = "items", r.Condition = "condition", r))(me || {});
var ri = Object.getOwnPropertyDescriptor;
var ii = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ri(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var We = (r, e) => (t, n) => e(t, n, r);
var Ee = class extends Ve {
  constructor(e, t, n, i, a) {
    super();
    U(this, "_itemsCache", /* @__PURE__ */ new Map());
    this._tableManager = e, this._sheetTableService = t, this._univerInstanceService = n, this._commandService = i, this._localeService = a, this._registerTableFilterChangeEvent();
  }
  _registerTableFilterChangeEvent() {
    this._commandService.onCommandExecuted((e) => {
      if (e.id === ee.id) {
        const { unitId: t, subUnitId: n, cellValue: i } = e.params, a = this._tableManager.getTablesBySubunitId(t, n);
        if (!a.length)
          return;
        new pt(i).forValue((c, u, h) => {
          const d = V1(c, u), v = a.find((f) => {
            const w = f.getTableFilterRange();
            return En.intersects(w, d);
          });
          if (v) {
            const f = u - v.getRange().startColumn;
            this._itemsCache.delete(v.getId() + f);
          }
        });
      } else if (e.id === On.id) {
        const { unitId: t, tableId: n } = e.params, i = this._tableManager.getTable(t, n);
        if (!i)
          return;
        const a = i.getSubunitId();
        this._tableManager.getTablesBySubunitId(t, a).forEach((c) => {
          const u = c.getRange();
          for (let h = u.startColumn; h <= u.endColumn; h++)
            this._itemsCache.delete(c.getId() + h);
        });
      }
    });
  }
  getTableFilterPanelInitProps(e, t, n, i) {
    const a = this._tableManager.getTable(e, n), s = a.getRange(), c = a.getTableFilterColumn(i - s.startColumn);
    return {
      unitId: e,
      subUnitId: t,
      tableFilter: c,
      currentFilterBy: Tt(c) ? me.Condition : me.Items,
      tableId: n,
      columnIndex: i - s.startColumn
    };
  }
  getTableFilterCheckedItems(e, t, n) {
    const i = this._tableManager.getTable(e, t), a = [];
    if (i) {
      const s = i.getTableFilterColumn(n);
      s && rs(s) && a.push(...s.values);
    }
    return a;
  }
  setTableFilter(e, t, n, i) {
    if (!this._tableManager.getTable(e, t))
      return;
    const s = {
      unitId: e,
      tableId: t,
      column: n,
      tableFilter: i
    };
    this._commandService.executeCommand(On.id, s);
  }
  getTableFilterItems(e, t, n, i) {
    var E;
    if (this._itemsCache.has(n + i))
      return this._itemsCache.get(n + i) || { data: [], itemsCountMap: /* @__PURE__ */ new Map(), allItemsCount: 0 };
    const a = this._tableManager.getTable(e, n);
    if (!a)
      return { data: [], itemsCountMap: /* @__PURE__ */ new Map(), allItemsCount: 0 };
    const s = a.getTableFilterRange(), { startRow: c, endRow: u, startColumn: h } = s, d = h + i, v = (E = this._univerInstanceService.getUnit(e)) == null ? void 0 : E.getSheetBySheetId(t);
    if (!v)
      return { data: [], itemsCountMap: /* @__PURE__ */ new Map(), allItemsCount: 0 };
    const f = [], w = /* @__PURE__ */ new Map();
    let S3 = 0;
    for (let C2 = c; C2 <= u; C2++) {
      if (v.isRowFiltered(C2))
        continue;
      let I = this._sheetTableService.getCellValueWithConditionType(v, C2, d);
      I === void 0 && (I = this._localeService.t("sheets-table.condition.empty")), w.has(I) || f.push({
        title: I,
        key: `${d}_${C2}`,
        leaf: true
      }), S3++, w.set(I, (w.get(I) || 0) + 1);
    }
    return this._itemsCache.set(n + i, { data: f, itemsCountMap: w, allItemsCount: S3 }), { data: f, itemsCountMap: w, allItemsCount: S3 };
  }
};
Ee = ii([
  We(0, Inject(T)),
  We(1, Inject(X)),
  We(2, Inject(vr)),
  We(3, Ls),
  We(4, Inject(Fn))
], Ee);
var j2 = ((r) => (r.DatePicker = "DatePicker", r.DateRange = "DateRange", r.Input = "Input", r.Inputs = "Inputs", r.Select = "Select", r.None = "None", r))(j2 || {});
function ai(r) {
  const t = r.get(Fn).t;
  return [
    {
      value: O2.String,
      label: t(`sheets-table.condition.${O2.String}`),
      children: [
        {
          value: V.Equal,
          label: t(`sheets-table.string.compare.${V.Equal}`)
        },
        {
          value: V.NotEqual,
          label: t(`sheets-table.string.compare.${V.NotEqual}`)
        },
        {
          value: V.Contains,
          label: t(`sheets-table.string.compare.${V.Contains}`)
        },
        {
          value: V.NotContains,
          label: t(`sheets-table.string.compare.${V.NotContains}`)
        },
        {
          value: V.StartsWith,
          label: t(`sheets-table.string.compare.${V.StartsWith}`)
        },
        {
          value: V.EndsWith,
          label: t(`sheets-table.string.compare.${V.EndsWith}`)
        }
      ]
    },
    {
      value: O2.Number,
      label: t(`sheets-table.condition.${O2.Number}`),
      children: [
        {
          value: F.Equal,
          label: t(`sheets-table.number.compare.${F.Equal}`)
        },
        {
          value: F.NotEqual,
          label: t(`sheets-table.number.compare.${F.NotEqual}`)
        },
        {
          value: F.GreaterThan,
          label: t(`sheets-table.number.compare.${F.GreaterThan}`)
        },
        {
          value: F.GreaterThanOrEqual,
          label: t(`sheets-table.number.compare.${F.GreaterThanOrEqual}`)
        },
        {
          value: F.LessThan,
          label: t(`sheets-table.number.compare.${F.LessThan}`)
        },
        {
          value: F.LessThanOrEqual,
          label: t(`sheets-table.number.compare.${F.LessThanOrEqual}`)
        },
        {
          value: F.Between,
          label: t(`sheets-table.number.compare.${F.Between}`)
        },
        {
          value: F.NotBetween,
          label: t(`sheets-table.number.compare.${F.NotBetween}`)
        },
        {
          value: F.Above,
          label: t(`sheets-table.number.compare.${F.Above}`)
        },
        {
          value: F.Below,
          label: t(`sheets-table.number.compare.${F.Below}`)
        }
        // {
        //     value: TableNumberCompareTypeEnum.TopN,
        //     label: t(`sheets-table.number.compare.${TableNumberCompareTypeEnum.TopN}`),
        // },
      ]
    },
    {
      value: O2.Date,
      label: t(`sheets-table.condition.${O2.Date}`),
      children: [
        {
          value: m2.Equal,
          label: t(`sheets-table.date.compare.${m2.Equal}`)
        },
        {
          value: m2.NotEqual,
          label: t(`sheets-table.date.compare.${m2.NotEqual}`)
        },
        {
          value: m2.After,
          label: t(`sheets-table.date.compare.${m2.After}`)
        },
        {
          value: m2.AfterOrEqual,
          label: t(`sheets-table.date.compare.${m2.AfterOrEqual}`)
        },
        {
          value: m2.Before,
          label: t(`sheets-table.date.compare.${m2.Before}`)
        },
        {
          value: m2.BeforeOrEqual,
          label: t(`sheets-table.date.compare.${m2.BeforeOrEqual}`)
        },
        {
          value: m2.Between,
          label: t(`sheets-table.date.compare.${m2.Between}`)
        },
        {
          value: m2.NotBetween,
          label: t(`sheets-table.date.compare.${m2.NotBetween}`)
        },
        {
          value: m2.Today,
          label: t(`sheets-table.date.compare.${m2.Today}`)
        },
        {
          value: m2.Yesterday,
          label: t(`sheets-table.date.compare.${m2.Yesterday}`)
        },
        {
          value: m2.Tomorrow,
          label: t(`sheets-table.date.compare.${m2.Tomorrow}`)
        },
        {
          value: m2.ThisWeek,
          label: t(`sheets-table.date.compare.${m2.ThisWeek}`)
        },
        {
          value: m2.LastWeek,
          label: t(`sheets-table.date.compare.${m2.LastWeek}`)
        },
        {
          value: m2.NextWeek,
          label: t(`sheets-table.date.compare.${m2.NextWeek}`)
        },
        {
          value: m2.ThisMonth,
          label: t(`sheets-table.date.compare.${m2.ThisMonth}`)
        },
        {
          value: m2.LastMonth,
          label: t(`sheets-table.date.compare.${m2.LastMonth}`)
        },
        {
          value: m2.NextMonth,
          label: t(`sheets-table.date.compare.${m2.NextMonth}`)
        },
        {
          value: m2.ThisYear,
          label: t(`sheets-table.date.compare.${m2.ThisYear}`)
        },
        {
          value: m2.LastYear,
          label: t(`sheets-table.date.compare.${m2.LastYear}`)
        },
        {
          value: m2.NextYear,
          label: t(`sheets-table.date.compare.${m2.NextYear}`)
        },
        {
          value: m2.Quarter,
          label: t(`sheets-table.date.compare.${m2.Quarter}`)
        },
        {
          value: m2.Month,
          label: t(`sheets-table.date.compare.${m2.Month}`)
        }
      ]
    }
  ];
}
function si(r, e) {
  if (!e)
    return [];
  const n = r.get(Fn).t;
  switch (e) {
    case m2.Quarter:
      return [
        {
          value: m2.Q1,
          label: n(`sheets-table.date.compare.${m2.Q1}`)
        },
        {
          value: m2.Q2,
          label: n(`sheets-table.date.compare.${m2.Q2}`)
        },
        {
          value: m2.Q3,
          label: n(`sheets-table.date.compare.${m2.Q3}`)
        },
        {
          value: m2.Q4,
          label: n(`sheets-table.date.compare.${m2.Q4}`)
        }
      ];
    case m2.Month:
      return [
        {
          value: m2.M1,
          label: n(`sheets-table.date.compare.${m2.M1}`)
        },
        {
          value: m2.M2,
          label: n(`sheets-table.date.compare.${m2.M2}`)
        },
        {
          value: m2.M3,
          label: n(`sheets-table.date.compare.${m2.M3}`)
        },
        {
          value: m2.M4,
          label: n(`sheets-table.date.compare.${m2.M4}`)
        },
        {
          value: m2.M5,
          label: n(`sheets-table.date.compare.${m2.M5}`)
        },
        {
          value: m2.M6,
          label: n(`sheets-table.date.compare.${m2.M6}`)
        },
        {
          value: m2.M7,
          label: n(`sheets-table.date.compare.${m2.M7}`)
        },
        {
          value: m2.M8,
          label: n(`sheets-table.date.compare.${m2.M8}`)
        },
        {
          value: m2.M9,
          label: n(`sheets-table.date.compare.${m2.M9}`)
        },
        {
          value: m2.M10,
          label: n(`sheets-table.date.compare.${m2.M10}`)
        },
        {
          value: m2.M11,
          label: n(`sheets-table.date.compare.${m2.M11}`)
        },
        {
          value: m2.M12,
          label: n(`sheets-table.date.compare.${m2.M12}`)
        }
      ];
    default:
      return [];
  }
}
var xt3 = /* @__PURE__ */ new Set([
  m2.Equal,
  m2.NotEqual,
  m2.After,
  m2.AfterOrEqual,
  m2.Before,
  m2.BeforeOrEqual
]);
function oi(r, e) {
  return e ? r === O2.String ? j2.Input : r === O2.Number ? e === F.Between || e === F.NotBetween ? j2.Inputs : j2.Input : r === O2.Date ? e === m2.Between || e === m2.NotBetween ? j2.DateRange : e === m2.Quarter || e === m2.Month ? j2.Select : xt3.has(e) ? j2.DatePicker : j2.None : j2.None : j2.None;
}
function li(r) {
  if (!r || r.filterType !== "condition")
    return {
      type: O2.String,
      compareType: V.Equal,
      info: {}
    };
  const e = r.filterInfo, { conditionType: t, compareType: n } = e;
  if (t === O2.Date)
    if (n === m2.Between || n === m2.NotBetween) {
      let i;
      return Array.isArray(e.expectedValue) && (i = e.expectedValue.map((a) => typeof a == "string" ? new Date(a) : a)), {
        type: t,
        compare: n,
        info: {
          dateRange: i
        }
      };
    } else {
      if (n === m2.Today || n === m2.Yesterday || n === m2.Tomorrow || n === m2.ThisWeek || n === m2.LastWeek || n === m2.NextWeek || n === m2.ThisMonth || n === m2.LastMonth || n === m2.NextMonth || n === m2.ThisYear || n === m2.LastYear || n === m2.NextYear)
        return {
          type: t,
          compare: n,
          info: {}
        };
      if (xt3.has(n)) {
        let i;
        if (typeof e.expectedValue == "string")
          i = new Date(e.expectedValue);
        else if (Array.isArray(e.expectedValue))
          for (let a = 0; a < e.expectedValue.length; a++)
            typeof e.expectedValue[a] == "string" && (e.expectedValue[a] = new Date(e.expectedValue[a]));
        return {
          type: t,
          compare: n,
          info: {
            date: i
          }
        };
      } else
        return (/* @__PURE__ */ new Set([m2.Q1, m2.Q2, m2.Q3, m2.Q4])).has(n) ? {
          type: t,
          compare: m2.Quarter,
          info: {
            dateSelect: e.compareType
          }
        } : {
          type: t,
          compare: m2.Month,
          info: {
            dateSelect: e.compareType
          }
        };
    }
  else {
    if (t === O2.Number)
      return n === F.Between || n === F.NotBetween ? {
        type: t,
        compare: n,
        info: {
          numberRange: e.expectedValue
        }
      } : {
        type: t,
        compare: n,
        info: {
          number: e.expectedValue
        }
      };
    if (t === O2.String)
      return {
        type: t,
        compare: n,
        info: {
          string: e.expectedValue
        }
      };
  }
  return {
    type: O2.String,
    compare: V.Equal,
    info: {}
  };
}
var ci = (r) => {
  var w, S3, E, C2, $, I, B, R;
  const { conditionInfo: e, onChange: t } = r, n = useDependency(Fn), [i, a] = (0, import_react.useState)(false), s = useDependency(Injector), c = ai(s), u = (g, x, y2) => {
    t({
      type: x != null ? x : e.type,
      compare: y2 != null ? y2 : e.compare,
      info: g
    });
  }, h = (g) => {
    var O3;
    const x = g[0], y2 = g[1];
    y2 && a(false);
    const m3 = {};
    x === O2.Date ? y2 === m2.Quarter ? m3.dateSelect = m2.Q1 : y2 === m2.Month ? m3.dateSelect = m2.M1 : xt3.has(y2) ? m3.date = /* @__PURE__ */ new Date() : m3.dateRange = [/* @__PURE__ */ new Date(), /* @__PURE__ */ new Date()] : x === O2.Number ? m3.number = 0 : x === O2.String && (m3.string = ""), u(m3, g[0], (O3 = g[1]) != null ? O3 : V.Equal);
  }, d = oi(e.type, e.compare);
  let v = "";
  e.compare ? v = `${n.t(`sheets-table.condition.${e.type}`)} - ${n.t(`sheets-table.${e.type}.compare.${e.compare}`)}` : v = n.t(`sheets-table.condition.${e.type}`);
  const f = si(s, e.compare);
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)(
      vf,
      {
        align: "start",
        open: i,
        onOpenChange: a,
        overlay: (0, import_jsx_runtime.jsx)(
          oE,
          {
            value: [e.type, e.compare],
            options: c,
            onChange: h,
            contentClassName: "univer-flex-1",
            wrapperClassName: "!univer-h-[150px]"
          }
        ),
        children: (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: ie("univer-box-border univer-flex univer-h-8 univer-w-full univer-items-center univer-justify-between univer-rounded-md univer-bg-white univer-px-2 univer-text-sm univer-transition-colors univer-duration-200 hover:univer-border-primary-600 focus:univer-border-primary-600 focus:univer-outline-none focus:univer-ring-2 dark:!univer-bg-gray-700 dark:!univer-text-white", kt),
            children: [
              (0, import_jsx_runtime.jsx)("span", { children: v }),
              (0, import_jsx_runtime.jsx)(Mt2, {})
            ]
          }
        )
      }
    ),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-3 univer-w-full", children: [
      d === j2.Input && (0, import_jsx_runtime.jsx)(import_jsx_runtime.Fragment, { children: e.type === O2.String ? (0, import_jsx_runtime.jsx)(
        Vx,
        {
          className: "univer-w-full",
          placeholder: "",
          value: e.info.string,
          onChange: (g) => u({ string: g })
        }
      ) : (0, import_jsx_runtime.jsx)(
        xE,
        {
          className: "univer-h-7 univer-w-full",
          value: e.info.number,
          controls: false,
          onChange: (g) => {
            g !== null && u({ number: g });
          }
        }
      ) }),
      d === j2.DatePicker && (0, import_jsx_runtime.jsx)("div", { id: "univer-table-date-picker-wrapper", children: (0, import_jsx_runtime.jsx)(
        lE,
        {
          className: "univer-w-full",
          value: (w = e.info.date) != null ? w : /* @__PURE__ */ new Date(),
          onValueChange: (g) => u({ date: g })
        }
      ) }),
      d === j2.DateRange && (0, import_jsx_runtime.jsx)("div", { id: "univer-table-date-range-wrapper", children: (0, import_jsx_runtime.jsx)(
        cE,
        {
          className: "univer-w-full",
          value: [(E = (S3 = e.info.dateRange) == null ? void 0 : S3[0]) != null ? E : /* @__PURE__ */ new Date(), ($ = (C2 = e.info.dateRange) == null ? void 0 : C2[1]) != null ? $ : /* @__PURE__ */ new Date()],
          onValueChange: (g) => {
            u(g ? { dateRange: g } : {});
          }
        }
      ) }),
      d === j2.Inputs && (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-items-center univer-gap-2", children: [
        (0, import_jsx_runtime.jsx)(
          xE,
          {
            className: "univer-w-full",
            value: (I = e.info.numberRange) == null ? void 0 : I[0],
            onChange: (g) => {
              var x;
              g !== null && u({ numberRange: [g, (x = e.info.numberRange) == null ? void 0 : x[1]] });
            },
            controls: false
          }
        ),
        (0, import_jsx_runtime.jsx)("span", { children: " - " }),
        (0, import_jsx_runtime.jsx)(
          xE,
          {
            className: "univer-w-full",
            value: (B = e.info.numberRange) == null ? void 0 : B[1],
            controls: false,
            onChange: (g) => {
              var x;
              g !== null && u({ numberRange: [(x = e.info.numberRange) == null ? void 0 : x[0], g] });
            }
          }
        )
      ] }),
      d === j2.Select && (0, import_jsx_runtime.jsx)(
        LE,
        {
          className: "univer-w-full",
          value: (R = e.info.dateSelect) != null ? R : f[0].value,
          options: f,
          onChange: (g) => u({ dateSelect: g })
        }
      )
    ] })
  ] });
};
var ui = (r) => {
  let e = 0;
  return r.forEach((t) => {
    e += t;
  }), e;
};
function di(r) {
  const { unitId: e, tableId: t, subUnitId: n, columnIndex: i, checkedItemSet: a, setCheckedItemSet: s, tableFilter: c } = r, u = useDependency(Fn), h = useDependency(Ee), { data: d, itemsCountMap: v, allItemsCount: f } = h.getTableFilterItems(e, n, t, i), [w, S3] = (0, import_react.useState)(c === void 0 ? true : a.size === v.size), [E, C2] = (0, import_react.useState)(w ? f : ui(v)), $ = !w && a.size > 0, [I, B] = (0, import_react.useState)(""), R = (0, import_react.useMemo)(() => I ? d.filter((m3) => String(m3.title).toLowerCase().includes(I.toLowerCase())) : d, [I, d]), g = (0, import_react.useCallback)(() => {
    w ? (a.clear(), s(new Set(a)), S3(false)) : (R.forEach((m3) => {
      a.add(m3.title);
    }), s(new Set(a)), S3(true));
  }, [w]), x = (0, import_react.useCallback)((m3) => {
    m3 === "" ? (S3(true), d.forEach((O3) => {
      a.add(O3.title);
    }), C2(f)) : (a.clear(), S3(false), C2(0)), B(m3);
  }, []), y2 = (m3) => {
    if (w) {
      S3(false);
      const O3 = /* @__PURE__ */ new Set();
      for (const { title: L } of d)
        m3 !== L && O3.add(L);
      C2(f - v.get(m3)), s(O3);
    } else
      a.has(m3) ? (a.delete(m3), C2(E - v.get(m3))) : (a.add(m3), C2(E + v.get(m3))), s(new Set(a));
  };
  return (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-full univer-flex-col", children: [
    (0, import_jsx_runtime.jsx)(Vx, { autoFocus: true, value: I, placeholder: u.t("sheets-table.filter.search-placeholder"), onChange: x }),
    (0, import_jsx_runtime.jsx)(
      "div",
      {
        className: ie("univer-mt-2 univer-box-border univer-flex univer-h-[180px] univer-max-h-[180px] univer-flex-grow univer-flex-col univer-overflow-hidden univer-rounded-md univer-py-1.5 univer-pl-2", kt),
        children: (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: ie("univer-h-40 univer-overflow-y-auto univer-py-1 univer-pl-2", pr),
            children: (0, import_jsx_runtime.jsxs)("div", { className: "univer-h-full", children: [
              (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-items-center univer-px-2 univer-py-1", children: (0, import_jsx_runtime.jsx)(
                em,
                {
                  indeterminate: $,
                  disabled: d.length === 0,
                  checked: w,
                  onChange: g,
                  children: (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-5 univer-flex-1 univer-items-center univer-text-sm", children: [
                    (0, import_jsx_runtime.jsx)("span", { className: "univer-inline-block univer-truncate", children: `${u.t("sheets-table.filter.select-all")}` }),
                    (0, import_jsx_runtime.jsx)("span", { className: "univer-ml univer-text-gray-400", children: `(${E}/${I ? R.length : f})` })
                  ] })
                }
              ) }),
              R.map((m3) => (0, import_jsx_runtime.jsx)(
                "div",
                {
                  className: "univer-flex univer-items-center univer-px-2 univer-py-1",
                  children: (0, import_jsx_runtime.jsx)(
                    em,
                    {
                      checked: w || a.has(m3.title),
                      onChange: () => {
                        y2(m3.title);
                      },
                      children: (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-5 univer-flex-1 univer-text-sm", children: [
                        (0, import_jsx_runtime.jsx)("span", { className: "univer-inline-block univer-truncate", children: m3.title }),
                        (0, import_jsx_runtime.jsx)("span", { className: "univer-ml-1 univer-text-gray-400", children: `(${v.get(m3.title) || 0})` })
                      ] })
                    }
                  )
                },
                m3.key
              ))
            ] })
          }
        )
      }
    )
  ] });
}
function hi() {
  var de2;
  const r = useDependency(Fn), e = vi(r), t = useDependency(Ee), n = useDependency(T), i = useDependency(Ls), a = useDependency(eC), s = useDependency($e2), c = s.getCurrentTableFilterInfo(), u = t.getTableFilterPanelInitProps(c.unitId, c.subUnitId, c.tableId, c.column), { unitId: h, subUnitId: d, tableId: v, tableFilter: f, currentFilterBy: w, columnIndex: S3 } = u, { data: E } = t.getTableFilterItems(h, d, v, S3), C2 = t.getTableFilterCheckedItems(h, v, S3), [$, I] = (0, import_react.useState)(new Set(C2)), [B, R] = (0, import_react.useState)(w || me.Items), [g, x] = (0, import_react.useState)(() => {
    const b2 = u.tableFilter;
    return li(b2);
  }), y2 = n.getTable(h, v);
  if (!y2) return null;
  const m3 = y2.getTableFilters(), O3 = m3.getSortState();
  O3.columnIndex === S3 && (O3.sortState, G2.Asc), O3.columnIndex === S3 && (O3.sortState, G2.Desc);
  const L = () => {
    s.closeFilterPanel();
  }, Y = () => {
    L();
  }, V3 = (b2) => {
    const P3 = y2.getTableFilterRange();
    i.executeCommand(M.id, {
      unitId: h,
      subUnitId: d,
      range: P3,
      orderRules: [{ colIndex: S3 + P3.startColumn, type: b2 ? m.ASC : m.DESC }],
      hasTitle: false
    }), m3.setSortState(S3, b2 ? G2.Asc : G2.Desc), L();
  }, G3 = () => {
    if (B === me.Items) {
      const b2 = [];
      for (const Q of E)
        $.has(Q.title) && b2.push(Q.title);
      const P3 = y2.getTableFilterColumn(S3);
      if (P3) {
        if (P3.values.join(",") === b2.join(",")) {
          L();
          return;
        }
      } else if (b2.length === 0) {
        L();
        return;
      }
      const A2 = {
        filterType: ne.manual,
        values: b2
      };
      t.setTableFilter(h, v, S3, A2);
    } else {
      let b2;
      g.compare === m2.Quarter || g.compare === m2.Month ? b2 = {
        conditionType: g.type,
        compareType: Object.values(g.info)[0]
      } : b2 = {
        conditionType: g.type,
        compareType: g.compare,
        expectedValue: Object.values(g.info)[0]
      };
      const P3 = {
        filterType: ne.condition,
        // @ts-ignore
        filterInfo: b2
      };
      t.setTableFilter(h, v, S3, P3);
    }
    L();
  }, ce2 = () => {
    t.setTableFilter(h, v, S3, void 0), L();
  }, ue3 = new Pe(h).id, fe2 = (de2 = a.getPermissionPoint(ue3)) == null ? void 0 : de2.value;
  return (0, import_jsx_runtime.jsxs)(
    "div",
    {
      className: "univer-box-border univer-flex univer-min-w-[312px] univer-flex-col univer-rounded-[10px] univer-bg-white univer-p-4 univer-shadow-lg dark:!univer-border-gray-600 dark:!univer-bg-gray-700",
      children: [
        fe2 && (0, import_jsx_runtime.jsx)("div", { className: "univer-mb-3 univer-flex", children: (0, import_jsx_runtime.jsxs)(XS, { className: "univer-mb-3 !univer-flex univer-w-full", children: [
          (0, import_jsx_runtime.jsxs)(vr2, { className: "univer-w-1/2", onClick: () => V3(true), children: [
            (0, import_jsx_runtime.jsx)(bn2, { className: "univer-mr-1" }),
            r.t("sheets-sort.general.sort-asc")
          ] }),
          (0, import_jsx_runtime.jsxs)(vr2, { className: "univer-w-1/2", onClick: () => V3(false), children: [
            (0, import_jsx_runtime.jsx)(pn2, { className: "univer-mr-1" }),
            r.t("sheets-sort.general.sort-desc")
          ] })
        ] }) }),
        (0, import_jsx_runtime.jsx)("div", { className: "univer-w-full", children: (0, import_jsx_runtime.jsx)(
          IE,
          {
            value: B,
            items: e,
            onChange: (b2) => R(b2)
          }
        ) }),
        (0, import_jsx_runtime.jsx)("div", { className: "univer-z-10 univer-h-60", children: (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-3 univer-h-full univer-w-full", children: B === me.Items ? (0, import_jsx_runtime.jsx)(
          di,
          {
            tableFilter: f,
            unitId: h,
            subUnitId: d,
            tableId: v,
            columnIndex: S3,
            checkedItemSet: $,
            setCheckedItemSet: I
          }
        ) : (0, import_jsx_runtime.jsx)(
          ci,
          {
            tableFilter: f,
            unitId: h,
            subUnitId: d,
            tableId: v,
            columnIndex: S3,
            conditionInfo: g,
            onChange: x
          }
        ) }) }),
        (0, import_jsx_runtime.jsxs)(
          "div",
          {
            className: "univer-flex-wrap-nowrap univer-mt-4 univer-inline-flex univer-flex-shrink-0 univer-flex-grow-0 univer-justify-between univer-gap-6 univer-overflow-hidden",
            children: [
              (0, import_jsx_runtime.jsx)(
                vr2,
                {
                  disabled: f === void 0,
                  onClick: ce2,
                  children: r.t("sheets-table.filter.clear-filter")
                }
              ),
              (0, import_jsx_runtime.jsxs)("div", { children: [
                (0, import_jsx_runtime.jsx)(vr2, { className: "univer-mr-2", onClick: Y, children: r.t("sheets-table.filter.cancel") }),
                (0, import_jsx_runtime.jsx)(vr2, { variant: "primary", onClick: G3, children: r.t("sheets-table.filter.confirm") })
              ] })
            ]
          }
        )
      ]
    }
  );
}
function vi(r) {
  const e = r.getCurrentLocale();
  return (0, import_react.useMemo)(() => [
    { label: r.t("sheets-table.filter.by-values"), value: me.Items },
    { label: r.t("sheets-table.filter.by-conditions"), value: me.Condition }
  ], [e, r]);
}
var gi = Object.getOwnPropertyDescriptor;
var bi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? gi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var et3 = (r, e) => (t, n) => e(t, n, r);
var $e2 = class extends Ve {
  constructor(e, t, n, i) {
    super();
    U(this, "_popupDisposable");
    U(this, "_currentTableFilterInfo", null);
    this._componentManager = e, this._contextService = t, this._sheetCanvasPopupService = n, this._dialogService = i, this._initComponents(), this._initUIPopup();
  }
  setCurrentTableFilterInfo(e) {
    this._currentTableFilterInfo = e;
  }
  clearCurrentTableFilterInfo() {
    this._currentTableFilterInfo = null;
  }
  getCurrentTableFilterInfo() {
    return this._currentTableFilterInfo;
  }
  _initComponents() {
    [
      [ge2, hi]
    ].forEach(([e, t]) => {
      this.disposeWithMe(this._componentManager.register(e, t));
    });
  }
  _initUIPopup() {
    this.disposeWithMe(this._contextService.subscribeContextValue$(ge2).pipe(startWith(void 0), distinctUntilChanged()).subscribe((e) => {
      e ? this._openFilterPopup() : e === false && this._closeFilterPopup();
    }));
  }
  closeFilterPanel() {
    this._contextService.setContextValue(ge2, false);
  }
  _openFilterPopup() {
    const e = this._currentTableFilterInfo;
    if (!e)
      throw new Error("[SheetsFilterUIController]: no filter model when opening filter popup!");
    const { row: t, column: n } = e;
    this._popupDisposable = this._sheetCanvasPopupService.attachPopupToCell(t, n, {
      componentKey: ge2,
      direction: "horizontal",
      onClickOutside: () => {
        this._dialogService.close(Ur), this._contextService.setContextValue(ge2, false);
      },
      offset: [5, 0],
      portal: true
    });
  }
  _closeFilterPopup() {
    var e;
    (e = this._popupDisposable) == null || e.dispose(), this._popupDisposable = null, this.clearCurrentTableFilterInfo();
  }
};
$e2 = bi([
  et3(0, Inject(S1)),
  et3(1, Nr),
  et3(2, Inject(yi)),
  et3(3, Inject(ct))
], $e2);
var Ct2 = {
  type: Ms.OPERATION,
  id: "sheet.operation.open-table-filter-panel",
  async handler(r, e) {
    if (!e)
      return false;
    const { row: t, col: n, unitId: i, subUnitId: a, tableId: s } = e, c = r.get(T), u = r.get(Nr), h = r.get($e2);
    return c.getTable(i, s) ? (u.getContextValue(ge2) || (h.setCurrentTableFilterInfo({ unitId: i, subUnitId: a, row: t, tableId: s, column: n }), u.setContextValue(ge2, true)), true) : false;
  }
};
var Nt2 = {
  type: Ms.OPERATION,
  id: "sheet.operation.open-table-selector",
  async handler(r) {
    var w;
    const e = r.get(vr), t = r.get(Ls), n = P(e);
    if (!n)
      return false;
    const { unitId: i, subUnitId: a, worksheet: s } = n, u = r.get(z).getCurrentLastSelection(), h = (w = u == null ? void 0 : u.range) != null ? w : { startRow: 0, endRow: 0, startColumn: 0, endColumn: 0 }, v = Th(u) ? ph(h, { up: true, left: true, right: true, down: true }, s) : h, f = await Tn2(r, i, a, v);
    return f ? (t.executeCommand(Dn.id, { ...f }), true) : false;
  }
};
async function Tn2(r, e, t, n, i) {
  const a = r.get(ct), s = r.get(Fn);
  return new Promise((c) => {
    const u = {
      unitId: e,
      subUnitId: t,
      range: n,
      tableId: i,
      onConfirm: (h) => {
        c(h), a.close(xe2);
      },
      onCancel: () => {
        c(null), a.close(xe2);
      }
    };
    a.open({
      id: xe2,
      title: { title: s.t("sheets-table.selectRange") },
      draggable: true,
      destroyOnClose: true,
      mask: false,
      maskClosable: false,
      children: {
        label: {
          name: xe2,
          props: u
        }
      },
      width: 300,
      onClose: () => {
        c(null), a.close(xe2);
      }
    });
  });
}
var wn2 = "sheets-table-ui.config";
var At2 = {
  anchorHeight: 24,
  anchorBackgroundColor: "rgb(134,139,156)"
};
var mi = Object.getOwnPropertyDescriptor;
var pi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? mi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var fi = (r, e) => (t, n) => e(t, n, r);
var Ie = class extends Ve {
  constructor(e) {
    super();
    U(this, "_refreshTable", new Subject());
    U(this, "refreshTable$", this._refreshTable.asObservable());
    this._commandService = e, this._initListener();
  }
  _initListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        if (e.id === Rd.id) {
          const t = e.params, { styleName: n } = t;
          n.startsWith(Un) && this._refreshTable.next(Math.random());
        }
      })
    );
  }
};
Ie = pi([
  fi(0, Inject(Ls))
], Ie);
var Ci = () => {
  var fe2, de2;
  const [r, e] = (0, import_react.useState)(""), [t, n] = (0, import_react.useState)(""), i = useDependency(we2), [a, s] = (0, import_react.useState)({}), c = useDependency(Injector), u = useDependency(it), h = useObservable(u.anchorPosition$), d = useDependency(Ls), v = useDependency(vr), f = useDependency(dn), w = useObservable(f.unitPermissionInitStateChange$, false), S3 = useDependency(T), E = useDependency(ve), C2 = useDependency(Ie), $ = useObservable(C2.refreshTable$), I = useDependency(Fn), B = useDependency(z), R = useObservable(B.selectionChanged$, [{ range: V1(0, 0), primary: null }]), [, g] = (0, import_react.useState)(Math.random()), y2 = useDependency(ic).getConfig(wn2), m3 = (fe2 = y2 == null ? void 0 : y2.anchorHeight) != null ? fe2 : 24, O3 = (de2 = y2 == null ? void 0 : y2.anchorBackgroundColor) != null ? de2 : "rgb(53,91,183)", L = (b2, P3) => {
    s((A2) => ({
      ...A2,
      [b2]: P3
    }));
  };
  if ((0, import_react.useEffect)(() => {
    g(Math.random());
  }, [$]), !(h != null && h.length))
    return null;
  const Y = P(v);
  if (!Y) return null;
  const { unitId: V3, subUnitId: G3 } = Y, ce2 = (b2, P3) => {
    var Q;
    if (((Q = S3.getTableById(V3, b2)) == null ? void 0 : Q.getDisplayName()) === P3) {
      e(""), n("");
      return;
    }
    d.executeCommand(Ln.id, {
      tableId: b2,
      unitId: V3,
      name: P3
    }), n(""), e("");
  }, ue3 = async (b2) => {
    const P3 = S3.getTableById(V3, b2);
    if (!P3) return;
    const A2 = P3.getRange(), Q = await Tn2(c, V3, G3, A2, b2);
    Q && d.executeCommand(Ln.id, {
      tableId: b2,
      unitId: V3,
      updateRange: {
        newRange: Q.range
      }
    });
  };
  return w ? (0, import_jsx_runtime.jsx)("div", { className: "univer-absolute univer-z-50 univer-h-0 univer-w-0", children: h.map((b2) => {
    var Oe2, De2, p, _, z2, K2, se;
    const P3 = S3.getTableById(V3, b2.tableId);
    if (!P3) return null;
    const A2 = E.getRangeThemeStyle(V3, P3.getTableStyleId()), Q = (p = (De2 = (Oe2 = A2 == null ? void 0 : A2.getHeaderRowStyle()) == null ? void 0 : Oe2.bg) == null ? void 0 : De2.rgb) != null ? p : O3, Qe = (K2 = (z2 = (_ = A2 == null ? void 0 : A2.getHeaderRowStyle()) == null ? void 0 : _.cl) == null ? void 0 : z2.rgb) != null ? K2 : "rgb(255, 255, 255)", Ge2 = P3.getRange();
    if (!(R != null && R.length))
      return null;
    const Xe3 = R[R.length - 1].range, Pe2 = !En.intersects(Ge2, Xe3) && b2.y <= 20;
    return (0, import_jsx_runtime.jsxs)(
      "div",
      {
        className: ie("univer-shadow-xs univer-absolute univer-box-border univer-cursor-pointer univer-items-center univer-rounded-xl univer-pl-2 univer-pr-2", kt, {
          "univer-flex": !Pe2,
          "univer-hidden": Pe2
        }),
        style: {
          left: b2.x,
          top: Math.max(b2.y, 0),
          backgroundColor: Q,
          color: Qe,
          borderWidth: "0.5px",
          height: m3 ? `${m3}px` : "24px"
        },
        children: [
          (0, import_jsx_runtime.jsx)("div", { className: "univer-text-nowrap", children: r === b2.tableId ? (0, import_jsx_runtime.jsx)(
            Vx,
            {
              className: "univer-h-[18px] univer-min-w-16 univer-rounded-none",
              inputClass: "univer-h-[18px] univer-w-[80px]",
              value: t,
              onChange: (W2) => n(W2),
              onBlur: () => ce2(b2.tableId, t),
              onKeyDown: (W2) => {
                W2.key === "Enter" && ce2(b2.tableId, t);
              },
              autoFocus: r === b2.tableId
            }
          ) : (0, import_jsx_runtime.jsx)("div", { className: "univer-h-[18px] univer-max-w-24 univer-truncate univer-text-sm", children: b2.tableName }) }),
          (0, import_jsx_runtime.jsx)(
            vf,
            {
              align: "start",
              overlay: (0, import_jsx_runtime.jsxs)("div", { className: "univer-pb-2 univer-pt-2", children: [
                (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: "univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",
                    onClick: () => {
                      e(b2.tableId), n(b2.tableName);
                    },
                    children: [
                      (0, import_jsx_runtime.jsx)(Cn2, {}),
                      I.t("sheets-table.rename")
                    ]
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "div",
                  {
                    className: "univer-mb-1 univer-mt-1 univer-h-px univer-w-full univer-bg-gray-200"
                  }
                ),
                (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    onClick: () => ue3(b2.tableId),
                    className: "univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",
                    children: [
                      (0, import_jsx_runtime.jsx)(fn3, {}),
                      I.t("sheets-table.updateRange")
                    ]
                  }
                ),
                (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: "univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-gap-2 univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",
                    onClick: () => {
                      L(b2.tableId, false);
                      const W2 = S3.getTableById(V3, b2.tableId);
                      if (!W2) return;
                      const Ce2 = W2.getTableConfig(), Se = {
                        id: Wr2,
                        header: { title: I.t("sheets-table.tableStyle") },
                        children: {
                          label: vn2,
                          oldConfig: Ce2,
                          unitId: V3,
                          subUnitId: G3,
                          tableId: b2.tableId
                        },
                        width: 330
                      };
                      i.open(Se);
                    },
                    children: [
                      (0, import_jsx_runtime.jsx)(
                        _n2,
                        {
                          extend: { colorChannel1: "rgb(53,91,183)" }
                        }
                      ),
                      I.t("sheets-table.setTheme")
                    ]
                  }
                ),
                (0, import_jsx_runtime.jsx)(
                  "div",
                  {
                    className: "univer-mb-1 univer-mt-1 univer-h-px univer-w-full univer-bg-gray-200"
                  }
                ),
                (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: "univer-flex univer-min-w-32 univer-cursor-pointer univer-items-center univer-pb-1 univer-pl-2 univer-pr-2 univer-pt-1 univer-text-sm hover:univer-bg-gray-200",
                    onClick: () => {
                      L(b2.tableId, false), d.executeCommand(xn2.id, {
                        tableId: b2.tableId,
                        subUnitId: G3,
                        unitId: V3
                      });
                    },
                    children: [
                      (0, import_jsx_runtime.jsx)(mn2, { className: "univer-mr-2" }),
                      I.t("sheets-table.removeTable")
                    ]
                  }
                )
              ] }),
              open: (se = a[b2.tableId]) != null ? se : false,
              onOpenChange: (W2) => {
                L(b2.tableId, W2);
              },
              children: (0, import_jsx_runtime.jsx)(Mt2, {})
            },
            b2.tableId
          )
        ]
      },
      b2.tableId
    );
  }) }) : null;
};
var Si = Object.getOwnPropertyDescriptor;
var _i = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Si(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var ee2 = (r, e) => (t, n) => e(t, n, r);
var it = class extends Ve {
  constructor(e, t, n, i, a, s, c, u, h, d, v) {
    super();
    U(this, "_anchorVisible$", new BehaviorSubject(true));
    U(this, "_timer");
    U(this, "_anchorPosition$", new BehaviorSubject([]));
    U(this, "anchorPosition$", this._anchorPosition$.asObservable());
    this._context = e, this._injector = t, this._sheetSkeletonManagerService = n, this._renderManagerService = i, this._commandService = a, this._univerInstanceService = s, this._uiPartsService = c, this._tableManager = u, this._scrollManagerService = h, this._workbookPermissionService = d, this._permissionService = v, this._initUI(), this._initListener(), this._initTableAnchor();
  }
  _initUI() {
    this.disposeWithMe(
      this._uiPartsService.registerComponent(c1.CONTENT, () => connectInjector(Ci, this._injector))
    );
  }
  _initListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        (e.id === Jt.id || e.id === gn.id) && (this._anchorVisible$.next(false), this._timer && clearTimeout(this._timer), this._timer = setTimeout(() => {
          this._anchorVisible$.next(true);
        }, 300));
      })
    );
  }
  _initTableAnchor() {
    this.disposeWithMe(
      merge(
        this._context.unit.activeSheet$,
        this._sheetSkeletonManagerService.currentSkeleton$,
        this._scrollManagerService.validViewportScrollInfo$,
        this._tableManager.tableAdd$,
        this._tableManager.tableDelete$,
        this._tableManager.tableNameChanged$,
        this._tableManager.tableRangeChanged$,
        this._tableManager.tableThemeChanged$,
        this._workbookPermissionService.unitPermissionInitStateChange$.pipe(filter((e) => e)),
        this._permissionService.permissionPointUpdate$.pipe(debounceTime(300)),
        this._anchorVisible$
      ).subscribe(() => {
        var h;
        if (!this._anchorVisible$.getValue()) {
          this._anchorPosition$.next([]);
          return;
        }
        const t = this._context.unit, n = t.getActiveSheet(), i = n == null ? void 0 : n.getSheetId(), a = this._tableManager.getTableList(this._context.unitId).filter((d) => d.subUnitId === i), s = this._renderManagerService.getRenderById(this._context.unitId);
        if (!s) {
          this._anchorPosition$.next([]);
          return;
        }
        if (!((h = this._permissionService.getPermissionPoint(new Pe(t.getUnitId()).id)) == null ? void 0 : h.value)) {
          this._anchorPosition$.next([]);
          return;
        }
        const u = a.reduce((d, v) => {
          const { startRow: f, startColumn: w } = v.range, S3 = s.with(ue), E = en(this._univerInstanceService, this._renderManagerService);
          if (!E) return d;
          const { scene: C2 } = E, $ = C2.getViewport(k2.VIEW_MAIN);
          if (!$) return d;
          const I = C2 == null ? void 0 : C2.scaleX, B = C2 == null ? void 0 : C2.scaleY, R = C2 == null ? void 0 : C2.getViewportScrollXY($);
          if (!I || !C2 || !B || !R) return d;
          const g = S3.getCurrentSkeleton();
          if (!g) return d;
          const x = g.getNoMergeCellWithCoordByIndex(f, w), y2 = PB(x.startX, I, R), m3 = NB(x.startY, B, R) - 25 - 4;
          return m3 >= -10 && y2 >= 45 && d.push({
            x: y2,
            y: m3,
            tableId: v.id,
            tableName: v.name
          }), d;
        }, []);
        this._anchorPosition$.next(u);
      })
    );
  }
};
it = _i([
  ee2(1, Inject(Injector)),
  ee2(2, Inject(ue)),
  ee2(3, ME),
  ee2(4, Ls),
  ee2(5, vr),
  ee2(6, D1),
  ee2(7, Inject(T)),
  ee2(8, Inject(Et)),
  ee2(9, Inject(dn)),
  ee2(10, Inject(eC))
], it);
var Me2 = 16;
new Path2D("M3.30363 3C2.79117 3 2.51457 3.60097 2.84788 3.99024L6.8 8.60593V12.5662C6.8 12.7184 6.8864 12.8575 7.02289 12.9249L8.76717 13.7863C8.96655 13.8847 9.2 13.7396 9.2 13.5173V8.60593L13.1521 3.99024C13.4854 3.60097 13.2088 3 12.6964 3H3.30363Z");
var Ut2 = class {
  static drawNoSetting(e, t, n, i) {
    e.save(), I1.drawWith(e, {
      radius: 2,
      width: Me2,
      height: Me2,
      fill: i
    }), e.lineCap = "square", e.strokeStyle = n, e.scale(t / Me2, t / Me2), e.beginPath(), e.lineWidth = 1, e.lineCap = "round", e.moveTo(3, 4), e.lineTo(13, 4), e.moveTo(4.5, 8), e.lineTo(11.5, 8), e.moveTo(6, 12), e.lineTo(10, 12), e.stroke(), e.restore();
  }
  static drawIconByPath(e, t, n, i) {
    e.save(), e.strokeStyle = n, e.fillStyle = i, I1.drawWith(e, {
      radius: 2,
      width: Me2,
      height: Me2,
      fill: i
    }), t.forEach((a) => {
      const s = new Path2D(a);
      e.fillStyle = n, e.fill(s, "evenodd");
    }), e.restore();
  }
};
var Ti = [
  "M3.30363 3C2.79117 3 2.51457 3.60097 2.84788 3.99024L6.8 8.60593V12.5662C6.8 12.7184 6.8864 12.8575 7.02289 12.9249L8.76717 13.7863C8.96655 13.8847 9.2 13.7396 9.2 13.5173V8.60593L13.1521 3.99024C13.4854 3.60097 13.2088 3 12.6964 3H3.30363Z"
];
var wi = [
  "M12.4008 13.1831C12.6907 13.1831 12.9258 12.9481 12.9258 12.6581V4.60873L14.013 5.69597C14.218 5.901 14.5505 5.901 14.7555 5.69597C14.9605 5.49094 14.9605 5.15853 14.7555 4.95351L12.7721 2.97017C12.5671 2.76515 12.2347 2.76515 12.0297 2.97017L10.0463 4.95351C9.84132 5.15853 9.84132 5.49094 10.0463 5.69597C10.2514 5.901 10.5838 5.901 10.7888 5.69597L11.8758 4.60901V12.6581C11.8758 12.9481 12.1108 13.1831 12.4008 13.1831Z",
  "M1.28069 4.85447C0.842195 4.33439 1.21191 3.5391 1.89218 3.5391H8.59333C9.2736 3.5391 9.64331 4.33439 9.20482 4.85447L6.51052 8.0501V11.6601C6.51052 12.2245 5.94174 12.6114 5.41683 12.404L4.48092 12.0343C4.1756 11.9136 3.97498 11.6187 3.97498 11.2904V8.0501L1.28069 4.85447Z"
];
var Ii = [
  "M12.4008 2.81641C12.6907 2.81641 12.9258 3.05146 12.9258 3.34141V11.3908L14.013 10.3036C14.218 10.0986 14.5505 10.0986 14.7555 10.3036C14.9605 10.5086 14.9605 10.841 14.7555 11.046L12.7721 13.0294C12.5671 13.2344 12.2347 13.2344 12.0297 13.0294L10.0463 11.046C9.84132 10.841 9.84132 10.5086 10.0463 10.3036C10.2514 10.0986 10.5838 10.0986 10.7888 10.3036L11.8758 11.3905V3.34141C11.8758 3.05146 12.1108 2.81641 12.4008 2.81641Z",
  "M1.28069 4.85444C0.842195 4.33435 1.21191 3.53906 1.89218 3.53906H8.59333C9.2736 3.53906 9.64331 4.33435 9.20482 4.85443L6.51052 8.05006V11.6601C6.51052 12.2245 5.94174 12.6113 5.41683 12.404L4.48092 12.0342C4.1756 11.9136 3.97498 11.6186 3.97498 11.2903V8.05006L1.28069 4.85444Z"
];
var yi2 = [
  "M11.9003 13.7046C11.9003 13.9969 11.6633 14.2339 11.371 14.2339C11.0787 14.2339 10.8417 13.9969 10.8417 13.7046V3.57272L9.74577 4.66862C9.53906 4.87534 9.20391 4.87534 8.9972 4.66862C8.79048 4.46191 8.79048 4.12676 8.9972 3.92005L10.9969 1.92039C11.2036 1.71368 11.5387 1.71368 11.7454 1.92039L13.7451 3.92005C13.9518 4.12676 13.9518 4.46191 13.7451 4.66862C13.5384 4.87534 13.2032 4.87534 12.9965 4.66862L11.9003 3.57243V13.7046Z",
  "M2.69779 10.0113C2.40546 10.0113 2.16847 9.77429 2.16847 9.48196C2.16847 9.18962 2.40546 8.95264 2.69779 8.95264H6.67804C6.89213 8.95264 7.08514 9.0816 7.16707 9.2794C7.249 9.47719 7.20371 9.70486 7.05233 9.85624L3.97569 12.9329H6.67804C6.97038 12.9329 7.20736 13.1699 7.20736 13.4622C7.20736 13.7545 6.97038 13.9915 6.67804 13.9915H2.69779C2.4837 13.9915 2.29069 13.8626 2.20876 13.6648C2.12684 13.467 2.17212 13.2393 2.32351 13.0879L5.40015 10.0113H2.69779Z",
  "M5.51638 2.58693C5.23363 1.81542 4.14248 1.81543 3.85973 2.58693L2.13245 7.29995C2.03185 7.57443 2.17281 7.87849 2.4473 7.97909C2.72178 8.07969 3.02584 7.93872 3.12644 7.66424L3.64346 6.25351L3.64504 6.25351H5.73266L6.24968 7.66424C6.35027 7.93872 6.65433 8.07969 6.92882 7.97909C7.2033 7.87849 7.34426 7.57443 7.24367 7.29995L5.51638 2.58693ZM5.34467 5.19487L4.68806 3.40325L4.03144 5.19487H5.34467Z"
];
var Ri = [
  "M11.9003 2.29495C11.9003 2.00261 11.6633 1.76562 11.371 1.76562C11.0787 1.76562 10.8417 2.00261 10.8417 2.29495V12.4268L9.74577 11.3309C9.53906 11.1242 9.20391 11.1242 8.9972 11.3309C8.79048 11.5376 8.79048 11.8727 8.9972 12.0795L10.9969 14.0791C11.2036 14.2858 11.5387 14.2858 11.7454 14.0791L13.7451 12.0795C13.9518 11.8727 13.9518 11.5376 13.7451 11.3309C13.5384 11.1242 13.2032 11.1242 12.9965 11.3309L11.9003 12.4271V2.29495Z",
  "M2.69792 10.0113C2.40558 10.0113 2.16859 9.77429 2.16859 9.48196C2.16859 9.18962 2.40558 8.95264 2.69792 8.95264H6.67816C6.89225 8.95264 7.08526 9.0816 7.16719 9.2794C7.24912 9.47719 7.20384 9.70486 7.05245 9.85624L3.97581 12.9329H6.67816C6.9705 12.9329 7.20749 13.1699 7.20749 13.4622C7.20749 13.7545 6.9705 13.9915 6.67816 13.9915H2.69792C2.48383 13.9915 2.29082 13.8626 2.20889 13.6648C2.12696 13.467 2.17224 13.2393 2.32363 13.0879L5.40027 10.0113H2.69792Z",
  "M5.5165 2.58693C5.23375 1.81542 4.1426 1.81543 3.85985 2.58693L2.13257 7.29995C2.03197 7.57443 2.17294 7.8785 2.44742 7.97909C2.7219 8.07969 3.02596 7.93872 3.12656 7.66424L3.64358 6.25351L3.64516 6.25351H5.73278L6.2498 7.66424C6.35039 7.93872 6.65446 8.07969 6.92894 7.97909C7.20342 7.8785 7.34438 7.57443 7.24379 7.29995L5.5165 2.58693ZM5.34479 5.19487L4.68818 3.40325L4.03156 5.19487H5.34479Z"
];
var Mi = Object.getOwnPropertyDescriptor;
var xi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Mi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var mt = (r, e) => (t, n) => e(t, n, r);
var oe2 = 16;
var qe = 1;
var St = class extends x3 {
  constructor(e, t, n, i, a) {
    super(e, t);
    U(this, "_cellWidth", 0);
    U(this, "_cellHeight", 0);
    U(this, "_filterParams");
    U(this, "_hovered", false);
    this._contextService = n, this._commandService = i, this._themeService = a, this.setShapeProps(t), this.onPointerDown$.subscribeEvent((s) => this.onPointerDown(s)), this.onPointerEnter$.subscribeEvent(() => this.onPointerEnter()), this.onPointerLeave$.subscribeEvent(() => this.onPointerLeave());
  }
  setShapeProps(e) {
    typeof e.cellHeight < "u" && (this._cellHeight = e.cellHeight), typeof e.cellWidth < "u" && (this._cellWidth = e.cellWidth), typeof e.filterParams < "u" && (this._filterParams = e.filterParams), this.transformByState({
      width: e.width,
      height: e.height
    });
  }
  _draw(e) {
    const t = this._cellHeight, n = this._cellWidth, i = oe2 - n, a = oe2 - t;
    e.save();
    const s = new Path2D();
    s.rect(i, a, n, t), e.clip(s);
    const { buttonState: c } = this._filterParams, u = this._themeService.getColorFromTheme("primary.600"), h = this._hovered ? this._themeService.getColorFromTheme("gray.50") : "rgba(255, 255, 255, 1.0)";
    let d;
    switch (c) {
      case P2.FilteredSortNone:
        d = Ti;
        break;
      case P2.FilteredSortAsc:
        d = wi;
        break;
      case P2.FilteredSortDesc:
        d = Ii;
        break;
      case P2.FilterNoneSortNone:
        break;
      case P2.FilterNoneSortAsc:
        d = yi2;
        break;
      case P2.FilterNoneSortDesc:
        d = Ri;
        break;
    }
    d ? Ut2.drawIconByPath(e, d, u, h) : c !== void 0 && Ut2.drawNoSetting(e, oe2, u, h), e.restore();
  }
  onPointerDown(e) {
    if (e.button === 2)
      return;
    const { row: t, col: n, unitId: i, subUnitId: a, tableId: s } = this._filterParams;
    this._contextService.getContextValue(ge2) || !this._commandService.hasCommand(Ct2.id) || setTimeout(() => {
      const u = {
        row: t,
        col: n,
        unitId: i,
        subUnitId: a,
        tableId: s
      };
      this._commandService.executeCommand(Ct2.id, u);
    }, 200);
  }
  onPointerEnter() {
    this._hovered = true, this.makeDirty(true);
  }
  onPointerLeave() {
    this._hovered = false, this.makeDirty(true);
  }
};
St = xi([
  mt(2, Nr),
  mt(3, Ls),
  mt(4, Inject(Gi))
], St);
var Ni = Object.getOwnPropertyDescriptor;
var Ei = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Ni(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var Ze2 = (r, e) => (t, n) => e(t, n, r);
var $i = 5e3;
var Li = (r, e, t, n) => {
  switch (n) {
    case xn.TOP:
      return r + qe;
    case xn.MIDDLE:
      return r + Math.max(0, (t - oe2) / 2);
    case xn.BOTTOM:
    default:
      return e - oe2 - qe;
  }
};
var _t2 = class extends h1 {
  constructor(e, t, n, i, a, s) {
    super();
    U(this, "_buttonRenderDisposable", null);
    U(this, "_tableFilterButtonShapes", []);
    this._context = e, this._injector = t, this._sheetSkeletonManagerService = n, this._sheetInterceptorService = i, this._tableManager = a, this._commandService = s, this._initRenderer(), this._initCommandExecuted();
  }
  dispose() {
    super.dispose(), this._disposeRendering();
  }
  _initRenderer() {
    const e = this._tableManager;
    this._sheetSkeletonManagerService.currentSkeleton$.pipe(
      switchMap((t) => {
        var c;
        if (!t) return of(null);
        const { unit: n, unitId: i } = this._context, a = ((c = n.getActiveSheet()) == null ? void 0 : c.getSheetId()) || "", s = () => ({
          unitId: i,
          worksheetId: a,
          tableFilterRanges: this._tableManager.getSheetFilterRangeWithState(n.getUnitId(), a),
          skeleton: t.skeleton
        });
        return merge(
          e.tableAdd$,
          e.tableNameChanged$,
          e.tableRangeChanged$,
          e.tableThemeChanged$,
          e.tableDelete$,
          e.tableFilterChanged$
        ).pipe(
          map(() => s()),
          startWith(s())
        );
      }),
      takeUntil(this.dispose$)
    ).subscribe((t) => {
      this._disposeRendering(), !(!t || !t.tableFilterRanges) && this._renderButtons(t);
    });
  }
  _initCommandExecuted() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        var c;
        if (e.id !== zc2.id)
          return;
        const { unit: t, unitId: n } = this._context, i = ((c = t.getActiveSheet()) == null ? void 0 : c.getSheetId()) || "", a = this._sheetSkeletonManagerService.getCurrentSkeleton();
        if (!a)
          return;
        const s = {
          unitId: n,
          worksheetId: i,
          tableFilterRanges: this._tableManager.getSheetFilterRangeWithState(t.getUnitId(), i),
          skeleton: a
        };
        this._disposeRendering(), !(!s || !s.tableFilterRanges) && this._renderButtons(s);
      })
    );
  }
  _renderButtons(e) {
    const { tableFilterRanges: t, unitId: n, skeleton: i, worksheetId: a } = e, { unit: s, scene: c } = this._context, u = s.getSheetBySheetId(a);
    if (u) {
      for (const { range: h, states: d, tableId: v } of t) {
        const { startRow: f, startColumn: w, endColumn: S3 } = h;
        this._interceptCellContent(n, a, h);
        for (let E = w; E <= S3; E++) {
          const C2 = `sheets-table-filter-button-${f}-${E}`, $ = lh(f, E, c, i), I = u.getCellStyle(f, E), B = (I == null ? void 0 : I.vt) || xn.BOTTOM, { startX: R, startY: g, endX: x, endY: y2 } = $, m3 = x - R, O3 = y2 - g;
          if (O3 <= qe || m3 <= qe)
            continue;
          const L = d[E - w], Y = x - oe2 - qe, V3 = Li(g, y2, O3, B), G3 = {
            left: Y,
            top: V3,
            height: oe2,
            width: oe2,
            zIndex: $i,
            cellHeight: O3,
            cellWidth: m3,
            filterParams: { unitId: n, subUnitId: a, row: f, col: E, buttonState: L, tableId: v }
          }, ce2 = this._injector.createInstance(St, C2, G3);
          this._tableFilterButtonShapes.push(ce2);
        }
      }
      c.addObjects(this._tableFilterButtonShapes), c.makeDirty();
    }
  }
  _interceptCellContent(e, t, n) {
    const { startRow: i, startColumn: a, endColumn: s } = n;
    this._buttonRenderDisposable = this._sheetInterceptorService.intercept(ht.CELL_CONTENT, {
      effect: sr.Style,
      handler: (c, u, h) => {
        const { row: d, col: v, unitId: f, subUnitId: w } = u;
        return f !== e || w !== t || d !== i || v < a || v > s || ((!c || c === u.rawData) && (c = { ...u.rawData }), c.fontRenderExtension = {
          ...c == null ? void 0 : c.fontRenderExtension,
          rightOffset: oe2
        }), h(c);
      },
      priority: 10
    });
  }
  _disposeRendering() {
    var e;
    this._tableFilterButtonShapes.forEach((t) => t.dispose()), (e = this._buttonRenderDisposable) == null || e.dispose(), this._buttonRenderDisposable = null, this._tableFilterButtonShapes = [];
  }
};
_t2 = Ei([
  Ze2(1, Inject(Injector)),
  Ze2(2, Inject(ue)),
  Ze2(3, Inject(G)),
  Ze2(4, Inject(T)),
  Ze2(5, Ls)
], _t2);
var ki = (r) => {
  const { unitId: e, subUnitId: t, range: n, onCancel: i, onConfirm: a, tableId: s } = r, c = useDependency(T), [u, h] = (0, import_react.useState)(n), [d, v] = (0, import_react.useState)(""), f = useDependency(Fn), w = useDependency(vr);
  return (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
    (0, import_jsx_runtime.jsx)(
      Wr,
      {
        maxRangeCount: 1,
        unitId: e,
        subUnitId: t,
        initialValue: Ft(n),
        onChange: (S3, E) => {
          const C2 = Ft(n), $ = Dr(E).range, I = P(w, { unitId: e, subUnitId: t });
          if (!I)
            return;
          if (I.worksheet.getMergeData().some((L) => En.intersects($, L))) {
            v(f.t("sheets-table.tableRangeWithMergeError"));
            return;
          }
          if (c.getTablesBySubunitId(e, t).some((L) => {
            if (L.getId() === s)
              return false;
            const Y = L.getRange();
            return En.intersects($, Y);
          })) {
            v(f.t("sheets-table.tableRangeWithOtherTableError"));
            return;
          }
          const { startRow: y2, endRow: m3 } = $;
          if (y2 === m3) {
            v(f.t("sheets-table.tableRangeSingleRowError"));
            return;
          }
          if (C2 !== E) {
            if (s) {
              const L = c.getTableById(e, s);
              if (L) {
                const Y = L.getRange();
                if (En.intersects($, Y) && Y.startRow === $.startRow) {
                  h($), v(""), a({
                    unitId: e,
                    subUnitId: t,
                    range: $
                  });
                  return;
                } else {
                  v(f.t("sheets-table.updateError"));
                  return;
                }
              }
            }
            h($), v("");
          }
        },
        supportAcrossSheet: false
      }
    ),
    d && (0, import_jsx_runtime.jsx)("div", { className: "univer-mt-1 univer-text-xs univer-text-red-500", children: d }),
    (0, import_jsx_runtime.jsxs)("div", { className: "univer-mt-4 univer-flex univer-justify-end", children: [
      (0, import_jsx_runtime.jsx)(vr2, { onClick: i, children: f.t("sheets-table.cancel") }),
      (0, import_jsx_runtime.jsx)(
        vr2,
        {
          variant: "primary",
          onClick: () => {
            d || a({
              unitId: e,
              subUnitId: t,
              range: u
            });
          },
          className: "univer-ml-2",
          children: f.t("sheets-table.confirm")
        }
      )
    ] })
  ] });
};
var Pi = (r) => {
  var P3, A2, Q, dt, Qe, Ge2, ht2, Xe3, vt2, Pe2, Oe2, De2;
  const { unitId: e, subUnitId: t, tableId: n } = r, i = useDependency(Ls), a = useDependency(Fn), s = useDependency(T), c = s.getTableById(e, n), u = useDependency(ve), h = useDependency(Ie), d = useObservable(u.rangeThemeMapChange$), v = useObservable(h.refreshTable$), f = useDependency(_E), [, w] = (0, import_react.useState)(Math.random()), S3 = useObservable(s.tableThemeChanged$, {
    theme: c == null ? void 0 : c.getTableStyleId(),
    oldTheme: c == null ? void 0 : c.getTableStyleId(),
    unitId: e,
    subUnitId: t,
    tableId: n
  }), E = u.getRegisteredRangeThemes().filter((p) => p == null ? void 0 : p.startsWith(Zr)), C2 = u.getALLRegisteredTheme(e).filter((p) => p == null ? void 0 : p.startsWith(bt2)), $ = c == null ? void 0 : c.getTableStyleId(), I = C2.find((p) => p === $), B = I || C2[0], R = u.getCustomRangeThemeStyle(e, B), g = (Q = (A2 = (P3 = R == null ? void 0 : R.getHeaderRowStyle()) == null ? void 0 : P3.bg) == null ? void 0 : A2.rgb) != null ? Q : ve3, x = (Ge2 = (Qe = (dt = R == null ? void 0 : R.getFirstRowStyle()) == null ? void 0 : dt.bg) == null ? void 0 : Qe.rgb) != null ? Ge2 : ve3, y2 = (vt2 = (Xe3 = (ht2 = R == null ? void 0 : R.getSecondRowStyle()) == null ? void 0 : ht2.bg) == null ? void 0 : Xe3.rgb) != null ? vt2 : ve3, m3 = (De2 = (Oe2 = (Pe2 = R == null ? void 0 : R.getLastRowStyle()) == null ? void 0 : Pe2.bg) == null ? void 0 : Oe2.rgb) != null ? De2 : ve3, [O3, L] = (0, import_react.useState)(null), Y = (p) => {
    i.executeCommand(Ln.id, {
      unitId: e,
      tableId: n,
      theme: p
    });
  }, V3 = () => {
    if (C2.length >= 11) {
      f.emit(a.t("sheets-table.customTooMore"));
      return;
    }
    const p = C2[C2.length - 1];
    let _ = `${bt2}1`;
    if (p) {
      const K2 = Number(p.split("-")[2]);
      _ = `${bt2}${K2 + 1}`;
    }
    const z2 = new Ct(_, { ...as });
    i.executeCommand(En2.id, {
      unitId: e,
      tableId: n,
      themeStyle: z2
    });
  }, G3 = (p, _) => {
    i.executeCommand(Rd.id, {
      unitId: e,
      subUnitId: t,
      styleName: p,
      style: _
    });
  }, ce2 = (p) => {
    i.executeCommand(Bn.id, {
      unitId: e,
      tableId: n,
      themeName: p
    });
  };
  if ((0, import_react.useEffect)(() => {
    w(Math.random());
  }, [d, v]), !c) return null;
  const ue3 = new bt(g).isDark(), fe2 = new bt(x).isDark(), de2 = new bt(y2).isDark(), b2 = new bt(m3).isDark();
  return (0, import_jsx_runtime.jsxs)("div", { children: [
    (0, import_jsx_runtime.jsx)("h5", { children: a.t("sheets-table.defaultStyle") }),
    (0, import_jsx_runtime.jsx)("div", { className: "univer-flex univer-gap-2", children: E.map((p) => {
      var Ce2, Se, Be, Fe2, Ve2, He, Ae, Ue3;
      const _ = u.getDefaultRangeThemeStyle(p), z2 = ((Se = (Ce2 = _ == null ? void 0 : _.getHeaderRowStyle()) == null ? void 0 : Ce2.bg) == null ? void 0 : Se.rgb) || ve3, K2 = ((Fe2 = (Be = _ == null ? void 0 : _.getFirstRowStyle()) == null ? void 0 : Be.bg) == null ? void 0 : Fe2.rgb) || ve3, se = ((He = (Ve2 = _ == null ? void 0 : _.getSecondRowStyle()) == null ? void 0 : Ve2.bg) == null ? void 0 : He.rgb) || ve3, W2 = ((Ue3 = (Ae = _ == null ? void 0 : _.getLastRowStyle()) == null ? void 0 : Ae.bg) == null ? void 0 : Ue3.rgb) || ve3;
      return (0, import_jsx_runtime.jsxs)(
        "div",
        {
          className: ie("univer-h-10 univer-w-8 univer-cursor-pointer univer-border univer-border-solid univer-border-gray-200 univer-p-px [&>div]:univer-box-border [&>div]:univer-h-2.5", {
            "univer-border-blue-500": p === S3.theme
          }),
          onClick: () => Y(p),
          children: [
            (0, import_jsx_runtime.jsx)("div", { style: { background: z2, border: `${X2}` } }),
            (0, import_jsx_runtime.jsx)("div", { style: { background: K2, border: `${X2}` } }),
            (0, import_jsx_runtime.jsx)("div", { style: { background: se, border: `${X2}` } }),
            (0, import_jsx_runtime.jsx)("div", { style: { background: W2, border: `${X2}` } })
          ]
        },
        p
      );
    }) }),
    (0, import_jsx_runtime.jsx)("h5", { children: a.t("sheets-table.customStyle") }),
    (0, import_jsx_runtime.jsxs)("div", { className: ie("univer-w-full univer-rounded-sm", kt), children: [
      (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-flex-wrap univer-gap-2 univer-p-2", children: [
        (0, import_jsx_runtime.jsx)(
          "div",
          {
            className: ie("univer-h-10 univer-w-8 univer-cursor-pointer univer-p-px univer-text-center univer-leading-10", kt),
            onClick: V3,
            children: "+"
          }
        ),
        C2.map((p) => {
          var Ce2, Se, Be, Fe2, Ve2, He, Ae, Ue3;
          const _ = u.getCustomRangeThemeStyle(e, p), z2 = (Se = (Ce2 = _ == null ? void 0 : _.getHeaderRowStyle()) == null ? void 0 : Ce2.bg) == null ? void 0 : Se.rgb, K2 = (Fe2 = (Be = _ == null ? void 0 : _.getFirstRowStyle()) == null ? void 0 : Be.bg) == null ? void 0 : Fe2.rgb, se = (He = (Ve2 = _ == null ? void 0 : _.getSecondRowStyle()) == null ? void 0 : Ve2.bg) == null ? void 0 : He.rgb, W2 = (Ue3 = (Ae = _ == null ? void 0 : _.getLastRowStyle()) == null ? void 0 : Ae.bg) == null ? void 0 : Ue3.rgb;
          return (0, import_jsx_runtime.jsxs)(
            "div",
            {
              className: ie("univer-relative univer-h-10 univer-w-8 univer-cursor-pointer univer-border univer-border-solid univer-border-gray-200 univer-p-px", {
                "univer-border-blue-500": p === S3.theme
              }),
              onClick: () => Y(p),
              onMouseEnter: () => L(p),
              onMouseLeave: () => L(null),
              children: [
                (0, import_jsx_runtime.jsx)("div", { className: "univer-box-border univer-h-2.5", style: { background: z2 != null ? z2 : X2, border: `${z2 ? X2 : Je}` } }),
                (0, import_jsx_runtime.jsx)("div", { className: "univer-box-border univer-h-2.5", style: { background: K2 != null ? K2 : X2, border: `${K2 ? X2 : Je}` } }),
                (0, import_jsx_runtime.jsx)("div", { className: "univer-box-border univer-h-2.5", style: { background: se != null ? se : X2, border: `${se ? X2 : Je}` } }),
                (0, import_jsx_runtime.jsx)("div", { className: "univer-box-border univer-h-2.5", style: { background: W2 != null ? W2 : X2, border: `${W2 ? X2 : Je}` } }),
                (0, import_jsx_runtime.jsx)(
                  "div",
                  {
                    className: "univer-absolute univer-right-[-3px] univer-top-[-3px] univer-h-3 univer-w-3 univer-rounded-md univer-bg-gray-200 univer-text-center univer-text-xs univer-leading-[10px]",
                    style: { display: O3 === p ? "block" : "none" },
                    onClick: (Nn2) => {
                      Nn2.stopPropagation(), ce2(p);
                    },
                    children: "x"
                  }
                )
              ]
            },
            p
          );
        })
      ] }),
      I && (0, import_jsx_runtime.jsxs)(import_jsx_runtime.Fragment, { children: [
        (0, import_jsx_runtime.jsx)("div", { className: "univer-h-px univer-w-full univer-bg-gray-200" }),
        (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-flex-col univer-gap-2 univer-p-2", children: [
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-9 univer-gap-2", children: [
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9", kt, {
                  "univer-text-white": ue3,
                  "univer-text-gray-900": !ue3
                }),
                style: {
                  background: g
                },
                children: a.t("sheets-table.header")
              }
            ),
            (0, import_jsx_runtime.jsx)(
              vf,
              {
                overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-p-2", children: (0, import_jsx_runtime.jsx)(
                  sE,
                  {
                    value: g,
                    onChange: (p) => {
                      const _ = os("headerRowStyle", {
                        bg: {
                          rgb: p
                        },
                        cl: {
                          rgb: new bt(p).isDark() ? "#fff" : "#000"
                        }
                      });
                      G3(c.getTableStyleId(), { headerRowStyle: _ });
                    }
                  }
                ) }),
                children: (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: ie("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1", kt),
                    children: [
                      (0, import_jsx_runtime.jsx)(
                        "div",
                        {
                          className: ie("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400", kt, {
                            "univer-text-white": ue3,
                            "univer-text-gray-900": !ue3
                          }),
                          style: {
                            background: g
                          }
                        }
                      ),
                      (0, import_jsx_runtime.jsx)(je2, { className: "univer-h-2 univer-w-2" })
                    ]
                  }
                )
              }
            )
          ] }),
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-9 univer-gap-2", children: [
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9", kt, {
                  "univer-text-white": fe2,
                  "univer-text-gray-900": !fe2
                }),
                style: {
                  background: x
                },
                children: a.t("sheets-table.firstLine")
              }
            ),
            (0, import_jsx_runtime.jsx)(
              vf,
              {
                overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-p-2", children: (0, import_jsx_runtime.jsx)(
                  sE,
                  {
                    value: x,
                    onChange: (p) => {
                      G3(c.getTableStyleId(), {
                        firstRowStyle: {
                          bg: {
                            rgb: p
                          },
                          cl: {
                            rgb: new bt(p).isDark() ? "#fff" : "#000"
                          }
                        }
                      });
                    }
                  }
                ) }),
                children: (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: ie("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1", kt),
                    children: [
                      (0, import_jsx_runtime.jsx)(
                        "div",
                        {
                          className: ie("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400", kt),
                          style: { background: x }
                        }
                      ),
                      (0, import_jsx_runtime.jsx)(je2, { className: "univer-h-2 univer-w-2" })
                    ]
                  }
                )
              }
            )
          ] }),
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-9 univer-gap-2", children: [
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9", kt, {
                  "univer-text-white": de2,
                  "univer-text-gray-900": !de2
                }),
                style: {
                  background: y2
                },
                children: a.t("sheets-table.secondLine")
              }
            ),
            (0, import_jsx_runtime.jsx)(
              vf,
              {
                overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-p-2", children: (0, import_jsx_runtime.jsx)(
                  sE,
                  {
                    value: y2,
                    onChange: (p) => G3(c.getTableStyleId(), {
                      secondRowStyle: {
                        bg: {
                          rgb: p
                        },
                        cl: {
                          rgb: new bt(p).isDark() ? "#fff" : "#000"
                        }
                      }
                    })
                  }
                ) }),
                children: (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: ie("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1", kt),
                    children: [
                      (0, import_jsx_runtime.jsx)(
                        "div",
                        {
                          className: ie("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400", kt),
                          style: { background: y2 }
                        }
                      ),
                      (0, import_jsx_runtime.jsx)(je2, { className: "univer-h-2 univer-w-2" })
                    ]
                  }
                )
              }
            )
          ] }),
          (0, import_jsx_runtime.jsxs)("div", { className: "univer-flex univer-h-9 univer-gap-2", children: [
            (0, import_jsx_runtime.jsx)(
              "div",
              {
                className: ie("univer-box-border univer-h-full univer-w-52 univer-rounded-sm univer-text-center univer-leading-9", kt, {
                  "univer-text-white": b2,
                  "univer-text-gray-900": !b2
                }),
                style: {
                  background: m3
                },
                children: a.t("sheets-table.footer")
              }
            ),
            (0, import_jsx_runtime.jsx)(
              vf,
              {
                overlay: (0, import_jsx_runtime.jsx)("div", { className: "univer-p-2", children: (0, import_jsx_runtime.jsx)(
                  sE,
                  {
                    value: m3,
                    onChange: (p) => {
                      const _ = os("lastRowStyle", {
                        bg: {
                          rgb: p
                        },
                        cl: {
                          rgb: new bt(p).isDark() ? "#fff" : "#000"
                        }
                      });
                      G3(c.getTableStyleId(), { lastRowStyle: _ });
                    }
                  }
                ) }),
                children: (0, import_jsx_runtime.jsxs)(
                  "div",
                  {
                    className: ie("univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded-sm univer-bg-white univer-p-1", kt),
                    children: [
                      (0, import_jsx_runtime.jsx)(
                        "div",
                        {
                          className: ie("univer-h-4 univer-w-4 univer-rounded-lg univer-bg-gray-400", kt),
                          style: { background: m3 }
                        }
                      ),
                      (0, import_jsx_runtime.jsx)(je2, { className: "univer-h-2 univer-w-2" })
                    ]
                  }
                )
              }
            )
          ] })
        ] })
      ] })
    ] })
  ] });
};
var In2 = "sheet.table.context-insert_menu-id";
var yn2 = "sheet.table.context-remove_menu-id";
function Oi(r) {
  return {
    id: Nt2.id,
    type: H1.BUTTON,
    icon: hn2,
    tooltip: "sheets-table.title",
    title: "sheets-table.title",
    hidden$: Bi(r, we.UNIVER_SHEET),
    disabled$: he(r, {}, true)
  };
}
function Di(r) {
  return {
    id: In2,
    type: H1.SUBITEMS,
    icon: "InsertDoubleIcon",
    title: "sheets-table.insert.main",
    hidden$: Rn2(r)
  };
}
function Bi2(r) {
  return {
    id: yn2,
    type: H1.SUBITEMS,
    icon: "ReduceDoubleIcon",
    title: "sheets-table.remove.main",
    hidden$: Rn2(r)
  };
}
function Fi(r) {
  return {
    id: Wn.id,
    type: H1.BUTTON,
    title: "sheets-table.insert.row",
    hidden$: Mn2(r)
  };
}
function Vi(r) {
  return {
    id: Hn.id,
    title: "sheets-table.insert.col",
    type: H1.BUTTON
  };
}
function Hi(r) {
  return {
    id: Vn.id,
    type: H1.BUTTON,
    title: "sheets-table.remove.row",
    hidden$: Mn2(r)
  };
}
function Ai(r) {
  return {
    id: Pn.id,
    title: "sheets-table.remove.col",
    type: H1.BUTTON
  };
}
function Rn2(r) {
  const e = r.get(z);
  return r.get(vr).getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
    switchMap((i) => i ? i.activeSheet$.pipe(
      switchMap((a) => a ? e.selectionMoveEnd$.pipe(
        switchMap((s) => {
          if (!s.length || s.length > 1) return of(true);
          const u = s[0].range, d = r.get(W).getContainerTableWithRange(i.getUnitId(), a.getSheetId(), u);
          return of(!d);
        })
      ) : of(true))
    ) : of(true))
  );
}
function Mn2(r) {
  const e = r.get(z);
  return r.get(vr).getCurrentTypeOfUnit$(we.UNIVER_SHEET).pipe(
    switchMap((i) => i ? i.activeSheet$.pipe(
      switchMap((a) => a ? e.selectionMoveEnd$.pipe(
        switchMap((s) => {
          if (!s.length || s.length > 1) return of(true);
          const u = s[0].range, d = r.get(W).getContainerTableWithRange(i.getUnitId(), a.getSheetId(), u);
          if (!d)
            return of(true);
          const v = d.getRange();
          return u.startRow === v.startRow ? of(true) : of(false);
        })
      ) : of(true))
    ) : of(true))
  );
}
var Ui = {
  [fe.ORGANIZATION]: {
    [Nt2.id]: {
      order: 0,
      menuItemFactory: Oi
    }
  },
  [Y1.MAIN_AREA]: {
    [a1.LAYOUT]: {
      [In2]: {
        order: 5,
        menuItemFactory: Di,
        [Wn.id]: {
          order: 1,
          menuItemFactory: Fi
        },
        [Hn.id]: {
          order: 2,
          menuItemFactory: Vi
        }
      },
      [yn2]: {
        order: 6,
        menuItemFactory: Bi2,
        [Vn.id]: {
          order: 1,
          menuItemFactory: Hi
        },
        [Pn.id]: {
          order: 2,
          menuItemFactory: Ai
        }
      }
    }
  }
};
var Wi = Object.getOwnPropertyDescriptor;
var Zi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Wi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var Wt2 = (r, e) => (t, n) => e(t, n, r);
var at = class extends Ve {
  constructor(r, e) {
    super(), this._componentManager = r, this._menuManagerService = e, this._initComponents(), this._initMenu();
  }
  _initComponents() {
    [
      [hn2, Sn2],
      [xe2, ki],
      [vn2, Pi]
    ].forEach(([r, e]) => {
      this.disposeWithMe(this._componentManager.register(r, e));
    });
  }
  _initMenu() {
    this._menuManagerService.mergeMenu(Ui);
  }
};
at = Zi([
  Wt2(0, Inject(S1)),
  Wt2(1, Inject(B1))
], at);
var ji = Object.getOwnPropertyDescriptor;
var qi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ji(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var tt2 = (r, e) => (t, n) => e(t, n, r);
var Tt2 = class extends h1 {
  constructor(r, e, t, n, i) {
    super(), this._context = r, this._injector = e, this._sheetSkeletonManagerService = t, this._tableManager = n, this._sheetTableThemeUIController = i, this._initListener();
  }
  _dirtySkeleton() {
    var e;
    (e = this._context.mainComponent) == null || e.makeDirty();
    const r = this._sheetSkeletonManagerService.getCurrentParam();
    if (r) {
      const t = { ...r, dirty: true };
      this._sheetSkeletonManagerService.reCalculate(t);
    }
  }
  _initListener() {
    const r = this._tableManager, e = this._dirtySkeleton.bind(this);
    this.disposeWithMe(
      merge(
        r.tableAdd$,
        r.tableDelete$,
        r.tableNameChanged$,
        r.tableRangeChanged$,
        r.tableThemeChanged$,
        r.tableFilterChanged$,
        r.tableInitStatus$,
        this._sheetTableThemeUIController.refreshTable$
      ).subscribe(
        e
      )
    );
  }
};
Tt2 = qi([
  tt2(1, Inject(Injector)),
  tt2(2, Inject(ue)),
  tt2(3, Inject(T)),
  tt2(4, Inject(Ie))
], Tt2);
var Yi = Object.getOwnPropertyDescriptor;
var Qi = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Yi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var pt3 = (r, e) => (t, n) => e(t, n, r);
var st = class extends Ve {
  constructor(r, e, t) {
    super(), this._sheetInterceptorService = r, this._univerInstanceService = e, this._tableManager = t, this._initSelectionChange();
  }
  _initSelectionChange() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        getMutations: (r) => {
          if (r.id === Ra.id) {
            const e = P(this._univerInstanceService);
            if (!e)
              return { redos: [], undos: [] };
            const t = r.params, { range: n } = t, { unitId: i, subUnitId: a, worksheet: s } = e, u = this._tableManager.getTablesBySubunitId(i, a).find((h) => {
              const d = h.getRange();
              return En.contains(d, n);
            });
            if (u) {
              const h = u.getRange(), d = {
                ...h,
                startRow: h.startRow + 1
              };
              return En.equals(h, n) ? { undos: [], redos: [] } : En.equals(d, n) ? {
                undos: [],
                redos: [
                  {
                    id: ie2.id,
                    params: {
                      unitId: i,
                      subUnitId: a,
                      selections: [
                        {
                          range: h,
                          primary: _e(h, s)
                        }
                      ]
                    }
                  }
                ]
              } : {
                undos: [],
                redos: [
                  {
                    id: ie2.id,
                    params: {
                      unitId: i,
                      subUnitId: a,
                      selections: [
                        {
                          range: d,
                          primary: _e(d, s)
                        }
                      ]
                    }
                  }
                ]
              };
            }
          }
          return { redos: [], undos: [] };
        }
      })
    );
  }
};
st = Qi([
  pt3(0, Inject(G)),
  pt3(1, Inject(vr)),
  pt3(2, Inject(T))
], st);
var Gi2 = Object.defineProperty;
var Xi = Object.getOwnPropertyDescriptor;
var zi = (r, e, t) => e in r ? Gi2(r, e, { enumerable: true, configurable: true, writable: true, value: t }) : r[e] = t;
var Ki = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Xi(e, t) : e, a = r.length - 1, s; a >= 0; a--)
    (s = r[a]) && (i = s(i) || i);
  return i;
};
var nt = (r, e) => (t, n) => e(t, n, r);
var xn3 = (r, e, t) => zi(r, typeof e != "symbol" ? e + "" : e, t);
var ot = class extends Ol {
  constructor(r = At2, e, t, n, i) {
    super(), this._config = r, this._injector = e, this._commandService = t, this._configService = n, this._renderManagerService = i;
    const { menu: a, ...s } = oo(
      {},
      At2,
      this._config
    );
    a && this._configService.setConfig("menu", a, { merge: true }), this._configService.setConfig(wn2, s), this._initRegisterCommand();
  }
  onStarting() {
    GC(this._injector, [
      [$e2],
      [Ee],
      [at],
      [Ie],
      [st]
    ]);
  }
  onReady() {
    zc(this._injector, [
      [$e2],
      [Ee],
      [at],
      [Ie],
      [st]
    ]);
  }
  onRendered() {
    this._registerRenderModules();
  }
  _registerRenderModules() {
    const r = [
      [_t2],
      [Tt2]
    ];
    this._config.hideAnchor !== true && r.push([it]), r.forEach((e) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(we.UNIVER_SHEET, e));
    });
  }
  _initRegisterCommand() {
    [
      Ct2,
      Nt2
    ].forEach((r) => this._commandService.registerCommand(r));
  }
};
xn3(ot, "pluginName", Ar);
xn3(ot, "type", we.UNIVER_SHEET);
ot = Ki([
  qR($e),
  nt(1, Inject(Injector)),
  nt(2, Inject(Ls)),
  nt(3, ic),
  nt(4, ME)
], ot);

// node_modules/@univerjs/sheets-table/lib/es/facade.js
var V2 = class extends C {
  getTableInfo(e) {
    const t = this.getId();
    return this._injector.get(X).getTableInfo(t, e);
  }
  getTableList() {
    const e = this.getId();
    return this._injector.get(X).getTableList(e);
  }
  async addTable(e, t, n, i, a) {
    var v;
    const o = this._injector.get(X), r = this._injector.get(Fn), c = this._injector.get(vr).getCurrentUnitOfType(we.UNIVER_SHEET), b2 = /* @__PURE__ */ new Set();
    if (c && c.getSheets().forEach((m3) => {
      b2.add(m3.getName());
    }), !JR(t, b2)) {
      this._injector.get(yt).warn(r.t("sheets-table.tableNameError"));
      return;
    }
    const d = {
      unitId: this.getId(),
      name: t,
      subUnitId: e,
      range: n,
      options: a,
      id: i
    };
    if (await this._commandService.executeCommand(Dn.id, d))
      return (v = o.getTableList(this.getId()).find((m3) => m3.name === t)) == null ? void 0 : v.id;
  }
  async removeTable(e) {
    var i;
    const t = (i = this.getTableInfo(e)) == null ? void 0 : i.subUnitId;
    if (!t)
      return false;
    const n = {
      unitId: this.getId(),
      subUnitId: t,
      tableId: e
    };
    return this._commandService.executeCommand(xn2.id, n);
  }
  getTableInfoByName(e) {
    return this.getTableList().find((n) => n.name === e);
  }
  setTableFilter(e, t, n) {
    const i = {
      unitId: this.getId(),
      tableId: e,
      column: t,
      tableFilter: n
    };
    return this._commandService.executeCommand(On.id, i);
  }
};
C.extend(V2);
var D2 = class extends S {
  addTable(e, t, n, i) {
    const a = this.getSheetId(), o = this.getWorkbook(), r = o.getUnitId(), s = this._injector.get(Fn), c = /* @__PURE__ */ new Set();
    if (o && o.getSheets().forEach((d) => {
      c.add(d.getName());
    }), !JR(e, c))
      return this._injector.get(yt).warn(s.t("sheets-table.tableNameError")), false;
    const I = {
      unitId: r,
      subUnitId: a,
      name: e,
      range: t,
      id: n,
      options: i
    };
    return this._commandService.executeCommand(Dn.id, I);
  }
  setTableFilter(e, t, n) {
    const i = {
      unitId: this.getWorkbook().getUnitId(),
      tableId: e,
      column: t,
      tableFilter: n
    };
    return this._commandService.executeCommand(On.id, i);
  }
  removeTable(e) {
    const t = {
      unitId: this._fWorkbook.getId(),
      subUnitId: this.getSheetId(),
      tableId: e
    };
    return this._commandService.executeCommand(xn2.id, t);
  }
  setTableRange(e, t) {
    const n = {
      unitId: this.getWorkbook().getUnitId(),
      tableId: e,
      updateRange: {
        newRange: t
      }
    };
    return this._commandService.executeCommand(Ln.id, n);
  }
  setTableName(e, t) {
    const n = this.getWorkbook(), i = this._injector.get(Fn), a = /* @__PURE__ */ new Set();
    if (n && n.getSheets().forEach((s) => {
      a.add(s.getName());
    }), !JR(t, a))
      return this._injector.get(yt).warn(i.t("sheets-table.tableNameError")), false;
    const r = {
      unitId: this.getWorkbook().getUnitId(),
      tableId: e,
      name: t
    };
    return this._commandService.executeCommand(Ln.id, r);
  }
  getSubTableInfos() {
    const e = this._fWorkbook.getId();
    return this._injector.get(X).getTableList(e).filter((n) => n.subUnitId === this.getSheetId());
  }
  resetFilter(e, t) {
    const n = {
      unitId: this._fWorkbook.getId(),
      tableId: e,
      column: t,
      tableFilter: void 0
    };
    return this._commandService.executeCommand(On.id, n);
  }
  getTableByCell(e, t) {
    const n = this._fWorkbook.getId(), a = this._injector.get(X).getTableList(n).filter((r) => r.subUnitId === this.getSheetId()), o = V1(e, t);
    return a.find((r) => {
      const s = r.range;
      return En.intersects(s, o);
    });
  }
  addTableTheme(e, t) {
    const n = new Ct("table-style");
    return n.fromJson(t), this._commandService.executeCommand(En2.id, {
      unitId: this._fWorkbook.getId(),
      tableId: e,
      themeStyle: n
    });
  }
};
S.extend(D2);
var A = class extends O {
  get TableColumnFilterTypeEnum() {
    return ne;
  }
  get TableConditionTypeEnum() {
    return O2;
  }
  get TableNumberCompareTypeEnum() {
    return F;
  }
  get TableStringCompareTypeEnum() {
    return V;
  }
  get TableDateCompareTypeEnum() {
    return m2;
  }
};
O.extend(A);

// node_modules/@univerjs/preset-sheets-table/lib/es/index.js
function l2() {
  return {
    plugins: [
      $e,
      ot
    ].filter((e) => !!e)
  };
}
export {
  Dn as AddSheetTableCommand,
  J as AddSheetTableMutation,
  En2 as AddTableThemeCommand,
  xn2 as DeleteSheetTableCommand,
  k as DeleteSheetTableMutation,
  Bn as RemoveTableThemeCommand,
  Un as SHEET_TABLE_CUSTOM_THEME_PREFIX,
  Ln as SetSheetTableCommand,
  On as SetSheetTableFilterCommand,
  Ce as SetSheetTableFilterMutation,
  S2 as SetSheetTableMutation,
  Hn as SheetTableInsertColCommand,
  Wn as SheetTableInsertRowCommand,
  Pn as SheetTableRemoveColCommand,
  Vn as SheetTableRemoveRowCommand,
  X as SheetTableService,
  P2 as SheetsTableButtonStateEnum,
  W as SheetsTableController,
  G2 as SheetsTableSortStateEnum,
  Ye2 as TableColumnDataTypeEnum,
  ne as TableColumnFilterTypeEnum,
  O2 as TableConditionTypeEnum,
  m2 as TableDateCompareTypeEnum,
  T as TableManager,
  F as TableNumberCompareTypeEnum,
  V as TableStringCompareTypeEnum,
  $e as UniverSheetsTablePlugin,
  l2 as UniverSheetsTablePreset,
  ot as UniverSheetsTableUIPlugin,
  as as customEmptyThemeWithBorderStyle,
  Tt as isConditionFilter,
  rs as isManualFilter,
  os as processStyleWithBorderStyle
};
//# sourceMappingURL=@univerjs_presets_preset-sheets-table.js.map
