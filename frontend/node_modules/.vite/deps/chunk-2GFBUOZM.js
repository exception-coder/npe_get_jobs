import {
  P,
  Wi,
  _r,
  ss,
  ys
} from "./chunk-I7I3GTAS.js";
import {
  En,
  Inject,
  Injector,
  Ls,
  Ms,
  Ol,
  Ve,
  fn,
  fo,
  ic,
  oo,
  qR,
  vr,
  we
} from "./chunk-RGZYGL3P.js";

// node_modules/@univerjs/sheets-sort/lib/es/index.js
var H = Object.defineProperty;
var q = (e, t, r) => t in e ? H(e, t, { enumerable: true, configurable: true, writable: true, value: r }) : e[t] = r;
var F = (e, t, r) => q(e, typeof t != "symbol" ? t + "" : t, r);
var m = ((e) => (e.DESC = "desc", e.ASC = "asc", e))(m || {});
var N = (e) => e.replace(/-/gi, "").replace(/'/gi, "");
var ne = (e, t) => {
  const r = e === null || e === "", n = t === null || t === "";
  return r && n ? 0 : r ? 1 : n ? -1 : null;
};
var oe = (e, t, r) => {
  const n = typeof e == "number", o = typeof t == "number";
  return n && o ? e < t ? r === m.ASC ? -1 : 1 : e > t ? r === m.ASC ? 1 : -1 : 0 : n ? r === m.ASC ? 1 : -1 : o ? r === m.ASC ? -1 : 1 : null;
};
var se = (e, t, r) => {
  const n = typeof e == "string", o = typeof t == "string";
  if (n && (e = N(e.toLocaleLowerCase())), o && (t = N(t.toLocaleLowerCase())), !n && !o)
    return null;
  if (n && o) {
    const s = e, i = t;
    return s < i ? r === m.ASC ? -1 : 1 : s > i ? r === m.ASC ? 1 : -1 : 0;
  }
  return n ? r === m.ASC ? 1 : -1 : o ? r === m.ASC ? -1 : 1 : null;
};
var T = (e) => !e || Object.keys(e).length === 0 || (e == null ? void 0 : e.v) == null && (e == null ? void 0 : e.p) == null;
var ie = Object.getOwnPropertyDescriptor;
var ue = (e, t, r, n) => {
  for (var o = n > 1 ? void 0 : n ? ie(t, r) : t, s = e.length - 1, i; s >= 0; s--)
    (i = e[s]) && (o = i(o) || o);
  return o;
};
var S = (e, t) => (r, n) => t(r, n, e);
var g = class extends Ve {
  constructor(t, r, n) {
    super();
    F(this, "_compareFns", []);
    this._univerInstanceService = t, this._commandService = r, this._formulaDataModel = n;
  }
  mergeCheck(t) {
    var l;
    const { unitId: r, subUnitId: n, range: o } = t, s = (l = this._univerInstanceService.getUnit(r)) == null ? void 0 : l.getSheetBySheetId(n);
    if (!s)
      return false;
    const i = s.getMergeData().filter((u) => En.contains(o, u));
    return i.length === 0 ? true : le(o, i);
  }
  emptyCheck(t) {
    var i;
    const { unitId: r, subUnitId: n, range: o } = t, s = (i = this._univerInstanceService.getUnit(r)) == null ? void 0 : i.getSheetBySheetId(n);
    if (!s)
      return false;
    for (let l = o.startRow; l <= o.endRow; l++)
      for (let u = o.startColumn; u <= o.endColumn; u++)
        if (!T(s.getCellRaw(l, u)))
          return true;
    return false;
  }
  singleCheck(t) {
    return t.range.startRow !== t.range.endRow;
  }
  formulaCheck(t) {
    var i, l;
    const { unitId: r, subUnitId: n, range: o } = t, s = (l = (i = this._formulaDataModel.getArrayFormulaRange()) == null ? void 0 : i[r]) == null ? void 0 : l[n];
    for (const u in s) {
      const a = s[Number(u)];
      for (const f in a) {
        const d = a[Number(f)];
        if (d && En.intersects(o, d))
          return false;
      }
    }
    return true;
  }
  registerCompareFn(t) {
    this._compareFns.unshift(t);
  }
  getAllCompareFns() {
    return this._compareFns;
  }
  applySort(t, r, n) {
    var i;
    const { unitId: o, subUnitId: s } = P(this._univerInstanceService) || {};
    this._commandService.executeCommand(M.id, {
      orderRules: t.orderRules,
      range: t.range,
      hasTitle: (i = t.hasTitle) != null ? i : false,
      unitId: r || o,
      subUnitId: n || s
    });
  }
};
g = ue([
  S(0, vr),
  S(1, Ls),
  S(2, Inject(_r))
], g);
function le(e, t) {
  const r = e.endRow - e.startRow + 1, n = e.endColumn - e.startColumn + 1;
  let o = null, s = null;
  const i = r * n;
  let l = 0;
  for (const u of t)
    if (u.startRow >= e.startRow && u.endRow <= e.endRow && u.startColumn >= e.startColumn && u.endColumn <= e.endColumn) {
      const a = u.endRow - u.startRow + 1, f = u.endColumn - u.startColumn + 1;
      if (o === null && s === null)
        o = a, s = f;
      else if (a !== o || f !== s)
        return false;
      l += a * f;
    }
  return l === i;
}
var M = {
  id: "sheet.command.sort-range",
  type: Ms.COMMAND,
  handler: (e, t) => {
    const { range: r, orderRules: n, hasTitle: o, unitId: s, subUnitId: i } = t, l = e.get(g), u = e.get(vr), { worksheet: a } = P(u, t) || {};
    if (!a)
      return false;
    const f = a.getMergeData().filter((c) => En.contains(r, c)), d = f.map((c) => c.startRow), { startRow: I, endRow: $ } = r, j = o ? I + 1 : I, _ = [], b = [];
    for (let c = j; c <= $; c++)
      a.getRowFiltered(c) || a.getRowRawVisible(c) !== false && (f.length && !d.includes(c) || (_.push({
        index: c,
        value: ce(a, c, n)
      }), b.push(c)));
    const V = l.getAllCompareFns();
    _.sort(me(n, ae(V)));
    const A = {};
    _.forEach(({ index: c, value: Re }, B) => {
      A[b[B]] = c;
    });
    const L = {
      id: ys.id,
      params: {
        unitId: s,
        subUnitId: i,
        range: r,
        order: A
      }
    }, G = e.get(Ls);
    return fo([L], G).result;
  }
};
function ce(e, t, r) {
  const n = [];
  return r.forEach(({ colIndex: o }) => {
    n.push(e.getCellRaw(t, o));
  }), n;
}
function ae(e) {
  return (t, r, n) => {
    for (let o = 0; o < e.length; o++) {
      const s = e[o](t, r, n);
      if (s != null)
        return s;
    }
    return 0;
  };
}
function me(e, t) {
  return function(r, n) {
    let o = null;
    for (let s = 0; s < e.length; s++) {
      const i = r.value[s], l = n.value[s];
      if (o = t(e[s].type, i, l), o !== 0 && o !== null && o !== void 0)
        return o;
    }
    return 0;
  };
}
var fe = "sheets-sort.config";
var D = {};
var ge = Object.getOwnPropertyDescriptor;
var de = (e, t, r, n) => {
  for (var o = n > 1 ? void 0 : n ? ge(t, r) : t, s = e.length - 1, i; s >= 0; s--)
    (i = e[s]) && (o = i(o) || o);
  return o;
};
var E = (e, t) => (r, n) => t(r, n, e);
var v = class extends Ve {
  constructor(e, t) {
    super(), this._commandService = e, this._sortService = t, this._initCommands(), this._registerCompareFns();
  }
  _initCommands() {
    [
      M
    ].forEach((e) => this.disposeWithMe(this._commandService.registerCommand(e)));
  }
  _registerCompareFns() {
    const e = (t, r, n) => {
      const o = this._getCommonValue(r), s = this._getCommonValue(n), i = [
        ne,
        se,
        oe
      ];
      for (let l = 0; l < i.length; l++) {
        const u = i[l](o, s, t);
        if (u !== null)
          return u;
      }
      return null;
    };
    this._sortService.registerCompareFn(e);
  }
  _getCommonValue(e) {
    var r, n;
    if (T(e))
      return null;
    const t = (n = (r = e == null ? void 0 : e.p) == null ? void 0 : r.body) == null ? void 0 : n.dataStream;
    return t || ((e == null ? void 0 : e.t) === fn.NUMBER ? Number.parseFloat(`${e.v}`) : (e == null ? void 0 : e.t) === fn.STRING ? typeof e.v == "number" ? e.v : `${e.v}` : (e == null ? void 0 : e.t) === fn.BOOLEAN ? `${e.v}` : (e == null ? void 0 : e.t) === fn.FORCE_STRING ? Number.parseFloat(`${e.v}`) : `${e == null ? void 0 : e.v}`);
  }
};
v = de([
  E(0, Ls),
  E(1, Inject(g))
], v);
var he = Object.defineProperty;
var ve = Object.getOwnPropertyDescriptor;
var Ce = (e, t, r) => t in e ? he(e, t, { enumerable: true, configurable: true, writable: true, value: r }) : e[t] = r;
var _e = (e, t, r, n) => {
  for (var o = n > 1 ? void 0 : n ? ve(t, r) : t, s = e.length - 1, i; s >= 0; s--)
    (i = e[s]) && (o = i(o) || o);
  return o;
};
var y = (e, t) => (r, n) => t(r, n, e);
var x = (e, t, r) => Ce(e, typeof t != "symbol" ? t + "" : t, r);
var Se = "SHEET_SORT_PLUGIN";
var C = class extends Ol {
  constructor(e = D, t, r) {
    super(), this._config = e, this._injector = t, this._configService = r;
    const { ...n } = oo(
      {},
      D,
      this._config
    );
    this._configService.setConfig(fe, n);
  }
  onStarting() {
    [
      [v],
      [g]
    ].forEach((e) => this._injector.add(e));
  }
  onReady() {
    this._injector.get(v);
  }
};
x(C, "type", we.UNIVER_SHEET);
x(C, "pluginName", Se);
C = _e([
  qR(ss, Wi),
  y(1, Inject(Injector)),
  y(2, ic)
], C);

export {
  m,
  g,
  M,
  C
};
//# sourceMappingURL=chunk-2GFBUOZM.js.map
