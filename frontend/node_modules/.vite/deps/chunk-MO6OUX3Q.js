import {
  At2 as At,
  G,
  Mt3 as Mt,
  Xs2 as Xs,
  ln2 as ln,
  qr
} from "./chunk-I7I3GTAS.js";
import {
  Inject,
  Injector,
  Jo,
  Ls,
  Ms,
  Ol,
  Ve,
  createIdentifier,
  et,
  ic,
  ng,
  oo,
  qR,
  vr,
  we
} from "./chunk-RGZYGL3P.js";

// node_modules/@univerjs/sheets-drawing/lib/es/index.js
var Y = ((e) => (e.Position = "0", e.Both = "1", e.None = "2", e))(Y || {});
var k = class extends ln {
};
var E = createIdentifier("sheets-drawing.sheet-drawing.service");
var h = ((e) => (e[e.INSERT = 0] = "INSERT", e[e.REMOVE = 1] = "REMOVE", e[e.UPDATE = 2] = "UPDATE", e[e.ARRANGE = 3] = "ARRANGE", e[e.GROUP = 4] = "GROUP", e[e.UNGROUP = 5] = "UNGROUP", e))(h || {});
var g = {
  id: "sheet.mutation.set-drawing-apply",
  type: Ms.MUTATION,
  handler: (e, i) => {
    const t = e.get(Mt), r = e.get(E), { op: n, unitId: s, subUnitId: o, type: c, objects: a } = i;
    switch (t.applyJson1(s, o, n), r.applyJson1(s, o, n), c) {
      case 0:
        t.addNotification(a), r.addNotification(a);
        break;
      case 1:
        t.removeNotification(a), r.removeNotification(a);
        break;
      case 2:
        t.updateNotification(a), r.updateNotification(a);
        break;
      case 3:
        t.orderNotification(a), r.orderNotification(a);
        break;
      case 4:
        t.groupUpdateNotification(a);
        break;
      case 5:
        t.ungroupUpdateNotification(a);
        break;
    }
    return true;
  }
};
var q = Object.getOwnPropertyDescriptor;
var z = (e, i, t, r) => {
  for (var n = r > 1 ? void 0 : r ? q(i, t) : i, s = e.length - 1, o; s >= 0; s--)
    (o = e[s]) && (n = o(n) || n);
  return n;
};
var d = (e, i) => (t, r) => i(t, r, e);
var R = "SHEET_DRAWING_PLUGIN";
var p = class extends Ve {
  constructor(e, i, t, r, n, s) {
    super(), this._sheetInterceptorService = e, this._univerInstanceService = i, this._commandService = t, this._sheetDrawingService = r, this._drawingManagerService = n, this._resourceManagerService = s, this._initSnapshot(), this._initSheetChange(), this.disposeWithMe(this._commandService.registerCommand(g));
  }
  _initSnapshot() {
    const e = (t, r) => {
      const n = r || this._sheetDrawingService.getDrawingDataForUnit(t);
      return n ? JSON.stringify(n) : "";
    }, i = (t) => {
      if (!t)
        return {};
      try {
        return JSON.parse(t);
      } catch {
        return {};
      }
    };
    this.disposeWithMe(
      this._resourceManagerService.registerPluginResource({
        pluginName: R,
        businesses: [we.UNIVER_SHEET],
        toJson: (t, r) => e(t, r),
        parseJson: (t) => i(t),
        onUnLoad: (t) => {
          this._sheetDrawingService.removeDrawingDataForUnit(t), this._drawingManagerService.removeDrawingDataForUnit(t);
        },
        onLoad: (t, r) => {
          this._sheetDrawingService.registerDrawingData(t, r), this._drawingManagerService.registerDrawingData(t, r);
        }
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _initSheetChange() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        // eslint-disable-next-line max-lines-per-function
        getMutations: (e) => {
          var i;
          if (e.id === Xs.id) {
            const t = e.params, r = t.unitId || this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET).getUnitId(), n = t.subUnitId || ((i = this._univerInstanceService.getCurrentUnitOfType(we.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : i.getSheetId());
            if (!r || !n)
              return { redos: [], undos: [] };
            const s = this._sheetDrawingService.getDrawingData(r, n), o = Object.values(s).filter((_) => _.drawingType !== ng.DRAWING_CHART);
            if (o.length === 0)
              return { redos: [], undos: [] };
            const c = this._sheetDrawingService.getBatchRemoveOp(o), { unitId: a, subUnitId: u, undo: v, redo: U, objects: S } = c;
            return {
              redos: [
                {
                  id: g.id,
                  params: {
                    op: U,
                    unitId: a,
                    subUnitId: u,
                    objects: S,
                    type: h.REMOVE
                  }
                }
              ],
              undos: [
                {
                  id: g.id,
                  params: {
                    op: v,
                    unitId: a,
                    subUnitId: u,
                    objects: S,
                    type: h.INSERT
                  }
                }
              ]
            };
          } else if (e.id === qr.id) {
            const t = e.params, { unitId: r, subUnitId: n, targetSubUnitId: s } = t;
            if (!r || !n || !s)
              return { redos: [], undos: [] };
            const o = this._sheetDrawingService.getDrawingData(r, n), c = Object.values(o).filter((m) => m.drawingType !== ng.DRAWING_CHART).map((m) => ({
              ...m,
              subUnitId: s,
              drawingId: et(6)
            }));
            if (c.length === 0)
              return { redos: [], undos: [] };
            const a = this._sheetDrawingService.getBatchAddOp(c), { unitId: u, subUnitId: v, undo: U, redo: S, objects: _ } = a;
            return {
              redos: [
                {
                  id: g.id,
                  params: {
                    op: S,
                    unitId: u,
                    subUnitId: v,
                    objects: _,
                    type: h.INSERT
                  }
                }
              ],
              undos: [
                {
                  id: g.id,
                  params: {
                    op: U,
                    unitId: u,
                    subUnitId: v,
                    objects: _,
                    type: h.REMOVE
                  }
                }
              ]
            };
          }
          return { redos: [], undos: [] };
        }
      })
    );
  }
};
p = z([
  d(0, Inject(G)),
  d(1, Inject(vr)),
  d(2, Ls),
  d(3, E),
  d(4, Mt),
  d(5, Jo)
], p);
var Q = "sheets-drawing.config";
var b = {};
var X = Object.defineProperty;
var Z = Object.getOwnPropertyDescriptor;
var y = (e, i, t) => i in e ? X(e, i, { enumerable: true, configurable: true, writable: true, value: t }) : e[i] = t;
var ee = (e, i, t, r) => {
  for (var n = r > 1 ? void 0 : r ? Z(i, t) : i, s = e.length - 1, o; s >= 0; s--)
    (o = e[s]) && (n = o(n) || n);
  return n;
};
var w = (e, i) => (t, r) => i(t, r, e);
var l = (e, i, t) => y(e, typeof i != "symbol" ? i + "" : i, t);
var f = class extends Ol {
  constructor(e = b, i, t) {
    super(), this._config = e, this._injector = i, this._configService = t;
    const { ...r } = oo(
      {},
      b,
      this._config
    );
    this._configService.setConfig(Q, r);
  }
  onStarting() {
    [
      [p],
      [E, { useClass: k }]
    ].forEach((e) => this._injector.add(e)), this._injector.get(p);
  }
};
l(f, "pluginName", R);
l(f, "type", we.UNIVER_SHEET);
f = ee([
  qR(At),
  w(1, Inject(Injector)),
  w(2, ic)
], f);

export {
  Y,
  E,
  h,
  g,
  R,
  f
};
//# sourceMappingURL=chunk-MO6OUX3Q.js.map
