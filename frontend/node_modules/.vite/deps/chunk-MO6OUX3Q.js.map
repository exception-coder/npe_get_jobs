{
  "version": 3,
  "sources": ["../../@univerjs/sheets-drawing/lib/es/index.js"],
  "sourcesContent": ["import { createIdentifier as P, CommandType as C, Inject as N, IUniverInstanceService as M, ICommandService as j, IResourceManagerService as G, Disposable as T, UniverInstanceType as I, DrawingTypeEnum as D, generateRandomId as H, DependentOn as J, Injector as V, IConfigService as W, Plugin as L, merge as F } from \"@univerjs/core\";\nimport { UnitDrawingService as x, IDrawingManagerService as O, UniverDrawingPlugin as A } from \"@univerjs/drawing\";\nimport { SheetInterceptorService as B, RemoveSheetCommand as $, CopySheetCommand as K } from \"@univerjs/sheets\";\nvar Y = /* @__PURE__ */ ((e) => (e.Position = \"0\", e.Both = \"1\", e.None = \"2\", e))(Y || {});\nclass k extends x {\n}\nconst E = P(\"sheets-drawing.sheet-drawing.service\");\nvar h = /* @__PURE__ */ ((e) => (e[e.INSERT = 0] = \"INSERT\", e[e.REMOVE = 1] = \"REMOVE\", e[e.UPDATE = 2] = \"UPDATE\", e[e.ARRANGE = 3] = \"ARRANGE\", e[e.GROUP = 4] = \"GROUP\", e[e.UNGROUP = 5] = \"UNGROUP\", e))(h || {});\nconst g = {\n  id: \"sheet.mutation.set-drawing-apply\",\n  type: C.MUTATION,\n  handler: (e, i) => {\n    const t = e.get(O), r = e.get(E), { op: n, unitId: s, subUnitId: o, type: c, objects: a } = i;\n    switch (t.applyJson1(s, o, n), r.applyJson1(s, o, n), c) {\n      case 0:\n        t.addNotification(a), r.addNotification(a);\n        break;\n      case 1:\n        t.removeNotification(a), r.removeNotification(a);\n        break;\n      case 2:\n        t.updateNotification(a), r.updateNotification(a);\n        break;\n      case 3:\n        t.orderNotification(a), r.orderNotification(a);\n        break;\n      case 4:\n        t.groupUpdateNotification(a);\n        break;\n      case 5:\n        t.ungroupUpdateNotification(a);\n        break;\n    }\n    return !0;\n  }\n};\nvar q = Object.getOwnPropertyDescriptor, z = (e, i, t, r) => {\n  for (var n = r > 1 ? void 0 : r ? q(i, t) : i, s = e.length - 1, o; s >= 0; s--)\n    (o = e[s]) && (n = o(n) || n);\n  return n;\n}, d = (e, i) => (t, r) => i(t, r, e);\nconst R = \"SHEET_DRAWING_PLUGIN\";\nlet p = class extends T {\n  constructor(e, i, t, r, n, s) {\n    super(), this._sheetInterceptorService = e, this._univerInstanceService = i, this._commandService = t, this._sheetDrawingService = r, this._drawingManagerService = n, this._resourceManagerService = s, this._initSnapshot(), this._initSheetChange(), this.disposeWithMe(this._commandService.registerCommand(g));\n  }\n  _initSnapshot() {\n    const e = (t, r) => {\n      const n = r || this._sheetDrawingService.getDrawingDataForUnit(t);\n      return n ? JSON.stringify(n) : \"\";\n    }, i = (t) => {\n      if (!t)\n        return {};\n      try {\n        return JSON.parse(t);\n      } catch {\n        return {};\n      }\n    };\n    this.disposeWithMe(\n      this._resourceManagerService.registerPluginResource({\n        pluginName: R,\n        businesses: [I.UNIVER_SHEET],\n        toJson: (t, r) => e(t, r),\n        parseJson: (t) => i(t),\n        onUnLoad: (t) => {\n          this._sheetDrawingService.removeDrawingDataForUnit(t), this._drawingManagerService.removeDrawingDataForUnit(t);\n        },\n        onLoad: (t, r) => {\n          this._sheetDrawingService.registerDrawingData(t, r), this._drawingManagerService.registerDrawingData(t, r);\n        }\n      })\n    );\n  }\n  // eslint-disable-next-line max-lines-per-function\n  _initSheetChange() {\n    this.disposeWithMe(\n      this._sheetInterceptorService.interceptCommand({\n        // eslint-disable-next-line max-lines-per-function\n        getMutations: (e) => {\n          var i;\n          if (e.id === $.id) {\n            const t = e.params, r = t.unitId || this._univerInstanceService.getCurrentUnitOfType(I.UNIVER_SHEET).getUnitId(), n = t.subUnitId || ((i = this._univerInstanceService.getCurrentUnitOfType(I.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : i.getSheetId());\n            if (!r || !n)\n              return { redos: [], undos: [] };\n            const s = this._sheetDrawingService.getDrawingData(r, n), o = Object.values(s).filter((_) => _.drawingType !== D.DRAWING_CHART);\n            if (o.length === 0)\n              return { redos: [], undos: [] };\n            const c = this._sheetDrawingService.getBatchRemoveOp(o), { unitId: a, subUnitId: u, undo: v, redo: U, objects: S } = c;\n            return {\n              redos: [\n                {\n                  id: g.id,\n                  params: {\n                    op: U,\n                    unitId: a,\n                    subUnitId: u,\n                    objects: S,\n                    type: h.REMOVE\n                  }\n                }\n              ],\n              undos: [\n                {\n                  id: g.id,\n                  params: {\n                    op: v,\n                    unitId: a,\n                    subUnitId: u,\n                    objects: S,\n                    type: h.INSERT\n                  }\n                }\n              ]\n            };\n          } else if (e.id === K.id) {\n            const t = e.params, { unitId: r, subUnitId: n, targetSubUnitId: s } = t;\n            if (!r || !n || !s)\n              return { redos: [], undos: [] };\n            const o = this._sheetDrawingService.getDrawingData(r, n), c = Object.values(o).filter((m) => m.drawingType !== D.DRAWING_CHART).map((m) => ({\n              ...m,\n              subUnitId: s,\n              drawingId: H(6)\n            }));\n            if (c.length === 0)\n              return { redos: [], undos: [] };\n            const a = this._sheetDrawingService.getBatchAddOp(c), { unitId: u, subUnitId: v, undo: U, redo: S, objects: _ } = a;\n            return {\n              redos: [\n                {\n                  id: g.id,\n                  params: {\n                    op: S,\n                    unitId: u,\n                    subUnitId: v,\n                    objects: _,\n                    type: h.INSERT\n                  }\n                }\n              ],\n              undos: [\n                {\n                  id: g.id,\n                  params: {\n                    op: U,\n                    unitId: u,\n                    subUnitId: v,\n                    objects: _,\n                    type: h.REMOVE\n                  }\n                }\n              ]\n            };\n          }\n          return { redos: [], undos: [] };\n        }\n      })\n    );\n  }\n};\np = z([\n  d(0, N(B)),\n  d(1, N(M)),\n  d(2, j),\n  d(3, E),\n  d(4, O),\n  d(5, G)\n], p);\nconst Q = \"sheets-drawing.config\", b = {};\nvar X = Object.defineProperty, Z = Object.getOwnPropertyDescriptor, y = (e, i, t) => i in e ? X(e, i, { enumerable: !0, configurable: !0, writable: !0, value: t }) : e[i] = t, ee = (e, i, t, r) => {\n  for (var n = r > 1 ? void 0 : r ? Z(i, t) : i, s = e.length - 1, o; s >= 0; s--)\n    (o = e[s]) && (n = o(n) || n);\n  return n;\n}, w = (e, i) => (t, r) => i(t, r, e), l = (e, i, t) => y(e, typeof i != \"symbol\" ? i + \"\" : i, t);\nlet f = class extends L {\n  constructor(e = b, i, t) {\n    super(), this._config = e, this._injector = i, this._configService = t;\n    const { ...r } = F(\n      {},\n      b,\n      this._config\n    );\n    this._configService.setConfig(Q, r);\n  }\n  onStarting() {\n    [\n      [p],\n      [E, { useClass: k }]\n    ].forEach((e) => this._injector.add(e)), this._injector.get(p);\n  }\n};\nl(f, \"pluginName\", R);\nl(f, \"type\", I.UNIVER_SHEET);\nf = ee([\n  J(A),\n  w(1, N(V)),\n  w(2, W)\n], f);\nexport {\n  h as DrawingApplyType,\n  E as ISheetDrawingService,\n  R as SHEET_DRAWING_PLUGIN,\n  g as SetDrawingApplyMutation,\n  Y as SheetDrawingAnchorType,\n  f as UniverSheetsDrawingPlugin\n};\n"],
  "mappings": "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",
  "names": []
}
