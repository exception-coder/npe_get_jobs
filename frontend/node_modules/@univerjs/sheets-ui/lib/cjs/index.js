"use strict";var cd=Object.defineProperty;var dd=(n,o,e)=>o in n?cd(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e;var E=(n,o,e)=>dd(n,typeof o!="symbol"?o+"":o,e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const J=require("@univerjs/docs-ui"),a=require("@univerjs/core"),m=require("@univerjs/sheets"),T=require("@univerjs/engine-render"),O=require("rxjs"),I=require("@univerjs/ui"),W=require("react"),ve=require("@univerjs/docs"),G=require("@univerjs/engine-formula"),b=require("react/jsx-runtime"),F=require("@univerjs/design"),de=require("rxjs/operators"),ud=require("@univerjs/telemetry");function To(n,o){if(n==null)return;const e=o.getRenderById(n);if(e==null)return;const{mainComponent:t,scene:r,engine:i,components:s}=e,l=t,c=s.get(J.DOCS_VIEW_KEY.BACKGROUND);return{document:l,docBackground:c,scene:r,engine:i}}const Ri=[10,400],ji="RANGE_SELECTOR_COMPONENT_KEY",yo="EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY";var ue=(n=>(n.MAIN="__SpreadsheetRender__",n.ROW="__SpreadsheetRowHeader__",n.COLUMN="__SpreadsheetColumnHeader__",n.LEFT_TOP="__SpreadsheetLeftTopPlaceholder__",n))(ue||{});const Ms=0,Qr=1,ht=10,hd=11,Ps=12,cr={id:"sheet.command.set-row-header-width",type:a.CommandType.COMMAND,handler:async(n,o)=>{if(!o)return!1;const e=n.get(T.IRenderManagerService);if(!e)return!1;const{unitId:t,subUnitId:r,size:i}=o,s=e.getRenderById(t);if(s){e.getRenderById(t).with(exports.SheetSkeletonManagerService).setRowHeaderSize(s,r,i);const{components:c}=s,d=c.get(ue.ROW);d&&d.setCustomHeader({headerStyle:{size:i}},r)}return!0}},dr={id:"sheet.command.set-col-header-height",type:a.CommandType.COMMAND,handler:async(n,o)=>{if(!o)return!1;const e=n.get(T.IRenderManagerService);if(!e)return!1;const{unitId:t,subUnitId:r,size:i}=o,s=e.getRenderById(t);if(s){e.getRenderById(t).with(exports.SheetSkeletonManagerService).setColumnHeaderSize(s,r,i);const{components:c}=s,d=c.get(ue.COLUMN);d&&d.setCustomHeader({headerStyle:{size:i}},r)}return!0}},wi=a.createInterceptorKey("rangeMovePermissionCheck"),Ei=a.createInterceptorKey("rangeFillPermissionCheck");var zi=(n=>(n[n.FORMULA_EDITOR_SHOW=100]="FORMULA_EDITOR_SHOW",n[n.MARK_SELECTION=1e4]="MARK_SELECTION",n))(zi||{});function mt(n){const o=n.getColorFromTheme("primary.600"),e=n.getColorFromTheme("white"),t=new a.ColorKit(o).setAlpha(.07).toRgbString();return{strokeWidth:1,stroke:o,fill:t,widgets:{},widgetSize:6,widgetStrokeWidth:1,widgetStroke:e,autofillSize:6,autofillStrokeWidth:1,autofillStroke:e,rowHeaderFill:t,rowHeaderStroke:o,rowHeaderStrokeWidth:1,columnHeaderFill:t,columnHeaderStroke:o,columnHeaderStrokeWidth:1,expandCornerSize:40}}class md{constructor(){E(this,"_startColumn",-1);E(this,"_startRow",-1);E(this,"_endColumn",-1);E(this,"_endRow",-1);E(this,"_startX",0);E(this,"_startY",0);E(this,"_endX",0);E(this,"_endY",0);E(this,"_primary");E(this,"_rangeType",a.RANGE_TYPE.NORMAL)}get startColumn(){return this._startColumn}get startRow(){return this._startRow}get endColumn(){return this._endColumn}get endRow(){return this._endRow}get startX(){return this._startX}get startY(){return this._startY}get endX(){return this._endX}get endY(){return this._endY}get currentCell(){return this._primary}get rangeType(){return this._rangeType}isEqual(o){const{startColumn:e,startRow:t,endColumn:r,endRow:i}=this,{startColumn:s,startRow:l,endColumn:c,endRow:d}=o;return e===s&&t===l&&r===c&&i===d}highlightToSelection(){if(this._primary)return a.convertCellToRange(this._primary)}getRange(){return{startColumn:this._startColumn,startRow:this._startRow,endColumn:this._endColumn,endRow:this._endRow,startX:this._startX,startY:this._startY,endX:this._endX,endY:this._endY,rangeType:this.rangeType}}getCell(){return this._primary}getRangeType(){return this._rangeType}setRangeType(o){this._rangeType=o}getValue(){return{rangeWithCoord:this.getRange(),primaryWithCoord:this._primary}}setValue(o,e){const{startColumn:t,startRow:r,endColumn:i,endRow:s,startX:l,startY:c,endX:d,endY:u,rangeType:h}=o;this._startColumn=t,this._startRow=r,this._endColumn=i,this._endRow=s,this._startX=l,this._startY=c,this._endX=d,this._endY=u,h!==void 0&&(this._rangeType=h),e!==void 0&&this.setCurrentCell(e)}setCurrentCell(o){this._primary=o}clearCurrentCell(){this._primary=null}}function un(n,o){const{startRow:e,startColumn:t,endRow:r,endColumn:i,rangeType:s}=o,l=r<e?r:e,c=r<e?e:r,d=i<t?i:t,u=i<t?t:i,h=n.getNoMergeCellWithCoordByIndex(l,d),g=n.getNoMergeCellWithCoordByIndex(c,u);return{startRow:e,startColumn:t,endRow:r,endColumn:i,rangeType:s,startY:(h==null?void 0:h.startY)||0,endY:(g==null?void 0:g.endY)||0,startX:(h==null?void 0:h.startX)||0,endX:(g==null?void 0:g.endX)||0}}function ye(n,o){const{range:e,primary:t,style:r}=n,i=un(o,e),s=t&&nr(o,t);return{rangeWithCoord:i,primaryWithCoord:s,style:r}}function nr(n,o){const{actualRow:e,actualColumn:t,isMerged:r,isMergedMainCell:i,startRow:s,startColumn:l,endRow:c,endColumn:d}=o,u=n.getNoMergeCellWithCoordByIndex(e,t),h=n.getNoMergeCellWithCoordByIndex(s,l),g=n.getNoMergeCellWithCoordByIndex(c,d);return{actualRow:e,actualColumn:t,isMerged:r,isMergedMainCell:i,startX:u.startX,startY:u.startY,endX:u.endX,endY:u.endY,mergeInfo:{startRow:s,startColumn:l,endRow:c,endColumn:d,startY:(h==null?void 0:h.startY)||0,endY:(g==null?void 0:g.endY)||0,startX:(h==null?void 0:h.startX)||0,endX:(g==null?void 0:g.endX)||0}}}const xs="__SpreadsheetHelperSelectionTempRect",gd=35;class Da{constructor(o,e){E(this,"_startOffsetX",0);E(this,"_startOffsetY",0);E(this,"_relativeSelectionPositionRow",0);E(this,"_relativeSelectionPositionColumn",0);E(this,"_relativeSelectionRowLength",0);E(this,"_relativeSelectionColumnLength",0);E(this,"_scenePointerMoveSub");E(this,"_scenePointerUpSub");E(this,"_disabled",!1);E(this,"_helperSelection");E(this,"_scrollTimer");E(this,"_activeViewport");E(this,"_targetSelection",{startY:0,endY:0,startX:0,endX:0,startRow:-1,endRow:-1,startColumn:-1,endColumn:-1});E(this,"_isInMergeState",!1);E(this,"_fillControlColors",[]);E(this,"_skeleton");E(this,"_scene");E(this,"_themeService");E(this,"_injector");E(this,"_selectionHooks");this._control=o,this._skeleton=e.skeleton,this._scene=e.scene,this._themeService=e.themeService,this._injector=e.injector,this._selectionHooks=e.selectionHooks,this._initialControl(),this._initialWidget(),this._initialAutoFill(),this._control.dispose$.subscribe(()=>{this.dispose()})}get isHelperSelection(){return this._control.isHelperSelection}dispose(){var o,e;(o=this._scrollTimer)==null||o.dispose(),this._fillControlColors=[],this._clearObserverEvent(),(e=this._helperSelection)==null||e.dispose()}setDisabled(o){this._disabled=o}_getFreeze(){var e,t;return(t=(e=T.withCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,exports.SheetSkeletonManagerService,this._injector.get(a.IUniverInstanceService),this._injector.get(T.IRenderManagerService)))==null?void 0:e.getCurrentParam())==null?void 0:t.skeleton.getWorksheetConfig().freeze}_isSelectionInViewport(o,e){const t=this._getFreeze()||{startRow:-1,startColumn:-1};switch(e.viewportKey){case T.SHEET_VIEWPORT_KEY.VIEW_MAIN:return o.endRow>=t.startRow&&o.endColumn>=t.startColumn;case T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP:case T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT:return o.endColumn>=t.startColumn&&o.startRow<t.startRow;case T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT:case T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM:return o.endRow>=t.startRow&&o.startColumn<t.startColumn;case T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP:case T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT:case T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP:case T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP:return o.startRow<t.startRow&&o.startColumn<t.startColumn}}_clearObserverEvent(){var o,e;(o=this._scenePointerMoveSub)==null||o.unsubscribe(),(e=this._scenePointerUpSub)==null||e.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null}_initialControl(){const{leftControl:o,rightControl:e,topControl:t,bottomControl:r}=this._control;[o,e,t,r].forEach(i=>{i.onPointerEnter$.subscribeEvent(()=>{var l;((l=this._injector.get(Ce,a.Quantity.OPTIONAL))==null?void 0:l.interceptor.fetchThroughInterceptors(wi)(!1,null))!==!1&&i.setCursor(T.CURSOR_TYPE.MOVE)}),i.onPointerLeave$.subscribeEvent(()=>{i.resetCursor()}),i.onPointerDown$.subscribeEvent(this._controlPointerDownHandler.bind(this))})}_controlMoving(o,e){var A;const t=this._scene,r=t.getScrollXYInfoByViewport(T.Vector2.FromArray([o,e])),{scaleX:i,scaleY:s}=t.getAncestorScale(),l=this._skeleton.getCellIndexByOffset(o,e,i,s,r),{row:c,column:d}=l,u=this._skeleton.getRowCount()-1,h=this._skeleton.getColumnCount()-1;let g=Math.max(0,c+this._relativeSelectionPositionRow),S=g+this._relativeSelectionRowLength;S>u&&(S=u,S-g<this._relativeSelectionRowLength&&(g=S-this._relativeSelectionRowLength));let p=Math.max(0,d+this._relativeSelectionPositionColumn),f=p+this._relativeSelectionColumnLength;f>h&&(f=h,f-p<this._relativeSelectionColumnLength&&(p=f-this._relativeSelectionColumnLength));const v=this._skeleton.worksheet.getCellInfoInMergeData(g,p),_=ye({range:{startRow:g,endRow:S,startColumn:p,endColumn:f},primary:v,style:null},this._skeleton),R=this._skeleton.getNoMergeCellWithCoordByIndex(g,p),w=this._skeleton.getNoMergeCellWithCoordByIndex(S,f),P=(R==null?void 0:R.startY)||0,y=(w==null?void 0:w.endY)||0,M=(R==null?void 0:R.startX)||0,x=(w==null?void 0:w.endX)||0;(A=this._helperSelection)==null||A.transformByState({left:M,top:P,width:x-M,height:y-P}),this._targetSelection={..._.rangeWithCoord},this._control.selectionMoving$.next(_.rangeWithCoord)}_controlPointerDownHandler(o){const{offsetX:e,offsetY:t}=o,r=this._scene,i=r.getCoordRelativeToViewport(T.Vector2.FromArray([e,t])),{x:s,y:l}=i,c=r.getScrollXYInfoByViewport(i),{scaleX:d,scaleY:u}=r.getAncestorScale(),h=this._skeleton.getCellIndexByOffset(s,l,d,u,c);this._startOffsetX=s,this._startOffsetY=l;const{row:g,column:S}=h,{startRow:p,startColumn:f,endRow:v,endColumn:C}=this._control.model;let _=0,R=0;g<p?_-=1:g>v&&(_+=1),S<f?R-=1:S>C&&(R+=1),this._relativeSelectionPositionRow=p-g+_,this._relativeSelectionPositionColumn=f-S+R,this._relativeSelectionRowLength=v-p,this._relativeSelectionColumnLength=C-f;const w=this._control.currentStyle,P=this._getScale();this.isHelperSelection&&(this._helperSelection=new T.Rect(xs,{stroke:w.stroke,strokeWidth:w.strokeWidth/P}),r.addObject(this._helperSelection));const y=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),M=T.ScrollTimer.create(r);this._scrollTimer=M,M.startScroll(s,l,y),r.disableObjectsEvent(),this._scenePointerMoveSub=r.onPointerMove$.subscribeEvent(x=>{var k;if(this._disabled)return;const{offsetX:A,offsetY:D}=x;if(((k=this._injector.get(Ce,a.Quantity.OPTIONAL))==null?void 0:k.interceptor.fetchThroughInterceptors(wi)(!1,null))===!1)return;const{x:V,y:H}=r.getCoordRelativeToViewport(T.Vector2.FromArray([A,D]));this._controlMoving(V,H),r.setCursor(T.CURSOR_TYPE.MOVE),M.scrolling(V,H,()=>{this._controlMoving(V,H)})}),this._scenePointerUpSub=r.onPointerUp$.subscribeEvent(()=>{var A,D,N,V;(A=this._helperSelection)==null||A.dispose();const x=this._scene;x.resetCursor(),this._clearObserverEvent(),x.enableObjectsEvent(),(D=this._scrollTimer)==null||D.dispose(),this._control.selectionMoveEnd$.next(this._targetSelection),(V=(N=this._selectionHooks).selectionMoveEnd)==null||V.call(N)})}_initialWidget(){const{topLeftWidget:o,topCenterWidget:e,topRightWidget:t,middleLeftWidget:r,middleRightWidget:i,bottomLeftWidget:s,bottomCenterWidget:l,bottomRightWidget:c}=this._control,d=[T.CURSOR_TYPE.NORTH_WEST_RESIZE,T.CURSOR_TYPE.NORTH_RESIZE,T.CURSOR_TYPE.NORTH_EAST_RESIZE,T.CURSOR_TYPE.WEST_RESIZE,T.CURSOR_TYPE.EAST_RESIZE,T.CURSOR_TYPE.SOUTH_WEST_RESIZE,T.CURSOR_TYPE.SOUTH_RESIZE,T.CURSOR_TYPE.SOUTH_EAST_RESIZE];[o,e,t,r,i,s,l,c].forEach((u,h)=>{u.onPointerEnter$.subscribeEvent(()=>{u.setCursor(d[h])}),u.onPointerLeave$.subscribeEvent(()=>{u.resetCursor()}),u.onPointerDown$.subscribeEvent(g=>{this._widgetPointerDownEvent(g,d[h])})})}_widgetPointerDownEvent(o,e){const t=this._scene,{offsetX:r,offsetY:i}=o,s=t.getCoordRelativeToViewport(T.Vector2.FromArray([r,i])),{x:l,y:c}=s;this._startOffsetX=r,this._startOffsetY=i;const{startRow:d,startColumn:u,endRow:h,endColumn:g}=this._control.model,S=Math.min(d,h),p=Math.min(u,g),f=Math.max(d,h),v=Math.max(u,g);this._relativeSelectionPositionRow=S,this._relativeSelectionPositionColumn=p,this._relativeSelectionRowLength=f-S,this._relativeSelectionColumnLength=v-p,e===T.CURSOR_TYPE.NORTH_WEST_RESIZE?(this._relativeSelectionPositionRow=f,this._relativeSelectionPositionColumn=v):e===T.CURSOR_TYPE.NORTH_RESIZE?this._relativeSelectionPositionRow=f:e===T.CURSOR_TYPE.NORTH_EAST_RESIZE?this._relativeSelectionPositionRow=f:e===T.CURSOR_TYPE.WEST_RESIZE?this._relativeSelectionPositionColumn=v:e===T.CURSOR_TYPE.SOUTH_WEST_RESIZE?this._relativeSelectionPositionColumn=v:e===T.CURSOR_TYPE.SOUTH_RESIZE&&(this._relativeSelectionPositionRow=S);const C=T.ScrollTimer.create(t),_=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);C.startScroll(l,c,_),this._scrollTimer=C,t.disableObjectsEvent(),this._scenePointerMoveSub=t.onPointerMove$.subscribeEvent(R=>{const{offsetX:w,offsetY:P}=R,{x:y,y:M}=t.getCoordRelativeToViewport(T.Vector2.FromArray([w,P]));this._widgetMoving(y,M,e),t.setCursor(e),C.scrolling(y,M,()=>{this._widgetMoving(y,M,e)})}),this._scenePointerUpSub=t.onPointerUp$.subscribeEvent(()=>{var w,P,y;const R=this._scene;R.resetCursor(),this._clearObserverEvent(),R.enableObjectsEvent(),(w=this._scrollTimer)==null||w.dispose(),this._control.selectionScaled$.next(this._targetSelection),(y=(P=this._selectionHooks).selectionMoveEnd)==null||y.call(P)})}_widgetMoving(o,e,t){const r=this._scene,i=r.getScrollXYInfoByViewport(T.Vector2.FromArray([this._startOffsetX,this._startOffsetY])),{scaleX:s,scaleY:l}=r.getAncestorScale(),c=this._skeleton.getCellIndexByOffset(o,e,s,l,i),{row:d,column:u}=c;let h=this._relativeSelectionPositionRow,g=this._relativeSelectionPositionColumn,S=d,p=u;t===T.CURSOR_TYPE.NORTH_WEST_RESIZE?(h=d,g=u,S=this._relativeSelectionPositionRow,p=this._relativeSelectionPositionColumn):t===T.CURSOR_TYPE.NORTH_RESIZE?(h=d,g=this._relativeSelectionPositionColumn,S=this._relativeSelectionPositionRow,p=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength):t===T.CURSOR_TYPE.NORTH_EAST_RESIZE?(h=d,g=this._relativeSelectionPositionColumn,S=this._relativeSelectionPositionRow,p=u):t===T.CURSOR_TYPE.WEST_RESIZE?(h=this._relativeSelectionPositionRow,g=u,S=this._relativeSelectionPositionRow+this._relativeSelectionRowLength,p=this._relativeSelectionPositionColumn):t===T.CURSOR_TYPE.EAST_RESIZE?S=this._relativeSelectionPositionRow+this._relativeSelectionRowLength:t===T.CURSOR_TYPE.SOUTH_WEST_RESIZE?(h=this._relativeSelectionPositionRow,g=u,S=d,p=this._relativeSelectionPositionColumn):t===T.CURSOR_TYPE.SOUTH_RESIZE&&(h=this._relativeSelectionPositionRow,g=this._relativeSelectionPositionColumn,S=d,p=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength);const f=this._swapPositions(h,g,S,p),v=this._skeleton.getCellWithMergeInfoByIndex(h,g),_=ye({range:f,primary:v,style:null},this._skeleton);this._targetSelection={..._.rangeWithCoord},this._control.updateRangeBySelectionWithCoord(_),this._control.selectionScaling$.next(this._targetSelection)}_initialAutoFill(){const{fillControl:o}=this._control;o.onPointerEnter$.subscribeEvent(e=>{this._injector.get(Ce).interceptor.fetchThroughInterceptors(Ei)(!1,{x:e.offsetX,y:e.offsetY,skeleton:this._skeleton,scene:this._scene})&&o.setCursor(T.CURSOR_TYPE.CROSSHAIR)}),o.onPointerLeave$.subscribeEvent(()=>{o.resetCursor()}),o.onPointerDown$.subscribeEvent(this._autoFillForPointerdown.bind(this))}_autoFillMoving(o,e){var D,N,V;const t=this._scene,r=t.getViewportScrollXY(this._activeViewport),{scaleX:i,scaleY:s}=t.getAncestorScale(),l=this._skeleton.getCellIndexByOffset(o,e,i,s,r),{row:c,column:d}=l,u=t.getCoordRelativeToViewport(T.Vector2.FromArray([o,e])),h=this._skeleton.getRowCount()-1,g=this._skeleton.getColumnCount()-1;let S=this._relativeSelectionPositionRow,p=this._relativeSelectionPositionColumn,f=this._relativeSelectionPositionRow+this._relativeSelectionRowLength,v=this._relativeSelectionPositionColumn+this._relativeSelectionColumnLength,C=!1,_=!0;if((d<p||d>v)&&c>=S&&c<=f){const H=this._fillRuler(d,p,v,this._relativeSelectionColumnLength,g);p=H.startRowOrColumn,v=H.endRowOrColumn,C=H.isLighten,_=!1}else if((c<S||c>f)&&d>=p&&d<=v){const H=this._fillRuler(c,S,f,this._relativeSelectionRowLength,h);S=H.startRowOrColumn,f=H.endRowOrColumn,C=H.isLighten}else if(Math.abs(this._startOffsetX-u.x-r.x)/2>Math.abs(this._startOffsetY-u.y-r.y)){const H=this._fillRuler(d,p,v,this._relativeSelectionColumnLength,g);p=H.startRowOrColumn,v=H.endRowOrColumn,C=H.isLighten,_=!1}else{const H=this._fillRuler(c,S,f,this._relativeSelectionRowLength,h);S=H.startRowOrColumn,f=H.endRowOrColumn,C=H.isLighten}const R=this._skeleton.getNoMergeCellWithCoordByIndex(S,p),w=this._skeleton.getNoMergeCellWithCoordByIndex(f,v),P=(R==null?void 0:R.startY)||0,y=(w==null?void 0:w.endY)||0,M=(R==null?void 0:R.startX)||0,x=(w==null?void 0:w.endX)||0;C?this._controlHandler((H,k)=>{const U=new a.ColorKit(this._fillControlColors[k]).lighten(gd).toRgbString();H.setProps({fill:U})}):this._controlHandler((H,k)=>{H.setProps({fill:this._fillControlColors[k]})});const A=m.SELECTION_CONTROL_BORDER_BUFFER_WIDTH/this._getScale();S===f&&_===!0||p===v&&_===!1?(D=this._helperSelection)==null||D.hide():((N=this._helperSelection)==null||N.transformByState({left:M-A/2,top:P-A/2,width:x-M,height:y-P}),(V=this._helperSelection)==null||V.show()),this._targetSelection={startY:P,endY:y,startX:M,endX:x,startRow:S,endRow:f,startColumn:p,endColumn:v},this._control.selectionFilling$.next(this._targetSelection)}_autoFillForPointerdown(o){const{offsetX:e,offsetY:t}=o,r=this._scene,i=r.getCoordRelativeToViewport(T.Vector2.FromArray([e,t])),{x:s,y:l}=i;this._startOffsetX=s,this._startOffsetY=l;const{startRow:c,startColumn:d,endRow:u,endColumn:h}=this._control.model;this._isInMergeState=this._hasMergeInRange(c,d,u,h),this._relativeSelectionPositionRow=c,this._relativeSelectionPositionColumn=d,this._relativeSelectionRowLength=u-c,this._relativeSelectionColumnLength=h-d;const g=this._control.currentStyle;let S=g==null?void 0:g.stroke,p=g==null?void 0:g.strokeWidth;const f=mt(this._themeService);S==null&&(S=f.stroke),p==null&&(p=f.strokeWidth);const v=this._getScale();p/=v;const C=m.SELECTION_CONTROL_BORDER_BUFFER_WIDTH/v,_=new a.ColorKit(S).darken(2).toRgbString();this.isHelperSelection&&(this._helperSelection=new T.Rect(xs,{stroke:_,strokeWidth:p+C/2}),r.addObject(this._helperSelection)),this._activeViewport=r.getActiveViewportByCoord(T.Vector2.FromArray([e,t]));const R=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),w=T.ScrollTimer.create(r,this._activeViewport.viewportKey===T.SHEET_VIEWPORT_KEY.VIEW_MAIN?T.ScrollTimerType.ALL:T.ScrollTimerType.NONE);w.startScroll(s,l,R),this._scrollTimer=w,r.disableObjectsEvent(),this._controlHandler(P=>{this._fillControlColors.push(P.fill)}),this._scenePointerMoveSub=r.onPointerMove$.subscribeEvent(P=>{var H;const{offsetX:y,offsetY:M}=P,x=r.getActiveViewportByCoord(T.Vector2.FromArray([y,M]));if(!this._injector.get(Ce).interceptor.fetchThroughInterceptors(Ei)(!1,{x:o.offsetX,y:o.offsetY,skeleton:this._skeleton,scene:this._scene}))return;const{x:D,y:N}=r.getCoordRelativeToViewport(T.Vector2.FromArray([y,M]));this._autoFillMoving(D,N),r.setCursor(T.CURSOR_TYPE.CROSSHAIR);const V=this._targetSelection;if(R&&x&&((H=this._activeViewport)==null?void 0:H.viewportKey)!==(x==null?void 0:x.viewportKey)){let k;V.startRow!==c?(w.scrollTimerType=T.ScrollTimerType.Y,k={...V,endRow:V.startRow}):V.endRow!==u?(w.scrollTimerType=T.ScrollTimerType.Y,k={...V,startRow:V.endRow}):V.startColumn!==d?(w.scrollTimerType=T.ScrollTimerType.X,k={...V,endColumn:V.startColumn}):(w.scrollTimerType=T.ScrollTimerType.X,k={...V,startColumn:V.endColumn}),this._isSelectionInViewport(k,x)&&(this._viewportMainScrollBarNeedResetPosition(w.scrollTimerType,this._activeViewport.viewportKey,x.viewportKey)&&R.scrollToBarPos({x:w.scrollTimerType===T.ScrollTimerType.X?0:void 0,y:w.scrollTimerType===T.ScrollTimerType.Y?0:void 0}),this._activeViewport=x)}w.scrolling(D,N,()=>{this._autoFillMoving(D,N)})}),this._scenePointerUpSub=r.onPointerUp$.subscribeEvent(()=>{var y,M;(y=this._helperSelection)==null||y.dispose();const P=this._scene;P.resetCursor(),this._clearObserverEvent(),P.enableObjectsEvent(),(M=this._scrollTimer)==null||M.dispose(),this._control.refreshSelectionFilled(this._targetSelection),this._isInMergeState=!1,this._controlHandler((x,A)=>{x.setProps({fill:this._fillControlColors[A]})}),this._fillControlColors=[]})}_viewportMainScrollBarNeedResetPosition(o,e,t){return o===T.ScrollTimerType.X&&(e===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT||e===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP)&&(t===T.SHEET_VIEWPORT_KEY.VIEW_MAIN||t===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP)||o===T.ScrollTimerType.Y&&(e===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP||e===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP)&&(t===T.SHEET_VIEWPORT_KEY.VIEW_MAIN||t===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT)}_hasMergeInRange(o,e,t,r){return this._skeleton.worksheet.getMergedCellRange(o,e,t,r).length>0}_swapPositions(o,e,t,r){const i=Math.min(o,t),s=Math.min(e,r),l=Math.max(o,t),c=Math.max(e,r);return{startRow:i,startColumn:s,endRow:l,endColumn:c}}_controlHandler(o){const{leftControl:e,rightControl:t,topControl:r,bottomControl:i,backgroundControlTop:s,backgroundControlMiddleLeft:l,backgroundControlMiddleRight:c,backgroundControlBottom:d,fillControl:u}=this._control,h=[e,t,r,i,s,l,c,d,u];for(let g=0,S=h.length;g<S;g++){const p=h[g];o(p,g)}}_fillRuler(o,e,t,r,i){let s=!1;if(o<e)if(this._isInMergeState&&o<e){const l=e-o,c=r+1,d=Math.ceil(l/c);let u=e-d*c;u<0&&(u=e-(d-1)*c),e=u}else e=o;else if(o>=e&&o<=t)s=!0,this._isInMergeState||(t=o);else if(this._isInMergeState&&o>t){const l=o-t,c=r+1,d=Math.ceil(l/c);let u=t+d*c;u>i&&(u=t+(d-1)*c),t=u}else t=o;return{rowOrColumn:o,startRowOrColumn:e,endRowOrColumn:t,isLighten:s}}_getScale(){const{scaleX:o,scaleY:e}=this._scene.getAncestorScale();return Math.max(o,e)}}var Ti=(n=>(n.Selection="__SpreadsheetSelectionShape__",n.top="__SpreadsheetSelectionTopControl__",n.bottom="__SpreadsheetSelectionBottomControl__",n.left="__SpreadsheetSelectionShapeLeftControl__",n.right="__SpreadsheetSelectionShapeRightControl__",n.backgroundTop="__SpreadsheetSelectionBackgroundControlTop__",n.backgroundMiddleLeft="__SpreadsheetSelectionBackgroundControlMiddleLeft__",n.backgroundMiddleRight="__SpreadsheetSelectionBackgroundControlMiddleRight__",n.backgroundBottom="__SpreadsheetSelectionBackgroundControlBottom__",n.fill="__SpreadsheetSelectionFillControl__",n.fillTopLeft="__SpreadsheetSelectionFillControlTopLeft__",n.fillBottomRight="__SpreadsheetSelectionFillControlBottomRight__",n.fillTopLeftInner="__SpreadsheetSelectionFillControlTopLeftInner__",n.fillBottomRightInner="__SpreadsheetSelectionFillControlBottomRightInner__",n.lineMain="__SpreadsheetDragLineMainControl__",n.lineContent="__SpreadsheetDragLineContentControl__",n.line="__SpreadsheetDragLineControl__",n.dash="__SpreadsheetDragDashControl__",n.rowHeaderBackground="__SpreadSheetSelectionRowHeaderBackground__",n.rowHeaderBorder="__SpreadSheetSelectionRowHeaderBorder__",n.rowHeaderGroup="__SpreadSheetSelectionRowHeaderGroup__",n.columnHeaderBackground="__SpreadSheetSelectionColumnHeaderBackground__",n.columnHeaderBorder="__SpreadSheetSelectionColumnHeaderBorder__",n.columnHeaderGroup="__SpreadSheetSelectionColumnHeaderGroup__",n.topLeftWidget="__SpreadSheetSelectionTopLeftWidget__",n.topCenterWidget="__SpreadSheetSelectionTopCenterWidget__",n.topRightWidget="__SpreadSheetSelectionTopRightWidget__",n.middleLeftWidget="__SpreadSheetSelectionMiddleLeftWidget__",n.middleRightWidget="__SpreadSheetSelectionMiddleRightWidget__",n.bottomLeftWidget="__SpreadSheetSelectionBottomLeftWidget__",n.bottomCenterWidget="__SpreadSheetSelectionBottomCenterWidget__",n.bottomRightWidget="__SpreadSheetSelectionBottomRightWidget__",n))(Ti||{});const Os=.3;class ur extends a.Disposable{constructor(e,t,r,i){var s,l,c,d;super();E(this,"_isHelperSelection",!0);E(this,"_enableAutoFill",!0);E(this,"_showAutoFill",!1);E(this,"_highlightHeader",!0);E(this,"_selectionRenderModel");E(this,"_leftBorder");E(this,"_rightBorder");E(this,"_topBorder");E(this,"_bottomBorder");E(this,"_backgroundControlTop");E(this,"_backgroundControlBottom");E(this,"_backgroundControlMiddleLeft");E(this,"_backgroundControlMiddleRight");E(this,"_autoFillControl");E(this,"_selectionShapeGroup");E(this,"_rowHeaderBackground");E(this,"_rowHeaderBorder");E(this,"_rowHeaderGroup");E(this,"_columnHeaderBackground");E(this,"_columnHeaderBorder");E(this,"_columnHeaderGroup");E(this,"_dashedRect");E(this,"_topLeftWidget");E(this,"_topCenterWidget");E(this,"_topRightWidget");E(this,"_middleLeftWidget");E(this,"_middleRightWidget");E(this,"_bottomLeftWidget");E(this,"_bottomCenterWidget");E(this,"_bottomRightWidget");E(this,"_defaultStyle");E(this,"_currentStyle");E(this,"_rowHeaderWidth",0);E(this,"_columnHeaderHeight",0);E(this,"_widgetRects",[]);E(this,"_controlExtension");E(this,"_dispose$",new O.BehaviorSubject(this));E(this,"dispose$",this._dispose$.asObservable());E(this,"selectionMoving$",new O.Subject);E(this,"selectionMoveEnd$",new O.Subject);E(this,"selectionScaling$",new O.Subject);E(this,"selectionScaled$",new O.Subject);E(this,"selectionFilling$",new O.Subject);E(this,"_selectionFilled$",new O.Subject);E(this,"selectionFilled$",this._selectionFilled$.asObservable());E(this,"_antLineOffset",0);E(this,"_antRequestNewFrame",-1);this._scene=e,this._zIndex=t,this._themeService=r,this._enableAutoFill=(s=i==null?void 0:i.enableAutoFill)!=null?s:!0,this._highlightHeader=(l=i==null?void 0:i.highlightHeader)!=null?l:!0,this._rowHeaderWidth=(c=i==null?void 0:i.rowHeaderWidth)!=null?c:0,this._columnHeaderHeight=(d=i==null?void 0:i.columnHeaderHeight)!=null?d:0,this._initializeSheetBody(),this._initialHeader()}_initializeSheetBody(){this._defaultStyle=mt(this._themeService),this._currentStyle=mt(this._themeService),this._selectionRenderModel=new md;const e=this._zIndex;this._leftBorder=new T.Rect("__SpreadsheetSelectionShapeLeftControl__"+e,{zIndex:e}),this._rightBorder=new T.Rect("__SpreadsheetSelectionShapeRightControl__"+e,{zIndex:e}),this._topBorder=new T.Rect("__SpreadsheetSelectionTopControl__"+e,{zIndex:e}),this._bottomBorder=new T.Rect("__SpreadsheetSelectionBottomControl__"+e,{zIndex:e}),this._backgroundControlTop=new T.Rect("__SpreadsheetSelectionBackgroundControlTop__"+e,{zIndex:e-1,evented:!1}),this._backgroundControlBottom=new T.Rect("__SpreadsheetSelectionBackgroundControlBottom__"+e,{zIndex:e-1,evented:!1}),this._backgroundControlMiddleLeft=new T.Rect("__SpreadsheetSelectionBackgroundControlMiddleLeft__"+e,{zIndex:e-1,evented:!1}),this._backgroundControlMiddleRight=new T.Rect("__SpreadsheetSelectionBackgroundControlMiddleRight__"+e,{zIndex:e-1,evented:!1}),this._autoFillControl=new T.Rect("__SpreadsheetSelectionFillControl__"+e,{zIndex:e+1}),this._autoFillControl.hide(),this._dashedRect=new T.DashedRect("__SpreadsheetDragDashControl__"+e,{zIndex:e+2,evented:!1,stroke:"#fff"});const t=[this._autoFillControl,this._leftBorder,this._rightBorder,this._topBorder,this._bottomBorder,this._backgroundControlTop,this._backgroundControlMiddleLeft,this._backgroundControlMiddleRight,this._backgroundControlBottom,this._dashedRect];this._widgetRects=this._initialWidget(),this._selectionShapeGroup=new T.Group("__SpreadsheetSelectionShape__"+e,...t,...this._widgetRects),this._selectionShapeGroup.hide(),this._selectionShapeGroup.evented=!1,this._selectionShapeGroup.zIndex=e;const r=this.getScene();r.addObject(this._selectionShapeGroup,Qr),this.disposeWithMe(a.toDisposable(r.onTransformChange$.subscribeEvent(i=>{i.type===T.TRANSFORM_CHANGE_OBSERVABLE_TYPE.scale&&(this._updateLayoutOfSelectionControl(this._currentStyle),this._updateControlCoord())})))}_initialHeader(){const e=this._zIndex;this._rowHeaderBackground=new T.Rect("__SpreadSheetSelectionRowHeaderBackground__"+e,{zIndex:e-1,evented:!1}),this._rowHeaderBorder=new T.Rect("__SpreadSheetSelectionRowHeaderBorder__"+e,{zIndex:e-1,evented:!1}),this._rowHeaderGroup=new T.Group("__SpreadSheetSelectionRowHeaderGroup__"+e,this._rowHeaderBackground,this._rowHeaderBorder),this._rowHeaderGroup.hide(),this._rowHeaderGroup.evented=!1,this._rowHeaderGroup.zIndex=e,this._columnHeaderBackground=new T.Rect("__SpreadSheetSelectionColumnHeaderBackground__"+e,{zIndex:e-1,evented:!1}),this._columnHeaderBorder=new T.Rect("__SpreadSheetSelectionColumnHeaderBorder__"+e,{zIndex:e-1,evented:!1}),this._columnHeaderGroup=new T.Group("__SpreadSheetSelectionColumnHeaderGroup__"+e,this._columnHeaderBackground,this._columnHeaderBorder),this._columnHeaderGroup.hide(),this._columnHeaderGroup.evented=!1,this._columnHeaderGroup.zIndex=e,this.getScene().addObjects([this._rowHeaderGroup,this._columnHeaderGroup],hd)}_initialWidget(){const e=this._zIndex;return this._topLeftWidget=new T.Rect("__SpreadSheetSelectionTopLeftWidget__"+e,{zIndex:e+1}),this._topCenterWidget=new T.Rect("__SpreadSheetSelectionTopCenterWidget__"+e,{zIndex:e+1}),this._topRightWidget=new T.Rect("__SpreadSheetSelectionTopRightWidget__"+e,{zIndex:e+1}),this._middleLeftWidget=new T.Rect("__SpreadSheetSelectionMiddleLeftWidget__"+e,{zIndex:e+1}),this._middleRightWidget=new T.Rect("__SpreadSheetSelectionMiddleRightWidget__"+e,{zIndex:e+1}),this._bottomLeftWidget=new T.Rect("__SpreadSheetSelectionBottomLeftWidget__"+e,{zIndex:e+1}),this._bottomCenterWidget=new T.Rect("__SpreadSheetSelectionBottomCenterWidget__"+e,{zIndex:e+1}),this._bottomRightWidget=new T.Rect("__SpreadSheetSelectionBottomRightWidget__"+e,{zIndex:e+1}),[this._topLeftWidget,this._topCenterWidget,this._topRightWidget,this._middleLeftWidget,this._middleRightWidget,this._bottomLeftWidget,this._bottomCenterWidget,this._bottomRightWidget]}get zIndex(){return this._zIndex}get leftControl(){return this._leftBorder}get rightControl(){return this._rightBorder}get topControl(){return this._topBorder}get bottomControl(){return this._bottomBorder}get fillControl(){return this._autoFillControl}get backgroundControlTop(){return this._backgroundControlTop}get backgroundControlBottom(){return this._backgroundControlBottom}get backgroundControlMiddleLeft(){return this._backgroundControlMiddleLeft}get backgroundControlMiddleRight(){return this._backgroundControlMiddleRight}get selectionShape(){return this._selectionShapeGroup}get columnHeaderGroup(){return this._columnHeaderGroup}get rowHeaderGroup(){return this._rowHeaderGroup}get selectionShapeGroup(){return this._selectionShapeGroup}get model(){return this._selectionRenderModel}get topLeftWidget(){return this._topLeftWidget}get topCenterWidget(){return this._topCenterWidget}get topRightWidget(){return this._topRightWidget}get middleLeftWidget(){return this._middleLeftWidget}get middleRightWidget(){return this._middleRightWidget}get bottomLeftWidget(){return this._bottomLeftWidget}get bottomCenterWidget(){return this._bottomCenterWidget}get bottomRightWidget(){return this._bottomRightWidget}get themeService(){return this._themeService}get selectionModel(){return this._selectionRenderModel}set selectionModel(e){this._selectionRenderModel=e}get currentStyle(){return this._currentStyle}set currentStyle(e){this._currentStyle=e}get dashedRect(){return this._dashedRect}get isHelperSelection(){return this._isHelperSelection}get rowHeaderWidth(){return this._rowHeaderWidth}set rowHeaderWidth(e){this._rowHeaderWidth=e}get columnHeaderHeight(){return this._columnHeaderHeight}set columnHeaderHeight(e){this._columnHeaderHeight=e}setControlExtension(e){this._controlExtension=new Da(this,e)}setControlExtensionDisable(e){this._controlExtension&&this._controlExtension.setDisabled(e)}setEvent(e){this.leftControl.evented=e,this.rightControl.evented=e,this.topControl.evented=e,this.bottomControl.evented=e}refreshSelectionFilled(e){this._selectionFilled$.next(e)}_updateLayoutOfSelectionControl(e){e&&(this.currentStyle=Object.assign({},this._defaultStyle,e));const t=this.currentStyle,{stroke:r,widgets:i,autofillStroke:s,strokeDash:l,isAnimationDash:c}=t;let d=t.autofillSize,u=t.strokeWidth,h=t.autofillStrokeWidth;const g=this._getScale(),S=(u+m.SELECTION_CONTROL_BORDER_BUFFER_WIDTH)/2/g;u/=g,d/=g,h/=g<1?1:g;const p=m.SELECTION_CONTROL_BORDER_BUFFER_WIDTH/g,f=T.FIX_ONE_PIXEL_BLUR_OFFSET/g,{startX:v,startY:C,endX:_,endY:R}=this._selectionRenderModel;if(this.leftControl.transformByState({height:R-C,left:-S+f,width:u,strokeWidth:p,top:-p/2+f}),this.leftControl.setProps({fill:r,stroke:m.SELECTION_CONTROL_BORDER_BUFFER_COLOR}),this.rightControl.transformByState({height:R-C,left:_-v-S+f,width:u,strokeWidth:p,top:-p/2+f}),this.rightControl.setProps({fill:r,stroke:m.SELECTION_CONTROL_BORDER_BUFFER_COLOR}),this.topControl.transformByState({width:_-v+u,top:-S+f,left:-S+f,height:u,strokeWidth:p}),this.topControl.setProps({fill:r,stroke:m.SELECTION_CONTROL_BORDER_BUFFER_COLOR}),this.bottomControl.transformByState({width:_-v+u,top:R-C-S+f,height:u,left:-S+f,strokeWidth:p}),this.bottomControl.setProps({fill:r,stroke:m.SELECTION_CONTROL_BORDER_BUFFER_COLOR}),l==null)this.dashedRect.hide(),this._stopAntLineAnimation();else{const w=t.strokeWidth*2/g;this.dashedRect.transformByState({height:R-C,width:_-v,strokeWidth:w,left:-w/2+f,top:-w/2+f}),this.dashedRect.setProps({strokeDashArray:[0,l/g]}),this._stopAntLineAnimation(),c!==!1&&this._startAntLineAnimation(),this.dashedRect.show()}if(this._showAutoFill=this._showAutoFill&&this._enableAutoFill,this._showAutoFill&&!this._hasWidgets(i)){const w={fill:r,stroke:s,strokeScaleEnabled:!1},P={width:d-h,height:d-h,left:_-v-d/2+h/2-f,top:R-C-d/2+h/2-f,strokeWidth:h};this._autoFillControl.setProps(w),this._autoFillControl.transformByState(P),this._autoFillControl.show()}else this._autoFillControl.hide();this._updateBackgroundControl(t),this._updateHeaderBackground(t),this._updateWidgets(t)}_updateControlCoord(){const{startX:e,startY:t}=this._selectionRenderModel;this.selectionShapeGroup.show(),this.selectionShapeGroup.translate(e,t),this.selectionShapeGroup.makeDirtyNoDebounce(!0)}updateStyle(e){this._updateLayoutOfSelectionControl(e),this._updateControlCoord()}updateRange(e,t){this._selectionRenderModel.setValue(e,t),this._showAutoFill=t!==null,this._updateLayoutOfSelectionControl(),this._updateControlCoord()}updateRangeBySelectionWithCoord(e,t){t&&(this._rowHeaderWidth=t.rowHeaderWidth,this._columnHeaderHeight=t.columnHeaderHeight),this._selectionRenderModel.setValue(e.rangeWithCoord,e.primaryWithCoord),this._showAutoFill=e.primaryWithCoord!==null,this._updateLayoutOfSelectionControl(e.style),this._updateControlCoord()}update(e,t=0,r=0,i,s){this._rowHeaderWidth=t,this._columnHeaderHeight=r,this.updateRangeBySelectionWithCoord({rangeWithCoord:e,primaryWithCoord:s,style:i}),i&&this.updateStyle(i)}updateCurrCell(e){this._showAutoFill=e!==null,this._selectionRenderModel.setCurrentCell(e)}clearHighlight(){this._showAutoFill=!1,this._selectionRenderModel.clearCurrentCell(),this._updateLayoutOfSelectionControl(this._currentStyle)}getScene(){return this._scene}dispose(){var e,t,r,i,s,l,c,d,u,h,g,S,p,f,v,C,_,R,w,P,y,M,x,A,D;(e=this._leftBorder)==null||e.dispose(),(t=this._rightBorder)==null||t.dispose(),(r=this._topBorder)==null||r.dispose(),(i=this._bottomBorder)==null||i.dispose(),(s=this._backgroundControlTop)==null||s.dispose(),(l=this._backgroundControlMiddleLeft)==null||l.dispose(),(c=this._backgroundControlMiddleRight)==null||c.dispose(),(d=this._backgroundControlBottom)==null||d.dispose(),this._autoFillControl.dispose(),(u=this._selectionShapeGroup)==null||u.dispose(),(h=this._rowHeaderBackground)==null||h.dispose(),(g=this._rowHeaderBorder)==null||g.dispose(),(S=this._rowHeaderGroup)==null||S.dispose(),(p=this._rowHeaderBackground)==null||p.dispose(),(f=this._columnHeaderBackground)==null||f.dispose(),(v=this._columnHeaderBorder)==null||v.dispose(),(C=this._columnHeaderGroup)==null||C.dispose(),(_=this._topLeftWidget)==null||_.dispose(),(R=this._topCenterWidget)==null||R.dispose(),(w=this._topRightWidget)==null||w.dispose(),(P=this._middleLeftWidget)==null||P.dispose(),(y=this._middleRightWidget)==null||y.dispose(),(M=this._bottomLeftWidget)==null||M.dispose(),(x=this._bottomCenterWidget)==null||x.dispose(),(A=this._bottomRightWidget)==null||A.dispose(),(D=this._controlExtension)==null||D.dispose(),super.dispose(),this._dispose$.next(this),this._dispose$.complete()}getCurrentCellInfo(){const e=this.model.currentCell;if(e){let t;if(e.isMerged){const r=e.mergeInfo;t={startRow:r.startRow,endRow:r.endRow,startColumn:r.startColumn,endColumn:r.endColumn,startX:r.startX,endX:r.endX,startY:r.startY,endY:r.endY}}else{const{actualRow:r,actualColumn:i,startX:s,endX:l,startY:c,endY:d}=e;t={startRow:r,endRow:r,startColumn:i,endColumn:i,startX:s,endX:l,startY:c,endY:d}}return t}}getValue(){return{...this._selectionRenderModel.getValue(),style:this._currentStyle}}getRange(){return this._selectionRenderModel.getValue().rangeWithCoord}enableHelperSelection(){this._isHelperSelection=!0}disableHelperSelection(){this._isHelperSelection=!1}_updateHeaderBackground(e){const{startX:t,startY:r,endX:i,endY:s,rangeType:l}=this._selectionRenderModel,c=this._currentStyle,d=this._getScale(),{stroke:u,rowHeaderFill:h=c.rowHeaderFill,rowHeaderStroke:g=c.rowHeaderStroke,columnHeaderFill:S=c.columnHeaderFill,columnHeaderStroke:p=c.columnHeaderStroke}=e;let{rowHeaderStrokeWidth:f=c.rowHeaderStrokeWidth,columnHeaderStrokeWidth:v=c.columnHeaderStrokeWidth}=e;f/=d,v/=d;const C=this._rowHeaderWidth,_=this._columnHeaderHeight;if(this._highlightHeader&&_>0){let R=S;l===a.RANGE_TYPE.COLUMN&&(R=new a.ColorKit(u).setAlpha(Os).toString()),this._columnHeaderBackground.setProps({fill:R}),this._columnHeaderBackground.resize(i-t,_),this._columnHeaderBorder.setProps({fill:p}),this._columnHeaderBorder.transformByState({width:i-t,height:v,top:_-v+1/d}),this._columnHeaderGroup.show(),this._columnHeaderGroup.translate(t,0)}else this._columnHeaderGroup.hide();if(this._columnHeaderGroup.makeDirty(!0),this._highlightHeader&&C>0){let R=h;l===a.RANGE_TYPE.ROW&&(R=new a.ColorKit(u).setAlpha(Os).toString()),this._rowHeaderBackground.setProps({fill:R}),this._rowHeaderBackground.resize(C,s-r),this._rowHeaderBorder.setProps({fill:g}),this._rowHeaderBorder.transformByState({width:f,height:s-r,left:C-f+1/d}),this._rowHeaderGroup.show(),this._rowHeaderGroup.translate(0,r)}else this._rowHeaderGroup.hide();this._rowHeaderGroup.makeDirty(!0)}_updateBackgroundControl(e){const{startX:t,startY:r,endX:i,endY:s}=this._selectionRenderModel,l=this._getScale(),{fill:c=e.fill}=e;let{strokeWidth:d}=e;d/=l;const u=this._selectionRenderModel.highlightToSelection();if(!u){this._backgroundControlTop.resize(i-t,s-r),this._backgroundControlTop.setProps({fill:c}),this._backgroundControlBottom.resize(0,0),this._backgroundControlMiddleLeft.resize(0,0),this._backgroundControlMiddleRight.resize(0,0);return}const{startX:h,startY:g,endX:S,endY:p}=u,f=d/2,v={left:-f,top:-f,width:i-t+f*2,height:g-r+f};v.height<0&&(v.width=0,v.height=0),this._backgroundControlTop.transformByState(v);const C={left:-f,top:g-r,width:h-t+f,height:p-g};C.width<0&&(C.width=0,C.height=0),this._backgroundControlMiddleLeft.transformByState(C);const _={left:S-t-f,top:g-r,width:i-S+f*2,height:p-g};_.width<0&&(_.width=0,_.height=0),this._backgroundControlMiddleRight.transformByState(_);const R={left:-f,top:p-r,width:i-t+f*2,height:s-p+f};R.height<0&&(R.width=0,R.height=0),this._backgroundControlBottom.transformByState(R),this._backgroundControlTop.setProps({fill:c}),this._backgroundControlMiddleLeft.setProps({fill:c}),this._backgroundControlMiddleRight.setProps({fill:c}),this._backgroundControlBottom.setProps({fill:c})}_updateWidgets(e){const{startX:t,startY:r,endX:i,endY:s}=this._selectionRenderModel,{stroke:l=e.stroke,widgets:c=e.widgets,widgetStroke:d=e.widgetStroke}=e,u=this._getScale();let{widgetSize:h,widgetStrokeWidth:g}=e;h/=u,g/=u;const S={left:-h/2+g/2,center:(i-t)/2-h/2+g/2,right:i-t-h/2+g/2,top:-h/2,middle:(s-r)/2-h/2,bottom:s-r-h/2+g/2},p=h-g;this._widgetRects.forEach(f=>{f.setProps({fill:l,stroke:d})}),c.tl===!0?(this._topLeftWidget.transformByState({height:p,width:p,left:S.left,top:S.top,strokeWidth:g}),this._topLeftWidget.show()):this._topLeftWidget.hide(),c.tc===!0?(this._topCenterWidget.transformByState({height:p,width:p,left:S.center,top:S.top,strokeWidth:g}),this._topCenterWidget.show()):this._topCenterWidget.hide(),c.tr===!0?(this._topRightWidget.transformByState({height:p,width:p,left:S.right,top:S.top,strokeWidth:g}),this._topRightWidget.show()):this._topRightWidget.hide(),c.ml===!0?(this._middleLeftWidget.transformByState({height:p,width:p,left:S.left,top:S.middle,strokeWidth:g}),this._middleLeftWidget.show()):this._middleLeftWidget.hide(),c.mr===!0?(this._middleRightWidget.transformByState({height:p,width:p,left:S.right,top:S.middle,strokeWidth:g}),this._middleRightWidget.show()):this._middleRightWidget.hide(),c.bl===!0?(this._bottomLeftWidget.transformByState({height:p,width:p,left:S.left,top:S.bottom,strokeWidth:g}),this._bottomLeftWidget.show()):this._bottomLeftWidget.hide(),c.bc===!0?(this._bottomCenterWidget.transformByState({height:p,width:p,left:S.center,top:S.bottom,strokeWidth:g}),this._bottomCenterWidget.show()):this._bottomCenterWidget.hide(),c.br===!0?(this._bottomRightWidget.transformByState({height:p,width:p,left:S.right,top:S.bottom,strokeWidth:g}),this._bottomRightWidget.show()):this._bottomRightWidget.hide()}_hasWidgets(e){if(e==null)return!1;const t=Object.keys(e);if(t.length===0)return!1;for(const r of t)if(e[r]===!0)return!0;return!1}_getScale(){const{scaleX:e,scaleY:t}=this._scene.getAncestorScale();return Math.max(e,t)}_stopAntLineAnimation(){this._antLineOffset=0,T.cancelRequestFrame(this._antRequestNewFrame)}_startAntLineAnimation(){const e=this._getScale();this._antLineOffset+=.6/e,this._antLineOffset>160/e&&(this._antLineOffset=0),this.dashedRect.setProps({strokeDashOffset:-this._antLineOffset}),this._antRequestNewFrame=T.requestNewFrame(()=>{this._startAntLineAnimation()})}}class Sd extends T.Layer{render(o,e=!1){const t=a.Tools.now();return super.render(o,e),this._afterRender(t),this}_afterRender(o){this.scene.getEngine().renderFrameTimeMetric$.next(["selectionLayer",a.Tools.now()-o])}}const Ce=a.createIdentifier("univer.sheet.selection-render-service");class Xi extends a.Disposable{constructor(e,t,r,i,s){super();E(this,"_downObserver");E(this,"_scenePointerMoveSub");E(this,"_scenePointerUpSub");E(this,"_controlFillConfig$",new O.BehaviorSubject(null));E(this,"controlFillConfig$",this._controlFillConfig$.asObservable());E(this,"_selectionControls",[]);E(this,"_startRangeWhenPointerDown",{startY:0,endY:0,startX:0,endX:0,startRow:-1,endRow:-1,startColumn:-1,endColumn:-1});E(this,"_activeControlIndex",-1);E(this,"_startViewportPosX",0);E(this,"_startViewportPosY",0);E(this,"_scrollTimer");E(this,"_cancelDownSubscription");E(this,"_cancelUpSubscription");E(this,"_skeleton");E(this,"_scene");E(this,"_highlightHeader",!0);E(this,"_rangeType",a.RANGE_TYPE.NORMAL);E(this,"_selectionStyle");E(this,"_remainLastEnabled",!1);E(this,"_skipLastEnabled",!1);E(this,"_singleSelectionEnabled",!1);E(this,"_selectionMoveEnd$",new O.BehaviorSubject([]));E(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable());E(this,"_selectionMoving$",new O.Subject);E(this,"selectionMoving$",this._selectionMoving$.asObservable());E(this,"_selectionMoveStart$",new O.Subject);E(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable());E(this,"_selectionMoving",!1);E(this,"_selectionTheme");E(this,"_activeViewport");E(this,"interceptor",new a.InterceptorManager({RANGE_MOVE_PERMISSION_CHECK:wi,RANGE_FILL_PERMISSION_CHECK:Ei}));E(this,"_escapeShortcutDisposable",null);this._injector=e,this._themeService=t,this._shortcutService=r,this._sheetSkeletonManagerService=i,this.contextService=s,this._initSelectionThemeFromThemeService(),this._initMoving()}get selectionMoving(){return this._selectionMoving}get _shouldDetectMergedCells(){return this._rangeType===a.RANGE_TYPE.NORMAL}_initMoving(){this.disposeWithMe(this._selectionMoving$.subscribe(()=>{this._selectionMoving=!0})),this.disposeWithMe(this._selectionMoveEnd$.subscribe(()=>{this._selectionMoving=!1}))}_setSelectionStyle(e){this._selectionStyle=e}getViewPort(){return this._activeViewport}setSingleSelectionEnabled(e=!1){this._singleSelectionEnabled=e}newSelectionControl(e,t,r){const i=this.getSelectionControls().length,{rowHeaderWidth:s,columnHeaderHeight:l}=t,c=new ur(e,i,this._selectionTheme,{highlightHeader:this._highlightHeader,rowHeaderWidth:s,columnHeaderHeight:l});this._selectionControls.push(c);const d=ye(r,t);return c.updateRangeBySelectionWithCoord(d,t),c.setControlExtension({skeleton:t,scene:e,themeService:this._selectionTheme,injector:this._injector,selectionHooks:{selectionMoveEnd:()=>{this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}}}),c}resetSelectionsByModelData(e){const t=this.getSelectionControls(),r=this._skeleton;if(!(!t||!r)){for(let i=0,s=e.length;i<s;i++){const l=e[i],c=ye(l,this._skeleton),d=t[i];d?d.updateRangeBySelectionWithCoord(c,r):this.isSelectionEnabled()&&this.newSelectionControl(this._scene,r,l)}e.length<t.length&&t.splice(e.length).forEach(s=>s.dispose())}}refreshSelectionMoveStart(){this._selectionMoveStart$.next(this.getSelectionDataWithStyle())}refreshSelectionMoveEnd(){this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}_initSelectionThemeFromThemeService(){const e=this._themeService.getCurrentTheme();this._selectionTheme=new a.ThemeService,this._selectionTheme.setTheme(e)}setSelectionTheme(e){this._selectionTheme.setTheme(e)}_changeRuntime(e,t,r){this._skeleton=e,this._scene=t,this._activeViewport=r||(t==null?void 0:t.getViewports()[0]),t.findLayerByZIndex(Qr)||t.addLayer(new Sd(t,[],Qr))}getSkeleton(){return this._skeleton}getSelectionDataWithStyle(){const e=this._selectionControls;if(this._skeleton.worksheet){const[t,r]=this._skeleton.getLocation();return e.map(i=>{const s=i.getValue();return s.rangeWithCoord.sheetId=r,s.rangeWithCoord.unitId=t,s})}return[]}getSelectionControls(){return this._selectionControls}_addSelectionControlByModelData(e){var l;const t=this._skeleton,r=(l=e.style)!=null?l:mt(this._selectionTheme),i=this._scene;return e.style=r,this.newSelectionControl(i,t,e)}_clearAllSelectionControls(){const e=this._selectionControls;for(const t of e)t.dispose();this._selectionControls.length=0}_getFreeze(){var t;return(t=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:t.skeleton.getWorksheetConfig().freeze}_getViewportByCell(e,t){if(e===void 0||t===void 0)return null;const r=this._getFreeze();if(!r||r.startRow<=0&&r.startColumn<=0)return this._scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(e>r.startRow&&t>r.startColumn)return this._scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(e<=r.startRow&&t<=r.startColumn)return this._scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP);if(e<=r.startRow&&t>r.startColumn)return this._scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP);if(e>r.startRow&&t<=r.startColumn)return this._scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT)}getActiveRange(){const e=this.getSelectionControls(),t=e&&e[e.length-1].model;return t&&{startRow:t.startRow,startColumn:t.startColumn,endRow:t.endRow,endColumn:t.endColumn}}setActiveSelectionIndex(e){this._activeControlIndex=e}resetActiveSelectionIndex(){this._activeControlIndex=-1}getActiveSelectionControl(){const e=this.getSelectionControls();if(e)return this._activeControlIndex<0?e[e.length-1]:e[this._activeControlIndex]}endSelection(){var e;this._clearUpdatingListeners(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),(e=this._escapeShortcutDisposable)==null||e.dispose(),this._escapeShortcutDisposable=null}_reset(){var e;this._clearAllSelectionControls(),(e=this._downObserver)==null||e.unsubscribe(),this._downObserver=null}_setupPointerMoveListener(e,t,r,i=T.ScrollTimerType.ALL,s,l){var p,f;let c=0,d=0,u=s,h=l;this._scrollTimer=T.ScrollTimer.create(this._scene,i),this._scrollTimer.startScroll((p=e==null?void 0:e.left)!=null?p:0,(f=e==null?void 0:e.top)!=null?f:0,e);const g=this._scene,S=g.getActiveViewportByCoord(T.Vector2.FromArray([s,l]));this._scenePointerMoveSub=g.onPointerMove$.subscribeEvent(v=>{var V,H,k,U,L,j,B,z,X;const{offsetX:C,offsetY:_}=v,{x:R,y:w}=g.getCoordRelativeToViewport(T.Vector2.FromArray([C,_]));this._movingHandler(R,w,t,r);let P=R,y=w;const M=this.getActiveSelectionControl(),x=this._getFreeze(),A=M==null?void 0:M.model,D=(V=g.getActiveViewportByCoord(T.Vector2.FromArray([C,_])))!=null?V:this._getViewportByCell(A==null?void 0:A.endRow,A==null?void 0:A.endColumn);if((()=>{if(!S||!D||!e)return!1;const K=[T.SHEET_VIEWPORT_KEY.VIEW_MAIN,T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP,T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP,T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT];return K.includes(S.viewportKey)&&K.includes(D.viewportKey)})()){if(!S||!D||!e)return!1;const K=u<e.left&&R>e.left||u>e.left&&R<e.left,ie=h<e.top&&w>e.top||h>e.top&&w<e.top;K&&(c+=1),ie&&(d+=1);const re=S.viewportKey,le=D.viewportKey;if(re===T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP)_<e.top&&((H=A==null?void 0:A.endRow)!=null?H:0)<((k=x==null?void 0:x.startRow)!=null?k:0)?y=e.top:ie&&d%2===1&&e.scrollToViewportPos({viewportScrollY:0});else if(re===T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT)C<e.left&&((U=A==null?void 0:A.endColumn)!=null?U:0)<((L=x==null?void 0:x.startColumn)!=null?L:0)?P=e.left:K&&c%2===1&&e.scrollToViewportPos({viewportScrollX:0});else if(re===le){let Z=!1,Y=!1;re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP?(Z=!0,Y=!0):re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP?Y=!0:re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT&&(Z=!0),((j=A==null?void 0:A.endRow)!=null?j:0)>((B=x==null?void 0:x.startRow)!=null?B:0)&&(Y=!1),((z=A==null?void 0:A.endColumn)!=null?z:0)>((X=x==null?void 0:x.startColumn)!=null?X:0)&&(Z=!1),Z&&(P=e.left),Y&&(y=e.top)}else{const Z={x:S.scrollX,y:S.scrollY},Y={x:D.scrollX,y:D.scrollY},q=Z.x!==Y.x&&K&&c%2===1,te=Z.y!==Y.y&&ie&&d%2===1;(q||te)&&(e.scrollToBarPos({x:q?Z.x:void 0,y:te?Z.y:void 0}),q||(P=e.left),te||(y=e.top)),(re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP&&le===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT||le===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP&&re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT)&&(P=e.left),(re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP&&le===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP||le===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP&&re===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP)&&(y=e.top)}u=R,h=w}this._scrollTimer.scrolling(P,y,()=>{this._movingHandler(R,w,t,r)})})}attachSelectionWithCoord(e){return ye(e,this._skeleton)}attachPrimaryWithCoord(e){return nr(this._skeleton,e)}getSelectionCellByPosition(e,t){return this.getCellWithCoordByOffset(e,t)}getCellWithCoordByOffset(e,t,r){const i=this._scene,s=r!=null?r:this._skeleton,l=i.getViewportScrollXY(i.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN)),{scaleX:c,scaleY:d}=i.getAncestorScale();return s.getCellWithCoordByOffset(e,t,c,d,l)}_movingHandler(e,t,r,i){var P,y,M,x,A;const s=this._skeleton,l=this._scene,[c,d]=s.getLocation(),u={startRow:(P=r==null?void 0:r.model.startRow)!=null?P:-1,endRow:(y=r==null?void 0:r.model.endRow)!=null?y:-1,startColumn:(M=r==null?void 0:r.model.startColumn)!=null?M:-1,endColumn:(x=r==null?void 0:r.model.endColumn)!=null?x:-1},h=l.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),g=(A=this._getViewportByCell(u.endRow,u.endColumn))!=null?A:h,S=l.getScrollXYInfoByViewport(T.Vector2.FromArray([this._startViewportPosX,this._startViewportPosY]),g),{scaleX:p,scaleY:f}=l.getAncestorScale();i===a.RANGE_TYPE.ROW?e=Number.POSITIVE_INFINITY:i===a.RANGE_TYPE.COLUMN&&(t=Number.POSITIVE_INFINITY);const v=this._skeleton.getCellByOffset(e,t,p,f,S);if(!v)return;let C={startRow:Math.min(v.startRow,this._startRangeWhenPointerDown.startRow),startColumn:Math.min(v.startColumn,this._startRangeWhenPointerDown.startColumn),endRow:Math.max(v.endRow,this._startRangeWhenPointerDown.endRow),endColumn:Math.max(v.endColumn,this._startRangeWhenPointerDown.endColumn)};this._shouldDetectMergedCells&&(C=s.expandRangeByMerge(C));const R=ye({range:C,primary:void 0,style:null},s);R.rangeWithCoord.unitId=c,R.rangeWithCoord.sheetId=d,R.rangeWithCoord.rangeType=i;const w=u.startRow!==C.startRow||u.startColumn!==C.startColumn||u.endRow!==C.endRow||u.endColumn!==C.endColumn;r!=null&&w&&(r.updateRangeBySelectionWithCoord(R),this._selectionMoving$.next(this.getSelectionDataWithStyle()))}_clearUpdatingListeners(){var t,r,i,s,l;this._scene.enableObjectsEvent(),(t=this._scenePointerMoveSub)==null||t.unsubscribe(),this._scenePointerMoveSub=null,(r=this._scenePointerUpSub)==null||r.unsubscribe(),this._scenePointerUpSub=null,(i=this._cancelDownSubscription)==null||i.unsubscribe(),this._cancelDownSubscription=null,(s=this._cancelUpSubscription)==null||s.unsubscribe(),this._cancelUpSubscription=null,(l=this._scrollTimer)==null||l.dispose()}_addEndingListeners(){var r,i,s;const e=this._scene,t=(r=e.getEngine())==null?void 0:r.activeScene;!t||t===e||((i=this._cancelDownSubscription)==null||i.unsubscribe(),this._cancelDownSubscription=null,(s=this._cancelUpSubscription)==null||s.unsubscribe(),this._cancelUpSubscription=null,this._cancelDownSubscription=t.onPointerDown$.subscribeEvent(()=>this._clearUpdatingListeners()),this._cancelUpSubscription=t.onPointerUp$.subscribeEvent(()=>this._clearUpdatingListeners()))}_getSelectionWithCoordByOffset(e,t,r,i,s){const l=this._skeleton;if(l==null)return null;if(this._shouldDetectMergedCells){const C=l==null?void 0:l.getCellWithCoordByOffset(e,t,r,i,s,{firstMatch:!0});if(!C)return;const _=a.convertCellToRange(C);return{primaryWithCoord:C,rangeWithCoord:_}}const{row:c,column:d}=l.getCellIndexByOffset(e,t,r,i,s),u=l.getNoMergeCellWithCoordByIndex(c,d),{startX:h,startY:g,endX:S,endY:p}=u,f={startY:g,endY:p,startX:h,endX:S,startRow:c,endRow:c,startColumn:d,endColumn:d};return{primaryWithCoord:{mergeInfo:f,actualRow:c,actualColumn:d,isMerged:!1,isMergedMainCell:!1,startY:g,endY:p,startX:h,endX:S},rangeWithCoord:f}}_checkClearPreviousControls(e){this.getSelectionControls().length!==0&&(!e.ctrlKey&&!e.shiftKey&&!this._remainLastEnabled||this._singleSelectionEnabled&&!e.shiftKey)&&this._clearAllSelectionControls()}_makeSelectionByTwoCells(e,t,r,i,s){const{actualRow:l,actualColumn:c,mergeInfo:d}=e;this._startRangeWhenPointerDown={...e.mergeInfo};const u=Math.min(l,t.startRow,d.startRow),h=Math.max(l,t.endRow,d.endRow),g=Math.min(c,t.startColumn,d.startColumn),S=Math.max(c,t.endColumn,d.endColumn),f={range:r.expandRangeByMerge({startRow:u,startColumn:g,endRow:h,endColumn:S}),primary:m.convertPrimaryWithCoordToPrimary(e),style:null},v=ye(f,r);s.updateRangeBySelectionWithCoord(v)}isSelectionEnabled(){return this.contextService.getContextValue(m.SELECTIONS_ENABLED)}isSelectionDisabled(){return this.contextService.getContextValue(m.SELECTIONS_ENABLED)===!1}inRefSelectionMode(){return this.contextService.getContextValue(m.REF_SELECTIONS_ENABLED)}}function Yi(n){return{range:{startRow:0,startColumn:0,endRow:n.getRowCount()-1,endColumn:n.getColumnCount()-1,rangeType:a.RANGE_TYPE.ALL},primary:Mo(n).primary,style:null}}function Mo(n){return Na(n,{startRow:0,startColumn:0,endRow:0,endColumn:0})}function Na(n,o){const e=n.worksheet.getCellInfoInMergeData(o.startRow,o.startColumn),t=n.worksheet.getCellInfoInMergeData(o.endRow,o.endColumn);return{range:{startRow:e.startRow,startColumn:e.startColumn,endRow:t.endRow,endColumn:t.endColumn,rangeType:a.RANGE_TYPE.NORMAL},primary:{actualRow:e.startRow,actualColumn:e.startColumn,startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn,isMerged:e.isMerged,isMergedMainCell:e.isMergedMainCell},style:null}}var pd=Object.getOwnPropertyDescriptor,fd=(n,o,e,t)=>{for(var r=t>1?void 0:t?pd(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},As=(n,o)=>(e,t)=>o(e,t,n);exports.SheetSkeletonManagerService=class extends a.Disposable{constructor(e,t,r){super();E(this,"_sheetId","");E(this,"_sheetSkeletonParamStore",new Map);E(this,"_currentSkeleton$",new O.BehaviorSubject(null));E(this,"currentSkeleton$",this._currentSkeleton$.asObservable());E(this,"_currentSkeletonBefore$",new O.BehaviorSubject(null));E(this,"currentSkeletonBefore$",this._currentSkeletonBefore$.asObservable());this._context=e,this._injector=t,this._sheetSkService=r,this.disposeWithMe(()=>{this._currentSkeletonBefore$.complete(),this._currentSkeleton$.complete(),this._sheetSkeletonParamStore.forEach(i=>this.disposeSkeleton(i.sheetId)),this._sheetSkeletonParamStore.clear()}),this._initRemoveSheet()}_initRemoveSheet(){this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe(e=>{this.disposeSkeleton(e.getSheetId())}))}getCurrentSkeleton(){var e;return(e=this.getCurrentParam())==null?void 0:e.skeleton}getCurrent(){return this.getCurrentParam()}getCurrentParam(){return this._getSkeletonParam(this._sheetId)}getSkeleton(e){return this._getSkeleton(e)}getSkeletonParam(e){return this._getSkeletonParam(e)}getWorksheetSkeleton(e){return this.getSkeletonParam(e)}getUnitSkeleton(e,t){const r=this._getSkeletonParam(t);return r!=null&&(r.unitId=e),r}setCurrent(e){this._setCurrent(e.sheetId)}setSkeletonParam(e,t){this._sheetSkService.setSkeleton(t.unitId,e,t.skeleton),this._sheetSkeletonParamStore.set(e,t)}_setCurrent(e){this._sheetId=e;const t=this._getSkeletonParam(e),r=this._context.unitId;if(t!=null)this.reCalculate(t);else{const l=this._context.unit.getSheetBySheetId(e);if(l==null)return;const c=this._context.scene,d=this._buildSkeleton(l,c);this.setSkeletonParam(e,{unitId:r,sheetId:e,skeleton:d,dirty:!1})}const i=this._getSkeletonParam(e);this._currentSkeletonBefore$.next(i),this._currentSkeleton$.next(i)}reCalculate(e){e||(e=this.getCurrentParam()),e!=null&&(e.dirty&&(e.skeleton.makeDirty(!0),e.dirty=!1),e.skeleton.calculate())}makeDirty(e,t=!0){const r=this._getSkeletonParam(e.sheetId);r!=null&&(r.dirty=t)}getOrCreateSkeleton(e){return this.ensureSkeleton(e.sheetId)}ensureSkeleton(e){const t=this._getSkeletonParam(e);if(t)return t.skeleton;const i=this._context.unit.getSheetBySheetId(e);if(!i)return;const s=this._buildSkeleton(i);return this.setSkeletonParam(e,{unitId:this._context.unitId,sheetId:e,skeleton:s,dirty:!1}),s}disposeSkeleton(e){const t=this.getSkeletonParam(e);t&&(t.skeleton.dispose(),this._sheetSkeletonParamStore.delete(e),this._sheetSkService.deleteSkeleton(t.unitId,e))}attachRangeWithCoord(e){const t=this.getCurrentSkeleton();return t?un(t,e):null}_getSkeletonParam(e){return this._sheetSkeletonParamStore.get(e)}_getSkeleton(e){const t=this._getSkeletonParam(e);return t?t.skeleton:null}_buildSkeleton(e,t){return this._injector.createInstance(T.SpreadsheetSkeleton,e,this._context.unit.getStyles())}setColumnHeaderSize(e,t,r){var u;if(!e)return;const i=(u=this.getWorksheetSkeleton(t))==null?void 0:u.skeleton;if(!i)return;i.columnHeaderHeight=r,e.scene.getViewports()[0].top=r,e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT).setViewportSize({height:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT).setViewportSize({height:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM).setViewportSize({top:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP).setViewportSize({top:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP).setViewportSize({height:r});const s=e==null?void 0:e.with(m.SheetsSelectionsService),l=e==null?void 0:e.with(Ce),c=s.getCurrentSelections();l.resetSelectionsByModelData(c);const d=this.getUnitSkeleton(e.unitId,t);d&&(d.commandId=dr.id,this._currentSkeleton$.next(d))}setRowHeaderSize(e,t,r){var p;const i=(p=this.getWorksheetSkeleton(t))==null?void 0:p.skeleton;if(!e||!i)return;i.rowHeaderWidth=r;const s=e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP).width||46,l=r-s,c=e.scene.getViewports()[0].left;e.scene.getViewports()[0].left=c+l,e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM).setViewportSize({width:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP).setViewportSize({width:r}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT).setViewportSize({left:r});const d=e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT).left||0;e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT).setViewportSize({left:d+l}),e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP).setViewportSize({width:r});const u=e==null?void 0:e.with(m.SheetsSelectionsService),h=e==null?void 0:e.with(Ce),g=u.getCurrentSelections();h.resetSelectionsByModelData(g);const S=this.getCurrent();S&&(S.commandId=cr.id,this._currentSkeleton$.next(S))}};exports.SheetSkeletonManagerService=fd([As(1,a.Inject(a.Injector)),As(2,a.Inject(m.SheetSkeletonService))],exports.SheetSkeletonManagerService);var vd=Object.getOwnPropertyDescriptor,Cd=(n,o,e,t)=>{for(var r=t>1?void 0:t?vd(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ln=(n,o)=>(e,t)=>o(e,t,n);const ka=["ff","fs","tr","tb"];exports.AutoHeightController=class extends a.Disposable{constructor(o,e,t,r,i){super(),this._renderManagerService=o,this._sheetInterceptorService=e,this._selectionManagerService=t,this._univerInstanceService=r,this._configService=i,this._initialize()}_processLazyAutoHeight(o,e,t,r){if(r!=null&&r.length){const i={id:m.MarkDirtyRowAutoHeightMutation.id,params:{unitId:e,subUnitId:t,ranges:r,id:a.generateRandomId()},options:{onlyLocal:!0}},s={id:m.CancelMarkDirtyRowAutoHeightMutation.id,params:{unitId:e,subUnitId:t,id:i.params.id},options:{onlyLocal:!0}};return{redos:[...o.redos,i],undos:[...o.undos,s]}}return o}getUndoRedoParamsOfAutoHeight(o,e,t){const{_univerInstanceService:r}=this,i=r.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=i.getUnitId();let l=i.getActiveSheet(),c=l.getSheetId();if(e){const f=m.getSheetCommandTarget(r,{unitId:s,subUnitId:e});f&&(l=f.worksheet,c=l.getSheetId())}const u=this._renderManagerService.getRenderById(s).with(exports.SheetSkeletonManagerService).ensureSkeleton(c);if(!u)return{redos:[],undos:[]};const g=u.calculateAutoHeightInRange(o,t).filter(f=>{const{row:v,autoHeight:C}=f;return!(!C||l.getRowHeight(v)===C)});if(g.length===0)return{redos:[],undos:[]};const S={subUnitId:c,unitId:s,rowsAutoHeightInfo:g},p=m.SetWorksheetRowAutoHeightMutationFactory(S,l);return{undos:[{id:m.SetWorksheetRowAutoHeightMutation.id,params:p}],redos:[{id:m.SetWorksheetRowAutoHeightMutation.id,params:S}]}}_initialize(){this.disposeWithMe(this._sheetInterceptorService.interceptAutoHeight({getMutations:o=>{const{unitId:e,subUnitId:t,ranges:r,autoHeightRanges:i,lazyAutoHeightRanges:s,cellHeights:l}=o,c=this.getUndoRedoParamsOfAutoHeight(i!=null?i:r,t,l);return this._processLazyAutoHeight(c,e,t,s)}}))}};exports.AutoHeightController=Cd([Ln(0,T.IRenderManagerService),Ln(1,a.Inject(m.SheetInterceptorService)),Ln(2,a.Inject(m.SheetsSelectionsService)),Ln(3,a.Inject(a.IUniverInstanceService)),Ln(4,a.IConfigService)],exports.AutoHeightController);function gt(n){const{rows:o,cols:e}=n;return{startRow:o[0],endRow:o[o.length-1],startColumn:e[0],endColumn:e[e.length-1]}}function St(n){let o=[],e=[];const t=[];return n.forEach(r=>{o=o.concat(r.rows),e=e.concat(r.cols)}),o=Array.from(new Set(o)).sort((r,i)=>r-i),e=Array.from(new Set(e)).sort((r,i)=>r-i),n.forEach(r=>{t.push({startRow:o.findIndex(i=>i===r.rows[0]),endRow:o.findIndex(i=>i===r.rows[r.rows.length-1]),startColumn:e.findIndex(i=>i===r.cols[0]),endColumn:e.findIndex(i=>i===r.cols[r.cols.length-1])})}),{ranges:t,mapFunc:(r,i)=>({row:o[r],col:e[i]})}}function Id(n){const o=new a.ObjectMatrix;return n.forEach(e=>{const{rows:t,cols:r}=e;t.forEach(i=>{r.forEach(s=>{o.setValue(i,s,{v:null,p:null,f:null,si:null,custom:null})})})}),o.getData()}const yi={:0,:1,:2,:3,:4,:5,:6,:7,:8,:9},Jr=["","","","","","","","","",""],Ds=["","","","",""],_d=["","","",""],Ha={:{value:10,secUnit:!1},:{value:100,secUnit:!1},:{value:1e3,secUnit:!1},:{value:1e4,secUnit:!0},:{value:1e8,secUnit:!0}};function nt(n){if(!n)return 0;let o=0,e=0,t=0,r=!1;const i=n.split("");for(let s=0;s<i.length;s++){const l=yi[i[s]];if(typeof l<"u")t=l,s===i.length-1&&(e+=t);else{const c=Ha[i[s]],d=c.value;r=c.secUnit,r?(e=(e+t)*d,o+=e,e=0):e+=t*d,t=0}}return o+e}function bd(n){let o="",e="",t=0,r=!0;for(;n>0;){const i=n%10;i===0?r||(r=!0,e=Jr[i]+e):(r=!1,o=Jr[i],o+=_d[t],e=o+e),t++,n=Math.floor(n/10)}return e}function Rd(n){let o=0,e="",t="",r=!1;if(n===0)return Jr[0];for(;n>0;){const i=n%1e4;r&&(t=Jr[0]+t),e=bd(i),e+=i!==0?Ds[o]:Ds[0],t=e+t,r=i<1e3&&i>0,n=Math.floor(n/1e4),o++}return t}function wd(n){if(!n)return!1;let o=!0;if(n)if(n.length===1)n===""||n in yi?o=!0:o=!1;else{const e=n.split("");for(let t=0;t<e.length;t++)if(!(e[t]in yi||e[t]in Ha)){o=!1;break}}return o}function Vr(n){if(!n)return{isExtendNumber:!1};const o=/0|([1-9]+[0-9]*)/g,e=o.test(n);if(e){const t=n.match(o);if(t&&t.length>0){const r=t[t.length-1],i=n.lastIndexOf(r),s=n.substr(0,i),l=n.substr(i+r.length);return{isExtendNumber:!0,matchTxt:Number(r),beforeTxt:s,afterTxt:l}}return{isExtendNumber:!1}}return{isExtendNumber:e}}function Ed(n){let o;return n.length===2&&(n===""||n===""||n===""||n===""||n===""||n===""||n==="")?o=!0:o=!1,o}function Td(n){let o;return n.length===3&&(n===""||n===""||n===""||n===""||n===""||n===""||n==="")?o=!0:o=!1,o}function yd(n,o){let e=0;for(let t=0;t<n.length&&n[t]<o;t++)e++;return e}function hr(n){let o=!0;const e=n[1]-n[0];for(let t=1;t<n.length;t++)if(n[t]-n[t-1]!==e){o=!1;break}return o}function Md(n,o,e){const t=[],r=Math.floor(o/n),i=o%n;let s=0;if(r>0){for(let l=0;l<r;l++)for(let c=0;c<e.length;c++)t[e[c]+l*n]=s,s++;for(let l=0;l<e.length&&e[l]<i;l++)t[e[l]+n*r]=s,s++}else for(let l=0;l<e.length&&e[l]<i;l++)t[e[l]]=s,s++;return t}function Dt(n,o){const e=[];for(let t=1;t<=o;t++){const r=(t-1)%n.length,i=a.Tools.deepClone(n[r]);Nt(i),e.push({v:null,s:null,p:null,f:null,si:null,t:null,...i})}return e}function Pd(n,o){var t;const e=[];for(let r=1;r<=o;r++){const i=(r-1)%n.length,s={s:(t=n[i])==null?void 0:t.s};e.push(s)}return e}function xd(n){let o=!0;const e=n[1]/n[0];for(let t=1;t<n.length;t++)if(n[t]/n[t-1]!==e){o=!1;break}return o}function Od(n){const o=[];for(let e=1;e<=n;e++)o.push(e);return o}function $r(n,o,e){var i,s,l,c;const t=[],r=[];for(let d=0;d<n.length;d++)r.push(Number((i=n[d])==null?void 0:i.v));if(n.length>2&&xd(r))for(let d=1;d<=o;d++){const u=(d-1)%n.length,h=a.Tools.deepClone(n[u]);Nt(h);const g=Number((s=n[n.length-1])==null?void 0:s.v)*(Number((l=n[1])==null?void 0:l.v)/Number((c=n[0])==null?void 0:c.v))**d;h&&(Vs(h)&&(h.v=g),t.push(h))}else{const d=Od(n.length);for(let u=1;u<=o;u++){const h=(u-1)%n.length,g=a.Tools.deepClone(n[h]);Nt(g);const S=e===a.Direction.DOWN||e===a.Direction.RIGHT,p=Ad(n.length+u,r,d,S);g&&(Vs(g)&&(g.v=p),t.push(g))}}return t}function Ad(n,o,e,t=!0){function r(h){let g=0;for(let S=0;S<h.length;S++)g+=h[S];return g/h.length}const i=r(e),s=r(o);let l=0,c=0;for(let h=0;h<e.length;h++)l+=(e[h]-i)*(o[h]-s),c+=(e[h]-i)*(e[h]-i);let d;c===0?d=t?1:-1:d=l/c;const u=s-d*i;return Math.round((u+d*n)*1e5)/1e5}function Ns(n,o,e){var i;const t=[],r=/0|([1-9]+[0-9]*)/g;for(let s=1;s<=o;s++){const l=(s-1)%n.length,c=a.Tools.deepClone(n[l]);Nt(c);const d=`${(i=n[n.length-1])==null?void 0:i.v}`;if(!d)continue;const u=d==null?void 0:d.match(r),h=u==null?void 0:u[u.length-1];if(!h)continue;const g=Math.abs(Number(h)+e*s),S=d.lastIndexOf(h),p=d.substr(0,S)+g.toString()+d.substr(S+h.length);c&&(c.v=p,t.push(c))}return t}function hn(n,o,e,t=0){var l,c;const r=[["","","","","","",""],["","","","","","",""],["","","","","","",""]];if(t>=r.length)return[];const i=r[t],s=[];for(let d=1;d<=o;d++){const u=(d-1)%n.length,h=a.Tools.deepClone(n[u]);Nt(h);let g=0;if(((l=n[n.length-1])==null?void 0:l.v)===i[0])g=7+e*d;else{const p=`${(c=n[n.length-1])==null?void 0:c.v}`;if(p){const f=p.substr(p.length-1,1);g=nt(f)+e*d}}g<0&&(g=Math.ceil(Math.abs(g)/7)*7+g);const S=g%7;h&&(h.v=i[S],s.push(h))}return s}function ks(n,o,e){var r;const t=[];for(let i=1;i<=o;i++){const s=(i-1)%n.length,l=a.Tools.deepClone(n[s]);Nt(l);const c=`${(r=n[n.length-1])==null?void 0:r.v}`,d=nt(c)+e*i;let u;d<=0?u="":u=Rd(d),l&&(l.v=u,t.push(l))}return t}const $n={enWeek1:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],enWeek2:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],enMonth1:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],enMonth2:["January","February","March","April","May","June","July","August","September","October","November","December"],chnMonth1:["","","","","","","","","","","",""],chnMonth2:["","","","","","","","","","","",""],chHour1:["","","","","","","","","","","",""],chHour2:["","","","","","","","","","","",""],chYear1:["","","","","","","","","",""],chSeason1:["","","",""],chSeason2:["","","",""]};function Dd(n){let o=!1;return Object.keys($n).forEach(e=>{$n[e].includes(n)&&(o=!0)}),o}function Uo(n){let o="";const e=[];return Object.keys($n).forEach(t=>{$n[t].includes(n)&&(o=t,e.push(...$n[t]))}),{name:o,series:e}}function Hs(n,o,e,t){var s;const r=t.length,i=[];for(let l=1;l<=o;l++){const c=(l-1)%n.length,d=a.Tools.deepClone(n[c]);Nt(d);const u=`${(s=n[n.length-1])==null?void 0:s.v}`;let h=t.indexOf(u)+e*l;h<0&&(h+=Math.abs(e)*r);const g=h%r;d&&(d.v=t[g],i.push(d))}return i}function Nd(n,o){const e=[];let t;if(o.startRow<n.startRow)t=a.Direction.UP;else if(o.endRow>n.endRow)t=a.Direction.DOWN;else if(o.startColumn<n.startColumn)t=a.Direction.LEFT;else if(o.endColumn>n.endColumn)t=a.Direction.RIGHT;else return[];if(t===a.Direction.DOWN||t===a.Direction.UP){const r=n.endRow-n.startRow+1,i=o.endRow-o.startRow+1,s=Math.floor(i/r),l=i%r,c={startRow:0,startColumn:0,endRow:n.endRow-n.startRow,endColumn:n.endColumn-n.startColumn};if(t===a.Direction.DOWN){for(let d=0;d<s;d++)e.push({repeatStartCell:{row:n.startRow+(d+1)*r,col:n.startColumn},relativeRange:c});l>0&&e.push({repeatStartCell:{row:n.startRow+(s+1)*r,col:n.startColumn},relativeRange:{startRow:0,startColumn:0,endRow:l-1,endColumn:n.endColumn-n.startColumn}})}else{for(let d=0;d<s;d++)e.push({repeatStartCell:{row:n.startRow-(d+1)*r,col:n.startColumn},relativeRange:c});l>0&&e.push({repeatStartCell:{row:n.startRow-(s+1)*r,col:n.startColumn},relativeRange:{startRow:r-l,endRow:r-1,startColumn:0,endColumn:n.endColumn-n.startColumn}})}}if(t===a.Direction.RIGHT||t===a.Direction.LEFT){const r=n.endColumn-n.startColumn+1,i=o.endColumn-o.startColumn+1,s=Math.floor(i/r),l=i%r,c={startRow:0,startColumn:0,endRow:n.endRow-n.startRow,endColumn:n.endColumn-n.startColumn};if(t===a.Direction.RIGHT){for(let d=0;d<s;d++)e.push({repeatStartCell:{row:n.startRow,col:n.startColumn+(d+1)*r},relativeRange:c});l>0&&e.push({repeatStartCell:{row:n.startRow,col:n.startColumn+(s+1)*r},relativeRange:{startRow:0,startColumn:0,endRow:n.endRow-n.startRow,endColumn:l-1}})}else{for(let d=0;d<s;d++)e.push({repeatStartCell:{row:n.startRow,col:n.startColumn-(d+1)*r},relativeRange:c});l>0&&e.push({repeatStartCell:{row:n.startRow,col:n.startColumn-(s+1)*r},relativeRange:{startRow:0,startColumn:r-l,endRow:n.endRow-n.startRow,endColumn:r-1}})}}return e}function Vs(n){return!(a.isFormulaString(n.f)||a.isFormulaId(n.si)||n.t===a.CellValueType.BOOLEAN)}function Nt(n){n&&"custom"in n&&delete n.custom}var nn=(n=>(n.Append="APPEND",n.Default="DEFAULT",n.Only="ONLY",n))(nn||{}),Ie=(n=>(n.NUMBER="number",n.DATE="date",n.EXTEND_NUMBER="extendNumber",n.CHN_NUMBER="chnNumber",n.CHN_WEEK2="chnWeek2",n.CHN_WEEK3="chnWeek3",n.LOOP_SERIES="loopSeries",n.FORMULA="formula",n.OTHER="other",n))(Ie||{}),ae=(n=>(n.COPY="COPY",n.SERIES="SERIES",n.ONLY_FORMAT="ONLY_FORMAT",n.NO_FORMAT="NO_FORMAT",n))(ae||{});const kd={type:Ie.DATE,priority:1100,match:(n,o)=>{var e;if(n!=null&&n.f||n!=null&&n.si)return!1;if((typeof(n==null?void 0:n.v)=="number"||(n==null?void 0:n.t)===a.CellValueType.NUMBER)&&n.s){if(typeof n.s=="string"){const r=o.get(a.IUniverInstanceService).getFocusedUnit().getStyles().get(n.s),i=(e=r==null?void 0:r.n)==null?void 0:e.pattern;if(i)return a.numfmt.getFormatInfo(i).isDate}else if(n.s.n&&a.numfmt.getFormatInfo(n.s.n.pattern).isDate)return!0}return!1},isContinue:(n,o)=>n.type===Ie.DATE,applyFunctions:{[ae.SERIES]:(n,o,e)=>{const{data:t}=n;return e===a.Direction.LEFT||e===a.Direction.UP?(t.reverse(),$r(t,o,e).reverse()):$r(t,o,e)}}},Hd={type:Ie.NUMBER,priority:1e3,match:n=>typeof(n==null?void 0:n.v)=="number"||(n==null?void 0:n.t)===a.CellValueType.NUMBER,isContinue:(n,o)=>n.type===Ie.NUMBER,applyFunctions:{[ae.SERIES]:(n,o,e)=>{const{data:t}=n;return e===a.Direction.LEFT||e===a.Direction.UP?(t.reverse(),$r(t,o,e).reverse()):$r(t,o,e)}}},Va={type:Ie.OTHER,priority:0,match:()=>!0,isContinue:(n,o)=>n.type===Ie.OTHER},Vd={type:Ie.EXTEND_NUMBER,priority:900,match:n=>Vr(`${n==null?void 0:n.v}`||"").isExtendNumber,isContinue:(n,o)=>{var e;if(n.type===Ie.EXTEND_NUMBER){const{beforeTxt:t,afterTxt:r}=Vr(`${(e=n.cellData)==null?void 0:e.v}`||""),{beforeTxt:i,afterTxt:s}=Vr(`${o==null?void 0:o.v}`||"");if(t===i&&r===s)return!0}return!1},applyFunctions:{[ae.SERIES]:(n,o,e)=>{var l;const{data:t}=n,r=e===a.Direction.UP||e===a.Direction.LEFT;let i;if(t.length===1)return i=r?-1:1,Ae(Ns(t,o,i),r);const s=[];for(let c=0;c<t.length;c++){const d=`${(l=t[c])==null?void 0:l.v}`;d&&s.push(Number(Vr(d).matchTxt))}return r&&(t.reverse(),s.reverse()),hr(s)?(i=s[1]-s[0],Ae(Ns(t,o,i),r)):Dt(t,o)}}},Wd={type:Ie.CHN_NUMBER,priority:830,match:n=>!!wd(`${n==null?void 0:n.v}`||""),isContinue:(n,o)=>n.type===Ie.CHN_NUMBER,applyFunctions:{[ae.SERIES]:(n,o,e)=>{var c,d,u;const{data:t}=n,r=e===a.Direction.LEFT||e===a.Direction.UP;if(t.length===1){const h=`${(c=t[0])==null?void 0:c.v}`;let g;return r?g=-1:g=1,h&&(h===""||nt(h)<7)?Ae(hn(t,o,g),r):Ae(ks(t,o,g),r)}let i=!1;for(let h=0;h<t.length;h++)if(((d=t[h])==null?void 0:d.v)===""){i=!0;break}const s=[];let l=0;for(let h=0;h<t.length;h++){const g=`${(u=t[h])==null?void 0:u.v}`;g===""?h===0?s.push(0):(l++,s.push(l*7)):i&&nt(g)>0&&nt(g)<7?s.push(nt(g)+l*7):s.push(nt(g))}if(r&&(t.reverse(),s.reverse()),hr(s)){if(i||s[s.length-1]<6&&s[0]>0||s[0]<6&&s[s.length-1]>0){const g=s[1]-s[0];return Ae(hn(t,o,g),r)}const h=s[1]-s[0];return Ae(ks(t,o,h),r)}return Dt(t,o)}}},Ud={type:Ie.CHN_WEEK2,priority:820,match:n=>!!Ed(`${n==null?void 0:n.v}`||""),isContinue:(n,o)=>n.type===Ie.CHN_WEEK2,applyFunctions:{[ae.SERIES]:(n,o,e)=>{var l;const{data:t}=n,r=e===a.Direction.LEFT||e===a.Direction.UP;if(t.length===1){let c;return r?c=-1:c=1,Ae(hn(t,o,c,1),r)}const i=[];let s=0;for(let c=0;c<t.length;c++){const d=`${(l=t[c])==null?void 0:l.v}`,u=d==null?void 0:d.substr(d.length-1,1);d===""?c===0?i.push(0):(s++,i.push(s*7)):i.push(nt(u)+s*7)}if(r&&(t.reverse(),i.reverse()),hr(i)){const c=i[1]-i[0];return Ae(hn(t,o,c,1),r)}return Dt(t,o)}}},Ld={type:Ie.CHN_WEEK3,priority:810,match:n=>Td(`${n==null?void 0:n.v}`||""),isContinue:(n,o)=>n.type===Ie.CHN_WEEK3,applyFunctions:{[ae.SERIES]:(n,o,e)=>{var l;const{data:t}=n,r=e===a.Direction.LEFT||e===a.Direction.UP;if(t.length===1){let c;return r?c=-1:c=1,Ae(hn(t,o,c,2),r)}const i=[];let s=0;for(let c=0;c<t.length;c++){const d=`${(l=t[c])==null?void 0:l.v}`;if(d){const u=d.substr(d.length-1,1);d===""?c===0?i.push(0):(s++,i.push(s*7)):i.push(nt(u)+s*7)}}if(r&&(t.reverse(),i.reverse()),hr(i)){const c=i[1]-i[0];return Ae(hn(t,o,c,2),r)}return Dt(t,o)}}},Bd={type:Ie.LOOP_SERIES,priority:800,match:n=>Dd(`${n==null?void 0:n.v}`||""),isContinue:(n,o)=>{var e;return n.type===Ie.LOOP_SERIES?Uo(`${(e=n.cellData)==null?void 0:e.v}`||"").name===Uo(`${o==null?void 0:o.v}`||"").name:!1},applyFunctions:{[ae.SERIES]:(n,o,e)=>{var c,d;const{data:t}=n,r=e===a.Direction.LEFT||e===a.Direction.UP,{series:i}=Uo(`${(c=t[0])==null?void 0:c.v}`||"");if(t.length===1){let u;return r?u=-1:u=1,Ae(Hs(t,o,u,i),r)}const s=[];let l=0;for(let u=0;u<t.length;u++){const h=`${(d=t[u])==null?void 0:d.v}`;h&&(h===i[0]?u===0?s.push(0):(l++,s.push(l*i.length)):s.push(i.indexOf(h)+l*7))}if(r&&(t.reverse(),s.reverse()),hr(s)){const u=s[1]-s[0];return Ae(Hs(t,o,u,i),r)}return Dt(t,o)}}};function Ae(n,o){return o?n.reverse():n}var Fd=Object.getOwnPropertyDescriptor,jd=(n,o,e,t)=>{for(var r=t>1?void 0:t?Fd(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Kt=(n,o)=>(e,t)=>o(e,t,n);exports.AutoFillService=class extends a.Disposable{constructor(e,t,r,i,s,l){super();E(this,"_rules",[]);E(this,"_hooks",[]);E(this,"_applyType$",new O.BehaviorSubject(ae.SERIES));E(this,"_isFillingStyle",!0);E(this,"_prevUndos",[]);E(this,"_autoFillLocation$",new O.BehaviorSubject(null));E(this,"autoFillLocation$",this._autoFillLocation$.asObservable());E(this,"_showMenu$",new O.BehaviorSubject(!1));E(this,"showMenu$",this._showMenu$.asObservable());E(this,"_direction",a.Direction.DOWN);E(this,"applyType$",this._applyType$.asObservable());E(this,"_menu$",new O.BehaviorSubject([{label:"autoFill.copy",value:ae.COPY,disable:!1},{label:"autoFill.series",value:ae.SERIES,disable:!1},{label:"autoFill.formatOnly",value:ae.ONLY_FORMAT,disable:!1},{label:"autoFill.noFormat",value:ae.NO_FORMAT,disable:!1}]));E(this,"menu$",this._menu$.asObservable());this._commandService=e,this._undoRedoService=t,this._renderManagerService=r,this._univerInstanceService=i,this._selectionManagerService=s,this._injector=l,this._init()}_init(){this._rules=[kd,Hd,Vd,Wd,Ud,Ld,Bd,Va].sort((e,t)=>t.priority-e.priority),this._isFillingStyle=!0}_getOneByPriority(e){return e.length<=0?[]:[e.reduce((r,i)=>(i.priority||0)>(r.priority||0)?i:r,e[0])]}_initPrevUndo(){this._prevUndos=[]}async triggerAutoFill(e,t,r,i){var S;if(r.startColumn===i.startColumn&&r.startRow===i.startRow&&r.endColumn===i.endColumn&&r.endRow===i.endRow)return!1;if(i.endColumn<r.endColumn&&i.endColumn>r.startColumn)return this._commandService.executeCommand(mn.id,{clearRange:{startRow:i.startRow,endRow:i.endRow,startColumn:i.endColumn+1,endColumn:r.endColumn},selectionRange:i});if(i.endRow<r.endRow&&i.endRow>r.startRow)return this._commandService.executeCommand(mn.id,{clearRange:{startRow:i.endRow+1,endRow:r.endRow,startColumn:i.startColumn,endColumn:i.endColumn},selectionRange:i});const s={startRow:i.startRow,endRow:i.endRow,startColumn:i.startColumn,endColumn:i.endColumn};let l=null;if(i.startRow<r.startRow)l=a.Direction.UP,s.endRow=r.startRow-1;else if(i.endRow>r.endRow)l=a.Direction.DOWN,s.startRow=r.endRow+1;else if(i.startColumn<r.startColumn)l=a.Direction.LEFT,s.endColumn=r.startColumn-1;else if(i.endColumn>r.endColumn)l=a.Direction.RIGHT,s.startColumn=r.endColumn+1;else return!1;this.direction=l;const c=this._injector.invoke(p=>m.rangeToDiscreteRange(r,p)),d=this._injector.invoke(p=>m.rangeToDiscreteRange(s,p));if(!c||!d)return!1;this.autoFillLocation={source:c,target:d,unitId:e,subUnitId:t};const u=[];this.getActiveHooks().forEach(p=>{var v;const f=(v=p==null?void 0:p.onBeforeFillData)==null?void 0:v.call(p,{source:c,target:d,unitId:e,subUnitId:t},l);f&&u.unshift(f)}),this._initPrevUndo();for(let p=0;p<u.length;p++){const f=this.menu.find(v=>v.value===u[p]);if(f&&!f.disable)return this.fillData(u[p])}const g=(S=this.menu.find(p=>p.disable===!1))==null?void 0:S.value;return g?this.fillData(g):!1}addHook(e){if(this._hooks.find(t=>t.id===e.id))throw new Error(`Add hook failed, hook id '${e.id}' already exist!`);return e.priority===void 0&&(e.priority=0),e.type===void 0&&(e.type=nn.Append),this._hooks.push(e),a.toDisposable(()=>{const t=this._hooks.findIndex(r=>r===e);t>-1&&this._hooks.splice(t,1)})}registerRule(e){if(this._rules.find(r=>r.type===e.type))throw new Error(`Registry rule failed, type '${e.type}' already exist!`);const t=this._rules.findIndex(r=>r.priority<e.priority);this._rules.splice(t===-1?this._rules.length:t,0,e)}getRules(){return this._rules}getAllHooks(){return this._hooks}getActiveHooks(){const{source:e,target:t,unitId:r,subUnitId:i}=this.autoFillLocation||{};if(!e||!t||!r||!i)return[];const s=this._hooks.filter(u=>{var h;return!((h=u.disable)!=null&&h.call(u,{source:e,target:t,unitId:r,subUnitId:i},this._direction,this.applyType))}),l=s.filter(u=>u.type===nn.Only);if(l.length>0)return this._getOneByPriority(l);const c=this._getOneByPriority(s.filter(u=>u.type===nn.Default)),d=s.filter(u=>u.type===nn.Append)||[];return[...c,...d]}get applyType(){return this._applyType$.getValue()}set applyType(e){this._applyType$.next(e)}get menu(){return this._menu$.getValue()}get direction(){return this._direction}set direction(e){this._direction=e}isFillingStyle(){return this._isFillingStyle}setFillingStyle(e){this._isFillingStyle=e}get autoFillLocation(){return this._autoFillLocation$.getValue()}set autoFillLocation(e){this._autoFillLocation$.next(e)}setDisableApplyType(e,t){this._menu$.next(this._menu$.getValue().map(r=>r.value===e?{...r,disable:t}:r))}setShowMenu(e){this._showMenu$.next(e)}fillData(e){var C,_,R;this.applyType=e;const{source:t,target:r,unitId:i=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId(),subUnitId:s=(C=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet())==null?void 0:C.getSheetId()}=this.autoFillLocation||{};if(!t||!r||!i||!s)return!1;const l=this.direction;this._prevUndos.length>0&&this._prevUndos.forEach(w=>{this._commandService.syncExecuteCommand(w.id,w.params)}),this._prevUndos=[];const c=a.Rectangle.union(gt(t),gt(r)),d=this.getActiveHooks(),u=this._univerInstanceService.getUnit(i,a.UniverInstanceType.UNIVER_SHEET);this._commandService.syncExecuteCommand(m.SetSelectionsOperation.id,{selections:[{primary:{...(R=(_=this._selectionManagerService.getCurrentLastSelection())==null?void 0:_.primary)!=null?R:c},range:{...c,rangeType:a.RANGE_TYPE.NORMAL}}],unitId:i,subUnitId:s});const h=[],g=[];d.forEach(w=>{var M;const{undos:P,redos:y}=((M=w.onFillData)==null?void 0:M.call(w,{source:t,target:r,unitId:i,subUnitId:s},l,e))||{};P&&h.push(...P),y&&g.push(...y)});const S=g.every(w=>this._commandService.syncExecuteCommand(w.id,w.params)),p=[];e!==ae.NO_FORMAT&&g.forEach(w=>{if(w.id===m.SetRangeValuesMutation.id){const{cellValue:P}=w.params;new a.ObjectMatrix(P).forValue((M,x,A)=>{const D=Object.keys(u.getStyles().get(A==null?void 0:A.s)||{});(A!=null&&A.p||D.length&&ka.some(N=>D.includes(N)))&&p.push({startRow:M,endRow:M,startColumn:x,endColumn:x})})}});const f=this._getAutoHeightUndoRedos(i,s,p);return f.redos.every(w=>this._commandService.syncExecuteCommand(w.id,w.params))&&(h.push(...f.undos),g.push(...f.redos)),S&&(this._prevUndos=h,this._undoRedoService.pushUndoRedo({unitID:i,undoMutations:h,redoMutations:g})),d.forEach(w=>{var P;(P=w.onAfterFillData)==null||P.call(w,{source:t,target:r,unitId:i,subUnitId:s},l,e)}),this.setShowMenu(!0),!0}_getAutoHeightUndoRedos(e,t,r){var h,g;const i=(h=this._renderManagerService.getRenderById(e))==null?void 0:h.with(exports.SheetSkeletonManagerService),s=(g=i==null?void 0:i.getCurrentParam())==null?void 0:g.skeleton;if(!s)return{redos:[],undos:[]};const l=s.calculateAutoHeightInRange(r),c={subUnitId:t,unitId:e,rowsAutoHeightInfo:l},d=s.worksheet,u=m.SetWorksheetRowAutoHeightMutationFactory(c,d);return{undos:[{id:m.SetWorksheetRowAutoHeightMutation.id,params:u}],redos:[{id:m.SetWorksheetRowAutoHeightMutation.id,params:c}]}}};exports.AutoFillService=jd([Kt(0,a.ICommandService),Kt(1,a.IUndoRedoService),Kt(2,T.IRenderManagerService),Kt(3,a.Inject(a.IUniverInstanceService)),Kt(4,a.Inject(m.SheetsSelectionsService)),Kt(5,a.Inject(a.Injector))],exports.AutoFillService);const pt=a.createIdentifier("univer.auto-fill-service"),dt={type:a.CommandType.COMMAND,id:"sheet.command.auto-fill",handler:async(n,o)=>{const e=n.get(pt),t=n.get(a.IUniverInstanceService),{sourceRange:r,targetRange:i}=o,s=m.getSheetCommandTarget(t);if(!s)return!1;const{subUnitId:l,unitId:c}=s;return e.triggerAutoFill(c,l,r,i)}},mn={id:"sheet.command.auto-clear-content",type:a.CommandType.COMMAND,handler:async(n,o)=>{const e=n.get(a.IUniverInstanceService),t=n.get(a.ICommandService),r=n.get(a.IUndoRedoService),i=n.get(m.SheetInterceptorService),s=m.getSheetCommandTarget(e);if(!s)return!1;const{unitId:l,subUnitId:c}=s,{clearRange:d,selectionRange:u}=o,h={subUnitId:c,unitId:l,cellValue:m.generateNullCellValue([d])},g=m.SetRangeValuesUndoMutationFactory(n,h),{startColumn:S,startRow:p}=u,f={selections:[{primary:{startColumn:S,startRow:p,endColumn:S,endRow:p,actualRow:p,actualColumn:S,isMerged:!1,isMergedMainCell:!1},range:{...u}}],unitId:l,subUnitId:c};if(t.executeCommand(m.SetSelectionsOperation.id,f),t.syncExecuteCommand(m.SetRangeValuesMutation.id,h)){const C=i.afterCommandExecute({id:m.SetRangeValuesMutation.id,params:h});return a.sequenceExecute(C.redos,t),r.pushUndoRedo({unitID:l,undoMutations:[{id:m.SetRangeValuesMutation.id,params:g},...C.undos],redoMutations:[{id:m.SetRangeValuesMutation.id,params:h},...C.redos]}),!0}return!1}};function Zi(n){return n.getContextValue(a.FOCUSING_SHEET)}function se(n){return n.getContextValue(a.FOCUSING_SHEET)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)&&!n.getContextValue(a.EDITOR_ACTIVATED)&&!n.getContextValue(a.FOCUSING_COMMON_DRAWINGS)}function Wa(n){return n.getContextValue(a.FOCUSING_SHEET)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)&&!n.getContextValue(a.EDITOR_ACTIVATED)&&!n.getContextValue(a.FOCUSING_FX_BAR_EDITOR)&&!n.getContextValue(a.FOCUSING_COMMON_DRAWINGS)}function zd(n){return n.getContextValue(a.FOCUSING_SHEET)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)&&n.getContextValue(a.EDITOR_ACTIVATED)}function Gi(n){return n.getContextValue(a.FOCUSING_UNIVER_EDITOR)&&n.getContextValue(a.EDITOR_ACTIVATED)}function Po(n){return n.getContextValue(a.FOCUSING_FX_BAR_EDITOR)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)}function Xd(n){return n.getContextValue(a.FOCUSING_SHEET)&&n.getContextValue(a.EDITOR_ACTIVATED)&&n.getContextValue(a.FOCUSING_EDITOR_INPUT_FORMULA)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)}function gn(n){return n.getContextValue(a.FOCUSING_SHEET)&&n.getContextValue(a.FOCUSING_UNIVER_EDITOR)&&n.getContextValue(a.EDITOR_ACTIVATED)&&!n.getContextValue(a.FOCUSING_EDITOR_INPUT_FORMULA)&&!n.getContextValue(a.FOCUSING_EDITOR_STANDALONE)}var Yd=Object.getOwnPropertyDescriptor,Zd=(n,o,e,t)=>{for(var r=t>1?void 0:t?Yd(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Lo=(n,o)=>(e,t)=>o(e,t,n);const Ws=zi.MARK_SELECTION,Lt=a.createIdentifier("univer.mark-selection-service");exports.MarkSelectionService=class extends a.Disposable{constructor(e,t,r){super();E(this,"_shapeMap",new Map);this._currentService=e,this._renderManagerService=t,this._themeService=r}addShape(e,t=[],r=Ws){var d;const i=this._currentService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=(d=i.getActiveSheet())==null?void 0:d.getSheetId();if(!s)return null;const l=a.generateRandomId(),c={selection:e,subUnitId:s,unitId:i.getUnitId(),zIndex:r,control:null,exits:t};return this._shapeMap.set(l,c),this.refreshShapes(),l}addShapeWithNoFresh(e,t=[],r=Ws){var c;const i=this._currentService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=(c=i.getActiveSheet())==null?void 0:c.getSheetId();if(!s)return null;const l=a.generateRandomId();return this._shapeMap.set(l,{selection:e,subUnitId:s,unitId:i.getUnitId(),zIndex:r,control:null,exits:t}),l}refreshShapes(){var i;const e=this._currentService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!e)return;const t=e.getUnitId(),r=(i=e.getActiveSheet())==null?void 0:i.getSheetId();this._shapeMap.forEach(s=>{const{unitId:l,subUnitId:c,selection:d,control:u,zIndex:h}=s;if(u==null||u.dispose(),l!==t||c!==r)return;const g=this._renderManagerService.getRenderById(l);if(!g)return;const S=g.with(exports.SheetSkeletonManagerService).getCurrentSkeleton();if(!S)return;const{scene:p}=g,{rowHeaderWidth:f,columnHeaderHeight:v}=S,C=new ur(p,h,this._themeService,{enableAutoFill:!1,highlightHeader:!1,rowHeaderWidth:f,columnHeaderHeight:v}),_=ye(d,S);C.updateRangeBySelectionWithCoord(_),s.control=C})}getShapeMap(){return this._shapeMap}removeShape(e){const t=this._shapeMap.get(e);if(!t)return;const{control:r}=t;r==null||r.dispose(),this._shapeMap.delete(e)}removeAllShapes(){for(const e of this._shapeMap.values()){const{control:t}=e;t==null||t.dispose()}this._shapeMap.clear()}};exports.MarkSelectionService=Zd([Lo(0,a.IUniverInstanceService),Lo(1,T.IRenderManagerService),Lo(2,a.Inject(a.ThemeService))],exports.MarkSelectionService);function Ua(n){return{strokeWidth:1.5,stroke:n.getColorFromTheme("primary.600"),fill:"rgba(178, 178, 178, 0.10)",widgets:{},strokeDash:8}}const Gd=10,Kd=6;function qd(){return a.generateRandomId(Kd)}function Qd(n){const o=n.match(/data-copy-id="([^\s]+)"/);return o&&o[1]?o[1]:null}class Jd{constructor(){E(this,"_cache",new a.LRUMap(Gd))}set(o,e){this._cache.set(o,e)}get(o){return this._cache.get(o)}del(o){this._cache.delete(o)}clear(){this._cache.clear()}clearWithUnitId(o){this._cache.forEach((e,t)=>{e.unitId===o&&this._cache.delete(t)})}}function eo(n,o){const e=o!=null?o:n.style,t={},r=n.tagName.toLowerCase();switch(r){case"b":case"em":case"strong":{t.bl=a.BooleanNumber.TRUE;break}case"s":{t.st={s:a.BooleanNumber.TRUE};break}case"u":{t.ul={s:a.BooleanNumber.TRUE};break}case"i":{t.it=a.BooleanNumber.TRUE;break}case"sub":case"sup":{t.va=r==="sup"?a.BaselineOffset.SUPERSCRIPT:a.BaselineOffset.SUBSCRIPT;break}}return $d(e,t),t}function $d(n,o){if(n instanceof CSSStyleDeclaration)for(let e=0;e<n.length;e++){const t=n[e],r=n.getPropertyValue(t);Us(t,r,o)}else for(const e in n){const t=n[e];Us(e,t,o)}}function Us(n,o,e){switch(n){case"font-family":e.ff=o;break;case"font-size":{const t=Number.parseInt(o);Number.isNaN(t)||(o.endsWith("pt")?e.fs=t:o.endsWith("px")&&(e.fs=t*.75));break}case"font-style":o==="italic"&&(e.it=a.BooleanNumber.TRUE);break;case"font-weight":{(Number(o)>400||o==="bold")&&(e.bl=a.BooleanNumber.TRUE);break}case"text-decoration":{/underline/.test(o)?e.ul={s:a.BooleanNumber.TRUE}:/overline/.test(o)?e.ol={s:a.BooleanNumber.TRUE}:/line-through/.test(o)&&(e.st={s:a.BooleanNumber.TRUE});break}case"color":{try{const t=new a.ColorKit(o);t.isValid&&(e.cl={rgb:t.toRgbString()})}catch{}break}case"background-color":{const t=new a.ColorKit(o);t.isValid&&(e.bg={rgb:t.toRgbString()});break}}}function eu(n){const o=document.createElement("body");return o.innerHTML=n,o}function La(n){const o=n.style,e={};for(let t=0;t<o.length;t++){const r=o[t],i=o.getPropertyValue(r);switch(r){case"margin-top":{const s=Number.parseInt(i);e.spaceAbove={v:/pt/.test(i)?T.ptToPixel(s):s};break}case"margin-bottom":{const s=Number.parseInt(i);e.spaceBelow={v:/pt/.test(i)?T.ptToPixel(s):s};break}case"line-height":{const s=Number.parseFloat(i);e.lineSpacing=s;break}}}return Object.getOwnPropertyNames(e).length?e:null}function Bo(n,o){const e=[];for(let t=0,r=n.length;t<r;t++)n[t]===a.DataStreamTreeTokenType.PARAGRAPH&&e.push({startIndex:t});return e}function Ls(n,o,e){var s,l,c;const t=o.length,i=((s=e==null?void 0:e.length)!=null?s:0)===1&&e[0].st===0&&e[0].ed===t;return n.p?i&&((c=(l=n.p.body)==null?void 0:l.textRuns)!=null&&c.length)?(n.p.body.textRuns=[],{...n,s:e[0].ts}):n:i?{...n,s:e[0].ts}:n}const Bs=["color","background","font-size","text-align","vertical-align","font-weight","font-style","font-family","text-decoration","white-space","word-wrap","border-left","border-right","border-top","border-bottom","--data-rotate"];function Fs(n,o){const e=n.tagName.toLowerCase();return typeof o=="string"?e===o:Array.isArray(o)?o.some(t=>t===e):o(n)}const Eo=class Eo{constructor(o){E(this,"_styleMap",new Map);E(this,"_styleCache",new Map);E(this,"_styleRules",[]);E(this,"_afterProcessRules",[]);E(this,"_dom",null);E(this,"_getCurrentSkeleton");this._getCurrentSkeleton=o.getCurrentSkeleton}static use(o){if(this._pluginList.includes(o))throw new Error(`Univer paste plugin ${o.name} already added`);this._pluginList.push(o)}convert(o){const e=Eo._pluginList.find(f=>f.checkPasteType(o));e&&(this._styleRules=[...e.stylesRules],this._afterProcessRules=[...e.afterProcessRules]);const t=new a.ObjectMatrix;this._dom=eu(o);const r=this._dom.querySelector("style");if(r){const f=document.createElement("div"),v=f.attachShadow({mode:"open"});document.body.appendChild(f),v.appendChild(r);for(const C of r.sheet.cssRules){const _=C,R=_.selectorText,w=_.style;this._styleMap.set(R,w)}r.remove(),f.remove()}const i={dataStream:"",textRuns:[]},s=[],l=[],c=o.match(/<table\b[^>]*>([\s\S]*?)<\/table>/gi),d=[];this.process(null,this._dom.childNodes,i,d);const{paragraphs:u,dataStream:h,textRuns:g,payloads:S,customRanges:p}=i;if(u){const f=u.map(v=>v.startIndex+1);f.unshift(0);for(let v=0;v<f.length;v++){let C;if(v===f.length-1){if(C=`${h.substring(f[v])}\r
`,C===`\r
`)continue}else C=`${h.substring(f[v],f[v+1]-1)}\r
`;const _=[];g==null||g.forEach(y=>{y.st>=f[v]&&y.ed<=f[v+1]&&_.push({st:y.st-f[v],ed:y.ed-f[v],ts:y.ts})});const R=[];p==null||p.forEach(y=>{y.startIndex>=f[v]&&y.endIndex<=f[v+1]&&R.push({...y,startIndex:y.startIndex-f[v],endIndex:y.endIndex-f[v]})});const w=this._generateDocumentDataModelSnapshot({body:{dataStream:C,textRuns:_,paragraphs:Bo(C),customRanges:R}}),P=Object.keys(t.getMatrix()).length===0;t.setValue(P?0:t.getLength(),0,{v:C,p:w}),s.push({})}}else if(h){const f=`${h}\r
`,v={dataStream:f,textRuns:g,paragraphs:Bo(f),payloads:S,customRanges:p};if(!(p!=null&&p.length))t.setValue(0,0,Ls({v:h},h,g));else{const C=this._generateDocumentDataModelSnapshot({body:v});t.setValue(0,0,Ls({v:h,p:C},h,g))}s.push({})}return c&&c.forEach((f,v)=>{const C=t.getDataRange().endRow+1,{cellMatrix:_,rowProperties:R,colProperties:w}=this._parseTable(f,v);_&&_.forValue((P,y,M)=>{t.setValue(C+P,y,M)}),w&&l.push(...w),s.push(...R)}),this.dispose(),{rowProperties:s,colProperties:l,cellMatrix:t}}_getStyleBySelectorText(o,e){var r;const t=(r=this._styleMap.get(o))==null?void 0:r.getPropertyValue(e);return t||""}_getStyle(o,e){const t=js(e),r=o.style;let i="";for(let s=0;s<Bs.length;s++){const l=Bs[s];if(l==="background"){let d="";o.classList.forEach(h=>{d=this._getStyleBySelectorText(`.${h}`,"background-color")||this._getStyleBySelectorText(`.${h}`,l)});const u=r.getPropertyValue("background-color")||d||this._getStyleBySelectorText(`#${o.id}`,"background-color")||this._getStyleBySelectorText(`#${o.id}`,l)||this._getStyleBySelectorText(o.nodeName.toLowerCase(),l)||this._getStyleBySelectorText(o.nodeName,"background-color")||t["background-color"]||"";u&&(i+=`background:${u};`);continue}if(l==="text-decoration"){let d="";o.classList.forEach(h=>{d=this._getStyleBySelectorText(`.${h}`,"text-decoration-line")||this._getStyleBySelectorText(`.${h}`,l)});const u=r.getPropertyValue("text-decoration-line")||r.getPropertyValue("text-decoration")||d||this._getStyleBySelectorText(`#${o.id}`,"text-decoration-line")||this._getStyleBySelectorText(`#${o.id}`,l)||this._getStyleBySelectorText(o.nodeName.toLowerCase(),l)||this._getStyleBySelectorText(o.nodeName,"text-decoration-line")||t["text-decoration-line"]||"";u&&(i+=`text-decoration:${u};`);continue}let c="";o.classList.forEach(d=>{c=this._getStyleBySelectorText(`.${d}`,l)}),c=r.getPropertyValue(l)||this._getStyleBySelectorText(`#${o.id}`,l)||c||this._getStyleBySelectorText(o.nodeName.toLowerCase(),l)||t[l]||"",c&&(i+=`${l}:${c};`)}return i}_parseTable(o,e){var l,c;const t=new a.ObjectMatrix,r=(l=nu(o))!=null?l:[],{rowProperties:i=[]}=tu(o),s=this._parseTableByHtml(this._dom,e,(c=this._getCurrentSkeleton())==null?void 0:c.skeleton);return s&&s.forValue((d,u,h)=>{var p,f,v,C,_,R,w,P,y,M,x,A,D,N,V,H,k,U,L,j,B,z,X,K;let g=I.handleStringToStyle(void 0,h.style);if((C=(v=(f=(p=h==null?void 0:h.richTextParma)==null?void 0:p.p)==null?void 0:f.body)==null?void 0:v.textRuns)!=null&&C.length){const ie=(R=(_=h==null?void 0:h.richTextParma)==null?void 0:_.v)==null?void 0:R.length;for(let re=0;re<((M=(y=(P=(w=h==null?void 0:h.richTextParma)==null?void 0:w.p)==null?void 0:P.body)==null?void 0:y.textRuns)==null?void 0:M.length);re++){const le=(D=(A=(x=h==null?void 0:h.richTextParma)==null?void 0:x.p)==null?void 0:A.body)==null?void 0:D.textRuns[re];le.st===0&&le.ed===ie&&(g={...le.ts,...g},(H=(V=(N=h==null?void 0:h.richTextParma)==null?void 0:N.p)==null?void 0:V.body)==null||H.textRuns.splice(re,1),re--)}((j=(L=(U=(k=h==null?void 0:h.richTextParma)==null?void 0:k.p)==null?void 0:U.body)==null?void 0:L.textRuns)==null?void 0:j.length)===0&&(h.content=(B=h==null?void 0:h.richTextParma)==null?void 0:B.v,delete h.richTextParma)}const S=(K=(X=(z=h==null?void 0:h.richTextParma)==null?void 0:z.p)==null?void 0:X.body)!=null&&K.textRuns?{v:h.richTextParma.v,p:h.richTextParma.p,s:g,rowSpan:h.rowSpan,colSpan:h.colSpan}:{v:h.content,s:g,rowSpan:h.rowSpan,colSpan:h.colSpan};t.setValue(d,u,S)}),{rowProperties:i,colProperties:r,cellMatrix:t}}_parseTableByHtml(o,e,t){var c,d;const r=new a.ObjectMatrix,i=o.querySelectorAll("table")[e];if(!i)return r;const s=this._getStyle(i,""),l=i==null?void 0:i.querySelectorAll("tr");for(let u=0;u<l.length;u++){const h=l[u],g=this._getStyle(h,s),S=h.querySelectorAll("td, th");let p=0;for(let f=0;f<S.length;){const v=S[f];let C="";const _=Number(v.getAttribute("rowSpan"))||1,R=Number(v.getAttribute("colSpan"))||1;if(C=this._getStyle(v,g),u>0){const M=r.getValue(u-1,p);if((c=M==null?void 0:M.style)!=null&&c.includes("border-bottom")&&C.includes("border-top")){const x=zs(M.style,"border-bottom");x&&I.textTrim(x.substr(x.indexOf(":")+1))!=="none"&&(C=C.replace(/border-top:[^;]+;/,""))}}if(f>0){const M=r.getValue(u,p-1);if((d=M==null?void 0:M.style)!=null&&d.includes("border-right")&&C.includes("border-left")){const x=zs(M.style,"border-right");x&&I.textTrim(x.substr(x.indexOf(":")+1))!=="none"&&(C=C.replace(/border-left:[^;]+;/,""))}}const{cellText:w,cellRichStyle:P}=this._getCellTextAndRichText(v,C,t),y={rowSpan:_,colSpan:R,content:w,style:C,richTextParma:{p:P,v:w}};if(r.getValue(u,p)){p+=1;continue}else _>1||R>1?ou(r,C,y,{colSpan:R,rowSpan:_,rowIndex:u,colSetValueIndex:p}):r.setValue(u,p,y),p+=R,f++}}return r}_parseCellHtml(o,e,t,r=new Map,i){var s;for(const l of e)if(l.nodeType===Node.TEXT_NODE){const c=(s=l.nodeValue)==null?void 0:s.replace(/[\r\n]/g,"");let d;o&&r.has(o)&&(d=r.get(o)),t.dataStream+=c,d&&Object.getOwnPropertyNames(d).length&&t.textRuns.push({st:t.dataStream.length-c.length,ed:t.dataStream.length,ts:d})}else{if(l.nodeType===Node.COMMENT_NODE||l.nodeName==="STYLE")continue;if(l.nodeName.toLowerCase()==="br")t.paragraphs||(t.paragraphs=[]),t.paragraphs.push({startIndex:t.dataStream.length}),t.dataStream+="\r";else if(l.nodeType===Node.ELEMENT_NODE){const c=this._getStyle(l,i),d=o?r.get(o):{},u=js(c),h=eo(l,u);r.set(l,{...d,...h});const{childNodes:g}=l;this._parseCellHtml(l,g,t,r,c)}}}_getCellTextAndRichText(o,e,t){var l;if(o.innerHTML.includes("mso-spacerun:yes")){const c=o.innerHTML.replace(/<span[^>]*mso-spacerun:yes[^>]*>[\s\S]*?<\/span>/gi,""),d=a.numfmt.parseNumber(c);if(d&&d.v!==void 0&&d.v!==null)return{cellText:c,cellRichStyle:void 0}}let r="",i;if(/<[^>]+>/.test(o.innerHTML)&&t){const c={dataStream:"",textRuns:[]};this._parseCellHtml(null,o.childNodes,c,void 0,e);const d=(l=t.getBlankCellDocumentModel())==null?void 0:l.documentModel,u=d==null?void 0:d.getSnapshot(),h=`${c.dataStream}\r
`,g={...u,body:{dataStream:h,textRuns:c.textRuns,paragraphs:Bo(h)}};d==null||d.reset(g),i=d==null?void 0:d.getSnapshot(),r=c.dataStream}else r=ru(o.innerHTML.replace(/[\r\n]/g,""));return{cellText:r,cellRichStyle:i}}_generateDocumentDataModelSnapshot(o){var l;const e=this._getCurrentSkeleton();if(e==null)return null;const{skeleton:t}=e,r=(l=t.getBlankCellDocumentModel())==null?void 0:l.documentModel,s={...r==null?void 0:r.getSnapshot(),...o};return r==null||r.reset(s),r==null?void 0:r.getSnapshot()}process(o,e,t,r){var i,s,l;for(const c of e)if(c.nodeName.toLowerCase()==="table")r.push({index:((i=t==null?void 0:t.paragraphs)==null?void 0:i.length)||0});else if(c.nodeType===Node.TEXT_NODE){if(((s=c.nodeValue)==null?void 0:s.trim())==="")continue;const d=(l=c.nodeValue)==null?void 0:l.replace(/[\r\n]/g,"");let u;o&&this._styleCache.has(o)&&(u=this._styleCache.get(o));const h={dataStream:"",textRuns:[]};t.dataStream+=d,h.dataStream+=d,u&&Object.getOwnPropertyNames(u).length&&(t.textRuns.push({st:t.dataStream.length-d.length,ed:t.dataStream.length,ts:u}),h.textRuns.push({st:t.dataStream.length-d.length,ed:t.dataStream.length,ts:u}))}else{if(a.skipParseTagNames.includes(c.nodeName.toLowerCase()))continue;if(c.nodeName.toLowerCase()==="br")t.paragraphs||(t.paragraphs=[]),t.paragraphs.push({startIndex:t.dataStream.length}),t.dataStream+="\r";else if(c.nodeType===Node.ELEMENT_NODE){if(c.nodeName==="STYLE")continue;const d=c,u=this._processBeforeLink(d,{body:t}),h=o?this._styleCache.get(o):{},g=this._styleRules.find(({filter:v})=>Fs(c,v)),S=g?g.getStyle(c):eo(c);this._styleCache.set(c,{...h,...S});const{childNodes:p}=c;this.process(c,p,t,r);const f=this._afterProcessRules.find(({filter:v})=>Fs(c,v));f&&f.handler(t,c),this._processAfterLink(d,{body:t},u)}}}_processBeforeLink(o,e){return e.body.dataStream.length}_processAfterLink(o,e,t){var s,l;const r=e.body,i=o;i.tagName.toUpperCase()==="A"&&(r.customRanges=(s=r.customRanges)!=null?s:[],r.customRanges.push({startIndex:t,endIndex:r.dataStream.length-1,rangeId:(l=i.dataset.rangeid)!=null?l:a.generateRandomId(),rangeType:a.CustomRangeType.HYPERLINK,properties:{url:i.href}}))}dispose(){this._dom=null,this._styleCache.clear(),this._styleMap.clear()}};E(Eo,"_pluginList",[]);let Sn=Eo;function tu(n){const o=/<tr([\s\S]*?)>([\s\S]*?)<\/tr>/gi,e=n.matchAll(o);if(!e)return{rowProperties:[],rowCount:0};const r=Array.from(e).map(i=>Ba(i[1])).map(i=>{if(!i.height){const s=i.style,l=s&&s.match(/height\s*:\s*(\d+(\.\d+)?)px/);i.height=`${l?Number.parseInt(l[1],10):a.DEFAULT_WORKSHEET_ROW_HEIGHT}`}return i});return{rowProperties:r,rowCount:r.length}}function js(n){const o={};return n.split(";").forEach(t=>{const[r,i]=t.split(":");o[r]=i}),o}function Ba(n){if(!n)return{};const o={},e=/([\w-]+)\s*=\s*(?:(['"])([^'"]*)\2|(\S+))/g;let t;for(;(t=e.exec(n))!==null;){const[,r,,i,s]=t,l=i!==void 0?i:s;o[r]=l}return o}function nu(n){const o=/<colgroup([\s\S]*?)>(.*?)<\/colgroup>/,e=n.match(o),t=/<col([\s\S]*?)>/g;let r;if(e!=null&&e[2]?r=e[2].matchAll(t):r=n.matchAll(t),!r)return null;const i=Array.from(r).map(l=>Ba(l[1])),s=[];return i.forEach(l=>{const c=Number(l.span);if(c)for(let d=0;d<c;d++){const u={...l};delete u.span,s.push(u)}else s.push(l)}),s}function ru(n){const o={"&lt;":"<","&gt;":">","&amp;":"&","&quot;":'"',"&#39;":"'","&nbsp;":" "};return n.replace(/&lt;|&gt;|&amp;|&quot;|&#39;|&nbsp;|<br>/g,e=>o[e])}function zs(n,o){if(!n||!o)return null;const e=new RegExp(`(${o}\\s*:\\s*[^;]+);`,"i"),t=n.match(e);return t?t[1]:null}function ou(n,o,e,t){const{rowSpan:r,colSpan:i,rowIndex:s,colSetValueIndex:l}=t;for(let c=s;c<s+r;c++)for(let d=l;d<l+i;d++)c===s&&d===l?n.setValue(c,d,{...e,style:o}):n.setValue(c,d,{style:o})}const iu={name:"univer-doc-paste-plugin-lark",checkPasteType(n){return/lark-record-clipboard/i.test(n)},stylesRules:[{filter:["s"],getStyle(n){const o=eo(n);return{st:{s:a.BooleanNumber.TRUE},...o}}}],afterProcessRules:[{filter(n){return n.tagName==="DIV"&&/ace-line/i.test(n.className)},handler(n){n.paragraphs==null&&(n.paragraphs=[]),n.paragraphs.push({startIndex:n.dataStream.length}),n.dataStream+="\r"}}]},su={name:"univer-doc-paste-plugin-univer",checkPasteType(n){return/UniverNormal/i.test(n)},stylesRules:[],afterProcessRules:[{filter(n){return n.tagName==="P"&&/UniverNormal/i.test(n.className)},handler(n,o){n.paragraphs==null&&(n.paragraphs=[]);const e={startIndex:n.dataStream.length},t=La(o);t&&(e.paragraphStyle=t),n.paragraphs.push(e),n.dataStream+="\r"}}]},au={name:"univer-doc-paste-plugin-word",checkPasteType(n){return/word|mso/i.test(n)},stylesRules:[{filter:["b"],getStyle(n){const o=eo(n);return{bl:a.BooleanNumber.TRUE,...o}}}],afterProcessRules:[{filter(n){return n.tagName==="P"&&/mso/i.test(n.className)},handler(n,o){n.paragraphs==null&&(n.paragraphs=[]);const e={startIndex:n.dataStream.length},t=La(o);t&&(e.paragraphStyle=t),n.paragraphs.push(e),n.dataStream+="\r"}}]};var et=(n=>(n.COPY="COPY",n.CUT="CUT",n))(et||{});function lu(n,o,e,t,r){const i=e.map(d=>{var u;return(u=d.onCopyRow)==null?void 0:u.call(d,n)}).filter(d=>!!d),s=Ki(i),l=qi(s),c=o.map(d=>{if(!r.has(`${n}-${d}`)){const u=t.getValue(n,d);if(u!=null&&u.rowSpan&&(u!=null&&u.colSpan))for(let h=n;h<n+u.rowSpan;h++)for(let g=d;g<d+u.colSpan;g++)r.add(`${h}-${g}`);return cu(n,d,e,t)}return null}).filter(d=>!!d).join("");return`<tr${l}>${c}</tr>`}function cu(n,o,e,t){const r=t.getValue(n,o),i=e.map(d=>{var u;return(u=d.onCopyCellStyle)==null?void 0:u.call(d,n,o,r==null?void 0:r.rowSpan,r==null?void 0:r.colSpan)}).filter(d=>!!d),s=Ki(i),l=qi(s),c=e.reduce((d,u)=>{var h;return d||((h=u.onCopyCellContent)==null?void 0:h.call(u,n,o))||""},"");return`<td${l}>${c}</td>`}function du(n,o){return`<colgroup>${n.map(t=>{const r=o.map(l=>{var c;return(c=l.onCopyColumn)==null?void 0:c.call(l,t)}).filter(l=>!!l),i=Ki(r);return`<col ${qi(i)} />`}).join("")}</colgroup>`}function Ki(n){return n.reduce((o,e)=>(Object.keys(e).forEach(r=>{o[r]?o[r]+=`;${e[r]}`:o[r]=e[r]}),o),{})}function qi(n){return Object.keys(n).reduce((o,e)=>`${o} ${e}="${n[e]}"`,"")}class uu{convert(o,e,t){const{cols:r,rows:i}=e;if(!r.length)return"";const s=du(r,t),l=[],c=new Set;return i.forEach(u=>{l.push(lu(u,r,t,o,c))}),`<google-sheets-html-origin><table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" cellpadding="0" dir="ltr" style="table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none">${s}
<tbody>${l.join("")}</tbody></table>`}}const hu=(n,o,e=!1)=>{const t=h=>h.endRow-h.startRow+1,r=h=>h.endColumn-h.startColumn+1,i=t(o)%t(n),s=r(o)%r(n),l={startRow:0,endRow:t(n)-1,startColumn:0,endColumn:r(n)-1},c=Math.floor(t(o)/t(n)),d=Math.floor(r(o)/r(n)),u=[];if(!i&&!s)for(let h=1;h<=c;h++)for(let g=1;g<=d;g++){const S=t(n)*(h-1),p=r(n)*(g-1),f={startRow:S+o.startRow,endRow:S+o.startRow,startColumn:p+o.startColumn,endColumn:p+o.startColumn};u.push({repeatRelativeRange:l,startRange:f})}else if(!i&&s&&!e)for(let h=1;h<=c;h++){const g=t(n)*(h-1),S=0,p={startRow:g+o.startRow,endRow:g+o.startRow,startColumn:S+o.startColumn,endColumn:S+o.startColumn};u.push({repeatRelativeRange:l,startRange:p})}else if(i&&!s&&!e)for(let h=1;h<=d;h++){const S=r(n)*(h-1),p={startRow:0+o.startRow,endRow:0+o.startRow,startColumn:S+o.startColumn,endColumn:S+o.startColumn};u.push({repeatRelativeRange:l,startRange:p})}else{const h={startRow:o.startRow,endRow:o.startRow,startColumn:o.startColumn,endColumn:o.startColumn};u.push({startRange:h,repeatRelativeRange:l})}return u};function Xs(n){return n?[/<td[^>]*class=".*?xl.*?"[^>]*>/i,/xmlns:x="urn:schemas-microsoft-com:office:excel"/i,/ProgId="Excel.Sheet"/i,/xmlns:o="urn:schemas-microsoft-com:office:office"/i,/@mso-|mso-excel/i,/<x:ExcelWorkbook>/i].some(e=>e.test(n)):!1}function mu(n){if(!n)return!1;const o=/<img[^>]*src\s*=\s*["']data:image\/[^;]+;base64,[^"']*["'][^>]*>/i;return(n.match(o)||[]).length>0}function gu(...n){if(n.length===1)return n[0];const o=new a.ObjectMatrix;return n.forEach(e=>{e&&new a.ObjectMatrix(e).forValue((r,i,s)=>{o.setValue(r,i,{...o.getValue(r,i),...s})})}),o.getMatrix()}function Su(n,o){return n.id===o.id&&n.params.unitId===o.params.unitId&&n.params.subUnitId===o.params.subUnitId}function Mi(n){const o=[];for(let e=0;e<n.length;){let t=1;if(n[e].id===m.SetRangeValuesMutation.id){const r=n[e],i=[r];for(;e+t<n.length&&Su(r,n[e+t]);)i.push(n[e+t]),t+=1;const s=gu(...i.map(l=>l.params.cellValue||{}));o.push({...r,params:{...r.params,cellValue:s}})}else o.push(n[e]);e+=t}return o}function Fo(n,o){const{startRow:e,endRow:t,startColumn:r,endColumn:i}=n;for(let s=e;s<=t;s++)for(let l=r;l<=i;l++)if(o.rows.includes(s)&&o.cols.includes(l))return!0}function Ys(n,o){const{startRow:e,endRow:t,startColumn:r,endColumn:i}=o;for(let s=e;s<=t;s++)if(!n.rows.includes(s))return!1;for(let s=r;s<=i;s++)if(!n.cols.includes(s))return!1;return!0}function pu(n){const o=n.trim().split(`
`);let e="<table>";return o.forEach(t=>{const r=t.split("	");e+="<tr>",r.forEach(i=>{e+=`<td>${i}</td>`}),e+="</tr>"}),e+="</table>",e}var fu=Object.getOwnPropertyDescriptor,vu=(n,o,e,t)=>{for(var r=t>1?void 0:t?fu(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Te=(n,o)=>(e,t)=>o(e,t,n);const ge={DEFAULT_COPY:"default-copy",DEFAULT_PASTE:"default-paste",SPECIAL_PASTE_VALUE:"special-paste-value",SPECIAL_PASTE_FORMAT:"special-paste-format",SPECIAL_PASTE_COL_WIDTH:"special-paste-col-width",SPECIAL_PASTE_BESIDES_BORDER:"special-paste-besides-border",SPECIAL_PASTE_FORMULA:"special-paste-formula"},Cu={[I.FILE_PNG_CLIPBOARD_MIME_TYPE]:"png",[I.FILE__JPEG_CLIPBOARD_MIME_TYPE]:"jpg",[I.FILE__WEBP_CLIPBOARD_MIME_TYPE]:"webp",[I.FILE__BMP_CLIPBOARD_MIME_TYPE]:"bmp"};Sn.use(au);Sn.use(iu);Sn.use(su);const ke=a.createIdentifier("sheet.clipboard-service");exports.SheetClipboardService=class extends a.Disposable{constructor(e,t,r,i,s,l,c,d,u,h,g,S,p,f){super();E(this,"_clipboardHooks",[]);E(this,"_clipboardHooks$",new O.BehaviorSubject([]));E(this,"clipboardHooks$",this._clipboardHooks$.asObservable());E(this,"_htmlToUSM");E(this,"_usmToHtml");E(this,"_copyContentCache");E(this,"_copyMarkId",null);E(this,"_pasteOptionsCache$",new O.BehaviorSubject(null));E(this,"pasteOptionsCache$",this._pasteOptionsCache$.asObservable());E(this,"_showMenu$",new O.BehaviorSubject(!1));E(this,"showMenu$",this._showMenu$.asObservable());this._logService=e,this._univerInstanceService=t,this._selectionManagerService=r,this._clipboardInterfaceService=i,this._undoRedoService=s,this._commandService=l,this._markSelectionService=c,this._notificationService=d,this._platformService=u,this._renderManagerService=h,this._themeService=g,this._localeService=S,this._errorService=p,this._injector=f,this._htmlToUSM=new Sn({getCurrentSkeleton:()=>{var v;return(v=T.withCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,exports.SheetSkeletonManagerService,this._univerInstanceService,this._renderManagerService))==null?void 0:v.getCurrentParam()}}),this._usmToHtml=new uu,this._copyContentCache=new Jd,this.disposeWithMe(this._htmlToUSM),this._initUnitDisposed()}setShowMenu(e){this._showMenu$.next(e)}getPasteMenuVisible(){return this._showMenu$.getValue()}getPasteOptionsCache(){return this._pasteOptionsCache$.getValue()}copyContentCache(){return this._copyContentCache}generateCopyContent(e,t,r,i=et.COPY){const s=this._clipboardHooks;s.forEach(c=>{var d;return(d=c.onBeforeCopy)==null?void 0:d.call(c,e,t,r,i)});const l=this._generateCopyContent(e,t,r,this._clipboardHooks);return s.forEach(c=>{var d;return(d=c.onAfterCopy)==null?void 0:d.call(c)}),l}async copy(e=et.COPY){const t=this._selectionManagerService.getCurrentLastSelection();if(!t)return!1;const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),i=r.getActiveSheet();if(!i)return!1;const s=r.getUnitId(),l=i.getSheetId(),c=this.generateCopyContent(s,l,t.range);if(!c)return!1;const{html:d,plain:u,matrixFragment:h,copyId:g,discreteRange:S}=c;this._copyContentCache.set(g,{unitId:r.getUnitId(),subUnitId:i.getSheetId(),range:S,matrix:h,copyType:e}),await this._clipboardInterfaceService.write(u,d),this._markSelectionService.removeAllShapes();const p=Ua(this._themeService);return this._copyMarkId=this._markSelectionService.addShape({...t,style:p}),!0}async cut(){return this.copy(et.CUT)}async paste(e,t=ge.DEFAULT_PASTE){const r=e.types,i=r.indexOf(I.PLAIN_TEXT_CLIPBOARD_MIME_TYPE)!==-1?await e.getType(I.PLAIN_TEXT_CLIPBOARD_MIME_TYPE).then(d=>d&&d.text()):"",s=r.indexOf(I.HTML_CLIPBOARD_MIME_TYPE)!==-1?await e.getType(I.HTML_CLIPBOARD_MIME_TYPE).then(d=>d&&d.text()):"",l=r.findIndex(d=>I.imageMimeTypeSet.has(d)),c=l===-1||!mu(s);if(s&&c)return this._platformService.isWindows&&Xs(s)&&this._notificationService.show({type:"warning",title:this._localeService.t("clipboard.shortCutNotify.title"),content:this._localeService.t("clipboard.shortCutNotify.useShortCutInstead")}),this._pasteHTML(s,t);if(l!==-1){const d=r[l],u=await e.getType(d);if(u){const h=Cu[d],g=new File([u],`clipboard-image.${h}`,{type:d});return this._pasteFiles([g],t)}}return i?this._pastePlainText(i,t):(this._logService.error("[SheetClipboardService]","No valid data on clipboard"),!1)}async legacyPaste(e,t,r){const i=Xs(e!=null?e:"");return r&&!i?this._pasteFiles(r,ge.DEFAULT_PASTE):e?this._pasteHTML(e,ge.DEFAULT_PASTE):t?/[\n\t]/.test(t)?this._pasteHTML(pu(t),ge.DEFAULT_PASTE):this._pastePlainText(t,ge.DEFAULT_PASTE):this._pasteUnrecognized()}rePasteWithPasteType(e){const t=this._pasteOptionsCache$.getValue();if(!t)return!1;const r=this._injector.get(a.IUndoRedoService),i=r.pitchTopUndoElement();i&&a.sequenceExecute(i.undoMutations,this._commandService)&&r.popUndoToRedo();const{cellMatrix:s,rowProperties:l=[],colProperties:c=[],source:d,target:u}=t;return this._pasteUSM({cellMatrix:s,colProperties:c,rowProperties:l},u,ge[e],d),!0}updatePasteOptionsCache(e){this._pasteOptionsCache$.next(e)}addClipboardHook(e){if(this._clipboardHooks.findIndex(r=>r.id===e.id)!==-1)return this._logService.error("[SheetClipboardService]","hook already exists",e.id),{dispose:()=>{}};const t=this._clipboardHooks.findIndex(r=>{const i=r.priority||0;return(e.priority||0)<i});return this._clipboardHooks.splice(t!==-1?t:this._clipboardHooks.length,0,e),this._notifyClipboardHook(),a.toDisposable(()=>{const r=this._clipboardHooks.indexOf(e);r>-1&&(this._clipboardHooks.splice(r,1),this._notifyClipboardHook())})}getClipboardHooks(){return this._clipboardHooks}_generateCopyContent(e,t,r,i){const s=this._univerInstanceService.getUniverSheetInstance(e),l=s==null?void 0:s.getSheetBySheetId(t);if(!s||!l)return null;const c=i.reduce((P,y)=>{var x;const M=(x=y.getFilteredOutRows)==null?void 0:x.call(y,r);return M==null||M.forEach(A=>P.add(A)),P},new Set),{startColumn:d,startRow:u,endColumn:h,endRow:g}=r,S=l.getMatrixWithMergedCells(u,d,g,h,a.CellModeEnum.Both),p=new a.ObjectMatrix;let f=u;const v=new a.ObjectMatrix,C={rows:[],cols:[]};for(let P=u;P<=g;P++)if(!c.has(P)){C.rows.push(P);for(let y=d;y<=h;y++){const M=S.getValue(P,y);if(M){const x=a.Tools.deepClone(M);v.setValue(f-u,y-d,{...Bn(),...x}),delete x.displayV,p.setValue(f-u,y-d,{...Bn(),...x})}else v.setValue(f-u,y-d,Bn()),p.setValue(f-u,y-d,Bn()),S.setValue(P,y,Bn())}f+=1}for(let P=d;P<=h;P++)C.cols.push(P);let _=this._usmToHtml.convert(S,C,i);const R=Fa(v),w=qd();return _=_.replace(/(<[a-z]+)/,(P,y)=>`${y} data-copy-id="${w}"`),{copyId:w,plain:R,html:_,matrixFragment:p,discreteRange:C}}_notifyClipboardHook(){this._clipboardHooks$.next(this._clipboardHooks)}async _executePaste(e){const t=this._getPastingTarget();if(!t.subUnitId||!t.selection)return!1;const r=this._injector.invoke(S=>m.rangeToDiscreteRange(t.selection.range,S,t.unitId,t.subUnitId));if(!r)return!1;const{unitId:i,subUnitId:s}=t,l=this._clipboardHooks,c=[];if(l.some(S=>{var p;return c.push(S)&&((p=S.onBeforePaste)==null?void 0:p.call(S,{unitId:i,subUnitId:s,range:r}))===!1}))return c.forEach(S=>{var p;return(p=S.onAfterPaste)==null?void 0:p.call(S,!1)}),!1;const u=[],h=[];c.forEach(S=>{const p=e(S,{unitId:i,subUnitId:s,range:r});p&&(u.push(...p.redos),h.push(...p.undos))});const g=u.every(S=>this._commandService.executeCommand(S.id,S.params));return g&&this._undoRedoService.pushUndoRedo({unitID:this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId(),undoMutations:h,redoMutations:u}),g}async _pasteFiles(e,t){return this._executePaste((r,i)=>{var s;return(s=r.onPasteFiles)==null?void 0:s.call(r,i,e,{pasteType:t})})}async _pastePlainText(e,t){return this._executePaste((r,i)=>{var s;return(s=r.onPastePlainText)==null?void 0:s.call(r,i,e,{pasteType:t})})}_pasteUnrecognized(){return this._executePaste((e,t)=>{var r;return(r=e.onPasteUnrecognized)==null?void 0:r.call(e,t)})}async _pasteHTML(e,t){const r=Qd(e);return r&&this._copyContentCache.get(r)?this._pasteInternal(r,t):this._pasteExternal(e,t)}async _pasteExternal(e,t){var h;const{rowProperties:r,colProperties:i,cellMatrix:s}=this._htmlToUSM.convert(e);if(!s)return!1;const l=this._getPastedRange(s);if(!l)return!1;const c=(h=this._univerInstanceService.getUniverSheetInstance(l.unitId))==null?void 0:h.getSheetBySheetId(l.subUnitId);if(!c)return!1;const d=c==null?void 0:c.getMergeData();return d.length&&d.some(S=>Fo(S,l.pastedRange)&&!Ys(l.pastedRange,S))?(this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")),!1):this._pasteUSM({rowProperties:r,colProperties:i,cellMatrix:s},l,t)}async _pasteInternal(e,t){var P,y;const r=a.Tools.deepClone(this._copyContentCache.get(e)),{range:i,matrix:s,unitId:l,subUnitId:c}=r||{};if(!s||!r||!i||!l||!c||!s||!r)return!1;const{mapFunc:d}=St([i]),u=(P=this._univerInstanceService.getUniverSheetInstance(l))==null?void 0:P.getSheetBySheetId(c);s.forValue((M,x,A)=>{const{row:D,col:N}=d(M,x),V=u==null?void 0:u.getComposedCellStyle(D,N),H=a.Tools.deepClone(A);if(H.s=V,s.setValue(M,x,H),A.colSpan||A.rowSpan)for(let k=0;k<A.rowSpan;k++)for(let U=0;U<A.colSpan;U++){if(k===0&&U===0)continue;const L=M+k,j=x+U;s.setValue(L,j,{s:V})}});const h=this._getPastedRange(s);if(!h)return!1;const g=(y=this._univerInstanceService.getUniverSheetInstance(h.unitId))==null?void 0:y.getSheetBySheetId(h.subUnitId);if(!g)return!1;const S=g==null?void 0:g.getMergeData();if(S&&S.some(x=>Fo(x,h.pastedRange)&&!Ys(h.pastedRange,x)))return this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")),!1;const p=this._univerInstanceService.getUnit(l);if(!p)return!1;const f=p.getSheetBySheetId(c);if(!f)return!1;const v=f.getColumnManager(),C=f.getRowManager(),_=[],R=[];if(i.cols.forEach(M=>{_.push({width:`${v.getColumnWidth(M)}`})}),i.rows.forEach(M=>{R.push({height:`${C.getRowHeight(M)}`})}),r.copyType===et.CUT){const M=h.pastedRange.rows[0],x=i.rows[i.rows.length-1]-i.rows[0]+M;h.pastedRange.rows=Array.from(new Array(x+1).keys()).slice(M)}const w=this._pasteUSM({cellMatrix:s,colProperties:_,rowProperties:R},h,t,{range:i,unitId:r.unitId,subUnitId:r.subUnitId,copyType:r.copyType,copyId:e});return r.copyType===et.CUT&&(this._copyContentCache.set(e,{...r,matrix:null}),this._copyMarkId&&this._markSelectionService.removeShape(this._copyMarkId),this._copyMarkId=null),w}_pasteUSM(e,t,r,i){const{rowProperties:s,colProperties:l,cellMatrix:c}=e,{unitId:d,subUnitId:u,pastedRange:h}=t,g=h.cols.length,S=this._clipboardHooks,p=[];if(S.some(M=>{var x;return p.push(M)&&((x=M.onBeforePaste)==null?void 0:x.call(M,{unitId:d,subUnitId:u,range:h}))===!1}))return p.forEach(M=>{var x;return(x=M.onAfterPaste)==null?void 0:x.call(M,!1)}),!1;if(!c)return!1;const v=i?{unitId:i.unitId,subUnitId:i.subUnitId,range:i.range}:null,C={copyType:(i==null?void 0:i.copyType)||et.COPY,copyId:i==null?void 0:i.copyId,pasteType:r};let _=[],R=[];const w=p.filter(M=>!M.specialPasteInfo&&M.id!==ge.DEFAULT_PASTE||r===M.id);w.forEach(M=>{var D,N,V;if(s){const H=(D=M.onPasteRows)==null?void 0:D.call(M,{range:h,unitId:d,subUnitId:u},s,{pasteType:r});H&&(_.push(...H.redos),R.push(...H.undos))}const x=(N=M.onPasteColumns)==null?void 0:N.call(M,{range:h,unitId:d,subUnitId:u},l||new Array(g).map(()=>({})),{pasteType:r});x&&(_.push(...x.redos),R.push(...x.undos));const A=(V=M.onPasteCells)==null?void 0:V.call(M,v,{range:h,unitId:d,subUnitId:u},c,C);A&&(_.push(...A.redos),R.push(...A.undos))});const P=this._getSetSelectionOperation(d,u,h,c,r);P&&_.push(P),_=Mi(_),R=Mi(R),R.push({id:m.SetWorksheetActiveOperation.id,params:{unitId:t.unitId,subUnitId:t.subUnitId}}),this._logService.log("[SheetClipboardService]","pasting mutations",{undoMutationsInfo:R,redoMutationsInfo:_});const y=_.every(M=>this._commandService.syncExecuteCommand(M.id,M.params));return y&&(this._undoRedoService.pushUndoRedo({unitID:d,undoMutations:R,redoMutations:_}),this.updatePasteOptionsCache({target:{pastedRange:h,unitId:d,subUnitId:u},cellMatrix:c,rowProperties:s,colProperties:l,pasteType:r,source:i}),this.setShowMenu(!0)),w.forEach(M=>{var x;return(x=M.onAfterPaste)==null?void 0:x.call(M,y)}),y}_getSetSelectionOperation(e,t,r,i,s){var P;const l=(P=this._univerInstanceService.getUniverSheetInstance(e))==null?void 0:P.getSheetBySheetId(t);if(!l)return null;const{rows:c,cols:d}=r,u=c[0],h=d[0],g=c[c.length-1],S=d[d.length-1],p={startRow:u,endRow:u,startColumn:h,endColumn:h},f=m.getPrimaryForRange(p,l),v=i.getValue(0,0),C=(v==null?void 0:v.rowSpan)||1,_=(v==null?void 0:v.colSpan)||1;if((s===ge.DEFAULT_PASTE||s===ge.SPECIAL_PASTE_BESIDES_BORDER||s===ge.SPECIAL_PASTE_FORMAT)&&(C>1||_>1)){const y={startRow:u,endRow:u+C-1,startColumn:h,endColumn:h+_-1};f.startRow=y.startRow,f.endRow=y.endRow,f.startColumn=y.startColumn,f.endColumn=y.endColumn,f.isMerged=!0,f.isMergedMainCell=!0}const w={unitId:e,subUnitId:t,selections:[{range:{startRow:u,endRow:g,startColumn:h,endColumn:S},primary:f,style:null}]};return{id:m.SetSelectionsOperation.id,params:w}}_getPastingTarget(){const e=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),t=e.getActiveSheet(),r=this._selectionManagerService.getCurrentLastSelection();return{unitId:e.getUnitId(),subUnitId:t==null?void 0:t.getSheetId(),selection:r}}_transformPastedData(e,t,r){const i=this._getPastingTarget(),{selection:s,unitId:l,subUnitId:c}=i;if(!c||!s)return null;const d=this._injector.invoke(N=>m.rangeToDiscreteRange(s.range,N,l,c));if(!d)return null;const{ranges:[u],mapFunc:h}=St([d]),{startRow:g,startColumn:S,endRow:p,endColumn:f}=u,v=p-g+1,C=f-S+1,_=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),R=_==null?void 0:_.getActiveSheet();if(!R)return null;const P=R.getMergeData().filter(N=>d.rows.includes(N.startRow)&&d.cols.includes(N.startColumn)),y=P[0];let M=0,x=0,A=0,D=0;if(y&&(M=y.startRow,x=y.startColumn,A=y.endRow,D=y.endColumn),v%e===0&&C%t===0)if(P.length>0&&(v!==e||C!==t))if(M===d.rows[0]&&x===d.cols[0]&&A===d.rows[v-1]&&D===d.cols[C-1])if(Ru(r))for(let V=0;V<v;V++)for(let H=0;H<C;H++){const k=r.getValue(V%e,H%t);k&&r.setValue(V,H,k)}else r.forValue((V,H,k)=>{k.s=null,delete k.colSpan,delete k.rowSpan});else for(let N=0;N<v;N++)for(let V=0;V<C;V++){const H=r.getValue(N%e,V%t);H&&r.setValue(N,V,H)}else for(let N=0;N<v;N++)for(let V=0;V<C;V++){const H=r.getValue(N%e,V%t);H&&r.setValue(N,V,H)}else if(P.length>0){const{row:N,col:V}=h(g,S);if(this._topLeftCellsMatch(e,t,{topRow:N,leftCol:V})){const k=this._expandOrShrinkRowsCols(l,c,d,t,e);d.rows=k.rows,d.cols=k.cols}else{if(p>y.endRow||f>y.endColumn)return null;r.forValue((k,U,L)=>{L.s=null,delete L.colSpan,delete L.rowSpan})}}else{const N=this._expandOrShrinkRowsCols(l,c,d,t,e);d.rows=N.rows,d.cols=N.cols}return{pastedRange:d,unitId:l,subUnitId:c}}_getPastedRange(e){var R;const t=this._getPastingTarget(),{selection:r,unitId:i,subUnitId:s}=t;if(!s||!r)return null;const l=this._injector.invoke(w=>m.rangeToDiscreteRange(r.range,w,i,s));if(!l)return null;const{startColumn:c,endColumn:d,startRow:u,endRow:h}=e.getDataRange(),g=h-u+1,S=d-c+1;if(g<=0||S<=0)return null;const p=l.rows.length,f=l.cols.length,v=(R=this._univerInstanceService.getUniverSheetInstance(i))==null?void 0:R.getSheetBySheetId(s);if(!v)return null;const C=v==null?void 0:v.getMergeData();if(p%g===0&&f%S===0&&!(C==null?void 0:C.some(P=>Fo(P,l)))){for(let P=0;P<p;P++)for(let y=0;y<f;y++){const M=e.getValue(P%g,y%S);M&&e.setValue(P,y,M)}return{pastedRange:l,unitId:i,subUnitId:s}}const _=this._expandOrShrinkRowsCols(i,s,l,S,g);return l.rows=_.rows,l.cols=_.cols,{pastedRange:l,unitId:i,subUnitId:s}}_expandOrShrinkRowsCols(e,t,r,i,s){const{rows:l,cols:c}=r,d=this._univerInstanceService.getUniverSheetInstance(e),u=d==null?void 0:d.getSheetBySheetId(t);let h,g;if(l.length>=s)h=l.slice(0,s);else{h=l.slice(0);let S=l[l.length-1]+1;for(;h.length<s;)u.getRowFiltered(S)||h.push(S),S++}if(c.length>=i)g=c.slice(0,i);else{g=c.slice(0);let S=c[c.length-1]+1;for(;g.length<i;)g.push(S),S++}return{rows:h,cols:g}}_topLeftCellsMatch(e,t,r){const i=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=i==null?void 0:i.getActiveSheet();if(!s)return!1;const{topRow:l,leftCol:c}=r,d=_u(l+e-1,c,c+t-1,s),u=bu(c+t-1,l,l+e-1,s);return!d&&!u}removeMarkSelection(){this._copyMarkId&&(this._markSelectionService.removeShape(this._copyMarkId),this._copyMarkId=null)}_initUnitDisposed(){this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(a.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{e&&this.copyContentCache().clearWithUnitId(e.getUnitId())}))}disposePasteOptionsCache(){this.setShowMenu(!1),this.updatePasteOptionsCache(null)}};exports.SheetClipboardService=vu([Te(0,a.ILogService),Te(1,a.IUniverInstanceService),Te(2,a.Inject(m.SheetsSelectionsService)),Te(3,I.IClipboardInterfaceService),Te(4,a.IUndoRedoService),Te(5,a.ICommandService),Te(6,Lt),Te(7,I.INotificationService),Te(8,I.IPlatformService),Te(9,T.IRenderManagerService),Te(10,a.Inject(a.ThemeService)),Te(11,a.Inject(a.LocaleService)),Te(12,a.Inject(a.ErrorService)),Te(13,a.Inject(a.Injector))],exports.SheetClipboardService);function Fa(n){let o="";const e=n.getLength();return n.forRow((t,r)=>{const i=[];r.forEach(s=>{const l=n.getValue(t,s);if(l){const c=Iu(l);i.push(c)}}),o+=i.join("	"),t!==e-1&&(o+=`
`)}),o}function Iu(n){return a.isNotNullOrUndefined(n.displayV)?n.displayV:a.extractPureTextFromCell(n)}function _u(n,o,e,t){return t.getMergeData().some(r=>r.startRow<=n&&n<r.endRow&&o<=r.startColumn&&r.startColumn<=e)}function bu(n,o,e,t){return t.getMergeData().some(r=>r.startColumn<=n&&n<r.endColumn&&o<=r.startRow&&r.startRow<=e)}function Ru(n){let o=0;return n.forValue((e,t,r)=>{if(r&&o++,o>1)return!1}),o>1}function Bn(){return{p:null,v:null,s:null,f:null,si:null,t:null}}const Qi=998,He={id:I.CopyCommand.id,name:"sheet.command.copy",type:a.CommandType.COMMAND,multi:!0,priority:Qi,preconditions:Zi,handler:async n=>n.get(ke).copy()},xo={id:I.CutCommand.id,name:"sheet.command.cut",type:a.CommandType.COMMAND,multi:!0,priority:Qi,preconditions:Zi,handler:async n=>n.get(ke).cut()},Ve={id:I.PasteCommand.id,type:a.CommandType.COMMAND,multi:!0,name:"sheet.command.paste",priority:Qi,preconditions:Zi,handler:async(n,o)=>{const t=await n.get(I.IClipboardInterfaceService).read(),r=n.get(ke);return t.length!==0?r.paste(t[0],o==null?void 0:o.value):!1}},to={id:I.SheetPasteShortKeyCommandName,type:a.CommandType.COMMAND,handler:async(n,o)=>{const e=n.get(ke),{htmlContent:t,textContent:r,files:i}=o;return e.legacyPaste(t,r,i),!0}},on={id:"sheet.command.paste-value",type:a.CommandType.COMMAND,handler:async n=>n.get(a.ICommandService).executeCommand(Ve.id,{value:ge.SPECIAL_PASTE_VALUE})},sn={id:"sheet.command.paste-format",type:a.CommandType.COMMAND,handler:async n=>n.get(a.ICommandService).executeCommand(Ve.id,{value:ge.SPECIAL_PASTE_FORMAT})},yt={id:"sheet.command.paste-col-width",type:a.CommandType.COMMAND,handler:async n=>n.get(a.ICommandService).executeCommand(Ve.id,{value:ge.SPECIAL_PASTE_COL_WIDTH})},an={id:"sheet.command.paste-besides-border",type:a.CommandType.COMMAND,handler:async n=>n.get(a.ICommandService).executeCommand(Ve.id,{value:ge.SPECIAL_PASTE_BESIDES_BORDER})},ja={id:"sheet.command.optional-paste",type:a.CommandType.COMMAND,handler:async(n,{type:o})=>n.get(ke).rePasteWithPasteType(o)},xn={type:a.CommandType.COMMAND,id:"sheet.command.delete-range-move-left-confirm",handler:async n=>{const o=n.get(I.IConfirmService),e=n.get(a.ICommandService),t=n.get(a.LocaleService),r=n.get(m.SheetsSelectionsService),i=n.get(a.IUniverInstanceService),s=r.getCurrentSelections();if(!s)return!1;const l=m.getSheetCommandTarget(i);if(!l)return!1;const{worksheet:c}=l;let d=s[0].range;if(!d)return!1;d={...d,endColumn:c.getColumnCount()-1};const u=S=>S.endRow-S.startRow;return!c.getMergeData().find(S=>{const p=a.Rectangle.getIntersects(S,d);return p?u(S)>u(p):!1})||await o.confirm({id:xn.id,title:{title:t.t("merge.confirm.warning")},children:{title:t.t("merge.confirm.dismantleMergeCellWarning")},cancelText:t.t("button.cancel"),confirmText:t.t("button.confirm")})?e.executeCommand(m.DeleteRangeMoveLeftCommand.id):!0}},kt={type:a.CommandType.COMMAND,id:"sheet.command.delete-range-move-up-confirm",handler:async n=>{const o=n.get(I.IConfirmService),e=n.get(a.ICommandService),t=n.get(a.LocaleService),r=n.get(m.SheetsSelectionsService),i=n.get(a.IUniverInstanceService),s=r.getCurrentSelections();if(!s)return!1;const l=m.getSheetCommandTarget(i);if(!l)return!1;const{worksheet:c}=l;let d=s[0].range;if(!d)return!1;d={...d,endRow:c.getRowCount()-1};for(let S=d.startRow;S<=d.endRow;S++)if(c.getRowFiltered(S)&&await o.confirm({id:kt.id,title:{title:t.t("filter.confirm.error")},children:{title:t.t("filter.confirm.notAllowedToInsertRange")},confirmText:t.t("button.confirm")}))return!1;const u=S=>S.endColumn-S.startColumn;return!c.getMergeData().find(S=>{const p=a.Rectangle.getIntersects(S,d);return p?u(S)>u(p):!1})||await o.confirm({id:kt.id,title:{title:t.t("merge.confirm.warning")},children:{title:t.t("merge.confirm.dismantleMergeCellWarning")},cancelText:t.t("button.cancel"),confirmText:t.t("button.confirm")})?e.executeCommand(m.DeleteRangeMoveUpCommand.id):!0}};var Oo=(n=>(n.MergeAll="mergeAll",n.MergeVertical="mergeVertical",n.MergeHorizontal="mergeHorizontal",n))(Oo||{});function ut(n,o,e,t,r=!0,i=1,s=!0){let l={...n};t==null&&(t={startRow:0,endRow:e.getRowCount()-1,startColumn:0,endColumn:e.getColumnCount()-1});let c;switch(o){case a.Direction.UP:for(c=n.startRow-i;c>-1&&!e.getRowVisible(c);)c-=1;c>=t.startRow?(l.startRow=c,l.endRow=c):s&&(l.startRow=t.endRow,l.endRow=t.endRow,r&&(l=ut(l,a.Direction.LEFT,e,t,!1)));break;case a.Direction.DOWN:for(c=n.endRow+i;c<e.getRowCount()&&!e.getRowVisible(c);)c+=1;c<=t.endRow?(l.startRow=c,l.endRow=c):s&&(l.startRow=t.startRow,l.endRow=t.startRow,r&&(l=ut(l,a.Direction.RIGHT,e,t,!1)));break;case a.Direction.LEFT:for(c=n.startColumn-i;c>-1&&!e.getColVisible(c);)c-=1;c>=t.startColumn?(l.startColumn=c,l.endColumn=c):s&&(l.startColumn=t.endColumn,l.endColumn=t.endColumn,r&&(l=ut(l,a.Direction.UP,e,t,!1)));break;case a.Direction.RIGHT:for(c=n.endColumn+i;c<e.getColumnCount()&&!e.getColVisible(c);)c+=1;c<=t.endColumn?(l.startColumn=c,l.endColumn=c):s&&(l.startColumn=t.startColumn,l.endColumn=t.startColumn,r&&(l=ut(l,a.Direction.DOWN,e,t,!1)));break}return l}function Ji(n,o,e){const t={...n},{startRow:r,startColumn:i,endRow:s,endColumn:l}=rr(n,o,e);let c=Fn(e,r,i,s,l).hasValue,d=!0,u=!0;for(;u;){if(a.Direction.UP===o){let h=t.startRow-1;for(;h>-1&&!e.getRowVisible(h);)h-=1;if(h===-1){u=!1;break}const{hasValue:g,matrix:S}=Fn(e,h,t.startColumn,h,t.endColumn);if(c&&!g&&!d){u=!1;break}else{if(S.getLength()!==0){let p=h;S.forValue(f=>{p=Math.min(f,p)}),t.startRow=p}else t.startRow=h;if(t.endRow=t.startRow,!c&&g){u=!1;break}c=g,d=!1}}if(a.Direction.DOWN===o){let h=t.endRow+1;for(;h<e.getRowCount()&&!e.getRowVisible(h);)h+=1;if(h===e.getRowCount()){u=!1;break}const{hasValue:g,matrix:S}=Fn(e,h,t.startColumn,h,t.endColumn);if(c&&!g&&!d){u=!1;break}else{if(S.getLength()!==0){let p=h;S.forValue((f,v,C)=>{p=Math.max(f+(C.rowSpan||1)-1,p)}),t.endRow=p}else t.endRow=h;if(t.startRow=t.endRow,!c&&g){u=!1;break}c=g,d=!1}}if(a.Direction.LEFT===o){let h=t.startColumn-1;for(;h>-1&&!e.getColVisible(h);)h-=1;if(h===-1){u=!1;break}const{hasValue:g,matrix:S}=Fn(e,t.startRow,h,t.endRow,h);if(c&&!g&&!d){u=!1;break}else{if(S.getLength()!==0){let p=h;S.forValue((f,v)=>{p=Math.min(v,p)}),t.startColumn=p}else t.startColumn=h;if(t.endColumn=t.startColumn,!c&&g){u=!1;break}c=g,d=!1}}if(a.Direction.RIGHT===o){let h=t.endColumn+1;for(;h<e.getColumnCount()&&!e.getColVisible(h);)h+=1;if(h===e.getColumnCount()){u=!1;break}const{hasValue:g,matrix:S}=Fn(e,t.startRow,h,t.endRow,h);if(c&&!g&&!d){u=!1;break}else{if(S.getLength()!==0){let p=h;S.forValue((f,v,C)=>{p=Math.max(v+(C.colSpan||1)-1,p)}),t.endColumn=p}else t.endColumn=h;if(t.startColumn=t.endColumn,!c&&g){u=!1;break}c=g,d=!1}}}return m.alignToMergedCellsBorders(t,e,!0)}function za(n,o,e){return ut(n,o,e,void 0,!1,1,!1)}function wu(n,o,e){const t=Ji(n,o,e);return m.alignToMergedCellsBorders(a.Rectangle.union(t,n),e,!0)}function Eu(n,o,e){const t=za(n,o,e),r={startRow:Math.min(n.startRow,t.startRow),startColumn:Math.min(n.startColumn,t.startColumn),endRow:Math.max(n.endRow,t.endRow),endColumn:Math.max(n.endColumn,t.endColumn)};return m.alignToMergedCellsBorders(a.Rectangle.union(n,r),e)}function Tu(n,o,e,t){const r=a.getReverseDirection(e),i=Ji(rr(n,r,t),e,t);return e===a.Direction.UP&&i.startRow<=n.startRow?m.alignToMergedCellsBorders({...o,startColumn:n.startColumn,endColumn:n.endColumn},t,!0):e===a.Direction.DOWN&&i.endRow>=n.endRow?m.alignToMergedCellsBorders({...o,startColumn:n.startColumn,endColumn:n.endColumn},t,!0):e===a.Direction.LEFT&&i.startColumn<=n.startColumn?m.alignToMergedCellsBorders({...o,startRow:n.startRow,endRow:n.endRow},t,!0):e===a.Direction.RIGHT&&i.endColumn>=n.endColumn?m.alignToMergedCellsBorders({...o,startRow:n.startRow,endRow:n.endRow},t,!0):a.Rectangle.union(a.Rectangle.clone(o),i)}function yu(n,o,e){const t=a.getReverseDirection(o),r=rr(n,t,e),i=rr(n,o,e),s=za(r,o,e);return m.alignToMergedCellsBorders(a.Rectangle.union(i,s),e,!1)}function Zs(n){return{startRow:0,startColumn:0,endRow:n.getRowCount()-1,endColumn:n.getColumnCount()-1,rangeType:a.RANGE_TYPE.ALL}}function rr(n,o,e){let t;switch(o){case a.Direction.UP:t={startRow:n.startRow,startColumn:n.startColumn,endRow:n.startRow,endColumn:n.endColumn,rangeType:a.RANGE_TYPE.NORMAL};break;case a.Direction.DOWN:t={startRow:n.endRow,startColumn:n.startColumn,endRow:n.endRow,endColumn:n.endColumn,rangeType:a.RANGE_TYPE.NORMAL};break;case a.Direction.LEFT:t={startRow:n.startRow,startColumn:n.startColumn,endRow:n.endRow,endColumn:n.startColumn,rangeType:a.RANGE_TYPE.NORMAL};break;case a.Direction.RIGHT:t={startRow:n.startRow,startColumn:n.endColumn,endRow:n.endRow,endColumn:n.endColumn,rangeType:a.RANGE_TYPE.NORMAL};break;default:throw new Error("Invalid direction")}return m.alignToMergedCellsBorders(t,e,!1)}function Fn(n,o,e,t,r){let i=!1;const s=n.getMatrixWithMergedCells(o,e,t,r).forValue((l,c,d)=>{if(Pu(d))return i=!0,!1});return{hasValue:i,matrix:s}}function Pi(n,o,e){const t=a.Rectangle.clone(n);if(o==null)return t;switch(e){case a.Direction.UP:case a.Direction.DOWN:t.startColumn=t.endColumn=o.actualColumn;break;case a.Direction.LEFT:case a.Direction.RIGHT:t.startRow=t.endRow=o.actualRow;break}return t}function Mu(n,o,e){var l,c,d,u;const{primary:t,range:r}=n,i=a.Rectangle.clone(r);switch(o){case a.Direction.UP:case a.Direction.DOWN:i.startRow=(l=t==null?void 0:t.startRow)!=null?l:r.startRow,i.endRow=(c=t==null?void 0:t.endRow)!=null?c:r.startRow;break;case a.Direction.LEFT:case a.Direction.RIGHT:i.startColumn=(d=t==null?void 0:t.startColumn)!=null?d:r.startColumn,i.endColumn=(u=t==null?void 0:t.endColumn)!=null?u:r.startColumn;break}const s=rr(i,o,e);switch(o){case a.Direction.DOWN:return r.startRow<s.startRow;case a.Direction.UP:return r.endRow>s.endRow;case a.Direction.LEFT:return s.endColumn<r.endColumn;case a.Direction.RIGHT:return s.startColumn>r.startColumn}}function Xa(n,o){let e=n[0].startRow,t=n[0].endRow;n.forEach(i=>{const{startRow:s,endRow:l}=i;e=Math.min(e,s),t=Math.max(t,l)});const r=new Array(t-e+1).fill(!1);return o.forEach(i=>{const{startRow:s,endRow:l}=i;for(let c=Math.max(s,e);c<=Math.min(l,t);c++)r[c-e]=!0}),n.every(i=>{const{startRow:s,endRow:l}=i;for(let c=s;c<=l;c++)if(!r[c-e])return!1;return!0})}function Ya(n,o){let e=n[0].startColumn,t=n[0].endColumn;n.forEach(i=>{const{startColumn:s,endColumn:l}=i;e=Math.min(e,s),t=Math.max(t,l)});const r=new Array(t-e+1).fill(!1);return o.forEach(i=>{const{startColumn:s,endColumn:l}=i;for(let c=Math.max(s,e);c<=Math.min(l,t);c++)r[c-e]=!0}),n.every(i=>{const{startColumn:s,endColumn:l}=i;for(let c=s;c<=l;c++)if(!r[c-e])return!1;return!0})}function $i(n,o){return o?n==="mergeAll"?o.filter(e=>!(e.startRow===e.endRow&&e.startColumn===e.endColumn)):n==="mergeVertical"?o.filter(e=>e.startRow!==e.endRow):n==="mergeHorizontal"?o.filter(e=>e.startColumn!==e.endColumn):o:null}function Pu(n){return n.v!==void 0&&n.v!==null&&n.v!==""||n.p!==void 0}const mr={id:"sheet.command.hide-row-confirm",type:a.CommandType.COMMAND,handler:async n=>{var c;const e=(c=n.get(m.SheetsSelectionsService).getCurrentSelections())==null?void 0:c.map(d=>d.range);if(!(e!=null&&e.length))return!1;const t=n.get(a.ICommandService),r=n.get(a.IUniverInstanceService),i=m.getSheetCommandTarget(r);if(!i)return!1;const{worksheet:s}=i,l=s.getVisibleRows();if(Xa(l,e)){const d=n.get(I.IConfirmService),u=n.get(a.LocaleService);return await d.confirm({id:"sheet.confirm.hide-row",title:{title:u.t("info.problem")},children:{title:u.t("rightClick.hideAllRowsAlert")},cancelText:u.t("button.cancel"),confirmText:u.t("button.confirm")}),!1}return await t.executeCommand(m.SetRowHiddenCommand.id),!0}},gr={id:"sheet.command.hide-col-confirm",type:a.CommandType.COMMAND,handler:async n=>{var c;const e=(c=n.get(m.SheetsSelectionsService).getCurrentSelections())==null?void 0:c.map(d=>d.range);if(!(e!=null&&e.length))return!1;const t=n.get(a.ICommandService),r=n.get(a.IUniverInstanceService),i=m.getSheetCommandTarget(r);if(!i)return!1;const{worksheet:s}=i,l=s.getVisibleCols();if(Ya(l,e)){const d=n.get(I.IConfirmService),u=n.get(a.LocaleService);return await d.confirm({id:"sheet.confirm.hide-col",title:{title:u.t("info.problem")},children:{title:u.t("rightClick.hideAllColumnsAlert")},cancelText:u.t("button.cancel"),confirmText:u.t("button.confirm")}),!1}return await t.executeCommand(m.SetColHiddenCommand.id),!0}},Bt={type:a.CommandType.COMMAND,id:"sheet.command.set-range-bold",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatBoldCommand.id):o.executeCommand(m.SetBoldCommand.id)}},Ft={type:a.CommandType.COMMAND,id:"sheet.command.set-range-italic",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatItalicCommand.id):o.executeCommand(m.SetItalicCommand.id)}},jt={type:a.CommandType.COMMAND,id:"sheet.command.set-range-underline",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatUnderlineCommand.id):o.executeCommand(m.SetUnderlineCommand.id)}},zt={type:a.CommandType.COMMAND,id:"sheet.command.set-range-stroke",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatStrikethroughCommand.id):o.executeCommand(m.SetStrikeThroughCommand.id)}},es={type:a.CommandType.COMMAND,id:"sheet.command.set-range-subscript",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatSubscriptCommand.id):!1}},ts={type:a.CommandType.COMMAND,id:"sheet.command.set-range-superscript",handler:async n=>{const o=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?o.executeCommand(J.SetInlineFormatSuperscriptCommand.id):!1}},Sr={type:a.CommandType.COMMAND,id:"sheet.command.set-range-fontsize",handler:async(n,o)=>{const e=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?e.executeCommand(J.SetInlineFormatFontSizeCommand.id,o):e.executeCommand(m.SetFontSizeCommand.id,o)}},pr={type:a.CommandType.COMMAND,id:"sheet.command.set-range-font-family",handler:async(n,o)=>{const e=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?e.executeCommand(J.SetInlineFormatFontFamilyCommand.id,o):e.executeCommand(m.SetFontFamilyCommand.id,o)}},pn={type:a.CommandType.COMMAND,id:"sheet.command.set-range-text-color",handler:async(n,o)=>{const e=n.get(a.ICommandService);return n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED)?e.executeCommand(J.SetInlineFormatTextColorCommand.id,o):e.executeCommand(m.SetTextColorCommand.id,o)}},Ao={type:a.CommandType.COMMAND,id:"sheet.command.reset-range-text-color",handler:async n=>{const o=n.get(a.ICommandService),t=n.get(a.IContextService).getContextValue(a.EDITOR_ACTIVATED),r=n.get(a.ThemeService);return t?o.executeCommand(J.SetInlineFormatTextColorCommand.id,{value:null}):o.executeCommand(m.SetTextColorCommand.id,{value:r.getColorFromTheme("gray.900")})}},Ht={type:a.CommandType.COMMAND,id:"sheet.command.insert-range-move-down-confirm",handler:async n=>{const o=n.get(I.IConfirmService),e=n.get(a.ICommandService),t=n.get(a.LocaleService),r=n.get(m.SheetsSelectionsService),i=n.get(a.IUniverInstanceService),s=r.getCurrentSelections();if(!s)return!1;const l=m.getSheetCommandTarget(i);if(!l)return!1;const{worksheet:c}=l;let d=s[0].range;if(!d)return!1;d={...d,endRow:c.getRowCount()-1};for(let S=d.startRow;S<=d.endRow;S++)if(c.getRowFiltered(S)&&await o.confirm({id:Ht.id,title:{title:t.t("filter.confirm.error")},children:{title:t.t("filter.confirm.notAllowedToInsertRange")},confirmText:t.t("button.confirm")}))return!1;const u=S=>S.endColumn-S.startColumn;return!c.getMergeData().find(S=>{const p=a.Rectangle.getIntersects(S,d);return p?u(S)>u(p):!1})||await o.confirm({id:Ht.id,title:{title:t.t("merge.confirm.warning")},children:{title:t.t("merge.confirm.dismantleMergeCellWarning")},cancelText:t.t("button.cancel"),confirmText:t.t("button.confirm")})?e.executeCommand(m.InsertRangeMoveDownCommand.id):!0}},On={type:a.CommandType.COMMAND,id:"sheet.command.insert-range-move-right-confirm",handler:async n=>{const o=n.get(I.IConfirmService),e=n.get(a.ICommandService),t=n.get(a.LocaleService),r=n.get(m.SheetsSelectionsService),i=n.get(a.IUniverInstanceService),s=r.getCurrentSelections();if(!s)return!1;const l=m.getSheetCommandTarget(i);if(!l)return!1;const{worksheet:c}=l;let d=s[0].range;if(!d)return!1;d={...d,endColumn:c.getColumnCount()-1};const u=S=>S.endRow-S.startRow;return!c.getMergeData().find(S=>{const p=a.Rectangle.getIntersects(S,d);return p?u(S)>u(p):!1})||await o.confirm({id:On.id,title:{title:t.t("merge.confirm.warning")},children:{title:t.t("merge.confirm.dismantleMergeCellWarning")},cancelText:t.t("button.cancel"),confirmText:t.t("button.confirm")})?e.executeCommand(m.InsertRangeMoveRightCommand.id):!0}};var Za=(n=>(n[n.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",n[n.UNIVER_DOC=1]="UNIVER_DOC",n[n.UNIVER_SHEET=2]="UNIVER_SHEET",n[n.UNIVER_SLIDE=3]="UNIVER_SLIDE",n[n.UNIVER_PROJECT=4]="UNIVER_PROJECT",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED",n))(Za||{}),Q=(n=>(n[n.View=0]="View",n[n.Edit=1]="Edit",n[n.ManageCollaborator=2]="ManageCollaborator",n[n.Print=3]="Print",n[n.Duplicate=4]="Duplicate",n[n.Comment=5]="Comment",n[n.Copy=6]="Copy",n[n.Share=7]="Share",n[n.Export=8]="Export",n[n.MoveWorksheet=9]="MoveWorksheet",n[n.DeleteWorksheet=10]="DeleteWorksheet",n[n.HideWorksheet=11]="HideWorksheet",n[n.RenameWorksheet=12]="RenameWorksheet",n[n.CreateWorksheet=13]="CreateWorksheet",n[n.SetWorksheetStyle=14]="SetWorksheetStyle",n[n.EditWorksheetCell=15]="EditWorksheetCell",n[n.InsertHyperlink=16]="InsertHyperlink",n[n.Sort=17]="Sort",n[n.Filter=18]="Filter",n[n.PivotTable=19]="PivotTable",n[n.FloatImg=20]="FloatImg",n[n.History=21]="History",n[n.RwHgtClWdt=22]="RwHgtClWdt",n[n.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",n[n.ViewFilter=24]="ViewFilter",n[n.MoveSheet=25]="MoveSheet",n[n.DeleteSheet=26]="DeleteSheet",n[n.HideSheet=27]="HideSheet",n[n.CopySheet=28]="CopySheet",n[n.RenameSheet=29]="RenameSheet",n[n.CreateSheet=30]="CreateSheet",n[n.SelectProtectedCells=31]="SelectProtectedCells",n[n.SelectUnProtectedCells=32]="SelectUnProtectedCells",n[n.SetCellStyle=33]="SetCellStyle",n[n.SetCellValue=34]="SetCellValue",n[n.SetRowStyle=35]="SetRowStyle",n[n.SetColumnStyle=36]="SetColumnStyle",n[n.InsertRow=37]="InsertRow",n[n.InsertColumn=38]="InsertColumn",n[n.DeleteRow=39]="DeleteRow",n[n.DeleteColumn=40]="DeleteColumn",n[n.EditExtraObject=41]="EditExtraObject",n[n.Delete=42]="Delete",n[n.RecoverHistory=43]="RecoverHistory",n[n.ViewHistory=44]="ViewHistory",n[n.CreatePermissionObject=45]="CreatePermissionObject",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED",n))(Q||{}),Pe=(n=>(n[n.Reader=0]="Reader",n[n.Editor=1]="Editor",n[n.Owner=2]="Owner",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED",n))(Pe||{}),tt=(n=>(n[n.Unkonwn=0]="Unkonwn",n[n.Workbook=1]="Workbook",n[n.Worksheet=2]="Worksheet",n[n.SelectRange=3]="SelectRange",n[n.Document=4]="Document",n[n.Slide=5]="Slide",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED",n))(tt||{}),Be=(n=>(n[n.SomeCollaborator=0]="SomeCollaborator",n[n.AllCollaborator=1]="AllCollaborator",n[n.OneSelf=2]="OneSelf",n[n.UNRECOGNIZED=-1]="UNRECOGNIZED",n))(Be||{});const or="UNIVER_SHEET_PERMISSION_PANEL",fr="UNIVER_SHEET_PERMISSION_USER_PART",Ga="UNIVER_SHEET_PERMISSION_USER_DIALOG",Ka="UNIVER_SHEET_PERMISSION_DIALOG",no="UNIVER_SHEET_PERMISSION_USER_DIALOG_ID",ro="UNIVER_SHEET_PERMISSION_DIALOG_ID",Wr={[Q.Copy]:"Copy",[Q.SetCellStyle]:"SetCellStyle",[Q.SetCellValue]:"SetCellValue",[Q.SetRowStyle]:"SetRowStyle",[Q.SetColumnStyle]:"SetColumnStyle",[Q.InsertRow]:"InsertRow",[Q.InsertColumn]:"InsertColumn",[Q.InsertHyperlink]:"InsertHyperlink",[Q.DeleteRow]:"DeleteRow",[Q.DeleteColumn]:"DeleteColumn",[Q.Sort]:"Sort",[Q.Filter]:"Filter",[Q.PivotTable]:"PivotTable",[Q.EditExtraObject]:"EditExtraObject"},xu=[Q.Copy,Q.SetCellStyle,Q.SetCellValue,Q.SetRowStyle,Q.SetColumnStyle,Q.InsertRow,Q.InsertColumn,Q.InsertHyperlink,Q.DeleteRow,Q.DeleteColumn,Q.Sort,Q.Filter,Q.PivotTable,Q.EditExtraObject,Q.View],qa="sheet-permission-menu-icon",Ou="sheet-permission-delete-icon",Au="sheet-permission-edit-icon",Du="sheet-permission-check-icon",Qa="sheet-permission-lock-icon",Nu={unitId:"",subUnitId:"",permissionId:"",unitType:m.UnitObject.SelectRange,id:"",ranges:[],viewState:m.ViewStateEnum.OthersCanView,editState:m.EditStateEnum.OnlyMe};class Vt{constructor(){E(this,"_rule",Nu);E(this,"_visible",!1)}setVisible(o){this._visible=o}getVisible(){return this._visible}reset(){this.setVisible(!1)}}class ft{constructor(){E(this,"_userList",[]);E(this,"_userList$",new O.BehaviorSubject(this._userList));E(this,"userList$",this._userList$.asObservable());E(this,"_oldCollaboratorList",[]);E(this,"_selectUserList",[]);E(this,"_selectUserList$",new O.BehaviorSubject(this._selectUserList));E(this,"selectUserList$",this._selectUserList$.asObservable())}get userList(){return this._userList}setCanEditUserList(o){this._userList=o,this._userList$.next(o)}reset(){this._userList=[],this._oldCollaboratorList=[],this._selectUserList=[],this._selectUserList$.next([])}get oldCollaboratorList(){return this._oldCollaboratorList}setOldCollaboratorList(o){this._oldCollaboratorList=o}get selectUserList(){return this._selectUserList}setSelectUserList(o){this._selectUserList=o,this._selectUserList$.next(o)}}const je={type:a.CommandType.OPERATION,id:"sheet-permission.operation.openPanel",async handler(n,o={}){const e=n.get(I.ISidebarService),t=n.get(Vt),r=n.get(ft),{showDetail:i=!0,fromSheetBar:s=!1,rule:l,oldRule:c}=o,d={header:{title:"permission.panel.title"},children:{label:or,showDetail:i,fromSheetBar:s,rule:l,oldRule:c},width:330,onClose:()=>{t.reset(),r.reset()}};return t.setVisible(!0),e.open(d),!0}},vr={type:a.CommandType.COMMAND,id:"sheet.command.add-range-protection-from-toolbar",async handler(n){return await n.get(a.ICommandService).executeCommand(je.id,{showDetail:!0}),!0}},Mt={type:a.CommandType.COMMAND,id:"sheet.command.add-range-protection-from-context-menu",async handler(n){return await n.get(a.ICommandService).executeCommand(je.id,{showDetail:!0}),!0}},Pt={type:a.CommandType.COMMAND,id:"sheet.command.view-sheet-permission-from-context-menu",async handler(n){return await n.get(a.ICommandService).executeCommand(je.id,{showDetail:!1}),!0}},Cr={type:a.CommandType.COMMAND,id:"sheet.command.add-range-protection-from-sheet-bar",async handler(n){return await n.get(a.ICommandService).executeCommand(je.id,{fromSheetBar:!0,showDetail:!0}),!0}},Ir={type:a.CommandType.COMMAND,id:"sheet.command.view-sheet-permission-from-sheet-bar",async handler(n){return await n.get(a.ICommandService).executeCommand(je.id,{showDetail:!1}),!0}},xt={type:a.CommandType.COMMAND,id:"sheet.command.delete-range-protection-from-context-menu",async handler(n){var h;const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(a.IUndoRedoService),r=n.get(m.SheetsSelectionsService),i=n.get(m.WorksheetProtectionRuleModel),s=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),l=s.getActiveSheet(),c=s.getUnitId(),d=l.getSheetId(),u=i.getRule(c,d);if(u!=null&&u.permissionId)return o.executeCommand(m.DeleteWorksheetProtectionCommand.id,{unitId:c,subUnitId:d,rule:u});{const g=(h=r.getCurrentLastSelection())==null?void 0:h.range;if(!g)return!1;const f=n.get(m.RangeProtectionRuleModel).getSubunitRuleList(c,d).find(v=>v.ranges.some(C=>a.Rectangle.intersects(C,g)));if(f){const v={unitId:c,subUnitId:d,ruleIds:[f.id]};return await o.executeCommand(m.DeleteRangeProtectionMutation.id,v)&&t.pushUndoRedo({unitID:c,redoMutations:[{id:m.DeleteRangeProtectionMutation.id,params:v}],undoMutations:[{id:m.AddRangeProtectionMutation.id,params:{unitId:c,subUnitId:d,rules:[f]}}]}),!0}else return!1}}},Ot={type:a.CommandType.COMMAND,id:"sheet.command.set-range-protection-from-context-menu",async handler(n){var u;const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(m.WorksheetProtectionRuleModel),i=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=i.getActiveSheet(),l=i.getUnitId(),c=s.getSheetId(),d=r.getRule(l,c);if(d!=null&&d.permissionId){const h={...d,unitId:l,subUnitId:c,ranges:[]};return await o.executeCommand(je.id,{showDetail:!0,rule:a.Tools.deepClone(h),oldRule:a.Tools.deepClone(h)}),!0}else{const h=(u=t.getCurrentLastSelection())==null?void 0:u.range;if(!h)return!1;const p=n.get(m.RangeProtectionRuleModel).getSubunitRuleList(l,c).find(f=>{var v;return(v=f==null?void 0:f.ranges)==null?void 0:v.some(C=>a.Rectangle.intersects(C,h))});if(p){const f={...p,unitId:l,subUnitId:c};return await o.executeCommand(je.id,{showDetail:!0,rule:a.Tools.deepClone(f),oldRule:a.Tools.deepClone(f)}),!0}else return!1}}},_r={id:"sheet.command.refill",type:a.CommandType.COMMAND,handler:async(n,o)=>n.get(pt).fillData(o.type)},fn={id:"sheet.command.remove-row-confirm",type:a.CommandType.COMMAND,handler:async(n,o)=>{var d;const e=n.get(m.SheetsSelectionsService);let t=o==null?void 0:o.range;if(t||(t=(d=e.getCurrentLastSelection())==null?void 0:d.range),!t)return!1;const r=n.get(a.ICommandService),i=n.get(a.IUniverInstanceService),s=m.getSheetCommandTarget(i);if(!s)return!1;const{worksheet:l}=s,c=l.getVisibleRows();if(Xa(c,[t])){const u=n.get(I.IConfirmService),h=n.get(a.LocaleService);return await u.confirm({id:"sheet.confirm.remove-row",title:{title:h.t("info.problem")},children:{title:h.t("rightClick.deleteAllRowsAlert")},cancelText:h.t("button.cancel"),confirmText:h.t("button.confirm")}),!1}return await r.executeCommand(m.RemoveRowCommand.id,{range:t}),!0}},vn={id:"sheet.command.remove-col-confirm",type:a.CommandType.COMMAND,handler:async(n,o)=>{var d;const e=n.get(m.SheetsSelectionsService);let t=o==null?void 0:o.range;if(t||(t=(d=e.getCurrentLastSelection())==null?void 0:d.range),!t)return!1;const r=n.get(a.ICommandService),i=n.get(a.IUniverInstanceService),s=m.getSheetCommandTarget(i);if(!s)return!1;const{worksheet:l}=s,c=l.getVisibleCols();if(Ya(c,[t])){const u=n.get(I.IConfirmService),h=n.get(a.LocaleService);return await u.confirm({id:"sheet.confirm.remove-col",title:{title:h.t("info.problem")},children:{title:h.t("rightClick.deleteAllColumnsAlert")},cancelText:h.t("button.cancel"),confirmText:h.t("button.confirm")}),!1}return await r.executeCommand(m.RemoveColCommand.id,{range:t}),!0}},br={id:"sheet.command.remove-sheet-confirm",type:a.CommandType.COMMAND,handler:async(n,o)=>{const{subUnitId:e}=o,t=n.get(I.IConfirmService),r=n.get(a.ICommandService),i=n.get(a.LocaleService);return await t.confirm({id:"sheet.confirm.remove-sheet",title:{title:i.t("sheetConfig.deleteSheet")},children:{title:i.t("sheetConfig.deleteSheetContent")},cancelText:i.t("button.cancel"),confirmText:i.t("button.confirm")})?(await r.executeCommand(m.RemoveSheetCommand.id,{subUnitId:e}),!0):!1}};var ku=Object.getOwnPropertyDescriptor,Hu=(n,o,e,t)=>{for(var r=t>1?void 0:t?ku(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},qt=(n,o)=>(e,t)=>o(e,t,n),xe=(n=>(n[n.OFF=0]="OFF",n[n.ONCE=1]="ONCE",n[n.INFINITE=2]="INFINITE",n))(xe||{});const Xe=a.createIdentifier("univer.format-painter-service");let oo=class extends a.Disposable{constructor(o,e,t,r,i,s){super();E(this,"status$");E(this,"_selectionFormat");E(this,"_markId",null);E(this,"_status$");E(this,"_defaultHook",null);E(this,"_extendHooks",[]);this._selectionManagerService=o,this._themeService=e,this._markSelectionService=t,this._logService=r,this._commandService=i,this._undoRedoService=s,this._status$=new O.BehaviorSubject(0),this.status$=this._status$.asObservable(),this._selectionFormat={styles:new a.ObjectMatrix,merges:[]}}addHook(o){var e,t,r;o.isDefaultHook&&((e=o.priority)!=null?e:0)>((r=(t=this._defaultHook)==null?void 0:t.priority)!=null?r:-1)?this._defaultHook=o:(this._extendHooks.push(o),this._extendHooks.sort((i,s)=>(i.priority||0)-(s.priority||0)))}getHooks(){return this._defaultHook?[this._defaultHook,...this._extendHooks]:this._extendHooks}setStatus(o){this._updateRangeMark(o),this._status$.next(o),this.getHooks().forEach(t=>{t.onStatusChange!==void 0&&t.onStatusChange(o)})}getStatus(){return this._status$.getValue()}setSelectionFormat(o){this._selectionFormat=o}getSelectionFormat(){return this._selectionFormat}applyFormatPainter(o,e,t){const r=this.getHooks(),i=[],s=[];r.forEach(c=>{if(c.onApply!==void 0){const d=c.onApply(o,e,t,this._selectionFormat);d&&(i.push(...d.redos),s.push(...d.undos))}});for(const c of r)if(c.onBeforeApply!==void 0&&!c.onBeforeApply({unitId:o,subUnitId:e,range:t,redoMutationsInfo:i,format:this._selectionFormat,undoMutationsInfo:s}))return!1;this._logService.log("[FormatPainterService]","apply mutations",{undoMutationsInfo:s,redoMutationsInfo:i});const l=i.every(c=>this._commandService.executeCommand(c.id,c.params));return l&&this._undoRedoService.pushUndoRedo({unitID:o,undoMutations:s,redoMutations:i}),l}_updateRangeMark(o){if(this._markSelectionService.removeAllShapes(),o!==0){const e=this._selectionManagerService.getCurrentLastSelection();if(e){const t=Ua(this._themeService);o===2?this._markId=this._markSelectionService.addShape({...e,style:t}):this._markId=this._markSelectionService.addShape({...e,style:t},[m.SetRangeValuesMutation.id])}}}};oo=Hu([qt(0,a.Inject(m.SheetsSelectionsService)),qt(1,a.Inject(a.ThemeService)),qt(2,Lt),qt(3,a.ILogService),qt(4,a.ICommandService),qt(5,a.IUndoRedoService)],oo);const Rr={id:"sheet.operation.set-format-painter",type:a.CommandType.OPERATION,handler:(n,o)=>o?(n.get(Xe).setStatus(o.status),!0):!1},Do={type:a.CommandType.COMMAND,id:"sheet.command.set-infinite-format-painter",handler:async n=>{const e=n.get(Xe).getStatus();let t;return e!==xe.OFF?t=xe.OFF:t=xe.INFINITE,n.get(a.ICommandService).executeCommand(Rr.id,{status:t})}},An={type:a.CommandType.COMMAND,id:"sheet.command.set-once-format-painter",handler:async n=>{const e=n.get(Xe).getStatus();let t;return e!==xe.OFF?t=xe.OFF:t=xe.ONCE,n.get(a.ICommandService).executeCommand(Rr.id,{status:t})}},wr={type:a.CommandType.COMMAND,id:"sheet.command.apply-format-painter",handler:async(n,o)=>n.get(Xe).applyFormatPainter(o.unitId,o.subUnitId,o.range)};var Vu=Object.getOwnPropertyDescriptor,Wu=(n,o,e,t)=>{for(var r=t>1?void 0:t?Vu(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Uu=(n,o)=>(e,t)=>o(e,t,n);exports.SheetScrollManagerService=class{constructor(o,e){E(this,"_scrollStateMap",new Map);E(this,"_rawScrollInfo$",new O.BehaviorSubject(null));E(this,"rawScrollInfo$",this._rawScrollInfo$.asObservable());E(this,"validViewportScrollInfo$",new O.BehaviorSubject(null));E(this,"_searchParamForScroll",null);this._context=o,this._sheetSkeletonManagerService=e}dispose(){this._rawScrollInfo$.complete()}calcViewportScrollFromRowColOffset(o){if(!o)return{viewportScrollX:0,viewportScrollY:0};let{sheetViewStartColumn:e,sheetViewStartRow:t,offsetX:r,offsetY:i}=o;t=t||0,i=i||0;const s=this._sheetSkeletonManagerService.getCurrentSkeleton(),l=(s==null?void 0:s.rowHeightAccumulation[t-1])||0,d=((s==null?void 0:s.columnWidthAccumulation[e-1])||0)+r,u=l+i;return{viewportScrollX:d,viewportScrollY:u}}setSearchParam(o){this._searchParamForScroll=o}getScrollStateByParam(o){return this._getCurrentScroll(o)}getCurrentScrollState(){return this._getCurrentScroll(this._searchParamForScroll)}setValidScrollState(o){this._setScrollState(o)}emitRawScrollParam(o){this._emitRawScroll(o)}setValidScrollStateToCurrSheet(o){if(this._searchParamForScroll==null)return;this._setScrollState({...this._searchParamForScroll,...o});const e=this._searchParamForScroll.sheetId,t=this._sheetSkeletonManagerService.getSkeleton(e);t&&t.setScroll(o.viewportScrollX,o.viewportScrollY)}clear(){this._searchParamForScroll!=null&&this._clearByParamAndNotify(this._searchParamForScroll)}_setScrollState(o){const{unitId:e,sheetId:t,sheetViewStartColumn:r,sheetViewStartRow:i,offsetX:s,offsetY:l}=o;this._scrollStateMap.has(e)||this._scrollStateMap.set(e,new Map);const c=this._scrollStateMap.get(e),d={sheetViewStartRow:i,sheetViewStartColumn:r,offsetX:s,offsetY:l};c.set(t,d)}_clearByParamAndNotify(o){this._setScrollState({...o,sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0}),this._emitRawScroll({sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0})}_getCurrentScroll(o){var s;const e={sheetViewStartRow:0,sheetViewStartColumn:0,offsetX:0,offsetY:0};if(o==null)return e;const{unitId:t,sheetId:r}=o;return((s=this._scrollStateMap.get(t))==null?void 0:s.get(r))||e}_emitRawScroll(o){this._rawScrollInfo$.next(o)}};exports.SheetScrollManagerService=Wu([Uu(1,a.Inject(exports.SheetSkeletonManagerService))],exports.SheetScrollManagerService);const rt={type:a.CommandType.COMMAND,id:"sheet.command.set-selection-frozen",handler:async(n,o)=>{const{type:e}=o||{},t=n.get(a.IUniverInstanceService),r=n.get(a.IUndoRedoService),i=m.getSheetCommandTarget(t);if(!i)return!1;const{unitId:s,subUnitId:l}=i,c=n.get(a.ICommandService),u=n.get(m.SheetsSelectionsService).getCurrentSelections();if(!u)return!1;const h=u[(u==null?void 0:u.length)-1],{range:g}=h,p=n.get(T.IRenderManagerService).getRenderById(s).with(exports.SheetScrollManagerService),{sheetViewStartRow:f=0,sheetViewStartColumn:v=0}=p.getCurrentScrollState()||{};let C,_,R,w;const{startRow:P,startColumn:y,rangeType:M}=g;if(M===a.RANGE_TYPE.ROW||e===1)C=P,R=P-f,_=-1,w=0;else if(M===a.RANGE_TYPE.COLUMN||e===2)C=-1,R=0,_=y,w=y-v;else if(M===a.RANGE_TYPE.NORMAL)C=P,R=P-f,_=y,w=y-v;else return!1;const x={unitId:s,subUnitId:l,startRow:C,startColumn:_,xSplit:_>0?Math.max(1,w):w,ySplit:C>0?Math.max(1,R):R},A=m.SetFrozenMutationFactory(n,x);return c.syncExecuteCommand(m.SetFrozenMutation.id,x)&&r.pushUndoRedo({unitID:s,undoMutations:[{id:m.SetFrozenMutation.id,params:A}],redoMutations:[{id:m.SetFrozenMutation.id,params:x}]}),!0}},Er={type:a.CommandType.COMMAND,id:"sheet.command.set-row-frozen",handler:async n=>(n.get(a.ICommandService).executeCommand(rt.id,{type:1}),!0)},Tr={type:a.CommandType.COMMAND,id:"sheet.command.set-col-frozen",handler:async n=>(n.get(a.ICommandService).executeCommand(rt.id,{type:2}),!0)};class ns extends a.Disposable{constructor(){super(...arguments);E(this,"rangesStack",[]);E(this,"selectedRangeWorksheet","")}}var Lu=Object.getOwnPropertyDescriptor,Bu=(n,o,e,t)=>{for(var r=t>1?void 0:t?Lu(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Gs=(n,o)=>(e,t)=>o(e,t,n);let Cn=class{constructor(n,o){E(this,"_current",null);E(this,"_shortcutParam",[]);this._univerInstanceService=n,this._localeService=o}dispose(){this._shortcutParam=[]}getCurrentBySearch(n){return this._getCurrentBySearch(n)}getCurrent(){return this._getCurrentBySearch(this._current)}addOrUpdate(n){const o=this._getCurrentBySearch({unitId:n.unitId,sheetId:n.sheetId,keycode:n.keycode});if(o!=null){const e=this._shortcutParam.indexOf(o);this._shortcutParam.splice(e,1)}return this._shortcutParam.push(n),o}remove(n){if(n==null)return;const o=this._getCurrentBySearch(n);if(o==null)return;const e=this._shortcutParam.indexOf(o);return this._shortcutParam.splice(e,1)[0]}_getCurrentBySearch(n){return n==null?void 0:this._shortcutParam.find(e=>e.unitId===n.unitId&&e.sheetId===n.sheetId&&e.keycode===n.keycode)}};Cn=Bu([Gs(0,a.IUniverInstanceService),Gs(1,a.Inject(a.LocaleService))],Cn);var Ye=(n=>(n[n.moveStopeOne=0]="moveStopeOne",n[n.moveGap=1]="moveGap",n[n.moveStepPage=2]="moveStepPage",n[n.moveStepEnd=3]="moveStepEnd",n))(Ye||{});const Me={id:"sheet.command.move-selection",type:a.CommandType.COMMAND,handler:(n,o)=>{if(!o)return!1;const e=m.getSheetCommandTarget(n.get(a.IUniverInstanceService));if(!e)return!1;const{workbook:t,worksheet:r}=e,i=m.getSelectionsService(n,o.fromCurrentSelection).getCurrentLastSelection();if(!i)return!1;const{direction:s,jumpOver:l,extra:c}=o,{range:d,primary:u}=i,h=Pi(d,u,s),g=l===1?Ji(h,s,r):ut(h,s,r),S=m.getCellAtRowCol(g.startRow,g.startColumn,r);if(a.Rectangle.equals(S,h))return!1;const p=t.getUnitId();n.get(Cn).remove({unitId:p,sheetId:r.getSheetId(),keycode:I.KeyCode.TAB});const f=[{range:a.Rectangle.clone(S),primary:{startRow:S.startRow,startColumn:S.startColumn,endRow:S.endRow,endColumn:S.endColumn,actualRow:g.startRow,actualColumn:g.startColumn,isMerged:S.isMerged,isMergedMainCell:S.startRow===g.startRow&&S.startColumn===g.startColumn}}];return n.get(a.ICommandService).executeCommand(m.SetSelectionsOperation.id,{unitId:t.getUnitId(),subUnitId:r.getSheetId(),selections:f,type:m.SelectionMoveType.MOVE_END,extra:c,reveal:!0})}},Ze={id:"sheet.command.move-selection-enter-tab",type:a.CommandType.COMMAND,handler:(n,o)=>{var U;if(!o)return!1;const e=m.getSheetCommandTarget(n.get(a.IUniverInstanceService));if(!e)return!1;const{workbook:t,worksheet:r}=e,i=m.getSelectionsService(n),{direction:s,keycode:l}=o,c=s===a.Direction.LEFT||s===a.Direction.UP,d=i.getCurrentSelections().concat(),u=d.findIndex(L=>L.primary),h=d[u];if(!h)return!1;const g=c?-1:1,S=u+g!==d.length?d[u+g]:d[0],p=d.findIndex(L=>L===S),f=t.getUnitId(),v=r.getSheetId();if(!h)return!1;const{range:C}=h,_=h.primary;let R=Pi(C,_,s);const w=n.get(Cn),P=w.getCurrentBySearch({unitId:f,sheetId:v,keycode:I.KeyCode.TAB});let y;const{startRow:M,endRow:x,startColumn:A,endColumn:D}=C,N=c?_.startRow===M&&_.startColumn===A:_.endRow===x&&_.endColumn===D;if(a.Rectangle.equals(C,_)){if(l===I.KeyCode.TAB)P==null&&w.addOrUpdate({unitId:f,sheetId:v,keycode:I.KeyCode.TAB,selection:h});else{const B=P==null?void 0:P.selection;if(B!=null){const{range:z,primary:X}=B;R=Pi(z,X,s)}w.remove({unitId:f,sheetId:v,keycode:I.KeyCode.TAB})}const L=ut(R,s,r),j=m.getCellAtRowCol(L.startRow,L.startColumn,r);if(a.Rectangle.equals(j,R))return!1;y={range:a.Rectangle.clone(j),primary:{startRow:j.startRow,startColumn:j.startColumn,endRow:j.endRow,endColumn:j.endColumn,actualRow:L.startRow,actualColumn:L.startColumn,isMerged:j.isMerged,isMergedMainCell:j.startRow===L.startRow&&j.startColumn===L.startColumn}}}else{w.remove({unitId:f,sheetId:v,keycode:I.KeyCode.TAB});const L=a.Tools.deepClone(_),j=N?S.range:ut({startRow:L.startRow,startColumn:L.startColumn,endRow:L.endRow,endColumn:L.endColumn},s,r,{startRow:M,endRow:x,startColumn:A,endColumn:D}),B=N&&c,z=B?m.getCellAtRowCol(j.endRow,j.endColumn,r):m.getCellAtRowCol(j.startRow,j.startColumn,r);y={range:N?S.range:a.Rectangle.clone(C),primary:{startRow:z.startRow,startColumn:z.startColumn,endRow:z.endRow,endColumn:z.endColumn,actualRow:B?z.startRow:j.startRow,actualColumn:B?z.startColumn:j.startColumn,isMerged:z.isMerged,isMergedMainCell:z.startRow===j.startRow&&z.startColumn===j.startColumn},style:N?S.style:h.style}}N?(d[u].primary=null,d[p]=y,i.setSelections(f,v,[],m.SelectionMoveType.MOVE_END)):d[u]=y;const V=n.get(a.ICommandService).executeCommand(m.SetSelectionsOperation.id,{unitId:f,subUnitId:v,type:m.SelectionMoveType.MOVE_END,selections:d,reveal:!0,extra:o.extra}),k=(U=n.get(T.IRenderManagerService).getRenderById(f))==null?void 0:U.with(Ce);return k==null||k.refreshSelectionMoveEnd(),V}},Oe={id:"sheet.command.expand-selection",type:a.CommandType.COMMAND,handler:(n,o)=>{if(!o)return!1;const e=m.getSheetCommandTarget(n.get(a.IUniverInstanceService));if(!e)return!1;const{worksheet:t,unitId:r,subUnitId:i}=e,s=m.getSelectionsService(n).getCurrentLastSelection();if(!s)return!1;const{range:l,primary:c}=s,{jumpOver:d,direction:u,extra:h}=o,S=Mu(s,u,t)?d===1?Tu(l,{...a.Rectangle.clone(c),rangeType:a.RANGE_TYPE.NORMAL},u,t):yu(l,u,t):d===1?wu(l,u,t):Eu(l,u,t);return S.rangeType=s.range.rangeType,a.Rectangle.equals(S,l)?!1:n.get(a.ICommandService).syncExecuteCommand(m.SetSelectionsOperation.id,{unitId:r,subUnitId:i,type:m.SelectionMoveType.MOVE_END,selections:[{range:S,primary:c}],extra:h,reveal:!0})}},yr={id:"sheet.command.select-all",type:a.CommandType.COMMAND,handler:async(n,o={expandToGapFirst:!0,loop:!1})=>{const e=m.getSheetCommandTarget(n.get(a.IUniverInstanceService));if(!e)return!1;const t=m.getSelectionsService(n).getCurrentLastSelection();if(!t)return!1;const r=n.get(ns),{worksheet:i,unitId:s,subUnitId:l}=e,c=`${s}|${l}`;c!==r.selectedRangeWorksheet&&(r.rangesStack=[],r.selectedRangeWorksheet=c);const d=i.getMaxRows(),u=i.getMaxColumns(),{expandToGapFirst:h,loop:g}=o,{range:S,primary:p}=t,f=S.endColumn===u-1&&S.endRow===d-1&&S.startRow===0&&S.startColumn===0;r.rangesStack.some(P=>a.Rectangle.equals(P,S))||(r.rangesStack=[],r.rangesStack.push(S));let v;if(f)if(g){if(r.rangesStack.findIndex(y=>a.Rectangle.equals(y,S))!==r.rangesStack.length-1)return!1;v=r.rangesStack[0]}else return!1;else h?(v=m.expandToContinuousRange(S,{left:!0,right:!0,up:!0,down:!0},i),a.Rectangle.equals(v,S)&&(v=Zs(i))):v=Zs(i);r.rangesStack.some(P=>a.Rectangle.equals(P,v))||r.rangesStack.push(v);const C=[];C.push({id:m.SetSelectionsOperation.id,params:{unitId:s,subUnitId:l,reveal:!0,selections:[{range:v,primary:p}]}});const R=n.get(m.SheetInterceptorService).onCommandExecute({id:yr.id,params:{range:S}});R.redos.length&&C.push(...R.redos);const w=n.get(a.ICommandService);return a.sequenceExecute(C,w),!0}};function Fu(n){return typeof n.isMainScene>"u"}function Ne(n,o){const e=n instanceof a.Workbook?n:n.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!e)return null;const t=e.getUnitId();let r,i,s,l;if(Fu(o)){const g=o.getRenderById(t);if(g==null)return null;r=g.components,r=g.components,i=g.mainComponent,s=g.scene,l=g.engine}else r=o.components,i=o.mainComponent,s=o.scene,l=o.engine;if(!r||!i)return null;const c=i,d=r.get(ue.ROW),u=r.get(ue.COLUMN),h=r.get(ue.LEFT_TOP);return{spreadsheet:c,spreadsheetRowHeader:d,spreadsheetColumnHeader:u,spreadsheetLeftTopPlaceholder:h,scene:s,engine:l}}function xi(n,o,e,t){const{startX:r,startY:i,endX:s,endY:l}=t.getCellWithCoordByIndex(n,o);return{startX:r,startY:i,endX:s,endY:l}}function ze(n,o,e,t,r,i){const s=e.getCoordRelativeToViewport(T.Vector2.FromArray([n,o])),{x:l,y:c}=s,d=e.getScrollXYInfoByViewport(s,r),{scaleX:u,scaleY:h}=e.getAncestorScale(),g=t.getCellIndexByOffset(l,c,u,h,d,{closeFirst:i}),{row:S,column:p}=g,f=t.getNoMergeCellWithCoordByIndex(S,p),{startX:v,startY:C,endX:_,endY:R}=f;return{startX:v,startY:C,endX:_,endY:R,row:S,column:p}}function er(n,o,e,t){const r=e.getCoordRelativeToViewport(T.Vector2.FromArray([n,o])),i=e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),s=e.getScrollXYInfoByViewport(r,i),{scaleX:l,scaleY:c}=e.getAncestorScale(),{x:d,y:u}=s,h=n/l+d,g=o/c+u;return{x:h,y:g}}var ju=Object.getOwnPropertyDescriptor,zu=(n,o,e,t)=>{for(var r=t>1?void 0:t?ju(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Qt=(n,o)=>(e,t)=>o(e,t,n);Me.id,Ze.id;const Xu=3;exports.SheetsScrollRenderController=class extends a.Disposable{constructor(o,e,t,r,i,s,l){super(),this._context=o,this._injector=e,this._sheetSkeletonManagerService=t,this._contextService=r,this._commandService=i,this._renderManagerService=s,this._scrollManagerService=l,this._initCommandListener(),this._wheelEventListener(),this._scrollBarEventListener(),this._initSkeletonListener()}_wheelEventListener(){const{scene:o}=this._context;if(!o)return;const e=o.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);e&&this.disposeWithMe(o.onMouseWheel$.subscribeEvent((t,r)=>{if(t.ctrlKey||!this._contextService.getContextValue(a.FOCUSING_SHEET))return;let i=0,s=0;i=t.deltaX,t.shiftKey?i=(t.deltaY||t.deltaX)*Xu:s=t.deltaY,this._commandService.executeCommand(In.id,{offsetX:i,offsetY:s}),this._context.scene.makeDirty(!0);const l=e.limitedScroll(e.scrollX+i,e.scrollY+s);l&&!l.isLimitedX&&!l.isLimitedY&&(t.preventDefault(),o.getParent().classType===T.RENDER_CLASS_TYPE.SCENE_VIEWER&&r.stopPropagation()),e.isWheelPreventDefaultX&&e.isWheelPreventDefaultY&&t.preventDefault()}))}_scrollBarEventListener(){const{scene:o}=this._context;if(o==null)return;const e=o.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);e&&(this.disposeWithMe(a.toDisposable(this._scrollManagerService.rawScrollInfo$.subscribe(t=>{var p;const r=(p=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:p.skeleton;if(!r)return;if(t==null){e.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});return}const{sheetViewStartRow:i,sheetViewStartColumn:s,offsetX:l,offsetY:c,duration:d}=t,{startX:u,startY:h}=r.getCellWithCoordByIndex(i,s,!1),g=u+l,S=h+c;e.scrollAnimationFrameId!==null&&cancelAnimationFrame(e.scrollAnimationFrameId),d?this._smoothScrollToViewportPos({viewportMain:e,viewportScrollX:g,viewportScrollY:S,duration:d}):e.scrollToViewportPos({viewportScrollX:g,viewportScrollY:S})}))),this.disposeWithMe(e.onScrollAfter$.subscribeEvent(t=>{var f;const r=(f=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:f.skeleton;if(r==null||t.isTrigger===!1)return;const i=this._getSheetObject();if(r==null||i==null)return;const{viewportScrollX:s,viewportScrollY:l,scrollX:c,scrollY:d}=t,{row:u,column:h,rowOffset:g,columnOffset:S}=r.getOffsetRelativeToRowCol(s,l),p={sheetViewStartRow:u,sheetViewStartColumn:h,offsetX:S,offsetY:g,viewportScrollX:s,viewportScrollY:l,scrollX:c,scrollY:d};this._scrollManagerService.setValidScrollStateToCurrSheet(p),this._scrollManagerService.validViewportScrollInfo$.next({...p,viewportScrollX:s,viewportScrollY:l,scrollX:c,scrollY:d})})),this.disposeWithMe(e.onScrollByBar$.subscribeEvent(t=>{var g;const r=(g=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:g.skeleton;if(r==null||t.isTrigger===!1)return;const i=this._getSheetObject();if(r==null||i==null)return;const{viewportScrollX:s=0,viewportScrollY:l=0}=t;this._getFreeze();const{row:c,column:d,rowOffset:u,columnOffset:h}=r.getOffsetRelativeToRowCol(s,l);this._commandService.executeCommand(Ue.id,{sheetViewStartRow:c,sheetViewStartColumn:d,offsetX:h,offsetY:u})})))}_initSkeletonListener(){this.disposeWithMe(a.toDisposable(this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe(o=>{if(o==null)return;const e={unitId:o.unitId,sheetId:o.sheetId};if(this._scrollManagerService.setSearchParam(e),!this._getSheetObject())return;const r=this._scrollManagerService.getScrollStateByParam(e),{viewportScrollX:i,viewportScrollY:s}=this._scrollManagerService.calcViewportScrollFromRowColOffset(r);r&&this._updateViewportScroll(i,s)})))}_smoothScrollToViewportPos(o){const{viewportMain:e,viewportScrollX:t,viewportScrollY:r,duration:i}=o,s=performance.now(),l=e.viewportScrollX,c=e.viewportScrollY,d=t-l,u=r-c;function h(g){const S=g-s,p=Math.min(S/i,1),f=1-(1-p)**3,v=l+d*f,C=c+u*f;e.scrollToViewportPos({viewportScrollX:v,viewportScrollY:C}),p<1?e.scrollAnimationFrameId=requestAnimationFrame(h):e.scrollAnimationFrameId=null}e.scrollAnimationFrameId=requestAnimationFrame(h)}_updateViewportScroll(o=0,e=0){const t=this._getSheetObject();if(!t)return;const r=t.scene,i=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),s=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT),l=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM),c=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT),d=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP);i&&(i.viewportScrollX=o,i.viewportScrollY=e),l&&(l.viewportScrollY=e),s&&(s.viewportScrollX=o),c&&(c.viewportScrollY=e),d&&(d.viewportScrollX=o)}scrollToRange(o,e,t){let{endRow:r,endColumn:i,startColumn:s,startRow:l}=o;const c=this._getViewportBounding();if(o.rangeType===a.RANGE_TYPE.ROW?(s=0,i=0):o.rangeType===a.RANGE_TYPE.COLUMN&&(l=0,r=0),c&&!e&&!t){const d=c.startRow>r?l:r,u=c.startColumn>i?s:i;return this._scrollToCell(d,u)}else return this._scrollToCell(l,s,e,t)}scrollToCell(o,e,t){const r=this._context.unit.getActiveSheet(),{ySplit:i,xSplit:s}=r.getFreeze();return this._commandService.syncExecuteCommand(Ue.id,{sheetViewStartRow:o-i,sheetViewStartColumn:e-s,offsetX:0,offsetY:0,duration:t})}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(o=>{switch(o.id){case m.SetSelectionsOperation.id:{const e=o.params;e.unitId===this._context.unitId&&e.reveal&&this._scrollToSelection()}break;case m.ScrollToCellOperation.id:{const e=o.params;if(e.unitId===this._context.unitId){const t=e.range;this.scrollToRange(t)}}break;case Oe.id:{const e=o.params;this._scrollToSelectionForExpand(e)}break}}))}_scrollToSelectionForExpand(o){setTimeout(()=>{const e=this._getSelectionsService().getCurrentLastSelection();if(e==null)return;const{startRow:t,startColumn:r,endRow:i,endColumn:s}=e.range,l=this._getViewportBounding();if(l==null)return;const{startRow:c,startColumn:d,endRow:u,endColumn:h}=l;let g=0,S=0;t>c?g=i:i<u?g=t:g=c,r>d?S=s:s<h?S=r:S=d,o.direction===a.Direction.DOWN?g=i:o.direction===a.Direction.UP?g=t:o.direction===a.Direction.RIGHT?S=s:o.direction===a.Direction.LEFT&&(S=r),this._scrollToCell(g,S)},0)}_getFreeze(){var e;const o=(e=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:e.skeleton.getWorksheetConfig();if(o!=null)return o.freeze}_updateSceneSize(o){var h;if(o==null)return;const{unitId:e}=this._context,{skeleton:t}=o,r=(h=this._renderManagerService.getRenderById(e))==null?void 0:h.scene;if(t==null||r==null)return;const{rowTotalHeight:i,columnTotalWidth:s,rowHeaderWidthAndMarginLeft:l,columnHeaderHeightAndMarginTop:c}=t;this._context.unit.getActiveSheet()&&(r==null||r.transformByState({width:l+s,height:c+i}))}_getSheetObject(){return Ne(this._context.unit,this._context)}_scrollToSelectionByDirection(o){const e=this._getViewportBounding();if(e==null)return!1;const{startRow:t,startColumn:r,endRow:i,endColumn:s}=e;let l=0,c=0;const{startRow:d,startColumn:u,endRow:h,endColumn:g}=o;d>=t&&(l=h),h<=i&&(l=d),u>=r&&(c=g),g<=s&&(c=u),this._scrollToCell(l,c)}_scrollToSelection(o=!0){var d;const e=this._getSelectionsService().getCurrentLastSelection();if(!e)return;const{startRow:t,startColumn:r,actualRow:i,actualColumn:s}=(d=e.primary)!=null?d:e.range,l=o&&i!=null?i:t,c=o&&s!=null?s:r;this._scrollToCell(l,c)}_getSelectionsService(){return m.getSelectionsService(this._injector)}_getViewportBounding(){var i,s;const o=(i=this._getSheetObject())==null?void 0:i.scene;if(o==null)return;const e=o.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(e==null)return;const t=(s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton;if(t==null)return;const r=e.calcViewportInfo();return t.getRangeByViewBound(r.viewBound)}_scrollToCell(o,e,t=!1,r=!1){var D,N,V;const{rowHeightAccumulation:i,columnWidthAccumulation:s}=(D=this._sheetSkeletonManagerService.getCurrentSkeleton())!=null?D:{};if(i==null||s==null)return!1;const l=(N=this._getSheetObject())==null?void 0:N.scene;if(l==null)return!1;const c=l.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(c==null)return!1;const d=(V=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:V.skeleton;if(d==null)return!1;const u=this._context.unit.getActiveSheet();if(!u)return!1;o=a.Tools.clamp(o,0,i.length-1),e=a.Tools.clamp(e,0,s.length-1);const{startColumn:h,startRow:g,ySplit:S,xSplit:p}=u.getFreeze(),f=this._getViewportBounding();if(f==null)return!1;const{startRow:v,startColumn:C,endRow:_,endColumn:R}=f;let w,P;if(o>=g&&e>=h-S&&(o<=v&&(w=o,t=!0),o>=_)){const H=i[o]-c.height;for(let k=v;k<=o&&(w=k+1,!(i[k]>=H));k++);}if(e>=h&&o>=g-S&&(e<=C&&(P=e,r=!0),e>=R)){const H=s[e]-c.width;for(let k=C;k<=e&&(P=k+1,!(s[k]>=H));k++);}if(w===void 0&&P===void 0)return!1;let{offsetX:y,offsetY:M,sheetViewStartRow:x,sheetViewStartColumn:A}=this._scrollManagerService.getCurrentScrollState()||{};if(w=w?Math.min(w,o):x+S,P=P?Math.min(P,e):A+p,r){y=0,P=e;const H=d.getHiddenColumnsInRange({startColumn:P-p,endColumn:P});P=P-H.length}if(t){M=0,w=o;const H=d.getHiddenRowsInRange({startRow:w-S,endRow:w});w=w-H.length}return this._commandService.syncExecuteCommand(Ue.id,{sheetViewStartRow:Math.max(0,w-S),sheetViewStartColumn:Math.max(0,P-p),offsetX:y,offsetY:M})}};exports.SheetsScrollRenderController=zu([Qt(1,a.Inject(a.Injector)),Qt(2,a.Inject(exports.SheetSkeletonManagerService)),Qt(3,a.IContextService),Qt(4,a.ICommandService),Qt(5,T.IRenderManagerService),Qt(6,a.Inject(exports.SheetScrollManagerService))],exports.SheetsScrollRenderController);const We={id:"sheet.operation.set-scroll",type:a.CommandType.OPERATION,handler:(n,o)=>{if(!o)return!1;const{unitId:e,sheetId:t,offsetX:r=0,offsetY:i=0,sheetViewStartColumn:s,sheetViewStartRow:l,duration:c,screenRatioX:d,screenRatioY:u}=o,h=n.get(T.IRenderManagerService),g=h.getRenderById(e).with(exports.SheetScrollManagerService),S=h.getRenderById(e);if(!S)return!1;const p=S.engine,f=p.width,v=p.height,C=d!==void 0?f*d+r:r,_=u!==void 0?v*u+i:i;return g.emitRawScrollParam({unitId:e,sheetId:t,offsetX:C,offsetY:_,sheetViewStartRow:l,sheetViewStartColumn:s,duration:c}),!0}},In={id:"sheet.command.set-scroll-relative",type:a.CommandType.COMMAND,handler:async(n,o)=>{const e=n.get(a.ICommandService),t=n.get(a.IUniverInstanceService),r=n.get(T.IRenderManagerService),i=m.getSheetCommandTarget(t);if(!i)return!1;const{unitId:s,subUnitId:l}=i,d=r.getRenderById(s).with(exports.SheetScrollManagerService).getCurrentScrollState(),{offsetX:u=0,offsetY:h=0}=o||{},{sheetViewStartRow:g=0,sheetViewStartColumn:S=0,offsetX:p=0,offsetY:f=0}=d||{};return e.executeCommand(We.id,{unitId:s,sheetId:l,sheetViewStartRow:g,sheetViewStartColumn:S,offsetX:p+u,offsetY:f+h})}},Ue={id:"sheet.command.scroll-view",type:a.CommandType.COMMAND,handler:(n,o)=>{if(!o)return!1;const e=n.get(a.IUniverInstanceService),t=n.get(T.IRenderManagerService),r=m.getSheetCommandTarget(e);if(!r)return!1;const{workbook:i,worksheet:s,unitId:l}=r,d=t.getRenderById(l).with(exports.SheetScrollManagerService).getCurrentScrollState();if(!s)return!1;const{sheetViewStartRow:u,sheetViewStartColumn:h,offsetX:g,offsetY:S,duration:p}=o,{sheetViewStartColumn:f,sheetViewStartRow:v,offsetX:C,offsetY:_}=d||{},{xSplit:R,ySplit:w}=r.worksheet.getConfig().freeze;return n.get(a.ICommandService).syncExecuteCommand(We.id,{unitId:i.getUnitId(),sheetId:s.getSheetId(),sheetViewStartRow:u!=null?u:v!=null?v:0+w,sheetViewStartColumn:h!=null?h:f!=null?f:0+R,offsetX:g!=null?g:C,offsetY:S!=null?S:_,duration:p})}},rs={id:"sheet.command.scroll-to-cell",type:a.CommandType.COMMAND,handler:(n,o)=>{const e=n.get(a.IUniverInstanceService);return n.get(T.IRenderManagerService).getRenderById(e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId()).with(exports.SheetsScrollRenderController).scrollToRange(o.range,o.forceTop,o.forceLeft)}},Yu={id:"sheet.command.scroll-view-reset",type:a.CommandType.COMMAND,handler:async n=>{const o=n.get(a.IUniverInstanceService),e=m.getSheetCommandTarget(o);if(!e)return!1;const{subUnitId:t,unitId:r}=e;return n.get(a.ICommandService).executeCommand(We.id,{unitId:r,sheetId:t,sheetViewStartRow:0,sheetViewStartColumn:0})}};var Zu=Object.getOwnPropertyDescriptor,Gu=(n,o,e,t)=>{for(var r=t>1?void 0:t?Zu(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ks=(n,o)=>(e,t)=>o(e,t,n);const Ku=(n,o)=>{const{unitId:e,subUnitId:t,ranges:r}=n,i={},s=o.getColumnManager();for(let l=0;l<r.length;l++){const c=r[l];for(let d=c.startColumn;d<c.endColumn+1;d++)i[d]=s.getColumnWidth(d)}return{unitId:e,subUnitId:t,ranges:r,colWidth:i}};exports.AutoWidthController=class extends a.Disposable{constructor(o,e){super(),this._renderManagerService=o,this._univerInstanceService=e}getUndoRedoParamsOfColWidth(o){const e={redos:[],undos:[]},{_univerInstanceService:t}=this,r=m.getSheetCommandTarget(t);if(!r)return e;const{unitId:i,subUnitId:s,worksheet:l}=r,c=this._renderManagerService.getRenderById(i).with(exports.SheetSkeletonManagerService);if(!c.getCurrentParam())return e;const{skeleton:d}=c.getCurrentParam(),u=d.calculateAutoWidthInRange(o.ranges),h={};for(const{col:p,width:f}of u)h[p]=f;const g={subUnitId:s,unitId:i,ranges:o.ranges,colWidth:h},S=Ku(g,l);return{undos:[{id:m.SetWorksheetColWidthMutation.id,params:S}],redos:[{id:m.SetWorksheetColWidthMutation.id,params:g}]}}};exports.AutoWidthController=Gu([Ks(0,T.IRenderManagerService),Ks(1,a.Inject(a.IUniverInstanceService))],exports.AutoWidthController);const Dn={type:a.CommandType.COMMAND,id:"sheet.command.set-col-auto-width",handler:(n,o)=>{const e=n.get(a.ICommandService),t=n.get(a.IUndoRedoService),r=n.get(m.SheetsSelectionsService),i=n.get(a.IUniverInstanceService),s=m.getSheetCommandTarget(i,o);if(!s)return!1;const{unitId:l,subUnitId:c}=s;let d=[];if(o!=null&&o.ranges)d=[...o.ranges];else{const p=r.getCurrentSelections();for(let f=0;f<p.length;f++)d.push(p[f].range)}if(!(d!=null&&d.length))return!1;const u={unitId:l,subUnitId:c,ranges:d},{redos:h,undos:g}=n.get(exports.AutoWidthController).getUndoRedoParamsOfColWidth(u);return a.sequenceExecute([...h],e).result?(t.pushUndoRedo({unitID:l,undoMutations:[...g],redoMutations:[...h]}),!0):!1}};var qu=Object.getOwnPropertyDescriptor,Qu=(n,o,e,t)=>{for(var r=t>1?void 0:t?qu(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Jt=(n,o)=>(e,t)=>o(e,t,n);exports.EditorBridgeService=class extends a.Disposable{constructor(e,t,r,i,s,l){super();E(this,"_editorUnitId",a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY);E(this,"_editorIsDirty",!1);E(this,"_visibleParams",{visible:!1,eventType:T.DeviceInputEventType.Dblclick,unitId:""});E(this,"_currentEditCell",null);E(this,"_currentEditCellState",null);E(this,"_currentEditCellLayout",null);E(this,"helpFunctionVisible$",new O.BehaviorSubject(!0));E(this,"_currentEditCellState$",new O.BehaviorSubject(null));E(this,"currentEditCellState$",this._currentEditCellState$.asObservable());E(this,"_currentEditCellLayout$",new O.BehaviorSubject(null));E(this,"currentEditCellLayout$",this._currentEditCellLayout$.asObservable());E(this,"currentEditCell$",this._currentEditCellState$.pipe(O.switchMap(e=>this._currentEditCellLayout$.pipe(O.map(t=>e&&t?{...e,...t}:null)))));E(this,"_visibleParams$",new O.BehaviorSubject(this._visibleParams));E(this,"visible$",this._visibleParams$.asObservable());E(this,"_afterVisibleParams$",new O.BehaviorSubject(this._visibleParams));E(this,"afterVisible$",this._afterVisibleParams$.asObservable());E(this,"_forceKeepVisible$",new O.BehaviorSubject(!1));E(this,"forceKeepVisible$",this._forceKeepVisible$.asObservable());this._sheetInterceptorService=e,this._renderManagerService=t,this._themeService=r,this._univerInstanceService=i,this._editorService=s,this._contextService=l,this.disposeWithMe(a.toDisposable(()=>{this._currentEditCellState$.complete(),this._currentEditCell=null})),this._univerInstanceService.getTypeOfUnitDisposed$(a.UniverInstanceType.UNIVER_SHEET).subscribe(c=>{var d;c.getUnitId()===((d=this._currentEditCellState)==null?void 0:d.unitId)&&this._clearCurrentEditCellState()})}refreshEditCellState(){const e=this.getLatestEditCellState();if(!e){this._currentEditCellState=null,this._currentEditCellLayout=null,this._currentEditCellState$.next(null),this._currentEditCellLayout$.next(null);return}const{position:t,scaleX:r,scaleY:i,canvasOffset:s,...l}=e;this._currentEditCellState=l,this._currentEditCellLayout={position:t,scaleX:r,scaleY:i,canvasOffset:s},this._currentEditCellState$.next(this._currentEditCellState),this._currentEditCellLayout$.next(this._currentEditCellLayout)}refreshEditCellPosition(e){var P;const t=this._currentEditCell;if(t==null)return;const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!r)return;const i=this._renderManagerService.getRenderUnitById(r.getUnitId());if(!i)return;const s=(P=i.with(exports.SheetSkeletonManagerService).getSkeletonParam(t.sheetId))==null?void 0:P.skeleton,l=i.with(Ce);if(!s||!this._currentEditCellState)return;const{primary:c,scene:d,engine:u}=t,h=nr(s,c);if(h==null)return;const g=a.convertCellToRange(h),S=J.getCanvasOffsetByEngine(u);let{startX:p,startY:f,endX:v,endY:C}=g;const{scaleX:_,scaleY:R}=d.getAncestorScale(),w=d.getViewportScrollXY(l.getViewPort());p=T.convertTransformToOffsetX(p,_,w),f=T.convertTransformToOffsetY(f,R,w),v=T.convertTransformToOffsetX(v,_,w),C=T.convertTransformToOffsetY(C,R,w),e&&this._currentEditCellLayout&&(v=v-p+this._currentEditCellLayout.position.startX,C=C-f+this._currentEditCellLayout.position.startY,p=this._currentEditCellLayout.position.startX,f=this._currentEditCellLayout.position.startY),this._currentEditCellLayout={position:{startX:p,startY:f,endX:v,endY:C},canvasOffset:S,scaleX:_,scaleY:R},this._currentEditCellLayout$.next(this._currentEditCellLayout)}setEditCell(e){this._currentEditCell=e,this._editorService.getFocusEditor()||(this._editorService.focus(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY),this._contextService.setContextValue(a.EDITOR_ACTIVATED,!1),this._contextService.setContextValue(a.FOCUSING_EDITOR_STANDALONE,!1));const t=this.getLatestEditCellState();if(!t){this._currentEditCellState=t,this._currentEditCellLayout=t,this._currentEditCellState$.next(t),this._currentEditCellLayout$.next(t);return}const{position:r,canvasOffset:i,scaleX:s,scaleY:l,...c}=t;this._currentEditCellState=c,this._currentEditCellLayout={position:r,canvasOffset:i,scaleX:s,scaleY:l},this._currentEditCellState$.next(this._currentEditCellState),this._currentEditCellLayout$.next(this._currentEditCellLayout)}_clearCurrentEditCellState(){this._currentEditCellState=null,this._currentEditCellState$.next(null),this._currentEditCellLayout=null,this._currentEditCellLayout$.next(null)}getEditCellState(){return this._currentEditCellState==null||this._currentEditCellLayout==null?null:{...this._currentEditCellState,...this._currentEditCellLayout}}getEditCellLayout(){return this._currentEditCellLayout}getEditLocation(){return this._currentEditCellState}updateEditLocation(e,t){this._currentEditCellState&&(this._currentEditCellState={...this._currentEditCellState,row:e,column:t})}getLatestEditCellState(){var H,k,U;const e=this._currentEditCell;if(e==null)return;const t=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!t)return;const r=this._renderManagerService.getRenderUnitById(t.getUnitId());if(!r)return;const i=r.with(exports.SheetSkeletonManagerService).getCurrentSkeleton(),s=r.with(Ce);if(!i)return;const{primary:l,unitId:c,sheetId:d,scene:u,engine:h}=e,{startRow:g,startColumn:S}=l,p=nr(i,l);if(p==null)return;const f=a.convertCellToRange(p),v=J.getCanvasOffsetByEngine(h);let{startX:C,startY:_,endX:R,endY:w}=f;const{scaleX:P,scaleY:y}=u.getAncestorScale(),M=u.getViewportScrollXY(s.getViewPort());C=T.convertTransformToOffsetX(C,P,M),_=T.convertTransformToOffsetY(_,y,M),R=T.convertTransformToOffsetX(R,P,M),w=T.convertTransformToOffsetY(w,y,M);const x=t.getActiveSheet();if(!x)return;const A={workbook:t,worksheet:x,unitId:t.getUnitId(),subUnitId:x.getSheetId(),row:g,col:S,origin:x.getCellRaw(g,S)};let D;const N=this._sheetInterceptorService.writeCellInterceptor.fetchThroughInterceptors(m.BEFORE_CELL_EDIT)(x.getCell(g,S),A);D=N&&x.getCellDocumentModelWithFormula(N,A.row,A.col);const V=(H=D==null?void 0:D.documentModel)==null?void 0:H.documentStyle.renderConfig;if(V!=null&&(V.cellValueType=a.CellValueType.STRING),!D||D.documentModel==null){const L=x.getBlankCellDocumentModel(N,A.row,A.col);if(D!=null){const{verticalAlign:j,horizontalAlign:B,wrapStrategy:z,textRotation:X,fill:K}=D,{centerAngle:ie,vertexAngle:re}=T.convertTextRotation(X);L.documentModel.documentStyle.renderConfig={...V,verticalAlign:j,horizontalAlign:B,wrapStrategy:z,background:{rgb:K},centerAngle:ie,vertexAngle:re}}D=L}if(D.fill=D.fill||"#fff",(k=D.documentModel)==null||k.setZoomRatio(Math.max(P,y)),(N==null?void 0:N.isInArrayFormulaRange)===!0){const L=(U=D.documentModel)==null?void 0:U.getBody();L&&(L.textRuns=[{st:0,ed:L.dataStream.length-2,ts:{cl:{rgb:this._themeService.getColorFromTheme("gray.600")}}}])}return{position:{startX:C,startY:_,endX:R,endY:w},scaleX:P,scaleY:y,canvasOffset:v,row:g,column:S,unitId:c,sheetId:d,documentLayoutObject:D,editorUnitId:this._editorUnitId,isInArrayFormulaRange:N==null?void 0:N.isInArrayFormulaRange}}getCurrentEditorId(){return this._editorUnitId}changeVisible(e){this._visibleParams=e,e.visible&&(this._editorIsDirty=!1),this._visibleParams$.next(this._visibleParams),this._afterVisibleParams$.next(this._visibleParams)}isVisible(){return this._visibleParams}enableForceKeepVisible(){this._forceKeepVisible$.next(!0)}disableForceKeepVisible(){this._forceKeepVisible$.next(!1)}isForceKeepVisible(){return this._forceKeepVisible$.getValue()}changeEditorDirty(e){this._editorIsDirty=e}getEditorDirty(){return this._editorIsDirty}};exports.EditorBridgeService=Qu([Jt(0,a.Inject(m.SheetInterceptorService)),Jt(1,T.IRenderManagerService),Jt(2,a.Inject(a.ThemeService)),Jt(3,a.IUniverInstanceService),Jt(4,J.IEditorService),Jt(5,a.IContextService)],exports.EditorBridgeService);const he=a.createIdentifier("univer.sheet-editor-bridge.service");var Ju=Object.getOwnPropertyDescriptor,$u=(n,o,e,t)=>{for(var r=t>1?void 0:t?Ju(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ur=(n,o)=>(e,t)=>o(e,t,n);let ir=class extends a.Disposable{constructor(o,e,t,r,i){super();E(this,"_zoom");this._context=o,this._sheetSkeletonManagerService=e,this._commandService=t,this._contextService=r,this._editorBridgeService=i,this._initSkeletonListener(),this._initZoomEventListener()}updateZoom(o,e){const t=this._context.unit.getSheetBySheetId(o);return t?(t.getConfig().zoomRatio=e,t===this._context.unit.getActiveSheet()&&this._updateViewZoom(e),!0):!1}_initZoomEventListener(){const o=Ne(this._context.unit,this._context).scene;this.disposeWithMe(o.onMouseWheel$.subscribeEvent(e=>{if(!e.ctrlKey||!this._contextService.getContextValue(a.FOCUSING_SHEET))return;if(this._editorBridgeService){const d=this._editorBridgeService.isVisible();if((d.unitId===this._context.unitId||d.unitId===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)&&d.visible)return}const t=Math.abs(e.deltaX);let r=t<40?.2:t<80?.4:.2;r*=e.deltaY>0?-1:1,o.scaleX<1&&(r/=2);const i=this._context.unit,s=i.getActiveSheet();if(!s)return;const l=s.getZoomRatio();let c=+Number.parseFloat(`${l+r}`).toFixed(1);c=c>=4?4:c<=.1?.1:c,this._commandService.executeCommand(kn.id,{zoomRatio:Math.round(c*10)/10,unitId:i.getUnitId(),subUnitId:s.getSheetId()}),e.preventDefault()}))}_initSkeletonListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(o=>{if(o==null)return;const t=this._context.unit.getActiveSheet();if(!t)return;const r=t.getZoomRatio()||1;this._zoom!==r&&this._updateViewZoom(r)}))}_updateViewZoom(o){this._zoom=o;const e=Ne(this._context.unit,this._context);e==null||e.scene.scale(o,o),e==null||e.spreadsheet.makeForceDirty()}};ir=$u([Ur(1,a.Inject(exports.SheetSkeletonManagerService)),Ur(2,a.ICommandService),Ur(3,a.IContextService),Ur(4,a.Optional(he))],ir);const De={id:"sheet.operation.set-zoom-ratio",type:a.CommandType.OPERATION,handler:(n,o)=>{const t=n.get(T.IRenderManagerService).getRenderById(o.unitId);return t?t.with(ir).updateZoom(o.subUnitId,o.zoomRatio):!1}},Nn={id:"sheet.command.change-zoom-ratio",type:a.CommandType.COMMAND,handler:(n,o)=>{if(!o)return!1;const e=n.get(a.IUniverInstanceService),t=m.getSheetCommandTarget(e);if(!t)return!1;const{worksheet:r,subUnitId:i,unitId:s}=t,{delta:l,reset:c}=o;let d=c?100:Math.round((r.getConfig().zoomRatio+l)*100);d=Math.max(Ri[0],d),d=Math.min(Ri[1],d);const u=d/100,g=n.get(he).isVisible();return(g.unitId===s||g.unitId===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)&&g.visible?!1:n.get(a.ICommandService).executeCommand(De.id,{unitId:s,subUnitId:i,zoomRatio:u})}},kn={id:"sheet.command.set-zoom-ratio",type:a.CommandType.COMMAND,handler:(n,o)=>{if(!o)return!1;const{unitId:e,subUnitId:t,zoomRatio:r}=o,s=n.get(he).isVisible();return(s.unitId===e||s.unitId===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)&&s.visible?!1:n.get(a.ICommandService).executeCommand(De.id,{unitId:e,subUnitId:t,zoomRatio:r})}},Xt=a.createIdentifier("univer.sheetbar-service");class Ja extends a.Disposable{constructor(){super();E(this,"renameId$");E(this,"removeId$");E(this,"scroll$");E(this,"scrollX$");E(this,"addSheet$");E(this,"_renameId$");E(this,"_removeId$");E(this,"_scroll$");E(this,"_scrollX$");E(this,"_addSheet$");E(this,"_currentHandler",null);this._renameId$=new O.Subject,this.renameId$=this._renameId$.asObservable(),this._removeId$=new O.Subject,this.removeId$=this._removeId$.asObservable(),this._scroll$=new O.Subject,this.scroll$=this._scroll$.asObservable(),this._scrollX$=new O.Subject,this.scrollX$=this._scrollX$.asObservable(),this._addSheet$=new O.Subject,this.addSheet$=this._addSheet$.asObservable()}setRenameId(e){this._renameId$.next(e)}setRemoveId(e){this._removeId$.next(e)}setScroll(e){this._scroll$.next(e)}setScrollX(e){this._scrollX$.next(e)}setAddSheet(e){this._addSheet$.next(e)}triggerSheetBarMenu(){var e;(e=this._currentHandler)==null||e.handleSheetBarMenu()}registerSheetBarMenuHandler(e){if(this._currentHandler)throw new Error("There is already a context menu handler!");return this._currentHandler=e,a.toDisposable(()=>{this._currentHandler=null})}}const Mr={id:"ui-sheet.command.show-menu-list",type:a.CommandType.OPERATION,handler:async n=>(n.get(Xt).triggerSheetBarMenu(),!0)},Pr={type:a.CommandType.COMMAND,id:"sheet.command.delete-worksheet-protection-from-sheet-bar",async handler(n,o){if(!o)return!1;const e=n.get(a.ICommandService),t=n.get(a.IUndoRedoService),r=n.get(m.WorksheetProtectionRuleModel),s=n.get(a.IUniverInstanceService).getCurrentUnitForType(Za.UNIVER_SHEET),l=s==null?void 0:s.getActiveSheet(),c=s.getUnitId();if(!l)return!1;const d=l.getSheetId(),u=r.getRule(c,d);if(await e.executeCommand(m.DeleteWorksheetProtectionCommand.id,{unitId:c,subUnitId:d})){const g=[{id:m.DeleteWorksheetProtectionCommand.id,params:{unitId:c,subUnitId:d}}],S=[{id:m.AddWorksheetProtectionCommand.id,params:{unitId:c,rule:u}}];t.pushUndoRedo({unitID:c,redoMutations:g,undoMutations:S})}return!0}},xr={type:a.CommandType.COMMAND,id:"sheet.command.change-sheet-protection-from-sheet-bar",async handler(n){return await n.get(a.ICommandService).executeCommand("sheet-permission.operation.openDialog"),!0}},No={id:"sheet.operation.set-activate-cell-edit",type:a.CommandType.OPERATION,handler:(n,o)=>(n.get(he).setEditCell(o),!0)},Se={id:"sheet.operation.set-cell-edit-visible",type:a.CommandType.OPERATION,handler:(n,o)=>{if(!o)return!1;const{unitId:e}=o,r=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);return r?(n.get(he).changeVisible({...o,unitId:e!=null?e:r.getUnitId()}),!0):!1}},Or={id:"sheet.operation.set-cell-edit-visible-f2",type:a.CommandType.OPERATION,handler:(n,o)=>{const e=n.get(a.ICommandService),r=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);return r?e.syncExecuteCommand(Se.id,{...o,unitId:r.getUnitId()}):!1}},Wt={id:"sheet.operation.set-cell-edit-visible-arrow",type:a.CommandType.OPERATION,handler:()=>!0},Ar={id:"sheet.operation.rename-sheet",type:a.CommandType.OPERATION,handler:async(n,o)=>{const e=n.get(Xt);return o&&e.setRenameId(o.subUnitId),!0}},ko={id:"sheet.operation.scroll-to-range",type:a.CommandType.OPERATION,handler:(n,o)=>{if(!o)return!1;const e=n.get(a.IUniverInstanceService);return n.get(T.IRenderManagerService).getRenderById(e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId()).with(exports.SheetsScrollRenderController).scrollToRange(o.range,o.forceTop,o.forceLeft)}},os={type:a.CommandType.OPERATION,id:"sheet-permission.operation.openDialog",async handler(n,o){const e=n.get(I.IDialogService);return e.close("DESKTOP_FIND_REPLACE_DIALOG"),e.open({id:ro,title:{title:"permission.dialog.allowedPermissionType"},children:{label:Ka},width:393,destroyOnClose:!0,onClose:()=>e.close(ro)}),!0}},sr="DefinedNameContainer",Ho={id:"sidebar.operation.defined-name",type:a.CommandType.COMMAND,handler:async(n,o)=>{const e=n.get(I.ISidebarService);n.get(J.IEditorService);const t=n.get(a.LocaleService),r=n.get(a.IUniverInstanceService),i=m.getSheetCommandTarget(r);if(!i)return!1;const{unitId:s}=i;switch(o.value){case"open":e.open({id:sr,header:{title:t.t("definedName.featureTitle")},children:{label:sr},onClose:()=>{},width:333});break;case"close":default:e.close();break}return!0}};function eh(n,o){if(n.length!==o.length)return!1;const e=n.sort((r,i)=>r.id.localeCompare(i.id)),t=o.sort((r,i)=>r.id.localeCompare(i.id));return e.every((r,i)=>{var s,l;return((s=r.subject)==null?void 0:s.userID)===((l=t[i].subject)==null?void 0:l.userID)&&r.role===t[i].role})}function $a(n,o){return o.some(e=>th(n,e))}function th(n,o){const{startRow:e,startColumn:t,endColumn:r,endRow:i}=o,s=n.getMatrixWithMergedCells(e,t,i,r);let l=!1;return s.forValue((c,d,u)=>{if(u&&(c!==e||d!==t)&&n.cellHasValue(u))return l=!0,!1}),l}function el(n,o,e,t){const r=[],i=[],s=e.getSheetId();return t.forEach(l=>{const c=nh(e,l),d={unitId:o,subUnitId:s,cellValue:c.getData()},u=m.SetRangeValuesUndoMutationFactory(n,d);r.push({id:m.SetRangeValuesMutation.id,params:u}),i.push({id:m.SetRangeValuesMutation.id,params:d})}),{undos:r,redos:i}}function nh(n,o){const{startRow:e,startColumn:t,endColumn:r,endRow:i}=o,s=n.getMatrixWithMergedCells(e,t,i,r,a.CellModeEnum.Raw),l=new a.ObjectMatrix;let c=null;return s.forValue((d,u,h)=>{var g,S,p,f;h&&d>=e&&u>=t&&(!c&&n.cellHasValue(h)&&(h.v!==""||((f=(p=(S=(g=h.p)==null?void 0:g.body)==null?void 0:S.dataStream)==null?void 0:p.length)!=null?f:0)>2)&&(c=h),l.setValue(d,u,null))}),l.setValue(e,t,c),l}function rh(n,o,e,t){const r=e.getActiveViewportByCoord(T.Vector2.FromArray([n,o]));if(!r)return;const{scaleX:i,scaleY:s}=e.getAncestorScale(),l={x:r.viewportScrollX,y:r.viewportScrollY},c=t.getCellIndexByOffset(n,o,i,s,l),d=t.worksheet.getMergedCell(c.row,c.column);return{actualRow:d?d.startRow:c.row,actualCol:d?d.startColumn:c.column,mergeCell:d,row:c.row,col:c.column}}function qs(n,o,e,t){const r=t.getFreeze();if(!r||r.startRow<=0&&r.startColumn<=0||n>=r.startRow&&o>=r.startColumn)return e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(n<r.startRow&&o<r.startColumn)return e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP);if(n<r.startRow&&o>=r.startColumn)return e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP);if(n>=r.startRow&&o<r.startColumn)return e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT)}function oh(n,o,e,t){const r=Qs(n.left,n.top,o,e,t),i=Qs(n.right,n.bottom,o,e,t);return{left:r.x,top:r.y,right:i.x,bottom:i.y}}function Qs(n,o,e,t,r){const{scaleX:i,scaleY:s}=e.getAncestorScale(),l=e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(!l)return{x:n,y:o};const c=r.getFreeze(),{startColumn:d,startRow:u,xSplit:h,ySplit:g}=c,S=t.getNoMergeCellWithCoordByIndex(u-g,d-h,!1),p=t.getNoMergeCellWithCoordByIndex(u,d,!1),{rowHeaderWidth:f,columnHeaderHeight:v}=t,C=p.startX-S.startX,_=p.startY-S.startY,{top:R,left:w,viewportScrollX:P,viewportScrollY:y}=l;let M;n>w?M=(n-P)*i:M=(C+f-(w-n))*i;let x;return o>R?x=(o-y)*s:x=(_+v-(R-o))*i,{x:M,y:x}}function tl(n,o,e,t,r){let i=t,s=r;e.overflowCache.forValue((d,u,h)=>{h.startRow<=i&&h.endRow>=i&&h.startColumn<=s&&h.endColumn>=s&&(s=u,i=d)});const l=e.getCellWithCoordByIndex(i,s);return{unitId:n.getUnitId(),subUnitId:o.getSheetId(),workbook:n,worksheet:o,row:l.actualRow,col:l.actualColumn}}function nl(n,o,e,t,r,i){const{scene:s}=n,l=o.getUnitId(),{skeleton:c,sheetId:d}=t,u=rh(r,i,s,c);if(!u)return null;let{actualCol:h,actualRow:g}=u;const S={unitId:l,subUnitId:d,workbook:o,worksheet:e,row:g,col:h};c.overflowCache.forValue((y,M,x)=>{x.startRow<=g&&x.endRow>=g&&x.startColumn<=h&&x.endColumn>=h&&(h=M,g=y)});const p=c.getCellWithCoordByIndex(g,h),f=tl(o,e,c,g,h);let v;p.mergeInfo?v=p.mergeInfo:v={startRow:f.row,endRow:f.row,startColumn:f.col,endColumn:f.col};const C=s.getActiveViewportByCoord(T.Vector2.FromArray([r,i]));if(!C)return;const{scaleX:_,scaleY:R}=s.getAncestorScale(),w={x:C.viewportScrollX,y:C.viewportScrollY};return{position:{startX:(c.getOffsetByColumn(v.startColumn-1)-w.x)*_,endX:(c.getOffsetByColumn(v.endColumn)-w.x)*_,startY:(c.getOffsetByRow(v.startRow-1)-w.y)*R,endY:(c.getOffsetByRow(v.endRow)-w.y)*R},location:S,overflowLocation:f}}function vt(){const n=I.useDependency(a.IUniverInstanceService),o=I.useObservable(()=>n.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),void 0,void 0,[]);return o!=null?o:null}function ih(n){return I.useObservable(()=>{var e;return(e=n==null?void 0:n.activeSheet$)!=null?e:O.of(null)},void 0,void 0,[n])}function sh(){const n=I.useDependency(a.IUniverInstanceService);return I.useObservable(()=>O.merge([n.getTypeOfUnitAdded$(a.UniverInstanceType.UNIVER_SHEET),n.getTypeOfUnitDisposed$(a.UniverInstanceType.UNIVER_SHEET)]).pipe(O.map(()=>n.getAllUnitsForType(a.UniverInstanceType.UNIVER_SHEET)),O.startWith(n.getAllUnitsForType(a.UniverInstanceType.UNIVER_SHEET))),[],void 0,[n])}const ah="SheetUI";var is=(n=>(n.FILTER_PANEL_EMBED_POINT="filter-panel-embed-point",n.SHEETS_FOOTER="sheets-footer",n.FORMULA_AUX="formula-aux",n))(is||{}),lh=Object.getOwnPropertyDescriptor,ch=(n,o,e,t)=>{for(var r=t>1?void 0:t?lh(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Lr=(n,o)=>(e,t)=>o(e,t,n);const Js="univer-sheet-main-canvas";exports.SheetsRenderService=class extends a.RxDisposable{constructor(e,t,r,i){super();E(this,"_skeletonChangeMutations",new Set);this._contextService=e,this._instanceSrv=t,this._renderManagerService=r,this._themeService=i,Promise.resolve().then(()=>this._init())}registerSkeletonChangingMutations(e){return this._skeletonChangeMutations.has(e)?a.toDisposable(()=>{}):(this._skeletonChangeMutations.add(e),a.toDisposable(()=>this._skeletonChangeMutations.delete(e)))}checkMutationShouldTriggerRerender(e){return this._skeletonChangeMutations.has(e)}_init(){this._initWorkbookListener(),this._initContextListener()}_initWorkbookListener(){this._instanceSrv.getTypeOfUnitAdded$(a.UniverInstanceType.UNIVER_SHEET).pipe(O.takeUntil(this.dispose$)).subscribe(e=>this._createRenderer(e)),this._instanceSrv.getAllUnitsForType(a.UniverInstanceType.UNIVER_SHEET).forEach(e=>this._createRenderer(e)),this._instanceSrv.getTypeOfUnitDisposed$(a.UniverInstanceType.UNIVER_SHEET).pipe(O.takeUntil(this.dispose$)).subscribe(e=>this._disposeRenderer(e))}_createRenderer(e){const t=e.getUnitId();this._renderManagerService.created$.subscribe(r=>{r.unitId===t&&(r.engine.getCanvas().setId(`${Js}_${t}`),r.engine.getCanvas().getContext().setId(`${Js}_${t}`))}),this._renderManagerService.createRender(t)}_disposeRenderer(e){const t=e.getUnitId();this._renderManagerService.removeRender(t)}_initContextListener(){this.disposeWithMe(this._contextService.subscribeContextValue$(T.RENDER_RAW_FORMULA_KEY).pipe(O.distinctUntilChanged()).subscribe(()=>{this._renderManagerService.getRenderAll().forEach(e=>{e.mainComponent instanceof T.Spreadsheet&&e.mainComponent.makeForceDirty(!0)})}))}};exports.SheetsRenderService=ch([Lr(0,a.IContextService),Lr(1,a.IUniverInstanceService),Lr(2,T.IRenderManagerService),Lr(3,a.Inject(a.ThemeService))],exports.SheetsRenderService);var dh=Object.getOwnPropertyDescriptor,uh=(n,o,e,t)=>{for(var r=t>1?void 0:t?dh(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},_t=(n,o)=>(e,t)=>o(e,t,n);exports.AutoFillController=class extends a.Disposable{constructor(e,t,r,i,s,l,c){super();E(this,"_beforeApplyData",[]);E(this,"_currentLocation",null);E(this,"_copyData",[]);E(this,"_defaultHook");this._univerInstanceService=e,this._commandService=t,this._autoFillService=r,this._editorBridgeService=i,this._renderManagerService=s,this._injector=l,this._sheetsRenderService=c,this._defaultHook={id:"default",type:nn.Default,priority:0,onBeforeFillData:(d,u)=>this._presetAndCacheData(d,u),onFillData:(d,u,h)=>this._fillData(d,u,h)},this._init()}_init(){this._initDefaultHook(),this._initSelectionControlFillChanged(),this._initQuitListener(),this._initSkeletonChange()}_initSkeletonChange(){this.disposeWithMe(this._sheetsRenderService.registerSkeletonChangingMutations(dt.id))}_initDefaultHook(){this.disposeWithMe(this._autoFillService.addHook(this._defaultHook))}_initQuitListener(){const e=[Se.id,mn.id,m.SetRangeValuesCommand.id,De.id,m.SetWorksheetActiveOperation.id,m.MoveRangeMutation.id,m.RemoveRowMutation.id,m.RemoveColMutation.id,m.InsertRowMutation.id,m.InsertColMutation.id,m.MoveRowsMutation.id,m.MoveColsMutation.id,m.SetWorksheetColWidthMutation.id,m.SetWorksheetRowHeightMutation.id,m.SetRangeValuesMutation.id];this.disposeWithMe(this._commandService.onCommandExecuted((t,r)=>{var c,d;const i=r==null?void 0:r.fromCollab,s=r==null?void 0:r.fromSync,l=r==null?void 0:r.fromFormula;e.includes(t.id)&&!i&&!s&&!l&&t.params.trigger!==dt.id&&t.params.trigger!==_r.id&&this._quit(),t.id===m.RemoveSheetMutation.id&&t.params.unitId===((c=this._currentLocation)==null?void 0:c.unitId)&&t.params.subUnitId===((d=this._currentLocation)==null?void 0:d.subUnitId)&&this._quit()})),this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe(t=>{var r;t.getUnitId()===((r=this._currentLocation)==null?void 0:r.unitId)&&this._quit()}))}_quit(){this._currentLocation=null,this._beforeApplyData=[],this._copyData=[],this._autoFillService.setShowMenu(!1)}_initSelectionControlFillChanged(){const e=new a.DisposableCollection,t=()=>{e.dispose();const r=T.getCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,this._univerInstanceService,this._renderManagerService);if(!r)return;r.with(Ce).getSelectionControls().forEach(l=>{e.add(l.selectionFilled$.subscribe(c=>{if(c==null||c.startColumn===-1||c.startRow===-1||c.endColumn===-1||c.endRow===-1)return;const d={startColumn:l.model.startColumn,endColumn:l.model.endColumn,startRow:l.model.startRow,endRow:l.model.endRow},u={startColumn:c.startColumn,endColumn:c.endColumn,startRow:c.startRow,endRow:c.endRow};this._commandService.executeCommand(dt.id,{sourceRange:d,targetRange:u})})),e.add(l.fillControl.onDblclick$.subscribeEvent(()=>{const c={startColumn:l.model.startColumn,endColumn:l.model.endColumn,startRow:l.model.startRow,endRow:l.model.endRow};this._handleDbClickFill(c)})),e.add(l.fillControl.onPointerDown$.subscribeEvent(()=>{this._editorBridgeService.isVisible().visible&&this._commandService.syncExecuteCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.PointerDown,unitId:r.unitId})}))})};t(),this.disposeWithMe(this._commandService.onCommandExecuted(r=>{r.id===m.SetSelectionsOperation.id&&t()})),this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(()=>t()))}_handleDbClickFill(e){const t=this._detectFillRange(e);t.endRow<=e.endRow||this._commandService.executeCommand(dt.id,{sourceRange:e,targetRange:t})}_detectFillRange(e){var g,S,p,f,v,C;const{startRow:t,endRow:r,startColumn:i,endColumn:s}=e,l=(g=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET))==null?void 0:g.getActiveSheet();if(!l)return e;const c=l.getCellMatrix(),d=l.getMaxRows()-1,u=l.getMaxColumns()-1;let h=r;if(i>0&&((S=c.getValue(t,i-1))==null?void 0:S.v)!=null){let _=t;for(;((p=c.getValue(_,i-1))==null?void 0:p.v)!=null&&_<d;)_+=1;h=_-1}else if(s<u&&((f=c.getValue(r,s+1))==null?void 0:f.v)!=null){let _=t;for(;((v=c.getValue(_,s+1))==null?void 0:v.v)!=null&&_<d;)_+=1;h=_-1}for(let _=r+1;_<=h;_++)for(let R=i;R<=s;R++)if(((C=c.getValue(_,R))==null?void 0:C.v)!=null){h=_-1;break}return{startColumn:i,endColumn:s,startRow:t,endRow:h}}_getApplyData(e,t,r,i,s,l=!0,c){const d=[],u=Math.floor(r/t),h=r%t,g=this._autoFillService.getRules();if(!l&&s===ae.ONLY_FORMAT)return console.error("ERROR: only format can not be applied when hasStyle is false"),[];const S={};g.forEach(p=>{S[p.type]=[]}),g.forEach(p=>{const{type:f,applyFunctions:v={}}=p,C=e[f];C&&C.forEach(_=>{const R=yd(_.index,h),w=_.index.length*u+R,P=this._applyFunctions(_,w,i,s,v,e,c),y=Md(t,r,_.index);S[f].push({data:P,index:y})})});for(let p=0;p<r;p++)g.forEach(f=>{const{type:v}=f,C=S[v];for(let _=0;_<C.length;_++)p in C[_].index&&d.push(C[_].data[C[_].index[p]])});return d}_applyFunctions(e,t,r,i,s,l,c){const{data:d}=e,u=r===a.Direction.UP||r===a.Direction.LEFT;if(i===ae.COPY){const h=s==null?void 0:s[ae.COPY];return h?h(e,t,r,l,c):(u&&d.reverse(),Dt(d,t))}if(i===ae.SERIES){const h=s==null?void 0:s[ae.SERIES];return h?h(e,t,r,l):(u&&d.reverse(),s!=null&&s[ae.COPY]?s[ae.COPY](e,t,r,l,c):Dt(d,t))}if(i===ae.ONLY_FORMAT){const h=s==null?void 0:s[ae.ONLY_FORMAT];return h?h(e,t,r,l):Pd(d,t)}}_getCopyData(e,t){const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet();if(!r)throw new Error("No active sheet found");const i=r.getCellMatrix(),s=this._autoFillService.getRules(),l=[],c=t===a.Direction.DOWN||t===a.Direction.UP;let d,u;return c?(d=e.cols,u=e.rows):(d=e.rows,u=e.cols),d.forEach(h=>{const g=this._getEmptyCopyDataPiece(),S={type:void 0,cellData:void 0};u.forEach(p=>{let f;c?f=i.getValue(p,h):f=i.getValue(h,p);const{type:v,isContinue:C}=s.find(_=>_.match(f,this._injector))||Va;if(C(S,f)){const _=g[v],R=_[_.length-1];R.data.push(f),R.index.push(p-u[0])}else{const _=g[v];_?_.push({data:[f],index:[p-u[0]]}):g[v]=[{data:[f],index:[p-u[0]]}]}S.type=v,S.cellData=f}),l.push(g)}),l}_getEmptyCopyDataPiece(){const e={};return this._autoFillService.getRules().forEach(t=>{e[t.type]=[]}),e}_getMergeApplyData(e,t,r,i){const s=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet();if(!s)throw new Error("No active sheet found");const l=[];for(let c=e.startRow;c<=e.endRow;c++)for(let d=e.startColumn;d<=e.endColumn;d++){const{isMergedMainCell:u,startRow:h,startColumn:g,endRow:S,endColumn:p}=s.getCellInfoInMergeData(c,d);if(u){if(r===a.Direction.DOWN){let f=h+i,v=S+i;for(;v<=t.endRow;)l.push({startRow:f,startColumn:g,endRow:v,endColumn:p}),f+=i,v+=i}else if(r===a.Direction.UP){let f=h-i,v=S-i;for(;f>=t.startRow;)l.push({startRow:f,startColumn:g,endRow:v,endColumn:p}),f-=i,v-=i}else if(r===a.Direction.RIGHT){let f=g+i,v=p+i;for(;v<=t.endColumn;)l.push({startRow:h,startColumn:f,endRow:S,endColumn:v}),f+=i,v+=i}else if(r===a.Direction.LEFT){let f=g-i,v=p-i;for(;f>=t.startColumn;)l.push({startRow:h,startColumn:f,endRow:S,endColumn:v}),f-=i,v-=i}}}return l}_presetAndCacheData(e,t){const{source:r,target:i}=e,s=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet();if(!s)throw new Error("No active sheet found");const l=s.getCellMatrix(),c=[];return i.rows.forEach(d=>{const u=[];i.cols.forEach(h=>{u.push(a.Tools.deepClone(l.getValue(d,h)))}),c.push(u)}),this._beforeApplyData=c,this._copyData=this._getCopyData(r,t),this._currentLocation=e,this._shouldDisableSeries(this._copyData)?(this._autoFillService.setDisableApplyType(ae.SERIES,!0),ae.COPY):(this._autoFillService.setDisableApplyType(ae.SERIES,!1),this._getPreferredApplyType(this._copyData))}_fillData(e,t,r){var H,k;const i=[],s=[];let l=!0;r===ae.NO_FORMAT&&(l=!1,r=ae.SERIES);const{source:c,target:d,unitId:u,subUnitId:h}=e;if(!c||!d||t==null)return{undos:i,redos:s};const g=gt(c),S=gt(d),{cols:p,rows:f}=d,{cols:v,rows:C}=c,_=this._copyData;let R;t===a.Direction.DOWN||t===a.Direction.UP?R=C.length:R=v.length;const w=[];if(t===a.Direction.DOWN||t===a.Direction.UP){const U=f.length,L=[];p.forEach((j,B)=>{const z=_[B],X=this._getApplyData(z,R,U,t,r,l,e);L.push(X)});for(let j=0;j<L[0].length;j++){const B=[];for(let z=0;z<L.length;z++)B.push({s:null,...L[z][j]});w.push(B)}}else{const U=p.length;f.forEach((L,j)=>{const B=_[j],z=this._getApplyData(B,R,U,t,r,l,e),X=[];for(let K=0;K<z.length;K++)X.push({s:null,...z[K]});w.push(X)})}let P=[];const y=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getStyles();if(l?(P=this._getMergeApplyData(g,S,t,R),w.forEach(U=>{U.forEach(L=>{L&&y&&y&&(L.s=y.getStyleByCell(L))})})):w.forEach((U,L)=>{U.forEach((j,B)=>{j&&y&&(j.s=y.getStyleByCell(this._beforeApplyData[L][B])||null)})}),r===ae.ONLY_FORMAT&&w.forEach((U,L)=>{U.forEach((j,B)=>{if(j){const z=this._beforeApplyData[L][B]||{};j.f=z.f,j.si=z.si,j.t=z.t,j.v=z.v}})}),l){const U=[],L=(k=(H=this._univerInstanceService.getUniverSheetInstance(u))==null?void 0:H.getSheetBySheetId(h))==null?void 0:k.getMergeData();L&&L.forEach(z=>{a.Rectangle.intersects(z,S)&&U.push(z)});const j={unitId:u,subUnitId:h,ranges:U},B=this._injector.invoke(m.RemoveMergeUndoMutationFactory,j);U.length&&(s.push({id:m.RemoveWorksheetMergeMutation.id,params:j}),i.unshift({id:m.AddWorksheetMergeMutation.id,params:B}))}const M={subUnitId:h,unitId:u,cellValue:Id([d])},x=this._injector.invoke(m.SetRangeValuesUndoMutationFactory,M);s.push({id:m.SetRangeValuesMutation.id,params:M}),i.unshift({id:m.SetRangeValuesMutation.id,params:x});const A=new a.ObjectMatrix;f.forEach((U,L)=>{p.forEach((j,B)=>{w[L][B]&&A.setValue(U,j,w[L][B])})});const D=A.getMatrix(),N={subUnitId:h,unitId:u,cellValue:D},V=this._injector.invoke(m.SetRangeValuesUndoMutationFactory,N);if(this._autoFillService.getActiveHooks().forEach(U=>{var L;(L=U.onBeforeSubmit)==null||L.call(U,e,t,r,D)}),i.unshift({id:m.SetRangeValuesMutation.id,params:V}),s.push({id:m.SetRangeValuesMutation.id,params:N}),P!=null&&P.length){const U=m.getAddMergeMutationRangeByType(P),L={unitId:u,subUnitId:h,ranges:U},j=this._injector.invoke(m.AddMergeUndoMutationFactory,L);i.unshift({id:m.RemoveWorksheetMergeMutation.id,params:j}),s.push({id:m.AddWorksheetMergeMutation.id,params:L})}return{undos:i,redos:s}}_shouldDisableSeries(e){return e.every(t=>Object.keys(t).every(r=>{var i;return((i=t[r])==null?void 0:i.length)===0||[Ie.OTHER,Ie.FORMULA].includes(r)}))}_getPreferredApplyType(e){return e.every(r=>Object.keys(r).every(i=>{var s,l;return((s=r[i])==null?void 0:s.length)===0||((l=r[i])==null?void 0:l.length)===1&&r[i][0].data.length===1&&Ie.NUMBER===i}))?ae.COPY:ae.SERIES}};exports.AutoFillController=uh([_t(0,a.IUniverInstanceService),_t(1,a.ICommandService),_t(2,pt),_t(3,he),_t(4,T.IRenderManagerService),_t(5,a.Inject(a.Injector)),_t(6,a.Inject(exports.SheetsRenderService))],exports.AutoFillController);var hh=Object.getOwnPropertyDescriptor,mh=(n,o,e,t)=>{for(var r=t>1?void 0:t?hh(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},jo=(n,o)=>(e,t)=>o(e,t,n);exports.CellCustomRenderController=class extends a.Disposable{constructor(e,t,r,i){super();E(this,"_enterActiveRender");this._context=e,this._sheetSkeletonManagerService=t,this._renderManagerService=r,this._permissionService=i,this._initEventBinding()}_initEventBinding(){const e=new a.DisposableCollection,t=this._context.unit,r=i=>{if(e.dispose(),!i)return;const s=this._context.unitId,{skeleton:l}=i,c=this._renderManagerService.getRenderById(s);if(c&&c.mainComponent){const d=c.mainComponent,u=S=>{const{offsetX:p,offsetY:f}=S,v=c.scene,C=t.getActiveSheet();if(!C)return;const _=v.getActiveViewportByCoord(T.Vector2.FromArray([p,f]));if(!_)return;const{scaleX:R,scaleY:w}=v.getAncestorScale(),P={x:_.viewportScrollX,y:_.viewportScrollY},y=l.getCellIndexByOffset(p,f,R,w,P),M=l.worksheet.getMergedCell(y.row,y.column),x={actualRow:M?M.startRow:y.row,actualCol:M?M.startColumn:y.column,row:y.row,col:y.column};if(!x||!l)return;const A=C.getCell(x.actualRow,x.actualCol);if(!A)return;const D=A.customRender;if(!(D!=null&&D.length))return;const N=x.actualRow,V=x.actualCol,H=D.sort(a.sortRules),k=C.getSheetId(),U={data:A,style:l.getStyles().getStyleByCell(A),primaryWithCoord:l.getCellWithCoordByIndex(x.actualRow,x.actualCol),unitId:s,subUnitId:k,row:N,col:V,workbook:t,worksheet:C},L={x:P.x+p/R,y:P.y+f/w},j=H.find(B=>{var z;return(z=B.isHit)==null?void 0:z.call(B,L,U)});if(j)return[j,U]},h=d.onPointerDown$.subscribeEvent(S=>{var f,v,C,_;const p=u(S);if(p){const[R,w]=p,{row:P,col:y,worksheet:M,unitId:x,subUnitId:A}=w;if(!((f=this._permissionService.composePermission([new m.WorkbookEditablePermission(x).id,new m.WorksheetEditPermission(x,A).id]))==null?void 0:f.every(V=>V.value)))return!1;const N=(C=(v=M.getCell(P,y))==null?void 0:v.selectionProtection)==null?void 0:C[0];if((N==null?void 0:N[m.UnitAction.Edit])===!1)return!1;(_=R.onPointerDown)==null||_.call(R,w,S)}}),g=a.fromEventSubject(d.onPointerMove$).pipe(O.throttleTime(30)).subscribe(S=>{var f,v,C,_,R,w;const p=u(S);if(p){const[P,y]=p;this._enterActiveRender?this._enterActiveRender.render!==P&&((v=(f=this._enterActiveRender.render).onPointerLeave)==null||v.call(f,this._enterActiveRender.cellContext,S),this._enterActiveRender={render:P,cellContext:y},(C=P.onPointerEnter)==null||C.call(P,y,S)):(this._enterActiveRender={render:P,cellContext:y},(_=P.onPointerEnter)==null||_.call(P,y,S))}else this._enterActiveRender&&((w=(R=this._enterActiveRender.render).onPointerLeave)==null||w.call(R,this._enterActiveRender.cellContext,S),this._enterActiveRender=null)});h&&e.add(h),g&&e.add(g)}};this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(r)),r(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(e)}};exports.CellCustomRenderController=mh([jo(1,a.Inject(exports.SheetSkeletonManagerService)),jo(2,T.IRenderManagerService),jo(3,a.IPermissionService)],exports.CellCustomRenderController);var gh=Object.getOwnPropertyDescriptor,Sh=(n,o,e,t)=>{for(var r=t>1?void 0:t?gh(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},$s=(n,o)=>(e,t)=>o(e,t,n);exports.DragManagerService=class extends a.Disposable{constructor(e,t){super();E(this,"_currentCell$",new O.Subject);E(this,"currentCell$",this._currentCell$.asObservable().pipe(O.distinctUntilChanged((e,t)=>{var r,i,s,l,c,d,u,h;return((r=e==null?void 0:e.location)==null?void 0:r.unitId)===((i=t==null?void 0:t.location)==null?void 0:i.unitId)&&((s=e==null?void 0:e.location)==null?void 0:s.subUnitId)===((l=t==null?void 0:t.location)==null?void 0:l.subUnitId)&&((c=e==null?void 0:e.location)==null?void 0:c.row)===((d=t==null?void 0:t.location)==null?void 0:d.row)&&((u=e==null?void 0:e.location)==null?void 0:u.col)===((h=t==null?void 0:t.location)==null?void 0:h.col)})));E(this,"_endCell$",new O.Subject);E(this,"endCell$",this._endCell$.asObservable());this._univerInstanceService=e,this._renderManagerService=t,this._initCellDisposableListener()}dispose(){super.dispose(),this._currentCell$.complete(),this._endCell$.complete()}_initCellDisposableListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{e||(this._currentCell$.next(null),this._endCell$.next(null))}))}_calcActiveCell(e,t){const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!r)return null;const i=r.getActiveSheet();if(!i)return;const s=this._renderManagerService.getRenderById(r.getUnitId());if(!s)return;const l=s.with(exports.SheetSkeletonManagerService).getCurrentParam(),d=s.with(exports.SheetScrollManagerService).getCurrentScrollState();if(!(!l||!d||!s))return nl(s,r,i,l,e,t)}onDragOver(e){const{offsetX:t,offsetY:r,dataTransfer:i}=e,s=this._calcActiveCell(t,r);if(!s){this._currentCell$.next(null);return}const{location:l,position:c}=s;this._currentCell$.next({location:l,position:c,dataTransfer:i})}onDrop(e){const{offsetX:t,offsetY:r,dataTransfer:i}=e,s=this._calcActiveCell(t,r);if(!s){this._endCell$.next(null);return}const{location:l,position:c}=s;this._endCell$.next({location:l,position:c,dataTransfer:i})}};exports.DragManagerService=Sh([$s(0,a.IUniverInstanceService),$s(1,T.IRenderManagerService)],exports.DragManagerService);var ph=Object.getOwnPropertyDescriptor,fh=(n,o,e,t)=>{for(var r=t>1?void 0:t?ph(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},zo=(n,o)=>(e,t)=>o(e,t,n);exports.DragRenderController=class extends a.Disposable{constructor(o,e,t,r){super(),this._context=o,this._renderManagerService=e,this._dragManagerService=t,this._sheetSkeletonManagerService=r,this._initDragEvent()}_initDragEvent(){const o=new a.DisposableCollection,e=t=>{if(o.dispose(),!t)return;const{scene:r}=this._context,i=r.onDragOver$.subscribeEvent(l=>{this._dragManagerService.onDragOver(l)}),s=r.onDrop$.subscribeEvent(l=>{this._dragManagerService.onDrop(l)});o.add({dispose(){i.unsubscribe(),s.unsubscribe()}})};e(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(t=>{e(t)}))}};exports.DragRenderController=fh([zo(1,T.IRenderManagerService),zo(2,a.Inject(exports.DragManagerService)),zo(3,a.Inject(exports.SheetSkeletonManagerService))],exports.DragRenderController);class ss{constructor(){E(this,"_state",null);E(this,"_rect",null);E(this,"_state$",new O.BehaviorSubject(null));E(this,"state$",this._state$.asObservable());E(this,"_rect$",new O.BehaviorSubject(null));E(this,"rect$",this._rect$.asObservable());E(this,"_focus",!1);E(this,"_focus$",new O.BehaviorSubject(this._focus));E(this,"focus$",this._focus$.asObservable())}dispose(){this._state$.complete(),this._state=null,this._rect$.complete(),this._rect=null}setState(o){this._state=o,this._refresh(o)}getRect(){return this._rect}setRect(o){this._rect=o,this._rect$.next(o)}getState(){return this._state}setFocus(o=!1){this._focus=o,this._focus$.next(o)}_refresh(o){this._state$.next(o)}}const Hn=a.createIdentifier("univer.sheet-cell-editor-manager.service"),Ee="sheets-ui.config",io={formulaBar:!0,statusBarStatistic:!0,protectedRangeShadow:!0,maxAutoHeightCount:1e3};function as(n){return n===!0?"always":n===!1?"none":n||"always"}function fe({ref:n,...o}){const{icon:e,id:t,className:r,extend:i,...s}=o,l=`univerjs-icon univerjs-icon-${t} ${r||""}`.trim(),c=W.useRef(`_${Ih()}`);return rl(e,`${t}`,{defIds:e.defIds,idSuffix:c.current},{ref:n,className:l,...s},i)}function rl(n,o,e,t,r){return W.createElement(n.tag,{key:o,...vh(n,e,r),...t},(Ch(n,e).children||[]).map((i,s)=>rl(i,`${o}-${n.tag}-${s}`,e,void 0,r)))}function vh(n,o,e){const t={...n.attrs};e!=null&&e.colorChannel1&&t.fill==="colorChannel1"&&(t.fill=e.colorChannel1),n.tag==="mask"&&t.id&&(t.id=t.id+o.idSuffix),Object.entries(t).forEach(([i,s])=>{i==="mask"&&typeof s=="string"&&(t[i]=s.replace(/url\(#(.*)\)/,`url(#$1${o.idSuffix})`))});const{defIds:r}=o;return!r||r.length===0||(n.tag==="use"&&t["xlink:href"]&&(t["xlink:href"]=t["xlink:href"]+o.idSuffix),Object.entries(t).forEach(([i,s])=>{typeof s=="string"&&(t[i]=s.replace(/url\(#(.*)\)/,`url(#$1${o.idSuffix})`))})),t}function Ch(n,o){var t;const{defIds:e}=o;return!e||e.length===0?n:n.tag==="defs"&&((t=n.children)!=null&&t.length)?{...n,children:n.children.map(r=>typeof r.attrs.id=="string"&&e&&e.includes(r.attrs.id)?{...r,attrs:{...r.attrs,id:r.attrs.id+o.idSuffix}}:r)}:n}function Ih(){return Math.random().toString(36).substring(2,8)}fe.displayName="UniverIcon";const _h={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Yt=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"check-mark-icon",ref:e,icon:_h}))});Yt.displayName="CheckMarkIcon";const bh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z"}}]},ol=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"close-icon",ref:e,icon:bh}))});ol.displayName="CloseIcon";const Rh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"g",attrs:{fill:"currentColor",clipPath:"url(#convert-icon_clip0_911_593)"},children:[{tag:"path",attrs:{d:"M2.44766 0.848145C1.564 0.848145 0.847656 1.56449 0.847656 2.44814V6.44814C0.847656 7.3318 1.564 8.04814 2.44766 8.04814H6.44766C7.33131 8.04814 8.04766 7.3318 8.04766 6.44814V2.44814C8.04766 1.56449 7.33131 0.848145 6.44766 0.848145H2.44766ZM2.04766 6.44814V5.04824H3.84775V6.84814H2.44766C2.22674 6.84814 2.04766 6.66906 2.04766 6.44814ZM2.04766 3.84824H3.84775V2.04814H2.44766C2.22674 2.04814 2.04766 2.22723 2.04766 2.44814V3.84824ZM5.04775 6.84814V5.04824H6.84766V6.44814C6.84766 6.66906 6.66857 6.84814 6.44766 6.84814H5.04775ZM5.04775 3.84824H6.84766V2.44814C6.84766 2.22723 6.66857 2.04814 6.44766 2.04814H5.04775V3.84824Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{d:"M9.55215 7.95166C8.66849 7.95166 7.95215 8.668 7.95215 9.55166V13.5517C7.95215 14.4353 8.66849 15.1517 9.55215 15.1517L11.5522 15.1517L13.5521 15.1517C14.4358 15.1517 15.1521 14.4353 15.1521 13.5517L15.1521 11.5518L15.1521 9.55166C15.1521 8.668 14.4358 7.95166 13.5521 7.95166H9.55215ZM13.9521 10.9518V9.55166C13.9521 9.33075 13.7731 9.15166 13.5521 9.15166H12.1522V10.9518H13.9521ZM10.9522 10.9518V9.15166H9.55215C9.33123 9.15166 9.15215 9.33075 9.15215 9.55166V10.9518H10.9522ZM9.15215 12.1518H10.9522V13.9517H9.55215C9.33123 13.9517 9.15215 13.7726 9.15215 13.5517V12.1518ZM12.1522 12.1518H13.9521V13.5517C13.9521 13.7726 13.7731 13.9517 13.5521 13.9517H12.1522V12.1518Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{d:"M9.62158 2.44912C9.62158 2.11775 9.89021 1.84912 10.2216 1.84912H12.7516C13.6352 1.84912 14.3516 2.56547 14.3516 3.44912V5.9791C14.3516 6.31047 14.0829 6.5791 13.7516 6.5791C13.4202 6.5791 13.1516 6.31047 13.1516 5.9791V3.44912C13.1516 3.22821 12.9725 3.04912 12.7516 3.04912H10.2216C9.89021 3.04912 9.62158 2.78049 9.62158 2.44912Z"}},{tag:"path",attrs:{d:"M5.77871 14.1507C6.11008 14.1507 6.37871 13.8821 6.37871 13.5507C6.37871 13.2193 6.11008 12.9507 5.77871 12.9507L3.24873 12.9507C3.02782 12.9507 2.84873 12.7716 2.84873 12.5507L2.84873 10.0207C2.84873 9.68933 2.5801 9.4207 2.24873 9.4207C1.91736 9.4207 1.64873 9.68933 1.64873 10.0207L1.64873 12.5507C1.64873 13.4343 2.36507 14.1507 3.24873 14.1507H5.77871Z"}}]},{tag:"defs",attrs:{},children:[{tag:"clipPath",attrs:{id:"convert-icon_clip0_911_593"},children:[{tag:"path",attrs:{fill:"white",d:"M0 0H16V16H0z"}}]}]}],defIds:["convert-icon_clip0_911_593"]},il=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"convert-icon",ref:e,icon:Rh}))});il.displayName="ConvertIcon";const wh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Vo=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"delete-icon",ref:e,icon:wh}))});Vo.displayName="DeleteIcon";const Eh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"}}]},sl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"dropdown-icon",ref:e,icon:Eh}))});sl.displayName="DropdownIcon";const Th={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM10.3097 5.69014C10.544 5.92445 10.544 6.30435 10.3097 6.53867L8.84843 7.9999L10.3099 9.46137C10.5442 9.69569 10.5442 10.0756 10.3099 10.3099C10.0756 10.5442 9.69569 10.5442 9.46137 10.3099L7.9999 8.84843L6.53842 10.3099C6.30411 10.5442 5.92421 10.5442 5.6899 10.3099C5.45558 10.0756 5.45558 9.69569 5.6899 9.46137L7.15137 7.9999L5.69014 6.53867C5.45583 6.30435 5.45583 5.92445 5.69014 5.69014C5.92445 5.45583 6.30435 5.45583 6.53867 5.69014L7.9999 7.15137L9.46113 5.69014C9.69544 5.45583 10.0753 5.45583 10.3097 5.69014Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ls=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"error-icon",ref:e,icon:Th}))});ls.displayName="ErrorIcon";const yh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M1.28096 4.6541C1.57489 4.50109 1.93721 4.61533 2.09022 4.90926C2.27315 5.26067 2.55999 5.60455 2.94829 5.92278C4.04628 6.82266 5.87505 7.44865 7.99828 7.44865C10.1215 7.44865 11.9503 6.82267 13.0482 5.92279C13.4366 5.60455 13.7234 5.26067 13.9063 4.90927C14.0594 4.61533 14.4217 4.50109 14.7156 4.65409C15.0095 4.8071 15.1238 5.16941 14.9708 5.46334C14.6995 5.98445 14.2981 6.44997 13.8089 6.8509C13.7298 6.91575 13.6481 6.97914 13.564 7.041L15.2245 8.70153C15.4588 8.93585 15.4588 9.31575 15.2245 9.55006C14.9902 9.78438 14.6103 9.78438 14.376 9.55006L12.5041 7.67822C11.8977 7.97568 11.2181 8.21208 10.4884 8.37706L11.0996 10.6581C11.1853 10.9782 10.9954 11.3072 10.6753 11.393C10.3552 11.4787 10.0262 11.2888 9.94045 10.9687L9.29949 8.57652C8.8758 8.62404 8.44081 8.64865 7.99828 8.64865C7.55276 8.64865 7.11487 8.62371 6.68846 8.57555L6.04723 10.9687C5.96147 11.2888 5.63247 11.4788 5.31239 11.393C4.99231 11.3073 4.80236 10.9783 4.88812 10.6582L5.49983 8.37516C4.7743 8.2105 4.09843 7.9752 3.49498 7.67947L1.62436 9.55009C1.39005 9.78441 1.01015 9.78441 0.775835 9.5501C0.54152 9.31578 0.541518 8.93588 0.775832 8.70157L2.43478 7.04261C2.34987 6.98024 2.26746 6.91632 2.18764 6.8509C1.69842 6.44997 1.29706 5.98445 1.0258 5.46335C0.872791 5.16942 0.987031 4.80711 1.28096 4.6541Z"}}]},al=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"eyelash-icon",ref:e,icon:yh}))});al.displayName="EyelashIcon";const Mh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 17",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M6.06409 5.53454C5.93592 5.53454 5.84083 5.41567 5.86897 5.29063L5.95442 4.9109C6.05444 4.48178 6.23806 4.11547 6.51182 3.81952C6.81082 3.49628 7.25398 3.35405 7.79738 3.35405C7.99847 3.35405 8.21359 3.37775 8.44188 3.42245C8.46089 3.42617 8.47974 3.43006 8.49846 3.4341C8.7099 3.4798 8.93698 3.38478 9.02031 3.18514L9.24767 2.6404C9.33457 2.43219 9.23178 2.19404 9.01582 2.12874C8.98358 2.11899 8.95028 2.10912 8.91591 2.09914C8.62745 2.01631 8.28392 1.97217 7.88074 1.97217C6.82015 1.97217 6.02714 2.23936 5.4746 2.7444C4.90987 3.26069 4.50889 3.99917 4.28413 4.9762L2.83703 11.1909C2.76126 11.5286 2.666 11.8917 2.54844 12.2812C2.42975 12.6734 2.2873 13.0595 2.12221 13.4373C1.95577 13.8159 1.76813 14.1762 1.55955 14.5171C1.49345 14.6251 1.42515 14.7282 1.35467 14.8263C1.26508 14.9509 1.3347 15.133 1.48655 15.1554C2.13635 15.2509 2.8179 15.0763 3.18197 14.5296C3.32661 14.3124 3.46779 14.0646 3.60509 13.7851C3.96635 13.0497 4.30522 12.0103 4.61867 10.6574L5.469 7.01534C5.49013 6.92483 5.57082 6.86081 5.66376 6.86081H7.62478C7.8097 6.86081 7.97051 6.73405 8.01371 6.55425L8.14014 6.02798C8.20057 5.77642 8.00992 5.53454 7.75121 5.53454H6.06409Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.3211 5.72037L12.5124 7.96963L11.4089 5.77754C11.3422 5.63012 11.1954 5.5354 11.0336 5.5354H10.3129C10.0085 5.5354 9.80921 5.85428 9.9427 6.1279L11.4089 9.05502L8.79783 12.1493C8.56587 12.4158 8.75519 12.8315 9.10855 12.8315H9.68607C9.80672 12.8315 9.9605 12.7822 10.0388 12.6904L12.1108 10.2648L13.1176 12.561C13.1786 12.7231 13.333 12.8315 13.5061 12.8315H14.3C14.5831 12.8315 14.7417 12.6175 14.6426 12.3524L13.1728 9.28628C13.1728 9.28628 15.4009 6.45542 15.6013 6.17892C15.7966 5.90929 15.6023 5.5354 15.2693 5.5354H14.6661C14.5275 5.5354 14.4333 5.58887 14.3211 5.72037Z"}}]},ll=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"fx-icon",ref:e,icon:Mh}))});ll.displayName="FxIcon";const Ph={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"}}]},cs=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"increase-icon",ref:e,icon:Ph}))});cs.displayName="IncreaseIcon";const xh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.00016 1.33203C6.68162 1.33203 5.39269 1.72302 4.29636 2.45557C3.20004 3.18811 2.34555 4.2293 1.84097 5.44747C1.33638 6.66565 1.20436 8.00609 1.4616 9.2993C1.71883 10.5925 2.35377 11.7804 3.28612 12.7127C4.21847 13.6451 5.40636 14.28 6.69956 14.5373C7.99277 14.7945 9.33321 14.6625 10.5514 14.1579C11.7696 13.6533 12.8108 12.7988 13.5433 11.7025C14.2758 10.6062 14.6668 9.31724 14.6668 7.9987C14.6649 6.23118 13.9619 4.53662 12.7121 3.2868C11.4622 2.03697 9.76768 1.33397 8.00016 1.33203ZM7.66683 3.9987C7.86461 3.9987 8.05795 4.05735 8.2224 4.16723C8.38685 4.27711 8.51502 4.43329 8.59071 4.61601C8.6664 4.79874 8.6862 4.99981 8.64762 5.19379C8.60903 5.38777 8.51379 5.56595 8.37394 5.7058C8.23409 5.84566 8.0559 5.9409 7.86192 5.97948C7.66794 6.01807 7.46687 5.99826 7.28415 5.92258C7.10142 5.84689 6.94524 5.71872 6.83536 5.55427C6.72548 5.38982 6.66683 5.19648 6.66683 4.9987C6.66683 4.73348 6.77219 4.47913 6.95972 4.29159C7.14726 4.10405 7.40162 3.9987 7.66683 3.9987ZM9.3335 11.332H6.66683C6.49002 11.332 6.32045 11.2618 6.19543 11.1368C6.0704 11.0117 6.00016 10.8422 6.00016 10.6654C6.00016 10.4886 6.0704 10.319 6.19543 10.194C6.32045 10.0689 6.49002 9.9987 6.66683 9.9987H7.3335V7.9987H6.66683C6.49002 7.9987 6.32045 7.92846 6.19543 7.80343C6.0704 7.67841 6.00016 7.50884 6.00016 7.33203C6.00016 7.15522 6.0704 6.98565 6.19543 6.86063C6.32045 6.7356 6.49002 6.66536 6.66683 6.66536H8.00016C8.17698 6.66536 8.34655 6.7356 8.47157 6.86063C8.59659 6.98565 8.66683 7.15522 8.66683 7.33203V9.9987H9.3335C9.51031 9.9987 9.67988 10.0689 9.8049 10.194C9.92993 10.319 10.0002 10.4886 10.0002 10.6654C10.0002 10.8422 9.92993 11.0117 9.8049 11.1368C9.67988 11.2618 9.51031 11.332 9.3335 11.332Z"}}]},cl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"info-icon",ref:e,icon:xh}))});cl.displayName="InfoIcon";const Oh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M2.62402 7.72905C2.58427 7.72905 2.55205 7.76127 2.55205 7.80102V13.6782C2.55205 13.7179 2.58427 13.7502 2.62402 13.7502H13.3755C13.4152 13.7502 13.4474 13.7179 13.4474 13.6782V7.80102C13.4474 7.76127 13.4152 7.72905 13.3755 7.72905H2.62402ZM1.35205 7.80102C1.35205 7.09853 1.92153 6.52905 2.62402 6.52905H13.3755C14.0779 6.52905 14.6474 7.09853 14.6474 7.80102V13.6782C14.6474 14.3807 14.0779 14.9502 13.3755 14.9502H2.62402C1.92153 14.9502 1.35205 14.3807 1.35205 13.6782V7.80102Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8 2.25005C6.69847 2.25003 5.64336 3.30513 5.64336 4.60666V7.12895C5.64336 7.46032 5.37473 7.72895 5.04336 7.72895C4.71199 7.72895 4.44336 7.46032 4.44336 7.12895V4.60666C4.44336 2.64239 6.04451 1.05565 8.00879 1.05566M8 2.25005L8.00879 1.05566L8 2.25005ZM8.00879 1.05566L8 2.25005C9.30154 2.25003 10.3567 3.30513 10.3567 4.60666V7.12895C10.3567 7.46032 10.6253 7.72895 10.9567 7.72895C11.288 7.72895 11.5567 7.46032 11.5567 7.12895V4.60666C11.5567 2.64239 9.97306 1.05565 8.00879 1.05566Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M8.00039 9.4668C8.33176 9.4668 8.60039 9.73543 8.60039 10.0668V12.0827C8.60039 12.4141 8.33176 12.6827 8.00039 12.6827C7.66902 12.6827 7.40039 12.4141 7.40039 12.0827V10.0668C7.40039 9.73543 7.66902 9.4668 8.00039 9.4668Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ds=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"lock-icon",ref:e,icon:Oh}))});ds.displayName="LockIcon";const Ah={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",fillRule:"evenodd",clipRule:"evenodd"}}]},_n=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"more-down-icon",ref:e,icon:Ah}))});_n.displayName="MoreDownIcon";const Dh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Oi=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"more-icon",ref:e,icon:Dh}))});Oi.displayName="MoreIcon";const Nh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.666 2.70571C11.7769 1.76476 10.3295 1.76476 9.4404 2.70571L3.37843 9.12427C3.31779 9.18848 3.27756 9.26409 3.24979 9.3439C3.24809 9.3493 3.24299 9.3529 3.24129 9.3583L2.02912 13.2097C1.96112 13.4251 2.01439 13.6633 2.16626 13.8236C2.27393 13.9382 2.41901 14 2.56692 14C2.62699 14 2.68762 13.9898 2.74599 13.9688L6.3825 12.6846C6.3876 12.6828 6.391 12.678 6.39553 12.6762C6.47147 12.6474 6.54287 12.6042 6.60351 12.54L12.666 6.12202C13.5558 5.18048 13.5558 3.64725 12.666 2.70571ZM8.62832 5.26209L9.04031 5.69836C9.03918 5.69956 9.03748 5.70016 9.03634 5.70136L4.99182 9.9836L4.58096 9.54853L8.62832 5.26209ZM3.46287 12.4512L4.02673 10.6593L5.15446 11.8535L3.46287 12.4512ZM6.20342 11.2672L5.79256 10.8321L9.83709 6.54988C9.83822 6.54868 9.83879 6.54688 9.83992 6.54568L10.2513 6.98135L6.20342 11.2672ZM11.8647 5.27349L11.0532 6.13282L9.42963 4.41356L10.2411 3.55423C10.6888 3.08016 11.417 3.08076 11.8642 3.55423C12.3124 4.0283 12.3124 4.79942 11.8647 5.27349Z"}}]},dl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"pen-icon",ref:e,icon:Nh}))});dl.displayName="PenIcon";const kh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M5.785 6.77762C5.78908 6.7777 5.79316 6.77774 5.79725 6.77774C5.80134 6.77774 5.80543 6.7777 5.8095 6.77762H10.0184C10.0225 6.7777 10.0266 6.77774 10.0307 6.77774C10.0347 6.77774 10.0388 6.7777 10.0429 6.77762H13.6638V7.63727C13.6638 7.96864 13.9324 8.23727 14.2638 8.23727C14.5951 8.23727 14.8638 7.96864 14.8638 7.63727V3.9999C14.8638 2.56395 13.6997 1.39989 12.2637 1.3999L3.56389 1.39999C2.12797 1.40001 0.96393 2.56405 0.96392 3.99998L0.963867 11.6666C0.963857 13.1025 2.12792 14.2666 3.56387 14.2666H8.0542C8.38557 14.2666 8.6542 13.9979 8.6542 13.6666C8.6542 13.3352 8.38557 13.0666 8.0542 13.0666H3.56387C2.79067 13.0666 2.16386 12.4398 2.16387 11.6666L2.1639 6.77762H5.785ZM6.39725 2.59996L9.43065 2.59993V5.57762H6.39725V2.59996ZM5.19725 5.57762V2.59998L3.56391 2.59999C2.79072 2.6 2.16393 3.22679 2.16392 3.99998L2.16391 5.57762H5.19725ZM13.6638 5.57762V3.9999C13.6638 3.2267 13.037 2.59989 12.2638 2.5999L10.6307 2.59992V5.57762H13.6638Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.1223 10.2333V10.7496C14.7087 10.9869 15.1223 11.5618 15.1223 12.2333V12.8999C15.1223 13.7836 14.406 14.4999 13.5223 14.4999H11.5223C10.6387 14.4999 9.92235 13.7836 9.92235 12.8999V12.2333C9.92235 11.5618 10.336 10.9869 10.9223 10.7496V10.2333C10.9223 9.34961 11.6387 8.63328 12.5223 8.63328C13.406 8.63328 14.1223 9.34961 14.1223 10.2333ZM11.1223 12.2333C11.1223 12.0124 11.3014 11.8333 11.5223 11.8333H13.5223C13.7433 11.8333 13.9223 12.0124 13.9223 12.2333V12.8999C13.9223 13.1209 13.7433 13.2999 13.5223 13.2999H11.5223C11.3014 13.2999 11.1223 13.1209 11.1223 12.8999V12.2333ZM12.9223 10.2333V10.6333H12.1223V10.2333C12.1223 10.0124 12.3014 9.83328 12.5223 9.83328C12.7433 9.83328 12.9223 10.0124 12.9223 10.2333Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ul=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"protect-icon",ref:e,icon:kh}))});ul.displayName="ProtectIcon";const Hh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM8.00008 12.3671C8.46031 12.3671 8.83342 11.994 8.83342 11.5338C8.83342 11.0735 8.46031 10.7004 8.00008 10.7004C7.53985 10.7004 7.16675 11.0735 7.16675 11.5338C7.16675 11.994 7.53985 12.3671 8.00008 12.3671ZM8.5999 4.4335C8.5999 4.10213 8.33127 3.8335 7.9999 3.8335C7.66853 3.8335 7.3999 4.10213 7.3999 4.4335V9.36683C7.3999 9.6982 7.66853 9.96683 7.9999 9.96683C8.33127 9.96683 8.5999 9.6982 8.5999 9.36683V4.4335Z",fillRule:"evenodd",clipRule:"evenodd"}}]},hl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"warning-icon",ref:e,icon:Hh}))});hl.displayName="WarningIcon";const Vh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M12.6551 1.98906C11.7476 1.08113 10.2757 1.08149 9.3686 1.98987L4.82542 6.53955C4.75087 6.61421 4.69336 6.70411 4.65682 6.80309L3.2461 10.625C3.16506 10.8446 3.21909 11.0912 3.3845 11.2568C3.54991 11.4224 3.79651 11.4767 4.01616 11.3959L7.85031 9.98517C7.94979 9.94856 8.04014 9.89077 8.11508 9.81579L12.6552 5.27327C13.5618 4.36621 13.5618 2.89607 12.6551 1.98906ZM10.2177 2.83779C10.6562 2.39869 11.3677 2.39851 11.8064 2.8374C12.2447 3.27584 12.2447 3.9865 11.8065 4.42497L7.3392 8.89457L4.82213 9.82068L5.74706 7.31487L10.2177 2.83779Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.79238 13.2999C1.46101 13.2999 1.19238 13.5685 1.19238 13.8999C1.19238 14.2313 1.46101 14.4999 1.79238 14.4999H14.4924C14.8238 14.4999 15.0924 14.2313 15.0924 13.8999C15.0924 13.5685 14.8238 13.2999 14.4924 13.2999H1.79238Z"}}]},us=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"write-icon",ref:e,icon:Vh}))});us.displayName="WriteIcon";const Wh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",fillRule:"evenodd",clipRule:"evenodd"}}]},ml=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"autofill-double-icon",ref:e,icon:Wh}))});ml.displayName="AutofillDoubleIcon";const Uh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M6.4833 1.65005C6.4833 1.31868 6.21467 1.05005 5.8833 1.05005C5.55193 1.05005 5.2833 1.31868 5.2833 1.65005V5.28345H1.65029C1.31892 5.28345 1.05029 5.55208 1.05029 5.88345C1.05029 6.21482 1.31892 6.48345 1.65029 6.48345H5.2833V9.51684H1.65029C1.31892 9.51684 1.05029 9.78547 1.05029 10.1168C1.05029 10.4482 1.31892 10.7168 1.65029 10.7168H5.2833V14.35C5.2833 14.6814 5.55193 14.95 5.8833 14.95C6.21467 14.95 6.4833 14.6814 6.4833 14.35V10.7168H9.5167V14.35C9.5167 14.6814 9.78533 14.95 10.1167 14.95C10.4481 14.95 10.7167 14.6814 10.7167 14.35V10.7168H14.3503C14.6817 10.7168 14.9503 10.4482 14.9503 10.1168C14.9503 9.78547 14.6817 9.51685 14.3503 9.51685H10.7167V6.48345H14.3503C14.6817 6.48345 14.9503 6.21482 14.9503 5.88345C14.9503 5.55208 14.6817 5.28345 14.3503 5.28345H10.7167V1.65005C10.7167 1.31868 10.4481 1.05005 10.1167 1.05005C9.78533 1.05005 9.5167 1.31868 9.5167 1.65005V5.28345L6.4833 5.28345V1.65005ZM6.4833 6.48345V9.51684L9.5167 9.51685V6.48345L6.4833 6.48345Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M1.0498 3.65005C1.0498 2.21411 2.21386 1.05005 3.6498 1.05005H12.3498C13.7857 1.05005 14.9498 2.21411 14.9498 3.65005V12.3501C14.9498 13.786 13.7857 14.95 12.3498 14.95H3.6498C2.21386 14.95 1.0498 13.786 1.0498 12.35V3.65005ZM3.6498 2.25005C2.87661 2.25005 2.2498 2.87685 2.2498 3.65005V12.35C2.2498 13.1232 2.87661 13.75 3.6498 13.75H12.3498C13.123 13.75 13.7498 13.1232 13.7498 12.3501V3.65005C13.7498 2.87685 13.123 2.25005 12.3498 2.25005H3.6498Z",fillRule:"evenodd",clipRule:"evenodd"}}]},hs=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"hide-gridlines-double-icon",ref:e,icon:Uh}))});hs.displayName="HideGridlinesDoubleIcon";const Lh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"currentColor",d:"M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",fillRule:"evenodd",clipRule:"evenodd"}},{tag:"path",attrs:{fill:"currentColor",d:"M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"}}]},gl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"paint-bucket-double-icon",ref:e,icon:Lh}))});gl.displayName="PaintBucketDoubleIcon";const Bh={tag:"svg",attrs:{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",width:"1em",height:"1em"},children:[{tag:"path",attrs:{fill:"colorChannel1",d:"M7.74692 9.12463C7.74692 9.46018 8.01893 9.73219 8.35448 9.73219H11.4933C11.8288 9.73219 12.1009 9.46018 12.1009 9.12463C12.1009 8.78909 11.8288 8.51707 11.4933 8.51707H8.35448C8.01893 8.51707 7.74692 8.78909 7.74692 9.12463Z"}},{tag:"path",attrs:{fill:"colorChannel1",d:"M10.8636 10.8523C10.8636 11.1879 10.5915 11.4599 10.256 11.4599H8.35448C8.01893 11.4599 7.74692 11.1879 7.74692 10.8523C7.74692 10.5168 8.01893 10.2447 8.35448 10.2447H10.256C10.5915 10.2447 10.8636 10.5168 10.8636 10.8523Z"}},{tag:"path",attrs:{fill:"currentColor",d:"M5.4791 1.98268C5.47913 1.71529 5.87912 1.49854 6.37252 1.49854C6.86593 1.49854 7.26592 1.71529 7.26595 1.98268H7.62187C8.22277 1.98268 8.72459 2.39534 8.84412 2.9452H9.39563C10.0856 2.9452 10.6449 3.48923 10.6449 4.16032V6.00569H12.1261C13.161 6.00569 14 6.82174 14 7.82838V11.334C14 11.8174 13.8025 12.281 13.4511 12.6228L12.0693 13.9647C11.7179 14.3065 11.2412 14.4985 10.7442 14.4985H7.91116C7.05024 14.4985 6.32492 14.0431 6.10535 13.2737H3.34925C2.6593 13.2737 2.09998 12.7297 2.09998 12.0586V4.16032C2.09998 3.48923 2.6593 2.9452 3.34925 2.9452H3.90107C4.0206 2.39534 4.52241 1.98268 5.12332 1.98268H5.4791ZM3.97249 4.16032H3.24925L3.24925 12.0586H6.03725V7.82838C6.03725 6.82174 6.87623 6.00569 7.91116 6.00569H9.49563V4.16032H8.7727C8.58289 4.59611 8.13909 4.90183 7.62187 4.90183H5.12332C4.6061 4.90183 4.1623 4.59611 3.97249 4.16032ZM5.12332 2.89403H7.62187C7.79436 2.89403 7.93419 3.03003 7.93419 3.19781V3.68671C7.93419 3.85448 7.79436 3.99049 7.62187 3.99049H5.12332C4.95083 3.99049 4.811 3.85448 4.811 3.68671V3.19781C4.811 3.03003 4.95083 2.89403 5.12332 2.89403ZM7.91116 7.11157C7.56618 7.11157 7.28652 7.38359 7.28652 7.71913V12.7851C7.28652 13.1206 7.56618 13.3927 7.91116 13.3927H10.7442C10.8401 13.3927 10.9337 13.3712 11.0182 13.3311C11.1373 13.2746 11.1859 13.1423 11.1859 13.0134V12.0066C11.1859 11.8724 11.2978 11.7636 11.4358 11.7636H12.4709C12.6034 11.7636 12.7394 11.7163 12.7975 11.6004C12.8388 11.5182 12.8608 11.4272 12.8608 11.334V7.71913C12.8608 7.38359 12.5811 7.11157 12.2362 7.11157H7.91116Z",fillRule:"evenodd",clipRule:"evenodd"}}]},Sl=W.forwardRef(function(o,e){return W.createElement(fe,Object.assign({},o,{id:"paste-special-double-icon",ref:e,icon:Bh}))});Sl.displayName="PasteSpecialDoubleIcon";const Fh=()=>{const[,n]=W.useState({});return W.useCallback(()=>n(o=>!o),[])};function jh(){const n=I.useDependency(a.ICommandService),o=I.useDependency(a.IUniverInstanceService),e=I.useDependency(T.IRenderManagerService),t=I.useDependency(pt),r=I.useDependency(a.LocaleService),[i,s]=W.useState([]),[l,c]=W.useState(!1),[d,u]=W.useState({row:-1,col:-1}),[h,g]=W.useState(ae.SERIES),[S,p]=W.useState(!1),f=vt(),{sheetSkeletonManagerService:v,selectionRenderService:C}=W.useMemo(()=>{if(f){const X=e.getRenderById(f.getUnitId());return{sheetSkeletonManagerService:X==null?void 0:X.with(exports.SheetSkeletonManagerService),selectionRenderService:X==null?void 0:X.with(Ce)}}return{sheetSkeletonManagerService:null,selectionRenderService:null}},[f,e]),_=()=>{p(!0)},R=()=>{p(!1)},w=Fh();if(W.useEffect(()=>n.onCommandExecuted((K,ie)=>{K.id===We.id&&w()}).dispose,[w,n]),W.useEffect(()=>{const X=v&&a.toDisposable(v.currentSkeleton$.subscribe(K=>{K&&w()}));return X==null?void 0:X.dispose},[v,w]),W.useEffect(()=>a.toDisposable(t.menu$.subscribe(K=>{s(K.map(ie=>({...ie,index:K.indexOf(ie)})))})).dispose,[t]),W.useEffect(()=>a.toDisposable(t.showMenu$.subscribe(K=>{const{source:ie,target:re}=t.autoFillLocation||{source:null,target:null};if(K&&ie&&re){const le=Math.max(ie.rows[ie.rows.length-1],re.rows[re.rows.length-1]),Z=Math.max(ie.cols[ie.cols.length-1],re.cols[re.cols.length-1]);u({row:le,col:Z})}else u({row:-1,col:-1})})).dispose,[t]),W.useEffect(()=>a.toDisposable(t.applyType$.subscribe(K=>{g(K)})).dispose,[t]),W.useEffect(()=>{function X(){c(!1)}return document.addEventListener("wheel",X),()=>{document.removeEventListener("wheel",X)}},[l]),d.col<0||d.row<0)return null;const P=Ne(o,e);if(!P||!C)return null;const{scene:y}=P,M=v==null?void 0:v.getCurrentSkeleton(),x=C.getViewPort(),A=y==null?void 0:y.scaleX,D=y==null?void 0:y.scaleY,N=y==null?void 0:y.getViewportScrollXY(x);if(!A||!y||!A||!D||!N)return null;const V=(M==null?void 0:M.getNoMergeCellWithCoordByIndex(d.row,d.col).endX)||0,H=(M==null?void 0:M.getNoMergeCellWithCoordByIndex(d.row,d.col).endY)||0,k=T.convertTransformToOffsetX(V,A,N),U=T.convertTransformToOffsetY(H,D,N);if(k==null||U==null)return null;const L=X=>{c(X)},j=X=>{n.executeCommand(_r.id,{type:X.value}),c(!1)},B=l||S,z=i.filter(X=>!X.disable);return b.jsx("div",{className:"univer-absolute univer-inset-0 univer-z-10 univer-size-0",children:b.jsx("div",{className:"univer-absolute",style:{left:`${k+2}px`,top:`${U+2}px`},onMouseEnter:_,onMouseLeave:R,children:b.jsx(F.DropdownMenu,{align:"start",items:z.map(X=>({type:"radio",value:h,options:[{label:r.t(X.label),value:X.value}],onSelect:()=>j(X)})),open:l,onOpenChange:L,children:b.jsxs("div",{className:F.clsx("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",F.borderClassName,{"univer-bg-gray-100 dark:!univer-bg-gray-800":l,"univer-bg-white dark:!univer-bg-gray-900":!l}),children:[b.jsx(ml,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),B&&b.jsx(_n,{className:"dark:!univer-text-white"})]})})})})}function ms(n,o){const e=I.useDependency(he),t=I.useDependency(a.ICommandService);return W.useMemo(()=>({keyCodes:[{keyCode:I.KeyCode.ENTER},{keyCode:I.KeyCode.ESC},{keyCode:I.KeyCode.TAB}],handler:i=>{(i===I.KeyCode.ENTER||i===I.KeyCode.ESC||i===I.KeyCode.TAB)&&(e.disableForceKeepVisible(),t.syncExecuteCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:i,unitId:o}))}}),[t,e,o])}const so=-1e3,ea={width:0,height:0,top:so,left:so},zh=()=>{const[n,o]=W.useState({...ea}),e=I.useDependency(Hn),t=I.useDependency(J.IEditorService),r=I.useDependency(a.IContextService),i=I.useDependency(I.ComponentManager),s=I.useDependency(he),l=I.useObservable(s.visible$),c=I.useDependency(a.ICommandService),d=W.useRef(0),u=I.useObservable(()=>r.subscribeContextValue$(I.DISABLE_AUTO_FOCUS_KEY),!1,void 0,[r,I.DISABLE_AUTO_FOCUS_KEY]),h=i.get(yo),g=s.getEditLocation();W.useEffect(()=>{const v=e.state$.subscribe(C=>{if(C==null)return;const{startX:_=so,startY:R=so,endX:w=0,endY:P=0,show:y=!1}=C;if(!y)o({...ea});else{o({width:w-_,height:P-R,left:_,top:R});const M=t.getEditor(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY);if(M==null)return;const{left:x,top:A,width:D,height:N}=M.getBoundingClientRect();e.setRect({left:x,top:A,width:D,height:N})}});return()=>{v.unsubscribe()}},[]),W.useEffect(()=>{u||e.setFocus(!0)},[u,n]);const S=I.useEvent(()=>{s.isVisible().visible&&c.executeCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.PointerUp,unitId:g==null?void 0:g.unitId})});I.useSidebarClick(S);const p=ms(d,g==null?void 0:g.unitId),f=I.useEvent((v,C)=>{c.executeCommand(Wt.id,{keycode:v,visible:!1,eventType:T.DeviceInputEventType.Keyboard,isShift:C===I.MetaKeys.SHIFT||C===(I.MetaKeys.CTRL_COMMAND|I.MetaKeys.SHIFT),unitId:g==null?void 0:g.unitId})});return b.jsx("div",{className:"univer-absolute univer-z-10 univer-flex",style:{left:n.left,top:n.top,width:n.width,height:n.height},children:h&&b.jsx(h,{editorId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,className:"univer-relative univer-flex univer-h-full univer-w-full [&_canvas]:univer-absolute",initValue:"",onChange:()=>{},isFocus:l==null?void 0:l.visible,unitId:g==null?void 0:g.unitId,subUnitId:g==null?void 0:g.sheetId,keyboardEventConfig:p,onMoveInEditor:f,isSupportAcrossSheet:!0,resetSelectionOnBlur:!1,isSingle:!1,autoScrollbar:!1,onFormulaSelectingChange:(v,C)=>{d.current=v,C&&(v?s.enableForceKeepVisible():s.disableForceKeepVisible())},disableSelectionOnClick:!0,disableContextMenu:!1})})};class pl{constructor(){E(this,"_position",null);E(this,"_position$",new O.BehaviorSubject(null));E(this,"position$",this._position$.asObservable());E(this,"_focus",!1);E(this,"_focus$",new O.BehaviorSubject(this._focus));E(this,"focus$",this._focus$.asObservable());E(this,"_fxBtnClick$",new O.Subject);E(this,"fxBtnClick$",this._fxBtnClick$.asObservable());E(this,"_foldBtnStatus$",new O.Subject);E(this,"foldBtnStatus$",this._foldBtnStatus$.asObservable())}dispose(){this._position$.complete(),this._focus$.complete(),this._position=null,this._focus=!1}setPosition(o){this._position=o,this._refresh(o)}getPosition(){return this._position}setFocus(o=!1){this._focus=o,this._focus$.next(o)}handleFxBtnClick(o){this._fxBtnClick$.next(o)}handleFoldBtnClick(o){this._foldBtnStatus$.next(o)}_refresh(o){this._position$.next(o)}}const Vn=a.createIdentifier("univer.sheet-formula-editor-manager.service");function Xh(){const n=I.useDependency(a.ICommandService),o=I.useDependency(a.LocaleService),e=I.useDependency(G.IDefinedNamesService),t=I.useDependency(a.IUniverInstanceService),r=I.useDependency(I.ISidebarService),s=t.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId(),l=()=>{const g=e.getDefinedNameMap(s);return g?Array.from(Object.values(g)):[]},[c,d]=W.useState(l());W.useEffect(()=>{const g=e.update$.subscribe(()=>{d(l())});return()=>{g.unsubscribe()}},[]),W.useEffect(()=>{const g=r.sidebarOptions$.subscribe(S=>{S.id===sr&&(S.visible||setTimeout(()=>{r.sidebarOptions$.next({visible:!1})}))});return()=>{g.unsubscribe()}},[]);const u=()=>{n.executeCommand(Ho.id,{value:"open"})},h=async g=>{const{formulaOrRefString:S,id:p}=g,f=e.getWorksheetByRef(s,S);if(!f)return;f.isSheetHidden()&&await n.executeCommand(m.SetWorksheetShowCommand.id,{unitId:s,subUnitId:f.getSheetId()}),e.focusRange(s,p)};return b.jsxs("div",{className:"univer-w-[300px]",children:[b.jsx("ul",{className:F.clsx("univer-m-0 univer-max-h-[360px] univer-list-none univer-overflow-y-auto univer-p-0",F.scrollbarClassName),children:c.map((g,S)=>b.jsx("li",{className:"univer-cursor-pointer univer-px-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",onClick:()=>{h(g)},children:b.jsxs("div",{className:F.clsx("univer-flex univer-items-center univer-justify-between univer-gap-2 univer-py-1",F.borderBottomClassName),children:[b.jsx("div",{className:"univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",title:g.name,children:g.name}),b.jsx("div",{className:"univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-xs univer-text-gray-400",title:g.formulaOrRefString,children:g.formulaOrRefString})]})},S))}),b.jsxs("div",{className:"univer-cursor-pointer univer-p-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",onClick:u,children:[b.jsx("div",{className:"univer-mb-2 univer-text-sm univer-font-semibold univer-text-gray-600 dark:!univer-text-gray-200",children:o.t("definedName.managerTitle")}),b.jsx("div",{className:"univer-text-xs univer-text-gray-400",children:o.t("definedName.managerDescription")})]})]})}function Yh({disable:n}){const[o,e]=W.useState(""),t=I.useDependency(G.IDefinedNamesService);W.useEffect(()=>{const i=t.currentRange$.subscribe(()=>{e(t.getCurrentRangeForString())});return()=>{i.unsubscribe()}},[]);function r(){}return b.jsxs("div",{"data-u-comp":"defined-name",className:"univer-relative univer-box-border univer-flex univer-h-full univer-w-24 univer-border-r-gray-200 univer-py-1.5 univer-transition-all",children:[b.jsx("input",{className:F.clsx("univer-box-border univer-h-full univer-w-full univer-appearance-none univer-px-1.5 univer-text-gray-900 focus:univer-outline-none dark:!univer-border-r-gray-700 dark:!univer-bg-gray-900 dark:!univer-text-white",F.borderRightClassName,{"univer-cursor-not-allowed":n}),type:"text",value:o,onChange:r}),b.jsx(F.Dropdown,{overlay:b.jsx("div",{className:"univer-z-[1001]",children:b.jsx(Xh,{})}),disabled:n,children:b.jsx("a",{className:F.clsx("univer-absolute univer-right-0 univer-top-0 univer-flex univer-h-full univer-cursor-pointer univer-items-center univer-justify-center univer-px-1 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-800",{"univer-cursor-not-allowed univer-text-gray-300 hover:univer-bg-transparent dark:!univer-text-gray-700":n}),children:b.jsx(_n,{})})})]})}function fl(n){var q,te,ce,ne;const{className:o,disableDefinedName:e}=n,[t,r]=W.useState(!1),[i,s]=W.useState(0),l=I.useDependency(Vn),c=I.useDependency(he),d=I.useDependency(m.WorksheetProtectionRuleModel),u=I.useDependency(m.RangeProtectionRuleModel),h=I.useDependency(a.IUniverInstanceService),g=I.useDependency(m.SheetsSelectionsService),S=I.useDependency(a.IPermissionService),p=I.useDependency(m.RangeProtectionCache),f=I.useDependency(a.ICommandService),[v,C]=W.useState({editDisable:!1,viewDisable:!1}),[_,R]=W.useState(!1),w=I.useDependency(I.ComponentManager),P=I.useObservable(()=>h.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),void 0,void 0,[]),y=W.useRef(0),M=I.useObservable(c.currentEditCellState$),x=ms(y,(q=M==null?void 0:M.unitId)!=null?q:""),A=w.get(yo),D=I.useComponentsOfPart(is.FORMULA_AUX),N=I.useDependency(a.IContextService);I.useObservable(W.useMemo(()=>N.subscribeContextValue$(a.FOCUSING_FX_BAR_EDITOR),[N]));const V=N.getContextValue(a.FOCUSING_FX_BAR_EDITOR),H=W.useRef(null),k=I.useDependency(J.IEditorService);W.useLayoutEffect(()=>{const oe=P.activeSheet$.pipe(O.switchMap($=>$?O.merge(d.ruleChange$,u.ruleChange$,g.selectionMoveEnd$,g.selectionSet$).pipe(O.switchMap(()=>{var ot,it;const me=P.getUnitId(),pe=$.getSheetId();if(!((ot=g.getCurrentLastSelection())==null?void 0:ot.range))return O.EMPTY;const Re=(it=g.getCurrentLastSelection())==null?void 0:it.primary;return Re?O.of({unitId:me,subUnitId:pe,primary:Re}):O.of(null)})):O.EMPTY)).subscribe($=>{var me,pe,be,Re,ot,it;if($){const{unitId:It,subUnitId:Hr,primary:od}=$;if(d.getRule(It,Hr)){const ad=!((pe=(me=S.getPermissionPoint(new m.WorksheetEditPermission(It,Hr).id))==null?void 0:me.value)==null||pe),ld=!((Re=(be=S.getPermissionPoint(new m.WorksheetViewPermission(It,Hr).id))==null?void 0:be.value)==null||Re);C({viewDisable:ld,editDisable:ad});return}const{actualRow:id,actualColumn:sd}=od,Gt=p.getCellInfo(It,Hr,id,sd);C({editDisable:!((ot=Gt==null?void 0:Gt[m.UnitAction.Edit])==null||ot),viewDisable:!((it=Gt==null?void 0:Gt[m.UnitAction.View])==null||it)})}else C({viewDisable:!1,editDisable:!1})});return()=>{oe.unsubscribe()}},[P]),W.useEffect(()=>{const oe=c.visible$.subscribe($=>{r($.visible)});return()=>oe.unsubscribe()},[c.visible$]),W.useEffect(()=>{const oe=c.currentEditCellState$.subscribe($=>{var me,pe,be;(be=(pe=(me=$==null?void 0:$.documentLayoutObject.documentModel)==null?void 0:me.getBody())==null?void 0:pe.customBlocks)!=null&&be.length?R(!0):R(!1)});return()=>oe.unsubscribe()},[c.currentEditCellState$]),W.useEffect(()=>{const oe=()=>{if(!H.current)return;const $=H.current.getBoundingClientRect();l.setPosition($)};if(H.current){oe();const $=new ResizeObserver(oe);return $.observe(H.current),()=>$.disconnect()}},[l]);function U(){s(i===0?1:0),setTimeout(()=>{l.handleFoldBtnClick(i===1)},150)}function L(){c.isVisible().visible&&f.executeCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.ESC,unitId:M.unitId})}function j(){c.isVisible().visible&&f.executeCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.PointerDown,unitId:M.unitId})}function B(){l.handleFxBtnClick(!0)}const{viewDisable:z,editDisable:X}=v,K=X||_,ie=W.useRef(!1),re=()=>{try{if(c.isVisible().visible===!1&&!f.syncExecuteCommand(Se.id,{visible:!0,eventType:T.DeviceInputEventType.PointerDown,unitId:M.unitId})){ie.current=!0;return}N.setContextValue(a.FOCUSING_FX_BAR_EDITOR,!0)}catch(oe){throw ie.current=!0,oe}},le=()=>{ie.current&&setTimeout(()=>{k.blur(!0)},30),ie.current=!1},Y=((ne=(ce=(te=M==null?void 0:M.documentLayoutObject.documentModel)==null?void 0:te.getDrawingsOrder())==null?void 0:ce.length)!=null?ne:0)>0||z;return b.jsxs("div",{"data-u-comp":"formula-bar",className:F.clsx("univer-box-border univer-flex univer-bg-white univer-transition-[height] univer-ease-linear dark:!univer-bg-gray-900",F.borderBottomClassName,o,{"univer-h-7":i===0,"univer-h-20":i===1,"univer-pointer-events-none":X}),children:[b.jsx("div",{className:"univer-relative univer-box-border univer-h-full univer-w-[100px]",children:b.jsx(Yh,{disable:e!=null?e:X})}),b.jsxs("div",{className:"univer-flex univer-h-full univer-w-full",children:[b.jsx("div",{className:F.clsx("univer-py-1.5",{"univer-cursor-not-allowed univer-text-gray-200":K}),children:b.jsxs("div",{className:F.clsx("univer-relative univer-box-border univer-flex univer-h-full univer-w-20 univer-items-center univer-justify-center univer-text-xs",F.borderRightClassName),children:[b.jsx("span",{className:F.clsx("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white",{"univer-cursor-pointer univer-text-red-600 hover:univer-bg-gray-100 dark:!univer-text-green-400 dark:hover:!univer-bg-gray-700":t}),onClick:L,children:b.jsx(ol,{})}),b.jsx("span",{className:F.clsx("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white",{"univer-cursor-pointer univer-text-green-600 hover:univer-bg-gray-100 dark:!univer-text-red-400 dark:hover:!univer-bg-gray-700":t}),onClick:j,children:b.jsx(Yt,{})}),b.jsx("span",{className:"univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-700",onClick:B,children:b.jsx(ll,{})})]})}),b.jsxs("div",{className:"univer-flex univer-w-full univer-flex-1 univer-overflow-hidden univer-pl-3",children:[b.jsxs("div",{ref:H,className:"univer-relative univer-flex-1",onPointerDown:re,onPointerUp:le,style:{pointerEvents:Y?"none":"auto"},children:[A&&b.jsx(A,{className:"univer-relative univer-h-full univer-w-full univer-break-words univer-outline-none [&>div]:univer-ring-transparent",disableSelectionOnClick:!0,editorId:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,initValue:"",onChange:()=>{},isFocus:V,unitId:M==null?void 0:M.unitId,subUnitId:M==null?void 0:M.sheetId,isSupportAcrossSheet:!0,resetSelectionOnBlur:!1,isSingle:!1,keyboardEventConfig:x,onFormulaSelectingChange:(oe,$)=>{y.current=oe,$&&(oe?c.enableForceKeepVisible():c.disableForceKeepVisible())},autoScrollbar:!1,disableContextMenu:!1}),Y&&b.jsx("div",{className:"univer-pointer-events-none univer-relative univer-left-0 univer-top-0 univer-z-[100] univer-h-full univer-w-full univer-cursor-not-allowed univer-bg-white"})]}),b.jsx("div",{className:F.clsx("univer-flex univer-h-full univer-w-5 univer-cursor-pointer univer-items-center univer-justify-center univer-text-xs univer-text-gray-700 dark:!univer-text-gray-200",{"univer-cursor-not-allowed univer-text-gray-200 dark:!univer-text-gray-700":X}),onClick:U,children:b.jsx(sl,{className:F.clsx({"univer-rotate-180":i===1})})})]})]}),b.jsx(I.ComponentContainer,{components:D},"formula-aux")]})}function Zr(n){const{children:o,className:e,style:t,disabled:r=!1,onClick:i,...s}=n,l=c=>{if(r){c.preventDefault();return}i&&i(c)};return b.jsx(F.Button,{"data-u-comp":"sheet-bar-append-button",className:e,size:"small",disabled:r,style:t,variant:"text",onClick:l,...s,children:o})}function Zh(){const[n,o]=W.useState([]),[e,t]=W.useState(!1),r=I.useDependency(a.IUniverInstanceService),i=I.useDependency(a.ICommandService),s=I.useDependency(Xt),l=I.useDependency(m.WorksheetProtectionRuleModel),c=I.useObservable(()=>r.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),null,!1,[]),d=f=>{const{sheetId:v}=f;!v||!c||(f.hidden?i.executeCommand(m.SetWorksheetShowCommand.id,{unitId:c.getUnitId(),subUnitId:v,value:v}):f.selected||i.executeCommand(m.SetWorksheetActivateCommand.id,{unitId:c.getUnitId(),subUnitId:v}),t(!1))},u=W.useCallback(()=>{if(!c)return;const f=c.getSheets(),v=c.getActiveSheet(),C=f.map((_,R)=>({label:_.getName(),index:`${R}`,sheetId:_.getSheetId(),hidden:_.isSheetHidden()===a.BooleanNumber.TRUE,selected:v===_}));o(C)},[c,l]),h=W.useCallback(()=>i.onCommandExecuted(f=>{switch(f.id){case m.SetWorksheetHideMutation.id:case m.RemoveSheetMutation.id:case m.SetWorksheetNameMutation.id:case m.InsertSheetMutation.id:case m.SetWorksheetOrderMutation.id:case m.SetWorksheetActiveOperation.id:u();break}}),[i,u]);function g(){t(!0)}const S=f=>{t(f)};W.useEffect(()=>{u();const f=new a.DisposableCollection;return f.add(h()),f.add(s.registerSheetBarMenuHandler({handleSheetBarMenu:g})),()=>f.dispose()},[h,s,u,c]);const p=W.useMemo(()=>n.map(f=>({type:"item",children:b.jsxs("div",{className:"univer-relative univer-box-border univer-pl-6",children:[(f.selected||f.hidden)&&b.jsxs("span",{className:"univer-absolute univer-left-1 univer-top-0.5",children:[f.selected&&b.jsx(Yt,{className:"univer-size-4 univer-text-primary-600"}),f.hidden&&b.jsx(al,{className:"univer-size-4 univer-text-gray-400"})]}),b.jsx("span",{className:F.clsx({"univer-text-primary-600":f.selected}),children:f.label})]}),onSelect:()=>{d(f)}})),[n]);return b.jsx(F.DropdownMenu,{align:"start",items:p,open:e,onOpenChange:S,children:b.jsx("div",{children:b.jsx(Zr,{children:b.jsx(il,{})})})})}function Gh(n){const{sheetId:o,label:e,color:t,selected:r,menuOverlay:i}=n,[s,l]=W.useState(r),c=I.useDependency(a.ThemeService);W.useEffect(()=>{l(r)},[r]);const d=u=>{const h=c.getColorFromTheme("gray.900"),g=c.getColorFromTheme("white");return new a.ColorKit(u).isDark()?g:h};return b.jsx("div",{"data-u-comp":"slide-tab-item","data-id":o,className:F.clsx("univer-mx-1 univer-box-border univer-flex univer-flex-grow univer-cursor-pointer univer-select-none univer-flex-row univer-items-center univer-rounded univer-text-xs univer-transition-[colors,box-shadow]",{"dark:!univer-text-white":!t||t&&!d(t),"univer-justify-center univer-bg-white univer-font-bold univer-text-primary-700 univer-shadow":s,"dark:!univer-bg-gray-900":s&&!t,"univer-font-medium univer-text-gray-900 hover:univer-bg-gray-100":!s,"dark:hover:!univer-bg-gray-700":!s&&!t}),style:{backgroundColor:!s&&t?t:"",color:!s&&t?d(t):"",boxShadow:s&&t?`0px 0px 8px rgba(0, 0, 0, 0.08), inset 0px -2px 0px 0px ${t}`:""},children:b.jsx("div",{className:"univer-box-border univer-flex univer-items-center univer-gap-1 univer-whitespace-nowrap univer-rounded univer-border-2 univer-border-solid univer-border-transparent univer-px-1.5 univer-py-1",children:e})},o)}const Kh={easeOutStrong(n,o,e,t){return-e*((n=n/t-1)*n*n*n-1)+o},backOut(n,o,e,t,r){return typeof r>"u"&&(r=.7),e*((n=n/t-1)*n*((r+1)*n+r)+1)+o}},qh={loop:!1,begin:0,end:0,duration:300,delay:0,type:"easeOutStrong",receive(n){},success(n){},cancel(n){},complete(n){}};class Qh{constructor(o){E(this,"_config");E(this,"_status",0);E(this,"_start",0);E(this,"_handle",0);E(this,"_delayHandle",null);this._config={...qh,...o},this._config.loop&&(this._config.complete=()=>{},this._config.success=()=>{this.request()})}static success(...o){let e=0;return new Promise(t=>{for(let r=0;r<o.length;r++){const i=o[r],s=i._config,l=s.success;s.loop||(s.success=d=>{e++,l&&l.call(i,d),e===o.length&&t()})}})}request(){this._config.delay===0?(this._status=0,this._start=Date.now(),this._fakeHandle()):(this._delayHandle&&clearTimeout(this._delayHandle),this._delayHandle=setTimeout(()=>{this._status=0,this._start=Date.now(),this._fakeHandle()},this._config.delay))}cancel(){this._status=1,this._delayHandle&&clearTimeout(this._delayHandle),cancelAnimationFrame(this._handle)}_fakeHandle(){let o=Date.now()-this._start;o=o>=this._config.duration?this._config.duration:o;const t=Kh[this._config.type](o,this._config.begin,this._config.end-this._config.begin,this._config.duration,.7).toFixed(2);if(this._config.receive(t),this._status===1){this._config.cancel(t),this._config.complete(t);return}if(o===this._config.duration){this._config.success(t),this._config.complete(t);return}this._handle=requestAnimationFrame(()=>{this._fakeHandle()})}}class At{constructor(o,e){E(this,"_slideTabItem");E(this,"_animate");E(this,"_midline",0);E(this,"_translateX");E(this,"_scrollbar");E(this,"_slideTabBar");E(this,"_editMode");E(this,"_placeholder");this._slideTabItem=o,this._animate=null,this._translateX=0,this._editMode=!1,this._slideTabBar=e,this._placeholder=null,this._scrollbar=e.getScrollbar(),this.update()}static midline(o){return o.getBoundingRect().x+o.getBoundingRect().width/2}static leftLine(o){return o.getBoundingRect().x}static rightLine(o){return o.getBoundingRect().x+o.getBoundingRect().width}static make(o,e){const t=[];return o.forEach(r=>t.push(new At(r,e))),t}getSlideTabItem(){return this._slideTabItem}getEditor(){return this._slideTabItem.querySelector("span")}focus(){var o;(o=this.getEditor())==null||o.focus()}selectAll(){const o=this.getEditor();o&&ln.keepSelectAll(o)}isEditMode(){return this._editMode}classList(){return this._slideTabItem.classList}translateX(o){return this._translateX=o,this._slideTabItem.style.transform=`translateX(${o}px)`,this.getTranslateXDirection()}setEditor(o){if(!this._slideTabBar.getConfig().onNameChangeCheck())return;let e=!0;if(this._editMode===!1){const t=this._slideTabItem.querySelector("span"),r=d=>{if(!this.nameCheck()){if(this._editMode=!1,t&&(t.removeAttribute("contentEditable"),t.removeEventListener("focusout",r),t.removeEventListener("compositionstart",s),t.removeEventListener("compositionend",l),t.removeEventListener("input",c),t.removeEventListener("keydown",i)),this._slideTabBar.removeListener(),this._slideTabBar.updateItems(),this._slideTabBar.getConfig().onChangeName){const u=(t==null?void 0:t.innerText)||"",h=this.getId();this._slideTabBar.getConfig().onChangeName(h,u)}o&&o(d)}};let i=d=>{t&&(d.stopPropagation(),d.key==="Enter"&&t.blur())};const s=d=>{e=!1},l=d=>{e=!0},c=d=>{if(!t)return;const u=31;setTimeout(()=>{if(e){const h=t.innerText;h.length>u&&(t.innerText=h.substring(0,u),ln.keepLastIndex(t))}},0)};t&&(t.setAttribute("contentEditable","true"),t.addEventListener("focusout",r),t.addEventListener("compositionstart",s),t.addEventListener("compositionend",l),t.addEventListener("input",c),t.addEventListener("keydown",i),this._editMode=!0,ln.keepSelectAll(t))}}nameCheck(){const o=this._slideTabItem.querySelector("span");if(!o)return!1;const e=o.innerText;return this._slideTabBar.getConfig().onNameCheckAlert(e)}animate(){return{translateX:o=>{this._translateX!==o&&(this._animate&&(this._animate.cancel(),this._animate=null),this._animate=new Qh({begin:this._translateX,end:o,receive:e=>{this._slideTabItem.style.transform=`translateX(${e}px)`}}),this._translateX=o,this._animate.request())},cancel:()=>{this._animate&&(this._animate.cancel(),this._animate=null)}}}after(o){this._slideTabItem.after(o._slideTabItem||o)}update(){this._midline=At.midline(this)}disableFixed(){if(this._placeholder){const o=this._slideTabBar.primeval();this._slideTabItem.style.removeProperty("position"),this._slideTabItem.style.removeProperty("left"),this._slideTabItem.style.removeProperty("top"),this._slideTabItem.style.removeProperty("width"),this._slideTabItem.style.removeProperty("height"),this._slideTabItem.style.removeProperty("background"),this._slideTabItem.style.removeProperty("padding"),this._slideTabItem.style.removeProperty("box-sizing"),this._slideTabItem.style.removeProperty("font-size"),this._slideTabItem.style.removeProperty("font-family"),this._slideTabItem.style.removeProperty("font-weight"),this._slideTabItem.style.removeProperty("color"),this._slideTabItem.style.removeProperty("border-radius"),this._placeholder.after(this._slideTabItem),o.removeChild(this._placeholder),this._placeholder=null}}enableFixed(){const o=document.createElement("div"),e=this.getBoundingRect(),t=getComputedStyle(this._slideTabItem),r=this._slideTabItem.querySelector("span");if(this._placeholder=o,this._placeholder.style.width=`${e.width}px`,this._placeholder.style.height=`${e.height}px`,this._placeholder.style.flexShrink="0",this._placeholder.style.margin=t.margin,this._slideTabItem.style.background=t.background,r){const i=getComputedStyle(r).padding;this._slideTabItem.style.padding=i}this._slideTabItem.style.boxSizing=t.boxSizing,this._slideTabItem.style.fontSize=t.fontSize,this._slideTabItem.style.fontFamily=t.fontFamily,this._slideTabItem.style.fontWeight=t.fontWeight,this._slideTabItem.style.color=t.color,this._slideTabItem.style.borderRadius=t.borderRadius,this._slideTabItem.style.left=`${e.x-this.getScrollbar().getScrollX()}px`,this._slideTabItem.style.top=`${e.y}px`,this._slideTabItem.style.width=`${e.width}px`,this._slideTabItem.style.height=`${e.height}px`,this._slideTabItem.style.position="fixed",this._slideTabItem.after(o),document.body.appendChild(this._slideTabItem)}addEventListener(o,e,t){this._slideTabItem.addEventListener(o,e,t)}removeEventListener(o,e,t){this._slideTabItem.removeEventListener(o,e,t)}getScrollbar(){return this._scrollbar}getMidLine(){return this._midline}getBoundingRect(){const o=this._slideTabItem.getBoundingClientRect();return o.x+=this._scrollbar.getScrollX(),o}getWidth(){return this.getBoundingRect().width}getTranslateXDirection(){const o=At.midline(this);return o>this._midline?1:o<this._midline?-1:0}equals(o){return o&&o._slideTabItem===this._slideTabItem}getId(){return this._slideTabItem.dataset.id||""}}class Jh{constructor(o){E(this,"_slideTabBar");E(this,"_scrollX");const e=o.primeval();this._scrollX=e.scrollLeft,this._slideTabBar=o}scrollX(o){const e=this._slideTabBar.primeval();e.scrollLeft=o,this._scrollX=e.scrollLeft}scrollRight(){const o=this._slideTabBar.primeval();o.scrollLeft=o.scrollWidth,this._scrollX=o.scrollLeft}getScrollX(){return this._scrollX}}const rn=class rn{constructor(o){E(this,"_activeTabItemIndex",0);E(this,"_slideTabBar");E(this,"_slideTabItems",[]);E(this,"_config");E(this,"_downActionX",0);E(this,"_moveActionX",0);E(this,"_compareIndex",0);E(this,"_activeTabItem",null);E(this,"_moveAction");E(this,"_upAction");E(this,"_downAction");E(this,"_wheelAction");E(this,"_scrollIncremental",0);E(this,"_compareDirection",0);E(this,"_autoScrollTime",null);E(this,"_slideScrollbar");E(this,"_longPressTimer",null);E(this,"_leftBoundingLine",0);E(this,"_rightBoundingLine",0);E(this,"_leftMoveX",0);E(this,"_rightMoveX",0);if(o.slideTabBarContainer==null)throw new Error("not found slide-tab-bar root element");const e=o.slideTabBarContainer.querySelector(`${o.slideTabBarSelector}`);if(e==null)throw new Error("not found slide-tab-bar");this._slideTabBar=e,this._slideScrollbar=new Jh(this),this._config=o,this._initConfig();let t=0,r=0,i=0;this._downAction=s=>{var P,y,M,x,A,D;if((P=this._activeTabItem)!=null&&P.isEditMode())return;this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null);const l=(M=(y=s.target)==null?void 0:y.closest(`${o.slideTabBarItemSelector}`))==null?void 0:M.getAttribute("data-id"),c=this._slideTabItems.findIndex(N=>N.getId()===l);if(l==null||c===-1)return;if(this._activeTabItemIndex!==c){(x=this._activeTabItem)==null||x.removeEventListener("pointermove",this._moveAction),(A=this._activeTabItem)==null||A.removeEventListener("pointerup",this._upAction),this.removeListener(),this._config.onChangeTab(s,l);return}if(this._compareIndex=c,this._downActionX=s.pageX,this._moveActionX=0,this._scrollIncremental=0,this._activeTabItem=this._slideTabItems[c],!this._activeTabItem){console.error("Not found active slide-tab-item in sheet bar");return}const d=this._activeTabItem.getSlideTabItem();d==null||d.setPointerCapture(s.pointerId),(D=this._activeTabItem)==null||D.addEventListener("pointerup",this._upAction);const{x:u,width:h}=this._activeTabItem.getBoundingRect(),{x:g,width:S}=this.getBoundingRect(),p=this._slideScrollbar.getScrollX();if(this._leftBoundingLine=this._downActionX-(u-p),this._rightBoundingLine=u-p+h-this._downActionX,this._leftMoveX=u-g-p,this._rightMoveX=g+S-(u+h)+p,s.button===2||this._hasEditItem())return;const{pageX:f,pageY:v}=s,C=Date.now(),_=C-i<=rn.DoubleClickDelay,R=Math.abs(f-t)<10,w=Math.abs(v-r)<10;_&&R&&w&&this._activeTabItem.setEditor(),t=f,r=v,i=C,this._longPressTimer=setTimeout(()=>{var N,V,H;!d||(N=this._activeTabItem)!=null&&N.isEditMode()||((V=this._activeTabItem)==null||V.enableFixed(),this._startAutoScroll(),d.setPointerCapture(s.pointerId),d.style.cursor="move",(H=this._activeTabItem)==null||H.addEventListener("pointermove",this._moveAction))},rn.LongPressDelay)},this._upAction=s=>{var d,u,h,g;if((d=this._activeTabItem)!=null&&d.isEditMode()||(this._longPressTimer&&(clearTimeout(this._longPressTimer),this._longPressTimer=null),!this._activeTabItem))return;const l=this._autoScrollTime!==null;this._closeAutoScroll(),this._activeTabItem.disableFixed(),this.updateItems();const c=(u=this._activeTabItem)==null?void 0:u.getSlideTabItem();c&&(c.style.cursor="",c.releasePointerCapture(s.pointerId),(h=this._activeTabItem)==null||h.removeEventListener("pointermove",this._moveAction),(g=this._activeTabItem)==null||g.removeEventListener("pointerup",this._upAction),this._config.onSlideEnd&&this._activeTabItemIndex!==this._compareIndex&&l&&(this.removeListener(),this._config.onSlideEnd(s,this._compareIndex||0)),this._scrollIncremental=0,this._downActionX=0,this._moveActionX=0,this._compareIndex=0)},this._moveAction=s=>{this._activeTabItem&&(this._moveActionX=s.pageX-this._downActionX,this._moveActionX<=-this._leftMoveX?this._moveActionX=-this._leftMoveX:this._moveActionX>=this._rightMoveX&&(this._moveActionX=this._rightMoveX),this._scrollIncremental=0,this._scrollLeft(s),this._scrollRight(s))},this._wheelAction=s=>{this.setScroll(s.deltaY)},this.addListener()}static checkedSkipSlide(o){let e=o.target;for(;e!=null&&e!==document.body;){if(e.getAttribute("data-slide-skip"))return!0;e=e.parentElement}return!1}static keepLastIndex(o){setTimeout(()=>{const e=window.getSelection();e&&(e.selectAllChildren(o),e.collapseToEnd())})}static keepSelectAll(o){setTimeout(()=>{const e=window.getSelection();if(!e)return;const t=document.createRange();t.selectNodeContents(o),e.removeAllRanges(),e.addRange(t)})}update(o){this._config.currentIndex=o,this._initConfig(),this.removeListener(),this.addListener(),this.scrollToItem(o)}primeval(){return this._slideTabBar}updateItems(){for(let o=0;o<this._slideTabItems.length;o++)this._slideTabItems[o].animate().cancel(),this._slideTabItems[o].translateX(0),this._slideTabItems[o].update()}getScrollbar(){return this._slideScrollbar}getConfig(){return this._config}getBoundingRect(){return this._slideTabBar.getBoundingClientRect()}getSlideTabItems(){return this._slideTabItems}getActiveItem(){return this._activeTabItem}isLeftEnd(){return this._slideTabBar.scrollLeft===0}isRightEnd(){const o=this._slideTabBar.parentElement;return o?this._slideTabBar.scrollWidth-o.clientWidth===this._slideTabBar.scrollLeft:!1}addListener(){this._slideTabBar.addEventListener("wheel",this._wheelAction),this._slideTabItems.forEach(o=>{o.addEventListener("pointerdown",this._downAction)})}removeListener(){this._slideTabBar.removeEventListener("wheel",this._wheelAction),this._slideTabItems.forEach(o=>{o.removeEventListener("pointerdown",this._downAction)})}setScroll(o){if(this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+o),o>0){const e=this.calculateLeftScrollX();this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+e)}else if(o<0){const e=this.calculateRightScrollX();this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+e)}this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}flipPage(o){if(o>0){const e=this.calculateLeftScrollX(!0);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+e)}else if(o<0){const e=this.calculateRightScrollX(!0);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+e)}this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}scrollToItem(o){if(o=o!=null?o:this._config.currentIndex,o<0||o>=this._slideTabItems.length){console.error("Index out of bounds");return}const e=this.calculateTabItemScrollX(o);this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+e),this._config.onScroll({leftEnd:this.isLeftEnd(),rightEnd:this.isRightEnd()})}calculateLeftScrollX(o){let e=0;const t=4;return this._slideTabItems.some(r=>{const i=this._slideTabBar.getBoundingClientRect(),s=i.left+i.width,l=r.getSlideTabItem().getBoundingClientRect(),c=l.left,d=l.width;return c<s&&c+d+t*2>s?(e=o?c-i.left-t:c+d-s+t,!0):!1}),e}calculateRightScrollX(o){let e=0;const t=4;return this._slideTabItems.some(r=>{const i=this._slideTabBar.getBoundingClientRect(),s=i.left,l=r.getSlideTabItem().getBoundingClientRect(),c=l.left,d=l.width;return c-t*2<s&&c+d>s?(e=o?c+d-i.left-i.width+t:c-s-t,!0):!1}),e}calculateTabItemScrollX(o){let e=0;const t=4,r=this._slideTabBar.getBoundingClientRect(),i=r.left,s=r.left+r.width,l=this._slideTabItems[o].getSlideTabItem().getBoundingClientRect(),c=l.left,d=l.width;return c-t*2<i&&(e=c-i-t),c+d+t*2>s&&(e=c+d-s+t),e}calculateActiveTabItemScrollX(){var d;let o=0;const e=4,t=this._slideTabBar.getBoundingClientRect(),r=t.left,i=t.left+t.width,s=(d=this._activeTabItem)==null?void 0:d.getSlideTabItem().getBoundingClientRect();if(!s)return 0;const l=s.left,c=s.width;return l-e*2<r&&l+c>r&&(o=l-r-e),l<i&&l+c+e*2>i&&(o=l+c-i+e),o}destroy(){this.removeListener(),this._downActionX=0,this._moveActionX=0,this._compareDirection=0,this._compareIndex=0,this._slideTabItems=[],this._activeTabItem=null}_hasEditItem(){for(let o=0;o<this._slideTabItems.length;o++)if(this._slideTabItems[o].isEditMode())return!0;return!1}_autoScrollFrame(){if(this._activeTabItem)switch(this._compareDirection=this._activeTabItem.translateX(this._moveActionX),this._compareDirection){case 1:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareRight();break}case 0:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareIndex=this._activeTabItemIndex;break}case-1:{this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX()+this._scrollIncremental),this._compareLeft();break}}this._autoScrollTime=requestAnimationFrame(()=>{this._autoScrollFrame()})}_startAutoScroll(){this._autoScrollTime==null&&this._autoScrollFrame()}_closeAutoScroll(){this._autoScrollTime&&cancelAnimationFrame(this._autoScrollTime),this._autoScrollTime=null}_scrollLeft(o){const e=this.getBoundingRect(),t=o.pageX-e.x;t<this._leftBoundingLine&&(this._scrollIncremental=-Math.min(Math.abs(t-this._leftBoundingLine)*.1,50))}_scrollRight(o){const e=this.getBoundingRect(),t=o.pageX-e.x;t>e.width-this._rightBoundingLine&&(this._scrollIncremental=Math.min(Math.abs(t-(e.width-this._rightBoundingLine))*.1,50))}_sortedItems(){if(this._activeTabItem!=null&&this._activeTabItemIndex!=null&&this._compareIndex!=null&&(this._slideTabItems.splice(this._activeTabItemIndex,1),this._slideTabItems.splice(this._compareIndex,0,this._activeTabItem),this._config.slideTabBarItemAutoSort))for(let o=0;o<this._slideTabItems.length;o++){const e=this._slideTabItems[o],t=this._slideTabItems[o+1];t&&e.after(t)}}_compareLeft(){if(this._activeTabItem&&this._activeTabItemIndex){const o=this._slideTabItems.findIndex(i=>i.equals(this._activeTabItem)),e=this._slideTabItems.length,t=[];for(let i=0;i<o&&!(i>=o);i++)t.push(this._slideTabItems[i]);for(let i=o+1;i<e;i++)this._slideTabItems[i].animate().translateX(0);let r=!0;for(let i=t.length-1;i>=0;i--){const s=t[i];At.leftLine(this._activeTabItem)<s.getMidLine()?(s.animate().translateX(this._activeTabItem.getWidth()),this._compareIndex=i,r=!1):(s.animate().translateX(0),r&&(this._compareIndex=this._activeTabItemIndex))}}}_compareRight(){if(this._activeTabItem){const o=this._slideTabItems.findIndex(i=>i.equals(this._activeTabItem)),e=this._slideTabItems.length,t=[];for(let i=o+1;i<e;i++)t.push(this._slideTabItems[i]);for(let i=0;i<o;i++)this._slideTabItems[i].animate().translateX(0);let r=!0;for(let i=0;i<t.length;i++){const s=t[i];At.rightLine(this._activeTabItem)>s.getMidLine()?(s.animate().translateX(-this._activeTabItem.getWidth()),this._compareIndex=o+i+1,r=!1):(s.animate().translateX(0),r&&(this._compareIndex=this._activeTabItemIndex))}}}_initConfig(){const o=this._slideTabBar.querySelectorAll(`${this._config.slideTabBarItemSelector}`);this._downActionX=0,this._moveActionX=0,this._compareDirection=0,this._compareIndex=0,this._slideTabItems=At.make(o,this),this._activeTabItemIndex=this._config.currentIndex,this._activeTabItem=this._slideTabItems[this._activeTabItemIndex]}};E(rn,"LongPressDelay",500),E(rn,"DoubleClickDelay",300);let ln=rn;function $h(){var le;const[n,o]=W.useState([]),[e,t]=W.useState(""),[r,i]=W.useState(""),[s,l]=W.useState(!1),[c,d]=W.useState([0,0]),u=W.useRef({slideTabBar:null}),h=W.useRef(null),g=I.useDependency(a.ICommandService),S=I.useDependency(Xt),p=I.useDependency(a.LocaleService),f=I.useDependency(I.IConfirmService),v=I.useDependency(he,a.Quantity.OPTIONAL),C=I.useDependency(m.WorksheetProtectionRuleModel),_=I.useDependency(m.RangeProtectionRuleModel),R=I.useObservable(C.resetOrder$),w=vt(),P=I.useDependency(a.IPermissionService),y=W.useCallback(()=>{var ce;const Z=((ce=w.getActiveSheet())==null?void 0:ce.getSheetId())||"";t(Z);const Y=w.getSheets(),q=w.getActiveSheet(),te=Y.filter(ne=>!ne.isSheetHidden()).map((ne,oe)=>{var Re;const $=C.getRule(w.getUnitId(),ne.getSheetId()),me=_.getSubunitRuleList(w.getUnitId(),ne.getSheetId()).length>0,be=($==null?void 0:$.permissionId)||me?b.jsxs(b.Fragment,{children:[b.jsx(ds,{}),b.jsx("span",{className:"univer-outline-none",children:ne.getName()})]}):b.jsx("span",{className:"univer-outline-none",children:ne.getName()});return{sheetId:ne.getSheetId(),label:be,index:oe,selected:q===ne,color:(Re=ne.getTabColor())!=null?Re:void 0}});o(te),t(Z)},[_,w,C]);W.useEffect(()=>{y();const{slideTabBar:Z,disconnectResizeObserver:Y}=M(),q=L(),te=[j(),B(),z()];return()=>{q.dispose(),Z.destroy(),te.forEach(ce=>ce.unsubscribe()),Y&&Y()}},[R,w]),W.useEffect(()=>{n.length>0&&U()},[n]),W.useEffect(()=>{const Z=O.merge(C.ruleChange$,_.ruleChange$).subscribe(()=>{y()});return()=>{Z.unsubscribe()}},[C,y]);const M=()=>{const Z=new ln({slideTabBarSelector:"[data-u-comp=slide-tab-bar]",slideTabBarItemSelector:"[data-u-comp=slide-tab-item]",slideTabBarItemAutoSort:!0,slideTabBarContainer:h.current,currentIndex:0,onChangeName:(q,te)=>{g.executeCommand(m.SetWorksheetNameCommand.id,{subUnitId:q,name:te})},onSlideEnd:async(q,te)=>{await g.executeCommand(m.SetWorksheetOrderCommand.id,{order:te})},onChangeTab:(q,te)=>{g.executeCommand(m.SetWorksheetActiveOperation.id,{subUnitId:te,unitId:w.getUnitId()}).then(()=>{q.button===2&&re(!0)})},onScroll:q=>{S.setScroll(q)},onNameCheckAlert:q=>D(q)||N(q)||V(q),onNameChangeCheck:()=>{var $,me,pe,be;const q=w.getUnitId(),te=w==null?void 0:w.getActiveSheet();if(!te)throw new Error("No active sheet found");const ce=te.getSheetId(),ne=C.getRule(q,ce),oe=_.getSubunitRuleList(q,ce).length>0;return ne||oe?(me=($=P.getPermissionPoint(new m.WorkbookManageCollaboratorPermission(q).id))==null?void 0:$.value)!=null?me:!1:(be=(pe=P.getPermissionPoint(new m.WorkbookRenameSheetPermission(q).id))==null?void 0:pe.value)!=null?be:!1}});u.current.slideTabBar=Z;const Y=ie(Z);return{slideTabBar:Z,disconnectResizeObserver:Y}},x=I.useConfigValue(I.UI_PLUGIN_CONFIG_KEY),A=(le=x==null?void 0:x.contextMenu)!=null?le:!0,D=Z=>{if(Z.trim()===""){const Y="sheetNameEmptyAlert";return f.open({id:Y,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameCannotIsEmptyError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){H(),f.close(Y)},onConfirm(){H(),f.close(Y)}}),!0}return!1},N=Z=>{if(!a.nameCharacterCheck(Z)){const Y="sheetNameSpecCharAlert";return f.open({id:Y,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameSpecCharError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){H(),f.close(Y)},onConfirm(){H(),f.close(Y)}}),!0}return!1},V=Z=>{const Y=w.getActiveSheet();if((Y==null?void 0:Y.getName())===Z)return!1;const te=w.checkSheetName(Z);if(te){const ce="sheetNameRepeatAlert";f.open({id:ce,title:{title:p.t("sheetConfig.sheetNameErrorTitle")},children:{title:p.t("sheetConfig.sheetNameAlreadyExistsError")},cancelText:p.t("button.cancel"),confirmText:p.t("button.confirm"),onClose(){f.close(ce),H()},onConfirm(){f.close(ce),H()}})}return te},H=()=>{setTimeout(()=>{var Y;const Z=(Y=u.current.slideTabBar)==null?void 0:Y.getActiveItem();Z&&(Z.focus(),Z.selectAll())},0)},k=()=>{var Z,Y;(Y=(Z=u.current.slideTabBar)==null?void 0:Z.getActiveItem())==null||Y.setEditor()},U=()=>{var Y;const Z=n.findIndex(q=>q.selected);(Y=u.current.slideTabBar)==null||Y.update(Z)},L=()=>g.onCommandExecuted(Z=>{switch(Z.id){case m.SetTabColorMutation.id:case m.SetWorksheetHideMutation.id:case m.RemoveSheetMutation.id:case m.SetWorksheetNameMutation.id:case m.InsertSheetMutation.id:case m.SetWorksheetOrderMutation.id:case m.SetWorksheetActiveOperation.id:y();break}}),j=()=>S.scroll$.subscribe(Z=>{X(Z)}),B=()=>S.scrollX$.subscribe(Z=>{var Y;(Y=u.current.slideTabBar)==null||Y.flipPage(Z)}),z=()=>S.renameId$.subscribe(()=>{k()}),X=Z=>{const{leftEnd:Y,rightEnd:q}=Z;let te="";Y&&q?te="":Y&&!q?te="inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)":!Y&&q?te="inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2)":!Y&&!q&&(te="inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2), inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)"),i(te)},K=Z=>{const Y=Z.calculateActiveTabItemScrollX();if(Y){const q=Z.getScrollbar();q.scrollX(q.getScrollX()+Y)}S.setScroll({leftEnd:Z.isLeftEnd(),rightEnd:Z.isRightEnd()})},ie=Z=>{var te;const Y=(te=h.current)==null?void 0:te.querySelector("[data-u-comp=slide-tab-bar]");if(!Y)return;const q=new ResizeObserver(()=>{K(Z)});return q.observe(Y),()=>q.disconnect()},re=Z=>{var Y,q,te,ce,ne;if(A&&!(v!=null&&v.isForceKeepVisible())){if(Z){const{left:oe}=(q=(Y=h.current)==null?void 0:Y.getBoundingClientRect())!=null?q:{},{left:$}=(ne=(ce=(te=u.current.slideTabBar)==null?void 0:te.getActiveItem())==null?void 0:ce.getSlideTabItem().getBoundingClientRect())!=null?ne:{};oe!==void 0&&$!==void 0&&d([$-oe,0])}l(Z)}};return b.jsx(F.DropdownLegacy,{className:"univer-select-none",visible:s,align:{offset:c},trigger:["contextMenu"],overlay:b.jsx(I.UIMenu,{menuType:I.ContextMenuPosition.FOOTER_TABS,onOptionSelect:Z=>{const{label:Y,value:q,commandId:te}=Z;g.executeCommand(te!=null?te:Y,{value:q,subUnitId:e}),l(!1)}}),onVisibleChange:re,children:b.jsx("div",{className:"univer-max-w-[calc(100%-112px)] univer-overflow-hidden",ref:h,onDragStart:Z=>Z.preventDefault(),onContextMenu:Z=>Z.preventDefault(),children:b.jsx("div",{"data-u-comp":"slide-tab-bar",className:"univer-flex univer-select-none univer-flex-row univer-items-center univer-overflow-hidden univer-px-1.5 univer-py-1",style:{boxShadow:r},children:n.map(Z=>W.createElement(Gh,{...Z,key:Z.sheetId,selected:e===Z.sheetId}))})})})}const ta=100,vl=()=>{var f,v;const[n,o]=W.useState(!0),[e,t]=W.useState(!0),r=I.useDependency(a.ICommandService),i=I.useDependency(Xt),s=I.useDependency(a.IPermissionService),c=vt().getUnitId(),d=I.useObservable(s.getPermissionPoint$((f=new m.WorkbookEditablePermission(c))==null?void 0:f.id)),u=I.useObservable(s.getPermissionPoint$((v=new m.WorkbookCreateSheetPermission(c))==null?void 0:v.id)),h=C=>{const{leftEnd:_,rightEnd:R}=C;o(_),t(R)};W.useEffect(()=>{const C=i.scroll$.subscribe(a.throttle(_=>{h(_)},100));return()=>{C.unsubscribe()}},[]);const g=()=>{r.executeCommand(m.InsertSheetCommand.id),setTimeout(()=>{i.setAddSheet(0)},0)},S=()=>{i.setScrollX(-ta)},p=()=>{i.setScrollX(ta)};return b.jsxs("div",{className:"univer-relative univer-flex univer-h-full univer-min-w-0 univer-flex-1",children:[b.jsxs("div",{className:"univer-flex univer-items-center",children:[b.jsx(Zr,{className:"univer-mr-2",onClick:g,disabled:!(u!=null&&u.value&&(d!=null&&d.value)),children:b.jsx(cs,{})}),b.jsx(Zh,{})]}),b.jsx($h,{}),(!n||!e)&&b.jsxs("div",{className:'univer-relative univer-flex univer-items-center univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',children:[b.jsx(Zr,{disabled:n,onClick:S,children:b.jsx(Oi,{className:"univer-rotate-180"})}),b.jsx(Zr,{disabled:e,onClick:p,children:b.jsx(Oi,{})})]})]})},em=[50,75,100,125,150,175,200,400];function tm(){const n=I.useDependency(a.ICommandService),o=I.useDependency(a.IUniverInstanceService),e=vt(),t=I.useDependency(he),r=I.useObservable(t.visible$),i=W.useCallback(()=>{if(!e)return 100;const u=e.getActiveSheet(),h=u&&u.getZoomRatio()*100||100;return Math.round(h)},[e]),[s,l]=W.useState(()=>i());W.useEffect(()=>(l(i()),n.onCommandExecuted(h=>{if(h.id===De.id||h.id===m.SetWorksheetActiveOperation.id){const g=i();l(g)}}).dispose),[n,i]);function c(u){l(u);const h=o.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),g=h==null?void 0:h.getActiveSheet();if(g==null)return;const S=u/100;n.executeCommand(kn.id,{unitId:h.getUnitId(),subUnitId:g.getSheetId(),zoomRatio:S})}const d=(r==null?void 0:r.visible)&&(r.unitId===(e==null?void 0:e.getUnitId())||r.unitId===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY);return b.jsx(I.Slider,{disabled:d,min:Ri[0],value:s,shortcuts:em,onChange:c})}function nm(){return b.jsx("section",{className:"univer-flex univer-flex-shrink-0 univer-justify-end",children:b.jsx(tm,{})})}class gs{constructor(){E(this,"_functions",[{func:G.FUNCTION_NAMES_STATISTICAL.MAX,filter:o=>{var e,t,r,i;return((t=(e=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1&&((i=(r=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNT))==null?void 0:r.value)!=null?i:0)>0}},{func:G.FUNCTION_NAMES_STATISTICAL.MIN,filter:o=>{var e,t,r,i;return((t=(e=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1&&((i=(r=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNT))==null?void 0:r.value)!=null?i:0)>0}},{func:G.FUNCTION_NAMES_MATH.SUM,filter:o=>{var e,t,r,i;return((t=(e=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1&&((i=(r=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNT))==null?void 0:r.value)!=null?i:0)>0}},{func:G.FUNCTION_NAMES_STATISTICAL.COUNTA,filter:o=>{var e,t;return((t=(e=o.values.find(r=>r.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1}},{func:G.FUNCTION_NAMES_STATISTICAL.COUNT,filter:o=>{var e,t,r,i;return((t=(e=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1&&((i=(r=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNT))==null?void 0:r.value)!=null?i:0)>0}},{func:G.FUNCTION_NAMES_STATISTICAL.AVERAGE,filter:o=>{var e,t,r,i;return((t=(e=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNTA))==null?void 0:e.value)!=null?t:0)>1&&((i=(r=o.values.find(s=>s.func===G.FUNCTION_NAMES_STATISTICAL.COUNT))==null?void 0:r.value)!=null?i:0)>0}}]);E(this,"_state$",new O.BehaviorSubject(null));E(this,"state$",this._state$.asObservable())}dispose(){this._state$.complete()}setState(o){var t;const e={values:[],pattern:null};o==null||o.values.forEach(r=>{const i=this._functions.find(s=>s.func===r.func);i&&(i.filter===void 0||i.filter(o))&&e.values.push(r)}),e.pattern=(t=o==null?void 0:o.pattern)!=null?t:null,this._state$.next(e)}getState(){return this._state$.getValue()}getFunctions(){return this._functions}addFunctions(o){this._functions.push(...o)}}const Dr=a.createIdentifier("univer.sheet-status-bar.service"),rm=[G.FUNCTION_NAMES_MATH.SUM,G.FUNCTION_NAMES_STATISTICAL.AVERAGE,G.FUNCTION_NAMES_STATISTICAL.MIN,G.FUNCTION_NAMES_STATISTICAL.MAX],Gr={[G.FUNCTION_NAMES_MATH.SUM]:"statusbar.sum",[G.FUNCTION_NAMES_STATISTICAL.AVERAGE]:"statusbar.average",[G.FUNCTION_NAMES_STATISTICAL.MIN]:"statusbar.min",[G.FUNCTION_NAMES_STATISTICAL.MAX]:"statusbar.max",[G.FUNCTION_NAMES_STATISTICAL.COUNT]:"statusbar.count",[G.FUNCTION_NAMES_STATISTICAL.COUNTA]:"statusbar.countA",[G.FUNCTION_NAMES_TEXT.CONCATENATE]:"concatenate"},om=n=>{const o=I.useDependency(a.LocaleService),e=I.useDependency(I.IMessageService),t=I.useDependency(I.IClipboardInterfaceService),r=im(n),i=async()=>{await t.writeText(n.value.toString()),e.show({type:F.MessageType.Success,content:o.t("statusbar.copied")})};return b.jsx(F.Tooltip,{title:o.t("statusbar.clickToCopy"),placement:"top",children:b.jsx("div",{className:"univer-flex univer-cursor-pointer univer-truncate univer-text-center univer-text-xs univer-text-gray-400",onClick:i,children:b.jsx("span",{children:`${o.t((Gr==null?void 0:Gr[n.name])||n.name)}: ${r}`})},n.name)})};function im(n){const{pattern:o,value:e}=n;return typeof e!="number"?0:e>=1e8?e.toExponential(2):o&&rm.includes(n.name)?a.numfmt.format(o,e,{throws:!1}):e.toLocaleString()}const na=800,sm=3,am=()=>{var h,g;const n=(g=(h=I.useConfigValue(Ee))==null?void 0:h.statusBarStatistic)!=null?g:!0,[o,e]=W.useState(window.innerWidth<na),t=I.useDependency(Dr),r=t.getFunctions().map((S,p)=>({name:S.func,value:0,show:!0,disable:!1,pattern:null})),i=(S,p,f,v)=>{const[C,_]=W.useState(S),[R,w]=W.useState(!0),P=W.useMemo(()=>C.filter(A=>A.show&&!A.disable),[C]),y=W.useMemo(()=>P.find(A=>A.show&&!A.disable),[P]),M=W.useMemo(()=>f&&y?[y]:P,[f,y,P]),x=W.useCallback(A=>{const D=A==null?void 0:A.values;if(!(D!=null&&D.length)){w(!1);return}w(!0),_(N=>N.map(V=>{var H,k,U;return{...V,value:(k=(H=D.find(L=>L.func===V.name))==null?void 0:H.value)!=null?k:V.value,disable:!D.some(L=>L.func===V.name),pattern:(U=A==null?void 0:A.pattern)!=null?U:null}}))},[]);return W.useEffect(()=>{if(!v)return;const A=p.state$.subscribe(x);return()=>A.unsubscribe()},[v,p,x]),{statistics:C,showList:M,show:R}},{showList:s,show:l}=i(r,t,o,n),c=a.debounce(()=>{const S=window.innerWidth<na;o!==S&&e(S)},100);W.useEffect(()=>(window.addEventListener("resize",c),()=>{window.removeEventListener("resize",c)}),[o]);const u=((S,p,f)=>n?W.useMemo(()=>S.length>p?S.reduce((_,R,w)=>(w%2===0&&_.push(S.slice(w,w+2)),_),[]).map((_,R)=>b.jsxs("div",{className:"univer-grid univer-h-full univer-items-center",children:[_[0]&&b.jsx(f,{..._[0]},_[0].name),_[1]&&b.jsx(f,{..._[1]},_[1].name)]},`stat-col-${R}`)):S.map(C=>b.jsx("div",{className:"univer-grid univer-h-full univer-items-center",children:b.jsx(f,{...C})},C.name)),[S,p,f]):null)(s,sm,om);return l&&b.jsx("div",{className:F.clsx('univer-relative univer-box-border univer-flex univer-h-full univer-items-center univer-overflow-hidden univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-block after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',{"univer-max-w-32":o,"univer-max-w-fit":!o}),children:b.jsx("div",{className:"univer-flex univer-h-full univer-gap-x-2",children:u})})},Cl=36;function Il(){var d;const n=I.useConfigValue(Ee),o=I.useDependency(I.IMenuManagerService),e=(d=n==null?void 0:n.footer)!=null?d:!0;if(!vt()||!e)return null;const r=o.getMenuByPositionKey(I.ContextMenuPosition.FOOTER_MENU),{sheetBar:i=!0,statisticBar:s=!0,menus:l=!0,zoomSlider:c=!0}=(n==null?void 0:n.footer)||{};return!i&&!s&&!l&&!c?null:b.jsxs("section",{className:"univer-box-border univer-grid univer-w-full univer-grid-flow-col univer-grid-cols-[1fr,auto,auto,auto] univer-items-center univer-justify-between univer-bg-white univer-px-5 univer-text-gray-900 dark:!univer-bg-gray-900 dark:!univer-text-gray-200",style:{height:Cl},"data-range-selector":!0,children:[i&&b.jsx(vl,{}),s&&b.jsx(am,{}),l&&r.length>0&&b.jsx("div",{className:"univer-box-border univer-flex univer-gap-2 univer-px-2",children:r.map(u=>{var h;return(h=u.children)==null?void 0:h.map(g=>(g==null?void 0:g.item)&&b.jsx(I.ToolbarItem,{...g.item},g.key))})}),c&&b.jsx(nm,{})]})}function _l(){const n=I.useConfigValue(Ee);return bl()&&(n==null?void 0:n.formulaBar)!==!1?b.jsx(fl,{}):null}function Ss(){return bl()?b.jsxs(b.Fragment,{children:[b.jsx(zh,{}),b.jsx(jh,{})]}):null}function bl(){const n=I.useDependency(a.IUniverInstanceService),e=!!I.useObservable(()=>n.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),null,!1,[]);return W.useMemo(()=>n.getAllUnitsForType(a.UniverInstanceType.UNIVER_SHEET).length>0,[n,e])}var lm=Object.getOwnPropertyDescriptor,cm=(n,o,e,t)=>{for(var r=t>1?void 0:t?lm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},$t=(n,o)=>(e,t)=>o(e,t,n);const ra=5,oa=2;exports.SheetCellEditorResizeService=class extends a.Disposable{constructor(o,e,t,r,i,s){super(),this._layoutService=o,this._cellEditorManagerService=e,this._editorBridgeService=t,this._renderManagerService=r,this._univerInstanceService=i,this._configService=s}get _currentRenderer(){return T.getCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,this._univerInstanceService,this._renderManagerService)}get _editingUnitId(){var o,e;return(e=(o=this._editorBridgeService.getEditCellState())==null?void 0:o.unitId)!=null?e:""}get _editingRenderer(){return this._renderManagerService.getRenderById(this._editingUnitId)}get _renderer(){var e;const o=(e=this._univerInstanceService.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET))==null?void 0:e.getUnitId();return this._editingUnitId===o?this._editingRenderer:this._currentRenderer}get _sheetSkeletonManagerService(){var o;return(o=this._renderer)==null?void 0:o.with(exports.SheetSkeletonManagerService)}get engine(){var o;return(o=this._renderer)==null?void 0:o.engine}fitTextSize(o){var A,D,N,V;const e=this._editorBridgeService.getEditCellState();if(!e)return;const{position:t,documentLayoutObject:r,canvasOffset:i,scaleX:s,scaleY:l}=e,{startX:c,startY:d,endX:u,endY:h}=t,g=this._univerInstanceService.getUnit(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.UniverInstanceType.UNIVER_DOC);if(g==null)return;const S=this._getEditorSkeleton();if(!S)return;const p=this._predictingSize(t,i,S,r,s,l);if(!p||p.actualWidth<=0)return;let{actualWidth:f,actualHeight:v}=p;const{verticalAlign:C,horizontalAlign:_,paddingData:R,fill:w}=r;f=f+((A=R.l)!=null?A:0)+((D=R.r)!=null?D:0),v=v+((N=R.t)!=null?N:0)+((V=R.b)!=null?V:0);let P=u-c,y=h-d;P<f&&(P=Math.ceil(f)),y<v&&(y=Math.ceil(v));let M=0;C===a.VerticalAlign.MIDDLE?M=(y-v)/2/l:C===a.VerticalAlign.TOP?M=R.t||0:M=(y-v)/l;let x=0;_===a.HorizontalAlign.CENTER||(_===a.HorizontalAlign.RIGHT?x=(P-f)/s:x=R.l||0),M=M<(R.t||0)?R.t||0:M,x=x<(R.l||0)?R.l||0:x,g.updateDocumentDataMargin({t:M,l:x}),S.calculate(),this._editAreaProcessing(P,y,t,i,w,s,l,_,o)}_predictingSize(o,e,t,r,i=1,s=1){const{startX:l,endX:c}=o,{textRotation:d,wrapStrategy:u,paddingData:h}=r,g=this._univerInstanceService.getUnit(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.UniverInstanceType.UNIVER_DOC),{vertexAngle:S}=T.convertTextRotation(d);if(u===a.WrapStrategy.WRAP&&S===0){g==null||g.updateDocumentDataPageSize(c-l),g==null||g.updateDocumentDataMargin({l:h.l,t:h.t}),t.calculate();const{actualWidth:C,actualHeight:_}=t.getActualSize();return{actualWidth:C*i,actualHeight:_*s}}const p=this._getEditorMaxSize(o,e,r.horizontalAlign);if(!p)return;g==null||g.updateDocumentDataPageSize(p.width/i),t.calculate();const f=t.getActualSize();let v=c-l;return v<f.actualWidth*i+ra*i&&(v=f.actualWidth*i+ra*i),g==null||g.updateDocumentDataPageSize(v/i),g==null||g.updateDocumentRenderConfig({horizontalAlign:a.HorizontalAlign.UNSPECIFIED,cellValueType:void 0}),{actualWidth:f.actualWidth*i,actualHeight:f.actualHeight*s}}_getEditorMaxSize(o,e,t){var R,w,P,y;if(this._getEditorObject()==null)return;function i(M){return Number.parseInt(M.replace("px",""))}const s=this.engine;if(!s)return;const l=s.getCanvasElement(),c=l.getBoundingClientRect(),d=i(l.style.width),{width:u}=c,h=u/d,{startX:g,startY:S,endX:p}=o,f=s.width,v=((w=(R=this._configService.getConfig(I.UI_PLUGIN_CONFIG_KEY))==null?void 0:R.footer)==null||w)&&((y=(P=this._configService.getConfig(Ee))==null?void 0:P.footer)==null||y)?Cl:0,C=document.body.clientHeight-S-v-e.top-oa*2;let _=u-g;if(t===a.HorizontalAlign.CENTER){const M=f-p,x=g;_=p-g+Math.min(x,M)*2}else t===a.HorizontalAlign.RIGHT&&(_=p);return{height:C,width:_-oa,scaleAdjust:h}}_editAreaProcessing(o,e,t,r,i,s=1,l=1,c,d){var k;const u=this._getEditorObject();if(u==null)return;const h=this.engine;if(!h)return;const g=h.getCanvasElement();let{startX:S,startY:p}=t;const{document:f,scene:v,engine:C}=u,_=v.getViewport(J.VIEWPORT_KEY.VIEW_MAIN),R=this._getEditorMaxSize(t,r,c),{height:w,width:P,scaleAdjust:y}=R;let M=e,x=_==null?void 0:_.getScrollBar();M>w?(x==null?_&&new T.ScrollBar(_,{enableHorizontal:!1,barSize:8}):_==null||_.resetCanvasSizeAndUpdateScroll(),_==null||_.scrollToViewportPos({viewportScrollY:M-w}),M=w):(x=null,(k=_==null?void 0:_.getScrollBar())==null||k.dispose()),o+=(x==null?void 0:x.barSize)||0,o>P&&(o=P),this._addBackground(v,o/s,e/l,i);const{scaleX:A,scaleY:D}=v.getPrecisionScale();v.transformByState({width:o*y/s,height:e*y/l,scaleX:s*y,scaleY:l*y}),f.resize(o*y/s,e*y/l),setTimeout(()=>{C.resizeBySize(T.fixLineWidthByScale(o,A),T.fixLineWidthByScale(M,D)),d==null||d()},0);const N=this._layoutService.getContentElement().getBoundingClientRect(),V=g.getBoundingClientRect();S=S*y+(V.left-N.left),p=p*y+(V.top-N.top);const H=t.endX-t.startX;c===a.HorizontalAlign.RIGHT?S+=(H-o)*y:c===a.HorizontalAlign.CENTER&&(S+=(H-o*y)/2),this._cellEditorManagerService.setState({startX:S,startY:p,endX:o*y+S,endY:M*y+p,show:!0})}_addBackground(o,e,t,r){const i="_backgroundRectHelperColor_",s=o.getObject(i);s==null&&r==null||(s==null?o.addObjects([new T.Rect(i,{width:e,height:t,fill:r,evented:!1})],J.DOCS_COMPONENT_MAIN_LAYER_INDEX):r==null?s.dispose():(s.setProps({fill:r}),s.transformByState({width:e,height:t})))}resizeCellEditor(o){var y,M;const e=this._cellEditorManagerService.getState();if(!e||!this._editorBridgeService.isVisible().visible)return;this._editorBridgeService.refreshEditCellPosition(!0);const t=this._editorBridgeService.getEditCellState();if(!t)return;const r=(M=(y=this._sheetSkeletonManagerService)==null?void 0:y.getSkeletonParam(t.sheetId))==null?void 0:M.skeleton;if(!r)return;const{row:i,column:s,scaleX:l,scaleY:c,position:d,canvasOffset:u,documentLayoutObject:h}=t,{horizontalAlign:g}=h,S=this._getEditorMaxSize(d,u,g);if(!S)return;const{height:p,width:f,scaleAdjust:v}=S,C=r.getCellWithCoordByIndex(i,s),_=Math.min((C.mergeInfo.endY-C.mergeInfo.startY)*c,p)*v,R=Math.min((C.mergeInfo.endX-C.mergeInfo.startX)*l,f)*v,w=e.endY-e.startY,P=e.endX-e.startX;if(w!==_||P!==R){if(this._editorBridgeService.refreshEditCellPosition(!0),!this._getEditorSkeleton())return;this.fitTextSize(o)}}_getEditorObject(){return To(this._editorBridgeService.getCurrentEditorId(),this._renderManagerService)}_getEditorSkeleton(){var o;return(o=this._renderManagerService.getRenderById(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY))==null?void 0:o.with(ve.DocSkeletonManagerService).getSkeleton()}};exports.SheetCellEditorResizeService=cm([$t(0,I.ILayoutService),$t(1,Hn),$t(2,he),$t(3,T.IRenderManagerService),$t(4,a.IUniverInstanceService),$t(5,a.IConfigService)],exports.SheetCellEditorResizeService);var dm=Object.getOwnPropertyDescriptor,um=(n,o,e,t)=>{for(var r=t>1?void 0:t?dm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},bt=(n,o)=>(e,t)=>o(e,t,n);let ar=class extends a.RxDisposable{constructor(o,e,t,r,i,s,l,c){super();E(this,"_d");this._context=o,this._instanceSrv=e,this._commandService=t,this._editorBridgeService=r,this._selectionManagerService=i,this._contextService=s,this._renderManagerService=l,this._sheetSkeletonManagerService=c,this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(d=>{d&&d.getUnitId()===this._context.unitId?this._d=this._init():this._disposeCurrent()}))}_init(){const o=new a.DisposableCollection;return this._initSelectionChangeListener(o),this._initEventListener(o),this._commandExecutedListener(o),this._initialKeyboardListener(o),o}_disposeCurrent(){var o;(o=this._d)==null||o.dispose(),this._d=null}_initSelectionChangeListener(o){o.add(O.merge(this._selectionManagerService.selectionMoveEnd$,this._selectionManagerService.selectionSet$,this._selectionManagerService.selectionMoveStart$).subscribe(e=>this._updateEditorPosition(e)))}_updateEditorPosition(o){var t,r,i;if(this._editorBridgeService.isVisible().visible)return;const e=(t=o==null?void 0:o[o.length-1])==null?void 0:t.primary;if(e){const s=this._getSheetObject(),{scene:l,engine:c}=s,d=this._context.unitId,u=(r=this._context.unit.getActiveSheet())==null?void 0:r.getSheetId();if(!u)return;const h=(i=this._sheetSkeletonManagerService.getSkeletonParam(u))==null?void 0:i.skeleton.getCellWithCoordByIndex(e.actualRow,e.actualColumn),g=h?{actualRow:h.actualRow,actualColumn:h.actualColumn,isMerged:h.isMerged,startRow:h.mergeInfo.startRow,startColumn:h.mergeInfo.startColumn,endRow:h.mergeInfo.endRow,endColumn:h.mergeInfo.endColumn,isMergedMainCell:h.isMergedMainCell}:e;this._commandService.executeCommand(No.id,{scene:l,engine:c,primary:g,unitId:d,sheetId:u})}}refreshEditorPosition(){const o=this._selectionManagerService.getWorkbookSelections(this._context.unitId);if(o){const e=o.getCurrentSelections();e&&this._updateEditorPosition([...e])}}_initEventListener(o){const e=this._getSheetObject(),{spreadsheet:t,spreadsheetColumnHeader:r,spreadsheetLeftTopPlaceholder:i,spreadsheetRowHeader:s}=e;o.add(t.onDblclick$.subscribeEvent(l=>{l.button!==2&&this._commandService.executeCommand(Se.id,{visible:!0,eventType:T.DeviceInputEventType.Dblclick,unitId:this._context.unitId})})),o.add(t.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),o.add(r.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),o.add(i.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1})),o.add(s.onPointerDown$.subscribeEvent({next:this._tryHideEditor.bind(this),priority:-1}))}_initialKeyboardListener(o){let e=null;const t=i=>{const s=i.with(J.DocSelectionRenderService);s&&(e=a.toDisposable(s.onInputBefore$.subscribe(l=>{if(!this._isCurrentSheetFocused())return;const c=this._contextService.getContextValue(a.FOCUSING_FX_BAR_EDITOR),d=this._contextService.getContextValue(a.FOCUSING_SHEET),u=i.unitId;this._editorBridgeService.isVisible().visible||u&&d&&!c&&this._showEditorByKeyboard(l)})),o.add(e))},r=this._renderManagerService.getRenderById(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY);r?t(r):this.disposeWithMe(this._renderManagerService.created$.pipe(O.filter(i=>i.unitId===a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY)).subscribe(i=>{e==null||e.dispose(),t(i)}))}_commandExecutedListener(o){const e=new Set([m.ClearSelectionFormatCommand.id,kn.id]);o.add(this._commandService.onCommandExecuted(t=>{if(e.has(t.id)){if(this._editorBridgeService.isVisible().visible)return;this._editorBridgeService.refreshEditCellState()}if(t.id===m.SetRangeValuesMutation.id){const r=t.params,{cellValue:i,unitId:s,subUnitId:l}=r;if(!i)return;const c=this._editorBridgeService.getEditLocation();if(c){const{unitId:d,sheetId:u,row:h,column:g}=c;s===d&&l===u&&i&&i[h]&&Object.prototype.hasOwnProperty.call(i[h],g)&&this._editorBridgeService.refreshEditCellState()}}})),o.add(this._commandService.beforeCommandExecuted((t,r)=>{r!=null&&r.fromCollab||t.id===m.SetWorksheetActiveOperation.id&&this._tryHideEditor()}))}_showEditorByKeyboard(o){const e=o==null?void 0:o.event;o==null||!e.data&&e.inputType!=="InsertParagraph"||this._commandService.syncExecuteCommand(Se.id,{visible:!0,eventType:T.DeviceInputEventType.Keyboard,keycode:e.which,unitId:this._context.unitId})}_tryHideEditor(){this._editorBridgeService.isForceKeepVisible()||this._hideEditor()}_hideEditor(){this._editorBridgeService.isVisible().visible===!0&&this._commandService.syncExecuteCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.PointerDown,unitId:this._context.unitId})}_getSheetObject(){return Ne(this._context.unit,this._context)}_isCurrentSheetFocused(){var o;return((o=this._instanceSrv.getFocusedUnit())==null?void 0:o.getUnitId())===this._context.unitId}};ar=um([bt(1,a.IUniverInstanceService),bt(2,a.ICommandService),bt(3,he),bt(4,a.Inject(m.SheetsSelectionsService)),bt(5,a.IContextService),bt(6,T.IRenderManagerService),bt(7,a.Inject(exports.SheetSkeletonManagerService))],ar);const Rl=[I.KeyCode.ARROW_DOWN,I.KeyCode.ARROW_UP,I.KeyCode.ARROW_LEFT,I.KeyCode.ARROW_RIGHT],hm=[I.KeyCode.ENTER,I.KeyCode.TAB,...Rl];function wl(){const n=[];for(const o of Rl)n.push({id:Wt.id,binding:o,preconditions:e=>gn(e),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:o,isShift:!1}}),n.push({id:Wt.id,binding:o|I.MetaKeys.SHIFT,preconditions:e=>gn(e),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:o,isShift:!0}});return n}const El={id:Or.id,binding:I.KeyCode.F2,description:"shortcut.sheet.start-editing",group:"4_sheet-edit",preconditions:se,staticParameters:{visible:!0,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.F2}},Tl={id:Se.id,binding:I.KeyCode.ENTER,description:"shortcut.sheet.toggle-editing",group:"4_sheet-edit",preconditions:n=>gn(n),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.ENTER}},yl={id:Se.id,binding:I.KeyCode.TAB,preconditions:n=>gn(n),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.TAB}},Ml={id:Se.id,binding:I.KeyCode.ESC,description:"shortcut.sheet.abort-editing",group:"4_sheet-edit",preconditions:n=>gn(n),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.ESC}},Pl={id:Se.id,binding:I.KeyCode.ENTER|I.MetaKeys.CTRL_COMMAND,mac:I.KeyCode.ENTER|I.MetaKeys.MAC_CTRL,preconditions:n=>gn(n),staticParameters:{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.ENTER|I.MetaKeys.CTRL_COMMAND}},xl={id:J.BreakLineCommand.id,description:"shortcut.sheet.break-line",group:"4_sheet-edit",preconditions:n=>zd(n),binding:I.KeyCode.ENTER|I.MetaKeys.ALT},Ol={id:J.DeleteLeftCommand.id,preconditions:n=>Gi(n)||Po(n),binding:I.KeyCode.BACKSPACE},Al={id:J.DeleteRightCommand.id,preconditions:n=>Gi(n)||Po(n),binding:I.KeyCode.DELETE},Dl={id:J.DeleteLeftCommand.id,preconditions:n=>Gi(n)||Po(n),binding:I.KeyCode.BACKSPACE|I.MetaKeys.SHIFT},Nl={id:Se.id,description:"shortcut.sheet.delete-and-start-editing",group:"4_sheet-edit",preconditions:n=>se(n)&&!Po(n),binding:I.KeyCode.BACKSPACE,staticParameters:{visible:!0,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.BACKSPACE}};function mm(n){return n.startsWith("'")}function gm(n){return n.slice(1)}const Sm={"":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9",:"A",:"B",:"C",:"D",:"E",:"F",:"G",:"H",:"I",:"J",:"K",:"L",:"M",:"N",:"O",:"P",:"Q",:"R",:"S",:"T",:"U",:"V",:"W",:"X",:"Y",:"Z",:"a",:"b",:"c",:"d",:"e",:"f",:"g",:"h",:"i",:"j",:"k",:"l",:"m",:"n",:"o",:"p",:"q",:"r",:"s",:"t",:"u",:"v",:"w",:"x",:"y",:"z","":"%","":"-","":".","":":","":"/","":"+","":"@","":"&","":"*","":"#","":"=","":">","":"<","":"$","":'"',"":"'","":"(","":")","":" ","":",","":"!","":"?","":";","":"[","":"]","":"{","":"}"},Ai={true:"TRUE",false:"FALSE"};function pm(n){return[a.LocaleType.ZH_CN,a.LocaleType.ZH_TW].includes(n)}function fm(n,o,e,t){let r=n;if(pm(e)){if(n.startsWith("")||n.startsWith("'"))return`'${n.slice(1)}`;r=vm(r)}if(r.startsWith("="))return Cm(n,r,o,t);const i=r.toLowerCase();return Ai[i]?Ai[i]:a.numfmt.parseValue(r)==null?n:r}function vm(n){const o=/['"].*?['"]/g,e=[],t=n.split(o);n.replace(o,i=>(e.push(i),""));let r=t.join("").split("").map(bm).join("");return e.forEach((i,s)=>{r=r.slice(0,s*2)+i+r.slice((s+1)*2)}),r}function Cm(n,o,e,t){const r=e.sequenceNodesBuilder(o);if(!r)return n;let i=o,s=0;return r.forEach((l,c)=>{if(typeof l=="object"){const d=l.token;if(Ai[d.toLowerCase()]){const u=l.startIndex+s+1,h=l.endIndex+s+2;i=en(d.toLocaleUpperCase(),i,u,h)}else if(l.nodeType===G.sequenceNodeType.FUNCTION&&Im(d,t,r,c)||l.nodeType===G.sequenceNodeType.REFERENCE){const u=d.indexOf("!");if(u>-1){const h=d.substring(u+1),g=l.startIndex+s+(u+1)+1,S=l.endIndex+s+2;i=en(h.toLocaleUpperCase(),i,g,S)}else{const h=l.startIndex+s+1,g=l.endIndex+s+2;i=en(d.toLocaleUpperCase(),i,h,g)}}else if(d.startsWith('"')&&d.endsWith('"')||d.startsWith("'")&&d.endsWith("'")){const u=l.startIndex+s+2,h=l.endIndex+s+1;i=en(n.slice(u,h),i,u,h)}else if(l.nodeType!==G.sequenceNodeType.ARRAY){const u=a.numfmt.parseValue(d);if(u==null){const h=l.startIndex+s+1,g=l.endIndex+s+2;i=en(n.slice(h,g),i,h,g)}else if(typeof u.v=="number"&&(u.z===void 0||!a.numfmt.getFormatInfo(u.z).isDate)){const h=`${u.v}`,g=l.startIndex+s+1,S=l.endIndex+s+2,{processedString:p,offset:f}=Rm(d,h);i=en(p,i,g,S),s+=f}}}}),i}function Im(n,o,e,t){const r=o.getDescriptions();return e[t+1]!==G.matchToken.OPEN_BRACKET?!1:r.get(_m(n).toLocaleUpperCase())!==void 0}function _m(n){const o=/^@+/;return n.replace(o,"")}function bm(n){return Sm[n]||n}function en(n,o,e,t){return o.substring(0,e)+n+o.substring(t)}function Rm(n,o){var s,l;const e=((s=n.match(/^\s*/))==null?void 0:s[0])||"",t=((l=n.match(/\s*$/))==null?void 0:l[0])||"",r=e+o+t,i=r.length-n.length;return{processedString:r,offset:i}}const kl="range_selector",Hl=n=>n.includes(kl);var wm=Object.getOwnPropertyDescriptor,Em=(n,o,e,t)=>{for(var r=t>1?void 0:t?wm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},we=(n,o)=>(e,t)=>o(e,t,n);const ia=-1e3;exports.EditingRenderController=class extends a.Disposable{constructor(e,t,r,i,s,l,c,d,u,h,g,S,p,f,v){super();E(this,"_cursorChange",0);E(this,"_editingUnit","");E(this,"_cursorTimeout");this._undoRedoService=e,this._contextService=t,this._renderManagerService=r,this._editorBridgeService=i,this._cellEditorManagerService=s,this._lexerTreeBuilder=l,this._functionService=c,this._textSelectionManagerService=d,this._commandService=u,this._localService=h,this._editorService=g,this._univerInstanceService=S,this._sheetInterceptorService=p,this._sheetCellEditorResizeService=f,this._selectionManagerService=v,this.disposeWithMe(this._init()),this._initEditorVisibilityListener()}dispose(){super.dispose()}get _workbookSelections(){return this._selectionManagerService.getWorkbookSelections(this._editingUnit)}_init(){const e=new a.DisposableCollection;return this._subscribeToCurrentCell(e),this._initialCursorSync(e),this._listenEditorFocus(e),this._commandExecutedListener(e),this._initSkeletonListener(e),e.add(()=>{clearTimeout(this._cursorTimeout)}),this._cursorTimeout=setTimeout(()=>{this._cursorStateListener(e)},1e3),e}_initEditorVisibilityListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(async e=>{var t;if(this._editingUnit&&(e==null?void 0:e.getUnitId())!==this._editingUnit&&!this._editorBridgeService.isForceKeepVisible()){this._commandService.syncExecuteCommand(Se.id,{visible:!1,eventType:T.DeviceInputEventType.Keyboard,keycode:I.KeyCode.ESC,unitId:this._editingUnit});const r=(t=this._renderManagerService.getRenderById(e.getUnitId()))==null?void 0:t.with(ar);r&&r.refreshEditorPosition()}})),this.disposeWithMe(this._editorBridgeService.visible$.pipe(O.distinctUntilChanged((e,t)=>e.visible===t.visible)).subscribe(async e=>{e.visible?(this._editingUnit=e.unitId,this._handleEditorVisible(e)):this._editingUnit&&(await this._handleEditorInvisible(e),this._editingUnit="")}))}_listenEditorFocus(e){const t=this._getEditorObject();t&&e.add(t.document.onPointerDown$.subscribeEvent(()=>{var r;if(this._editingUnit&&this._editorBridgeService.isVisible()){const i=this._editorBridgeService.getEditCellState(),s=this._editorBridgeService.getCurrentEditorId();if(!i||!s)return;(r=this._sheetCellEditorResizeService)==null||r.fitTextSize()}}))}_initialCursorSync(e){e.add(this._cellEditorManagerService.focus$.pipe(O.filter(t=>!!t)).subscribe(()=>{var i;const t=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_DOC);if(!t)return;const r=(i=this._renderManagerService.getRenderById(t==null?void 0:t.getUnitId()))==null?void 0:i.with(J.DocSelectionRenderService);r&&r.sync()}))}_initSkeletonListener(e){const t=new Set(m.COMMAND_LISTENER_SKELETON_CHANGE);t.delete(m.SetWorksheetActiveOperation.id),e.add(this._commandService.onCommandExecuted(r=>{var i;if(t.has(r.id)){switch(r.id){case m.MoveRowsMutation.id:case m.MoveColsMutation.id:case m.RemoveColMutation.id:case m.RemoveRowMutation.id:case m.InsertColMutation.id:case m.InsertRowMutation.id:{const s=this._editorBridgeService.getEditLocation();if(!s)break;const l={startRow:s.row,startColumn:s.column,endRow:s.row,endColumn:s.column},c=m.adjustRangeOnMutation(l,r);if(!c)break;const d=c.startRow,u=c.startColumn;this._editorBridgeService.updateEditLocation(d,u);break}}(i=this._sheetCellEditorResizeService)==null||i.resizeCellEditor(()=>{this._textSelectionManagerService.refreshSelection({unitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY})})}}))}_subscribeToCurrentCell(e){e.add(this._editorBridgeService.currentEditCellState$.subscribe(t=>{var _,R;if(t==null||this._editorBridgeService.isForceKeepVisible())return;const r=this._editorBridgeService.getEditCellState();if(r==null)return;const{position:i,documentLayoutObject:s,scaleX:l,editorUnitId:c}=r;if(this._contextService.getContextValue(a.FOCUSING_EDITOR_STANDALONE))return;const d=this._getDocumentDataModel();if(d==null)return;const{startX:u,endX:h}=i,{textRotation:g,wrapStrategy:S,documentModel:p}=s,{vertexAngle:f}=T.convertTextRotation(g);S===a.WrapStrategy.WRAP&&f===0&&d.updateDocumentDataPageSize((h-u)/l),this._commandService.syncExecuteCommand(J.ReplaceSnapshotCommand.id,{unitId:c,snapshot:p.getSnapshot()}),this._contextService.setContextValue(a.FOCUSING_EDITOR_BUT_HIDDEN,!0),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}],{unitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY});const v=(_=this._renderManagerService.getRenderById(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY))==null?void 0:_.with(J.DocSelectionRenderService),C=(R=this._renderManagerService.getRenderById(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY))==null?void 0:R.with(J.DocSelectionRenderService);(v!=null&&v.canFocusing||C!=null&&C.canFocusing)&&(this._univerInstanceService.setCurrentUnitForType(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY),v==null||v.activate(ia,ia,!0))}))}_commandExecutedListener(e){e.add(this._commandService.onCommandExecuted(r=>{var i;if(r.id===ve.RichTextEditingMutation.id){const s=r.params,{unitId:l}=s;if(Hl(l)||(this._editorBridgeService.changeEditorDirty(!0),!this._editorBridgeService.isVisible().visible))return;l===a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY&&((i=this._sheetCellEditorResizeService)==null||i.fitTextSize())}}));const t=[Wt.id];e.add(this._commandService.onCommandExecuted(r=>{if(t.includes(r.id)){const i=r.params,{keycode:s,isShift:l}=i;if(s!=null&&(this._cursorChange===2||this._contextService.getContextValue(a.FOCUSING_FX_BAR_EDITOR))){this._moveInEditor(s,l);return}this._commandService.syncExecuteCommand(Se.id,i)}r.id===Or.id&&(this._cursorChange=2)}))}_handleEditorVisible(e){var p,f,v,C;const{eventType:t,keycode:r}=e;this._cursorChange=t===T.DeviceInputEventType.PointerDown||t===T.DeviceInputEventType.Dblclick?2:1;const i=this._editorBridgeService.getEditLocation();if(i==null)return;this._commandService.syncExecuteCommand(ko.id,{range:{startRow:i.row,startColumn:i.column,endRow:i.row,endColumn:i.column}}),this._editorBridgeService.refreshEditCellPosition(!1);const{unitId:s,isInArrayFormulaRange:l=!1}=i,c=this._getEditorObject();if(c==null)return;const{document:d,scene:u}=c;this._contextService.setContextValue(a.EDITOR_ACTIVATED,!0);const h=this._getDocumentDataModel(),g=this._getEditorSkeleton(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY);if(!g||!h)return;(p=this._sheetCellEditorResizeService)==null||p.fitTextSize(()=>{const _=u.getViewport(J.VIEWPORT_KEY.VIEW_MAIN);_==null||_.scrollToViewportPos({viewportScrollX:Number.POSITIVE_INFINITY,viewportScrollY:Number.POSITIVE_INFINITY})});const S=()=>{this._emptyDocumentDataModel(h.getSnapshot().documentStyle,!!l),d.makeDirty(),(r===I.KeyCode.BACKSPACE||t===T.DeviceInputEventType.Dblclick)&&(g.calculate(),this._editorBridgeService.changeEditorDirty(!0)),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}],{unitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY})};if(this._isCellImageData(h.getSnapshot()))S();else if(t===T.DeviceInputEventType.Keyboard&&r===I.KeyCode.F2){d.makeDirty(),this._textSelectionManagerService.replaceDocRanges([{startOffset:0,endOffset:0}]);const _=((v=(f=h.getBody())==null?void 0:f.dataStream.length)!=null?v:2)-2;this._textSelectionManagerService.replaceDocRanges([{startOffset:_,endOffset:_}],{unitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY})}else if(t===T.DeviceInputEventType.Keyboard||t===T.DeviceInputEventType.Dblclick&&l)S();else if(t===T.DeviceInputEventType.Dblclick){if(this._contextService.getContextValue(a.FOCUSING_EDITOR_INPUT_FORMULA))return;const _=h.getBody().dataStream.length-2||0;this._textSelectionManagerService.replaceDocRanges([{startOffset:_,endOffset:_}])}(C=this._renderManagerService.getRenderById(s))==null||C.scene.resetCursor()}_refreshCurrentSelections(e){const t=this._workbookSelections.getSelectionsOfWorksheet(e);t&&(this._contextService.setContextValue(m.REF_SELECTIONS_ENABLED,!1),this._commandService.syncExecuteCommand(m.SetSelectionsOperation.id,{unitId:this._editingUnit,subUnitId:e,selections:t}))}async _handleEditorInvisible(e){var v,C;const t=this._editorBridgeService.getEditCellState(),r=this._univerInstanceService.getUnit(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY),i=a.Tools.deepClone(r==null?void 0:r.getSnapshot()),{keycode:s}=e;this._cursorChange=0;const l=(v=t==null?void 0:t.unitId)!=null?v:"";if(this._exitInput(e),t==null)return;const c=this._univerInstanceService.getUnit(l,a.UniverInstanceType.UNIVER_SHEET);if(!c)return;const d=c.getActiveSheet(),u=c.getUnitId(),h=d.getSheetId(),{unitId:g,sheetId:S}=t;if(u===g&&S!==h&&await this._commandService.executeCommand(m.SetWorksheetActivateCommand.id,{subUnitId:S,unitId:g}),s===I.KeyCode.ESC){this._editorBridgeService.isForceKeepVisible()&&this._editorBridgeService.disableForceKeepVisible(),this._refreshCurrentSelections(S);return}const p=((C=i==null?void 0:i.body)==null?void 0:C.dataStream.length)===2,f=t.documentLayoutObject.documentModel?this._isCellImageData(t.documentLayoutObject.documentModel.getSnapshot()):!1;i&&!(p&&f)&&await this._submitEdit(i,s===(I.MetaKeys.CTRL_COMMAND|I.KeyCode.ENTER)||s===(I.MetaKeys.MAC_CTRL|I.KeyCode.ENTER))===!1||s!==void 0&&this._moveSelection(s,l,h)}_getEditorObject(){return To(this._editorBridgeService.getCurrentEditorId(),this._renderManagerService)}_isCellImageData(e){var r,i;return((i=(r=e.drawingsOrder)==null?void 0:r.length)!=null?i:0)>0}submitCellData(e){return this._submitEdit(e.getSnapshot())}async _submitEdit(e,t=!1){var C;const r=this._editorBridgeService.getEditCellState();if(r==null)return!0;const{unitId:i,sheetId:s,row:l,column:c}=r,d=this._univerInstanceService.getUnit(i,a.UniverInstanceType.UNIVER_SHEET);if(!d)return!0;let u=d.getActiveSheet();if(!d.getSheetBySheetId(s))return!0;u=d.getActiveSheet();const g=Tm({...u.getCellRaw(l,c)||{}},e,this._lexerTreeBuilder,this._localService,this._functionService,d.getStyles());if(!g)return!0;this._removeComposedCellStyleInCellData(g,u.getComposedCellStyle(l,c));const S=this._sheetInterceptorService.onWriteCell(d,u,l,c,g);if(a.Tools.diffValue(aa(S),aa(u.getCellRaw(l,c))))return!0;const p=t?(C=this._workbookSelections.getCurrentLastSelection())==null?void 0:C.range:{startRow:l,startColumn:c,endRow:l,endColumn:c},f=a.generateRandomId(6);return this._commandService.syncExecuteCommand(m.SetRangeValuesCommand.id,{subUnitId:s,unitId:i,range:p,value:S,redoUndoId:f})&&await this._sheetInterceptorService.onValidateCell(d,u,l,c)===!1?(this._undoRedoService.rollback(f,i),!1):!0}_removeComposedCellStyleInCellData(e,t){if(!e.s||typeof e.s=="string")return;const r=Object.keys(e.s);for(const i of r)t[i]!==void 0&&a.Tools.diffValue(e.s[i],t[i])&&delete e.s[i]}_exitInput(e){var i,s;this._contextService.setContextValue(a.FOCUSING_EDITOR_INPUT_FORMULA,!1),this._contextService.setContextValue(a.EDITOR_ACTIVATED,!1),this._contextService.setContextValue(a.FOCUSING_EDITOR_BUT_HIDDEN,!1),this._contextService.setContextValue(a.FOCUSING_FX_BAR_EDITOR,!1),this._cellEditorManagerService.setState({show:e.visible});const t=this._getEditorObject();(i=t==null?void 0:t.scene.getViewport(J.VIEWPORT_KEY.VIEW_MAIN))==null||i.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});const r=this._editorBridgeService.getCurrentEditorId();r==null||!this._editorService.isSheetEditor(r)||(r===a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY&&((s=this._getEditorSkeleton(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY))==null||s.resetInitialWidth()),this._undoRedoService.clearUndoRedo(r),this._undoRedoService.clearUndoRedo(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY))}_moveSelection(e,t,r){if(e==null||!hm.includes(e)){this._refreshCurrentSelections(r);return}let i=a.Direction.LEFT;switch(e){case I.KeyCode.ENTER:i=a.Direction.DOWN;break;case I.KeyCode.TAB:i=a.Direction.RIGHT;break;case I.KeyCode.ARROW_DOWN:i=a.Direction.DOWN;break;case I.KeyCode.ARROW_UP:i=a.Direction.UP;break;case I.KeyCode.ARROW_LEFT:i=a.Direction.LEFT;break;case I.KeyCode.ARROW_RIGHT:i=a.Direction.RIGHT;break}const s=this._univerInstanceService.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET);t&&(s==null?void 0:s.getUnitId())!==t&&this._univerInstanceService.setCurrentUnitForType(t),e===I.KeyCode.ENTER||e===I.KeyCode.TAB?this._commandService.executeCommand(Ze.id,{keycode:e,direction:i}):this._commandService.executeCommand(Me.id,{direction:i})}_cursorStateListener(e){const t=this._getEditorObject();if(!(t!=null&&t.document))return;const{document:r}=t;e.add(a.toDisposable(r.onPointerDown$.subscribeEvent(()=>{this._cursorChange===1&&(this._cursorChange=2)})))}_moveInEditor(e,t){let r=a.Direction.LEFT;e===I.KeyCode.ARROW_DOWN?r=a.Direction.DOWN:e===I.KeyCode.ARROW_UP?r=a.Direction.UP:e===I.KeyCode.ARROW_RIGHT&&(r=a.Direction.RIGHT),t?this._commandService.executeCommand(J.MoveSelectionOperation.id,{direction:r}):this._commandService.executeCommand(J.MoveCursorOperation.id,{direction:r})}_getDocumentDataModel(){return this._univerInstanceService.getUnit(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.UniverInstanceType.UNIVER_DOC)}_getEditorSkeleton(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(ve.DocSkeletonManagerService).getSkeleton()}_getEditorViewModel(e){var t;return(t=this._renderManagerService.getRenderById(e))==null?void 0:t.with(ve.DocSkeletonManagerService).getViewModel()}_getEditingUnit(){return this._editingUnit?this._univerInstanceService.getUnit(this._editingUnit,a.UniverInstanceType.UNIVER_SHEET):null}_emptyDocumentDataModel(e,t){const r=(l,c)=>{const d=a.Tools.deepClone(l.getSnapshot()),u=this._getEditorViewModel(l.getUnitId());u!=null&&(ym(d.body,t),c&&(d.documentStyle=e),d.drawings={},d.drawingsOrder=[],l.reset(d),u.reset(l))},i=this._getDocumentDataModel();i&&r(i,!0);const s=this._univerInstanceService.getUnit(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,a.UniverInstanceType.UNIVER_DOC);s&&r(s)}};exports.EditingRenderController=Em([we(0,a.IUndoRedoService),we(1,a.IContextService),we(2,T.IRenderManagerService),we(3,he),we(4,Hn),we(5,a.Inject(G.LexerTreeBuilder)),we(6,G.IFunctionService),we(7,a.Inject(ve.DocSelectionManagerService)),we(8,a.ICommandService),we(9,a.Inject(a.LocaleService)),we(10,J.IEditorService),we(11,a.IUniverInstanceService),we(12,a.Inject(m.SheetInterceptorService)),we(13,a.Inject(exports.SheetCellEditorResizeService)),we(14,a.Inject(m.SheetsSelectionsService))],exports.EditingRenderController);function Tm(n,o,e,t,r,i){var h,g,S;if((o==null?void 0:o.body)==null)return null;const{body:s}=o;n.t=void 0;const l=s.dataStream;let d=l.substring(l.length-2,l.length)===a.DEFAULT_EMPTY_DOCUMENT_VALUE?l.substring(0,l.length-2):l;const u=t.getCurrentLocale();if(d=fm(d,e,u,r),(h=o.drawingsOrder)!=null&&h.length)n.v="",n.f=null,n.si=null,n.p=o,n.t=a.CellValueType.STRING;else if(n.s&&a.isTextFormat((S=(g=i==null?void 0:i.get(n.s))==null?void 0:g.n)==null?void 0:S.pattern)){n.v=d,n.f=null,n.si=null,n.p=null,n.t=a.CellValueType.STRING,Di(s)&&s.dataStream!==`\r
`&&(n.p=o);const p=sa(o);p&&(n.s=p)}else if(a.isFormulaString(d)){if(n.f===d)return null;const p=e.checkIfAddBracket(d);for(let f=0;f<p;f++)d+=G.matchToken.CLOSE_BRACKET;n.f=d,n.si=null,n.v=null,n.p=null}else if(mm(d)){const p=gm(d);n.v=p,n.f=null,n.si=null,n.p=null,n.t=a.CellValueType.FORCE_STRING}else if(Di(s))s.dataStream===`\r
`?(n.v="",n.f=null,n.si=null,n.p=null):(n.p=o,n.v=null,n.f=null,n.si=null);else{if(d===""&&n.v==null&&n.p==null)return null;n.v=d,n.f=null,n.si=null,n.p=null;const p=sa(o);p&&(n.s=p)}return n}function Di(n){const{textRuns:o=[],paragraphs:e=[],customRanges:t,customBlocks:r=[]}=n,i=n.dataStream.replace(/(\r\n)+$/,""),s=["va"];return o.filter(l=>l.st<i.length).some(l=>{var d;return!!(l.ts&&Object.keys(l.ts).some(u=>s.includes(u)))||Object.keys((d=l.ts)!=null?d:{}).length&&l.ed-l.st<i.length})||e.some(l=>l.bullet)||e.length>=2||!!(t!=null&&t.length)||r.length>0}function sa(n){const{body:o}=n;if(!o)return null;const{textRuns:e=[]}=o;let t={};const r=o.dataStream.replace(`\r
`,"");return e.forEach(i=>{const{st:s,ed:l,ts:c}=i;l-s>=r.length&&(t={...t,...c})}),Object.keys(t).length?t:null}function ym(n,o=!1){n.dataStream=a.DEFAULT_EMPTY_DOCUMENT_VALUE,n.textRuns!=null&&(n.textRuns.length===1&&!o?(n.textRuns[0].st=0,n.textRuns[0].ed=1):n.textRuns=void 0),n.paragraphs!=null&&(n.paragraphs=[{startIndex:0}]),n.sectionBreaks!=null&&(n.sectionBreaks=void 0),n.tables!=null&&(n.tables=void 0),n.customRanges!=null&&(n.customRanges=void 0),n.customBlocks!=null&&(n.customBlocks=void 0)}function aa(n){return n&&Object.fromEntries(Object.entries(n).filter(([o,e])=>!(e==null||Array.isArray(e)&&e.length===0||typeof e=="object"&&Object.keys(e).length===0)))}var Mm=Object.getOwnPropertyDescriptor,Pm=(n,o,e,t)=>{for(var r=t>1?void 0:t?Mm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ke=(n,o)=>(e,t)=>o(e,t,n);exports.FormulaEditorController=class extends a.RxDisposable{constructor(e,t,r,i,s,l,c,d,u){super();E(this,"_loadedMap",new WeakSet);E(this,"_scheduledCallback",-1);this._univerInstanceService=e,this._renderManagerService=t,this._editorBridgeService=r,this._commandService=i,this._contextService=s,this._formulaEditorManagerService=l,this._undoRedoService=c,this._textSelectionManagerService=d,this._editorService=u,this._initialize()}_initialize(){this._syncEditorSize(),this._listenFxBtnClick(),this._handleContentChange(),this._univerInstanceService.focused$.pipe(O.takeUntil(this.dispose$)).subscribe(e=>{this._create(e)}),this._create(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY),this.disposeWithMe(this._editorService.focus$.subscribe(()=>{var t;((t=this._editorService.getFocusEditor())==null?void 0:t.getEditorId())!==a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY?this._contextService.setContextValue(a.FOCUSING_FX_BAR_EDITOR,!1):this._contextService.setContextValue(a.FOCUSING_FX_BAR_EDITOR,!0)}))}_handleContentChange(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===ve.RichTextEditingMutation.id){const t=e.params,{unitId:r}=t;r===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY&&this.autoScroll()}}))}_create(e){if(e!==a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)return;const t=this._renderManagerService.getRenderById(e);if(t==null)return;const{mainComponent:r}=t;r!=null&&(this._loadedMap.has(r)||this._loadedMap.add(r))}_listenFxBtnClick(){this._formulaEditorManagerService.fxBtnClick$.pipe(O.takeUntil(this.dispose$)).subscribe(()=>{var t;if(this._contextService.getContextValue(a.FOCUSING_EDITOR_BUT_HIDDEN)&&!this._contextService.getContextValue(a.EDITOR_ACTIVATED)){this._univerInstanceService.setCurrentUnitForType(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY);const r=this._univerInstanceService.getUniverDocInstance(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY);this._editorBridgeService.isVisible().visible===!1&&this._commandService.syncExecuteCommand(Se.id,{visible:!0,eventType:T.DeviceInputEventType.PointerDown,unitId:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY});const s=(t=r==null?void 0:r.getBody())==null?void 0:t.dataStream;if(s==null)return;let l=s.startsWith("=")?s:`=${s}`;l=l.replace(/\r\n$/,"");const c=[{startOffset:l.length,endOffset:l.length}],d={unitId:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,body:{dataStream:l},segmentId:"",textRanges:c};this._commandService.syncExecuteCommand(J.CoverContentCommand.id,d),requestAnimationFrame(()=>{this._textSelectionManagerService.replaceDocRanges([],{unitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY}),this._textSelectionManagerService.replaceDocRanges(c,{unitId:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,subUnitId:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY}),this._contextService.setContextValue(a.FOCUSING_FX_BAR_EDITOR,!0)})}})}_syncEditorSize(){const e=this._univerInstanceService.unitAdded$.pipe(O.filter(t=>t.getUnitId()===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY));this.disposeWithMe(O.combineLatest([this._formulaEditorManagerService.position$,e]).subscribe(([t])=>{if(!t)return this._clearScheduledCallback();const r=To(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,this._renderManagerService),i=this._univerInstanceService.getUniverDocInstance(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY);if(r==null||i==null)return this._clearScheduledCallback();const{width:s,height:l}=t;if(s===0||l===0)return this._clearScheduledCallback();const{engine:c}=r;i.updateDocumentDataPageSize(s),this.autoScroll(),this._scheduledCallback=requestIdleCallback(()=>c.resizeBySize(s,l))}))}_clearScheduledCallback(){this._scheduledCallback!==-1&&cancelIdleCallback(this._scheduledCallback),this._scheduledCallback=-1}autoScroll(){var f,v;const e=this._formulaEditorManagerService.getPosition(),t=(f=this._renderManagerService.getRenderById(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY))==null?void 0:f.with(ve.DocSkeletonManagerService).getSkeleton(),r=this._renderManagerService.getRenderById(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY),i=this._univerInstanceService.getUniverDocInstance(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY);if(t==null||e==null||r==null||i==null)return;const{marginTop:s=0,marginBottom:l=0}=i.getSnapshot().documentStyle,{scene:c,mainComponent:d}=r;let{actualHeight:u}=t.getActualSize();u+=s+l;const{width:h,height:g}=e,S=c.getViewport(J.VIEWPORT_KEY.VIEW_MAIN);let p=S==null?void 0:S.getScrollBar();c.transformByState({width:h,height:u}),d==null||d.resize(h,u),u>g?p==null?S&&new T.ScrollBar(S,{enableHorizontal:!1,barSize:8}):S==null||S.resetCanvasSizeAndUpdateScroll():(p=null,S==null||S.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0}),(v=S==null?void 0:S.getScrollBar())==null||v.dispose())}};exports.FormulaEditorController=Pm([Ke(0,a.IUniverInstanceService),Ke(1,T.IRenderManagerService),Ke(2,he),Ke(3,a.ICommandService),Ke(4,a.IContextService),Ke(5,Vn),Ke(6,a.IUndoRedoService),Ke(7,a.Inject(ve.DocSelectionManagerService)),Ke(8,J.IEditorService)],exports.FormulaEditorController);const Vl="embedding_formula_editor",xm=n=>n.includes(Vl),ps=(n,o)=>{var h,g,S,p,f;const t=o.findNodePositionByCharIndex(n.startOffset,!0,n.segmentId,-1),r=o.getSkeletonData();let i=n.endOffset;if(n.segmentId){const v=(f=Array.from((g=(h=r==null?void 0:r.skeFooters.get(n.segmentId))==null?void 0:h.values())!=null?g:[])[0])!=null?f:Array.from((p=(S=r==null?void 0:r.skeHeaders.get(n.segmentId))==null?void 0:S.values())!=null?p:[])[0];v&&(i=Math.min(v.ed,i))}const s=o.findNodePositionByCharIndex(i,!0,n.segmentId,-1);if(!s||!t)return;const l={docsLeft:0,docsTop:0,pageMarginLeft:0,pageMarginTop:0},c=new J.NodePositionConvertToCursor(l,o),{borderBoxPointGroup:d}=c.getRangePointData(t,s);return J.getLineBounding(d).map(v=>({top:v.top,bottom:v.bottom,left:v.left,right:v.right}))},Om=(n,o,e=-1)=>{const t=o.findPositionByGlyph(n,e);if(!t)return;const r={...t,isBack:!0},i={docsLeft:0,docsTop:0,pageMarginLeft:0,pageMarginTop:0},s=new J.NodePositionConvertToCursor(i,o),{borderBoxPointGroup:l}=s.getRangePointData(r,r),d=J.getLineBounding(l)[0];return{top:d.top,bottom:d.bottom,left:d.left,right:d.right}},Am=(n,o,e=0,t=0)=>{const r=ps({startOffset:o.startIndex,endOffset:o.endIndex+1},n);if(r)return{rects:r.map(i=>({top:i.top+t,bottom:i.bottom+t,left:i.left+e,right:i.right+e})),range:o}},Dm=(n,o,e=0,t=0)=>{var h,g,S;const r=n.findNodeByCharIndex(o.startIndex),i=r==null?void 0:r.parent,s=i==null?void 0:i.parent,l=s==null?void 0:s.parent,c=l==null?void 0:l.lines.find(p=>p.paragraphStart&&p.paragraphIndex===o.startIndex),d=(S=(g=(h=c==null?void 0:c.divides)==null?void 0:h[0])==null?void 0:g.glyphGroup)==null?void 0:S[0];if(!d||!d)return;const u=Om(d,n);if(u)return{rect:{top:u.top+t,bottom:u.bottom+t,left:u.left+e,right:u.right+e},segmentId:void 0,segmentPageIndex:-1,paragraph:o}},Wl=(n,o=0,e=0)=>{var l,c,d,u,h,g,S;const t=n.getViewModel().getDataModel(),r=(d=(c=(l=t.getBody())==null?void 0:l.customRanges)==null?void 0:c.filter(p=>p.rangeType===a.CustomRangeType.HYPERLINK))!=null?d:[],i=(g=(h=(u=t.getBody())==null?void 0:u.paragraphs)==null?void 0:h.filter(p=>{var f;return((f=p.bullet)==null?void 0:f.listType.indexOf(a.PresetListType.CHECK_LIST))===0}))!=null?g:[],s=(S=n.getSkeletonData())==null?void 0:S.pages[0].skeDrawings;return{links:r.map(p=>Am(n,p,o,e)).filter(Boolean),checkLists:i.map(p=>Dm(n,p,o,e)).filter(Boolean),drawings:s?Array.from(s.keys()).map(p=>({drawingId:p,rect:{top:s.get(p).aTop,bottom:s.get(p).aTop+s.get(p).width,left:s.get(p).aLeft,right:s.get(p).aLeft+s.get(p).height},drawing:s.get(p)})):[]}};function Ul(n,o,e){var d,u,h,g,S,p;const t=(h=(u=(d=o.documentSkeleton)==null?void 0:d.getSkeletonData())==null?void 0:u.pages[0].height)!=null?h:0,r=(p=(S=(g=o.documentSkeleton)==null?void 0:g.getSkeletonData())==null?void 0:S.pages[0].width)!=null?p:0,i=o.verticalAlign,s=o.horizontalAlign;let l=0;switch(i){case a.VerticalAlign.UNSPECIFIED:case a.VerticalAlign.BOTTOM:l=n.mergeInfo.endY-n.mergeInfo.startY-t;break;case a.VerticalAlign.MIDDLE:l=(n.mergeInfo.endY-n.mergeInfo.startY-t)/2;break}let c=0;switch(s){case a.HorizontalAlign.RIGHT:c=n.mergeInfo.endX-n.mergeInfo.startX-r;break;case a.HorizontalAlign.CENTER:c=(n.mergeInfo.endX-n.mergeInfo.startX-r)/2;break;case a.HorizontalAlign.UNSPECIFIED:{e&&(c=n.mergeInfo.endX-n.mergeInfo.startX-r);break}}return{paddingLeft:c,paddingTop:l}}const Nm=(n,o,e,t,r,i)=>{var N,V,H;const s=n.get(a.IUniverInstanceService),l=n.get(T.IRenderManagerService),c=s.getUnit(o,a.UniverInstanceType.UNIVER_SHEET);if(!c)return null;const d=c.getSheetBySheetId(e);if(!d)return null;const u=l.getRenderById(c.getUnitId()),h=u==null?void 0:u.with(exports.SheetSkeletonManagerService).getSkeletonParam(d.getSheetId()),g=h==null?void 0:h.skeleton;if(!g||!u)return;const S=g.getFont(t,r),p=S==null?void 0:S.documentSkeleton;if(!p)return null;const f=(V=(N=p.getViewModel().getBody())==null?void 0:N.customRanges)==null?void 0:V.find(k=>k.rangeId===i);if(!f)return null;const v=J.DOC_VERTICAL_PADDING,C=g.getCellWithCoordByIndex(t,r);let{actualColumn:_,actualRow:R}=C;g.overflowCache.forValue((k,U,L)=>{L.startRow<=R&&L.endRow>=R&&L.startColumn<=_&&L.endColumn>=_&&(_=U,R=k)});const w=g.getCellWithCoordByIndex(R,_),P=d.getCell(w.actualRow,w.actualColumn),{topOffset:y=0,leftOffset:M=0}=(H=P==null?void 0:P.fontRenderExtension)!=null?H:{},{paddingLeft:x,paddingTop:A}=Ul(w,S,!1),D=ps({startOffset:f.startIndex,endOffset:f.endIndex},p);return{rects:D==null?void 0:D.map(k=>({top:k.top+w.mergeInfo.startY+A+y+v,bottom:k.bottom+w.mergeInfo.startY+A+y+v,left:k.left+w.mergeInfo.startX+x+M,right:k.right+w.mergeInfo.startX+x+M})),customRange:f,label:p.getViewModel().getBody().dataStream.slice(f.startIndex,f.endIndex+1)}},km=(n,o,e,t,r,i)=>{var M,x,A;const s=n.get(he),l=s.getEditCellState();if(!l||!s.isVisible().visible)return null;const{editorUnitId:d,unitId:u,sheetId:h,row:g,column:S}=l;if(o!==u||e!==h||g!==t||S!==r)return null;const p=n.get(T.IRenderManagerService),f=p.getRenderById(d),v=p.getRenderById(o);if(!f||!v)return null;const C=f.with(ve.DocSkeletonManagerService).getSkeleton(),_=(M=v.with(exports.SheetSkeletonManagerService).getSkeletonParam(h))==null?void 0:M.skeleton;if(!C||!_)return null;const R=(A=(x=C.getViewModel().getBody())==null?void 0:x.customRanges)==null?void 0:A.find(D=>D.rangeId===i);if(!R)return null;const w=4,P=ps({startOffset:R.startIndex,endOffset:R.endIndex},C),y=f.engine.getCanvasElement().getBoundingClientRect();return{rects:P==null?void 0:P.map(D=>({top:D.top+y.top-w,bottom:D.bottom+y.top+w,left:D.left+y.left,right:D.right+y.left})),customRange:R,label:C.getViewModel().getBody().dataStream.slice(R.startIndex,R.endIndex+1)}};var Hm=Object.getOwnPropertyDescriptor,Vm=(n,o,e,t)=>{for(var r=t>1?void 0:t?Hm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},la=(n,o)=>(e,t)=>o(e,t,n);function Rt(n){const{workbook:o,worksheet:e,...t}=n;return t}exports.HoverManagerService=class extends a.Disposable{constructor(e,t){super();E(this,"_currentCell$",new O.BehaviorSubject(null));E(this,"_currentRichText$",new O.BehaviorSubject(null));E(this,"_currentClickedCell$",new O.Subject);E(this,"_currentDbClickedCell$",new O.Subject);E(this,"_currentCellWithEvent$",new O.Subject);E(this,"_currentPointerDownCell$",new O.Subject);E(this,"_currentPointerUpCell$",new O.Subject);E(this,"_currentHoveredRowHeader$",new O.BehaviorSubject(null));E(this,"_currentHoveredColHeader$",new O.BehaviorSubject(null));E(this,"_currentRowHeaderClick$",new O.Subject);E(this,"_currentColHeaderClick$",new O.Subject);E(this,"_currentRowHeaderDbClick$",new O.Subject);E(this,"_currentColHeaderDbClick$",new O.Subject);E(this,"_currentRowHeaderPointerDown$",new O.Subject);E(this,"_currentColHeaderPointerDown$",new O.Subject);E(this,"_currentRowHeaderPointerUp$",new O.Subject);E(this,"_currentColHeaderPointerUp$",new O.Subject);E(this,"currentCell$",this._currentCell$.asObservable().pipe(O.distinctUntilChanged((e,t)=>{var r,i,s,l,c,d,u,h;return((r=e==null?void 0:e.location)==null?void 0:r.unitId)===((i=t==null?void 0:t.location)==null?void 0:i.unitId)&&((s=e==null?void 0:e.location)==null?void 0:s.subUnitId)===((l=t==null?void 0:t.location)==null?void 0:l.subUnitId)&&((c=e==null?void 0:e.location)==null?void 0:c.row)===((d=t==null?void 0:t.location)==null?void 0:d.row)&&((u=e==null?void 0:e.location)==null?void 0:u.col)===((h=t==null?void 0:t.location)==null?void 0:h.col)})));E(this,"currentRichTextNoDistinct$",this._currentRichText$.pipe(O.map(e=>e&&{unitId:e.location.unitId,subUnitId:e.location.subUnitId,row:e.location.row,col:e.location.col,customRange:e.customRange,bullet:e.bullet,rect:e.rect,drawing:e.drawing})));E(this,"currentRichText$",this._currentRichText$.pipe(O.distinctUntilChanged((e,t)=>{var r,i,s,l,c,d,u,h,g,S,p,f,v,C,_,R,w,P;return((r=e==null?void 0:e.location)==null?void 0:r.unitId)===((i=t==null?void 0:t.location)==null?void 0:i.unitId)&&((s=e==null?void 0:e.location)==null?void 0:s.subUnitId)===((l=t==null?void 0:t.location)==null?void 0:l.subUnitId)&&((c=e==null?void 0:e.location)==null?void 0:c.row)===((d=t==null?void 0:t.location)==null?void 0:d.row)&&((u=e==null?void 0:e.location)==null?void 0:u.col)===((h=t==null?void 0:t.location)==null?void 0:h.col)&&((g=e==null?void 0:e.customRange)==null?void 0:g.rangeId)===((S=t==null?void 0:t.customRange)==null?void 0:S.rangeId)&&((p=e==null?void 0:e.bullet)==null?void 0:p.startIndex)===((f=t==null?void 0:t.bullet)==null?void 0:f.startIndex)&&((v=e==null?void 0:e.customRange)==null?void 0:v.startIndex)===((C=t==null?void 0:t.customRange)==null?void 0:C.startIndex)&&((_=e==null?void 0:e.customRange)==null?void 0:_.endIndex)===((R=t==null?void 0:t.customRange)==null?void 0:R.endIndex)&&((w=e==null?void 0:e.drawing)==null?void 0:w.drawingId)===((P=t==null?void 0:t.drawing)==null?void 0:P.drawingId)}),O.map(e=>e&&{unitId:e.location.unitId,subUnitId:e.location.subUnitId,row:e.location.row,col:e.location.col,customRange:e.customRange,bullet:e.bullet,rect:e.rect,drawing:e.drawing})));E(this,"currentCellPosWithEvent$",this._currentCellWithEvent$.pipe(O.distinctUntilChanged((e,t)=>{var r,i,s,l,c,d,u,h;return((r=e==null?void 0:e.location)==null?void 0:r.unitId)===((i=t==null?void 0:t.location)==null?void 0:i.unitId)&&((s=e==null?void 0:e.location)==null?void 0:s.subUnitId)===((l=t==null?void 0:t.location)==null?void 0:l.subUnitId)&&((c=e==null?void 0:e.location)==null?void 0:c.row)===((d=t==null?void 0:t.location)==null?void 0:d.row)&&((u=e==null?void 0:e.location)==null?void 0:u.col)===((h=t==null?void 0:t.location)==null?void 0:h.col)}),O.map(e=>e&&{unitId:e.location.unitId,subUnitId:e.location.subUnitId,row:e.location.row,col:e.location.col,event:e.event})));E(this,"currentPosition$",this._currentCell$.asObservable());E(this,"currentClickedCell$",this._currentClickedCell$.asObservable());E(this,"currentDbClickedCell$",this._currentDbClickedCell$.asObservable());E(this,"currentPointerDownCell$",this._currentPointerDownCell$.asObservable());E(this,"currentPointerUpCell$",this._currentPointerUpCell$.asObservable());E(this,"currentHoveredRowHeader$",this._currentHoveredRowHeader$.asObservable());E(this,"currentHoveredColHeader$",this._currentHoveredColHeader$.asObservable());E(this,"currentRowHeaderClick$",this._currentRowHeaderClick$.asObservable());E(this,"currentColHeaderClick$",this._currentColHeaderClick$.asObservable());E(this,"currentRowHeaderDbClick$",this._currentRowHeaderDbClick$.asObservable());E(this,"currentColHeaderDbClick$",this._currentColHeaderDbClick$.asObservable());E(this,"currentRowHeaderPointerDown$",this._currentRowHeaderPointerDown$.asObservable());E(this,"currentColHeaderPointerDown$",this._currentColHeaderPointerDown$.asObservable());E(this,"currentRowHeaderPointerUp$",this._currentRowHeaderPointerUp$.asObservable());E(this,"currentColHeaderPointerUp$",this._currentColHeaderPointerUp$.asObservable());this._univerInstanceService=e,this._renderManagerService=t,this._initCellDisposableListener()}dispose(){super.dispose(),this._currentCell$.complete(),this._currentClickedCell$.complete(),this._currentPointerDownCell$.complete(),this._currentPointerUpCell$.complete(),this._currentCellWithEvent$.complete(),this._currentRichText$.complete(),this._currentDbClickedCell$.complete(),this._currentHoveredRowHeader$.complete(),this._currentHoveredColHeader$.complete(),this._currentRowHeaderClick$.complete(),this._currentColHeaderClick$.complete(),this._currentRowHeaderDbClick$.complete(),this._currentColHeaderDbClick$.complete(),this._currentRowHeaderPointerDown$.complete(),this._currentColHeaderPointerDown$.complete(),this._currentRowHeaderPointerUp$.complete(),this._currentColHeaderPointerUp$.complete(),this.currentCellPosWithEvent$=O.of(null),this.currentRichText$=O.of(null)}_initCellDisposableListener(){this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{e||this._currentCell$.next(null)})),this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe(e=>{var t,r;((t=this._currentCell$.getValue())==null?void 0:t.location.unitId)===e.getUnitId()&&this._currentCell$.next(null),((r=this._currentRichText$.getValue())==null?void 0:r.location.unitId)===e.getUnitId()&&this._currentRichText$.next(null)}))}_getCalcDeps(e){const t=this._univerInstanceService.getUnit(e,a.UniverInstanceType.UNIVER_SHEET);if(!t)return null;const r=t.getActiveSheet();if(!r)return null;const i=this._renderManagerService.getRenderById(t.getUnitId());if(!i)return null;const s=i.with(exports.SheetSkeletonManagerService).getSkeletonParam(r.getSheetId());if(!s)return null;const l=i.with(exports.SheetScrollManagerService);if(!(!(l!=null&&l.getCurrentScrollState())||!i))return{currentRender:i,workbook:t,worksheet:r,skeletonParam:s}}_calcActiveCell(e,t,r,i,s,l){var M,x,A;const c=nl(e,t,r,i,s,l),d=i.skeleton;if(!c)return null;const{position:u,overflowLocation:h,location:g}=c,S=d.getFont(h.row,h.col);let p=null,f=null,v=null;const C=d.getCellWithCoordByIndex(h.row,h.col),_=r.getCell(h.row,h.col),{topOffset:R=0,leftOffset:w=0}=(M=_==null?void 0:_.fontRenderExtension)!=null?M:{};if(S!=null&&S.documentSkeleton){const{paddingLeft:D,paddingTop:N}=Ul(C,S,(_==null?void 0:_.v)!==null&&(_==null?void 0:_.v)!==void 0?!Number.isNaN(+_.v):!1),V=Wl(S.documentSkeleton,D,N),H=s-u.startX-w,k=l-u.startY-R;p=V.links.find(U=>U.rects.some(L=>L.left<=H&&H<=L.right&&L.top<=k&&k<=L.bottom)),f=V.checkLists.find(U=>U.rect.left<=H&&H<=U.rect.right&&U.rect.top<=k&&k<=U.rect.bottom),v=V.drawings.find(U=>U.rect.left<=H&&H<=U.rect.right&&U.rect.top<=k&&k<=U.rect.bottom)}const P=(A=(x=p==null?void 0:p.rects.pop())!=null?x:f==null?void 0:f.rect)!=null?A:v==null?void 0:v.rect,y=P&&(()=>{const D=P.top+C.mergeInfo.startY+R,N=P.bottom+C.mergeInfo.startY+R,V=P.left+C.mergeInfo.startX+w,H=P.right+C.mergeInfo.startX+w,k=C.mergeInfo.startY+R,U=C.mergeInfo.endY+R,L=C.mergeInfo.startX+w,j=C.mergeInfo.endX+w,B=Math.min(Math.max(D,k),k),z=Math.min(N,U),X=Math.min(Math.max(V,L),L),K=Math.min(H,j);return{top:B,bottom:z,left:X,right:K}})();return{location:g,position:u,overflowLocation:h,customRange:p==null?void 0:p.range,bullet:f==null?void 0:f.paragraph,drawing:v,rect:y}}_calcActiveRowHeader(e,t,r){const i=this._getCalcDeps(e);if(!i)return;const{currentRender:s,worksheet:l,skeletonParam:c}=i,{scaleY:d}=s.scene.getAncestorScale(),u=s.scene.getViewports().find(S=>S.isHit(new T.Vector2(t,r)));if(!u||u.viewportKey!==T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP&&u.viewportKey!==T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM)return;const h={x:u.viewportScrollX,y:u.viewportScrollY},g=c.skeleton.getRowIndexByOffsetY(r,d,h);return{unitId:e,index:g,subUnitId:l.getSheetId()}}_calcActiveColHeader(e,t,r){const i=this._getCalcDeps(e);if(!i)return;const{currentRender:s,worksheet:l,skeletonParam:c}=i,{scaleX:d}=s.scene.getAncestorScale(),u=s.scene.getViewports().find(S=>S.isHit(new T.Vector2(t,r)));if(!u||u.viewportKey!==T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT&&u.viewportKey!==T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT)return;const h={x:u.viewportScrollX,y:u.viewportScrollY},g=c.skeleton.getColumnIndexByOffsetX(t,d,h);return{unitId:e,index:g,subUnitId:l.getSheetId()}}triggerPointerDown(e,t){const r=this._getCalcDeps(e);if(!r)return;const{currentRender:i,workbook:s,worksheet:l,skeletonParam:c}=r,d=this._calcActiveCell(i,s,l,c,t.offsetX,t.offsetY);if(d&&d.location){const{unitId:u,subUnitId:h,row:g,col:S}=Rt(d.location);this._currentPointerDownCell$.next({unitId:u,subUnitId:h,row:g,col:S,event:t})}}triggerPointerUp(e,t){const r=this._getCalcDeps(e);if(!r)return;const{currentRender:i,workbook:s,worksheet:l,skeletonParam:c}=r,d=this._calcActiveCell(i,s,l,c,t.offsetX,t.offsetY);if(d){const u=Rt(d.location);this._currentPointerUpCell$.next({...u,event:t})}}triggerMouseMove(e,t){const r=this._getCalcDeps(e);if(!r)return;const{currentRender:i,workbook:s,worksheet:l,skeletonParam:c}=r,d=this._calcActiveCell(i,s,l,c,t.offsetX,t.offsetY);this._currentCell$.next(d&&{location:Rt(d.location),position:d.position}),this._currentRichText$.next(d&&{...d,location:Rt(d.overflowLocation)}),this._currentCellWithEvent$.next(d&&{...d,location:Rt(d.location),event:t})}triggerClick(e,t,r){const i=this._getCalcDeps(e);if(!i)return;const{currentRender:s,workbook:l,worksheet:c,skeletonParam:d}=i,u=this._calcActiveCell(s,l,c,d,t,r);u&&this._currentClickedCell$.next({...u,location:Rt(u.location)})}triggerDbClick(e,t,r){const i=this._getCalcDeps(e);if(!i)return;const{currentRender:s,workbook:l,worksheet:c,skeletonParam:d}=i,u=this._calcActiveCell(s,l,c,d,t,r);u&&this._currentDbClickedCell$.next({...u,location:Rt(u.location)})}triggerScroll(){this._currentCell$.next(null)}triggerRowHeaderClick(e,t,r){const i=this._calcActiveRowHeader(e,t,r);i&&this._currentRowHeaderClick$.next(i)}triggerColHeaderClick(e,t,r){const i=this._calcActiveColHeader(e,t,r);i&&this._currentColHeaderClick$.next(i)}triggerRowHeaderDbClick(e,t,r){const i=this._calcActiveRowHeader(e,t,r);i&&this._currentRowHeaderDbClick$.next(i)}triggerColHeaderDbClick(e,t,r){const i=this._calcActiveColHeader(e,t,r);i&&this._currentColHeaderDbClick$.next(i)}triggerRowHeaderMouseMove(e,t,r){this._currentHoveredRowHeader$.next(this._calcActiveRowHeader(e,t,r))}triggerColHeaderMouseMove(e,t,r){this._currentHoveredColHeader$.next(this._calcActiveColHeader(e,t,r))}triggerRowHeaderPoniterDown(e,t,r){const i=this._calcActiveRowHeader(e,t,r);i&&this._currentRowHeaderPointerDown$.next(i)}triggerColHeaderPoniterDown(e,t,r){const i=this._calcActiveColHeader(e,t,r);i&&this._currentColHeaderPointerDown$.next(i)}triggerRowHeaderPoniterUp(e,t,r){const i=this._calcActiveRowHeader(e,t,r);i&&this._currentRowHeaderPointerUp$.next(i)}triggerColHeaderPoniterUp(e,t,r){const i=this._calcActiveColHeader(e,t,r);i&&this._currentColHeaderPointerUp$.next(i)}};exports.HoverManagerService=Vm([la(0,a.IUniverInstanceService),la(1,T.IRenderManagerService)],exports.HoverManagerService);var Wm=Object.getOwnPropertyDescriptor,Um=(n,o,e,t)=>{for(var r=t>1?void 0:t?Wm(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Xo=(n,o)=>(e,t)=>o(e,t,n);exports.HoverRenderController=class extends a.Disposable{constructor(e,t,r,i){super();E(this,"_active",!1);this._context=e,this._hoverManagerService=t,this._sheetSkeletonManagerService=r,this._scrollManagerService=i,this._initPointerEvent(),this._initScrollEvent()}get active(){return this._active}_initPointerEvent(){const e=new a.DisposableCollection,t=r=>{if(e.dispose(),!r)return;const{mainComponent:i,unitId:s,components:l}=this._context;if(!i)return;e.add(i.onPointerEnter$.subscribeEvent(u=>{this._active=!0})),e.add(a.fromEventSubject(i.onPointerMove$).subscribe(u=>{this._active=!0,this._hoverManagerService.triggerMouseMove(s,u)})),e.add(i.onPointerDown$.subscribeEvent(u=>{this._hoverManagerService.triggerPointerDown(s,u)})),e.add(i.onPointerUp$.subscribeEvent(u=>{this._hoverManagerService.triggerPointerUp(s,u)})),e.add(i.onClick$.subscribeEvent(u=>{this._hoverManagerService.triggerClick(s,u.offsetX,u.offsetY)})),e.add(i.onDblclick$.subscribeEvent(u=>{this._hoverManagerService.triggerDbClick(s,u.offsetX,u.offsetY)})),e.add(i.onPointerLeave$.subscribeEvent(()=>{this._active=!1}));const c=l.get(ue.ROW),d=l.get(ue.COLUMN);c&&(e.add(c.onPointerMove$.subscribeEvent(u=>{this._hoverManagerService.triggerRowHeaderMouseMove(s,u.offsetX,u.offsetY)})),e.add(c.onPointerDown$.subscribeEvent(u=>{this._hoverManagerService.triggerRowHeaderPoniterDown(s,u.offsetX,u.offsetY)})),e.add(c.onPointerUp$.subscribeEvent(u=>{this._hoverManagerService.triggerRowHeaderPoniterUp(s,u.offsetX,u.offsetY),this._hoverManagerService.triggerRowHeaderClick(s,u.offsetX,u.offsetY)})),e.add(c.onDblclick$.subscribeEvent(u=>{this._hoverManagerService.triggerRowHeaderDbClick(s,u.offsetX,u.offsetY)}))),d&&(e.add(d.onPointerMove$.subscribeEvent(u=>{this._hoverManagerService.triggerColHeaderMouseMove(s,u.offsetX,u.offsetY)})),e.add(d.onPointerDown$.subscribeEvent(u=>{this._hoverManagerService.triggerColHeaderPoniterDown(s,u.offsetX,u.offsetY)})),e.add(d.onPointerUp$.subscribeEvent(u=>{this._hoverManagerService.triggerColHeaderPoniterUp(s,u.offsetX,u.offsetY),this._hoverManagerService.triggerColHeaderClick(s,u.offsetX,u.offsetY)})),e.add(d.onDblclick$.subscribeEvent(u=>{this._hoverManagerService.triggerColHeaderDbClick(s,u.offsetX,u.offsetY)})))};t(this._sheetSkeletonManagerService.getCurrentParam()),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(r=>{t(r)}))}_initScrollEvent(){this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(()=>this._hoverManagerService.triggerScroll()))}};exports.HoverRenderController=Um([Xo(1,a.Inject(exports.HoverManagerService)),Xo(2,a.Inject(exports.SheetSkeletonManagerService)),Xo(3,a.Inject(exports.SheetScrollManagerService))],exports.HoverRenderController);const Ll="UI_PLUGIN_SHEETS",fs=`${Ll}_BORDER_PANEL_COMPONENT`,Bl=[{label:"borderLine.borderTop",icon:"UpBorderDoubleIcon",value:"top"},{label:"borderLine.borderBottom",icon:"DownBorderDoubleIcon",value:"bottom"},{label:"borderLine.borderLeft",icon:"LeftBorderDoubleIcon",value:"left"},{label:"borderLine.borderRight",icon:"RightBorderDoubleIcon",value:"right"},{label:"borderLine.borderNone",icon:"NoBorderIcon",value:"none"},{label:"borderLine.borderAll",icon:"AllBorderIcon",value:"all"},{label:"borderLine.borderOutside",icon:"OuterBorderDoubleIcon",value:"outside"},{label:"borderLine.borderInside",icon:"InnerBorderDoubleIcon",value:"inside"},{label:"borderLine.borderHorizontal",icon:"HorizontalBorderDoubleIcon",value:"horizontal"},{label:"borderLine.borderVertical",icon:"VerticalBorderDoubleIcon",value:"vertical"},{label:"borderLine.borderTlbr",icon:"BackSlashDoubleIcon",value:"tlbr"},{label:"borderLine.borderTlbcTlmr",icon:"LeftDoubleDiagonalDoubleIcon",value:"tlbc_tlmr"},{label:"borderLine.borderTlbrTlbcTlmr",icon:"LeftTridiagonalDoubleIcon",value:"tlbr_tlbc_tlmr"},{label:"borderLine.borderBlTr",icon:"SlashDoubleIcon",value:"bltr"},{label:"borderLine.borderMltrBctr",icon:"RightDoubleDiagonalDoubleIcon",value:"mltr_bctr"}];function Lm(n){return n.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).pipe(de.switchMap(o=>o?o.activeSheet$.pipe(de.map(e=>e?{workbook:o,worksheet:e}:null)):O.of(null)))}function _e(n,o,e){return Lm(n).pipe(de.switchMap(t=>t?e(t):O.of(o)))}function Fl(n,o){const e=n.get(a.IUniverInstanceService),t=n.get(m.IExclusiveRangeService),r=n.get(m.SheetsSelectionsService);return e.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).pipe(de.switchMap(s=>s?O.combineLatest([r.selectionMoveEnd$,s.activeSheet$]).pipe(de.switchMap(([l,c])=>{if(!c||l.length===0)return O.of(!1);const d=t.getInterestGroupId(l);if(o){const u=d.filter(h=>o.has(h));return O.of(u.length>0)}else return O.of(d.length>0)})):O.of(!1)))}function Zt(n,o,e){return O.combineLatest([o,Fl(n,e)]).pipe(de.map(([t,r])=>t||r))}function ee(n,o={},e=!1){var g;const r=n.get(a.IUniverInstanceService).getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),i=n.get(a.UserManagerService),s=n.has(he)?n.get(he):null,l=n.get(a.IContextService),d=((g=s==null?void 0:s.visible$)!=null?g:O.of(null)).pipe(de.startWith(null),de.shareReplay(1)),u=l.subscribeContextValue$(a.FOCUSING_FX_BAR_EDITOR).pipe(de.startWith(!1),de.shareReplay(1));return O.combineLatest([i.currentUser$,r,d,u]).pipe(de.switchMap(([S,p,f,v])=>!p||f!=null&&f.visible&&f.unitId===p.getUnitId()&&!e||v&&!e?O.of(!0):p.activeSheet$.pipe(de.switchMap(C=>{if(!C)return O.of(!0);const _=n.get(m.SheetsSelectionsService),R=n.get(m.RangeProtectionRuleModel),w=n.get(m.WorksheetProtectionRuleModel),y=n.get(a.IContextService).subscribeContextValue$(a.FOCUSING_COMMON_DRAWINGS).pipe(de.startWith(!1));return O.combineLatest([_.selectionMoveEnd$,y]).pipe(de.switchMap(([M,x])=>{if(x)return O.of(!0);const A=p.getUnitId(),D=C.getSheetId(),N=n.get(a.IPermissionService),{workbookTypes:V=[m.WorkbookEditablePermission],worksheetTypes:H,rangeTypes:k}=o,U=[];if(V==null||V.forEach(z=>{U.push(new z(A).id)}),H==null||H.forEach(z=>{U.push(new z(A,D).id)}),w.getRule(A,D))return N.composePermission$(U).pipe(de.map(z=>z.some(X=>X.value===!1)));const j=M==null?void 0:M.map(z=>z.range),B=R.getSubunitRuleList(A,D).filter(z=>j==null?void 0:j.some(X=>z.ranges.some(K=>a.Rectangle.intersects(X,K))));return k==null||k.forEach(z=>{B.forEach(X=>{U.push(new z(A,D,X.permissionId).id)})}),N.composePermission$(U).pipe(de.map(z=>z.some(X=>X.value===!1)))}))}))))}function Wn(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(m.RangeProtectionRuleModel),r=n.get(a.IPermissionService);return O.merge(e.selectionMoveEnd$,r.permissionPointUpdate$.pipe(de.debounceTime(100))).pipe(de.map(()=>{var h;const i=(h=e.getCurrentLastSelection())==null?void 0:h.range;if(!i)return!0;const s=o.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),l=s==null?void 0:s.getActiveSheet();if(!s||!l)return!0;const c=s.getUnitId(),d=l.getSheetId(),u=[new m.WorkbookEditablePermission(c).id,new m.WorksheetEditPermission(c,d).id];return t.getSubunitRuleList(c,d).filter(g=>g.ranges.some(S=>a.Rectangle.intersects(i,S))).forEach(g=>{u.push(new m.RangeProtectionPermissionEditPoint(c,d,g.permissionId).id)}),r.composePermission(u).some(g=>g.value===!1)}))}function jl(n,o){const e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(m.RangeProtectionRuleModel),i=n.get(a.IPermissionService);return O.merge(t.selectionMoveEnd$,i.permissionPointUpdate$.pipe(de.debounceTime(100))).pipe(de.map(()=>{var g;const s=(g=t.getCurrentLastSelection())==null?void 0:g.range;if(!s)return!0;const l=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),c=l==null?void 0:l.getActiveSheet();if(!l||!c)return!0;const d=l.getUnitId(),u=c.getSheetId(),h=[new m.WorkbookEditablePermission(d).id,new m.WorksheetEditPermission(d,u).id];return r.getSubunitRuleList(d,u).filter(S=>o==="row"?S.ranges.some(p=>s.startRow>p.startRow&&s.startRow<=p.endRow):S.ranges.some(p=>s.startColumn>p.startColumn&&s.startColumn<=p.endColumn)).forEach(S=>{h.push(new m.RangeProtectionPermissionEditPoint(d,u,S.permissionId).id)}),i.composePermission(h).some(S=>S.value===!1)}))}function zl(n,o){const e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(m.RangeProtectionRuleModel),i=n.get(a.IPermissionService);return O.merge(t.selectionMoveEnd$,i.permissionPointUpdate$.pipe(de.debounceTime(100))).pipe(de.map(()=>{var S;const s=(S=t.getCurrentLastSelection())==null?void 0:S.range;if(!s)return!0;const l=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),c=l==null?void 0:l.getActiveSheet();if(!l||!c)return!0;const d=l.getUnitId(),u=c.getSheetId(),h=[new m.WorkbookEditablePermission(d).id,new m.WorksheetEditPermission(d,u).id],g=a.Tools.deepClone(s);return o==="row"?(g.startColumn=0,g.endColumn=c.getColumnCount()-1):(g.startRow=0,g.endRow=c.getRowCount()-1),r.getSubunitRuleList(d,u).filter(p=>p.ranges.some(f=>a.Rectangle.intersects(g,f))).forEach(p=>{h.push(new m.RangeProtectionPermissionEditPoint(d,u,p.permissionId).id)}),i.composePermission(h).some(p=>p.value===!1)}))}function Wo(n,o){const e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(m.RangeProtectionRuleModel),i=n.get(a.IPermissionService);return O.merge(t.selectionMoveEnd$,i.permissionPointUpdate$.pipe(de.debounceTime(100))).pipe(de.map(()=>{var S;const s=(S=t.getCurrentLastSelection())==null?void 0:S.range;if(!s)return!0;const l=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),c=l==null?void 0:l.getActiveSheet();if(!l||!c)return!0;const d=l.getUnitId(),u=c.getSheetId(),h=[new m.WorkbookEditablePermission(d).id,new m.WorksheetEditPermission(d,u).id],g=a.Tools.deepClone(s);return o==="row"?g.endRow=c.getRowCount()-1:g.endColumn=c.getColumnCount()-1,r.getSubunitRuleList(d,u).filter(p=>p.ranges.some(f=>a.Rectangle.intersects(g,f))).forEach(p=>{h.push(new m.RangeProtectionPermissionEditPoint(d,u,p.permissionId).id)}),i.composePermission(h).some(p=>p.value===!1)}))}function Un(n,o){const t=n.get(a.IUniverInstanceService).getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(m.WorksheetProtectionRuleModel),i=n.get(m.RangeProtectionRuleModel),s=n.get(a.IPermissionService),l=n.get(a.UserManagerService);return O.combineLatest([l.currentUser$,t]).pipe(de.switchMap(([c,d])=>d?d.activeSheet$.pipe(de.switchMap(u=>{if(!u)return O.of(!0);const h=d.getUnitId(),g=[];return o.forEach(p=>g.push(new p(h).id)),s.composePermission$(g).pipe(de.map(p=>p.every(f=>f.value===!0))).pipe(de.map(p=>{if(!p)return!0;const f=u.getSheetId(),v=r.getRule(h,f),C=i.getSubunitRuleList(h,f);return!!(v||C.length)}))})):O.of(!0)))}function Bm(n){const o=n.get(m.BorderStyleManagerService),e=ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]});return{id:m.SetBorderBasicCommand.id,icon:new O.Observable(t=>{const r="AllBorderIcon",i=n.get(m.BorderStyleManagerService),s=n.get(a.ICommandService).onCommandExecuted(l=>{var g;if(l.id!==m.SetBorderBasicCommand.id)return;const{type:d}=i.getBorderInfo(),u=Bl.find(S=>S.value===d),h=(g=u==null?void 0:u.icon)!=null?g:r;t.next(h)});return t.next(r),s.dispose}),tooltip:"toolbar.border.main",type:I.MenuItemType.BUTTON_SELECTOR,slot:!0,selections:[{label:{name:fs,hoverable:!1,selectable:!1},value$:o.borderInfo$}],value$:o.borderInfo$,hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:e}}const Kr="sheet.menu.clear-selection";function Yo(n){return{id:Kr,type:I.MenuItemType.SUBITEMS,icon:"ClearFormatDoubleIcon",title:"rightClick.clearSelection",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Zo(n){return{id:m.ClearSelectionContentCommand.id,type:I.MenuItemType.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearContent",disabled$:Zt(n,ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellValuePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Go(n){return{id:m.ClearSelectionFormatCommand.id,type:I.MenuItemType.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearFormat",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Br(n){return{id:m.ClearSelectionAllCommand.id,type:I.MenuItemType.BUTTON,icon:"ClearFormatDoubleIcon",title:"rightClick.clearAll",tooltip:"rightClick.clearAll",disabled$:Zt(n,ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellValuePermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}const Xl="sheet.menu.delete";function Fm(n){return{id:Xl,type:I.MenuItemType.SUBITEMS,title:"rightClick.delete",icon:"ReduceDoubleIcon",hidden$:Zt(n,Wn(n)),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission]})}}function ca(n){return{id:vn.id,type:I.MenuItemType.BUTTON,icon:"DeleteColumnDoubleIcon",title:"rightClick.deleteSelectedColumn",hidden$:zl(n,"col"),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookDeleteColumnPermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetDeleteColumnPermission]})}}function da(n){return{id:fn.id,type:I.MenuItemType.BUTTON,icon:"DeleteRowDoubleIcon",title:"rightClick.deleteSelectedRow",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookDeleteRowPermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetDeleteRowPermission]}),hidden$:zl(n,"row")}}function jm(n){return{id:xn.id,type:I.MenuItemType.BUTTON,title:"rightClick.moveLeft",icon:"DeleteCellShiftLeftDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wo(n,"col")}}function zm(n){return{id:kt.id,type:I.MenuItemType.BUTTON,title:"rightClick.moveUp",icon:"DeleteCellShiftUpDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wo(n,"row")}}function Xm(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService);return{id:m.ToggleGridlinesCommand.id,type:I.MenuItemType.BUTTON,tooltip:"toolbar.toggleGridlines",icon:"HideGridlinesDoubleIcon",activated$:new O.Observable(t=>{const r=()=>{const s=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);return s?s.getActiveSheet().getConfig().showGridlines===a.BooleanNumber.TRUE:!1},i=new a.DisposableCollection;return i.add(o.onCommandExecuted(s=>{(s.id===m.ToggleGridlinesMutation.id||s.id===m.SetWorksheetActiveOperation.id)&&t.next(r())})),i.add(e.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).subscribe(()=>{t.next(r())})),t.next(r()),()=>i.dispose()}),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission]})}}const Ge=`${Ll}_MENU_ITEM_INPUT_COMPONENT`,Yl=n=>{const{prefix:o,suffix:e,value:t,onChange:r,min:i=Number.MIN_SAFE_INTEGER,max:s=Number.MAX_SAFE_INTEGER}=n,l=I.useDependency(a.LocaleService),c=I.useDependency(I.IContextMenuService),[d,u]=W.useState(),h=S=>{if(!S){u(i.toString());return}const p=S.toString();u(p),r(p)};W.useEffect(()=>{c.visible||u(t)},[c.visible]),W.useEffect(()=>{+t<i?u(i.toString()):+t>s?u(s.toString()):u(t)},[t]);function g(){d&&r(d)}return b.jsxs("div",{className:"univer-inline-flex univer-items-center univer-gap-1",children:[l.t(o),b.jsx("div",{className:"univer-w-16",onClick:S=>S.stopPropagation(),children:b.jsx(F.InputNumber,{value:Number(d),size:"mini",precision:0,min:i,max:s,onPressEnter:g,onChange:h})}),l.t(e)]})},Zl="sheet.menu.cell-insert";function Ym(n){return{id:Zl,type:I.MenuItemType.SUBITEMS,title:"rightClick.insert",icon:"InsertDoubleIcon",hidden$:Zt(n,Wn(n)),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertColumnPermission,m.WorkbookInsertRowPermission],worksheetTypes:[m.WorksheetInsertColumnPermission,m.WorksheetInsertRowPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function Zm(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertRowBeforeCommand.id,type:I.MenuItemType.BUTTON,icon:"InsertRowAboveDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertRowsAbove",min:1,max:1e3,suffix:"rightClick.insertRowsAboveSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endRow)-(c==null?void 0:c.startRow)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertRowPermission],worksheetTypes:[m.WorksheetInsertRowPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:jl(n,"row")}}function Gm(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertColBeforeCommand.id,type:I.MenuItemType.BUTTON,icon:"LeftInsertColumnDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertColsLeft",min:1,max:1e3,suffix:"rightClick.insertColsLeftSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endColumn)-(c==null?void 0:c.startColumn)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertColumnPermission],worksheetTypes:[m.WorksheetInsertColumnPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:jl(n,"col")}}function Km(n){return{id:On.id,type:I.MenuItemType.BUTTON,title:"rightClick.moveRight",icon:"InsertCellShiftRightDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wo(n,"col")}}function qm(n){return{id:Ht.id,type:I.MenuItemType.BUTTON,title:"rightClick.moveDown",icon:"InsertCellDownDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wo(n,"row")}}function Qm(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertMultiRowsAfterCommand.id,type:I.MenuItemType.BUTTON,icon:"InsertRowBelowDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertRowsAfter",min:1,max:1e3,suffix:"rightClick.insertRowsAfterSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endRow)-(c==null?void 0:c.startRow)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertRowPermission],worksheetTypes:[m.WorksheetInsertRowPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wn(n)}}function Jm(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertMultiRowsAboveCommand.id,type:I.MenuItemType.BUTTON,icon:"InsertRowAboveDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertRowsAbove",min:1,max:1e3,suffix:"rightClick.insertRowsAboveSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endRow)-(c==null?void 0:c.startRow)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertRowPermission],worksheetTypes:[m.WorksheetInsertRowPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wn(n)}}function $m(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertMultiColsLeftCommand.id,type:I.MenuItemType.BUTTON,icon:"LeftInsertColumnDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertColsLeft",min:1,max:1e3,suffix:"rightClick.insertColsLeftSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endColumn)-(c==null?void 0:c.startColumn)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertColumnPermission],worksheetTypes:[m.WorksheetInsertColumnPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wn(n)}}function eg(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=1;return{id:m.InsertMultiColsRightCommand.id,type:I.MenuItemType.BUTTON,icon:"RightInsertColumnDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.insertColsRight",min:1,max:1e3,suffix:"rightClick.insertColsRightSuffix"}},value$:_e(o,r,()=>new O.Observable(i=>{function s(){var u;const c=(u=e.getCurrentLastSelection())==null?void 0:u.range;let d=r;c&&(d=(c==null?void 0:c.endColumn)-(c==null?void 0:c.startColumn)+1),i.next(d)}const l=t.onCommandExecuted(c=>{if(c.id===m.SetSelectionsOperation.id)return s()});return s(),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission,m.WorkbookInsertColumnPermission],worksheetTypes:[m.WorksheetInsertColumnPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:Wn(n)}}var Gl=(n=>(n.ROW_HEADER_CONTEXT_MENU="ROW_HEADER_CONTEXT_MENU",n.COL_HEADER_CONTEXT_MENU="COL_HEADER_CONTEXT_MENU",n.SHEET_BAR="SHEET_BAR",n.SHEET_FOOTER="SHEET_FOOTER",n))(Gl||{});function tg(n){const o=n.get(Xe);return{id:An.id,subId:Do.id,type:I.MenuItemType.BUTTON,icon:"BrushIcon",title:"Format Painter",tooltip:"toolbar.formatPainter",activated$:new O.Observable(e=>{let t=!1;const r=o.status$.subscribe(i=>{t=i!==xe.OFF,e.next(t)});return e.next(t),()=>{r.unsubscribe()}}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetCopyPermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0)}}function ng(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(a.IContextService),r=n.get(m.SheetsSelectionsService);return{id:Bt.id,type:I.MenuItemType.BUTTON,icon:"BoldIcon",title:"Set bold",tooltip:"toolbar.bold",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),activated$:_e(e,!1,({worksheet:i})=>new O.Observable(s=>{var u;const l=o.onCommandExecuted(h=>{var S,p;const g=h.id;if(g===m.SetRangeValuesMutation.id||g===m.SetSelectionsOperation.id||g===m.SetWorksheetActiveOperation.id){const f=(S=r.getCurrentLastSelection())==null?void 0:S.primary;let v=a.FontWeight.NORMAL;if(f!=null){const C=i.getRange(f.startRow,f.startColumn);v=C==null?void 0:C.getFontWeight()}s.next(v===a.FontWeight.BOLD)}if((g===ve.SetTextSelectionsOperation.id||g===J.SetInlineFormatCommand.id)&&t.getContextValue(a.EDITOR_ACTIVATED)&&t.getContextValue(a.FOCUSING_SHEET)){const f=kr(n);if(f==null)return;const v=(p=f.ts)==null?void 0:p.bl;s.next(v===a.BooleanNumber.TRUE)}}),c=(u=r.getCurrentLastSelection())==null?void 0:u.primary;if(!i){s.next(!1);return}let d=a.FontWeight.NORMAL;if(c!=null){const h=i.getRange(c.startRow,c.startColumn);d=h==null?void 0:h.getFontWeight()}return s.next(d===a.FontWeight.BOLD),l.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function rg(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(a.IContextService);return{id:Ft.id,type:I.MenuItemType.BUTTON,icon:"ItalicIcon",title:"Set italic",tooltip:"toolbar.italic",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),activated$:_e(e,!1,({worksheet:i})=>new O.Observable(s=>{var u;const l=o.onCommandExecuted(h=>{var S,p;const g=h.id;if(g===m.SetRangeValuesMutation.id||g===m.SetSelectionsOperation.id||g===m.SetWorksheetActiveOperation.id){const f=(S=t.getCurrentLastSelection())==null?void 0:S.primary;let v=a.FontItalic.NORMAL;if(f!=null){const C=i.getRange(f.startRow,f.startColumn);v=C==null?void 0:C.getFontStyle()}s.next(v===a.FontItalic.ITALIC)}if((g===ve.SetTextSelectionsOperation.id||g===J.SetInlineFormatCommand.id)&&r.getContextValue(a.EDITOR_ACTIVATED)&&r.getContextValue(a.FOCUSING_SHEET)){const f=kr(n);if(f==null)return;const v=(p=f.ts)==null?void 0:p.it;s.next(v===a.BooleanNumber.TRUE)}}),c=(u=t.getCurrentLastSelection())==null?void 0:u.primary;let d=a.FontItalic.NORMAL;if(c!=null){const h=i.getRange(c.startRow,c.startColumn);d=h==null?void 0:h.getFontStyle()}return s.next(d===a.FontItalic.ITALIC),l.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function og(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(a.IContextService);return{id:jt.id,type:I.MenuItemType.BUTTON,icon:"UnderlineIcon",title:"Set underline",tooltip:"toolbar.underline",activated$:_e(e,!1,({worksheet:i})=>new O.Observable(s=>{var u;const l=o.onCommandExecuted(h=>{var S,p;const g=h.id;if(g===m.SetRangeValuesMutation.id||g===m.SetSelectionsOperation.id||g===m.SetWorksheetActiveOperation.id){const f=(S=t.getCurrentLastSelection())==null?void 0:S.primary;let v;if(f!=null){const C=i.getRange(f.startRow,f.startColumn);v=C==null?void 0:C.getUnderline()}s.next(!!(v&&v.s))}if((g===ve.SetTextSelectionsOperation.id||g===J.SetInlineFormatCommand.id)&&r.getContextValue(a.EDITOR_ACTIVATED)&&r.getContextValue(a.FOCUSING_SHEET)){const f=kr(n);if(f==null)return;const v=(p=f.ts)==null?void 0:p.ul;s.next((v==null?void 0:v.s)===a.BooleanNumber.TRUE)}}),c=(u=t.getCurrentLastSelection())==null?void 0:u.primary;let d;if(c!=null){const h=i.getRange(c.startRow,c.startColumn);d=h==null?void 0:h.getUnderline()}return s.next(!!(d&&d.s)),l.dispose})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ig(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(a.IContextService);return{id:zt.id,type:I.MenuItemType.BUTTON,icon:"StrikethroughIcon",title:"Set strike through",tooltip:"toolbar.strikethrough",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),activated$:_e(e,!1,({worksheet:i})=>new O.Observable(s=>{var u;const l=o.onCommandExecuted(h=>{var S,p;const g=h.id;if(g===m.SetRangeValuesMutation.id||g===m.SetSelectionsOperation.id||g===m.SetWorksheetActiveOperation.id){const f=(S=t.getCurrentLastSelection())==null?void 0:S.primary;let v;if(f!=null){const C=i.getRange(f.startRow,f.startColumn);v=C==null?void 0:C.getStrikeThrough()}s.next(!!(v&&v.s))}if((g===ve.SetTextSelectionsOperation.id||g===J.SetInlineFormatCommand.id)&&r.getContextValue(a.EDITOR_ACTIVATED)&&r.getContextValue(a.FOCUSING_SHEET)){const f=kr(n);if(f==null)return;const v=(p=f.ts)==null?void 0:p.st;s.next((v==null?void 0:v.s)===a.BooleanNumber.TRUE)}}),c=(u=t.getCurrentLastSelection())==null?void 0:u.primary;let d;if(c!=null){const h=i.getRange(c.startRow,c.startColumn);d=h==null?void 0:h.getStrikeThrough()}return s.next(!!(d&&d.s)),l.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function sg(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=a.DEFAULT_STYLES.ff;return{id:pr.id,tooltip:"toolbar.font",type:I.MenuItemType.SELECTOR,label:I.FONT_FAMILY_COMPONENT,selections:I.FONT_FAMILY_LIST.map(i=>({label:{name:I.FONT_FAMILY_ITEM_COMPONENT},value:i.value})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),value$:_e(e,r,({worksheet:i})=>new O.Observable(s=>{const l=()=>{var h;let d=r;const u=(h=t.getCurrentLastSelection())==null?void 0:h.primary;if(u!=null){const g=i.getCellStyle(u.startRow,u.startColumn),S=i.getDefaultCellStyleInternal(),p=i.getRowStyle(u.startRow),f=i.getColumnStyle(u.startColumn),v=a.composeStyles(S,p,f,g);v.ff&&(d=v.ff)}s.next(d)},c=o.onCommandExecuted(d=>{const u=d.id;(u===m.SetRangeValuesMutation.id||u===m.SetSelectionsOperation.id||u===m.SetWorksheetActiveOperation.id)&&l()});return l(),c.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ag(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=n.get(a.IContextService),i=a.DEFAULT_STYLES.fs,s=ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0);return{id:Sr.id,type:I.MenuItemType.SELECTOR,tooltip:"toolbar.fontSize",label:{name:I.FONT_SIZE_COMPONENT,props:{min:1,max:400,disabled$:s}},selections:I.FONT_SIZE_LIST,disabled$:s,value$:_e(e,i,({worksheet:l})=>new O.Observable(c=>{const d=()=>{var p;let g=i;const S=(p=t.getCurrentLastSelection())==null?void 0:p.primary;if(S!=null){const f=l.getComposedCellStyle(S.startRow,S.startColumn);f.fs&&(g=f.fs)}c.next(g)},u=()=>{var S,p;const g=kr(n);if(g!=null){const f=(p=(S=g.ts)==null?void 0:S.fs)!=null?p:i;c.next(f)}},h=o.onCommandExecuted(g=>{const S=g.id;(S===m.SetRangeValuesMutation.id||S===m.SetSelectionsOperation.id||S===m.SetWorksheetActiveOperation.id)&&d(),(S===ve.SetTextSelectionsOperation.id||S===J.SetInlineFormatCommand.id)&&r.getContextValue(a.EDITOR_ACTIVATED)&&r.getContextValue(a.FOCUSING_SHEET)&&u()});return d(),h.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function lg(n){return{id:Ao.id,type:I.MenuItemType.BUTTON,title:"toolbar.resetColor",icon:"NoColorDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function cg(n){const o=n.get(a.ICommandService),e=n.get(a.ThemeService),t=n.get(m.SheetsSelectionsService);return{id:pn.id,icon:"FontColorDoubleIcon",tooltip:"toolbar.textColor.main",type:I.MenuItemType.BUTTON_SELECTOR,selections:[{label:{name:I.COLOR_PICKER_COMPONENT,hoverable:!1,selectable:!1},value$:new O.Observable(r=>{var c;const i=a.DEFAULT_STYLES.cl.rgb,{isAllValuesSame:s,value:l}=t.getCellStylesProperty("cl");s?r.next((c=l==null?void 0:l.rgb)!=null?c:i):r.next(i)})}],value$:new O.Observable(r=>{const i=e.getColorFromTheme("gray.900"),s=o.onCommandExecuted(l=>{if(l.id===pn.id){const c=l.params.value;r.next(c!=null?c:i)}});return r.next(i),s.dispose}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]},!0)}}function dg(n){return{id:m.ResetBackgroundColorCommand.id,type:I.MenuItemType.BUTTON,title:"toolbar.resetColor",icon:"NoColorDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function ug(n){const o=n.get(a.ICommandService),e=n.get(a.ThemeService),t=n.get(m.SheetsSelectionsService);return{id:m.SetBackgroundColorCommand.id,tooltip:"toolbar.fillColor.main",type:I.MenuItemType.BUTTON_SELECTOR,icon:"PaintBucketDoubleIcon",selections:[{label:{name:I.COLOR_PICKER_COMPONENT,hoverable:!1,selectable:!1},value$:new O.Observable(r=>{var c;const i=a.DEFAULT_STYLES.bg.rgb,{isAllValuesSame:s,value:l}=t.getCellStylesProperty("bg");s?r.next((c=l==null?void 0:l.rgb)!=null?c:i):r.next(i)})}],value$:new O.Observable(r=>{const i=e.getColorFromTheme("primary.600"),s=o.onCommandExecuted(l=>{if(l.id===m.SetBackgroundColorCommand.id){const c=l.params.value;r.next(c!=null?c:i)}});return r.next(i),s.dispose}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}const ua=[{label:"align.left",icon:"LeftJustifyingIcon",value:a.HorizontalAlign.LEFT},{label:"align.center",icon:"HorizontallyIcon",value:a.HorizontalAlign.CENTER},{label:"align.right",icon:"RightJustifyingIcon",value:a.HorizontalAlign.RIGHT}];function hg(n){var s,l;const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=o.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET),r=t==null?void 0:t.getActiveSheet().getDefaultCellStyleInternal(),i=(s=r==null?void 0:r.ht)!=null?s:a.HorizontalAlign.LEFT;return{id:m.SetHorizontalTextAlignCommand.id,icon:(l=ua.find(c=>c.value===i))==null?void 0:l.icon,tooltip:"toolbar.horizontalAlignMode.main",type:I.MenuItemType.SELECTOR,selections:ua,value$:_e(o,i,({worksheet:c})=>new O.Observable(d=>{var S,p;const u=n.get(a.ICommandService).onCommandExecuted(f=>{var R,w;const v=f.id;if(v!==m.SetHorizontalTextAlignCommand.id&&v!==m.SetSelectionsOperation.id&&v!==m.SetWorksheetActiveOperation.id)return;const C=(R=e.getCurrentLastSelection())==null?void 0:R.primary;let _;if(C!=null){const P=c.getRange(C.startRow,C.startColumn),y=t==null?void 0:t.getActiveSheet().getComposedCellStyle(C.startRow,C.startColumn);_=(w=y==null?void 0:y.ht)!=null?w:P==null?void 0:P.getHorizontalAlignment()}d.next(_!=null?_:i)}),h=(S=e.getCurrentLastSelection())==null?void 0:S.primary;let g;if(h!=null){const f=c.getRange(h.startRow,h.startColumn),v=t==null?void 0:t.getActiveSheet().getComposedCellStyle(h.startRow,h.startColumn);g=(p=v==null?void 0:v.ht)!=null?p:f==null?void 0:f.getHorizontalAlignment()}return d.next(g!=null?g:i),u.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}const ha=[{label:"align.top",icon:"AlignTopIcon",value:a.VerticalAlign.TOP},{label:"align.middle",icon:"VerticalCenterIcon",value:a.VerticalAlign.MIDDLE},{label:"align.bottom",icon:"AlignBottomIcon",value:a.VerticalAlign.BOTTOM}];function mg(n){var s,l;const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=o.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET),r=t==null?void 0:t.getActiveSheet().getDefaultCellStyleInternal(),i=(s=r==null?void 0:r.vt)!=null?s:a.VerticalAlign.BOTTOM;return{id:m.SetVerticalTextAlignCommand.id,icon:(l=ha.find(c=>c.value===i))==null?void 0:l.icon,tooltip:"toolbar.verticalAlignMode.main",type:I.MenuItemType.SELECTOR,selections:ha,value$:_e(o,i,({worksheet:c})=>new O.Observable(d=>{var S,p;const u=n.get(a.ICommandService).onCommandExecuted(f=>{var R,w;const v=f.id;if(v!==m.SetVerticalTextAlignCommand.id&&v!==m.SetSelectionsOperation.id&&v!==m.SetWorksheetActiveOperation.id)return;const C=(R=e.getCurrentLastSelection())==null?void 0:R.primary;let _;if(C!=null){const P=c.getRange(C.startRow,C.startColumn),y=t==null?void 0:t.getActiveSheet().getComposedCellStyle(C.startRow,C.startColumn);_=(w=y==null?void 0:y.vt)!=null?w:P==null?void 0:P.getVerticalAlignment()}d.next(_!=null?_:i)}),h=(S=e.getCurrentLastSelection())==null?void 0:S.primary;let g;if(h!=null){const f=c.getRange(h.startRow,h.startColumn),v=t==null?void 0:t.getActiveSheet().getComposedCellStyle(h.startRow,h.startColumn);g=(p=v==null?void 0:v.vt)!=null?p:f==null?void 0:f.getVerticalAlignment()}return d.next(g!=null?g:i),u.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}const ma=[{label:"textWrap.overflow",icon:"OverflowIcon",value:a.WrapStrategy.OVERFLOW},{label:"textWrap.wrap",icon:"AutowrapIcon",value:a.WrapStrategy.WRAP},{label:"textWrap.clip",icon:"TruncationIcon",value:a.WrapStrategy.CLIP}];function gg(n){var s,l;const o=n.get(m.SheetsSelectionsService),e=n.get(a.IUniverInstanceService),t=e.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET),r=t==null?void 0:t.getActiveSheet().getDefaultCellStyleInternal(),i=(s=r==null?void 0:r.tb)!=null?s:a.WrapStrategy.OVERFLOW;return{id:m.SetTextWrapCommand.id,tooltip:"toolbar.textWrapMode.main",icon:(l=ma.find(c=>c.value===i))==null?void 0:l.icon,type:I.MenuItemType.SELECTOR,selections:ma,value$:_e(e,i,({worksheet:c})=>new O.Observable(d=>{var S,p;const u=n.get(a.ICommandService).onCommandExecuted(f=>{var R,w;const v=f.id;if(v!==m.SetTextWrapCommand.id&&v!==m.SetSelectionsOperation.id&&v!==m.SetWorksheetActiveOperation.id)return;const C=(R=o.getCurrentLastSelection())==null?void 0:R.primary;let _;if(C!=null){const P=c.getRange(C.startRow,C.startColumn),y=t==null?void 0:t.getActiveSheet().getComposedCellStyle(C.startRow,C.startColumn);_=(w=y==null?void 0:y.tb)!=null?w:P==null?void 0:P.getWrapStrategy()}d.next(_!=null?_:i)}),h=(S=o.getCurrentLastSelection())==null?void 0:S.primary;let g;if(h!=null){const f=c.getRange(h.startRow,h.startColumn),v=t==null?void 0:t.getActiveSheet().getComposedCellStyle(h.startRow,h.startColumn);g=(p=v==null?void 0:v.tb)!=null?p:f==null?void 0:f.getWrapStrategy()}return d.next(g!=null?g:i),u.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}const ga=[{label:"textRotate.none",icon:"NoRotationIcon",value:0},{label:"textRotate.angleUp",icon:"LeftRotationFortyFiveDegreesIcon",value:-45},{label:"textRotate.angleDown",icon:"RightRotationFortyFiveDegreesIcon",value:45},{label:"textRotate.vertical",icon:"VerticalTextIcon",value:"v"},{label:"textRotate.rotationUp",icon:"LeftRotationNinetyDegreesIcon",value:-90},{label:"textRotate.rotationDown",icon:"RightRotationNinetyDegreesIcon",value:90}];function Sg(n){const o=n.get(m.SheetsSelectionsService),e=n.get(a.IUniverInstanceService),t=0;return{id:m.SetTextRotationCommand.id,tooltip:"toolbar.textRotateMode.main",icon:ga[0].icon,type:I.MenuItemType.SELECTOR,selections:ga,value$:_e(e,t,({worksheet:r})=>new O.Observable(i=>{var d,u;const s=n.get(a.ICommandService).onCommandExecuted(h=>{var f,v;const g=h.id;if(g!==m.SetTextRotationCommand.id&&g!==m.SetSelectionsOperation.id&&g!==m.SetWorksheetActiveOperation.id)return;const S=(f=o.getCurrentLastSelection())==null?void 0:f.primary;let p;if(S!=null){const C=r.getRange(S.startRow,S.startColumn);p=C==null?void 0:C.getTextRotation()}(p==null?void 0:p.v)===a.BooleanNumber.TRUE?i.next("v"):i.next((v=p&&p.a)!=null?v:t)}),l=(d=o.getCurrentLastSelection())==null?void 0:d.primary;let c;if(l!=null){const h=r.getRange(l.startRow,l.startColumn);c=h==null?void 0:h.getTextRotation()}return(c==null?void 0:c.v)===a.BooleanNumber.TRUE?i.next("v"):i.next((u=c&&c.a)!=null?u:t),s.dispose})),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function Nr(n){return new O.Observable(e=>e.next(!n.get(I.IClipboardInterfaceService).supportClipboard))}function cn(n){return{id:He.name,commandId:He.id,type:I.MenuItemType.BUTTON,title:"rightClick.copy",icon:"CopyDoubleIcon",disabled$:ee(n,{workbookTypes:[m.WorkbookCopyPermission],worksheetTypes:[m.WorksheetCopyPermission],rangeTypes:[m.RangeProtectionPermissionViewPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Ko(n){return{id:Ve.name,commandId:Ve.id,type:I.MenuItemType.BUTTON,title:"rightClick.paste",icon:"PasteSpecialDoubleIcon",disabled$:Nr(n).pipe(O.combineLatestWith(ee(n,{rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission,m.WorksheetSetCellValuePermission],workbookTypes:[m.WorkbookEditablePermission]})),O.map(([o,e])=>o||e)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}const tr="sheet.menu.paste-special";function qo(n){return{id:tr,type:I.MenuItemType.SUBITEMS,icon:"PasteSpecialDoubleIcon",title:"rightClick.pasteSpecial",hidden$:Zt(n,I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET))}}function Qo(n){return{id:on.id,type:I.MenuItemType.BUTTON,title:"rightClick.pasteValue",disabled$:Nr(n).pipe(O.combineLatestWith(ee(n,{rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellValuePermission,m.WorksheetEditPermission],workbookTypes:[m.WorkbookEditablePermission]})),O.map(([o,e])=>o||e)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Jo(n){return{id:sn.id,type:I.MenuItemType.BUTTON,title:"rightClick.pasteFormat",disabled$:Nr(n).pipe(O.combineLatestWith(ee(n,{rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellStylePermission,m.WorksheetEditPermission],workbookTypes:[m.WorkbookEditablePermission]})),O.map(([o,e])=>o||e)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function $o(n){return{id:yt.id,type:I.MenuItemType.BUTTON,title:"rightClick.pasteColWidth",disabled$:Nr(n).pipe(O.combineLatestWith(ee(n,{rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetColumnStylePermission,m.WorksheetEditPermission],workbookTypes:[m.WorkbookEditablePermission]})),O.map(([o,e])=>o||e))}}function ei(n){return{id:an.id,type:I.MenuItemType.BUTTON,title:"rightClick.pasteBesidesBorder",disabled$:Nr(n).pipe(O.combineLatestWith(ee(n,{rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellStylePermission,m.WorksheetSetCellValuePermission,m.WorksheetSetRowStylePermission,m.WorksheetSetColumnStylePermission],workbookTypes:[m.WorkbookEditablePermission]})),O.map(([o,e])=>o||e)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function pg(n){return{id:m.SetWorksheetRowIsAutoHeightCommand.id,type:I.MenuItemType.BUTTON,icon:"AutoHeightDoubleIcon",title:"rightClick.fitContent",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetSetRowStylePermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function fg(n){return{id:Dn.id,type:I.MenuItemType.BUTTON,icon:"AutoWidthDoubleIcon",title:"rightClick.fitContent",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetSetRowStylePermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}const Kl="sheet.menu.sheet-frozen";function vg(n){return{id:Kl,type:I.MenuItemType.SUBITEMS,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}const Ni="sheet.header-menu.sheet-frozen";function Sa(n){return{id:Ni,type:I.MenuItemType.SUBITEMS,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ti(n){return{id:rt.id,type:I.MenuItemType.BUTTON,title:"rightClick.freeze",icon:"FreezeToSelectedIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Cg(n){return{id:Er.id,type:I.MenuItemType.BUTTON,title:"rightClick.freezeRow",icon:"FreezeRowIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Ig(n){return{id:Tr.id,type:I.MenuItemType.BUTTON,title:"rightClick.freezeCol",icon:"FreezeColumnIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ni(n){return{id:m.CancelFrozenCommand.id,type:I.MenuItemType.BUTTON,title:"rightClick.cancelFreeze",icon:"CancelFreezeIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function _g(n){return{id:mr.id,type:I.MenuItemType.BUTTON,icon:"HideDoubleIcon",title:"rightClick.hideSelectedRow",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetSetRowStylePermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function bg(n){return{id:gr.id,type:I.MenuItemType.BUTTON,icon:"HideDoubleIcon",title:"rightClick.hideSelectedColumn",disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetColumnStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]}),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Rg(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=[m.SetSelectionsOperation,m.SetRowHiddenMutation,m.SetRowVisibleMutation].map(i=>i.id);return{id:m.SetSelectedRowsVisibleCommand.id,type:I.MenuItemType.BUTTON,icon:"EyeOutlineIcon",title:"rightClick.showHideRow",hidden$:_e(o,!0,({worksheet:i})=>new O.Observable(s=>{function l(){var u;const d=(u=e.getCurrentSelections())==null?void 0:u.map(h=>h.range).filter(h=>h.rangeType===a.RANGE_TYPE.ROW);return!!(d!=null&&d.some(h=>{for(let g=h.startRow;g<=h.endRow;g++)if(!i.getRowRawVisible(g))return!0;return!1}))}const c=t.onCommandExecuted(d=>{r.findIndex(u=>u===d.id)!==-1&&s.next(!l())});return s.next(!l()),()=>c.dispose()})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetRowStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function wg(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.SheetsSelectionsService),t=n.get(a.ICommandService),r=[m.SetSelectionsOperation,m.SetColHiddenMutation,m.SetColVisibleMutation].map(i=>i.id);return{id:m.SetSelectedColsVisibleCommand.id,type:I.MenuItemType.BUTTON,icon:"EyeOutlineIcon",title:"rightClick.showHideColumn",hidden$:_e(o,!0,({worksheet:i})=>new O.Observable(s=>{function l(){var u;const d=(u=e.getCurrentSelections())==null?void 0:u.map(h=>h.range).filter(h=>h.rangeType===a.RANGE_TYPE.COLUMN);return!d||d.length===0?!1:!!d.some(h=>{for(let g=h.startColumn;g<=h.endColumn;g++)if(!i.getColVisible(g))return!0;return!1})}const c=t.onCommandExecuted(d=>{r.findIndex(u=>u===d.id)!==-1&&s.next(!l())});return s.next(!l()),()=>c.dispose()})),disabled$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetSetColumnStylePermission,m.WorksheetEditPermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function Eg(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=2;return{id:m.SetRowHeightCommand.id,type:I.MenuItemType.BUTTON,icon:"AdjustHeightDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.rowHeight",suffix:"px",min:r,max:1e3}},value$:_e(e,r,({worksheet:i})=>new O.Observable(s=>{function l(){var h;const d=(h=t.getCurrentLastSelection())==null?void 0:h.primary,u=d?i.getRowHeight(d.startRow):i.getConfig().defaultRowHeight;s.next(u)}const c=o.onCommandExecuted(d=>{const u=d.id;if(u===m.SetRangeValuesMutation.id||u===m.SetSelectionsOperation.id||u===m.SetWorksheetRowIsAutoHeightMutation.id)return l()});return l(),c.dispose})),hidden$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetRowStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function Tg(n){const o=n.get(a.ICommandService),e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=2;return{id:m.SetColWidthCommand.id,type:I.MenuItemType.BUTTON,icon:"AdjustWidthDoubleIcon",label:{name:Ge,props:{prefix:"rightClick.columnWidth",suffix:"px",min:r,max:1e3}},value$:_e(e,r,({worksheet:i})=>new O.Observable(s=>{function l(){var h;const d=(h=t.getCurrentLastSelection())==null?void 0:h.primary,u=d?i.getColumnWidth(d.startColumn):i.getConfig().defaultColumnWidth;s.next(u)}const c=o.onCommandExecuted(d=>{const u=d.id;if(u===m.SetRangeValuesMutation.id||u===m.SetSelectionsOperation.id||u===m.SetWorksheetColWidthMutation.id)return l()});return l(),c.dispose})),hidden$:ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetColumnStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})}}function kr(n){var c;const o=n.get(a.IUniverInstanceService),e=n.get(ve.DocSelectionManagerService),t=o.getUnit(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY),r=e.getActiveTextRange();if(t==null||r==null)return null;const i=(c=t.getBody())==null?void 0:c.textRuns;if(i==null)return;const{startOffset:s}=r;return i.find(({st:d,ed:u})=>s>=d&&s<=u)}const Ct={type:a.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge",handler:async(n,o)=>{const e=n.get(a.ICommandService),t=n.get(a.IUndoRedoService),r=n.get(a.IUniverInstanceService),i=n.get(I.IConfirmService),s=n.get(a.LocaleService),l=o.unitId,c=o.subUnitId,d=o.selections,u=m.getAddMergeMutationRangeByType(d,o.value),h=r.getUniverSheetInstance(l).getSheetBySheetId(c),g=[],S=[],p=$a(h,u);if(p&&!o.defaultMerge&&!await i.confirm({id:"merge.confirm.add-worksheet-merge",title:{title:"merge.confirm.warning"},children:{title:"merge.confirm.title"},cancelText:s.t("merge.confirm.cancel"),confirmText:s.t("merge.confirm.confirm")}))return!1;const f={unitId:l,subUnitId:c,ranges:a.Tools.deepClone(u)},v={unitId:l,subUnitId:c,ranges:a.Tools.deepClone(u)},C=m.RemoveMergeUndoMutationFactory(n,f),_=m.AddMergeUndoMutationFactory(n,v);if(C.ranges.length>0&&g.push({id:m.RemoveWorksheetMergeMutation.id,params:C}),g.push({id:m.AddWorksheetMergeMutation.id,params:v}),S.push({id:m.RemoveWorksheetMergeMutation.id,params:_}),C.ranges.length>0&&S.push({id:m.AddWorksheetMergeMutation.id,params:C}),p){const x=el(n,l,h,u);g.unshift(...x.redos),S.push(...x.undos)}const R=m.AddMergeRedoSelectionsOperationFactory(n,o,u);R&&g.push(R);const w=m.AddMergeUndoSelectionsOperationFactory(n,o);w&&S.push(w);const y=n.get(m.SheetInterceptorService).onCommandExecute({id:Ct.id,params:{unitId:l,subUnitId:c,ranges:u}});return g.push(...y.redos),S.push(...y.undos),a.sequenceExecute(g,e).result?(t.pushUndoRedo({unitID:l,undoMutations:S,redoMutations:g}),!0):!1}},vs={type:a.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-all",handler:async n=>{var u;const o=n.get(a.ICommandService),t=(u=n.get(m.SheetsSelectionsService).getCurrentSelections())==null?void 0:u.map(h=>h.range),r=$i(Oo.MergeAll,t);if(!(r!=null&&r.length))return!1;const s=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!s)return!1;const l=s.getActiveSheet();if(!l)return!1;const c=s.getUnitId(),d=l.getSheetId();return o.executeCommand(Ct.id,{selections:r,unitId:c,subUnitId:d})}},Cs={type:a.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-vertical",handler:async n=>{var u;const o=n.get(a.ICommandService),t=(u=n.get(m.SheetsSelectionsService).getCurrentSelections())==null?void 0:u.map(h=>h.range),r=$i(Oo.MergeVertical,t);if(!(r!=null&&r.length))return!1;const s=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!s)return!1;const l=s.getActiveSheet();if(!l)return!1;const c=s.getUnitId(),d=l.getSheetId();return o.executeCommand(Ct.id,{value:a.Dimension.COLUMNS,selections:r,unitId:c,subUnitId:d})}},Is={type:a.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-horizontal",handler:async n=>{var u;const o=n.get(a.ICommandService),t=(u=n.get(m.SheetsSelectionsService).getCurrentSelections())==null?void 0:u.map(h=>h.range),r=$i(Oo.MergeHorizontal,t);if(!(r!=null&&r.length))return!1;const s=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!s)return!1;const l=s.getActiveSheet();if(!l)return!1;const c=s.getUnitId(),d=l.getSheetId();return o.executeCommand(Ct.id,{value:a.Dimension.ROWS,selections:r,unitId:c,subUnitId:d})}};function yg(n){const o=n.get(m.SheetsSelectionsService),e=n.get(m.RangeProtectionRuleModel),t=n.get(a.IUniverInstanceService),r=n.get(m.MergeCellController),i=t.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET);return O.combineLatest([o.selectionMoveEnd$,i.pipe(O.map(s=>{var l;return(l=s==null?void 0:s.getUnitId())!=null?l:""})),i.pipe(O.switchMap(s=>{var l;return(l=s==null?void 0:s.activeSheet$)!=null?l:O.of(null)}))]).pipe(O.map(([s,l,c])=>{if(!c||!s||s.length===0)return!1;const d=c.getSheetId(),u=s.map(S=>S.range);if(r.interceptor.fetchThroughInterceptors(m.MERGE_CELL_INTERCEPTOR_CHECK)(!1,u))return!0;const g=e.getSubunitRuleList(l,d).map(S=>S.ranges).flat();if(s.length<2){const S=s[0].range;return g.some(f=>a.Rectangle.intersects(f,S)&&!a.Rectangle.contains(f,S))}for(let S=0;S<s.length;S++)for(let p=S+1;p<s.length;p++)if(a.Rectangle.intersects(s[S].range,s[p].range))return!0;return!1}))}function ql(n,o){return!!lr(n,o,a.RANGE_TYPE.ROW)}function Ql(n,o){return!!lr(n,o,a.RANGE_TYPE.COLUMN)}function lr(n,o,e){return n.find(r=>{const i=r.range,{startRow:s,endRow:l,startColumn:c,endColumn:d,rangeType:u}=i;return u===a.RANGE_TYPE.ALL||u===a.RANGE_TYPE.NORMAL?!1:u===e&&(e===a.RANGE_TYPE.COLUMN&&c<=o&&o<=d||e===a.RANGE_TYPE.ROW&&s<=o&&o<=l)})}function Mg(n){const o=Zt(n,ee(n,{workbookTypes:[m.WorkbookEditablePermission],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellValuePermission,m.WorksheetSetCellStylePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint]})),e=yg(n);return{id:Ct.id,icon:"MergeAllIcon",tooltip:"toolbar.mergeCell.main",type:I.MenuItemType.SUBITEMS,hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:o.pipe(O.combineLatestWith(e),O.map(([t,r])=>t||r))}}function Pg(n){return{id:vs.id,type:I.MenuItemType.BUTTON,title:"merge.all",icon:"MergeAllIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function xg(n){return{id:Cs.id,type:I.MenuItemType.BUTTON,title:"merge.vertical",icon:"VerticalIntegrationIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Og(n){return{id:Is.id,type:I.MenuItemType.BUTTON,title:"merge.horizontal",icon:"HorizontalMergeIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Ag(n){return{id:m.RemoveWorksheetMergeCommand.id,type:I.MenuItemType.BUTTON,title:"merge.cancel",icon:"CancelMergeIcon",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Dg(n){const e=n.get(a.IUniverInstanceService).getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),t=n.get(a.UserManagerService);return O.combineLatest([e,t.currentUser$]).pipe(O.switchMap(([r,i])=>r?r.activeSheet$.pipe(O.switchMap(s=>{if(!s)return O.of(!0);const l=n.get(m.RangeProtectionRuleModel),c=n.get(m.WorksheetProtectionRuleModel),d=n.get(m.SheetsSelectionsService);return O.merge(d.selectionMoveEnd$,l.ruleChange$,c.ruleChange$).pipe(O.map(()=>{const u=r.getUnitId(),h=s.getSheetId(),g=l.getSubunitRuleList(u,h),S=d.getCurrentSelections(),p=S==null?void 0:S.map(C=>C.range),f=g.map(C=>C.ranges).flat();if(!p)return!1;const v=c.getRule(u,h);return v!=null&&v.permissionId?!0:p==null?void 0:p.some(C=>f.some(_=>a.Rectangle.intersects(C,_)))}))})):O.of(!0)))}function Ng(n){const o=n.get(a.IUniverInstanceService),e=n.get(m.RangeProtectionRuleModel),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{if(!l)return O.of(!0);const c=n.get(m.RangeProtectionRuleModel),d=n.get(m.WorksheetProtectionRuleModel),u=n.get(a.IPermissionService),h=n.get(m.SheetsSelectionsService);return O.merge(h.selectionMoveEnd$,c.ruleChange$,d.ruleChange$).pipe(O.map(()=>{var x,A;const g=i.getUnitId(),S=l.getSheetId(),p=e.getSubunitRuleList(g,S),f=(x=h.getCurrentSelections())==null?void 0:x.map(D=>D.range);if(p.map(D=>D.ranges).flat(),!(f!=null&&f.length)||f.length>1)return!0;const v=f[0];if((v==null?void 0:v.rangeType)===a.RANGE_TYPE.ALL||(v==null?void 0:v.rangeType)===a.RANGE_TYPE.COLUMN||(v==null?void 0:v.rangeType)===a.RANGE_TYPE.ROW)return!0;const C=d.getRule(g,S);if(C!=null&&C.permissionId)return((A=u.getPermissionPoint(new m.WorksheetManageCollaboratorPermission(g,S).id))==null?void 0:A.value)===!1;if(p.filter(D=>D.ranges.some(N=>a.Rectangle.intersects(N,v))).length!==1)return!0;const{startRow:R,endRow:w,startColumn:P,endColumn:y}=v,M=n.get(m.RangeProtectionCache);for(let D=R;D<=w;D++)for(let N=P;N<=y;N++){const V=M.getCellInfo(g,S,D,N);if(V)return V[m.UnitAction.ManageCollaborator]===!1}return!1}))})):O.of(!0)))}function kg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{var p;if(!l)return O.of(!0);const c=i.getUnitId(),d=n.get(m.SheetsSelectionsService),u=n.get(m.RangeProtectionRuleModel),h=n.get(m.WorksheetProtectionRuleModel),g=(p=e.composePermission$([new m.WorkbookEditablePermission(c).id]).pipe(O.map(f=>f.every(v=>v.value))))!=null?p:O.of(!1),S=O.merge(u.ruleChange$,h.ruleChange$).pipe(O.startWith(null));return O.combineLatest([g,S,d.selectionMoveEnd$]).pipe(O.map(([f,v,C])=>{if(!f)return!0;const _=d.getCurrentSelections(),R=_==null?void 0:_.map(w=>w.range);return R!=null&&R.length?R.length>1:!1}))})):O.of(!0)))}function Jl(n){var d;const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService),i=n.has(he)?n.get(he):null,l=n.get(a.IContextService).subscribeContextValue$(a.FOCUSING_FX_BAR_EDITOR).pipe(O.startWith(!1),O.shareReplay(1)),c=(d=i==null?void 0:i.visible$.pipe(O.startWith(null),O.shareReplay(1)))!=null?d:O.of(null);return O.combineLatest([t,r.currentUser$,c,l]).pipe(O.switchMap(([u,h,g,S])=>!u||g!=null&&g.visible&&g.unitId===u.getUnitId()||S?O.of(!0):u.activeSheet$.pipe(O.switchMap(p=>{var x;if(!p)return O.of(!0);const v=n.get(a.IContextService).subscribeContextValue$(a.FOCUSING_COMMON_DRAWINGS).pipe(O.startWith(!1)),C=u.getUnitId(),_=p.getSheetId(),R=n.get(m.RangeProtectionRuleModel),w=n.get(m.WorksheetProtectionRuleModel),P=n.get(m.SheetsSelectionsService),y=(x=e.composePermission$([new m.WorkbookCreateProtectPermission(C).id]).pipe(O.map(A=>A.every(D=>D.value))))!=null?x:O.of(!1),M=O.merge(R.ruleChange$,w.ruleChange$).pipe(O.startWith(null));return O.combineLatest([y,M,P.selectionMoveEnd$,v]).pipe(O.map(([A,D,N,V])=>{if(!A||V)return!0;const H=P.getCurrentSelections(),k=H==null?void 0:H.map(B=>B.range);if(!(k!=null&&k.length))return!0;const U=w.getRule(C,_);if(U!=null&&U.permissionId)return!0;const L=R.getSubunitRuleList(C,_);return k==null?void 0:k.some(B=>L.some(z=>z.ranges.some(X=>a.Rectangle.intersects(B,X))))}))}))))}function Hg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{var p;if(!l)return O.of(!0);const c=i.getUnitId(),d=l.getSheetId(),u=n.get(m.RangeProtectionRuleModel),h=n.get(m.WorksheetProtectionRuleModel),g=(p=e.composePermission$([new m.WorkbookCreateProtectPermission(c).id]).pipe(O.map(f=>f.every(v=>v.value))))!=null?p:O.of(!1),S=O.merge(u.ruleChange$,h.ruleChange$).pipe(O.startWith(null));return O.combineLatest([g,S]).pipe(O.map(([f,v])=>{var R;if(!f)return!0;const C=h.getRule(c,d);return C!=null&&C.permissionId?!0:((R=u.getSubunitRuleList(c,d))==null?void 0:R.filter(w=>w==null?void 0:w.permissionId)).length>0}))})):O.of(!0)))}function Vg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{if(!l)return O.of(!0);const c=i.getUnitId(),d=l.getSheetId(),u=n.get(m.WorksheetProtectionRuleModel);return u.ruleChange$.pipe(O.startWith(null)).pipe(O.map(()=>{var g;return u.getRule(c,d)?((g=e.getPermissionPoint(new m.WorksheetDeleteProtectionPermission(c,d).id))==null?void 0:g.value)===!1:!0}))})):O.of(!0)))}function Wg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{var p;if(!l)return O.of(!0);const c=i.getUnitId(),d=n.get(m.RangeProtectionRuleModel),u=n.get(m.WorksheetProtectionRuleModel),h=(p=e.composePermission$([new m.WorkbookCreateProtectPermission(c).id,new m.WorkbookManageCollaboratorPermission(c).id]).pipe(O.map(f=>f.every(v=>v.value))))!=null?p:O.of(!1),g=u.ruleChange$.pipe(O.startWith(null)),S=d.ruleChange$.pipe(O.startWith(null));return O.combineLatest([h,g,S]).pipe(O.map(([f,v,C])=>{if(!f)return!0;const _=l.getSheetId(),R=u.getRule(c,_),w=d.getSubunitRuleList(c,_);return!(R||w.length)}))})):O.of(!0)))}function Ug(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService);return O.combineLatest([t,r.currentUser$]).pipe(O.switchMap(([i,s])=>i?i.activeSheet$.pipe(O.switchMap(l=>{if(!l)return O.of(!0);const c=i.getUnitId(),d=l.getSheetId(),u=n.get(m.SheetsSelectionsService),h=n.get(m.RangeProtectionRuleModel),g=n.get(m.WorksheetProtectionRuleModel),S=O.merge(h.ruleChange$,g.ruleChange$,u.selectionMoveEnd$).pipe(O.startWith(null));return O.combineLatest([S]).pipe(O.map(([p])=>{var A;const f=n.get(m.SheetsSelectionsService).getCurrentSelections(),v=f==null?void 0:f.map(D=>D.range);if(!(v!=null&&v.length)||v.length>1)return!0;const C=v[0];if((C==null?void 0:C.rangeType)===a.RANGE_TYPE.ALL||(C==null?void 0:C.rangeType)===a.RANGE_TYPE.COLUMN||(C==null?void 0:C.rangeType)===a.RANGE_TYPE.ROW)return!0;const _=g.getRule(c,d);if(_!=null&&_.permissionId)return((A=e.getPermissionPoint(new m.WorksheetDeleteProtectionPermission(c,d).id))==null?void 0:A.value)===!1;if(h.getSubunitRuleList(c,d).filter(D=>D.ranges.some(N=>a.Rectangle.intersects(N,C))).length!==1)return!0;const{startRow:w,endRow:P,startColumn:y,endColumn:M}=C,x=n.get(m.RangeProtectionCache);for(let D=w;D<=P;D++)for(let N=y;N<=M;N++){const V=x.getCellInfo(c,d,D,N);if(V)return V[m.UnitAction.Delete]===!1}return!1}))})):O.of(!0)))}function $l(n){var d;const o=n.get(a.IUniverInstanceService),e=n.get(a.IPermissionService),t=o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET),r=n.get(a.UserManagerService),i=n.has(he)?n.get(he):null,l=n.get(a.IContextService).subscribeContextValue$(a.FOCUSING_FX_BAR_EDITOR),c=(d=i==null?void 0:i.visible$)!=null?d:O.of(null);return O.combineLatest([t,r.currentUser$,c,l]).pipe(O.switchMap(([u,h,g,S])=>!u||g!=null&&g.visible&&g.unitId===u.getUnitId()||S?O.of(!0):u.activeSheet$.pipe(O.switchMap(p=>{var C,_;if(!p)return O.of(!0);const f=u.getUnitId();return((_=(C=e.getPermissionPoint$(new m.WorkbookEditablePermission(f).id))==null?void 0:C.pipe(O.map(R=>!!R.value)))!=null?_:O.of(!1)).pipe(O.map(R=>!R))}))))}const qr="sheet.contextMenu.permission";function Lg(n){return{id:vr.id,type:I.MenuItemType.BUTTON,icon:qa,tooltip:"permission.toolbarMenu",hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET),disabled$:Jl(n)}}function ri(n){return{id:qr,type:I.MenuItemType.SUBITEMS,title:"rightClick.protectRange",icon:Qa,hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function oi(n){return{id:Mt.id,type:I.MenuItemType.BUTTON,title:"rightClick.turnOnProtectRange",hidden$:Dg(n),disabled$:Jl(n)}}function ii(n){return{id:Ot.id,type:I.MenuItemType.BUTTON,title:"rightClick.editProtectRange",disabled$:kg(n),hidden$:Ng(n)}}function si(n){return{id:xt.id,type:I.MenuItemType.BUTTON,title:"rightClick.removeProtectRange",disabled$:Ug(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ai(n){return{id:Pt.id,type:I.MenuItemType.BUTTON,title:"rightClick.viewAllProtectArea",disabled$:$l(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Bg(n){return{id:Cr.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.addProtectSheet",disabled$:Hg(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Fg(n){return{id:Pr.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.removeProtectSheet",disabled$:Vg(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function jg(n){return{id:xr.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.changeSheetPermission",disabled$:Wg(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function zg(n){return{id:Ir.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.viewAllProtectArea",disabled$:$l(n),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Xg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.ICommandService),t=new O.Observable(i=>{const s=e.onCommandExecuted(l=>{const c=l.id;(c===m.RemoveSheetMutation.id||c===m.InsertSheetMutation.id||c===m.SetWorksheetHideMutation.id)&&ao(o,i)});return ao(o,i),s.dispose}),r=Un(n,[m.WorkbookEditablePermission,m.WorkbookDeleteSheetPermission]);return{id:br.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.delete",disabled$:O.combineLatest([t,r]).pipe(O.map(([i,s])=>i||s)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Yg(n){return{id:m.CopySheetCommand.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.copy",disabled$:Un(n,[m.WorkbookEditablePermission,m.WorkbookCreateSheetPermission]),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Zg(n){return{id:Ar.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.rename",disabled$:Un(n,[m.WorkbookEditablePermission,m.WorkbookRenameSheetPermission]),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function Gg(n){return{id:m.SetTabColorCommand.id,title:"sheetConfig.changeColor",type:I.MenuItemType.SELECTOR,selections:[{label:{name:I.COLOR_PICKER_COMPONENT,hoverable:!1}}],hidden$:Un(n,[m.WorkbookEditablePermission])}}function Kg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.ICommandService);return{id:m.SetWorksheetHideCommand.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.hide",disabled$:new O.Observable(t=>{const r=e.onCommandExecuted(i=>{const s=i.id;(s===m.RemoveSheetMutation.id||s===m.InsertSheetMutation.id||s===m.SetWorksheetHideMutation.id)&&ao(o,t)});return ao(o,t),r.dispose}).pipe(O.combineLatestWith(Un(n,[m.WorkbookEditablePermission,m.WorkbookHideSheetPermission])),O.map(([t,r])=>t||r)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function qg(n){const o=n.get(a.IUniverInstanceService),e=n.get(a.ICommandService);return{id:Mr.id,type:I.MenuItemType.BUTTON,title:"sheetConfig.unhide",disabled$:new O.Observable(t=>{function r(){const s=o.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getWorksheets(),l=Array.from(s.values());t.next(l.length===1)}const i=e.onCommandExecuted(s=>{const l=s.id;(l===m.RemoveSheetMutation.id||l===m.InsertSheetMutation.id||l===m.SetWorksheetHideMutation.id)&&r()});return r(),i.dispose}).pipe(O.combineLatestWith(Un(n,[m.WorkbookEditablePermission,m.WorkbookHideSheetPermission])),O.map(([t,r])=>t||r)),hidden$:I.getMenuHiddenObservable(n,a.UniverInstanceType.UNIVER_SHEET)}}function ao(n,o){const e=n.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getWorksheets(),t=Array.from(e.values()).filter(r=>r.getConfig().hidden===a.BooleanNumber.FALSE);o.next(t.length===1)}const ec={[I.RibbonPosition.START]:{[I.RibbonStartGroup.HISTORY]:{[An.id]:{order:2,menuItemFactory:tg},[m.ClearSelectionAllCommand.id]:{order:3,menuItemFactory:Br}},[I.RibbonStartGroup.FORMAT]:{[pr.id]:{order:1,menuItemFactory:sg},[Sr.id]:{order:2,menuItemFactory:ag},[Bt.id]:{order:5,menuItemFactory:ng},[Ft.id]:{order:6,menuItemFactory:rg},[jt.id]:{order:7,menuItemFactory:og},[zt.id]:{order:8,menuItemFactory:ig},[pn.id]:{order:9,menuItemFactory:cg,[m.ResetTextColorCommand.id]:{order:0,menuItemFactory:lg}},[m.SetBackgroundColorCommand.id]:{order:10,menuItemFactory:ug,[m.ResetBackgroundColorCommand.id]:{order:0,menuItemFactory:dg}},[m.SetBorderBasicCommand.id]:{order:11,menuItemFactory:Bm}},[I.RibbonStartGroup.LAYOUT]:{[m.SetHorizontalTextAlignCommand.id]:{order:0,menuItemFactory:hg},[m.SetVerticalTextAlignCommand.id]:{order:3,menuItemFactory:mg},[m.SetTextWrapCommand.id]:{order:6,menuItemFactory:gg},[m.SetTextRotationCommand.id]:{order:7,menuItemFactory:Sg},[m.AddWorksheetMergeCommand.id]:{order:8,menuItemFactory:Mg,[m.AddWorksheetMergeAllCommand.id]:{order:0,menuItemFactory:Pg},[m.AddWorksheetMergeVerticalCommand.id]:{order:1,menuItemFactory:xg},[m.AddWorksheetMergeHorizontalCommand.id]:{order:2,menuItemFactory:Og},[m.RemoveWorksheetMergeCommand.id]:{order:3,menuItemFactory:Ag}}},[I.RibbonStartGroup.OTHERS]:{[vr.id]:{order:0,menuItemFactory:Lg}}},[I.ContextMenuPosition.MAIN_AREA]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn},[Ve.name]:{order:2,menuItemFactory:Ko},[tr]:{order:3,menuItemFactory:qo,[on.id]:{order:0,menuItemFactory:Qo},[sn.id]:{order:1,menuItemFactory:Jo},[yt.id]:{order:2,menuItemFactory:$o},[an.id]:{order:3,menuItemFactory:ei}},[Kr]:{order:4,menuItemFactory:Yo,[m.ClearSelectionContentCommand.id]:{order:0,menuItemFactory:Zo},[m.ClearSelectionFormatCommand.id]:{order:1,menuItemFactory:Go},[m.ClearSelectionAllCommand.id]:{order:2,menuItemFactory:Br}}},[I.ContextMenuGroup.LAYOUT]:{order:1,[Zl]:{order:0,menuItemFactory:Ym,[m.InsertRowBeforeCommand.id]:{order:0,menuItemFactory:Zm},[m.InsertColBeforeCommand.id]:{order:1,menuItemFactory:Gm},[On.id]:{order:2,menuItemFactory:Km},[Ht.id]:{order:3,menuItemFactory:qm}},[Xl]:{order:0,menuItemFactory:Fm,[vn.id]:{order:0,menuItemFactory:ca},[fn.id]:{order:1,menuItemFactory:da},[xn.id]:{order:2,menuItemFactory:jm},[kt.id]:{order:3,menuItemFactory:zm}},[Kl]:{order:2,menuItemFactory:vg,[rt.id]:{order:0,menuItemFactory:ti},[Er.id]:{order:1,menuItemFactory:Cg},[Tr.id]:{order:2,menuItemFactory:Ig},[m.CancelFrozenCommand.id]:{order:3,menuItemFactory:ni}},[qr]:{order:3,menuItemFactory:ri,[Mt.id]:{order:0,menuItemFactory:oi},[Ot.id]:{order:1,menuItemFactory:ii},[xt.id]:{order:2,menuItemFactory:si},[Pt.id]:{order:3,menuItemFactory:ai}}},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}},[I.ContextMenuPosition.COL_HEADER]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn},[Ve.name]:{order:2,menuItemFactory:Ko},[tr]:{order:3,menuItemFactory:qo,[on.id]:{order:0,menuItemFactory:Qo},[sn.id]:{order:1,menuItemFactory:Jo},[yt.id]:{order:2,menuItemFactory:$o},[an.id]:{order:3,menuItemFactory:ei}},[Kr]:{order:4,menuItemFactory:Yo,[m.ClearSelectionContentCommand.id]:{order:0,menuItemFactory:Zo},[m.ClearSelectionFormatCommand.id]:{order:1,menuItemFactory:Go},[m.ClearSelectionAllCommand.id]:{order:2,menuItemFactory:Br}}},[I.ContextMenuGroup.LAYOUT]:{order:1,[m.InsertMultiColsLeftCommand.id]:{order:0,menuItemFactory:$m},[m.InsertMultiColsRightCommand.id]:{order:0,menuItemFactory:eg},[gr.id]:{order:1,menuItemFactory:bg},[m.SetSelectedColsVisibleCommand.id]:{order:2,menuItemFactory:wg},[vn.id]:{order:2,menuItemFactory:ca},[m.SetColWidthCommand.id]:{order:3,menuItemFactory:Tg},[Dn.id]:{order:4,menuItemFactory:fg},[Ni]:{order:5,menuItemFactory:Sa,[rt.id]:{order:0,menuItemFactory:ti},[m.CancelFrozenCommand.id]:{order:3,menuItemFactory:ni}},[qr]:{order:6,menuItemFactory:ri,[Mt.id]:{order:0,menuItemFactory:oi},[Ot.id]:{order:1,menuItemFactory:ii},[xt.id]:{order:2,menuItemFactory:si},[Pt.id]:{order:3,menuItemFactory:ai}}},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}},[I.ContextMenuPosition.ROW_HEADER]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn},[Ve.name]:{order:2,menuItemFactory:Ko},[tr]:{order:3,menuItemFactory:qo,[on.id]:{order:0,menuItemFactory:Qo},[sn.id]:{order:1,menuItemFactory:Jo},[yt.id]:{order:2,menuItemFactory:$o},[an.id]:{order:3,menuItemFactory:ei}},[Kr]:{order:4,menuItemFactory:Yo,[m.ClearSelectionContentCommand.id]:{order:0,menuItemFactory:Zo},[m.ClearSelectionFormatCommand.id]:{order:1,menuItemFactory:Go},[m.ClearSelectionAllCommand.id]:{order:2,menuItemFactory:Br}}},[I.ContextMenuGroup.LAYOUT]:{order:1,[m.InsertMultiRowsAboveCommand.id]:{order:0,menuItemFactory:Jm},[m.InsertMultiRowsAfterCommand.id]:{order:1,menuItemFactory:Qm},[fn.id]:{order:1,menuItemFactory:da},[mr.id]:{order:2,menuItemFactory:_g},[m.SetSelectedRowsVisibleCommand.id]:{order:2,menuItemFactory:Rg},[m.SetRowHeightCommand.id]:{order:3,menuItemFactory:Eg},[m.SetWorksheetRowIsAutoHeightCommand.id]:{order:4,menuItemFactory:pg},[Ni]:{order:5,menuItemFactory:Sa,[rt.id]:{order:0,menuItemFactory:ti},[m.CancelFrozenCommand.id]:{order:3,menuItemFactory:ni}},[qr]:{order:6,menuItemFactory:ri,[Mt.id]:{order:0,menuItemFactory:oi},[Ot.id]:{order:1,menuItemFactory:ii},[xt.id]:{order:2,menuItemFactory:si},[Pt.id]:{order:3,menuItemFactory:ai}}},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}},[I.ContextMenuPosition.FOOTER_TABS]:{[I.ContextMenuGroup.OTHERS]:{order:0,[br.id]:{order:0,menuItemFactory:Xg},[m.CopySheetCommand.id]:{order:1,menuItemFactory:Yg},[Ar.id]:{order:2,menuItemFactory:Zg},[m.SetTabColorCommand.id]:{order:3,menuItemFactory:Gg},[m.SetWorksheetHideCommand.id]:{order:4,menuItemFactory:Kg},[Mr.id]:{order:6,menuItemFactory:qg},[Cr.id]:{order:7,menuItemFactory:Bg},[Pr.id]:{order:8,menuItemFactory:Fg},[xr.id]:{order:9,menuItemFactory:jg},[Ir.id]:{order:10,menuItemFactory:zg}}},[I.ContextMenuPosition.FOOTER_MENU]:{[I.ContextMenuGroup.OTHERS]:{[m.ToggleGridlinesCommand.id]:{order:1,menuItemFactory:Xm}}}},li="UNIVER_SHEET_PERMISSION_ALERT_DIALOG_ID",tc="UNIVER_SHEET_PERMISSION_ALERT_DIALOG";var Qg=Object.getOwnPropertyDescriptor,Jg=(n,o,e,t)=>{for(var r=t>1?void 0:t?Qg(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},qe=(n,o)=>(e,t)=>o(e,t,n);exports.SheetPermissionCheckUIController=class extends a.Disposable{constructor(e,t,r,i,s,l,c,d,u){super();E(this,"disposableCollection",new a.DisposableCollection);this._commandService=e,this._univerInstanceService=t,this._permissionService=r,this._dialogService=i,this._rangeProtectionRuleModel=s,this._autoFillService=l,this._localeService=c,this._contextService=d,this._sheetPermissionCheckController=u,this._initialize(),this._initUIEvent()}_initUIEvent(){this.disposeWithMe(this._sheetPermissionCheckController.triggerPermissionUIEvent$.subscribe(e=>{this._haveNotPermissionHandle(e)}))}_haveNotPermissionHandle(e){const t={id:li,title:{title:"permission.dialog.alert"},children:{label:tc,errorMsg:e},width:320,destroyOnClose:!0,showOk:!0,onClose:()=>{this._dialogService.close(li)},onOk:()=>{this._dialogService.close(li)},className:"sheet-permission-user-dialog"};this._permissionService.getShowComponents()&&this._dialogService.open(t)}_getPermissionCheck(e,t){var s,l;let r=!0,i="";switch(e){case J.InsertCommand.id:case J.IMEInputCommand.id:if(this._contextService.getContextValue(a.FOCUSING_EDITOR_STANDALONE)===!0)break;r=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellValuePermission,m.WorksheetEditPermission]}),i=this._localeService.t("permission.dialog.editErr");break;case Se.id:if(t.visible===!1)break;r=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellValuePermission,m.WorksheetEditPermission]}),i=this._localeService.t("permission.dialog.editErr");break;case yt.id:r=this._sheetPermissionCheckController.permissionCheckWithoutRange({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetColumnStylePermission]}),i=this._localeService.t("permission.dialog.pasteErr");break;case to.id:r=this._permissionCheckByPaste(t),i=this._localeService.t("permission.dialog.pasteErr");break;case wr.id:r=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetEditPermission,m.WorksheetSetCellValuePermission,m.WorksheetSetCellStylePermission]}),i=this._localeService.t("permission.dialog.commonErr");break;case m.SetBackgroundColorCommand.id:case Bt.id:case Ft.id:case jt.id:case zt.id:r=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellStylePermission,m.WorksheetEditPermission]}),i=this._localeService.t("permission.dialog.setStyleErr");break;case He.id:r=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookCopyPermission],rangeTypes:[m.RangeProtectionPermissionViewPoint],worksheetTypes:[m.WorksheetCopyPermission]}),i=this._localeService.t("permission.dialog.copyErr"),(s=this._permissionService.getPermissionPoint(new m.WorkbookCopyPermission(this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId()).id))!=null&&s.value||(i=this._localeService.t("permission.dialog.workbookCopyErr"));break;case xo.id:r=this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookCopyPermission,m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionViewPoint,m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetCopyPermission,m.WorksheetEditPermission]}),i=this._localeService.t("permission.dialog.copyErr"),(l=this._permissionService.getPermissionPoint(new m.WorkbookCopyPermission(this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getUnitId()).id))!=null&&l.value||(i=this._localeService.t("permission.dialog.workbookCopyErr"));break;case dt.id:r=this._permissionCheckByAutoFillCommand(t),i=this._localeService.t("permission.dialog.autoFillErr");break}r||this._sheetPermissionCheckController.blockExecuteWithoutPermission(i)}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{this._getPermissionCheck(e.id,e==null?void 0:e.params)}))}_permissionCheckByPaste(e){return e.value===ge.SPECIAL_PASTE_VALUE||e.value===ge.SPECIAL_PASTE_FORMULA?this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellStylePermission,m.WorksheetEditPermission]}):e.value===ge.SPECIAL_PASTE_FORMAT?this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellStylePermission,m.WorksheetEditPermission]}):this._sheetPermissionCheckController.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetSetCellValuePermission,m.WorksheetSetCellStylePermission,m.WorksheetEditPermission]})}_permissionCheckByAutoFillCommand(e){if(!e)return!1;const{targetRange:t}=e,r=m.getSheetCommandTarget(this._univerInstanceService);if(!r)return!1;const{worksheet:i,unitId:s,subUnitId:l}=r;return!this._rangeProtectionRuleModel.getSubunitRuleList(s,l).reduce((u,h)=>[...u,...h.ranges],[]).filter(u=>a.Rectangle.intersects(u,t)).some(u=>{var h,g;for(let S=u.startRow;S<=u.endRow;S++)for(let p=u.startColumn;p<=u.endColumn;p++){const f=(g=(h=i.getCell(S,p))==null?void 0:h.selectionProtection)==null?void 0:g[0];if((f==null?void 0:f[Q.Edit])===!1)return!0}return!1})}};exports.SheetPermissionCheckUIController=Jg([qe(0,a.ICommandService),qe(1,a.IUniverInstanceService),qe(2,a.IPermissionService),qe(3,I.IDialogService),qe(4,a.Inject(m.RangeProtectionRuleModel)),qe(5,pt),qe(6,a.Inject(a.LocaleService)),qe(7,a.IContextService),qe(8,a.Inject(m.SheetPermissionCheckController))],exports.SheetPermissionCheckUIController);var $g=Object.getOwnPropertyDescriptor,eS=(n,o,e,t)=>{for(var r=t>1?void 0:t?$g(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},wt=(n,o)=>(e,t)=>o(e,t,n);const tS="__SpreadsheetFreezeRowMainName__",nS="__SpreadsheetFreezeRowHeaderName__",rS="__SpreadsheetFreezeColumnMainName__",oS="__SpreadsheetFreezeColumnHeaderName__",ci=2,iS=.01,jn=a.createInterceptorKey("freezePermissionCheck");exports.HeaderFreezeRenderController=class extends a.Disposable{constructor(e,t,r,i,s,l,c,d){super();E(this,"_rowFreezeHeaderRect");E(this,"_rowFreezeMainRect");E(this,"_columnFreezeHeaderRect");E(this,"_columnFreezeMainRect");E(this,"_freezeDownSubs");E(this,"_freezePointerEnterSubs");E(this,"_freezePointerLeaveSubs");E(this,"_scenePointerMoveSub");E(this,"_scenePointerUpSub");E(this,"_changeToRow",-1);E(this,"_changeToColumn",-1);E(this,"_changeToOffsetX",0);E(this,"_changeToOffsetY",0);E(this,"_activeViewport",null);E(this,"_freezeNormalHeaderColor","");E(this,"_freezeNormalMainColor","");E(this,"_freezeActiveColor","");E(this,"_freezeHoverColor","");E(this,"_lastFreeze");E(this,"interceptor",new a.InterceptorManager({FREEZE_PERMISSION_CHECK:jn}));this._context=e,this._sheetSkeletonManagerService=t,this._commandService=r,this._selectionManagerService=i,this._scrollManagerService=s,this._themeService=l,this._sheetInterceptorService=c,this._injector=d,this._initialize()}dispose(){super.dispose()}_initialize(){this._skeletonListener(),this._commandExecutedListener(),this._themeChangeListener(),this._interceptorCommands(),this._bindViewportScroll(),this._zoomRefresh()}_createFreeze(e=0,t){var x;const r=t!=null?t:this._getFreeze();if(r==null)return null;const i=(x=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:x.skeleton,{startRow:s,startColumn:l}=r,c=this._getPositionByIndex(s,l);if(c==null||i==null)return null;const d=this._getSheetObject(),u=d.engine,h=(u==null?void 0:u.width)||0,g=(u==null?void 0:u.height)||0,S=d.scene,{startX:p,startY:f}=c,{rowTotalHeight:v,columnTotalWidth:C,rowHeaderWidthAndMarginLeft:_,columnHeaderHeightAndMarginTop:R}=i,w=h>C+_?h:C+R,P=g>v+R?g:v+R;this._changeToRow=s,this._changeToColumn=l,this._changeToOffsetX=p,this._changeToOffsetY=f;const y=Math.max(S.scaleX,S.scaleY);let M=ci/Math.max(1,y);if(e===0){(s===-1||s===0)&&(M=M*2);const A=M;this._rowFreezeHeaderRect=new T.Rect(nS,{fill:this._freezeNormalHeaderColor,width:_,height:M,left:0,top:f-A,zIndex:3});let D=this._freezeNormalHeaderColor;(s===-1||s===0)&&(D=this._freezeNormalMainColor),this._rowFreezeMainRect=new T.Rect(tS,{fill:D,width:w*2/y,height:M,left:_,top:f-A,zIndex:3}),S.addObjects([this._rowFreezeHeaderRect,this._rowFreezeMainRect],ht)}else{(l===-1||l===0)&&(M=M*2);const A=M;this._columnFreezeHeaderRect=new T.Rect(oS,{fill:this._freezeNormalHeaderColor,width:M,height:R,left:p-A,top:0,zIndex:3});let D=this._freezeNormalHeaderColor;(l===-1||l===0)&&(D=this._freezeNormalMainColor),this._columnFreezeMainRect=new T.Rect(rS,{fill:D,width:M,height:P*2/y,left:p-A,top:R,zIndex:3}),S.addObjects([this._columnFreezeHeaderRect,this._columnFreezeMainRect],ht)}this._eventBinding(e)}_eventBinding(e=0){let t=this._rowFreezeHeaderRect,r=this._rowFreezeMainRect;e===1&&(t=this._columnFreezeHeaderRect,r=this._columnFreezeMainRect);const i=this._getSheetObject();if(i==null)return;const{scene:s}=i;if(this._freezePointerEnterSubs=new O.Subscription,this._freezePointerLeaveSubs=new O.Subscription,this._freezeDownSubs=new O.Subscription,r){const d=r.onPointerEnter$.subscribeEvent(()=>{if(!this.interceptor.fetchThroughInterceptors(jn)(!0,null))return!1;t==null||t.setProps({fill:this._freezeHoverColor,zIndex:4}),s.setCursor(T.CURSOR_TYPE.GRAB)});this._freezePointerEnterSubs.add(d);const u=r.onPointerLeave$.subscribeEvent(()=>{t==null||t.setProps({fill:this._freezeNormalHeaderColor,zIndex:3}),s.resetCursor()});this._freezePointerLeaveSubs.add(u)}if(t){const d=t.onPointerEnter$.subscribeEvent(()=>{if(!this.interceptor.fetchThroughInterceptors(jn)(!0,null))return!1;t==null||t.setProps({fill:this._freezeHoverColor,zIndex:4}),s.setCursor(T.CURSOR_TYPE.GRAB)});this._freezePointerEnterSubs.add(d);const u=t.onPointerLeave$.subscribeEvent(()=>{t==null||t.setProps({fill:this._freezeNormalHeaderColor,zIndex:3}),s.resetCursor()});this._freezePointerLeaveSubs.add(u)}const l=t==null?void 0:t.onPointerDown$.subscribeEvent(d=>{this._freezeDown(d,t,r,e)});l&&this._freezeDownSubs.add(l);const c=r==null?void 0:r.onPointerDown$.subscribeEvent(d=>{this._freezeDown(d,t,r,e)});c&&this._freezeDownSubs.add(c)}_getCurrentLastVisible(){var C,_,R,w,P,y,M;const e=this._getSheetObject();if(e==null)return;const t=(C=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:C.skeleton;if(t==null)return;const r=e.scene,i=Math.max(r.scaleX,r.scaleY),s=this._scrollManagerService.getCurrentScrollState(),l=(e.engine.height-t.columnHeaderHeight)/i,c=(e.engine.width-t.rowHeaderWidth)/i,d=(_=s==null?void 0:s.sheetViewStartRow)!=null?_:0,u=d===0?-((R=s==null?void 0:s.offsetY)!=null?R:0):t.rowHeightAccumulation[d-1]-((w=s==null?void 0:s.offsetY)!=null?w:0);let h=0,g=!1;for(let x=d,A=t.rowHeightAccumulation.length;x<A;x++)if(t.rowHeightAccumulation[x]-u>l){h=x,g=!0;break}g||(h=t.rowHeightAccumulation.length-1);const S=(P=s==null?void 0:s.sheetViewStartColumn)!=null?P:0,p=S===0?-((y=s==null?void 0:s.offsetX)!=null?y:0):t.columnWidthAccumulation[S-1]-((M=s==null?void 0:s.offsetX)!=null?M:0);let f=0,v=!1;for(let x=S,A=t.columnWidthAccumulation.length;x<A;x++)if(t.columnWidthAccumulation[x]-p>c){f=x,v=!0;break}return v||(f=t.columnWidthAccumulation.length-1),{lastRow:h,lastColumn:f}}_getActiveViewport(e){var r;const t=(r=this._getSheetObject())==null?void 0:r.scene.getViewports();return t&&t.find(i=>i.isHit(new T.Vector2(e.offsetX,e.offsetY)))||null}_freezeDown(e,t,r,i=0){var p;const s=(p=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:p.skeleton;if(s==null)return;const l=this._getSheetObject();if(l==null)return;if(!this.interceptor.fetchThroughInterceptors(jn)(!0,null))return!1;const{scene:d}=l;d.setCursor(T.CURSOR_TYPE.GRABBING),d.disableObjectsEvent();const u=this._getCurrentLastVisible(),h=u===void 0?Number.POSITIVE_INFINITY:s.rowHeightAccumulation[u.lastRow],g=u===void 0?Number.POSITIVE_INFINITY:s.columnWidthAccumulation[u.lastColumn-1]+s.rowHeaderWidth;this._activeViewport=null;const S=this._getFreeze();S&&(this._changeToColumn=S.startColumn,this._changeToRow=S.startRow),this._scenePointerMoveSub=d.onPointerMove$.subscribeEvent(f=>{var M,x,A,D;const v=this._getActiveViewport(f),{startX:C,startY:_,row:R,column:w}=ze(f.offsetX,f.offsetY,d,s,v||void 0,!0);if(!this.interceptor.fetchThroughInterceptors(jn)(!0,null))return!1;d.setCursor(T.CURSOR_TYPE.GRABBING);const y=ci/Math.max(d.scaleX,d.scaleY);i===0?((M=t.transformByState({top:Math.min(_,h)-y/2}))==null||M.setProps({fill:this._freezeActiveColor}),(x=r.transformByState({top:Math.min(_,h)-y/2}))==null||x.setProps({fill:this._freezeNormalHeaderColor}),this._changeToRow=u===void 0?R:Math.min(R,u.lastRow),this._changeToOffsetY=Math.min(_,h),this._activeViewport=v):((A=t.transformByState({left:Math.min(C,g)-y/2}))==null||A.setProps({fill:this._freezeActiveColor}),(D=r.transformByState({left:Math.min(C,g)-y/2}))==null||D.setProps({fill:this._freezeNormalHeaderColor}),this._changeToColumn=u===void 0?w:Math.min(w,u.lastColumn),this._changeToOffsetX=C,this._activeViewport=v)}),this._scenePointerUpSub=d.onPointerUp$.subscribeEvent(()=>{var N,V;d.resetCursor(),d.enableObjectsEvent(),this._clearObserverEvent();const{rowHeaderWidthAndMarginLeft:f,columnHeaderHeightAndMarginTop:v}=s;i===0&&(this._changeToRow===0||this._changeToRow===-1)||i===1&&(this._changeToColumn===0||this._changeToColumn===-1)?(t.setProps({fill:this._freezeNormalHeaderColor}),r.setProps({fill:this._freezeNormalMainColor})):(t==null||t.setProps({fill:this._freezeNormalHeaderColor}),r==null||r.setProps({fill:this._freezeNormalHeaderColor}));const C=ci/Math.max(d.scaleX,d.scaleY);i===0?(this._changeToRow===0||this._changeToRow===-1)&&(t.transformByState({top:v-C}),r.transformByState({top:v-C})):(this._changeToColumn===0||this._changeToColumn===-1)&&(t.transformByState({left:f-C}),r.transformByState({left:f-C}));const _=this._scrollManagerService.getCurrentScrollState()||{sheetViewStartRow:0,sheetViewStartColumn:0},{sheetViewStartRow:R,sheetViewStartColumn:w}=_;if(w==null||R==null)return;const P=this._context.unit,y=P.getActiveSheet();if(!y)return;const M=(N=y.getConfig())==null?void 0:N.freeze;let x=(M==null?void 0:M.xSplit)||0,A=(M==null?void 0:M.ySplit)||0;const D=(V=this._activeViewport)==null?void 0:V.viewportKey;i===0&&(!D||D===T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP||D===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP||D===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP||D===T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP?A=this._changeToRow-(M.startRow-M.ySplit):A=this._changeToRow-R,A=A<0?0:A),i===1&&(!D||D===T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP||D===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP||D===T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT||D===T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT?x=this._changeToColumn-(M.startColumn-M.xSplit):x=this._changeToColumn-w,x=x<0?0:x),this._commandService.executeCommand(m.SetFrozenCommand.id,{startRow:A===0?-1:this._changeToRow,startColumn:x===0?-1:this._changeToColumn,ySplit:A,xSplit:x,unitId:P.getUnitId(),subUnitId:y.getSheetId()})})}_getViewports(){const e=this._getSheetObject();if(e==null)return;const{scene:t}=e,r=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT),i=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT),s=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP),l=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM),c=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP),d=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),u=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP),h=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT),g=t.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP);if(!(r==null||i==null||s==null||l==null||c==null||d==null||u==null||h==null||g==null))return{viewMain:d,viewMainLeftTop:u,viewMainLeft:h,viewMainTop:g,viewColumnLeft:r,viewColumnRight:i,viewRowTop:s,viewRowBottom:l,viewLeftTop:c}}_bindViewportScroll(){const e=this._getViewports();if(!e)return;const{viewRowBottom:t,viewColumnRight:r,viewMainLeft:i,viewMainTop:s}=e;this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(l=>{if(!l)return;const{scrollX:c,scrollY:d,viewportScrollX:u,viewportScrollY:h}=l;t.isActive&&t.updateScrollVal({scrollY:d,viewportScrollY:h}),r.isActive&&r.updateScrollVal({scrollX:c,viewportScrollX:u}),i.isActive&&i.updateScrollVal({scrollY:d,viewportScrollY:h}),s.isActive&&s.updateScrollVal({scrollX:c,viewportScrollX:u})}))}_updateViewport(e=-1,t=-1,r=0,i=0,s=3){var x;const l=(x=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:x.skeleton;if(l==null)return;const{rowHeaderWidthAndMarginLeft:c,columnHeaderHeightAndMarginTop:d}=l,u=this._getViewports();if(!u)return;const{viewMain:h,viewMainLeftTop:g,viewMainLeft:S,viewMainTop:p,viewColumnLeft:f,viewColumnRight:v,viewRowTop:C,viewRowBottom:_,viewLeftTop:R}=u;v.resizeWhenFreezeChange({left:c,top:0,height:d+1,right:0}),_.resizeWhenFreezeChange({left:0,top:d,bottom:0,width:c+1}),R.resizeWhenFreezeChange({left:0,top:0,width:c+1,height:d});let w=!0,P=!0;g.enable(),(e===-1||e===0)&&(w=!1),(t===-1||t===0)&&(P=!1);const y=l.getNoMergeCellWithCoordByIndex(e-r,t-i,!1),M=l.getNoMergeCellWithCoordByIndex(e,t,!1);if(g.disable(),p.disable(),S.disable(),C.disable(),f.disable(),g.resetPadding(),p.resetPadding(),S.resetPadding(),C.resetPadding(),f.resetPadding(),w===!1&&P===!1)h.resizeWhenFreezeChange({left:c,top:d,bottom:0,right:0}),h.resetPadding(),S.resizeWhenFreezeChange({left:c,top:d,bottom:0,width:0}),p.resizeWhenFreezeChange({left:c,top:d,height:0,right:0}),g.resizeWhenFreezeChange({left:c,top:d,width:0,height:0}),C.resizeWhenFreezeChange({left:0,top:d,width:c+1,height:0}),f.resizeWhenFreezeChange({left:0,top:0,height:d+1,width:0});else if(w===!0&&P===!1){const A=M.startY-y.startY;h.resizeWhenFreezeChange({left:c,top:d+A,bottom:0,right:0}),h.setPadding({startY:y.startY,endY:M.startY,startX:0,endX:0}),s&2&&this._commandService.executeCommand(Ue.id,{sheetViewStartRow:0,offsetY:0}),p.resizeWhenFreezeChange({left:c,top:d,height:A,right:0}),p.updateScrollVal({viewportScrollY:y.startY,rawScrollX:h.scrollX,viewportScrollX:h.viewportScrollX}),C.resizeWhenFreezeChange({left:0,top:d,width:c+1,height:A}),C.updateScrollVal({viewportScrollY:y.startY}),_.resizeWhenFreezeChange({left:0,top:d+A,bottom:0,width:c+1}),p.enable(),C.enable()}else if(w===!1&&P===!0){const A=M.startX-y.startX;h.resizeWhenFreezeChange({left:c+A,top:d,bottom:0,right:0}),h.setPadding({startX:y.startX,endX:M.startX,startY:0,endY:0}),s&1&&this._commandService.executeCommand(Ue.id,{sheetViewStartColumn:0,offsetX:0}),S.resizeWhenFreezeChange({left:c,top:d,width:A,bottom:0,right:0}),S.updateScrollVal({viewportScrollX:y.startX,rawScrollY:h.scrollY,viewportScrollY:h.viewportScrollY}),f.resizeWhenFreezeChange({left:c,top:0,width:A,height:d+1}),f.updateScrollVal({viewportScrollX:y.startX}),v.resizeWhenFreezeChange({left:c+A,top:0,height:d+1,right:0}),S.enable(),f.enable()}else{const A=M.startX-y.startX,D=M.startY-y.startY;h.resizeWhenFreezeChange({left:c+A,top:d+D,bottom:0,right:0}),h.setPadding({startY:y.startY,endY:M.startY,startX:y.startX,endX:M.startX}),s&&this._commandService.executeCommand(Ue.id,{...s&1?{sheetViewStartColumn:0,offsetX:0}:null,...s&2?{sheetViewStartRow:0,offsetY:0}:null}),S.resizeWhenFreezeChange({left:c,top:d+D,width:A,bottom:0}),S.updateScrollVal({viewportScrollX:y.startX,rawScrollY:h.scrollY,viewportScrollY:h.viewportScrollY}),p.resizeWhenFreezeChange({left:c+A,top:d,height:D,right:0}),p.updateScrollVal({viewportScrollY:y.startY,rawScrollX:h.scrollX,viewportScrollX:h.viewportScrollX}),g.resizeWhenFreezeChange({left:c,top:d,width:A,height:D}),g.updateScrollVal({viewportScrollX:y.startX,viewportScrollY:y.startY}),C.resizeWhenFreezeChange({left:0,top:d,width:c+1,height:D}),C.updateScrollVal({viewportScrollY:y.startY}),_.resizeWhenFreezeChange({left:0,top:d+D,bottom:0,width:c+1}),f.resizeWhenFreezeChange({left:c,top:0,width:A,height:d+1}),f.updateScrollVal({viewportScrollX:y.startX}),v.resizeWhenFreezeChange({left:c+A,top:0,height:d+1,right:0}),g.enable(),p.enable(),S.enable(),C.enable(),f.enable()}}_skeletonListener(){this.disposeWithMe(a.toDisposable(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{[m.SetWorksheetActiveOperation.id,m.InsertRangeMoveDownCommand.id,m.InsertRangeMoveRightCommand.id].includes((e==null?void 0:e.commandId)||"")&&this._refreshCurrent()})))}_refreshCurrent(){const t=this._context.unit.getActiveSheet();if(!t)return;const r=t.getConfig().freeze,{startRow:i=-1,startColumn:s=-1,ySplit:l=0,xSplit:c=0}=r;this._refreshFreeze(i,s,l,c,0)}_themeChangeListener(){this._themeChange(this._themeService.getCurrentTheme()),this.disposeWithMe(this._themeService.currentTheme$.subscribe(e=>{this._clearFreeze(),this._themeChange(e),this._refreshCurrent()}))}_themeChange(e){this._freezeNormalHeaderColor=a.get(e,"gray.300"),this._freezeNormalMainColor=new a.ColorKit(this._freezeNormalHeaderColor).setAlpha(iS).toRgbString(),this._freezeActiveColor=a.get(e,"primary.600"),this._freezeHoverColor=a.get(e,"gray.500")}_interceptorCommands(){this.disposeWithMe(this._sheetInterceptorService.interceptCommand({getMutations:e=>{const t={redos:[],undos:[]},r=this._getFreeze();if(!r)return t;const i=s=>{const l=this._context.unit,c=l.getUnitId(),d=l.getActiveSheet();if(!d)return t;const u=d.getSheetId();this._refreshFreeze(s.startRow,s.startColumn,s.ySplit,s.xSplit,0);const h={...s,unitId:c,subUnitId:u,resetScroll:!1},g=m.SetFrozenMutationFactory(this._injector,h);return{undos:[{id:m.SetFrozenMutation.id,params:g}],redos:[{id:m.SetFrozenMutation.id,params:h}]}};if(e.id===m.InsertRowCommand.id){const s=e.params,{range:l,direction:c}=s,d=l.endRow-l.startRow+1;if(l.startRow<r.startRow||l.startRow+1===r.startRow&&c===a.Direction.UP){const u={...r,startRow:Math.max(1,r.startRow+d),ySplit:Math.max(1,r.ySplit+d)};return i(u)}}if(e.id===m.InsertColCommand.id){const s=e.params,{range:l,direction:c}=s,d=l.endColumn-l.startColumn+1;if(l.startColumn<r.startColumn||l.startColumn+1===r.startColumn&&c===a.Direction.LEFT){const u={...r,startColumn:Math.max(1,r.startColumn+d),xSplit:Math.max(1,r.xSplit+d)};return i(u)}}if(e.id===m.MoveColsCommand.id){const s=this._selectionManagerService.getCurrentSelections(),{fromRange:{startColumn:l},toRange:{startColumn:c}}=e.params,d=s==null?void 0:s.filter(C=>C.range.rangeType===a.RANGE_TYPE.COLUMN&&C.range.startColumn<=l&&l<=C.range.endColumn);if(!(d!=null&&d.length))return t;const u=d[0].range,h={...u,startColumn:c,endColumn:c+u.endColumn-u.startColumn};if(!r||r.startColumn<=0||u.startColumn>=r.startColumn&&h.startColumn>=r.startColumn||u.startColumn===h.startColumn||u.endColumn<r.startColumn&&h.startColumn<r.startColumn)return t;const g=u.endColumn-u.startColumn+1,S=Math.max(Math.min(r.startColumn,u.endColumn+1)-u.startColumn,0);let p,f;h.startColumn>=r.startColumn?(p=Math.max(r.startColumn-S,1),f=Math.max(r.xSplit-S,1)):(p=r.startColumn+g-S,f=r.xSplit+g-S);const v={...r,startColumn:p,xSplit:f};return i(v)}if(e.id===m.MoveRowsCommand.id){const s=this._selectionManagerService.getCurrentSelections(),{fromRange:{startRow:l},toRange:{startRow:c}}=e.params,d=s==null?void 0:s.filter(C=>C.range.rangeType===a.RANGE_TYPE.ROW&&C.range.startRow<=l&&l<=C.range.endRow);if(!(d!=null&&d.length))return t;const u=d[0].range,h={...u,startRow:c,endRow:c+u.endRow-u.startRow};if(!r||r.startRow<=0||u.startRow>=r.startRow&&h.startRow>=r.startRow||u.startRow===h.startRow||u.endRow<r.startRow&&h.startRow<r.startRow)return t;const g=u.endRow-u.startRow+1,S=Math.max(Math.min(r.startRow,u.endRow+1)-u.startRow,0);let p,f;h.startRow>=r.startRow?(p=Math.max(r.startRow-S,1),f=Math.max(r.ySplit-S,1)):(p=r.startRow+g-S,f=r.ySplit+g-S);const v={...r,startRow:p,ySplit:f};return i(v)}if(e.id===m.RemoveColCommand.id||e.id===m.RemoveRowCommand.id){const s=e.params,l=s.range;if(l.rangeType===a.RANGE_TYPE.COLUMN&&l.startColumn<r.startColumn){const c=Math.min(r.startColumn,l.endColumn+1)-l.startColumn,d={...r,startColumn:Math.max(1,r.startColumn-c),xSplit:Math.max(1,r.xSplit-c)};return i(d)}if(s.range.rangeType===a.RANGE_TYPE.ROW&&l.startRow<r.startRow){const c=Math.min(r.startRow,l.endRow+1)-l.startRow,d={...r,startRow:Math.max(1,r.startRow-c),ySplit:Math.max(1,r.ySplit-c)};return i(d)}}return t}}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{switch(e.id){case m.SetFrozenMutation.id:case De.id:{const t=this._lastFreeze,r=this._context.unit,i=r.getActiveSheet(),s=e.params,{unitId:l,subUnitId:c}=s;if(!(l===r.getUnitId()&&c===(i==null?void 0:i.getSheetId())))return;const d=i.getConfig().freeze;if(this._lastFreeze=d,d==null)return;let u=0;const{startRow:h=-1,startColumn:g=-1,ySplit:S=0,xSplit:p=0}=d;(!t||t.startRow!==h||t.ySplit!==S)&&(u|=2),(!t||t.startColumn!==g||t.xSplit!==p)&&(u|=1),s.resetScroll===!1&&(u=0),this._refreshFreeze(h,g,S,p,u)}break;case m.SetWorksheetRowHeightMutation.id:{const t=this._getFreeze(),r=t&&e.params.ranges.some(i=>i.startRow<t.startRow);e.params&&r&&this._refreshCurrent()}break;case m.SetWorksheetColWidthMutation.id:{const t=this._getFreeze();e.params&&t&&e.params.ranges.some(r=>r.startColumn<t.startColumn)&&this._refreshCurrent()}break;case m.SetWorksheetRowAutoHeightMutation.id:{const t=e.params,r=this._getFreeze();if(r&&r.startRow>-1&&t.rowsAutoHeightInfo.some(i=>i.row<r.startRow)){const i=this._sheetSkeletonManagerService.currentSkeleton$.subscribe(()=>{this._refreshCurrent(),setTimeout(()=>{i.unsubscribe()})})}}break;case m.SetColHiddenMutation.id:case m.SetColVisibleMutation.id:{const t=e.params,r=this._getFreeze(),i=t.ranges;r&&r.startColumn>-1&&i.some(s=>s.startColumn<r.startColumn)&&this._refreshCurrent()}break;case m.SetRowHiddenMutation.id:case m.SetRowVisibleMutation.id:{const t=e.params,r=this._getFreeze(),i=t.ranges;r&&r.startRow>-1&&i.some(s=>s.startRow<r.startRow)&&this._refreshCurrent()}break;case cr.id:case dr.id:this._refreshCurrent()}}))}_zoomRefresh(){const e=this._getSheetObject();if(e==null)return;const{scene:t}=e;this.disposeWithMe(t.onTransformChange$.subscribeEvent(r=>{[T.TRANSFORM_CHANGE_OBSERVABLE_TYPE.scale,T.TRANSFORM_CHANGE_OBSERVABLE_TYPE.all].includes(r.type)&&this._refreshCurrent()}))}_clearObserverEvent(){var t,r;this._getSheetObject()!=null&&((t=this._scenePointerMoveSub)==null||t.unsubscribe(),(r=this._scenePointerUpSub)==null||r.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null)}_clearFreeze(){var t,r,i,s,l,c;(t=this._rowFreezeHeaderRect)==null||t.dispose(),(r=this._rowFreezeMainRect)==null||r.dispose(),(i=this._columnFreezeHeaderRect)==null||i.dispose(),(s=this._columnFreezeMainRect)==null||s.dispose(),this._getSheetObject()!=null&&([this._freezeDownSubs,this._freezePointerEnterSubs,this._freezePointerLeaveSubs].forEach(d=>{d==null||d.unsubscribe()}),this._freezeDownSubs=null,this._freezePointerEnterSubs=null,this._freezePointerLeaveSubs=null,(l=this._scenePointerMoveSub)==null||l.unsubscribe(),(c=this._scenePointerUpSub)==null||c.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null)}_getPositionByIndex(e,t){var d;if(this._getSheetObject()==null)return;const i=(d=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:d.skeleton,s=i==null?void 0:i.getNoMergeCellWithCoordByIndex(e,t);if(i==null)return;if(s!=null&&(!isNaN(s.endX)||!isNaN(s.endY)))return s;const{rowHeaderWidthAndMarginLeft:l,columnHeaderHeightAndMarginTop:c}=i;return{startX:l,endX:l,startY:c,endY:c}}_getFreeze(){var t;const e=(t=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:t.skeleton.getWorksheetConfig();if(e!=null)return e.freeze}_getSheetObject(){return Ne(this._context.unit,this._context)}_refreshFreeze(e,t,r,i,s){var c;const l={startRow:e,startColumn:t,ySplit:r,xSplit:i};this._clearFreeze(),this._createFreeze(0,l),this._createFreeze(1,l),this._updateViewport(e,t,r,i,s),(c=this._getSheetObject())==null||c.spreadsheet.makeForceDirty()}};exports.HeaderFreezeRenderController=eS([wt(1,a.Inject(exports.SheetSkeletonManagerService)),wt(2,a.ICommandService),wt(3,a.Inject(m.SheetsSelectionsService)),wt(4,a.Inject(exports.SheetScrollManagerService)),wt(5,a.Inject(a.ThemeService)),wt(6,a.Inject(m.SheetInterceptorService)),wt(7,a.Inject(a.Injector))],exports.HeaderFreezeRenderController);var sS=Object.getOwnPropertyDescriptor,aS=(n,o,e,t)=>{for(var r=t>1?void 0:t?sS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},di=(n,o)=>(e,t)=>o(e,t,n);const lS="__SpreadsheetHeaderMoveControllerBackground__",cS="__SpreadsheetHeaderMoveControllerShapeLine__",dS="rgba(0, 0, 0, 0.1)",uS="rgb(119, 119, 119)",hS=4,ui=a.createInterceptorKey("headerMovePermissionCheck");exports.HeaderMoveRenderController=class extends a.Disposable{constructor(e,t,r,i){super();E(this,"_startOffsetX",Number.NEGATIVE_INFINITY);E(this,"_startOffsetY",Number.NEGATIVE_INFINITY);E(this,"_moveHelperBackgroundShape");E(this,"_moveHelperLineShape");E(this,"_headerPointerDownSubs");E(this,"_headerPointerMoveSubs");E(this,"_headerPointerLeaveSubs");E(this,"_dragHeaderMoveSub");E(this,"_scenePointerUpSub");E(this,"_scrollTimer");E(this,"_changeFromColumn",-1);E(this,"_changeFromRow",-1);E(this,"_changeToColumn",-1);E(this,"_changeToRow",-1);E(this,"interceptor",new a.InterceptorManager({HEADER_MOVE_PERMISSION_CHECK:ui}));E(this,"_workbookSelections");this._context=e,this._sheetSkeletonManagerService=r,this._commandService=i,this._workbookSelections=t.getWorkbookSelections(this._context.unitId),this._init()}dispose(){var e,t,r,i,s,l,c,d;(e=this._moveHelperBackgroundShape)==null||e.dispose(),(t=this._moveHelperLineShape)==null||t.dispose(),(r=this._headerPointerMoveSubs)==null||r.unsubscribe(),(i=this._headerPointerLeaveSubs)==null||i.unsubscribe(),(s=this._headerPointerDownSubs)==null||s.unsubscribe(),this._headerPointerMoveSubs=null,this._headerPointerLeaveSubs=null,this._headerPointerDownSubs=null,(l=this._dragHeaderMoveSub)==null||l.unsubscribe(),(c=this._scenePointerUpSub)==null||c.unsubscribe(),this._dragHeaderMoveSub=null,this._scenePointerUpSub=null,(d=this._scrollTimer)==null||d.dispose()}_init(){this._initialRowOrColumn(a.RANGE_TYPE.ROW),this._initialRowOrColumn(a.RANGE_TYPE.COLUMN)}_initialRowOrColumn(e=a.RANGE_TYPE.ROW){const t=this._context.components.get(ue.COLUMN),r=this._context.components.get(ue.ROW),i=this._context.scene,s=e===a.RANGE_TYPE.ROW?r:t,l=u=>{var _,R;const h=(_=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:_.skeleton;if(h==null)return;const g=(R=this._workbookSelections.getCurrentLastSelection())==null?void 0:R.range;if(!g||!this.interceptor.fetchThroughInterceptors(ui)(!1,g))return;const p=this._workbookSelections.getCurrentSelections(),{row:f,column:v}=ze(u.offsetX,u.offsetY,i,h);if(!lr(p,e===a.RANGE_TYPE.ROW?f:v,e)){i.resetCursor();return}i.setCursor(T.CURSOR_TYPE.GRAB)},c=()=>{var u,h;(u=this._moveHelperBackgroundShape)==null||u.hide(),(h=this._moveHelperLineShape)==null||h.hide(),i.resetCursor()},d=(u,h)=>{var H,k;if(h.isStopPropagation)return;const g=(H=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:H.skeleton;if(g==null)return;const S=(k=this._workbookSelections.getCurrentLastSelection())==null?void 0:k.range;if(!S||!this.interceptor.fetchThroughInterceptors(ui)(!1,S))return;const{offsetX:f,offsetY:v}=u,C=i.getCoordRelativeToViewport(T.Vector2.FromArray([f,v])),{x:_,y:R}=C;this._startOffsetX=_,this._startOffsetY=R;const{row:w,column:P}=ze(u.offsetX,u.offsetY,i,g);let y;e===a.RANGE_TYPE.ROW?(this._changeFromRow=w,y=T.ScrollTimerType.Y):(this._changeFromColumn=P,y=T.ScrollTimerType.X);const M=this._workbookSelections.getCurrentSelections(),x=lr(M,e===a.RANGE_TYPE.ROW?w:P,e);if(!x)return;const A=i.getScrollXYInfoByViewport(T.Vector2.FromArray([this._startOffsetX,this._startOffsetY]));this._newBackgroundAndLine(),i.setCursor(T.CURSOR_TYPE.GRABBING),i.disableObjectsEvent();let D=!1,N;const V=()=>{if(D)return;N=T.ScrollTimer.create(i,y),this._scrollTimer=N;const U=i.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);N.startScroll(_,R,U),D=!0};this._dragHeaderMoveSub=i.onPointerMove$.subscribeEvent(U=>{V();const{offsetX:L,offsetY:j}=U,{x:B,y:z}=i.getCoordRelativeToViewport(T.Vector2.FromArray([L,j]));this._rowColumnMoving(B,z,x,A,e),N.scrolling(B,z,()=>{this._rowColumnMoving(B,z,x,A,e)})}),this._scenePointerUpSub=i.onPointerUp$.subscribeEvent(()=>{var L,j,B;this._disposeBackgroundAndLine(),i.resetCursor(),i.enableObjectsEvent(),this._clearObserverEvent(),(L=this._scrollTimer)==null||L.dispose();const U=this._workbookSelections.getCurrentSelections();if(e===a.RANGE_TYPE.ROW){if(this._changeFromRow!==this._changeToRow&&this._changeToRow!==-1){const X=(j=((U==null?void 0:U.filter(K=>K.range.rangeType===a.RANGE_TYPE.ROW&&K.range.startRow<=this._changeFromRow&&this._changeFromRow<=K.range.endRow))||[])[0])==null?void 0:j.range;X&&this._commandService.executeCommand(m.MoveRowsCommand.id,{fromRange:X,toRange:{...X,startRow:this._changeToRow,endRow:this._changeToRow+X.endRow-X.startRow}})}this._changeToRow=this._changeFromRow=-1}else{if(this._changeFromColumn!==this._changeToColumn&&this._changeToColumn!==-1){const X=(B=((U==null?void 0:U.filter(K=>K.range.rangeType===a.RANGE_TYPE.COLUMN&&K.range.startColumn<=this._changeFromColumn&&this._changeFromColumn<=K.range.endColumn))||[])[0])==null?void 0:B.range;X&&this._commandService.executeCommand(m.MoveColsCommand.id,{fromRange:X,toRange:{...X,startColumn:this._changeToColumn,endColumn:this._changeToColumn+X.endColumn-X.startColumn}})}this._changeToColumn=this._changeFromColumn=-1}})};this._headerPointerMoveSubs=new O.Subscription,this._headerPointerMoveSubs.add(s.onPointerMove$.subscribeEvent(l)),this._headerPointerLeaveSubs=new O.Subscription,this._headerPointerLeaveSubs.add(s==null?void 0:s.onPointerLeave$.subscribeEvent(c)),this._headerPointerDownSubs=new O.Subscription,this._headerPointerDownSubs.add(s==null?void 0:s.onPointerDown$.subscribeEvent(d))}_rowColumnMoving(e,t,r,i,s){var z,X,K,ie,re,le,Z;const l=this._context.scene,c=(z=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:z.skeleton;if(c==null)return;const{rowHeaderWidth:d,columnHeaderHeight:u,rowTotalHeight:h,columnTotalWidth:g}=c,S=l.getViewportScrollXY(l.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN)),{scaleX:p,scaleY:f}=l.getAncestorScale(),v=c.getCellIndexByOffset(e,t,p,f,S),{row:C,column:_}=v,R=c.getNoMergeCellWithCoordByIndex(C,_),{startX:w,startY:P,endX:y,endY:M}=R,x=this._sheetSkeletonManagerService.attachRangeWithCoord(r.range);if(x==null)return;const A=Math.max(p,p),{startX:D,endX:N,startY:V,endY:H,startRow:k,startColumn:U,endRow:L,endColumn:j}=x;s===a.RANGE_TYPE.ROW?(X=this._moveHelperBackgroundShape)==null||X.transformByState({height:H-V,width:g+d,left:0,top:V+(t-this._startOffsetY)/A+S.y-i.y}):(K=this._moveHelperBackgroundShape)==null||K.transformByState({height:h+u,width:N-D,left:D+(e-this._startOffsetX)/A+S.x-i.x,top:0}),(ie=this._moveHelperBackgroundShape)==null||ie.show();const B=hS/A;if(s===a.RANGE_TYPE.ROW){let Y=0;if(C<=k)Y=P-B/2,this._changeToRow=C;else if(C>L)Y=M-B/2,this._changeToRow=C+1;else return;(re=this._moveHelperLineShape)==null||re.transformByState({height:B,width:g,left:d,top:Y})}else{let Y=0;if(_<=U)Y=w-B/2,this._changeToColumn=_;else if(_>j)Y=y-B/2,this._changeToColumn=_+1;else return;(le=this._moveHelperLineShape)==null||le.transformByState({height:h,width:B,left:Y,top:u})}(Z=this._moveHelperLineShape)==null||Z.show()}_clearObserverEvent(){var e,t;(e=this._dragHeaderMoveSub)==null||e.unsubscribe(),(t=this._scenePointerUpSub)==null||t.unsubscribe(),this._dragHeaderMoveSub=null,this._scenePointerUpSub=null}_newBackgroundAndLine(){const e=this._context.scene;this._moveHelperBackgroundShape=new T.Rect(lS,{fill:dS,evented:!1,zIndex:100}),this._moveHelperLineShape=new T.Rect(cS,{fill:uS,evented:!1,zIndex:100}),e.addObjects([this._moveHelperBackgroundShape,this._moveHelperLineShape],ht)}_disposeBackgroundAndLine(){var e,t;(e=this._moveHelperBackgroundShape)==null||e.dispose(),(t=this._moveHelperLineShape)==null||t.dispose()}};exports.HeaderMoveRenderController=aS([di(1,a.Inject(m.SheetsSelectionsService)),di(2,a.Inject(exports.SheetSkeletonManagerService)),di(3,a.ICommandService)],exports.HeaderMoveRenderController);var ki=(n=>(n[n.VERTICAL=0]="VERTICAL",n[n.HORIZONTAL=1]="HORIZONTAL",n))(ki||{});const mS="rgba(120, 120, 120, 0.01)",hi="rgb(68, 71, 70)",Qn=12,gS=44,Hi=4;class pa extends T.Shape{constructor(e,t){super(e,t);E(this,"_size",Qn);E(this,"_color",hi);E(this,"_mode",0);this.setShapeProps(t)}get size(){return this._size}get mode(){return this._mode}get color(){return this._color}_draw(e){const t=this.getScene();if(!t)return;const{scaleX:r,scaleY:i}=t.getAncestorScale(),s=Math.max(r,i),l=Qn/s,c=Hi/s;let{width:d,height:u}=this,h=0,g=0;this.mode===0?(d=c,h=l-c):(u=c,g=l-c),T.Rect.drawWith(e,{width:this.width,height:this.height,left:0,top:0,fill:mS}),T.Rect.drawWith(e,{width:d,height:u,fill:hi,radius:c}),e.save(),e.transform(1,0,0,1,h,g),T.Rect.drawWith(e,{width:d,height:u,fill:hi,radius:c}),e.restore()}setShapeProps(e){return e!=null&&e.size&&(this._size=e.size),e!=null&&e.mode&&(this._mode=e.mode),e!=null&&e.color&&(this._color=e.color),this.mode===0?this.transformByState({width:Qn,height:this.size}):this.transformByState({width:this.size,height:Qn}),this}}var SS=Object.getOwnPropertyDescriptor,pS=(n,o,e,t)=>{for(var r=t>1?void 0:t?SS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},mi=(n,o)=>(e,t)=>o(e,t,n);const fS="__SpreadsheetHeaderResizeControllerShapeRow__",vS="__SpreadsheetHeaderResizeControllerShapeColumn__",fa="__SpreadsheetHeaderResizeControllerShapeHelper__",va="rgb(199, 199, 199)",CS=2,gi=a.createInterceptorKey("headerResizePermissionCheck");exports.HeaderResizeRenderController=class extends a.Disposable{constructor(e,t,r,i){super();E(this,"_currentRow",0);E(this,"_currentColumn",0);E(this,"_rowResizeRect");E(this,"_columnResizeRect");E(this,"_headerPointerSubs");E(this,"_scenePointerMoveSub");E(this,"_scenePointerUpSub");E(this,"_resizeHelperShape");E(this,"_startOffsetX",Number.POSITIVE_INFINITY);E(this,"_startOffsetY",Number.POSITIVE_INFINITY);E(this,"interceptor",new a.InterceptorManager({HEADER_RESIZE_PERMISSION_CHECK:gi}));this._context=e,this._sheetSkeletonManagerService=t,this._selectionManagerService=r,this._commandService=i,this._init()}dispose(){var e,t,r;(e=this._rowResizeRect)==null||e.dispose(),this._rowResizeRect=null,(t=this._columnResizeRect)==null||t.dispose(),this._columnResizeRect=null,(r=this._headerPointerSubs)==null||r.unsubscribe(),this._headerPointerSubs=null}_init(){const e=this._context.scene;this._rowResizeRect=new pa(fS,{visible:!1,mode:ki.HORIZONTAL,zIndex:100}),this._columnResizeRect=new pa(vS,{visible:!1,mode:ki.VERTICAL,zIndex:100}),e.addObjects([this._rowResizeRect,this._columnResizeRect],ht),this._initialHover(0),this._initialHover(1),this._initialHoverResize(0),this._initialHoverResize(1)}_initialHover(e=0){const t=this._context.components.get(ue.COLUMN),r=this._context.components.get(ue.ROW),i=this._context.scene,s=e===0?r:t,l=(d,u)=>{var h,g;(h=this._rowResizeRect)==null||h.hide(),(g=this._columnResizeRect)==null||g.hide()},c=(d,u)=>{var A;const h=(A=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:A.skeleton;if(h==null||this._rowResizeRect==null||this._columnResizeRect==null)return;const{rowHeaderWidth:g,columnHeaderHeight:S}=h,{startX:p,startY:f,endX:v,endY:C,row:_,column:R}=ze(d.offsetX,d.offsetY,i,h),w=er(d.offsetX,d.offsetY,i),{scaleX:P,scaleY:y}=i.getAncestorScale(),M=Math.max(P,y),x=Qn/M;if(e===0){let D=f-x/2;if(w.y<=f+x/2&&w.y>=f)this._currentRow=_-1;else if(w.y>=C-x/2&&w.y<=C)this._currentRow=_,D=C-x/2;else{this._rowResizeRect.hide();return}if(this._currentRow===-1)return;if(!this.interceptor.fetchThroughInterceptors(gi)(null,{row:this._currentRow}))return!1;const V=Math.min(gS,g/3);this._rowResizeRect.transformByState({left:g/2-V/2,top:D}),this._rowResizeRect.setShapeProps({size:V}),this._rowResizeRect.show()}else{let D=p-x/2;if(w.x<=p+x/2&&w.x>=p)this._currentColumn=R-1;else if(w.x>=v-x/2&&w.x<=v)this._currentColumn=R,D=v-x/2;else{this._columnResizeRect.hide();return}if(this._currentColumn===-1)return;if(!this.interceptor.fetchThroughInterceptors(gi)(null,{col:this._currentColumn}))return!1;const V=S*.7;this._columnResizeRect.transformByState({left:D,top:S/2-V/2}),this._columnResizeRect.setShapeProps({size:V}),this._columnResizeRect.show()}};this._headerPointerSubs=new O.Subscription,this._headerPointerSubs.add(s==null?void 0:s.onPointerMove$.subscribeEvent(c)),this._headerPointerSubs.add(s==null?void 0:s.onPointerLeave$.subscribeEvent(l))}_initialHoverResize(e=0){const t=this._context.scene,r=e===0?this._rowResizeRect:this._columnResizeRect;r!=null&&(this.disposeWithMe(r.onPointerEnter$.subscribeEvent(()=>{r!=null&&(r.show(),t.setCursor(e===0?T.CURSOR_TYPE.ROW_RESIZE:T.CURSOR_TYPE.COLUMN_RESIZE))})),this.disposeWithMe(r.onPointerLeave$.subscribeEvent(()=>{r!=null&&(r.hide(),t.resetCursor())})),this.disposeWithMe(r.onPointerDown$.subscribeEvent(i=>{var j,B,z,X,K,ie,re;const s=(j=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:j.skeleton;if(s==null)return;const l=this._context.scene,c=l.getEngine(),d=(c==null?void 0:c.height)||0,u=(c==null?void 0:c.width)||0,h=l.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),g=(((z=(B=h==null?void 0:h.getScrollBar())==null?void 0:B.horizonScrollTrack)==null?void 0:z.height)||0)+10,S=(((K=(X=h==null?void 0:h.getScrollBar())==null?void 0:X.verticalScrollTrack)==null?void 0:K.width)||0)+10,p=er(i.offsetX,i.offsetY,l),{scaleX:f,scaleY:v}=l.getAncestorScale();this._startOffsetX=p.x,this._startOffsetY=p.y;const C=s.getOffsetByColumn(this._currentColumn),_=s.getOffsetByRow(this._currentRow),R=s.getNoMergeCellWithCoordByIndex(this._currentRow,this._currentColumn);let w=!1,P=0,y=0;const{columnTotalWidth:M,rowHeaderWidth:x,rowTotalHeight:A,columnHeaderHeight:D}=s,N=u>M+x?u:M+x,V=d>A+D?d:A+D,H=Math.max(f,v),k=Hi/H;e===0?this._resizeHelperShape=new T.Rect(fa,{width:N,height:k,fill:va,left:0,top:_-k/2}):this._resizeHelperShape=new T.Rect(fa,{width:k,height:V,fill:va,left:C-k/2,top:0});const U=((ie=this._columnResizeRect)==null?void 0:ie.left)||0,L=((re=this._rowResizeRect)==null?void 0:re.top)||0;l.addObject(this._resizeHelperShape,ht),l.disableObjectsEvent(),this._scenePointerMoveSub=l.onPointerMove$.subscribeEvent(le=>{var pe,be,Re,ot,it,It;const Z=l.getCoordRelativeToViewport(T.Vector2.FromArray([this._startOffsetX,this._startOffsetY])),Y=l.getScrollXYInfoByViewport(Z,h),q=er(le.offsetX,le.offsetY,l),{x:te,y:ce}=q,{scaleX:ne,scaleY:oe}=l.getAncestorScale(),$=Math.max(ne,oe),me=Hi/$;P=te-this._startOffsetX-me/2,y=ce-this._startOffsetY-me/2,Math.abs(e===0?y:P)>=CS&&(w=!0),e===0?(y>d-g+Y.y-R.startY&&(y=d-g+Y.y-R.startY),y<-(R.endY-R.startY)+2&&(y=-(R.endY-R.startY)+2),w&&((pe=this._resizeHelperShape)==null||pe.transformByState({top:_+y}),(be=this._rowResizeRect)==null||be.transformByState({top:L+y+me/2}),(Re=this._rowResizeRect)==null||Re.show(),l.setCursor(T.CURSOR_TYPE.ROW_RESIZE))):(P>u-S+Y.x-R.startX&&(P=u-S+Y.x-R.startX),P<-(R.endX-R.startX)+2&&(P=-(R.endX-R.startX)+2),w&&((ot=this._resizeHelperShape)==null||ot.transformByState({left:C+P}),(it=this._columnResizeRect)==null||it.transformByState({left:U+P+me/2}),(It=this._columnResizeRect)==null||It.show(),l.setCursor(T.CURSOR_TYPE.COLUMN_RESIZE)))}),this._scenePointerUpSub=l.onPointerUp$.subscribeEvent(le=>{var Y,q,te;const Z=this._context.scene;this._clearObserverEvent(),(Y=this._resizeHelperShape)==null||Y.dispose(),this._resizeHelperShape=null,Z.enableObjectsEvent(),w&&(Z.resetCursor(),(q=this._rowResizeRect)==null||q.hide(),(te=this._columnResizeRect)==null||te.hide(),e===0?this._commandService.executeCommand(m.DeltaRowHeightCommand.id,{deltaY:y,anchorRow:this._currentRow}):this._commandService.executeCommand(m.DeltaColumnWidthCommand.id,{deltaX:P,anchorCol:this._currentColumn}))})})),this.disposeWithMe(r.onDblclick$.subscribeEvent(()=>{var h,g,S;this._context.scene.resetCursor();const s=(h=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:h.skeleton;if(!s)return;const l=0,c=0,d=s.worksheet.getRowCount()-1||0,u=s.worksheet.getColumnCount()-1||0;switch(e){case 1:{const p=this._selectionManagerService.getCurrentSelections(),f=[];for(let v=0;v<p.length;v++){const C=p[v];C.range.rangeType===a.RANGE_TYPE.COLUMN&&this._currentColumn<=C.range.endColumn&&this._currentColumn>=C.range.startColumn&&f.push({startColumn:C.range.startColumn,endColumn:C.range.endColumn,startRow:l,endRow:d})}f.length===0&&f.push({startColumn:this._currentColumn,endColumn:this._currentColumn,startRow:l,endRow:d}),this._commandService.executeCommand(Dn.id,{ranges:f}),(g=this._columnResizeRect)==null||g.hide();break}case 0:this._commandService.executeCommand(m.SetWorksheetRowIsAutoHeightCommand.id,{ranges:[{startRow:this._currentRow,endRow:this._currentRow,startColumn:c,endColumn:u}]}),(S=this._rowResizeRect)==null||S.hide();break}})))}_clearObserverEvent(){var e,t;(e=this._scenePointerMoveSub)==null||e.unsubscribe(),(t=this._scenePointerUpSub)==null||t.unsubscribe(),this._scenePointerMoveSub=null,this._scenePointerUpSub=null}};exports.HeaderResizeRenderController=pS([mi(1,a.Inject(exports.SheetSkeletonManagerService)),mi(2,a.Inject(m.SheetsSelectionsService)),mi(3,a.ICommandService)],exports.HeaderResizeRenderController);var IS=Object.getOwnPropertyDescriptor,_S=(n,o,e,t)=>{for(var r=t>1?void 0:t?IS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},zn=(n,o)=>(e,t)=>o(e,t,n);const bS=60;exports.SheetRenderController=class extends a.RxDisposable{constructor(e,t,r,i,s,l){super();E(this,"_renderMetric$",new O.Subject);E(this,"renderMetric$",this._renderMetric$.asObservable());E(this,"_renderFrameTimeMetric",null);E(this,"_renderFrameTags",{});E(this,"_afterRenderMetric$",new O.Subject);this._context=e,this._configService=t,this._sheetSkeletonManagerService=r,this._sheetRenderService=i,this._commandService=s,this._telemetryService=l,this._addNewRender(),this._initRenderMetricSubscriber()}_addNewRender(){const{scene:e,engine:t,unit:r}=this._context;this._addComponent(r),this._initRerenderScheduler(),this._initCommandListener();const i=this._context.unit.getActiveSheet();if(!i)throw new Error("No active sheet found");const s=i.getSheetId();this._sheetSkeletonManagerService.setCurrent({sheetId:s});const l=()=>e.render();this.disposeWithMe(this._context.activated$.subscribe(c=>{c?t.runRenderLoop(l):t.stopRenderLoop(l)}))}_initRenderMetricSubscriber(){const{engine:e}=this._context;e.beginFrame$.subscribe(()=>{this._renderFrameTimeMetric=null,this._renderFrameTags={}}),e.endFrame$.subscribe(()=>{this._renderFrameTimeMetric&&Object.keys(this._renderFrameTimeMetric).filter(i=>i.startsWith(T.SHEET_EXTENSION_PREFIX)).length>0&&this._afterRenderMetric$.next({frameTimeMetric:this._renderFrameTimeMetric,tags:this._renderFrameTags})}),e.renderFrameTimeMetric$.subscribe(([r,i])=>{this._renderFrameTimeMetric||(this._renderFrameTimeMetric={}),this._renderFrameTimeMetric[r]||(this._renderFrameTimeMetric[r]=[]),this._renderFrameTimeMetric[r].push(Math.round(i*100)/100)}),e.renderFrameTags$.subscribe(([r,i])=>{this._renderFrameTags[r]=i});const t=[];this._afterRenderMetric$.pipe(O.withLatestFrom(e.endFrame$)).subscribe(([r,i])=>{t.push({FPS:i.FPS,elapsedTime:i.elapsedTime,frameTime:Math.round(i.frameTime*100)/100,...r.frameTimeMetric,...r.tags}),t.length>bS&&(this._captureRenderMetric(t),t.length=0)})}_captureRenderMetric(e){var g;const t=e;if(t.length===0)return;const r=S=>{let p=0;const v=Object.entries(S).filter(([_,R])=>Array.isArray(R)).map(([_])=>_).reduce((_,R)=>{const w=S[R].reduce((P,y)=>P+y,0);return _[R]=w,_},{});return Object.keys(S).filter(_=>_.startsWith(T.SHEET_EXTENSION_PREFIX)).forEach(_=>{p+=v[_]}),{...v,extensionTotal:p}},i=e.map(S=>({...S,...r(S)})),l=(S=>Object.entries(S[0]).filter(([v,C])=>!["elapsedTime"].includes(v)).filter(([v,C])=>typeof C=="number").map(([v])=>v).reduce((v,C)=>{const _=S.map(y=>y[C]),R=Math.max(..._),w=Math.min(..._),P=_.reduce((y,M)=>y+M,0)/_.length;return v[C]={max:Math.round(R*100)/100,min:Math.round(w*100)/100,avg:Math.round(P*100)/100},v},{}))(i),c=t[t.length-1].elapsedTime,d=this._context.unit.getActiveSheet().getSheetId(),u=this._context.unit.getUnitId(),h={sheetId:d,unitId:u,elapsedTimeToStart:c,...l};this._renderMetric$.next(h),(g=this._telemetryService)==null||g.capture("sheet_render_cost",h)}_addComponent(e){const{scene:t,components:r}=this._context,i=e.getActiveSheet(),s=new T.Spreadsheet(ue.MAIN);this._addViewport(i);const l=new T.SpreadsheetRowHeader(ue.ROW),c=new T.SpreadsheetColumnHeader(ue.COLUMN),d=new T.Rect(ue.LEFT_TOP,{zIndex:2,left:-1,top:-1,fill:"rgb(248, 249, 250)",stroke:"rgb(217, 217, 217)",strokeWidth:1});this._context.mainComponent=s,r.set(ue.MAIN,s),r.set(ue.ROW,l),r.set(ue.COLUMN,c),r.set(ue.LEFT_TOP,d),t.addObjects([s],Ms),t.addObjects([l,c,d],ht),t.enableLayerCache(Ms,ht)}_initViewports(e,t,r){const l=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN,e,{left:t.width,top:r.height,bottom:0,right:0,isWheelPreventDefaultX:!0,allowCache:!0,bufferEdgeX:100,bufferEdgeY:100}),c=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT_TOP,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:0,bufferEdgeY:0}),d=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_LEFT,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:0,bufferEdgeY:100}),u=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN_TOP,e,{isWheelPreventDefaultX:!0,active:!1,allowCache:!0,bufferEdgeX:100,bufferEdgeY:0}),h=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_TOP,e,{active:!1,isWheelPreventDefaultX:!0}),g=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_ROW_BOTTOM,e,{left:0,top:r.height,bottom:0,width:t.width+1,isWheelPreventDefaultX:!0}),S=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_LEFT,e,{active:!1,isWheelPreventDefaultX:!0}),p=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_COLUMN_RIGHT,e,{left:t.width,top:0,height:r.height+1,right:0,isWheelPreventDefaultX:!0}),f=new T.Viewport(T.SHEET_VIEWPORT_KEY.VIEW_LEFT_TOP,e,{left:0,top:0,width:t.width,height:r.height,isWheelPreventDefaultX:!0});return{viewMain:l,viewLeftTop:f,viewMainLeftTop:c,viewMainLeft:d,viewMainTop:u,viewColumnLeft:S,viewRowTop:h,viewRowBottom:g,viewColumnRight:p}}_addViewport(e){const t=this._context.scene,{rowHeader:r,columnHeader:i}=e.getConfig(),{viewMain:s}=this._initViewports(t,r,i),l=this._configService.getConfig(Ee),c=l==null?void 0:l.scrollConfig;return new T.ScrollBar(s,c),t.attachControl(),s}_initRerenderScheduler(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{if(!e)return null;const{skeleton:t,sheetId:r}=e,i=this._context.unit,s=i==null?void 0:i.getSheetBySheetId(r);if(i==null||s==null)return;const{mainComponent:l,components:c}=this._context,d=l,u=c.get(ue.ROW),h=c.get(ue.COLUMN),g=c.get(ue.LEFT_TOP),{rowHeaderWidth:S,columnHeaderHeight:p}=t;d==null||d.updateSkeleton(t),u==null||u.updateSkeleton(t),h==null||h.updateSkeleton(t),g==null||g.transformByState({width:S,height:p})}))}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{const{unit:t}=this._context,{id:r}=e;if(m.COMMAND_LISTENER_SKELETON_CHANGE.includes(r)||this._sheetRenderService.checkMutationShouldTriggerRerender(r)){const i=e.params,{unitId:s,subUnitId:l}=i,c=t.getActiveSheet();if(!c)return;const d=this._context.unitId,u=c.getSheetId();if(s!==d||l!==u)return;this._sheetSkeletonManagerService.makeDirty({sheetId:u,commandId:r},!0),this._sheetSkeletonManagerService.setCurrent({sheetId:u,commandId:r})}else m.COMMAND_LISTENER_VALUE_CHANGE.includes(r)&&this._sheetSkeletonManagerService.reCalculate();e.type===a.CommandType.MUTATION&&this._markUnitDirty(e)}))}_markUnitDirty(e){const{mainComponent:t,scene:r}=this._context;if(e.id===G.SetFormulaCalculationNotificationMutation.id&&e.params.stageInfo!=null||(t&&t.makeDirty(),r.makeDirty(),!e.params))return;const i=e.params,s=this._spreadsheetViewports(r);if(e.id===m.SetRangeValuesMutation.id&&i.cellValue){const l=this._cellValueToRange(i.cellValue),c=this._rangeToBounds([l]);this._markViewportDirty(s,c),t.setDirtyArea(c)}if(e.id===m.MoveRangeMutation.id&&i.from&&i.to){const l=i.fromRange||this._cellValueToRange(i.from.value),c=i.toRange||this._cellValueToRange(i.to.value),d=this._rangeToBounds([l,c]);this._markViewportDirty(s,d),t.setDirtyArea(d)}}_cellValueToRange(e){let t=0,r=0,i=0,s=0;for(const[h,g]of Object.entries(e)){for(const S in g)t>Number(S)&&(t=Number(S)),r<Number(S)&&(r=Number(S));i>Number(h)&&(i=Number(h)),s<Number(h)&&(s=Number(h))}return{startRow:i,endRow:s,startColumn:t,endColumn:r}}_rangeToBounds(e){const t=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{rowHeightAccumulation:r,columnWidthAccumulation:i,rowHeaderWidth:s,columnHeaderHeight:l}=t,c=[];for(const d of e){const{startRow:u,endRow:h,startColumn:g,endColumn:S}=d,p=u===0?0:r[u-1]+l,f=r[h]+l,v=g===0?0:i[g-1]+s,C=i[S]+s;c.push({top:p,left:v,bottom:f,right:C,width:C-v,height:f-p})}return c}_markViewportDirty(e,t){const r=e.filter(i=>i.isActive&&i.cacheBound);for(const i of r)for(const s of t)a.Rectangle.hasIntersectionBetweenTwoRect(i.cacheBound,s)&&i.markDirty(!0)}_spreadsheetViewports(e){return e.getViewports().filter(t=>["viewMain","viewMainLeftTop","viewMainTop","viewMainLeft"].includes(t.viewportKey))}};exports.SheetRenderController=_S([zn(1,a.Inject(a.IConfigService)),zn(2,a.Inject(exports.SheetSkeletonManagerService)),zn(3,a.Inject(exports.SheetsRenderService)),zn(4,a.ICommandService),zn(5,a.Optional(ud.ITelemetryService))],exports.SheetRenderController);const RS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M0.98999 1.08218H-0.0100098V0.0821838H0.98999V1.08218Z"}),b.jsx("path",{d:"M5.78992 1.08218H2.78992V0.0821838H5.78992V1.08218Z"}),b.jsx("path",{d:"M7.58984 1.08218H8.58984V0.0821838H7.58984V1.08218Z"}),b.jsx("path",{d:"M14.9152 1.08218H13.9152V0.0821838H14.9152V1.08218Z"}),b.jsx("path",{d:"M16.7151 1.08218H19.7151V0.0821838H16.7151V1.08218Z"}),b.jsx("path",{d:"M22.515 1.08218H21.515V0.0821838H22.515V1.08218Z"}),b.jsx("path",{d:"M27.8405 1.08218H28.8405V0.0821838H27.8405V1.08218Z"}),b.jsx("path",{d:"M33.6404 1.08218H30.6404V0.0821838H33.6404V1.08218Z"}),b.jsx("path",{d:"M35.4403 1.08218H36.4403V0.0821838H35.4403V1.08218Z"}),b.jsx("path",{d:"M42.7657 1.08218H41.7657V0.0821838H42.7657V1.08218Z"}),b.jsx("path",{d:"M44.5657 1.08218H47.5657V0.0821838H44.5657V1.08218Z"}),b.jsx("path",{d:"M50.3656 1.08218H49.3656V0.0821838H50.3656V1.08218Z"}),b.jsx("path",{d:"M55.691 1.08218H56.691V0.0821838H55.691V1.08218Z"}),b.jsx("path",{d:"M61.491 1.08218H58.491V0.0821838H61.491V1.08218Z"}),b.jsx("path",{d:"M63.2909 1.08218H64.2909V0.0821838H63.2909V1.08218Z"}),b.jsx("path",{d:"M70.6163 1.08218H69.6163V0.0821838H70.6163V1.08218Z"}),b.jsx("path",{d:"M72.4163 1.08218H75.4163V0.0821838H72.4163V1.08218Z"}),b.jsx("path",{d:"M78.2162 1.08218H77.2162V0.0821838H78.2162V1.08218Z"}),b.jsx("path",{d:"M83.5416 1.08218H84.5416V0.0821838H83.5416V1.08218Z"}),b.jsx("path",{d:"M89.3416 1.08218H86.3416V0.0821838H89.3416V1.08218Z"}),b.jsx("path",{d:"M91.1415 1.08218H92.1415V0.0821838H91.1415V1.08218Z"}),b.jsx("path",{d:"M98.4669 1.08218H97.4669V0.0821838H98.4669V1.08218Z"}),b.jsx("path",{d:"M100.267 1.08218H103.267V0.0821838H100.267V1.08218Z"}),b.jsx("path",{d:"M106.067 1.08218H105.067V0.0821838H106.067V1.08218Z"}),b.jsx("path",{d:"M111.392 1.08218H112.392V0.0821838H111.392V1.08218Z"}),b.jsx("path",{d:"M117.192 1.08218H114.192V0.0821838H117.192V1.08218Z"}),b.jsx("path",{d:"M118.992 1.08218H119.992V0.0821838H118.992V1.08218Z"})]}),wS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.0100098 1.15771H0.98999V0.157715H-0.0100098V1.15771Z"}),b.jsx("path",{d:"M2.78992 1.15771H5.78992V0.157715H2.78992V1.15771Z"}),b.jsx("path",{d:"M8.58984 1.15771H7.58984V0.157715H8.58984V1.15771Z"}),b.jsx("path",{d:"M10.3899 1.15771H11.3899V0.157715H10.3899V1.15771Z"}),b.jsx("path",{d:"M19.0903 1.15771H18.0903V0.157715H19.0903V1.15771Z"}),b.jsx("path",{d:"M20.8903 1.15771H23.8903V0.157715H20.8903V1.15771Z"}),b.jsx("path",{d:"M26.6902 1.15771H25.6902V0.157715H26.6902V1.15771Z"}),b.jsx("path",{d:"M28.4902 1.15771H29.4902V0.157715H28.4902V1.15771Z"}),b.jsx("path",{d:"M37.1907 1.15771H36.1907V0.157715H37.1907V1.15771Z"}),b.jsx("path",{d:"M38.9906 1.15771H41.9906V0.157715H38.9906V1.15771Z"}),b.jsx("path",{d:"M44.7905 1.15771H43.7905V0.157715H44.7905V1.15771Z"}),b.jsx("path",{d:"M46.5906 1.15771H47.5906V0.157715H46.5906V1.15771Z"}),b.jsx("path",{d:"M55.291 1.15771H54.291V0.157715H55.291V1.15771Z"}),b.jsx("path",{d:"M57.0909 1.15771H60.0909V0.157715H57.0909V1.15771Z"}),b.jsx("path",{d:"M62.8909 1.15771H61.8909V0.157715H62.8909V1.15771Z"}),b.jsx("path",{d:"M64.6909 1.15771H65.6909V0.157715H64.6909V1.15771Z"}),b.jsx("path",{d:"M73.3914 1.15771H72.3914V0.157715H73.3914V1.15771Z"}),b.jsx("path",{d:"M75.1913 1.15771H78.1913V0.157715H75.1913V1.15771Z"}),b.jsx("path",{d:"M80.9912 1.15771H79.9912V0.157715H80.9912V1.15771Z"}),b.jsx("path",{d:"M82.7913 1.15771H83.7913V0.157715H82.7913V1.15771Z"}),b.jsx("path",{d:"M91.4917 1.15771H90.4917V0.157715H91.4917V1.15771Z"}),b.jsx("path",{d:"M93.2916 1.15771H96.2916V0.157715H93.2916V1.15771Z"}),b.jsx("path",{d:"M99.0916 1.15771H98.0916V0.157715H99.0916V1.15771Z"}),b.jsx("path",{d:"M100.892 1.15771H101.892V0.157715H100.892V1.15771Z"}),b.jsx("path",{d:"M109.592 1.15771H108.592V0.157715H109.592V1.15771Z"}),b.jsx("path",{d:"M111.392 1.15771H114.392V0.157715H111.392V1.15771Z"}),b.jsx("path",{d:"M117.192 1.15771H116.192V0.157715H117.192V1.15771Z"}),b.jsx("path",{d:"M118.992 1.15771H119.992V0.157715H118.992V1.15771Z"})]}),ES=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.00842285 1.22449H2.99158V0.224487H-0.00842285V1.22449Z"}),b.jsx("path",{d:"M6.14941 1.22449H9.14941V0.224487H6.14941V1.22449Z"}),b.jsx("path",{d:"M15.3073 1.22449H12.3073V0.224487H15.3073V1.22449Z"}),b.jsx("path",{d:"M18.4651 1.22449H21.4651V0.224487H18.4651V1.22449Z"}),b.jsx("path",{d:"M27.6229 1.22449H24.6229V0.224487H27.6229V1.22449Z"}),b.jsx("path",{d:"M30.7808 1.22449H33.7808V0.224487H30.7808V1.22449Z"}),b.jsx("path",{d:"M39.9386 1.22449H36.9386V0.224487H39.9386V1.22449Z"}),b.jsx("path",{d:"M43.0964 1.22449H46.0964V0.224487H43.0964V1.22449Z"}),b.jsx("path",{d:"M52.2543 1.22449H49.2543V0.224487H52.2543V1.22449Z"}),b.jsx("path",{d:"M55.4121 1.22449H58.4121V0.224487H55.4121V1.22449Z"}),b.jsx("path",{d:"M64.5699 1.22449H61.5699V0.224487H64.5699V1.22449Z"}),b.jsx("path",{d:"M67.7278 1.22449H70.7278V0.224487H67.7278V1.22449Z"}),b.jsx("path",{d:"M76.8856 1.22449H73.8856V0.224487H76.8856V1.22449Z"}),b.jsx("path",{d:"M80.0435 1.22449H83.0435V0.224487H80.0435V1.22449Z"}),b.jsx("path",{d:"M89.2013 1.22449H86.2013V0.224487H89.2013V1.22449Z"}),b.jsx("path",{d:"M92.3591 1.22449H95.3591V0.224487H92.3591V1.22449Z"}),b.jsx("path",{d:"M101.517 1.22449H98.517V0.224487H101.517V1.22449Z"}),b.jsx("path",{d:"M104.675 1.22449H107.675V0.224487H104.675V1.22449Z"}),b.jsx("path",{d:"M113.833 1.22449H110.833V0.224487H113.833V1.22449Z"}),b.jsx("path",{d:"M116.99 1.22449H119.99V0.224487H116.99V1.22449Z"})]}),TS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"8",viewBox:"0 0 120 8",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 2.06215H-0.0090332V0.862152H119.991V1.86215Z"}),b.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 6.66215H-0.0090332V5.86215H119.991V6.86215Z"})]}),yS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.00976562 1.65707H0.990234V0.657074H-0.00976562V1.65707Z"}),b.jsx("path",{d:"M2.32361 1.65707H3.32361V0.657074H2.32361V1.65707Z"}),b.jsx("path",{d:"M5.65698 1.65707H4.65698V0.657074H5.65698V1.65707Z"}),b.jsx("path",{d:"M6.99036 1.65707H7.99036V0.657074H6.99036V1.65707Z"}),b.jsx("path",{d:"M10.3237 1.65707H9.32373V0.657074H10.3237V1.65707Z"}),b.jsx("path",{d:"M11.6571 1.65707H12.6571V0.657074H11.6571V1.65707Z"}),b.jsx("path",{d:"M14.9905 1.65707H13.9905V0.657074H14.9905V1.65707Z"}),b.jsx("path",{d:"M16.3239 1.65707H17.3239V0.657074H16.3239V1.65707Z"}),b.jsx("path",{d:"M19.6572 1.65707H18.6572V0.657074H19.6572V1.65707Z"}),b.jsx("path",{d:"M20.9906 1.65707H21.9906V0.657074H20.9906V1.65707Z"}),b.jsx("path",{d:"M24.324 1.65707H23.324V0.657074H24.324V1.65707Z"}),b.jsx("path",{d:"M25.6573 1.65707H26.6573V0.657074H25.6573V1.65707Z"}),b.jsx("path",{d:"M28.9907 1.65707H27.9907V0.657074H28.9907V1.65707Z"}),b.jsx("path",{d:"M30.3241 1.65707H31.3241V0.657074H30.3241V1.65707Z"}),b.jsx("path",{d:"M33.6575 1.65707H32.6575V0.657074H33.6575V1.65707Z"}),b.jsx("path",{d:"M34.9908 1.65707H35.9908V0.657074H34.9908V1.65707Z"}),b.jsx("path",{d:"M38.3242 1.65707H37.3242V0.657074H38.3242V1.65707Z"}),b.jsx("path",{d:"M39.6576 1.65707H40.6576V0.657074H39.6576V1.65707Z"}),b.jsx("path",{d:"M42.991 1.65707H41.991V0.657074H42.991V1.65707Z"}),b.jsx("path",{d:"M44.3243 1.65707H45.3243V0.657074H44.3243V1.65707Z"}),b.jsx("path",{d:"M47.6577 1.65707H46.6577V0.657074H47.6577V1.65707Z"}),b.jsx("path",{d:"M48.9911 1.65707H49.9911V0.657074H48.9911V1.65707Z"}),b.jsx("path",{d:"M52.3245 1.65707H51.3245V0.657074H52.3245V1.65707Z"}),b.jsx("path",{d:"M53.6578 1.65707H54.6578V0.657074H53.6578V1.65707Z"}),b.jsx("path",{d:"M56.9912 1.65707H55.9912V0.657074H56.9912V1.65707Z"}),b.jsx("path",{d:"M58.3246 1.65707H59.3246V0.657074H58.3246V1.65707Z"}),b.jsx("path",{d:"M61.658 1.65707H60.658V0.657074H61.658V1.65707Z"}),b.jsx("path",{d:"M62.9913 1.65707H63.9913V0.657074H62.9913V1.65707Z"}),b.jsx("path",{d:"M66.3247 1.65707H65.3247V0.657074H66.3247V1.65707Z"}),b.jsx("path",{d:"M67.6581 1.65707H68.6581V0.657074H67.6581V1.65707Z"}),b.jsx("path",{d:"M70.9915 1.65707H69.9915V0.657074H70.9915V1.65707Z"}),b.jsx("path",{d:"M72.3248 1.65707H73.3248V0.657074H72.3248V1.65707Z"}),b.jsx("path",{d:"M75.6582 1.65707H74.6582V0.657074H75.6582V1.65707Z"}),b.jsx("path",{d:"M76.9916 1.65707H77.9916V0.657074H76.9916V1.65707Z"}),b.jsx("path",{d:"M80.325 1.65707H79.325V0.657074H80.325V1.65707Z"}),b.jsx("path",{d:"M81.6583 1.65707H82.6583V0.657074H81.6583V1.65707Z"}),b.jsx("path",{d:"M84.9917 1.65707H83.9917V0.657074H84.9917V1.65707Z"}),b.jsx("path",{d:"M86.3251 1.65707H87.3251V0.657074H86.3251V1.65707Z"}),b.jsx("path",{d:"M89.6584 1.65707H88.6584V0.657074H89.6584V1.65707Z"}),b.jsx("path",{d:"M90.9918 1.65707H91.9918V0.657074H90.9918V1.65707Z"}),b.jsx("path",{d:"M94.3252 1.65707H93.3252V0.657074H94.3252V1.65707Z"}),b.jsx("path",{d:"M95.6586 1.65707H96.6586V0.657074H95.6586V1.65707Z"}),b.jsx("path",{d:"M98.9919 1.65707H97.9919V0.657074H98.9919V1.65707Z"}),b.jsx("path",{d:"M100.325 1.65707H101.325V0.657074H100.325V1.65707Z"}),b.jsx("path",{d:"M103.659 1.65707H102.659V0.657074H103.659V1.65707Z"}),b.jsx("path",{d:"M104.992 1.65707H105.992V0.657074H104.992V1.65707Z"}),b.jsx("path",{d:"M108.325 1.65707H107.325V0.657074H108.325V1.65707Z"}),b.jsx("path",{d:"M109.659 1.65707H110.659V0.657074H109.659V1.65707Z"}),b.jsx("path",{d:"M112.992 1.65707H111.992V0.657074H112.992V1.65707Z"}),b.jsx("path",{d:"M114.325 1.65707H115.325V0.657074H114.325V1.65707Z"}),b.jsx("path",{d:"M117.659 1.65707H116.659V0.657074H117.659V1.65707Z"}),b.jsx("path",{d:"M118.992 1.65707H119.992V0.657074H118.992V1.65707Z"})]}),MS=({className:n})=>b.jsx("svg",{className:n,width:"120",height:"3",viewBox:"0 0 120 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:b.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 2.42035H-0.0090332V0.420349H119.991V2.42035Z"})}),PS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"3",viewBox:"0 0 120 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.0100098 2.47614H1.98999V0.476135H-0.0100098V2.47614Z"}),b.jsx("path",{d:"M3.99014 2.47614H9.99014V0.476135H3.99014V2.47614Z"}),b.jsx("path",{d:"M13.9901 2.47614H11.9901V0.476135H13.9901V2.47614Z"}),b.jsx("path",{d:"M21.1904 2.47614H23.1904V0.476135H21.1904V2.47614Z"}),b.jsx("path",{d:"M31.1906 2.47614H25.1906V0.476135H31.1906V2.47614Z"}),b.jsx("path",{d:"M33.1906 2.47614H35.1906V0.476135H33.1906V2.47614Z"}),b.jsx("path",{d:"M44.3909 2.47614H42.3909V0.476135H44.3909V2.47614Z"}),b.jsx("path",{d:"M46.391 2.47614H52.391V0.476135H46.391V2.47614Z"}),b.jsx("path",{d:"M56.391 2.47614H54.391V0.476135H56.391V2.47614Z"}),b.jsx("path",{d:"M63.5913 2.47614H65.5913V0.476135H63.5913V2.47614Z"}),b.jsx("path",{d:"M73.5915 2.47614H67.5915V0.476135H73.5915V2.47614Z"}),b.jsx("path",{d:"M75.5915 2.47614H77.5915V0.476135H75.5915V2.47614Z"}),b.jsx("path",{d:"M86.7917 2.47614H84.7917V0.476135H86.7917V2.47614Z"}),b.jsx("path",{d:"M88.7919 2.47614H94.7919V0.476135H88.7919V2.47614Z"}),b.jsx("path",{d:"M98.7919 2.47614H96.7919V0.476135H98.7919V2.47614Z"}),b.jsx("path",{d:"M105.992 2.47614H107.992V0.476135H105.992V2.47614Z"}),b.jsx("path",{d:"M115.992 2.47614H109.992V0.476135H115.992V2.47614Z"}),b.jsx("path",{d:"M117.992 2.47614H119.992V0.476135H117.992V2.47614Z"})]}),xS=({className:n})=>b.jsxs("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.0100098 2.00415H1.98999V0.00415039H-0.0100098V2.00415Z"}),b.jsx("path",{d:"M3.99014 2.00415H9.99014V0.00415039H3.99014V2.00415Z"}),b.jsx("path",{d:"M13.9901 2.00415H11.9901V0.00415039H13.9901V2.00415Z"}),b.jsx("path",{d:"M15.9901 2.00415H17.9901V0.00415039H15.9901V2.00415Z"}),b.jsx("path",{d:"M27.4905 2.00415H25.4905V0.00415039H27.4905V2.00415Z"}),b.jsx("path",{d:"M29.4906 2.00415H35.4906V0.00415039H29.4906V2.00415Z"}),b.jsx("path",{d:"M39.4906 2.00415H37.4906V0.00415039H39.4906V2.00415Z"}),b.jsx("path",{d:"M41.4906 2.00415H43.4906V0.00415039H41.4906V2.00415Z"}),b.jsx("path",{d:"M52.991 2.00415H50.991V0.00415039H52.991V2.00415Z"}),b.jsx("path",{d:"M54.9911 2.00415H60.9911V0.00415039H54.9911V2.00415Z"}),b.jsx("path",{d:"M64.9911 2.00415H62.9911V0.00415039H64.9911V2.00415Z"}),b.jsx("path",{d:"M66.9911 2.00415H68.9911V0.00415039H66.9911V2.00415Z"}),b.jsx("path",{d:"M78.4915 2.00415H76.4915V0.00415039H78.4915V2.00415Z"}),b.jsx("path",{d:"M80.4916 2.00415H86.4916V0.00415039H80.4916V2.00415Z"}),b.jsx("path",{d:"M90.4916 2.00415H88.4916V0.00415039H90.4916V2.00415Z"}),b.jsx("path",{d:"M92.4916 2.00415H94.4916V0.00415039H92.4916V2.00415Z"}),b.jsx("path",{d:"M103.992 2.00415H101.992V0.00415039H103.992V2.00415Z"}),b.jsx("path",{d:"M105.992 2.00415H111.992V0.00415039H105.992V2.00415Z"}),b.jsx("path",{d:"M115.992 2.00415H113.992V0.00415039H115.992V2.00415Z"}),b.jsx("path",{d:"M117.992 2.00415H119.992V0.00415039H117.992V2.00415Z"})]}),OS=({className:n})=>b.jsxs("svg",{className:n,width:"118",height:"3",viewBox:"0 0 118 3",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[b.jsx("path",{d:"M-0.00854492 2.94815H1.99146V0.948151H-0.00854492V2.94815Z"}),b.jsx("path",{d:"M6.09668 2.94815H8.09668V0.948151H6.09668V2.94815Z"}),b.jsx("path",{d:"M14.2019 2.94815H12.2019V0.948151H14.2019V2.94815Z"}),b.jsx("path",{d:"M18.3071 2.94815H20.3071V0.948151H18.3071V2.94815Z"}),b.jsx("path",{d:"M26.4124 2.94815H24.4124V0.948151H26.4124V2.94815Z"}),b.jsx("path",{d:"M30.5176 2.94815H32.5176V0.948151H30.5176V2.94815Z"}),b.jsx("path",{d:"M38.6228 2.94815H36.6228V0.948151H38.6228V2.94815Z"}),b.jsx("path",{d:"M42.728 2.94815H44.728V0.948151H42.728V2.94815Z"}),b.jsx("path",{d:"M50.8333 2.94815H48.8333V0.948151H50.8333V2.94815Z"}),b.jsx("path",{d:"M54.9385 2.94815H56.9385V0.948151H54.9385V2.94815Z"}),b.jsx("path",{d:"M63.0437 2.94815H61.0437V0.948151H63.0437V2.94815Z"}),b.jsx("path",{d:"M67.1489 2.94815H69.1489V0.948151H67.1489V2.94815Z"}),b.jsx("path",{d:"M75.2542 2.94815H73.2542V0.948151H75.2542V2.94815Z"}),b.jsx("path",{d:"M79.3594 2.94815H81.3594V0.948151H79.3594V2.94815Z"}),b.jsx("path",{d:"M87.4645 2.94815H85.4645V0.948151H87.4645V2.94815Z"}),b.jsx("path",{d:"M91.5697 2.94815H93.5697V0.948151H91.5697V2.94815Z"}),b.jsx("path",{d:"M99.6749 2.94815H97.6749V0.948151H99.6749V2.94815Z"}),b.jsx("path",{d:"M103.78 2.94815H105.78V0.948151H103.78V2.94815Z"}),b.jsx("path",{d:"M111.885 2.94815H109.885V0.948151H111.885V2.94815Z"}),b.jsx("path",{d:"M115.991 2.94815H117.991V0.948151H115.991V2.94815Z"})]}),AS=({className:n})=>b.jsx("svg",{className:n,width:"120",height:"4",viewBox:"0 0 120 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:b.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 3.86215H-0.0090332V0.862152H119.991V3.86215Z"})}),DS=({className:n})=>b.jsx("svg",{className:n,width:"120",height:"2",viewBox:"0 0 120 2",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:b.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M119.991 1.15668H-0.0090332V0.156677H119.991V1.15668Z"})});function Ca(n){const{type:o=a.BorderStyleTypes.THIN,className:e}=n;switch(o){case a.BorderStyleTypes.DASH_DOT:return b.jsx(RS,{className:e});case a.BorderStyleTypes.DASH_DOT_DOT:return b.jsx(wS,{className:e});case a.BorderStyleTypes.DASHED:return b.jsx(ES,{className:e});case a.BorderStyleTypes.HAIR:return b.jsx(yS,{className:e});case a.BorderStyleTypes.MEDIUM:return b.jsx(MS,{className:e});case a.BorderStyleTypes.MEDIUM_DASH_DOT:return b.jsx(PS,{className:e});case a.BorderStyleTypes.MEDIUM_DASH_DOT_DOT:return b.jsx(xS,{className:e});case a.BorderStyleTypes.MEDIUM_DASHED:return b.jsx(OS,{className:e});case a.BorderStyleTypes.THICK:return b.jsx(AS,{className:e});case a.BorderStyleTypes.DOUBLE:return b.jsx(TS,{className:e});case a.BorderStyleTypes.THIN:default:return b.jsx(DS,{className:e})}}const NS=[{label:a.BorderStyleTypes.THIN,value:a.BorderStyleTypes.THIN},{label:a.BorderStyleTypes.HAIR,value:a.BorderStyleTypes.HAIR},{label:a.BorderStyleTypes.DOTTED,value:a.BorderStyleTypes.DOTTED},{label:a.BorderStyleTypes.DASHED,value:a.BorderStyleTypes.DASHED},{label:a.BorderStyleTypes.DASH_DOT,value:a.BorderStyleTypes.DASH_DOT},{label:a.BorderStyleTypes.DASH_DOT_DOT,value:a.BorderStyleTypes.DASH_DOT_DOT},{label:a.BorderStyleTypes.MEDIUM,value:a.BorderStyleTypes.MEDIUM},{label:a.BorderStyleTypes.MEDIUM_DASHED,value:a.BorderStyleTypes.MEDIUM_DASHED},{label:a.BorderStyleTypes.MEDIUM_DASH_DOT,value:a.BorderStyleTypes.MEDIUM_DASH_DOT},{label:a.BorderStyleTypes.MEDIUM_DASH_DOT_DOT,value:a.BorderStyleTypes.MEDIUM_DASH_DOT_DOT},{label:a.BorderStyleTypes.THICK,value:a.BorderStyleTypes.THICK},{label:a.BorderStyleTypes.DOUBLE,value:a.BorderStyleTypes.DOUBLE}];function kS(n){var o;if(n)for(const e in n){const t=n[e];if((o=t==null?void 0:t.cl)!=null&&o.rgb)return t.cl.rgb}}function HS(n){var o;if(n)for(const e in n){const t=n[e];if((o=t==null?void 0:t.cl)!=null&&o.rgb)return t.s}}function nc(n){var g;const o=I.useDependency(I.ComponentManager),e=I.useDependency(m.BorderStyleManagerService),t=I.useDependency(m.SheetsSelectionsService),{isAllValuesSame:r,value:i}=t.getCellStylesProperty("bd"),s=r?kS(i):void 0,l=r?HS(i):void 0,{onChange:c,value:d}=n;function u(S,p){c==null||c({...d,[p]:S})}function h(S){const p=o.get(S);return p&&b.jsx(p,{className:"univer-fill-primary-600"})}return b.jsxs("section",{className:"univer-box-border univer-grid univer-gap-2 univer-p-1.5",children:[b.jsx("div",{className:"univer-box-border univer-grid univer-grid-cols-5 univer-gap-2 univer-text-gray-600 dark:!univer-text-gray-200",children:Bl.map(S=>b.jsx("a",{className:F.clsx("univer-flex univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-justify-self-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",{"univer-bg-gray-200 dark:!univer-bg-gray-600":e.getBorderInfo().type===S.value}),onClick:p=>{p.stopPropagation(),u(S.value,"type")},children:h(S.icon)},S.value))}),b.jsx(F.Separator,{}),b.jsxs("div",{className:"univer-flex univer-items-center univer-gap-2",children:[b.jsx("div",{children:b.jsx(F.Dropdown,{overlay:b.jsx("div",{className:"univer-rounded-lg univer-p-4",children:b.jsx(F.ColorPicker,{value:s,onChange:S=>u(S,"color")})}),children:b.jsxs("button",{className:"univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",type:"button",children:[b.jsx(gl,{className:"univer-fill-primary-600 dark:!univer-text-white",extend:{colorChannel1:(g=d==null?void 0:d.color)!=null?g:""}}),b.jsx(_n,{className:"dark:!univer-text-white"})]})})}),b.jsx("div",{children:b.jsx(F.Dropdown,{overlay:b.jsx("section",{className:"univer-rounded-lg univer-p-1.5",children:b.jsx("ul",{className:"univer-m-0 univer-grid univer-list-none univer-gap-1 univer-p-0",children:NS.map(S=>b.jsxs("li",{className:"univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-px-1 univer-py-3 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",onClick:()=>u(S.value,"style"),children:[S.value===l&&b.jsx(Yt,{className:"univer-absolute univer-left-3 univer-text-primary-600"}),b.jsx(Ca,{className:"univer-ml-6 univer-fill-gray-900 dark:!univer-fill-white",type:S.value})]},S.value))})}),children:b.jsxs("button",{className:"univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",type:"button",children:[b.jsx(Ca,{className:"univer-fill-gray-900 dark:!univer-fill-white",type:l!=null?l:a.BorderStyleTypes.THIN}),b.jsx(_n,{className:"dark:!univer-text-white"})]})})})]})]})}const _s="sheets.component.cell-popup";var VS=Object.getOwnPropertyDescriptor,WS=(n,o,e,t)=>{for(var r=t>1?void 0:t?VS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Et=(n,o)=>(e,t)=>o(e,t,n);exports.SheetCanvasPopManagerService=class extends a.Disposable{constructor(e,t,r,i,s,l,c){super();E(this,"_popupMenuFeatureMap",new Map);E(this,"_isSelectionMoving",!1);this._globalPopupManagerService=e,this._renderManagerService=t,this._univerInstanceService=r,this._refRangeService=i,this._commandService=s,this._refSelectionsService=l,this._selectionManagerService=c,this._initMoving()}_initMoving(){this.disposeWithMe(this._refSelectionsService.selectionMoving$.subscribe(()=>{this._isSelectionMoving=!0})),this.disposeWithMe(this._refSelectionsService.selectionMoveEnd$.subscribe(()=>{this._isSelectionMoving=!1})),this.disposeWithMe(this._selectionManagerService.selectionMoving$.subscribe(()=>{this._isSelectionMoving=!0})),this.disposeWithMe(this._selectionManagerService.selectionMoveEnd$.subscribe(()=>{this._isSelectionMoving=!1}))}registerFeatureMenu(e,t){this._popupMenuFeatureMap.set(e,t)}getFeatureMenu(e,t,r,i){const s=this._popupMenuFeatureMap.get(i);if(s)return s(e,t,r,i)}dispose(){super.dispose(),this._popupMenuFeatureMap.clear()}_createHiddenRectObserver(e){const{row:t,column:r,worksheet:i,skeleton:s,currentRender:l}=e,c=()=>{var z,X;const g=i.getFreeze(),{startRow:S,startColumn:p,xSplit:f,ySplit:v}=g,C=S-v,_=p-f,{rowHeightAccumulation:R,columnWidthAccumulation:w,rowHeaderWidth:P,columnHeaderHeight:y}=s,M=P+(_===-1?0:w[_+f-1]-((z=w[_-1])!=null?z:0)),x=y+(C===-1?0:R[C+v-1]-((X=R[C])!=null?X:0)),A=l.engine.getCanvasElement(),D=A.getBoundingClientRect(),N=Si(A.style.width),V=D.width/N,H=l.scene.getAncestorScale().scaleX,k=M*V*H,U=x*V*H,L={left:-1/0,top:-1/0,right:D.left+k,bottom:D.top+U},j={left:D.left+k,top:-1/0,right:1/0,bottom:D.top+U},B={left:-1/0,top:D.top+U,right:D.left+k,bottom:1/0};return t<S&&r<p?[]:t<S?[L]:r<p?[L]:[L,j,B]},d=c(),u=new O.BehaviorSubject(d),h=new a.DisposableCollection;return h.add(this._commandService.onCommandExecuted(g=>{g.id===m.SetFrozenMutation.id&&u.next(c())})),h.add(a.fromEventSubject(l.engine.onTransformChange$).pipe(O.throttleTime(16)).subscribe(()=>{u.next(c())})),{rects$:u,disposable:h}}_createPositionObserver(e,t,r,i){const s=()=>{const{scene:u}=t,h=oh(e,u,r,i),g=t.engine.getCanvasElement(),S=g.getBoundingClientRect(),p=Si(g.style.width),f=S.width/p;return{left:h.left*f+S.left,right:h.right*f+S.left,top:h.top*f+S.top,bottom:h.bottom*f+S.top}},l=s(),c=new O.BehaviorSubject(l),d=new a.DisposableCollection;return d.add(this._commandService.onCommandExecuted(u=>{(u.id===We.id||u.id===De.id)&&c.next(s())})),{position:l,position$:c,disposable:d}}attachPopupToObject(e,t){var R;const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),i=r.getActiveSheet();if(!i||this._isSelectionMoving&&!t.showOnSelectionMoving)return{dispose:()=>{},canDispose:()=>!0};const s=r.getUnitId(),l=i.getSheetId(),c=(R=this._renderManagerService.getRenderById(s))==null?void 0:R.with(exports.SheetSkeletonManagerService).ensureSkeleton(l),d=this._renderManagerService.getRenderById(s);if(!d||!c)return{dispose:()=>{},canDispose:()=>!0};const{left:u,top:h,width:g,height:S}=e,p={left:u,right:u+g,top:h,bottom:h+S},{position:f,position$:v,disposable:C}=this._createPositionObserver(p,d,c,i),_=this._globalPopupManagerService.addPopup({...t,unitId:s,subUnitId:l,anchorRect:f,anchorRect$:v,canvasElement:d.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(_),v.complete(),C.dispose()},canDispose:()=>this._globalPopupManagerService.activePopupId!==_}}attachPopupByPosition(e,t,r){var C;let i=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),s=i.getActiveSheet();if(!s)return null;const l=i.getUnitId(),c=s.getSheetId();if(l!==r.unitId||r.subUnitId!==c)return null;if(this._isSelectionMoving&&!t.showOnSelectionMoving)return;const d=(C=this._renderManagerService.getRenderById(l))==null?void 0:C.with(exports.SheetSkeletonManagerService).getOrCreateSkeleton({sheetId:c}),u=this._renderManagerService.getRenderById(l);if(!u||!d)return null;const{position:h,position$:g,disposable:S}=this._createPositionObserver(e,u,d,s),{rects$:p,disposable:f}=this._createHiddenRectObserver({row:r.row,column:r.col,worksheet:s,skeleton:d,currentRender:u}),v=this._globalPopupManagerService.addPopup({...t,unitId:l,subUnitId:c,anchorRect:h,anchorRect$:g,hiddenRects$:p,canvasElement:u.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(v),g.complete(),S.dispose(),f.dispose(),i=null,s=null},canDispose:()=>this._globalPopupManagerService.activePopupId!==v}}attachPopupToAbsolutePosition(e,t,r,i){var p;const s=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),l=s.getActiveSheet();if(!l)return null;const c=s.getUnitId(),d=l.getSheetId();if(r&&c!==r||i&&i!==d)return null;const u=(p=this._renderManagerService.getRenderById(c))==null?void 0:p.with(exports.SheetSkeletonManagerService).ensureSkeleton(d),h=this._renderManagerService.getRenderById(c);if(!h||!u)return null;if(this._isSelectionMoving&&!t.showOnSelectionMoving)return;const g=new O.BehaviorSubject(e),S=this._globalPopupManagerService.addPopup({...t,unitId:c,subUnitId:d,anchorRect:e,anchorRect$:g.asObservable(),canvasElement:h.engine.getCanvasElement()});return{dispose:()=>{this._globalPopupManagerService.removePopup(S),g.complete()},canDispose:()=>this._globalPopupManagerService.activePopupId!==S}}attachPopupToCell(e,t,r,i,s,l){let c=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),d=c.getActiveSheet();if(!d)return null;const u=c.getUnitId(),h=d.getSheetId();if(i&&u!==i||s&&h!==s)return null;const g=this._renderManagerService.getRenderById(u),S=g==null?void 0:g.with(exports.SheetSkeletonManagerService).ensureSkeleton(h),p=g==null?void 0:g.with(Ce);if(!g||!S||!p)return null;if(this._isSelectionMoving&&!r.showOnSelectionMoving)return;const f=l!=null?l:qs(e,t,g.scene,d);if(!f)return null;const{position:v,position$:C,disposable:_,updateRowCol:R}=this._createCellPositionObserver(e,t,g,S,f),{rects$:w,disposable:P}=this._createHiddenRectObserver({row:e,column:t,worksheet:d,skeleton:S,currentRender:g}),y=this._globalPopupManagerService.addPopup({...r,unitId:u,subUnitId:h,anchorRect:v,anchorRect$:C,canvasElement:g.engine.getCanvasElement(),hiddenRects$:w}),M=new a.DisposableCollection;M.add(_),M.add(a.toDisposable(()=>{this._globalPopupManagerService.removePopup(y),C.complete()})),M.add(P);const x={startRow:e,endRow:e,startColumn:t,endColumn:t};return M.add(this._refRangeService.watchRange(u,h,x,(A,D)=>{D?R(D.startRow,D.startColumn):M.dispose()})),{dispose(){M.dispose(),d=null,c=null},canDispose:()=>this._globalPopupManagerService.activePopupId!==y}}attachRangePopup(e,t,r,i,s,l=!1){const c=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),d=c.getActiveSheet();if(!d)return null;const u=c.getUnitId(),h=d.getSheetId();if(r&&u!==r||i&&h!==i)return null;const g=this._renderManagerService.getRenderById(u),S=g==null?void 0:g.with(exports.SheetSkeletonManagerService).getOrCreateSkeleton({sheetId:h}),p=g==null?void 0:g.with(Ce);if(!g||!S||!p)return null;if(p.selectionMoving&&!l)return;const f=s!=null?s:qs(e.startRow,e.startColumn,g.scene,d);if(!f)return null;const{position:v,position$:C,disposable:_,updateRange:R,topLeftPos$:w,rightBottomPos$:P}=this._createRangePositionObserver(e,g,S,f),{rects$:y,disposable:M}=this._createHiddenRectObserver({row:e.startRow,column:e.startColumn,worksheet:d,skeleton:S,currentRender:g}),x=this._globalPopupManagerService.addPopup({...t,unitId:u,subUnitId:h,anchorRect:v,anchorRect$:C,canvasElement:g.engine.getCanvasElement(),hiddenRects$:y}),A=new a.DisposableCollection;A.add(_),A.add(a.toDisposable(()=>{this._globalPopupManagerService.removePopup(x),w.complete(),P.complete()})),A.add(M);const D={...e};return A.add(this._refRangeService.watchRange(u,h,D,(N,V)=>{V?R(V):A.dispose()})),{dispose(){A.dispose()},canDispose:()=>this._globalPopupManagerService.activePopupId!==x}}_createCellPositionObserver(e,t,r,i,s){let l=e,c=t;const d=this._calcCellPositionByCell(l,c,r,i,s),u=new O.BehaviorSubject(d),h=()=>u.next(this._calcCellPositionByCell(l,c,r,i,s)),g=new a.DisposableCollection;return g.add(r.engine.clientRect$.subscribe(()=>h())),g.add(a.fromEventSubject(r.engine.onTransformChange$).pipe(O.throttleTime(16)).subscribe(()=>h())),g.add(this._commandService.onCommandExecuted(p=>{if(p.id===m.SetWorksheetRowAutoHeightMutation.id&&p.params.rowsAutoHeightInfo.findIndex(v=>v.row===l)>-1){h();return}(m.COMMAND_LISTENER_SKELETON_CHANGE.indexOf(p.id)>-1||p.id===We.id||p.id===De.id)&&h()})),{position$:u,disposable:g,position:d,updateRowCol:(p,f)=>{l=p,c=f,h()}}}_calcCellPositionByCell(e,t,r,i,s){const{scene:l,engine:c}=r;if(i._disposed||l._disposed)return{left:0,right:0,top:0,bottom:0};const d=i.getCellWithCoordByIndex(e,t),u=d.isMergedMainCell?d.mergeInfo:d,{scaleX:h,scaleY:g}=l.getAncestorScale(),S={x:s.viewportScrollX,y:s.viewportScrollY},p=c.getCanvasElement();if(!p)return{left:0,right:0,top:0,bottom:0};const f=p.getBoundingClientRect(),v=Si(p.style.width),{top:C,left:_,width:R}=f,w=R/v;return{left:(u.startX-S.x)*w*h+_,right:(u.endX-S.x)*w*h+_,top:(u.startY-S.y)*w*g+C,bottom:(u.endY-S.y)*w*g+C}}_createRangePositionObserver(e,t,r,i){let{startRow:s,startColumn:l,endRow:c,endColumn:d}=e;const u=this._calcCellPositionByCell(s,l,t,r,i),h=new O.BehaviorSubject(u),g=this._calcCellPositionByCell(c,d,t,r,i),S=new O.BehaviorSubject(g),p=()=>{const R=this._calcCellPositionByCell(s,l,t,r,i),w=this._calcCellPositionByCell(c,d,t,r,i);h.next(R),S.next(w)},f=new a.DisposableCollection;f.add(t.engine.clientRect$.subscribe(()=>p())),f.add(this._commandService.onCommandExecuted(R=>{if(R.id===m.SetWorksheetRowAutoHeightMutation.id&&R.params.rowsAutoHeightInfo.findIndex(P=>P.row===s)>-1){p();return}(m.COMMAND_LISTENER_SKELETON_CHANGE.indexOf(R.id)>-1||R.id===We.id||R.id===De.id)&&p()}));const v=R=>{s=R.startRow,l=R.startColumn,c=R.endRow,d=R.endColumn,p()},C=h.pipe(O.map(R=>{const w=this._calcCellPositionByCell(c,d,t,r,i);return{top:R.top,left:R.left,right:w.right,bottom:w.bottom}})),_={top:u.top,left:u.left,right:g.right,bottom:g.bottom};return{position$:C,position:_,updateRange:v,topLeftPos$:h,rightBottomPos$:S,disposable:f}}};exports.SheetCanvasPopManagerService=WS([Et(0,a.Inject(I.ICanvasPopupService)),Et(1,T.IRenderManagerService),Et(2,a.IUniverInstanceService),Et(3,a.Inject(m.RefRangeService)),Et(4,a.ICommandService),Et(5,m.IRefSelectionsService),Et(6,a.Inject(m.SheetsSelectionsService))],exports.SheetCanvasPopManagerService);function Si(n){return Number.parseInt(n.replace("px",""))}var US=Object.getOwnPropertyDescriptor,LS=(n,o,e,t)=>{for(var r=t>1?void 0:t?US(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},BS=(n,o)=>(e,t)=>o(e,t,n);exports.CellPopupManagerService=class extends a.Disposable{constructor(e){super();E(this,"_cellPopupMap",new Map);E(this,"_change$",new O.Subject);E(this,"change$",this._change$.asObservable());this._sheetCanvasPopManagerService=e}_ensureCellPopupMap(e,t){let r=this._cellPopupMap.get(e);r||(r=new Map,this._cellPopupMap.set(e,r));let i=r.get(t);return i||(i=new a.ObjectMatrix,r.set(t,i)),i}showPopup(e,t){var g,S;const{direction:r="horizontal"}=t,{unitId:i,subUnitId:s,row:l,col:c}=e,d=this._ensureCellPopupMap(i,s),u=(g=d.getValue(l,c))==null?void 0:g[r];t.id=(S=t.id)!=null?S:a.generateRandomId();const h=()=>{var C;const p=d.getValue(l,c);if(!p)return;const f=p[r];if(!f)return;const v=f==null?void 0:f.popups.findIndex(_=>_.id===t.id&&_.componentKey===t.componentKey);f==null||f.popups.splice(v,1),f.popups.length===0&&((C=f.disposable)==null||C.dispose(),p[r]=void 0),this._change$.next({...e,direction:r})};if(u)u.popups.push(t),u.popups.sort((p,f)=>p.priority-f.priority);else{const p=this._sheetCanvasPopManagerService.attachPopupToCell(l,c,{...t,direction:r,componentKey:_s,extraProps:{...e,direction:r},noPushMinimumGap:!0,autoRelayout:!1,zIndex:90},i,s);d.setValue(l,c,{...d.getValue(l,c),[r]:{disposable:p,popups:[t]}})}return this._change$.next({...e,direction:r}),a.toDisposable(h)}getPopups(e,t,r,i,s){var c,d;return((d=(c=this._ensureCellPopupMap(e,t).getValue(r,i))==null?void 0:c[s])==null?void 0:d.popups)||[]}};exports.CellPopupManagerService=LS([BS(0,a.Inject(exports.SheetCanvasPopManagerService))],exports.CellPopupManagerService);const rc=n=>{const{popup:o}=n,e=o.extraProps,{row:t,col:r,direction:i,unitId:s,subUnitId:l}=e,c=I.useDependency(exports.CellPopupManagerService);I.useObservable(W.useMemo(()=>c.change$.pipe(O.filter(h=>h.row===t&&h.col===r&&h.direction===i)),[c,t,r,i]));const d=c.getPopups(s,l,t,r,i),u=I.useDependency(I.ComponentManager);return b.jsx("div",{"data-u-comp":"cell-popup",className:"univer-ml-px univer-flex univer-flex-col",children:d.map(h=>{var S;const g=u.get(h.componentKey);return g?b.jsx(g,{popup:h},(S=h.id)!=null?S:h.componentKey):null})})},Ia=n=>{const{inputId:o,state:e=!1,type:t="range",confirm:r,cancel:i,name:s,formulaOrRefString:l,comment:c="",localSheetId:d=m.SCOPE_WORKBOOK_VALUE_DEFINED_NAME,hidden:u=!1,id:h}=n,S=I.useDependency(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),p=I.useDependency(a.LocaleService),f=I.useDependency(G.IDefinedNamesService),v=I.useDependency(G.IFunctionService),C=I.useDependency(G.LexerTreeBuilder),_=I.useDependency(I.ComponentManager),R=W.useMemo(()=>_.get(ji),[]),w=W.useMemo(()=>_.get(yo),[]);if(S==null)return;const P=W.useMemo(()=>S.getUnitId(),[]),y=W.useMemo(()=>S.getActiveSheet().getSheetId(),[]),[M,x]=W.useState(s),[A,D]=W.useState(l),[N,V]=W.useState(c),[H,k]=W.useState(d),[U,L]=W.useState(""),[j,B]=W.useState(t),[z,X]=W.useState(!0),K=[{label:p.t("definedName.scopeWorkbook"),value:m.SCOPE_WORKBOOK_VALUE_DEFINED_NAME}],ie=ne=>!G.isReferenceStrings(ne);W.useEffect(()=>{X(!0),x(s),V(c),k(d);let ne=l;l.substring(0,1)===G.operatorToken.EQUALS?B("formula"):ie(l)?(B("formula"),ne=G.operatorToken.EQUALS+l):B("range"),D(ne),L("")},[e]),S.getSheetOrders().forEach(ne=>{const oe=S.getSheetBySheetId(ne);K.push({label:(oe==null?void 0:oe.getName())||"",value:ne})});const re=ne=>{D(ne)},le=ne=>{D(ne||"")},Z=()=>{if(M.length===0){L(p.t("definedName.nameEmpty"));return}if(f.getValueByName(P,M)!=null&&(h==null||h.length===0)){L(p.t("definedName.nameDuplicate"));return}if(!a.Tools.isValidParameter(M)||G.isReferenceStringWithEffectiveColumn(M)||!a.Tools.isStartValidPosition(M)&&!T.hasCJKText(M.substring(0,1))){L(p.t("definedName.nameInvalid"));return}if(S.getSheetOrders().map($=>{var me;return((me=S.getSheetBySheetId($))==null?void 0:me.getName())||""}).includes(M)){L(p.t("definedName.nameSheetConflict"));return}if(A.length===0){L(p.t("definedName.formulaOrRefStringEmpty"));return}if(!z){L(p.t("definedName.formulaOrRefStringInvalid"));return}if(v.hasExecutor(M.toUpperCase())){L(p.t("definedName.nameConflict"));return}const oe=S.getActiveSheet().getName();r&&r({id:h||"",name:M,formulaOrRefString:C.convertRefersToAbsolute(A,a.AbsoluteRefType.ALL,a.AbsoluteRefType.ALL,oe),comment:N,localSheetId:H})},Y=ne=>{const oe=ne;oe==="formula"?l[0]===G.operatorToken.EQUALS?D(l):D(`${G.operatorToken.EQUALS}`):l[0]===G.operatorToken.EQUALS?D(""):D(l),B(oe)},q=W.useRef(null),[te,ce]=W.useState(!1);return I.useSidebarClick(ne=>{var $;(($=q.current)==null?void 0:$.isClickOutSide(ne))&&ce(!1)}),b.jsxs("div",{className:F.clsx("univer-grid univer-space-y-2 univer-pb-1",F.borderBottomClassName,{"univer-hidden":!e}),children:[b.jsx("div",{children:b.jsx(F.Input,{className:"univer-w-full",placeholder:p.t("definedName.inputNamePlaceholder"),value:M,allowClear:!0,onChange:x})}),b.jsx("div",{children:b.jsxs(F.RadioGroup,{value:j,onChange:Y,children:[b.jsx(F.Radio,{value:"range",children:p.t("definedName.ratioRange")}),b.jsx(F.Radio,{value:"formula",children:p.t("definedName.ratioFormula")})]})}),j==="range"?R&&b.jsx(R,{unitId:P,subUnitId:y,initialValue:A,onChange:(ne,oe)=>re(oe),supportAcrossSheet:!0}):w&&b.jsx("div",{className:"univer-relative univer-mt-4 univer-h-full",children:b.jsx("div",{className:"univer-relative univer-h-8 univer-select-none",children:b.jsx(w,{ref:q,className:F.clsx("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent",F.borderClassName),initValue:A,unitId:P,subUnitId:y,isFocus:te,isSupportAcrossSheet:!0,onChange:(ne="")=>{le(ne||"")},onVerify:ne=>{X(ne)},onFocus:()=>ce(!0)})})}),b.jsx("div",{children:b.jsx(F.Select,{className:"univer-w-full",value:H,options:K,onChange:k})}),b.jsx("div",{children:b.jsx(F.Input,{className:"univer-w-full",placeholder:p.t("definedName.inputCommentPlaceholder"),value:N,onChange:V,allowClear:!0})}),b.jsxs("div",{className:F.clsx("univer-items-center univer-gap-1 univer-text-sm univer-text-red-500",{"univer-hidden":U.length===0,"univer-flex":U.length!==0}),children:[b.jsx("span",{children:U}),b.jsx(ls,{})]}),b.jsxs("div",{className:"univer-flex univer-gap-2",children:[b.jsx(F.Button,{onClick:()=>{i==null||i()},children:p.t("definedName.cancel")}),b.jsx(F.Button,{variant:"primary",onClick:Z,children:p.t("definedName.confirm")})]})]})},oc=()=>{const n=I.useDependency(a.ICommandService),e=I.useDependency(a.IUniverInstanceService).getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET),t=I.useDependency(a.LocaleService),r=I.useDependency(G.IDefinedNamesService),i=I.useDependency(m.SheetsSelectionsService);if(e==null)return;const s=e.getUnitId(),l=()=>{const N=r.getDefinedNameMap(s);return N?Array.from(Object.values(N)):[]},[c,d]=W.useState(!1),[u,h]=W.useState(l()),[g,S]=W.useState(null),[p,f]=W.useState();W.useEffect(()=>{const N=r.update$.subscribe(()=>{h(l())});return()=>{N.unsubscribe()}},[]);const v=N=>{const{name:V,formulaOrRefString:H,comment:k,localSheetId:U,hidden:L}=N;let j=N.id;if(j==null||j.length===0)j=a.generateRandomId(10),n.executeCommand(m.InsertDefinedNameCommand.id,{id:j,unitId:s,name:V,formulaOrRefString:H,comment:k,localSheetId:U,hidden:L});else{const B={id:j,unitId:s,name:V,formulaOrRefString:H,comment:k,localSheetId:U,hidden:L};n.executeCommand(m.SetDefinedNameCommand.id,B)}d(!1),S(null)},C=N=>{f(N)};function _(){f(null)}function R(N){const V=r.getValueById(s,N);n.executeCommand(m.RemoveDefinedNameCommand.id,{...V,unitId:s}),f(null)}const w=async N=>{const{formulaOrRefString:V,id:H}=N,k=r.getWorksheetByRef(s,V);if(!k)return;k.isSheetHidden()&&await n.executeCommand(m.SetWorksheetShowCommand.id,{unitId:s,subUnitId:k.getSheetId()}),r.focusRange(s,H)},P=()=>{const N=u.length+1,V=t.t("definedName.defaultName")+N;if(r.getValueByName(s,V)==null)return V;let H=N+1;for(;;){const k=t.t("definedName.defaultName")+H;if(r.getValueByName(s,k)==null)return k;H++}},y=()=>{var k;const N=(k=e.getActiveSheet())==null?void 0:k.getName();if(!N)return"";const V=i.getCurrentSelections();return V==null?"":V.map(U=>G.serializeRangeWithSheet(N,U.range)).join(",")},M=()=>{d(!1),S(null)},x=()=>{d(!0),S(null)},A=N=>{d(!1),S(N)},D=N=>{const V=e.getSheetBySheetId(N);return V==null?"":V.getName()};return b.jsx("div",{"data-u-comp":"defined-name-container",className:"univer-relative univer-box-border univer-w-full",children:b.jsxs("div",{className:F.clsx("univer-w-full univer-overflow-hidden univer-overflow-y-auto",F.scrollbarClassName),children:[b.jsxs("div",{className:"univer-mb-4",children:[b.jsxs(F.Button,{className:F.clsx("univer-w-full",{"univer-hidden":c}),onClick:x,children:[b.jsx(cs,{}),b.jsx("span",{className:"univer-ml-1",children:t.t("definedName.addButton")})]}),c&&b.jsx(Ia,{confirm:v,cancel:M,state:c,inputId:"insertDefinedName",name:P(),formulaOrRefString:y()})]},"insertDefinedName"),u.map((N,V)=>b.jsxs("div",{className:"univer-relative univer-w-full univer-divide-x-0 univer-divide-y univer-divide-solid univer-divide-gray-200 dark:!univer-divide-gray-600",children:[b.jsxs("div",{className:F.clsx("univer-group univer-relative univer-flex univer-w-full univer-cursor-default univer-select-none univer-items-center univer-justify-between univer-rounded-md univer-p-2 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",{"univer-hidden":N.id===g}),onClick:()=>{w(N)},children:[b.jsxs("div",{title:N.comment,children:[b.jsxs("div",{className:"univer-my-1 univer-max-h-[100px] univer-max-w-[190px] univer-truncate univer-text-sm univer-font-medium univer-text-gray-900 dark:!univer-text-white",children:[N.name,b.jsx("span",{className:"univer-text-xxs univer-ml-1 univer-text-gray-400",children:N.localSheetId===m.SCOPE_WORKBOOK_VALUE_DEFINED_NAME||N.localSheetId==null?"":D(N.localSheetId)})]}),b.jsx("div",{className:"univer-my-1 univer-max-h-[100px] univer-w-full univer-max-w-[190px] univer-truncate univer-text-xs univer-text-gray-500",title:N.formulaOrRefString,children:N.formulaOrRefString})]}),b.jsxs("div",{className:"univer-absolute univer-right-5 univer-top-1/2 univer-hidden -univer-translate-y-1/2 univer-cursor-pointer univer-items-center univer-justify-end univer-gap-7 univer-text-xs univer-text-primary-600 group-hover:univer-flex dark:hover:!univer-bg-gray-600",children:[b.jsx(F.Tooltip,{title:t.t("definedName.updateButton"),placement:"top",children:b.jsx("a",{className:"univer-rounded univer-p-1 hover:univer-bg-gray-100",onClick:H=>{H.stopPropagation(),A(N.id)},children:b.jsx(dl,{})})}),b.jsx(F.Tooltip,{title:t.t("definedName.deleteButton"),placement:"top",children:b.jsx("a",{className:"univer-rounded univer-p-1 univer-text-red-600 hover:univer-bg-gray-100",onClick:H=>{H.stopPropagation(),C(N.id)},children:b.jsx(Vo,{})})})]})]}),b.jsx(F.Confirm,{visible:p===N.id,onClose:_,onConfirm:()=>{R(N.id)},children:t.t("definedName.deleteConfirmText")}),N.id===g&&b.jsx(Ia,{confirm:v,cancel:M,state:N.id===g,id:N.id,inputId:N.id+V,name:N.name,formulaOrRefString:N.formulaOrRefString,comment:N.comment,localSheetId:N.localSheetId})]},V))]})})},ic={id:m.SetRowHiddenCommand.id,preconditions:n=>se(n),binding:I.KeyCode.Digit9|I.MetaKeys.CTRL_COMMAND},sc={id:m.SetColHiddenCommand.id,preconditions:n=>se(n),binding:I.KeyCode.Digit0|I.MetaKeys.CTRL_COMMAND|I.MetaKeys.SHIFT},ac={id:Me.id,description:"shortcut.sheet.select-below-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_DOWN,priority:100,preconditions:se,staticParameters:{direction:a.Direction.DOWN}},lc={id:Me.id,description:"shortcut.sheet.select-up-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_UP,priority:100,preconditions:se,staticParameters:{direction:a.Direction.UP}},cc={id:Me.id,description:"shortcut.sheet.select-left-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_LEFT,priority:100,preconditions:Wa,staticParameters:{direction:a.Direction.LEFT}},dc={id:Me.id,description:"shortcut.sheet.select-right-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_RIGHT,priority:100,preconditions:Wa,staticParameters:{direction:a.Direction.RIGHT}},uc={id:Ze.id,description:"shortcut.sheet.select-next-cell",group:"3_sheet-view",binding:I.KeyCode.TAB,priority:100,preconditions:se,staticParameters:{direction:a.Direction.RIGHT,keycode:I.KeyCode.TAB}},hc={id:Ze.id,description:"shortcut.sheet.select-previous-cell",group:"3_sheet-view",binding:I.KeyCode.TAB|I.MetaKeys.SHIFT,priority:100,preconditions:se,staticParameters:{direction:a.Direction.LEFT,keycode:I.KeyCode.TAB}},mc={id:Ze.id,description:"shortcut.sheet.select-below-cell",group:"3_sheet-view",binding:I.KeyCode.ENTER,priority:100,preconditions:se,staticParameters:{direction:a.Direction.DOWN,keycode:I.KeyCode.ENTER}},gc={id:Ze.id,description:"shortcut.sheet.select-up-cell",group:"3_sheet-view",binding:I.KeyCode.ENTER|I.MetaKeys.SHIFT,priority:100,preconditions:se,staticParameters:{direction:a.Direction.UP,keycode:I.KeyCode.ENTER}},Sc={id:Me.id,description:"shortcut.sheet.select-below-value-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_DOWN|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.DOWN,jumpOver:Ye.moveGap}},pc={id:Me.id,description:"shortcut.sheet.select-up-value-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_UP|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.UP,jumpOver:Ye.moveGap}},fc={id:Me.id,description:"shortcut.sheet.select-left-value-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_LEFT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.LEFT,jumpOver:Ye.moveGap}},vc={id:Me.id,description:"shortcut.sheet.select-right-value-cell",group:"3_sheet-view",binding:I.KeyCode.ARROW_RIGHT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.RIGHT,jumpOver:Ye.moveGap}},Cc={id:Oe.id,description:"shortcut.sheet.expand-selection-down",group:"3_sheet-view",binding:I.KeyCode.ARROW_DOWN|I.MetaKeys.SHIFT,preconditions:se,staticParameters:{direction:a.Direction.DOWN}},Ic={id:Oe.id,description:"shortcut.sheet.expand-selection-up",group:"3_sheet-view",binding:I.KeyCode.ARROW_UP|I.MetaKeys.SHIFT,preconditions:se,staticParameters:{direction:a.Direction.UP}},_c={id:Oe.id,description:"shortcut.sheet.expand-selection-left",group:"3_sheet-view",binding:I.KeyCode.ARROW_LEFT|I.MetaKeys.SHIFT,preconditions:se,staticParameters:{direction:a.Direction.LEFT}},bc={id:Oe.id,description:"shortcut.sheet.expand-selection-right",group:"3_sheet-view",binding:I.KeyCode.ARROW_RIGHT|I.MetaKeys.SHIFT,preconditions:se,staticParameters:{direction:a.Direction.RIGHT}},Rc={id:Oe.id,description:"shortcut.sheet.expand-selection-to-below-gap",group:"3_sheet-view",binding:I.KeyCode.ARROW_DOWN|I.MetaKeys.SHIFT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.DOWN,jumpOver:Ye.moveGap}},wc={id:Oe.id,description:"shortcut.sheet.expand-selection-to-up-gap",group:"3_sheet-view",binding:I.KeyCode.ARROW_UP|I.MetaKeys.SHIFT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.UP,jumpOver:Ye.moveGap}},Ec={id:Oe.id,description:"shortcut.sheet.expand-selection-to-left-gap",group:"3_sheet-view",binding:I.KeyCode.ARROW_LEFT|I.MetaKeys.SHIFT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.LEFT,jumpOver:Ye.moveGap}},Tc={id:Oe.id,description:"shortcut.sheet.expand-selection-to-right-gap",group:"3_sheet-view",binding:I.KeyCode.ARROW_RIGHT|I.MetaKeys.SHIFT|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{direction:a.Direction.RIGHT,jumpOver:Ye.moveGap}},yc={id:yr.id,description:"shortcut.sheet.select-all",group:"3_sheet-view",binding:I.KeyCode.A|I.MetaKeys.CTRL_COMMAND,preconditions:se,staticParameters:{expandToGapFirst:!0,loop:!0}},Mc={id:Bt.id,description:"shortcut.sheet.set-bold",group:"4_sheet-edit",preconditions:n=>se(n),binding:I.KeyCode.B|I.MetaKeys.CTRL_COMMAND},Pc={id:Ft.id,description:"shortcut.sheet.set-italic",group:"4_sheet-edit",preconditions:n=>se(n),binding:I.KeyCode.I|I.MetaKeys.CTRL_COMMAND},xc={id:jt.id,description:"shortcut.sheet.set-underline",group:"4_sheet-edit",preconditions:n=>se(n),binding:I.KeyCode.U|I.MetaKeys.CTRL_COMMAND},Oc={id:zt.id,description:"shortcut.sheet.set-strike-through",group:"4_sheet-edit",preconditions:n=>se(n),binding:I.KeyCode.X|I.MetaKeys.SHIFT|I.MetaKeys.CTRL_COMMAND},Ac={id:m.ClearSelectionContentCommand.id,preconditions:n=>se(n),binding:I.KeyCode.DELETE,mac:I.KeyCode.BACKSPACE},Dc={id:m.ClearSelectionContentCommand.id,preconditions:n=>se(n),mac:I.KeyCode.DELETE},Nc={id:m.ClearSelectionContentCommand.id,preconditions:n=>se(n),binding:I.MetaKeys.SHIFT+I.KeyCode.BACKSPACE},kc={id:xo.id,preconditions:n=>se(n),binding:I.MetaKeys.SHIFT+I.KeyCode.DELETE},Hc={id:Nn.id,description:"shortcut.sheet.zoom-in",binding:I.KeyCode.EQUAL|I.MetaKeys.CTRL_COMMAND,group:"3_sheet-view",preconditions:se,priority:1,staticParameters:{delta:.2}},Vc={id:a.NilCommand.id,binding:I.KeyCode.EQUAL|I.MetaKeys.CTRL_COMMAND},Wc={id:Nn.id,description:"shortcut.sheet.zoom-out",binding:I.KeyCode.MINUS|I.MetaKeys.CTRL_COMMAND,group:"3_sheet-view",preconditions:se,priority:1,staticParameters:{delta:-.2}},Uc={id:a.NilCommand.id,binding:I.KeyCode.MINUS|I.MetaKeys.CTRL_COMMAND},Lc={id:Nn.id,description:"shortcut.sheet.reset-zoom",binding:I.KeyCode.Digit0|I.MetaKeys.CTRL_COMMAND,preconditions:se,group:"3_sheet-view",priority:1,staticParameters:{reset:!0}},Bc={id:a.NilCommand.id,binding:I.KeyCode.Digit0|I.MetaKeys.CTRL_COMMAND};var FS=Object.getOwnPropertyDescriptor,jS=(n,o,e,t)=>{for(var r=t>1?void 0:t?FS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},st=(n,o)=>(e,t)=>o(e,t,n);exports.SheetUIController=class extends a.Disposable{constructor(o,e,t,r,i,s,l,c){super(),this._injector=o,this._componentManager=e,this._layoutService=t,this._commandService=r,this._shortcutService=i,this._menuManagerService=s,this._uiPartsService=l,this._configService=c,this._init()}_init(){this._initComponents(),this._initCommands(),this._initMenus(),this._initShortcuts(),this._initWorkbenchParts(),this._initFocusHandler()}_initComponents(){const o=this._componentManager;this.disposeWithMe(o.register(Ge,Yl)),this.disposeWithMe(o.register(fs,nc)),this.disposeWithMe(o.register(sr,oc)),this.disposeWithMe(o.register(_s,rc)),this.disposeWithMe(o.register("HideGridlinesDoubleIcon",hs))}_initCommands(){[vs,Ct,Is,Cs,Nn,Oe,Me,Ze,Ar,br,fn,vn,mr,gr,Ue,rs,yr,No,m.SetBoldCommand,Wt,Se,Or,Bt,Ft,jt,zt,es,ts,Sr,pr,pn,Ao,m.SetItalicCommand,m.SetStrikeThroughCommand,m.SetFontFamilyCommand,m.SetFontSizeCommand,Rr,Do,An,wr,We,In,rt,Er,Tr,ko,m.SetUnderlineCommand,kn,De,Mr,_r,Ht,kt,On,xn,Ho,dt,mn,je,os,vr,Mt,Pt,Cr,Ir,xr,xt,Ot,Pr,Dn,cr,dr].forEach(o=>{this.disposeWithMe(this._commandService.registerCommand(o))})}_initMenus(){this._menuManagerService.mergeMenu(ec)}_initShortcuts(){[ac,lc,cc,dc,uc,hc,mc,gc,Sc,pc,fc,vc,Cc,Ic,_c,bc,Rc,wc,Ec,Tc,yc,Hc,Wc,Lc,Bc,Vc,Uc,Mc,Pc,xc,Oc,Ac,Dc,Nc,kc,...wl(),Tl,El,yl,xl,Ol,Al,Nl,Ml,Pl,Dl,ic,sc].forEach(o=>{this.disposeWithMe(this._shortcutService.registerShortcut(o))})}_initWorkbenchParts(){const o=this._uiPartsService,e=this._injector;this.disposeWithMe(o.registerComponent(I.BuiltInUIPart.HEADER,()=>I.connectInjector(_l,e))),this.disposeWithMe(o.registerComponent(I.BuiltInUIPart.FOOTER,()=>I.connectInjector(Il,e))),this.disposeWithMe(o.registerComponent(I.BuiltInUIPart.CONTENT,()=>I.connectInjector(Ss,e)))}_initFocusHandler(){this.disposeWithMe(this._layoutService.registerFocusHandler(a.UniverInstanceType.UNIVER_SHEET,o=>{const e=this._injector.get(T.IRenderManagerService),t=this._injector.get(a.IUniverInstanceService),r=T.getCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_DOC,t,e),i=r==null?void 0:r.with(J.DocSelectionRenderService);i==null||i.focus()}))}};exports.SheetUIController=jS([st(0,a.Inject(a.Injector)),st(1,a.Inject(I.ComponentManager)),st(2,I.ILayoutService),st(3,a.ICommandService),st(4,I.IShortcutService),st(5,I.IMenuManagerService),st(6,I.IUIPartsService),st(7,a.IConfigService)],exports.SheetUIController);var zS=Object.getOwnPropertyDescriptor,XS=(n,o,e,t)=>{for(var r=t>1?void 0:t?zS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Xn=(n,o)=>(e,t)=>o(e,t,n);const YS=a.createInterceptorKey("statusBarPermissionCorrect");class ZS{constructor(){E(this,"_sum",0);E(this,"_count",0);E(this,"_countNumber",0);E(this,"_min",Number.POSITIVE_INFINITY);E(this,"_max",Number.NEGATIVE_INFINITY)}add(o,e,t){if(!a.Tools.isDefine(o==null?void 0:o.v))return;const r=o==null?void 0:o.t;let{v:i}=o;const s=c=>{this._sum+=c,this._countNumber++,this._min=Math.min(this._min,c),this._max=Math.max(this._max,c)},l=(c,d,u)=>{var S;if(!((S=c==null?void 0:c.n)!=null&&S.pattern))return;const{pattern:h}=c.n;u[h]||(u[h]=a.numfmt.getFormatInfo(h)),u[h].isDate&&s(d)};if(typeof i=="string"&&r===a.CellValueType.NUMBER){const c=Number(i);Number.isNaN(c)||(i=c)}if(typeof i=="number"&&r!==a.CellValueType.STRING)s(i);else if(r===a.CellValueType.NUMBER&&o.s){const c=e.get(o.s);l(c,i,t)}this._count++}getResults(){return{sum:this._sum,count:this._countNumber,countA:this._count,min:this._min,max:this._max}}}function GS(n){const{sum:o,count:e,countA:t,min:r,max:i}=n.getResults();return[{func:G.FUNCTION_NAMES_STATISTICAL.MAX,value:i},{func:G.FUNCTION_NAMES_STATISTICAL.MIN,value:r},{func:G.FUNCTION_NAMES_MATH.SUM,value:o},{func:G.FUNCTION_NAMES_STATISTICAL.COUNTA,value:t},{func:G.FUNCTION_NAMES_STATISTICAL.COUNT,value:e},{func:G.FUNCTION_NAMES_STATISTICAL.AVERAGE,value:o/e}]}exports.StatusBarController=class extends a.Disposable{constructor(e,t,r,i,s){super();E(this,"interceptor",new a.InterceptorManager({STATUS_BAR_PERMISSION_CORRECT:YS}));this._univerInstanceService=e,this._selectionManagerService=t,this._statusBarService=r,this._commandService=i,this._numfmtService=s,this._init()}_init(){this._registerSelectionListener()}_registerSelectionListener(){const e=a.debounce(r=>{var s;const i=(s=r[r.length-1])==null?void 0:s.primary;this._calculateSelection(r.map(l=>l.range),i)},100),t=a.debounce(r=>{var s;const i=(s=r[r.length-1])==null?void 0:s.primary;this._calculateSelection(r.map(l=>l.range),i)},500);this.disposeWithMe(a.toDisposable(this._selectionManagerService.selectionMoving$.subscribe(r=>{r&&t(r)}))),this.disposeWithMe(a.toDisposable(this._selectionManagerService.selectionMoveEnd$.subscribe(r=>{r&&e(r)}))),this.disposeWithMe(this._commandService.onCommandExecuted(r=>{if(r.id===m.SetRangeValuesMutation.id){const i=this._selectionManagerService.getCurrentSelections();i&&e(i)}}))}_clearResult(){this._statusBarService.setState(null)}getRangeStartEndInfo(e,t){return e.rangeType===a.RANGE_TYPE.ALL?{startRow:0,startColumn:0,endRow:t.getRowCount()-1,endColumn:t.getColumnCount()-1}:e.rangeType===a.RANGE_TYPE.COLUMN?{startRow:0,startColumn:e.startColumn,endRow:t.getRowCount()-1,endColumn:e.endColumn}:e.rangeType===a.RANGE_TYPE.ROW?{startRow:e.startRow,startColumn:0,endRow:e.endRow,endColumn:t.getColumnCount()-1}:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}_calculateSelection(e,t){var d;const r=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);if(!r)return this._clearResult();const i=r.getUnitId(),s=r.getActiveSheet(),l=s==null?void 0:s.getSheetId();if(!l)return this._clearResult();const c={};if(this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getSheets().forEach(u=>{const h=u.getConfig();c[u.getSheetId()]={cellData:new a.ObjectMatrix(h.cellData),rowCount:h.rowCount,columnCount:h.columnCount,rowData:h.rowData,columnData:h.columnData}}),e!=null&&e.length){const u=[];e.forEach(R=>{const{startRow:w,endRow:P}=R;let y=null;for(let M=w;M<=P;M++)s.getRowVisible(M)?y===null&&(y=M):y!==null&&(u.push({...R,startRow:y,endRow:M-1}),y=null);y!==null&&u.push({...R,startRow:y,endRow:P})});const h=a.splitIntoGrid(u),g=new ZS,S=r.getStyles(),p={};for(const R of h){const{startRow:w,startColumn:P,endColumn:y,endRow:M}=this.getRangeStartEndInfo(R,s);for(let x=w;x<=M;x++)for(let A=P;A<=y;A++){const D=s.getCellRaw(x,A);g.add(D,S,p)}}const f=GS(g);if(f.every(R=>R===void 0))return;let v=null;if(t){const{actualRow:R,actualColumn:w}=t;v=(d=this._numfmtService.getValue(i,l,R,w))==null?void 0:d.pattern}const _={values:f.filter(R=>R!==void 0),pattern:v};this._statusBarService.setState(_)}else this._clearResult()}};exports.StatusBarController=XS([Xn(0,a.IUniverInstanceService),Xn(1,a.Inject(m.SheetsSelectionsService)),Xn(2,Dr),Xn(3,a.ICommandService),Xn(4,a.Inject(m.INumfmtService))],exports.StatusBarController);const Fc=(n=[])=>{const o=I.useDependency(Lt);W.useEffect(()=>{const e=n.map(t=>o.addShape({range:t,style:{fill:"rgba(73, 184, 17, 0.05)",strokeWidth:1,stroke:"#49B811",widgets:{}},primary:{startColumn:t.startColumn,endColumn:t.endColumn,startRow:t.startRow,endRow:t.endRow,actualRow:t.startRow,actualColumn:t.startColumn,isMerged:!1,isMergedMainCell:!1}}));return()=>{e.forEach(t=>{t&&o.removeShape(t)})}},[n])};var KS=Object.getOwnPropertyDescriptor,qS=(n,o,e,t)=>{for(var r=t>1?void 0:t?KS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},_a=(n,o)=>(e,t)=>o(e,t,n);let bn=class extends a.Disposable{constructor(o,e){super();E(this,"_previousSheetIndex",-1);this._commandService=o,this._univerInstanceService=e,this.disposeWithMe(this._commandService.beforeCommandExecuted(t=>{if(t.id===m.RemoveSheetMutation.id)return this._beforeAdjustActiveSheetOnRemoveSheet(t)})),this.disposeWithMe(this._commandService.onCommandExecuted((t,r)=>{if(t.id===m.RemoveSheetMutation.id)return this._adjustActiveSheetOnRemoveSheet(t);if(t.id===m.SetWorksheetHideMutation.id&&t.params.hidden)return this._adjustActiveSheetOnHideSheet(t);if(r!=null&&r.fromCollab)return!1;if(t.id===m.InsertSheetMutation.id)return this._adjustActiveSheetOnInsertSheet(t);if(t.id===m.SetWorksheetHideMutation.id&&!t.params.hidden)return this._adjustActiveSheetOnShowSheet(t);if(t.id===m.SetSelectionsOperation.id)return this._adjustActiveSheetOnSelection(t)}))}_adjustActiveSheetOnHideSheet(o){var c;const{unitId:e,subUnitId:t}=o.params,r=this._univerInstanceService.getUniverSheetInstance(e);if(!r||((c=r.getActiveSheet())==null?void 0:c.getSheetId())!==t)return;const s=r.getActiveSheetIndex(),l=ba(r,s);this._switchToNextSheet(e,l)}_beforeAdjustActiveSheetOnRemoveSheet(o){const{unitId:e,subUnitId:t}=o.params,r=this._univerInstanceService.getUniverSheetInstance(e);if(!r)return;const i=r.getSheetBySheetId(t);i&&(this._previousSheetIndex=r.getSheetIndex(i))}_adjustActiveSheetOnRemoveSheet(o){if(this._previousSheetIndex===-1)return;const{unitId:e}=o.params,t=this._univerInstanceService.getUniverSheetInstance(e);if(!t)return;if(t.getActiveSheet().getSheetId()===o.params.subUnitId){const i=this._previousSheetIndex,s=i>=1?i-1:0,l=ba(t,s);this._switchToNextSheet(e,l)}}_adjustActiveSheetOnInsertSheet(o){const{unitId:e,sheet:t}=o.params;this._switchToNextSheet(e,t.id)}_adjustActiveSheetOnShowSheet(o){const{unitId:e,subUnitId:t}=o.params;this._switchToNextSheet(e,t)}_adjustActiveSheetOnSelection(o){var r;const{unitId:e,subUnitId:t}=o.params;t!==((r=this._univerInstanceService.getUnit(e))==null?void 0:r.getActiveSheet().getSheetId())&&this._switchToNextSheet(e,t)}_switchToNextSheet(o,e){this._commandService.executeCommand(m.SetWorksheetActiveOperation.id,{unitId:o,subUnitId:e})}};bn=qS([_a(0,a.ICommandService),_a(1,a.IUniverInstanceService)],bn);function ba(n,o){const e=n.getSheetSize();for(let t=o;t>-1;t--){const r=n.getSheetByIndex(t);if(!r.getConfig().hidden)return r.getSheetId()}for(let t=o;t<e;t++){const r=n.getSheetByIndex(t);if(!r.getConfig().hidden)return r.getSheetId()}throw new Error("[ActiveWorksheetController]: could not find the next unhidden sheet! Collaboration error perhaps.")}var QS=Object.getOwnPropertyDescriptor,JS=(n,o,e,t)=>{for(var r=t>1?void 0:t?QS(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ra=(n,o)=>(e,t)=>o(e,t,n),dn=(n=>(n[n.INFO=0]="INFO",n[n.WARNING=1]="WARNING",n[n.ERROR=2]="ERROR",n))(dn||{});exports.CellAlertManagerService=class extends a.Disposable{constructor(e,t){super();E(this,"_currentAlert$",new O.Subject);E(this,"_currentAlert",new Map);E(this,"currentAlert$",this._currentAlert$.asObservable());this._renderManagerService=e,this._cellPopupManagerService=t,this.disposeWithMe(()=>{this._currentAlert$.complete()})}get currentAlert(){return this._currentAlert}showAlert(e){var h;let t=this._currentAlert.get(e.key);t&&t.dispose.dispose(),t?t.dispose.dispose():(t={alert:e,dispose:{dispose(){}}},this._currentAlert.set(e.key,t));const{location:r}=e,{row:i,col:s,unitId:l,subUnitId:c}=r;if(!this._renderManagerService.getRenderById(l))return;const u=this._cellPopupManagerService.showPopup({unitId:l,subUnitId:c,row:i,col:s},{componentKey:jc,direction:"horizontal",extraProps:{alert:e},priority:1});u&&(t&&((h=t.dispose)==null||h.dispose()),t.dispose=u),this._currentAlert$.next(Array.from(this._currentAlert.entries()))}removeAlert(e){const t=this._currentAlert.get(e);t&&(this._currentAlert.delete(e),t==null||t.dispose.dispose(),this._currentAlert$.next(Array.from(this._currentAlert.entries())))}clearAlert(){this._currentAlert.forEach(e=>{e.dispose.dispose()}),this._currentAlert.clear(),this._currentAlert$.next(Array.from(this._currentAlert.entries()))}};exports.CellAlertManagerService=JS([Ra(0,T.IRenderManagerService),Ra(1,a.Inject(exports.CellPopupManagerService))],exports.CellAlertManagerService);function $S({popup:n}){var s;const o=(s=n.extraProps)==null?void 0:s.alert;if(!o)return null;const{type:e,title:t,message:r}=o,i={[dn.ERROR]:b.jsx(ls,{className:"univer-mr-1.5 univer-text-red-500"}),[dn.INFO]:b.jsx(cl,{className:"univer-mr-1.5 univer-text-blue-500"}),[dn.WARNING]:b.jsx(hl,{className:"univer-mr-1.5 univer-text-yellow-500"})};return b.jsxs("div",{className:"univer-z-[100] univer-box-border univer-w-[156px] univer-rounded-lg univer-bg-white univer-px-2 univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",children:[b.jsxs("div",{className:"univer-mb-1.5 univer-flex univer-h-5 univer-flex-row univer-items-center univer-text-sm univer-font-medium",children:[e?i[e]:null,t]}),b.jsx("div",{className:"univer-text-sm",children:r})]})}const jc="univer.sheet.cell-alert";var ep=Object.getOwnPropertyDescriptor,tp=(n,o,e,t)=>{for(var r=t>1?void 0:t?ep(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},np=(n,o)=>(e,t)=>o(e,t,n);let lo=class extends a.Disposable{constructor(n,o){super(),this._context=n,this._componentManager=o,this._initComponent()}_initComponent(){this.disposeWithMe(this._componentManager.register(jc,$S))}};lo=tp([np(1,a.Inject(I.ComponentManager))],lo);var rp=Object.getOwnPropertyDescriptor,op=(n,o,e,t)=>{for(var r=t>1?void 0:t?rp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Fr=(n,o)=>(e,t)=>o(e,t,n);let Rn=class extends a.Disposable{constructor(o,e,t,r){super();E(this,"_isPointer",!1);this._hoverManagerService=o,this._instanceService=e,this._commandService=t,this._renderManagerService=r,this._initPointerEvent(),this._initHover()}get _mainComponent(){var o;return(o=T.getCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,this._instanceService,this._renderManagerService))==null?void 0:o.mainComponent}_initHover(){this.disposeWithMe(this._hoverManagerService.currentRichText$.subscribe(o=>{var e,t;o!=null&&o.bullet?(this._isPointer||(e=this._mainComponent)==null||e.setCursor(T.CURSOR_TYPE.POINTER),this._isPointer=!0):(this._isPointer&&((t=this._mainComponent)==null||t.setCursor(T.CURSOR_TYPE.AUTO)),this._isPointer=!1)}))}_initPointerEvent(){this.disposeWithMe(this._hoverManagerService.currentClickedCell$.subscribe(o=>{const{location:e,bullet:t}=o;t&&this._commandService.executeCommand(m.ToggleCellCheckboxCommand.id,{unitId:e.unitId,subUnitId:e.subUnitId,row:e.row,col:e.col,paragraphIndex:t.startIndex})}))}};Rn=op([Fr(0,a.Inject(exports.HoverManagerService)),Fr(1,a.IUniverInstanceService),Fr(2,a.ICommandService),Fr(3,T.IRenderManagerService)],Rn);const wa=2,ip=[{value:"DEFAULT_PASTE",label:"rightClick.paste"},{value:"SPECIAL_PASTE_VALUE",label:"rightClick.pasteValue"},{value:"SPECIAL_PASTE_FORMAT",label:"rightClick.pasteFormat"},{value:"SPECIAL_PASTE_COL_WIDTH",label:"rightClick.pasteColWidth"},{value:"SPECIAL_PASTE_BESIDES_BORDER",label:"rightClick.pasteBesidesBorder"},{value:"SPECIAL_PASTE_FORMULA",label:"formula.operation.pasteFormula"}],sp=n=>{var N,V,H,k,U;const o=I.useDependency(a.IUniverInstanceService),e=I.useDependency(T.IRenderManagerService),t=vt();if(!n||!t)return null;const r={startRow:n.rows[0],startCol:n.cols[0],endRow:n.rows[n.rows.length-1],endCol:n.cols[n.cols.length-1]};if(r.endRow<0||r.endCol<0)return null;const i=e.getRenderById(t.getUnitId()),s=i==null?void 0:i.with(exports.SheetSkeletonManagerService),l=i==null?void 0:i.with(Ce),c=Ne(o,e);if(!c||!l)return null;const{scene:d}=c,u=s==null?void 0:s.getCurrentSkeleton(),h=l.getViewPort(),g=d==null?void 0:d.scaleX,S=d==null?void 0:d.scaleY,p=d==null?void 0:d.getViewportScrollXY(h),f=(N=d.getEngine())==null?void 0:N.getCanvas();if(!g||!d||!g||!S||!p)return null;const v=u==null?void 0:u.getNoMergeCellPositionByIndex(r.endRow,r.endCol),C=(V=v==null?void 0:v.endX)!=null?V:0,_=(H=v==null?void 0:v.endY)!=null?H:0,R=(k=T.convertTransformToOffsetX(C,g,p))!=null?k:-9999,w=(U=T.convertTransformToOffsetY(_,S,p))!=null?U:-9999,P=f==null?void 0:f.getWidth(),y=f==null?void 0:f.getHeight();if(!P||!y)return null;const M=R+50<=P,x=w+50<=y;let A=R,D=w;return M||(A=P-100),x||(D=y-100),{positionX:A,positionY:D}},ap=()=>{const n=I.useDependency(ke),o=I.useObservable(n.showMenu$,!1),e=I.useObservable(n.pasteOptionsCache$,null),t=I.useDependency(a.LocaleService),r=I.useDependency(a.ICommandService),[i,s]=W.useState(!1),[l,c]=W.useState(!1),d=e==null?void 0:e.target.pastedRange,u=sp(d);if(!u||!o||u.positionX<50||u.positionY<30)return null;const h=i||l,g=S=>{c(!1),r.executeCommand(ja.id,{type:S})};return b.jsx("div",{className:"univer-absolute univer-inset-0 univer-z-10 univer-size-0",children:b.jsx("div",{className:"univer-absolute",style:{left:u.positionX+wa,top:u.positionY+wa},onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:b.jsx(F.DropdownMenu,{align:"start",items:ip.map(S=>({type:"checkbox",value:S.value,label:t.t(S.label),checked:(e==null?void 0:e.pasteType)===ge[S.value],onSelect:()=>g(S.value)})),open:l,onOpenChange:c,children:b.jsxs("div",{className:F.clsx("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",F.borderClassName,{"univer-bg-gray-100 dark:!univer-bg-gray-800":l,"univer-bg-white dark:!univer-bg-gray-900":!l}),children:[b.jsx(Sl,{className:"univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"}),h&&b.jsx(_n,{className:"dark:!univer-text-white"})]})})})})},lp=[Se.id,m.SetRangeValuesCommand.id,De.id,m.MoveRangeMutation.id,m.RemoveRowMutation.id,m.RemoveColMutation.id,m.InsertRowMutation.id,m.InsertColMutation.id,m.MoveRowsMutation.id,m.MoveColsMutation.id,m.SetWorksheetColWidthMutation.id,m.SetWorksheetRowHeightMutation.id,m.SetSelectionsOperation.id,a.UndoCommandId];function cp(n,o,e,t,r){const i=[],s=[];if(t.copyType===et.CUT){const{undos:l,redos:c}=dp(n,o,r);i.push(...c),s.push(...l)}else{const{undos:l,redos:c}=Yc(o,e,r);i.push(...c),s.push(...l);const{undos:d,redos:u}=up(o,e,r);i.push(...u),s.push(...d);const{undos:h,redos:g}=zc(o,n,e,r);i.push(...g),s.push(...h);const{undos:S,redos:p}=Xc(o,n,e,r,!0);i.push(...p),s.push(...S);const{undos:f,redos:v}=Vi(o,e,r);i.push(...v),s.push(...f)}return{undos:s,redos:i}}function dp(n,o,e){let t=[],r=[];const{range:i,subUnitId:s,unitId:l}=n,{range:c,subUnitId:d}=o,u=c?gt(c):null,h=i?gt(i):null;if(h&&u){const g=e.get(a.IUniverInstanceService),S=e.get(m.SheetInterceptorService),p=g.getUniverSheetInstance(l),f=p==null?void 0:p.getSheetBySheetId(s),v=p==null?void 0:p.getSheetBySheetId(d);if(f&&v){const C=new a.ObjectMatrix,_=new a.ObjectMatrix,R=f.getCellMatrix(),w=v.getCellMatrix();a.Range.foreach(h,(B,z)=>{C.setValue(B,z,a.Tools.deepClone(R.getValue(B,z))),_.setValue(B,z,null)});const P=new a.ObjectMatrix;a.Range.foreach(u,(B,z)=>{P.setValue(B,z,a.Tools.deepClone(w.getValue(B,z)))});const y=new a.ObjectMatrix;a.Range.foreach(h,(B,z)=>{const X=a.cellToRange(B,z),K=a.Rectangle.getRelativeRange(X,h),ie=a.Rectangle.getPositionRange(K,u);y.setValue(ie.startRow,ie.startColumn,R.getValue(B,z))});const M={fromRange:h,toRange:u,from:{value:_.getMatrix(),subUnitId:s},to:{value:y.getMatrix(),subUnitId:d},unitId:l},x={fromRange:u,toRange:h,from:{value:C.getMatrix(),subUnitId:s},to:{value:P.getMatrix(),subUnitId:d},unitId:l},A=S.onCommandExecute({id:m.MoveRangeCommand.id,params:{toRange:u,fromRange:h}}),D=f.getMergeData(),N=v.getMergeData(),V=D.filter(B=>a.Rectangle.intersects(B,h)),H=N.filter(B=>a.Rectangle.intersects(B,u)),k=V.map(B=>a.Rectangle.getRelativeRange(B,h)).map(B=>a.Rectangle.getPositionRange(B,u)),U=m.getAddMergeMutationRangeByType(k),L=[{id:m.RemoveWorksheetMergeMutation.id,params:{unitId:l,subUnitId:s,ranges:V}},{id:m.RemoveWorksheetMergeMutation.id,params:{unitId:l,subUnitId:s,ranges:H}},{id:m.AddWorksheetMergeMutation.id,params:{unitId:l,subUnitId:d,ranges:U}}],j=[{id:m.RemoveWorksheetMergeMutation.id,params:{unitId:l,subUnitId:d,ranges:U}},{id:m.AddWorksheetMergeMutation.id,params:{unitId:l,subUnitId:d,ranges:H}},{id:m.AddWorksheetMergeMutation.id,params:{unitId:l,subUnitId:s,ranges:V}}];t=[{id:m.MoveRangeMutation.id,params:M},...A.redos,...L,{id:m.SetSelectionsOperation.id,params:{unitId:l,subUnitId:d,selections:[{range:u}],type:m.SelectionMoveType.MOVE_END}}],r=[{id:m.MoveRangeMutation.id,params:x},...A.undos,...j,{id:m.SetSelectionsOperation.id,params:{unitId:l,subUnitId:s,type:m.SelectionMoveType.MOVE_END,selections:[{range:h}]}}]}}return{undos:r,redos:t}}function zc(n,o,e,t){var p;const{unitId:r,subUnitId:i,range:s}=n,l=(p=t.get(a.IUniverInstanceService).getUniverSheetInstance(r))==null?void 0:p.getSheetBySheetId(i),c=[],d=[],{mapFunc:u}=St([s]),h=new a.ObjectMatrix;e.forValue((f,v,C)=>{var P,y;const{row:_,col:R}=u(f,v),w={v:C.v,t:C.t};if(!C.p&&C.v&&!o){const M=l==null?void 0:l.getCellStyle(_,R);if(a.isTextFormat((P=M==null?void 0:M.n)==null?void 0:P.pattern))w.t=a.CellValueType.STRING;else{const x=String(C.v),A=a.numfmt.parseValue(x);(A==null?void 0:A.v)!==void 0&&typeof A.v=="number"&&(!A.z&&a.willLoseNumericPrecision(x)?w.t=a.CellValueType.FORCE_STRING:w.v=A.v)}}if((y=C.p)!=null&&y.body&&Di(C.p.body)){const M=a.Tools.deepClone({p:C.p,v:C.v});h.setValue(_,R,M)}else h.setValue(_,R,a.Tools.deepClone(w))});const g={unitId:r,subUnitId:i,cellValue:a.Tools.deepClone(h.getMatrix())};c.push({id:m.SetRangeValuesMutation.id,params:g});const S=m.SetRangeValuesUndoMutationFactory(t,g);return d.push({id:m.SetRangeValuesMutation.id,params:S}),{undos:d,redos:c}}function Xc(n,o,e,t,r=!1){var f;const i=[],s=[],{unitId:l,subUnitId:c,range:d}=n,u=(f=t.get(a.IUniverInstanceService).getUniverSheetInstance(l))==null?void 0:f.getSheetBySheetId(c),h=new a.ObjectMatrix,{mapFunc:g}=St([d]);e.forValue((v,C,_)=>{var x,A;const R={s:Object.assign({},{...a.DEFAULT_STYLES,pd:T.DEFAULT_PADDING_DATA,bg:null,cl:null},_.s)},w=R.s.bd;w&&(Object.keys(w).length>0||(R.s.bd={b:null,l:null,r:null,t:null}));const{row:P,col:y}=g(v,C),M=u==null?void 0:u.getCellStyle(P,y);if(_.v&&!o&&a.isTextFormat((x=M==null?void 0:M.n)==null?void 0:x.pattern))R.s||(R.s={}),R.s.n=M==null?void 0:M.n;else{const D=String(_.v),N=a.numfmt.parseValue(D);N!=null&&N.z&&(R.s||(R.s={}),typeof R.s=="object"&&((A=R.s)!=null&&A.n?R.s.n.pattern=N.z:R.s.n={pattern:N.z}))}h.setValue(P,y,R)});const S={unitId:l,subUnitId:c,cellValue:a.Tools.deepClone(h.getMatrix())};i.push({id:m.SetRangeValuesMutation.id,params:S});const p=m.SetRangeValuesUndoMutationFactory(t,S);return s.push({id:m.SetRangeValuesMutation.id,params:p}),{undos:s,redos:i}}function Yc(n,o,e){const t=[],r=[],i=new a.ObjectMatrix,{unitId:s,subUnitId:l,range:c}=n,{mapFunc:d}=St([c]);if(o.forEach((u,h)=>{Object.keys(h).forEach(g=>{const S=Number(g),{row:p,col:f}=d(u,S);i.setValue(p,f,{s:null})})}),i.getLength()>0){const u={subUnitId:l,unitId:s,cellValue:a.Tools.deepClone(i.getMatrix())};t.push({id:m.SetRangeValuesMutation.id,params:u});const h=m.SetRangeValuesUndoMutationFactory(e,u);r.push({id:m.SetRangeValuesMutation.id,params:h})}return{undos:r,redos:t}}function up(n,o,e){const t=[],r=[],i=new a.ObjectMatrix,{unitId:s,subUnitId:l,range:c}=n,{mapFunc:d}=St([c]);if(o.forValue((u,h,g)=>{const{row:S,col:p}=d(u,h);i.setValue(S,p,{v:null,p:null})}),i.getLength()>0){const u={subUnitId:l,unitId:s,cellValue:a.Tools.deepClone(i.getMatrix())};t.push({id:m.SetRangeValuesMutation.id,params:u});const h=m.SetRangeValuesUndoMutationFactory(e,u);r.push({id:m.SetRangeValuesMutation.id,params:h})}return{undos:r,redos:t}}function Vi(n,o,e){const t=[],r=[],{unitId:i,subUnitId:s,range:l}=n,{startColumn:c,startRow:d,endColumn:u,endRow:h}=gt(l),g=[];o.forValue((_,R,w)=>{if(w.rowSpan&&w.rowSpan>1){const P=w.colSpan||1,y={startRow:d+_,endRow:d+_+w.rowSpan-1,startColumn:c+R,endColumn:c+R+P-1};g.push(y)}else if(w.colSpan&&w.colSpan>1){const P=w.rowSpan||1,y={startRow:d+_,endRow:d+_+P-1,startColumn:c+R,endColumn:c+R+w.colSpan-1};g.push(y)}});const p=e.get(a.IUniverInstanceService).getUniverSheetInstance(i),f=p==null?void 0:p.getSheetBySheetId(s);if(p&&f){const R=f.getMergeData().filter(y=>a.Rectangle.intersects({startRow:d,startColumn:c,endRow:h,endColumn:u},y)),w={unitId:i,subUnitId:s,ranges:R};t.push({id:m.RemoveWorksheetMergeMutation.id,params:w});const P=m.RemoveMergeUndoMutationFactory(e,w);r.push({id:m.AddWorksheetMergeMutation.id,params:P})}const v={unitId:i,subUnitId:s,ranges:g};g.length>0&&t.push({id:m.AddWorksheetMergeMutation.id,params:v});const C=m.AddMergeUndoMutationFactory(e,v);return g.length>0&&r.push({id:m.RemoveWorksheetMergeMutation.id,params:C}),{undos:r,redos:t}}function hp(n){if(!n.includes("\r")&&a.Tools.isLegalUrl(n)){const t=a.generateRandomId(),r=`${n}`,i={startIndex:0,endIndex:r.length-1,rangeId:t,rangeType:a.CustomRangeType.HYPERLINK,properties:{url:n}};return{dataStream:`${r}\r
`,paragraphs:[{startIndex:r.length}],customRanges:[i]}}let o=n.replace(/(\r\n|\n)/g,"\r");o.endsWith(`\r
`)||(o+=`\r
`);const e=[];for(let t=0;t<o.length;t++)o[t]==="\r"&&e.push({startIndex:t});return{dataStream:o,paragraphs:e,sectionBreaks:[{startIndex:o.indexOf(`
`)}]}}var mp=Object.getOwnPropertyDescriptor,gp=(n,o,e,t)=>{for(var r=t>1?void 0:t?mp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Le=(n,o)=>(e,t)=>o(e,t,n);const Sp=[m.InsertColMutation.id,m.InsertRowMutation.id,m.RemoveColMutation.id,m.RemoveRowMutation.id,m.MoveRangeMutation.id,m.MoveRowsMutation.id,m.MoveColsMutation.id];let Ut=class extends a.RxDisposable{constructor(o,e,t,r,i,s,l,c,d,u){super();E(this,"_refreshOptionalPaste$",new O.Subject);E(this,"refreshOptionalPaste$",this._refreshOptionalPaste$.asObservable());this._injector=o,this._instanceService=e,this._renderManagerService=t,this._commandService=r,this._contextService=i,this._configService=s,this._sheetClipboardService=l,this._messageService=c,this._localService=d,this._uiPartsService=u,this._init(),this._initCommandListener(),this._initUIComponents(),this._pasteWithDoc()}refreshOptionalPaste(){this._refreshOptionalPaste$.next(Math.random())}_pasteWithDoc(){var t;const o=r=>{r.onPaste$.pipe(O.takeUntil(this.dispose$)).subscribe(i=>{var u,h;if(!se(this._contextService))return;i.event.preventDefault();const s=i.event,l=(u=s.clipboardData)==null?void 0:u.getData("text/html"),c=(h=s.clipboardData)==null?void 0:h.getData("text/plain"),d=this._resolveClipboardFiles(s.clipboardData);this._commandService.executeCommand(to.id,{htmlContent:l,textContent:c,files:d})}),r==null||r.onKeydown$.subscribe(i=>{i.event.key==="Escape"&&this._sheetClipboardService.removeMarkSelection()})};let e=(t=this._renderManagerService.getRenderById(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY))==null?void 0:t.with(J.DocSelectionRenderService);e&&o(e),this._renderManagerService.created$.subscribe(r=>{var i;r.unitId===a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY&&(e=(i=this._renderManagerService.getRenderById(a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY))==null?void 0:i.with(J.DocSelectionRenderService),e&&o(e))})}_resolveClipboardFiles(o){if(!o)return;const e=Array.from(o.items).map(t=>t.kind==="file"?t.getAsFile():void 0).filter(Boolean);return e.length>0?e:void 0}_init(){[He,xo,Ve].forEach(e=>this.disposeWithMe(this._commandService.registerMultipleCommand(e))),[on,sn,yt,an,to,ja].forEach(e=>this.disposeWithMe(this._commandService.registerCommand(e))),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initCopyingHooks())),this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingHook()));const o=this._initSpecialPasteHooks().map(e=>this._sheetClipboardService.addClipboardHook(e));this.disposeWithMe({dispose:()=>o.forEach(e=>e.dispose())})}_initCopyingHooks(){const o=this;let e=null;return{id:ge.DEFAULT_COPY,isDefaultHook:!0,onBeforeCopy(t,r){e=o._getWorksheet(t,r)},onCopyCellContent(t,r){var l,c,d,u;const i=e.getCell(t,r);return(c=(l=i==null?void 0:i.p)==null?void 0:l.body)!=null&&c.paragraphs||(u=(d=i==null?void 0:i.p)==null?void 0:d.body)!=null&&u.textRuns?J.convertBodyToHtml(i.p):i?a.extractPureTextFromCell(i):""},onCopyCellStyle:(t,r,i,s)=>{const l={};(i||s)&&(l.rowspan=`${i||1}`,l.colspan=`${s||1}`);const c=e.getMergedCell(t,r),d=e.getComposedCellStyle(t,r);let u="";if(d&&(u=a.handleStyleToString(d)),c){const h=c.endRow,g=c.endColumn,p=e.getRange(h,g).getTextStyle();if(p){const f=a.handleStyleToString(p);u?u+=f?`;${f}`:"":u=f}}return u&&(l.style=u),Object.keys(l).length?l:null},onCopyColumn(t){return{width:`${e.getColumnWidth(t)}`}},onCopyRow(t){return{style:`height: ${e.getRowHeight(t)}px;`}},onAfterCopy(){e=null},getFilteredOutRows(t){var c;const{startRow:r,endRow:i}=t,s=(c=o._instanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET))==null?void 0:c.getActiveSheet(),l=[];if(!s)return l;for(let d=r;d<=i;d++)s.getRowFiltered(d)&&l.push(d);return l}}}_initPastingHook(){const o=this;let e=null,t=null,r=null;return{id:ge.DEFAULT_PASTE,isDefaultHook:!0,onBeforePaste({unitId:i,subUnitId:s,range:l}){r=o._getWorksheet(i,s),e=i,t=s;const c=o._configService.getConfig(m.MAX_CELL_PER_SHEET_KEY),d=l.rows[l.rows.length-1],u=l.cols[l.cols.length-1];return c&&d*u>c?(o._messageService.show({type:F.MessageType.Error,content:o._localService.t("clipboard.paste.exceedMaxCells")}),!1):!0},onPasteRows(i,s){const{range:l}=i,c=[],d=[],u=r.getMaxRows(),h=u-1,g=l.rows[l.rows.length-1]-h,S=s.length-g,p=r.getRowManager();if(g>0){const C={};s.slice(S).forEach((w,P)=>{const{height:y}=w||{};y&&(C[P]={h:Number.parseFloat(y),hd:a.BooleanNumber.FALSE})});const _={startColumn:l.cols[0],endColumn:l.cols[l.cols.length-1],endRow:l.rows[l.rows.length-1],startRow:u},R={unitId:e,subUnitId:t,range:_,rowInfo:C};c.push({id:m.InsertRowMutation.id,params:R}),d.push({id:m.RemoveRowMutation.id,params:{unitId:e,subUnitId:t,range:_}})}const f={},v={};if(s.slice(0,S).forEach((C,_)=>{var w,P;const{height:R}=C;if(R){const y=p.getRow(l.rows[0]+_),M=Number.parseFloat(R);if(y){const{h:x=a.DEFAULT_WORKSHEET_ROW_HEIGHT,ah:A=0}=y,D=Math.max(x,A);M>D?(f[_+l.rows[0]]=M,v[_+l.rows[0]]=D):(f[_+l.rows[0]]=D,v[_+l.rows[0]]=D)}else f[_+l.rows[0]]=M,v[_+l.rows[0]]=(P=(w=p.getRow(l.rows[0]+_))==null?void 0:w.h)!=null?P:a.DEFAULT_WORKSHEET_ROW_HEIGHT}}),Object.keys(f).length){const C={unitId:e,subUnitId:t,ranges:[{startRow:l.rows[0],endRow:Math.min(l.rows[l.rows.length-1],u),startColumn:l.cols[0],endColumn:l.cols[l.cols.length-1]}],rowHeight:f};c.push({id:m.SetWorksheetRowHeightMutation.id,params:C}),d.push({id:m.SetWorksheetRowHeightMutation.id,params:{...C,rowHeight:v}})}return{redos:c,undos:d}},onPasteColumns(i,s,l){var R;const{range:c}=i,d=[],u=[],h=r.getMaxColumns(),g=h-1,S=c.cols[c.cols.length-1]-g,p=s.length-S,f=(R=o._configService.getConfig(a.DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY))!=null?R:a.DEFAULT_WORKSHEET_COLUMN_WIDTH,v=c.cols,C=v[0];if(S>0){const w={startRow:c.rows[0],endRow:c.rows[c.rows.length-1],endColumn:c.cols[c.cols.length-1],startColumn:h},P={unitId:e,subUnitId:t,range:w,colInfo:s.slice(p).map((y,M)=>({w:y.width?Math.max(+y.width,r.getColumnWidth(v[M])):f,hd:a.BooleanNumber.FALSE}))};d.push({id:m.InsertColMutation.id,params:P}),u.push({id:m.RemoveColMutation.id,params:{unitId:e,subUnitId:t,range:w}})}const _={unitId:e,subUnitId:t,ranges:[{startRow:c.rows[0],endRow:c.rows[c.rows.length-1],startColumn:c.cols[0],endColumn:Math.min(c.cols[c.cols.length-1],h)}]};if(s.length>0){const w={..._,colWidth:s.slice(0,p).reduce((y,M,x)=>{var A;return y[x+C]=M.width?Math.max(+M.width,(A=r.getColumnWidth(v[x]))!=null?A:f):f,y},{})},P={..._,colWidth:s.slice(0,p).reduce((y,M,x)=>{var A;return y[x+C]=(A=r.getColumnWidth(v[x]))!=null?A:f,y},{})};d.push({id:m.SetWorksheetColWidthMutation.id,params:w}),u.push({id:m.SetWorksheetColWidthMutation.id,params:P})}return{redos:d,undos:u}},onPastePlainText(i,s,l){return o._onPastePlainText(i,s,l)},onPasteCells(i,s,l,c){return o._onPasteCells(i,s,l,c)},onAfterPaste(i){r=null}}}_generateDocumentDataModelSnapshot(o){var l,c;const e=(l=T.withCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_SHEET,exports.SheetSkeletonManagerService,this._instanceService,this._renderManagerService))==null?void 0:l.getCurrentParam();if(e==null)return null;const{skeleton:t}=e,r=(c=t.getBlankCellDocumentModel())==null?void 0:c.documentModel,s={...r==null?void 0:r.getSnapshot(),...o};return r==null||r.reset(s),r==null?void 0:r.getSnapshot()}_onPastePlainText(o,e,t){const{range:r,unitId:i,subUnitId:s}=o;let l;if(/\r|\n/.test(e)||a.Tools.isLegalUrl(e)){const d=hp(e),u=this._generateDocumentDataModelSnapshot({body:d});l={[r.rows[0]]:{[r.cols[0]]:{p:u,v:null,f:null}}}}else if(a.isFormulaString(e))l={[r.rows[0]]:{[r.cols[0]]:{f:e,v:null,p:null}}};else{const d=a.numfmt.parseNumber(e);d!=null&&d.z?l={[r.rows[0]]:{[r.cols[0]]:{v:d.v,s:{n:{pattern:d.z}},f:null}}}:l={[r.rows[0]]:{[r.cols[0]]:{v:e,f:null}}}}const c={unitId:i,subUnitId:s,cellValue:l};return{redos:[{id:m.SetRangeValuesMutation.id,params:c}],undos:[{id:m.SetRangeValuesMutation.id,params:m.SetRangeValuesUndoMutationFactory(this._injector,c)}]}}_onPasteCells(o,e,t,r){return this._injector.invoke(i=>cp(o,e,t,r,i))}_initSpecialPasteHooks(){const o=this,e={id:ge.SPECIAL_PASTE_VALUE,specialPasteInfo:{label:"specialPaste.value"},onPasteCells:(s,l,c)=>this._injector.invoke(d=>zc(l,s,c,d))},t={id:ge.SPECIAL_PASTE_FORMAT,specialPasteInfo:{label:"specialPaste.format"},onPasteCells:(s,l,c)=>{const d=[],u=[],{undos:h,redos:g}=this._injector.invoke(C=>Yc(l,c,C));d.push(...g),u.push(...h);const{undos:S,redos:p}=this._injector.invoke(C=>Vi(l,c,C));d.push(...p),u.push(...S);const{undos:f,redos:v}=this._injector.invoke(C=>Xc(l,s,c,C));return d.push(...v),u.push(...f),{undos:u,redos:d}}},r={id:ge.SPECIAL_PASTE_COL_WIDTH,specialPasteInfo:{label:"specialPaste.colWidth"},onPasteCells(){return{undos:[],redos:[]}},onPasteColumns(s,l,c){var x,A;const d=o._instanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),u=d.getUnitId(),h=(x=d.getActiveSheet())==null?void 0:x.getSheetId();if(!u||!h)throw new Error("Cannot find unitId or subUnitId");const g=[],S=[],p=o._getWorksheet(u,h),{range:f}=s,v=f.cols,C=v[0],_=p.getMaxColumns(),R=f.cols[f.cols.length-1]-_,w=l.length-R,P=(A=o._configService.getConfig(a.DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY))!=null?A:a.DEFAULT_WORKSHEET_COLUMN_WIDTH,y={unitId:u,subUnitId:h,ranges:[{startRow:f.rows[0],endRow:Math.min(f.cols[f.cols.length-1],_),startColumn:f.cols[0],endColumn:f.cols[f.cols.length-1]}],colWidth:l.slice(0,w).reduce((D,N,V)=>{var H;return D[V+C]=N.width?Math.max(+N.width,(H=p.getColumnWidth(v[V]))!=null?H:P):P,D},{})},M={unitId:u,subUnitId:h,ranges:[{startRow:f.rows[0],endRow:Math.min(f.cols[f.cols.length-1],_),startColumn:f.cols[0],endColumn:f.cols[f.cols.length-1]}],colWidth:l.slice(0,w).reduce((D,N,V)=>{var H;return D[V+C]=(H=p.getColumnWidth(v[V]))!=null?H:P,D},{})};return g.push({id:m.SetWorksheetColWidthMutation.id,params:y}),S.push({id:m.SetWorksheetColWidthMutation.id,params:M}),{redos:g,undos:S}}},i={id:ge.SPECIAL_PASTE_BESIDES_BORDER,specialPasteInfo:{label:"specialPaste.besidesBorder"},onPasteCells:(s,l,c,d)=>{o._instanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);const u=[],h=[],{range:g,unitId:S,subUnitId:p}=l,f=new a.ObjectMatrix;c.forValue((w,P,y)=>{const M=y.s;if(typeof M=="object"){const x=a.Tools.deepClone(y);x.s&&(x.s={...M,bd:null}),f.setValue(g.rows[w],g.cols[P],x)}});const v={unitId:S,subUnitId:p,cellValue:f.getData()};u.push({id:m.SetRangeValuesMutation.id,params:v});const C=this._injector.invoke(m.SetRangeValuesUndoMutationFactory,v);h.push({id:m.SetRangeValuesMutation.id,params:C});const{undos:_,redos:R}=this._injector.invoke(w=>Vi(l,c,w));return h.push(..._),u.push(...R),{redos:u,undos:h}}};return[e,t,r,i]}_getWorksheet(o,e){var r;const t=(r=this._instanceService.getUniverSheetInstance(o))==null?void 0:r.getSheetBySheetId(e);if(!t)throw new Error(`[SheetClipboardController]: cannot find a worksheet with unitId ${o} and subUnitId ${e}.`);return t}_initCommandListener(){var e;this.disposeWithMe(this._commandService.onCommandExecuted(t=>{t.id===Ct.id?this._sheetClipboardService.removeMarkSelection():Sp.includes(t.id)&&this._sheetClipboardService.removeMarkSelection()}));const o=this._configService.getConfig(Ee);(e=o==null?void 0:o.clipboardConfig)!=null&&e.hidePasteOptions||(this.disposeWithMe(this._commandService.onCommandExecuted(t=>{lp.includes(t.id)&&this._sheetClipboardService.disposePasteOptionsCache()})),this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===We.id){if(!this._sheetClipboardService.getPasteMenuVisible())return;const i=t.params.unitId,s=this._sheetClipboardService.getPasteOptionsCache(),l=s==null?void 0:s.target.unitId;i===l&&this._refreshOptionalPaste$.next(Math.random())}})))}_initUIComponents(){var e;const o=this._configService.getConfig(Ee);(e=o==null?void 0:o.clipboardConfig)!=null&&e.hidePasteOptions||this.disposeWithMe(this._uiPartsService.registerComponent(I.BuiltInUIPart.CONTENT,()=>I.connectInjector(ap,this._injector)))}};Ut=gp([Le(0,a.Inject(a.Injector)),Le(1,a.IUniverInstanceService),Le(2,T.IRenderManagerService),Le(3,a.ICommandService),Le(4,a.IContextService),Le(5,a.IConfigService),Le(6,ke),Le(7,I.IMessageService),Le(8,a.Inject(a.LocaleService)),Le(9,I.IUIPartsService)],Ut);var pp=Object.getOwnPropertyDescriptor,fp=(n,o,e,t)=>{for(var r=t>1?void 0:t?pp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Yn=(n,o)=>(e,t)=>o(e,t,n);let wn=class extends a.Disposable{constructor(n,o,e,t,r){super(),this._selectionManagerService=n,this._themeService=o,this._instanceSrv=e,this._cmdSrv=t,this._definedNamesService=r,this._init()}_init(){this.disposeWithMe(O.merge(this._selectionManagerService.selectionMoveStart$,this._selectionManagerService.selectionMoving$,this._selectionManagerService.selectionMoveEnd$,this._selectionManagerService.selectionSet$).pipe(O.filter(n=>!!n)).subscribe(n=>{this._syncDefinedNameRange(n)})),this.disposeWithMe(this._definedNamesService.focusRange$.subscribe(async n=>{if(n==null)return;const{unitId:o}=n;let{formulaOrRefString:e}=n;if(e.substring(0,1)===G.operatorToken.EQUALS&&(e=e.substring(1)),!G.isReferenceStrings(e))return;const r=this._instanceSrv.getUnit(o),i=await this._getSelections(r,o,e);this._selectionManagerService.setSelections(i),this._cmdSrv.executeCommand(m.ScrollToCellOperation.id,{unitId:o,range:i[0].range})}))}_syncDefinedNameRange(n){if(n.length===0)return;const o=n[n.length-1],e=this._instanceSrv.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),t=e==null?void 0:e.getActiveSheet();t&&this._definedNamesService.setCurrentRange({range:o.range,unitId:e.getUnitId(),sheetId:t.getSheetId()})}async _getSelections(n,o,e){const t=e.split(",");let r=n.getActiveSheet();if(!r)return[];const i=[];for(let s=0;s<t.length;s++){const l=t[s].trim(),c=G.deserializeRangeWithSheet(l.trim());if(s===0){const u=n.getSheetBySheetName(c.sheetName);u&&r.getSheetId()!==u.getSheetId()&&(r=u,await this._cmdSrv.executeCommand(m.SetWorksheetActivateCommand.id,{subUnitId:r.getSheetId(),unitId:o}))}if(r.getName()!==c.sheetName)continue;let d=null;if(s===t.length-1){const u=c.range,{startRow:h,startColumn:g,endRow:S,endColumn:p}=u;d=m.getPrimaryForRange({startRow:h,startColumn:g,endRow:S,endColumn:p},r)}i.push({range:c.range,style:mt(this._themeService),primary:d})}return i}};wn=fp([Yn(0,a.Inject(m.SheetsSelectionsService)),Yn(1,a.Inject(a.ThemeService)),Yn(2,a.IUniverInstanceService),Yn(3,a.ICommandService),Yn(4,G.IDefinedNamesService)],wn);var vp=Object.getOwnPropertyDescriptor,Cp=(n,o,e,t)=>{for(var r=t>1?void 0:t?vp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},at=(n,o)=>(e,t)=>o(e,t,n);const Ip={pageSize:{width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},documentFlavor:a.DocumentFlavor.UNSPECIFIED,marginTop:5,marginBottom:5,marginRight:0,marginLeft:0,paragraphLineGapDefault:0,renderConfig:{horizontalAlign:a.HorizontalAlign.UNSPECIFIED,verticalAlign:a.VerticalAlign.TOP,centerAngle:0,vertexAngle:0,wrapStrategy:a.WrapStrategy.WRAP,isRenderStyle:a.BooleanNumber.FALSE}};let En=class extends a.Disposable{constructor(n,o,e,t,r,i,s,l){super(),this._univerInstanceService=n,this._renderManagerService=o,this._editorBridgeService=e,this._commandService=t,this._rangeProtectionRuleModel=r,this._worksheetProtectionRuleModel=i,this._formulaEditorController=s,this._formulaEditorManagerService=l,this._initialize()}_initialize(){this._syncFormulaEditorContent(),this._commandExecutedListener()}_getEditorViewModel(n){var o;return(o=this._renderManagerService.getRenderById(n))==null?void 0:o.with(ve.DocSkeletonManagerService).getViewModel()}_syncFormulaEditorContent(){this.disposeWithMe(this._editorBridgeService.currentEditCellState$.subscribe(n=>{n==null||this._editorBridgeService.isForceKeepVisible()||!this._rangeProtectionRuleModel.getRangeRuleInitState()||!this._worksheetProtectionRuleModel.getSheetRuleInitState()||this._editorSyncHandler(n)}))}_editorSyncHandler(n){var r,i,s;let o=a.Tools.deepClone((r=n.documentLayoutObject.documentModel)==null?void 0:r.getBody());const e=a.Tools.deepClone((i=n.documentLayoutObject.documentModel)==null?void 0:i.drawings),t=a.Tools.deepClone((s=n.documentLayoutObject.documentModel)==null?void 0:s.getDrawingsOrder());(!o||n.isInArrayFormulaRange===!0&&this._editorBridgeService.isVisible().eventType===T.DeviceInputEventType.Dblclick)&&(o={dataStream:`\r
`,paragraphs:[{startIndex:0}],textRuns:[]}),this._syncContentAndRender(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,o,e,t)}_commandExecutedListener(){const n=[a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY];this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===ve.RichTextEditingMutation.id){const t=e.params,{unitId:r,trigger:i,isSync:s}=t;if(s||i===J.ReplaceSnapshotCommand.id)return;if(n.includes(r)){const l=this._univerInstanceService.getUnit(r,a.UniverInstanceType.UNIVER_DOC),c=r===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY?a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY:a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY;this._checkAndSetRenderStyleConfig(l),this._syncActionsAndRender(c,t)}}}));const o=[m.SetRangeValuesMutation.id,m.MoveRangeMutation.id];this.disposeWithMe(this._commandService.onCommandExecuted(e=>{var t,r,i,s,l,c,d;if(o.includes(e.id)){const u=this._editorBridgeService.getLatestEditCellState();if(u==null)return;let h=!1;const{row:g,column:S}=u;if(e.id===m.SetRangeValuesMutation.id&&e.params?(r=(t=e.params.cellValue)==null?void 0:t[g])!=null&&r[S]&&(h=!0):e.id===m.MoveRangeMutation.id&&e.params&&(s=(i=e.params.to.value)==null?void 0:i[g])!=null&&s[S]&&(h=!0),h){const p=a.Tools.deepClone((l=u.documentLayoutObject.documentModel)==null?void 0:l.getBody()),f=a.Tools.deepClone((c=u.documentLayoutObject.documentModel)==null?void 0:c.drawings),v=a.Tools.deepClone((d=u.documentLayoutObject.documentModel)==null?void 0:d.getDrawingsOrder());if(p==null)return;this._syncContentAndRender(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY,p,f,v)}}}))}_syncActionsAndRender(n,o){var l;const e=[a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY],t=this._renderManagerService.getRenderById(n);if(t==null)return;const r=t.with(ve.DocSkeletonManagerService).getSkeleton(),i=this._univerInstanceService.getUnit(n,a.UniverInstanceType.UNIVER_DOC),s=this._getEditorViewModel(n);i==null||s==null||(this._commandService.syncExecuteCommand(ve.RichTextEditingMutation.id,{...o,textRanges:null,isSync:!0,unitId:n,syncer:o.unitId}),s.reset(i),r.calculate(),e.includes(n)&&((l=t.mainComponent)==null||l.makeDirty()))}_syncContentAndRender(n,o,e,t){var d,u;n===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY&&o.paragraphs&&(o.paragraphs=this._clearParagraph(o.paragraphs));const r=[a.DOCS_NORMAL_EDITOR_UNIT_ID_KEY,a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY],i=(d=this._renderManagerService.getRenderById(n))==null?void 0:d.with(ve.DocSkeletonManagerService).getSkeleton(),s=this._univerInstanceService.getUnit(n,a.UniverInstanceType.UNIVER_DOC),l=this._getEditorViewModel(n);if(s==null||l==null||i==null)return;s.getSnapshot().body=o,s.getSnapshot().drawings=e!=null?e:{},s.getSnapshot().drawingsOrder=t!=null?t:[],this._checkAndSetRenderStyleConfig(s),l.reset(s);const c=this._renderManagerService.getRenderById(n);c!=null&&(i.calculate(),r.includes(n)&&((u=c.mainComponent)==null||u.makeDirty()),n===a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY&&this._formulaEditorController.autoScroll())}_checkAndSetRenderStyleConfig(n){var i;const o=n.getSnapshot(),{body:e}=o;if(o.id!==a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY)return;o.documentStyle=Ip;let t=o.documentStyle.renderConfig;t==null&&(t={},o.documentStyle.renderConfig=t);const r=this._formulaEditorManagerService.getPosition();if(r){const s=r.width;o.documentStyle.pageSize={width:s,height:1/0}}((i=e==null?void 0:e.dataStream)!=null?i:"").startsWith("=")?t.isRenderStyle=a.BooleanNumber.TRUE:t.isRenderStyle=a.BooleanNumber.FALSE}_clearParagraph(n){const o=a.Tools.deepClone(n);for(const e of o)e.paragraphStyle&&(e.paragraphStyle.horizontalAlign=a.HorizontalAlign.UNSPECIFIED);return o}};En=Cp([at(0,a.IUniverInstanceService),at(1,T.IRenderManagerService),at(2,he),at(3,a.ICommandService),at(4,a.Inject(m.RangeProtectionRuleModel)),at(5,a.Inject(m.WorksheetProtectionRuleModel)),at(6,a.Inject(exports.FormulaEditorController)),at(7,Vn)],En);var _p=Object.getOwnPropertyDescriptor,bp=(n,o,e,t)=>{for(var r=t>1?void 0:t?_p(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Zn=(n,o)=>(e,t)=>o(e,t,n);const pi="SHEET_FORCE_STRING_ALERT";let co=class extends a.Disposable{constructor(n,o,e,t,r,i){super(),this._context=n,this._hoverManagerService=o,this._cellAlertManagerService=e,this._localeService=t,this._zenZoneService=r,this._configService=i,this._init()}_init(){this._initCellAlertPopup(),this._initZenService()}_initCellAlertPopup(){this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe(n=>{var o,e;if(n){const t=n.location,r=this._context.unit,i=r.getActiveSheet();if(!i)return this._hideAlert();const s=i.getCell(t.row,t.col);if(!s||s.v===null||s.v===void 0)return this._hideAlert();let l;if(s!=null&&s.s){const c=r.getStyles().get(s.s);c!=null&&c.n&&(l=c.n)}if(a.isTextFormat(l==null?void 0:l.pattern)){this._hideAlert();return}if((s.t===a.CellValueType.FORCE_STRING||s.t===a.CellValueType.STRING)&&(a.isRealNum(s.v)||typeof s.v=="string"&&a.numfmt.parseNumber(s.v))){if((o=this._configService.getConfig(Ee))!=null&&o.disableForceStringAlert)return;const c=this._cellAlertManagerService.currentAlert.get(pi),d=(e=c==null?void 0:c.alert)==null?void 0:e.location;if(d&&d.row===n.location.row&&d.col===n.location.col&&d.subUnitId===n.location.subUnitId&&d.unitId===n.location.unitId){this._hideAlert();return}this._cellAlertManagerService.showAlert({type:dn.ERROR,title:this._localeService.t("info.error"),message:this._localeService.t("info.forceStringInfo"),location:t,width:200,height:74,key:pi});return}}this._hideAlert()}))}_initZenService(){this.disposeWithMe(this._zenZoneService.visible$.subscribe(n=>{n&&this._hideAlert()}))}_hideAlert(){this._cellAlertManagerService.removeAlert(pi)}};co=bp([Zn(1,a.Inject(exports.HoverManagerService)),Zn(2,a.Inject(exports.CellAlertManagerService)),Zn(3,a.Inject(a.LocaleService)),Zn(4,I.IZenZoneService),Zn(5,a.IConfigService)],co);var Rp=Object.getOwnPropertyDescriptor,wp=(n,o,e,t)=>{for(var r=t>1?void 0:t?Rp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},fi=(n,o)=>(e,t)=>o(e,t,n);let uo=class extends a.RxDisposable{constructor(n,o,e,t){super(),this._context=n,this._sheetSkeletonManagerService=o,this._sheetInterceptorService=e,this._configService=t,this._initViewModelIntercept()}_initViewModelIntercept(){const n={tl:{size:6,color:"#409f11"}};this.disposeWithMe(this._sheetInterceptorService.intercept(m.INTERCEPTOR_POINT.CELL_CONTENT,{priority:10,effect:a.InterceptorEffectEnum.Style,handler:(o,e,t)=>{var s,l,c;if(!((s=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:s.skeleton))return t(o);const i=e.rawData;if(!i||i.v===null||i.v===void 0)return t(o);if(((o==null?void 0:o.t)===a.CellValueType.FORCE_STRING||(o==null?void 0:o.t)===a.CellValueType.STRING)&&(a.isRealNum(i.v)||typeof i.v=="string"&&a.numfmt.parseNumber(i.v))){const d=e.workbook.getStyles().get(i.s);return a.isTextFormat((l=d==null?void 0:d.n)==null?void 0:l.pattern)||(c=this._configService.getConfig(Ee))!=null&&c.disableForceStringMark||(o===i&&(o={...i}),o.markers={...o==null?void 0:o.markers,...n}),t(o)}return t(o)}}))}};uo=wp([fi(1,a.Inject(exports.SheetSkeletonManagerService)),fi(2,a.Inject(m.SheetInterceptorService)),fi(3,a.IConfigService)],uo);var Ep=Object.getOwnPropertyDescriptor,Tp=(n,o,e,t)=>{for(var r=t>1?void 0:t?Ep(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Tt=(n,o)=>(e,t)=>o(e,t,n);let Tn=class extends a.Disposable{constructor(n,o,e,t,r,i,s){super(),this._commandService=n,this._formatPainterService=o,this._univerInstanceService=e,this._renderManagerService=t,this._selectionManagerService=r,this._sheetInterceptorService=i,this._injector=s,this._initialize()}_initialize(){this._addDefaultHook()}_addDefaultHook(){const n={id:"default-format-painter",priority:0,isDefaultHook:!0,onStatusChange:o=>{if(o!==xe.OFF){const e=this._collectSelectionRangeFormat();e&&this._formatPainterService.setSelectionFormat(e)}},onApply:(o,e,t,r)=>this._getUndoRedoMutationInfo(o,e,t,r)};this._formatPainterService.addHook(n)}_collectSelectionRangeFormat(){const n=this._selectionManagerService.getCurrentLastSelection(),o=n==null?void 0:n.range;if(!o)return null;const{startRow:e,endRow:t,startColumn:r,endColumn:i}=o,s=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),l=s==null?void 0:s.getActiveSheet();if(!l)return null;const c=l.getCellMatrix(),d=s.getStyles(),u=new a.ObjectMatrix,h=[];for(let g=e;g<=t;g++)for(let S=r;S<=i;S++){const p=c.getValue(g,S);u.setValue(g,S,d.getStyleByCell(p)||{});const{isMergedMainCell:f,...v}=l.getCellInfoInMergeData(g,S);f&&h.push({startRow:v.startRow,startColumn:v.startColumn,endRow:v.endRow,endColumn:v.endColumn})}return{styles:u,merges:h}}_getUndoRedoMutationInfo(n,o,e,t){const r=this._sheetInterceptorService,i=this._univerInstanceService,{merges:s,styles:l}=t;if(!l)return{undos:[],redos:[]};const{startRow:c,startColumn:d,endRow:u,endColumn:h}=l.getDataRange(),g=u-c+1,S=h-d+1,p=e.startRow===e.endRow&&e.startColumn===e.endColumn?{startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow+g-1,endColumn:e.startColumn+S-1}:e,f=Array.from({length:p.endRow-p.startRow+1},()=>Array.from({length:p.endColumn-p.startColumn+1},()=>({}))),v=[];f.forEach((H,k)=>{H.forEach((U,L)=>{const j=k%g+c,B=L%S+d,z=l.getValue(j,B);z&&(f[k][L].s=Object.keys(z).length>0?z:null)})});let C=0,_=0;s.forEach(H=>{H.startRow===c&&H.startColumn===d&&(C=H.endRow-H.startRow,_=H.endColumn-H.startColumn);const k={startRow:H.startRow-c,startColumn:H.startColumn-d,endRow:H.endRow-c,endColumn:H.endColumn-d},U=Math.max(1,Math.floor((p.endRow-p.startRow+1)/g)),L=Math.max(1,Math.floor((p.endColumn-p.startColumn+1)/S));for(let j=0;j<U;j++)for(let B=0;B<L;B++)v.push({startRow:k.startRow+j*g+p.startRow,startColumn:k.startColumn+B*S+p.startColumn,endRow:k.endRow+j*g+p.startRow,endColumn:k.endColumn+B*S+p.startColumn})});const R=[p],w=new a.ObjectMatrix,P=new a.ObjectMatrix;if(a.Tools.isArray(f))for(let H=0;H<R.length;H++){const{startRow:k,startColumn:U,endRow:L,endColumn:j}=R[H];for(let B=0;B<=L-k;B++)for(let z=0;z<=j-U;z++)w.setValue(B+k,z+U,{s:null}),P.setValue(B+k,z+U,f[B][z])}const y={subUnitId:o,unitId:n,cellValue:w.getMatrix()},M={subUnitId:o,unitId:n,cellValue:P.getMatrix()},x=this._injector.invoke(m.SetRangeValuesUndoMutationFactory,y),{undos:A,redos:D}=r.onCommandExecute({id:m.SetRangeValuesCommand.id,params:{...M,range:R}}),N=[],V=[];if(v.length>0){const H=m.getAddMergeMutationRangeByType(v),k=i.getUnit(n).getSheetBySheetId(o),U=$a(k,H),L={unitId:n,subUnitId:o,ranges:H},j={unitId:n,subUnitId:o,ranges:H};N.push({id:m.RemoveWorksheetMergeMutation.id,params:L}),N.push({id:m.AddWorksheetMergeMutation.id,params:j});const B=this._injector.invoke(m.RemoveMergeUndoMutationFactory,L),z=this._injector.invoke(m.AddMergeUndoMutationFactory,j);if(V.push({id:m.RemoveWorksheetMergeMutation.id,params:z}),V.push({id:m.AddWorksheetMergeMutation.id,params:B}),U){const X=this._injector.invoke(K=>el(K,n,k,H));N.unshift(...X.redos),V.push(...X.undos)}}if(!a.Rectangle.equals(p,e)){const H={actualRow:p.startRow,actualColumn:p.startColumn,rangeType:a.RANGE_TYPE.NORMAL,isMerged:C>0||_>0,isMergedMainCell:!1,startRow:p.startRow,startColumn:p.startColumn,endRow:p.startRow+C,endColumn:p.startColumn+_};N.push({id:m.SetSelectionsOperation.id,params:{unitId:n,subUnitId:o,type:m.SelectionMoveType.ONLY_SET,selections:[{range:p,primary:H,style:null}]}}),V.unshift({id:m.SetSelectionsOperation.id,params:{unitId:n,subUnitId:o,type:m.SelectionMoveType.ONLY_SET,selections:[{range:e,primary:H,style:null}]}})}return{undos:[{id:m.SetRangeValuesMutation.id,params:y},{id:m.SetRangeValuesMutation.id,params:x},...A,...V],redos:[{id:m.SetRangeValuesMutation.id,params:y},{id:m.SetRangeValuesMutation.id,params:M},...D,...N]}}};Tn=Tp([Tt(0,a.ICommandService),Tt(1,Xe),Tt(2,a.IUniverInstanceService),Tt(3,T.IRenderManagerService),Tt(4,a.Inject(m.SheetsSelectionsService)),Tt(5,a.Inject(m.SheetInterceptorService)),Tt(6,a.Inject(a.Injector))],Tn);var yp=Object.getOwnPropertyDescriptor,Mp=(n,o,e,t)=>{for(var r=t>1?void 0:t?yp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},vi=(n,o)=>(e,t)=>o(e,t,n);let ho=class extends a.Disposable{constructor(n,o,e,t){super(),this._context=n,this._markSelectionService=o,this._commandService=e,this._sheetSkeletonManagerService=t,this._initListeners()}_initListeners(){this._addRemoveListener(),this._addRefreshListener()}_addRemoveListener(){const n=[Se.id];this.disposeWithMe(this._commandService.onCommandExecuted(o=>{n.includes(o.id)?this._markSelectionService.removeAllShapes():this._markSelectionService.getShapeMap().forEach((t,r)=>{t.exits.includes(o.id)&&this._markSelectionService.removeShape(r)})}))}_addRefreshListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n=>{n&&this._markSelectionService.refreshShapes()}))}};ho=Mp([vi(1,a.Inject(Lt)),vi(2,a.ICommandService),vi(3,a.Inject(exports.SheetSkeletonManagerService))],ho);function Zc(){const n=vt();return n?b.jsx(Pp,{workbook:n}):null}function Pp(n){const{workbook:o}=n,[e,t]=W.useState([]),[r,i]=W.useState(""),s=W.useRef(new Map),l=I.useDependency(a.ICommandService),c=W.useCallback(()=>{const u=o.getActiveSheet().getSheetId(),h=o.getSheets(),g=o.getActiveSheet(),S=h.filter(p=>!p.isSheetHidden()).map((p,f)=>{var v;return{sheetId:p.getSheetId(),label:p.getName(),index:f,selected:g===p,color:(v=p.getTabColor())!=null?v:void 0}});if(t(S),i(u),s.current.has(u)){const p=s.current.get(u);p&&p.scrollIntoView({behavior:"smooth",block:"nearest"})}s.current.clear()},[o]);W.useEffect(()=>c(),[c]);const d=W.useCallback(u=>{l.executeCommand(m.SetWorksheetActiveOperation.id,{unitId:o.getUnitId(),subUnitId:u})},[l,o]);return W.useEffect(()=>{const u=l.onCommandExecuted(h=>{switch(h.id){case m.SetWorksheetHideMutation.id:case m.RemoveSheetMutation.id:case m.SetWorksheetNameMutation.id:case m.InsertSheetMutation.id:case m.SetWorksheetOrderMutation.id:case m.SetWorksheetActiveOperation.id:c();break}});return()=>u.dispose()},[l,c]),b.jsx("div",{className:"univer-h-8 univer-w-full univer-overflow-x-scroll univer-bg-gray-100 dark:!univer-bg-gray-900",children:b.jsx("div",{className:"univer-flex univer-h-8 univer-flex-nowrap univer-items-center",children:e.map(u=>b.jsx("div",{ref:h=>{s.current.set(u.sheetId,h)},className:F.clsx(`
                              univer-box-border univer-h-full univer-min-w-12 univer-max-w-[120px] univer-shrink-0
                              univer-flex-nowrap univer-items-center univer-truncate univer-px-1 univer-py-0.5
                              univer-text-center univer-text-xs univer-leading-7
                            `,F.borderRightClassName,{"univer-bg-white univer-text-primary-600 dark:!univer-bg-slate-600":u.sheetId===r}),onClick:()=>d(u.sheetId),children:u.label},u.sheetId))})})}const xp={[I.ContextMenuPosition.MAIN_AREA]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn}},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}},[I.ContextMenuPosition.COL_HEADER]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn}},[I.ContextMenuGroup.LAYOUT]:{order:1},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}},[I.ContextMenuPosition.ROW_HEADER]:{[I.ContextMenuGroup.FORMAT]:{[He.name]:{order:0,menuItemFactory:cn}},[I.ContextMenuGroup.LAYOUT]:{order:1},[I.ContextMenuGroup.DATA]:{order:2},[I.ContextMenuGroup.OTHERS]:{order:3}}};var Op=Object.getOwnPropertyDescriptor,Ap=(n,o,e,t)=>{for(var r=t>1?void 0:t?Op(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},lt=(n,o)=>(e,t)=>o(e,t,n);let mo=class extends a.Disposable{constructor(n,o,e,t,r,i,s,l){super(),this._injector=n,this._componentManager=o,this._layoutService=e,this._commandService=t,this._shortcutService=r,this._menuManagerService=i,this._uiPartsService=s,this._configService=l,this._init()}_init(){this._initComponents(),this._initCommands(),this._initMenus(),this._initShortcuts(),this._initWorkbenchParts(),this._initFocusHandler()}_initComponents(){const n=this._componentManager;this.disposeWithMe(n.register(Ge,Yl)),this.disposeWithMe(n.register(fs,nc)),this.disposeWithMe(n.register(sr,oc)),this.disposeWithMe(n.register(_s,rc)),this.disposeWithMe(n.register("HideGridlinesDoubleIcon",hs))}_initCommands(){[vs,Ct,Is,Cs,Nn,Oe,Me,Ze,Ar,br,fn,vn,mr,gr,Ue,rs,yr,No,m.SetBoldCommand,Wt,Se,Or,Bt,Ft,jt,zt,es,ts,Sr,pr,pn,Ao,m.SetItalicCommand,m.SetStrikeThroughCommand,m.SetFontFamilyCommand,m.SetFontSizeCommand,Rr,Do,An,wr,We,In,rt,Er,Tr,ko,m.SetUnderlineCommand,kn,De,Mr,_r,Ht,kt,On,xn,Ho,dt,mn,je,os,vr,Mt,Pt,Cr,Ir,xr,xt,Ot,Pr,Dn,cr,dr].forEach(n=>{this.disposeWithMe(this._commandService.registerCommand(n))})}_initMenus(){this._menuManagerService.mergeMenu(xp)}_initShortcuts(){[ac,lc,cc,dc,uc,hc,mc,gc,Sc,pc,fc,vc,Cc,Ic,_c,bc,Rc,wc,Ec,Tc,yc,Hc,Wc,Lc,Bc,Vc,Uc,Mc,Pc,xc,Oc,Ac,Dc,Nc,kc,...wl(),Tl,El,yl,xl,Ol,Al,Nl,Ml,Pl,Dl,ic,sc].forEach(n=>{this.disposeWithMe(this._shortcutService.registerShortcut(n))})}_initWorkbenchParts(){const n=this._uiPartsService,o=this._injector;this.disposeWithMe(n.registerComponent(I.BuiltInUIPart.HEADER,()=>I.connectInjector(Zc,o))),this.disposeWithMe(n.registerComponent(I.BuiltInUIPart.CONTENT,()=>I.connectInjector(Ss,o)))}_initFocusHandler(){this.disposeWithMe(this._layoutService.registerFocusHandler(a.UniverInstanceType.UNIVER_SHEET,n=>{const o=this._injector.get(T.IRenderManagerService),e=this._injector.get(a.IUniverInstanceService),t=T.getCurrentTypeOfRenderer(a.UniverInstanceType.UNIVER_DOC,e,o),r=t==null?void 0:t.with(J.DocSelectionRenderService);r==null||r.focus()}))}};mo=Ap([lt(0,a.Inject(a.Injector)),lt(1,a.Inject(I.ComponentManager)),lt(2,I.ILayoutService),lt(3,a.ICommandService),lt(4,I.IShortcutService),lt(5,I.IMenuManagerService),lt(6,I.IUIPartsService),lt(7,a.IConfigService)],mo);var Dp=Object.getOwnPropertyDescriptor,Np=(n,o,e,t)=>{for(var r=t>1?void 0:t?Dp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ci=(n,o)=>(e,t)=>o(e,t,n);let go=class extends a.Disposable{constructor(o,e,t,r){super();E(this,"_disposableCollection",new a.DisposableCollection);E(this,"_initialize",()=>{const o=this._disposableCollection;this.disposeWithMe(this._selectionManagerService.selectionMoveEnd$.subscribe(()=>{o.dispose(),this._selectionRenderService.getSelectionControls().forEach(t=>{o.add(a.toDisposable(t.selectionMoveEnd$.subscribe(r=>{if(!r)return;const i=t.model.getRange(),s={startRow:i.startRow,startColumn:i.startColumn,endRow:i.endRow,endColumn:i.endColumn,rangeType:i.rangeType},l={startRow:r.startRow,startColumn:r.startColumn,endRow:r.endRow,endColumn:r.endColumn,rangeType:i.rangeType};if(s.startRow===l.startRow&&s.startColumn===l.startColumn||l.startRow<0||l.startColumn<0)return;const c={fromRange:s,toRange:l};this._commandService.executeCommand(m.MoveRangeCommand.id,c)})))})}))});this._context=o,this._selectionRenderService=e,this._selectionManagerService=t,this._commandService=r,this._initialize()}dispose(){var o;super.dispose(),(o=this._disposableCollection)==null||o.dispose()}};go=Np([Ci(1,a.Inject(Ce)),Ci(2,a.Inject(m.SheetsSelectionsService)),Ci(3,a.Inject(a.ICommandService))],go);var kp=Object.getOwnPropertyDescriptor,Hp=(n,o,e,t)=>{for(var r=t>1?void 0:t?kp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Vp=(n,o)=>(e,t)=>o(e,t,n);let yn=class extends a.Disposable{constructor(n){super(),this._sheetPermissionInitController=n,this._initPermission()}_initPermission(){this._sheetPermissionInitController.initPermission()}};yn=Hp([Vp(0,a.Inject(m.SheetPermissionInitController))],yn);var Wp=Object.getOwnPropertyDescriptor,Up=(n,o,e,t)=>{for(var r=t>1?void 0:t?Wp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Qe=(n,o)=>(e,t)=>o(e,t,n);let So=class extends a.RxDisposable{constructor(o,e,t,r,i,s,l,c,d,u){super();E(this,"disposableCollection",new a.DisposableCollection);this._context=o,this._univerInstanceService=e,this._permissionService=t,this._selectionManagerService=r,this._rangeProtectionRuleModel=i,this._headerMoveRenderController=s,this._selectionRenderService=l,this._headerFreezeRenderController=c,this._rangeProtectionCache=d,this._headerResizeRenderController=u,this._initHeaderMovePermissionInterceptor(),this._initHeaderResizePermissionInterceptor(),this._initRangeFillPermissionInterceptor(),this._initRangeMovePermissionInterceptor()}_initHeaderMovePermissionInterceptor(){const o=this._headerMoveRenderController.interceptor.getInterceptPoints().HEADER_MOVE_PERMISSION_CHECK;this.disposeWithMe(this._headerMoveRenderController.interceptor.intercept(o,{handler:(e,t)=>{const r=m.getSheetCommandTarget(this._univerInstanceService);if(!r)return!1;const{unitId:i,subUnitId:s}=r;if(!this._permissionService.composePermission([new m.WorkbookEditablePermission(i).id,new m.WorksheetEditPermission(i,s).id]).every(c=>c.value))return!1;if(!t)return!0;if(t.rangeType!==a.RANGE_TYPE.ROW&&t.rangeType!==a.RANGE_TYPE.COLUMN)return e;if(t.rangeType===a.RANGE_TYPE.ROW){for(let c=t.startRow;c<=t.endRow;c++)if(this._rangeProtectionCache.getRowPermissionInfo(i,s,c,[Q.Edit])===!1)return!1}else for(let c=t.startColumn;c<=t.endColumn;c++)if(this._rangeProtectionCache.getColPermissionInfo(i,s,c,[Q.Edit])===!1)return!1;return!0}}))}_initHeaderResizePermissionInterceptor(){this._headerResizeRenderController&&this.disposeWithMe(this._headerResizeRenderController.interceptor.intercept(this._headerResizeRenderController.interceptor.getInterceptPoints().HEADER_RESIZE_PERMISSION_CHECK,{handler:(o,e)=>{var s,l,c,d;const t=m.getSheetCommandTarget(this._univerInstanceService);if(!t)return!1;const{unitId:r,subUnitId:i}=t;if(e.row){if(((l=(s=this._permissionService.getPermissionPoint(new m.WorksheetSetRowStylePermission(r,i).id))==null?void 0:s.value)!=null?l:!1)===!1)return!1}else if(e.col&&((d=(c=this._permissionService.getPermissionPoint(new m.WorksheetSetColumnStylePermission(r,i).id))==null?void 0:c.value)!=null?d:!1)===!1)return!1;return!0}}))}_initRangeFillPermissionInterceptor(){this.disposeWithMe(this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_FILL_PERMISSION_CHECK,{handler:(o,e)=>{var p,f,v;const t=m.getSheetCommandTarget(this._univerInstanceService);if(!t)return!1;const{worksheet:r,unitId:i,subUnitId:s}=t;if(!this._permissionService.composePermission([new m.WorkbookEditablePermission(i).id,new m.WorksheetEditPermission(i,s).id,new m.WorksheetSetCellValuePermission(i,s).id,new m.WorksheetSetCellStylePermission(i,s).id]).every(C=>C.value))return!1;const c=(p=this._selectionManagerService.getCurrentSelections())==null?void 0:p.map(C=>C.range),d=c==null?void 0:c.find(C=>{const _=er(e.x,e.y,e.scene,e.skeleton),R=e.skeleton.getCellWithCoordByIndex(C.endRow,C.endColumn),w=Math.abs(R.endX-_.x),P=Math.abs(R.endY-_.y);return w<=5&&P<=5});if(!d)return!0;const{startRow:u,endRow:h,startColumn:g,endColumn:S}=d;for(let C=u;C<=h;C++)for(let _=g;_<=S;_++){const R=(v=(f=r.getCell(C,_))==null?void 0:f.selectionProtection)==null?void 0:v[0];if((R==null?void 0:R[Q.Edit])===!1||(R==null?void 0:R[Q.View])===!1)return!1}return!0}}))}_initRangeMovePermissionInterceptor(){this.disposeWithMe(this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_MOVE_PERMISSION_CHECK,{handler:(o,e)=>{var g;const t=m.getSheetCommandTarget(this._univerInstanceService);if(!t)return!1;const{worksheet:r,unitId:i,subUnitId:s}=t;if(!this._permissionService.composePermission([new m.WorkbookEditablePermission(i).id,new m.WorksheetEditPermission(i,s).id]).every(S=>S.value))return!1;const c=(g=this._selectionManagerService.getCurrentSelections())==null?void 0:g.map(S=>S.range),d=this._rangeProtectionRuleModel.getSubunitRuleList(i,s).reduce((S,p)=>[...S,...p.ranges],[]),u=c==null?void 0:c.filter(S=>d.some(p=>a.Rectangle.intersects(p,S)));return!(u==null?void 0:u.some(S=>{var _,R;const{startRow:p,startColumn:f,endRow:v,endColumn:C}=S;for(let w=p;w<=v;w++)for(let P=f;P<=C;P++){const y=(R=(_=r.getCell(w,P))==null?void 0:_.selectionProtection)==null?void 0:R[0];if((y==null?void 0:y[Q.Edit])===!1)return!0}return!1}))}}))}_initFreezePermissionInterceptor(){this.disposeWithMe(this._headerFreezeRenderController.interceptor.intercept(this._headerFreezeRenderController.interceptor.getInterceptPoints().FREEZE_PERMISSION_CHECK,{handler:(o,e)=>{var s,l;const t=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET);return!(t==null?void 0:t.getActiveSheet())||!t?!1:(l=(s=this._permissionService.getPermissionPoint(new m.WorkbookEditablePermission(t.getUnitId()).id))==null?void 0:s.value)!=null?l:!1}}))}};So=Up([Qe(1,a.IUniverInstanceService),Qe(2,a.IPermissionService),Qe(3,a.Inject(m.SheetsSelectionsService)),Qe(4,a.Inject(m.RangeProtectionRuleModel)),Qe(5,a.Inject(exports.HeaderMoveRenderController)),Qe(6,Ce),Qe(7,a.Inject(exports.HeaderFreezeRenderController)),Qe(8,a.Inject(m.RangeProtectionCache)),Qe(9,a.Optional(exports.HeaderResizeRenderController))],So);var Lp=Object.getOwnPropertyDescriptor,Bp=(n,o,e,t)=>{for(var r=t>1?void 0:t?Lp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Gn=(n,o)=>(e,t)=>o(e,t,n);const Fp="SHEET_PERMISSION_PASTE_PLUGIN";let Mn=class extends a.Disposable{constructor(o,e,t,r,i){super();E(this,"disposableCollection",new a.DisposableCollection);this._univerInstanceService=o,this._selectionManagerService=e,this._localService=t,this._sheetClipboardService=r,this._sheetPermissionCheckController=i,this._initClipboardHook()}_initClipboardHook(){this.disposeWithMe(this._sheetClipboardService.addClipboardHook({id:Fp,onBeforePaste:o=>{var g,S,p;const[e]=St([o.range]).ranges,t=(g=this._selectionManagerService.getCurrentLastSelection())==null?void 0:g.range;if(!t)return!1;const r={startRow:t.startRow+e.startRow,endRow:t.startRow+e.endRow,startColumn:t.startColumn+e.startColumn,endColumn:t.startColumn+e.endColumn},s=this._univerInstanceService.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet();if(!s)return!1;const{startRow:l,endRow:c,startColumn:d,endColumn:u}=r;let h=!0;for(let f=l;f<=c;f++)for(let v=d;v<=u;v++){const C=(p=(S=s.getCell(f,v))==null?void 0:S.selectionProtection)==null?void 0:p[0];if((C==null?void 0:C[Q.Edit])===!1){h=!1;break}}return h||this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localService.t("permission.dialog.pasteErr")),h}}))}};Mn=Bp([Gn(0,a.IUniverInstanceService),Gn(1,a.Inject(m.SheetsSelectionsService)),Gn(2,a.Inject(a.LocaleService)),Gn(3,a.Inject(ke)),Gn(4,a.Inject(m.SheetPermissionCheckController))],Mn);var jp=Object.getOwnPropertyDescriptor,zp=(n,o,e,t)=>{for(var r=t>1?void 0:t?jp(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},jr=(n,o)=>(e,t)=>o(e,t,n);let po=class extends a.RxDisposable{constructor(o,e,t,r,i){super();E(this,"disposableCollection",new a.DisposableCollection);this._context=o,this._univerInstanceService=e,this._permissionService=t,this._statusBarController=r,this._rangeProtectionCache=i,this._initStatusBarPermissionInterceptor()}_initStatusBarPermissionInterceptor(){this.disposeWithMe(this._statusBarController.interceptor.intercept(this._statusBarController.interceptor.getInterceptPoints().STATUS_BAR_PERMISSION_CORRECT,{priority:100,handler:(o,e)=>{var c;const t=m.getSheetCommandTarget(this._univerInstanceService);if(!t)return o!=null?o:[];const{worksheet:r,unitId:i,subUnitId:s}=t;return((c=this._permissionService.getPermissionPoint(new m.WorksheetViewPermission(i,s).id))==null?void 0:c.value)===!1?e.forEach(d=>{const u=d.getArrayValue();u.forEach((h,g)=>{h.forEach((S,p)=>{u[g][p]=G.NullValueObject.create()})})}):e.forEach(d=>{const u=d.getArrayValue(),h=d.getCurrentRow(),g=d.getCurrentColumn();u.forEach((S,p)=>{S.forEach((f,v)=>{var R;if(((R=r.getCellRaw(p+h,v+g))==null?void 0:R.v)===void 0)return;const _=this._rangeProtectionCache.getCellInfo(i,s,p+h,v+g);(_==null?void 0:_[Q.View])===!1&&(u[p][v]=G.NullValueObject.create())})})}),e}}))}};po=zp([jr(1,a.IUniverInstanceService),jr(2,a.IPermissionService),jr(3,a.Inject(exports.StatusBarController)),jr(4,a.Inject(m.RangeProtectionCache))],po);const Gc=(n,o,e,t,r)=>{const i=n.get(a.LocaleService),s=n.get(m.WorksheetProtectionRuleModel),l=n.get(m.RangeProtectionRuleModel);let c="";if(o.length===0)c=i.t("permission.panel.emptyRangeError");else if(o.length>1){let d=!1;for(let u=0;u<o.length;u++){for(let h=u+1;h<o.length;h++)if(a.Rectangle.intersects(o[u],o[h])){d=!0;break}if(d)break}d&&(c=i.t("permission.panel.rangeOverlapError"))}if(!c){if(s.getRule(t,r)&&!e)return c=i.t("permission.panel.rangeOverlapOverPermissionError"),c;const u=l.getSubunitRuleList(t,r).filter(g=>g.permissionId!==e).find(g=>g.ranges.some(S=>o.some(p=>a.Rectangle.intersects(S,p))));(u==null?void 0:u.ranges.find(g=>o.some(S=>a.Rectangle.intersects(g,S))))&&(c=i.t("permission.panel.rangeOverlapOverPermissionError"))}return c===""?void 0:c},Xp=(n,o)=>{if(n.length!==1)return!1;const e=n[0],t=o.getRowCount(),r=o.getColumnCount(),{startRow:i,endRow:s,startColumn:l,endColumn:c}=e;return i===0&&l===0&&s===t-1&&c===r-1},Yp=(n,o)=>{var c,d;const e=n.get(a.IUniverInstanceService),t=n.get(m.SheetsSelectionsService),r=e.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),i=r.getActiveSheet();let s=m.UnitObject.SelectRange,l=(d=(c=t.getCurrentSelections())==null?void 0:c.map(u=>u.range))!=null?d:[];return o&&(s=m.UnitObject.Worksheet,l=[{startRow:0,startColumn:0,endRow:i.getRowCount()-1,endColumn:i.getColumnCount()-1,rangeType:a.RANGE_TYPE.ALL}]),{unitId:r.getUnitId(),subUnitId:i.getSheetId(),permissionId:"",unitType:s,description:"",id:"",ranges:l,editState:m.EditStateEnum.OnlyMe,viewState:m.ViewStateEnum.OthersCanView}},Zp=(n,o)=>{const r=n.get(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET).getActiveSheet(),{unitType:i}=o;return i===m.UnitObject.Worksheet?{...o,ranges:[{startRow:0,startColumn:0,endRow:r.getRowCount()-1,endColumn:r.getColumnCount()-1,rangeType:a.RANGE_TYPE.ALL}]}:o},Gp=n=>{const{viewState:o,editState:e,permissionId:t,ranges:r,rangesErrMsg:i,desc:s,oldRule:l,id:c}=n,d=I.useDependency(Vt),u=I.useDependency(I.ISidebarService),h=I.useDependency(a.IAuthzIoService),g=I.useDependency(a.LocaleService),S=I.useDependency(a.ICommandService),p=I.useDependency(ft),v=I.useDependency(a.IUniverInstanceService).getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),C=v==null?void 0:v.getActiveSheet();if(!v||!C)return null;const _=v.getUnitId(),R=C.getSheetId();return b.jsxs("div",{className:"univer-mt-auto univer-flex univer-flex-row-reverse univer-gap-2 univer-py-5",children:[b.jsx(F.Button,{variant:"primary",onClick:async()=>{if(i)return;const w={unitId:_,subUnitId:R,permissionId:t,id:c,viewState:o,editState:e,unitType:m.UnitObject.SelectRange,ranges:r,description:s};Xp(r,C)&&(w.unitType=m.UnitObject.Worksheet,w.ranges=[]);let y=p.selectUserList;w.editState===m.EditStateEnum.OnlyMe&&(y=[],p.setSelectUserList([]));const M={read:w.viewState===m.ViewStateEnum.OthersCanView?Be.AllCollaborator:Be.SomeCollaborator,edit:w.editState===m.EditStateEnum.DesignedUserCanEdit?Be.SomeCollaborator:Be.OneSelf};if(w.editState===m.EditStateEnum.DesignedUserCanEdit&&y.length===0&&(y=[],M.edit=Be.OneSelf),w.permissionId){const A=eh(y.filter(k=>k.role===Pe.Editor),p.oldCollaboratorList.filter(k=>k.role===Pe.Editor)),D=(l==null?void 0:l.viewState)===w.viewState,N=(l==null?void 0:l.editState)===w.editState,V=w.unitType===(l==null?void 0:l.unitType)&&w.description===l.description&&w.ranges===l.ranges,H=!A||!D||!N;if(V&&H)await h.update({objectType:w.unitType,objectID:w.permissionId,unitID:w.unitId,share:void 0,name:"",strategies:[],scope:M,collaborators:{collaborators:y}});else{let k=w.permissionId;H&&(w.unitType===m.UnitObject.Worksheet?k=await h.create({worksheetObject:{collaborators:y,unitID:w.unitId,name:"",strategies:[{role:Pe.Editor,action:Q.Edit},{role:Pe.Reader,action:Q.View}],scope:M},objectType:m.UnitObject.Worksheet}):k=await h.create({selectRangeObject:{collaborators:y,unitID:w.unitId,name:"",scope:M},objectType:m.UnitObject.SelectRange})),S.executeCommand(m.SetProtectionCommand.id,{rule:{...w,permissionId:k},oldRule:l})}}else if(w.unitType===m.UnitObject.Worksheet){const A=await h.create({worksheetObject:{collaborators:y,unitID:w.unitId,name:"",strategies:[{role:Pe.Editor,action:Q.Edit},{role:Pe.Reader,action:Q.View}],scope:M},objectType:m.UnitObject.Worksheet}),{ranges:D=[],...N}=w;N.permissionId=A,S.executeCommand(m.AddWorksheetProtectionCommand.id,{rule:N,unitId:w.unitId})}else if(w.unitType===m.UnitObject.SelectRange){const A=await h.create({selectRangeObject:{collaborators:y,unitID:w.unitId,name:"",scope:M},objectType:m.UnitObject.SelectRange});S.executeCommand(m.AddRangeProtectionCommand.id,{rule:w,permissionId:A})}const x={header:{title:`${g.t("permission.panel.title")}`},children:{label:or,showDetail:!1},width:330};u.open(x)},children:g.t("permission.button.confirm")}),b.jsx(F.Button,{onClick:()=>{d.reset(),p.reset(),u.close()},children:g.t("permission.button.cancel")})]})},Kp=n=>{const{ranges:o,onRangesChange:e,desc:t,onDescChange:r,rangesErrMsg:i,permissionId:s}=n,l=I.useDependency(I.ComponentManager),c=W.useMemo(()=>l.get(ji),[]),d=I.useDependency(a.IUniverInstanceService),u=I.useDependency(a.LocaleService),h=I.useDependency(a.Injector),g=d.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),S=g==null?void 0:g.getActiveSheet();if(!g||!S)return null;const p=g.getUnitId(),f=S.getSheetId(),v=C=>{const _=C.split(",").map(G.deserializeRangeWithSheet).map(A=>A.range);if(_.some(A=>!a.isValidRange(A)||A.endColumn<A.startColumn||A.endRow<A.startRow))return;const R=d.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),w=R==null?void 0:R.getActiveSheet();if(!R||!w)return;const P=R.getUnitId(),y=w.getSheetId(),M=_.map(A=>{const D=w.getRowCount(),N=w.getColumnCount();return m.setEndForRange(A,D,N),A}),x=Gc(h,M,s,P,y);e(M,x)};return b.jsxs(b.Fragment,{children:[b.jsx(F.FormLayout,{className:"univer-font-medium",label:u.t("permission.panel.protectedRange"),error:i,children:c&&b.jsx(c,{unitId:p,subUnitId:f,initialValue:o==null?void 0:o.map(C=>G.serializeRange(C)).join(","),onChange:(C,_)=>v(_)})}),b.jsx(F.FormLayout,{className:"univer-font-medium",label:u.t("permission.panel.permissionDirection"),children:b.jsx(F.Input,{value:t,onChange:C=>r(C),placeholder:u.t("permission.panel.permissionDirectionPlaceholder")})})]})},Kc="data:image/png;base64,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",qp=n=>{const{editState:o,onEditStateChange:e,viewState:t,onViewStateChange:r,permissionId:i}=n,s=I.useDependency(a.LocaleService),l=I.useDependency(I.IDialogService),c=I.useDependency(a.IAuthzIoService),d=I.useDependency(ft),u=I.useDependency(a.UserManagerService),h=I.useDependency(a.IUniverInstanceService),g=I.useObservable(d.selectUserList$,d.selectUserList),S=h.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),p=S==null?void 0:S.getActiveSheet();if(!S||!p)return null;const f=S.getUnitId(),v=async()=>{const C=await c.listCollaborators({objectID:f,unitID:f}),_=u.getCurrentUser();d.setCanEditUserList(C.filter(R=>{var w;return((w=R.subject)==null?void 0:w.userID)!==_.userID})),l.open({id:no,title:{title:""},children:{label:Ga},width:280,destroyOnClose:!0,closable:!1,onClose:()=>l.close(no),className:"sheet-permission-user-dialog"})};return W.useEffect(()=>{i?(async()=>{const R=(await c.listCollaborators({objectID:i,unitID:f})).filter(w=>w.role===Pe.Editor);R.length>0&&e(m.EditStateEnum.DesignedUserCanEdit),d.setSelectUserList(R),d.setOldCollaboratorList(R)})():(d.setSelectUserList([]),d.setOldCollaboratorList([]))},[]),b.jsxs(b.Fragment,{children:[b.jsx(F.FormLayout,{className:"univer-font-medium",label:s.t("permission.panel.editPermission"),children:b.jsxs(F.RadioGroup,{value:o,onChange:C=>e(C),className:"univer-flex univer-flex-col",children:[b.jsx(F.Radio,{value:m.EditStateEnum.OnlyMe,children:b.jsx("span",{children:s.t("permission.panel.onlyICanEdit")})}),b.jsx(F.Radio,{value:m.EditStateEnum.DesignedUserCanEdit,children:b.jsx("span",{children:s.t("permission.panel.designedUserCanEdit")})})]})}),o===m.EditStateEnum.DesignedUserCanEdit&&b.jsxs("div",{className:F.clsx("univer-mb-2 univer-flex univer-h-[270px] univer-flex-col univer-overflow-y-auto univer-rounded-lg univer-p-3",F.borderClassName),children:[b.jsxs("div",{className:"univer-flex univer-items-center univer-justify-between univer-text-sm",children:[b.jsx("span",{children:s.t("permission.panel.designedPerson")}),b.jsx("span",{className:"univer-cursor-pointer univer-text-primary-600",onClick:v,children:s.t("permission.panel.addPerson")})]}),b.jsx("div",{className:"univer-my-2 univer-h-px univer-bg-gray-200"}),b.jsx("div",{className:"univer-flex-1",children:(g==null?void 0:g.length)>0?g.map(C=>{var _,R,w;return b.jsxs("div",{className:"univer-mb-3 univer-flex univer-h-7 univer-items-center univer-leading-7 last:univer-mb-0",children:[b.jsx(F.Avatar,{size:24,src:(_=C.subject)==null?void 0:_.avatar}),b.jsx("span",{className:"univer-ml-1.5 univer-w-[130px] univer-truncate univer-text-gray-900 dark:!univer-text-white",children:(R=C.subject)==null?void 0:R.name}),b.jsx(F.Select,{className:"!univer-w-[90px] univer-min-w-0 univer-cursor-pointer",borderless:!0,value:"edit",options:[{label:`${s.t("permission.panel.canEdit")}`,value:"edit"},{label:`${s.t("permission.panel.delete")}`,value:"delete"}],onChange:P=>{P==="delete"&&d.setSelectUserList(g.filter(y=>{var M,x;return((M=y.subject)==null?void 0:M.userID)!==((x=C.subject)==null?void 0:x.userID)}))}})]},(w=C.subject)==null?void 0:w.userID)}):b.jsxs("div",{className:"univer-flex univer-h-full univer-flex-col univer-items-center univer-justify-center",children:[b.jsx("img",{width:240,height:120,src:Kc,alt:""}),b.jsx("p",{className:"univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",children:s.t("permission.dialog.userEmpty")})]})})]}),b.jsx(F.FormLayout,{className:"univer-font-medium",label:s.t("permission.panel.viewPermission"),children:b.jsxs(F.RadioGroup,{value:t,onChange:C=>r(C),className:"univer-flex univer-flex-col last:univer-mb-0",children:[b.jsx(F.Radio,{value:m.ViewStateEnum.OthersCanView,children:b.jsx("span",{children:s.t("permission.panel.othersCanView")})}),b.jsx(F.Radio,{value:m.ViewStateEnum.NoOneElseCanView,children:b.jsx("span",{children:s.t("permission.panel.noOneElseCanView")})})]})})]})},Qp=n=>{var R,w;const{fromSheetBar:o,rule:e,oldRule:t}=n,r=I.useDependency(a.Injector),i=I.useDependency(I.ComponentManager),s=e?Zp(r,e):Yp(r,o),[l,c]=W.useState(s.ranges),[d,u]=W.useState(()=>Gc(r,s.ranges,s.permissionId,s.unitId,s.subUnitId)),[h,g]=W.useState(s.description),[S,p]=W.useState((R=s.editState)!=null?R:m.EditStateEnum.OnlyMe),[f,v]=W.useState((w=s.viewState)!=null?w:m.ViewStateEnum.OthersCanView),C=i.get(fr),_=C!=null?C:qp;return W.useEffect(()=>{const P=r.get(a.IUniverInstanceService),y=r.get(I.ISidebarService),M=P.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET);if(!M)return;const x=M.getActiveSheet().getSheetId(),A=M.activeSheet$.subscribe(D=>{(D==null?void 0:D.getSheetId())!==x&&y.close()});return()=>{A.unsubscribe()}},[]),b.jsxs("div",{className:"univer-mt-4 univer-flex univer-h-[calc(100%-16px)] univer-flex-col",children:[b.jsx(Kp,{permissionId:s.permissionId,ranges:l,onRangesChange:(P,y)=>{c(P),u(y)},rangesErrMsg:d,desc:h,onDescChange:P=>g(P)}),b.jsx(_,{editState:S,onEditStateChange:P=>p(P),viewState:f,onViewStateChange:P=>v(P),permissionId:s.permissionId}),b.jsx(Gp,{permissionId:s.permissionId,id:s.id,ranges:l,rangesErrMsg:d,desc:h,viewState:f,editState:S,oldRule:t})]})},Jp="data:image/png;base64,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";function $p(){var H;const[n,o]=W.useState(!0),[e,t]=W.useState(!1),[r,i]=W.useState([]),s=I.useDependency(a.LocaleService),l=I.useDependency(m.RangeProtectionRuleModel),c=I.useDependency(m.WorksheetProtectionRuleModel),d=I.useDependency(a.IUniverInstanceService),u=I.useDependency(a.ICommandService),h=I.useDependency(I.ISidebarService),g=I.useDependency(a.IAuthzIoService),S=I.useDependency(a.IPermissionService),f=I.useDependency(a.UserManagerService).getCurrentUser(),v=I.useDependency(ft),C=I.useObservable(c.ruleRefresh$,""),_=I.useObservable(l.ruleRefresh$,""),R=d.getCurrentUnitOfType(a.UniverInstanceType.UNIVER_SHEET);if(!R)return null;const w=R.getUnitId(),P=W.useCallback(async k=>{var Z;const U=R.getActiveSheet(),L=R.getUnitId(),j=U.getSheetId(),B=[],z=[];R.getSheets().forEach(Y=>{const q=Y.getSheetId();l.getSubunitRuleList(L,q).forEach(ne=>{ne.permissionId&&B.push(ne.permissionId)});const ce=c.getRule(L,q);ce!=null&&ce.permissionId&&z.push(ce.permissionId)});const X=[...B,...z],K=await g.list({objectIDs:X,unitID:L,actions:m.baseProtectionActions}),ie=l.getSubunitRuleList(L,j).map(Y=>Y.permissionId),re=(Z=c.getRule(L,j))==null?void 0:Z.permissionId;re&&ie.push(re);const le=K.filter(Y=>{var q;return ie.includes(Y.objectID)||Y.objectID===((q=c.getRule(L,j))==null?void 0:q.permissionId)});return k?le:K},[]),[y,M]=W.useState([]);W.useEffect(()=>{const k=O.merge(l.ruleChange$,c.ruleChange$).subscribe(async()=>{const U=await P(n);M(U)});return()=>{k.unsubscribe()}},[n]),W.useEffect(()=>{const k=R.activeSheet$.pipe(O.distinctUntilChanged((U,L)=>(U==null?void 0:U.getSheetId())===(L==null?void 0:L.getSheetId()))).subscribe(async()=>{const U=await P(n);M(U)});return()=>{k.unsubscribe()}},[n]),W.useEffect(()=>{(async()=>{if(C||_){const U=await P(!0);M(U)}})()},[C,_]);function x(k){const{unitId:U,subUnitId:L,unitType:j}=k;let B;j===tt.Worksheet?B=u.executeCommand(m.DeleteWorksheetProtectionCommand.id,{unitId:U,subUnitId:L,rule:k}):j===tt.SelectRange&&(B=u.executeCommand(m.DeleteRangeProtectionCommand.id,{unitId:U,subUnitId:L,rule:k})),B&&(t(!e),k.ranges===r&&i([]))}W.useEffect(()=>{v.reset()},[]),Fc(r);const A=W.useMemo(()=>{const k=new Map;return R.getSheets().forEach(U=>{const L=U.getSheetId();l.getSubunitRuleList(w,L).forEach(z=>{k.set(z.permissionId,z)});const B=c.getRule(w,L);B&&k.set(B==null?void 0:B.permissionId,B)}),k},[w,R,l,c]),D=k=>{k.subUnitId!==R.getActiveSheet().getSheetId()&&u.executeCommand(m.SetWorksheetActiveOperation.id,{unitId:k.unitId,subUnitId:k.subUnitId});const U={header:{title:"permission.panel.title"},children:{label:or,showDetail:!0,rule:a.Tools.deepClone(k),oldRule:a.Tools.deepClone(k)},width:330};h.open(U)},N=k=>{o(k)},V=(H=S.getPermissionPoint(new m.WorkbookCreateProtectPermission(w).id))==null?void 0:H.value;return b.jsxs("div",{className:"univer-mt-2 univer-flex univer-h-[calc(100%-8px)] univer-flex-col",children:[b.jsxs("div",{className:"univer-flex univer-h-[30px] univer-py-2",children:[b.jsxs("div",{className:"univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center",onClick:()=>N(!0),children:[b.jsxs("div",{className:F.clsx("univer-h-6 univer-text-base univer-font-medium univer-leading-6",{"univer-text-blue-500":n}),children:[" ",s.t("permission.panel.currentSheet")]}),b.jsx("div",{className:F.clsx("univer-mt-1 univer-h-0.5 univer-w-6",{"univer-bg-blue-500":n})})]}),b.jsxs("div",{className:"univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center",onClick:()=>N(!1),children:[b.jsx("div",{className:F.clsx("univer-h-6 univer-text-base univer-font-medium univer-leading-6",{"univer-text-blue-500":!n}),children:s.t("permission.panel.allSheet")}),b.jsx("div",{className:F.clsx("univer-mt-1 univer-h-0.5 univer-w-6",{"univer-bg-blue-500":!n})})]})]}),(y==null?void 0:y.length)>0?b.jsx("div",{children:y==null?void 0:y.map(k=>{var q,te,ce,ne,oe;const U=A.get(k.objectID);if(!U)return null;const L=k.actions.find($=>$.action===Q.Edit),j=L==null?void 0:L.allowed,B=k.actions.find($=>$.action===Q.View),z=B==null?void 0:B.allowed,X=k.actions.find($=>$.action===Q.ManageCollaborator),K=k.actions.find($=>$.action===Q.Delete),ie=(X==null?void 0:X.allowed)||f.userID===((q=k.creator)==null?void 0:q.userID),re=(K==null?void 0:K.allowed)||f.userID===((te=k.creator)==null?void 0:te.userID);let le="";const Z=R.getSheetBySheetId(U.subUnitId),Y=Z==null?void 0:Z.getName();if(U.unitType===tt.SelectRange){const $=U.ranges,me=$!=null&&$.length?$.map(pe=>{const be=G.serializeRange(pe);return be==="NaN"?"":be}).filter(pe=>!!pe).join(","):"";le=`${Y}(${me})`}else U.unitType===tt.Worksheet&&(le=Y||"");return b.jsxs("div",{className:F.clsx("univer-mt-3 univer-rounded-lg univer-p-3 hover:univer-bg-gray-50",F.borderClassName),onMouseMove:()=>{const{subUnitId:$,unitType:me}=U,pe=R.getActiveSheet();if(!pe)return!1;const be=pe.getSheetId();if($!==be)return!1;if(me===tt.SelectRange){const Re=U.ranges||[];Re!==r&&i(Re)}else if(me===tt.Worksheet){const Re=[{startRow:0,endRow:pe.getRowCount()-1,startColumn:0,endColumn:pe.getColumnCount()-1}];Re!==r&&i(Re)}},onMouseLeave:()=>i([]),children:[b.jsxs("div",{className:"univer-flex univer-h-5 univer-justify-between univer-leading-5",children:[b.jsx(F.Tooltip,{title:le,children:b.jsx("div",{className:"univer-max-w-[200px] univer-truncate univer-text-sm univer-font-medium",children:le})}),(ie||re)&&b.jsxs("div",{className:"univer-flex univer-items-center",children:[ie&&b.jsx(F.Tooltip,{title:s.t("permission.panel.edit"),children:b.jsx("div",{className:"univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",onClick:()=>D(U),children:b.jsx(us,{})})}),re&&b.jsx(F.Tooltip,{title:s.t("permission.panel.delete"),children:b.jsx("div",{className:"univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",onClick:()=>x(U),children:b.jsx(Vo,{})})})]})]}),b.jsx("div",{className:"univer-my-2 univer-h-px univer-bg-gray-200"}),b.jsxs("div",{children:[b.jsxs("div",{className:"univer-flex univer-items-center",children:[b.jsx(F.Tooltip,{title:(ne=(ce=k.creator)==null?void 0:ce.name)!=null?ne:"",children:b.jsx("div",{children:b.jsx(F.Avatar,{src:(oe=k.creator)==null?void 0:oe.avatar,className:"univer-mr-1.5",size:24})})}),b.jsx("span",{className:"univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:s.t("permission.panel.created")}),b.jsx("span",{className:"univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:j?`${s.t("permission.panel.iCanEdit")}`:`${s.t("permission.panel.iCanNotEdit")}`})]}),b.jsxs("div",{className:"univer-mt-2 univer-flex univer-items-center",children:[b.jsx("span",{className:"univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:s.t("permission.panel.viewPermission")}),b.jsx("span",{className:"univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",children:z?`${s.t("permission.panel.iCanView")}`:`${s.t("permission.panel.iCanNotView")}`})]}),U.description&&b.jsx(F.Tooltip,{title:U.description,children:b.jsx("div",{className:"univer-text-3 univer-mt-2 univer-max-w-64 univer-truncate univer-text-sm univer-text-gray-400",children:U.description})})]})]},k.objectID)})}):b.jsxs("div",{className:"univer-flex univer-flex-1 univer-flex-col univer-items-center univer-justify-center",children:[b.jsx("img",{width:240,height:120,src:Jp,alt:"",draggable:!1}),b.jsx("p",{className:"univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",children:s.t("permission.dialog.listEmpty")})]}),V&&b.jsx("div",{className:"univer-mt-auto univer-py-5",children:b.jsxs(F.Button,{className:"univer-w-full",variant:"primary",onClick:()=>{const k={header:{title:`${s.t("permission.panel.title")}`},children:{label:or,showDetail:!0},width:330};h.open(k)},children:[b.jsx("div",{children:"+ "}),s.t("permission.button.addNewPermission")]})})]})}const ef=({showDetail:n,fromSheetBar:o,rule:e,oldRule:t})=>{var h;const r=I.useDependency(a.IUniverInstanceService),i=I.useDependency(m.SheetsSelectionsService);if(!I.useDependency(Vt).getVisible())return null;const l=m.getSheetCommandTarget(r);if(!l)return null;const{worksheet:c}=l,u=((h=i.getCurrentSelections())==null?void 0:h.map(g=>g.range)).reduce((g,S)=>g+G.serializeRangeWithSheet(c.getName(),S),"");return n?b.jsx(Qp,{fromSheetBar:o,rule:e,oldRule:t},o?"sheet-bar":"normal"):b.jsx($p,{},u)},tf=({loading:n,children:o})=>b.jsxs("div",{className:"univer-relative univer-h-full univer-w-full",children:[n&&b.jsx("div",{className:"univer-absolute -univer-bottom-0.5 -univer-left-0.5 -univer-right-0.5 -univer-top-0.5 univer-z-10 univer-flex univer-items-center univer-justify-center univer-bg-white univer-backdrop-blur dark:!univer-bg-black",children:b.jsx("div",{className:"univer-size-10 univer-animate-spin univer-rounded-full univer-border-4 univer-border-solid univer-border-gray-100 univer-border-t-primary-500"})}),b.jsx("div",{className:n?"univer-pointer-events-none univer-blur-sm":"",children:o})]}),nf=()=>{const n=I.useDependency(a.LocaleService),o=I.useDependency(a.IUniverInstanceService),e=I.useDependency(a.IAuthzIoService),t=I.useDependency(m.WorksheetProtectionPointModel),r=I.useDependency(I.IDialogService),i=I.useDependency(a.IPermissionService),s=o.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),l=s.getActiveSheet();if(!l)throw new Error("No active sheet found");const[c,d]=W.useState([]),u=I.useDependency(a.ICommandService),[h,g]=W.useState(()=>!!t.getRule(s.getUnitId(),l.getSheetId())),[S,p]=W.useState(()=>Object.keys(Wr).reduce((v,C)=>(v[C]={text:n.t(`permission.panel.${Wr[Number(C)]}`),allowed:!0},v),{}));W.useEffect(()=>{(async()=>{const C=s.getUnitId(),_=await e.listCollaborators({objectID:C,unitID:C});d(_)})()},[]),W.useEffect(()=>{(async()=>{const C=s.getUnitId(),_=t.getRule(C,l.getSheetId());if(!_)return;g(!0);const w=(await e.list({unitID:s.getUnitId(),objectIDs:[_.permissionId],actions:xu}))[0].strategies.reduce((P,y)=>(Wr[y.action]&&(P[y.action]={text:n.t(`permission.panel.${Wr[y.action]}`),allowed:y.role!==Pe.Owner}),P),{});p(w),setTimeout(()=>{g(!1)},100)})()},[]);const f=async()=>{const v=o.getCurrentUnitForType(a.UniverInstanceType.UNIVER_SHEET),C=v==null?void 0:v.getActiveSheet();if(!C)throw new Error("No active sheet found");const _=v.getUnitId(),R=C.getSheetId(),w=t.getRule(_,R),P=Object.keys(S).map(M=>({action:Number(M),role:S[M].allowed?Pe.Editor:Pe.Owner}));let y=w==null?void 0:w.permissionId;y?e.update({objectType:tt.Worksheet,objectID:y,unitID:_,strategies:P,share:void 0,name:"",scope:{read:Be.AllCollaborator,edit:Be.AllCollaborator},collaborators:void 0}).then(()=>{m.getAllWorksheetPermissionPoint().forEach(M=>{const x=new M(_,R),A=x.subType,D=P.find(N=>N.action===A);D&&i.updatePermissionPoint(x.id,D.role===Pe.Editor)})}):(y=await e.create({objectType:tt.Worksheet,worksheetObject:{unitID:_,collaborators:c,name:"",strategies:P,scope:{read:Be.AllCollaborator,edit:Be.AllCollaborator}}}),u.executeCommand(m.SetWorksheetPermissionPointsCommand.id,{rule:{permissionId:y,unitId:_,subUnitId:R}}))};return b.jsx(tf,{loading:h,children:b.jsxs("div",{className:F.clsx("univer-flex univer-flex-col",F.borderTopClassName),children:[Object.keys(S).map(v=>{const C=S[v],{text:_,allowed:R}=C;return b.jsxs("div",{className:"univer-my-1.5 univer-flex univer-h-5 univer-items-center univer-justify-between univer-leading-5",children:[b.jsx("div",{children:_}),b.jsx(F.Switch,{defaultChecked:R,onChange:()=>{p({...S,[v]:{...C,allowed:!R}})}})]},_)}),b.jsxs("div",{className:F.clsx("univer-flex univer-h-9 univer-items-center univer-justify-end univer-gap-2 univer-pt-2",F.borderTopClassName),children:[b.jsx(F.Button,{onClick:()=>{r.close(ro)},children:n.t("permission.button.cancel")}),b.jsx(F.Button,{variant:"primary",onClick:()=>{f(),r.close(ro)},children:n.t("permission.button.confirm")})]})]})})},rf=()=>{var u;const[n,o]=W.useState(""),e=I.useDependency(a.LocaleService),t=I.useDependency(I.IDialogService),r=I.useDependency(ft),i=I.useObservable(r.userList$,r.userList),s=(u=i==null?void 0:i.filter(h=>{var g;return((g=h.subject)==null?void 0:g.name.toLocaleLowerCase().includes(n.toLocaleLowerCase()))&&h.role===Pe.Editor}))!=null?u:[],[l,c]=W.useState(r.selectUserList),d=h=>{if((l==null?void 0:l.findIndex(S=>{var p,f;return((p=S.subject)==null?void 0:p.userID)===((f=h.subject)==null?void 0:f.userID)}))===-1){const S={...h};c([...l,S])}else{const S=l.filter(p=>{var f,v;return((f=p.subject)==null?void 0:f.userID)!==((v=h.subject)==null?void 0:v.userID)});c(S)}};return b.jsxs("div",{children:[b.jsx("div",{children:b.jsx(F.Input,{className:"univer-w-full",placeholder:e.t("permission.dialog.search"),value:n,onChange:h=>o(h)})}),b.jsx("div",{className:F.clsx("univer-h-60 univer-overflow-y-auto",F.scrollbarClassName),children:(s==null?void 0:s.length)>0?s==null?void 0:s.map(h=>{var g,S,p;return b.jsxs("div",{className:"univer-my-2 univer-flex univer-items-center univer-rounded-md hover:univer-bg-gray-50",onClick:()=>d(h),children:[b.jsx(F.Avatar,{src:(g=h.subject)==null?void 0:g.avatar,size:24}),b.jsx("div",{className:"univer-ml-1.5 univer-flex-1",children:(S=h.subject)==null?void 0:S.name}),(l==null?void 0:l.findIndex(f=>{var v,C;return((v=f.subject)==null?void 0:v.userID)===((C=h.subject)==null?void 0:C.userID)}))!==-1&&b.jsx("div",{children:b.jsx(Yt,{})})]},(p=h.subject)==null?void 0:p.userID)}):b.jsxs("div",{className:"univer-flex univer-h-full univer-flex-col univer-items-center",children:[b.jsx("img",{className:"univer-w-full",src:Kc,alt:"empty list",draggable:!1}),b.jsx("p",{className:"univer-text-sm univer-text-gray-400",children:e.t("permission.dialog.userEmpty")})]})}),b.jsx("div",{className:"univer-h-px univer-w-full univer-bg-gray-200"}),b.jsxs("div",{className:"univer-flex univer-items-center univer-justify-end univer-gap-1 univer-py-2",children:[b.jsx(F.Button,{onClick:()=>t.close(no),children:e.t("permission.button.cancel")}),b.jsx(F.Button,{variant:"primary",onClick:()=>{r.setSelectUserList(l),t.close(no)},children:e.t("permission.button.confirm")})]})]})},of=({errorMsg:n})=>{const o=I.useDependency(a.LocaleService);return b.jsx("div",{children:b.jsx("p",{className:"univer-m-0",children:n||o.t("permission.dialog.alertContent")})})},qc="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNCIgaGVpZ2h0PSI0IiB2aWV3Qm94PSIwIDAgNCA0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8bWFzayBpZD0ibWFzazBfNzU5XzExMDgiIHN0eWxlPSJtYXNrLXR5cGU6YWxwaGEiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAiIHk9IjAiIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjRDZEOEQ5Ii8+CjwvbWFzaz4KPGcgbWFzaz0idXJsKCNtYXNrMF83NTlfMTEwOCkiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTS0zLjY0MDAyIDMuNDQxNDFMMi4wNzM5NyAtMi4yNzI1OEwyLjc4MTA4IC0xLjU2NTQ4TC0yLjkzMjkxIDQuMTQ4NTJMLTMuNjQwMDIgMy40NDE0MVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0tMS41MTg2OCA1LjU2Mjc1TDQuMTk1MzEgLTAuMTUxMjQ1TDQuOTAyNDIgMC41NTU4NjJMLTAuODExNTc1IDYuMjY5ODZMLTEuNTE4NjggNS41NjI3NVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wLjYwMjY1NiA3LjY4NDAzTDYuMzE2NjUgMS45NzAwM0w3LjAyMzc2IDIuNjc3MTRMMS4zMDk3NiA4LjM5MTEzTDAuNjAyNjU2IDcuNjg0MDNaIiBmaWxsPSIjRDZEOERCIi8+CjwvZz4KPC9zdmc+",bs="RANGE_PROTECTION_CAN_VIEW_RENDER_EXTENSION_KEY",Rs="RANGE_PROTECTION_CAN_NOT_VIEW_RENDER_EXTENSION_KEY",sf=25,af=80;class Qc extends T.SheetExtension{constructor(e){super();E(this,"_pattern",null);E(this,"_img",new Image);E(this,"renderCache",new Set);E(this,"_shadowStrategy","always");this._img.src=qc,e&&(this._shadowStrategy=e)}clearCache(){this.renderCache.clear()}setShadowStrategy(e){this._shadowStrategy=e,this.clearCache()}getShadowStrategy(){return this._shadowStrategy}draw(e,t,r){const{worksheet:i}=r;i&&(e.save(),this._pattern||(this._pattern=e.createPattern(this._img,"repeat")),this.renderCache.clear(),a.Range.foreach(r.rowColumnSegment,(s,l)=>{if(!i.getRowVisible(s)||!i.getColVisible(l))return;const{selectionProtection:c=[]}=i.getCell(s,l)||{};this._pattern&&(e.fillStyle=this._pattern,c.forEach(d=>{if(d.ruleId&&this.shouldRender(d)){if(this.renderCache.has(d.ruleId))return;this.renderCache.add(d.ruleId),d.ranges.forEach(u=>{const h=r.getCellWithCoordByIndex(u.startRow,u.startColumn,!1),g=r.getCellWithCoordByIndex(u.endRow,u.endColumn,!1);e.fillRect(h.startX,h.startY,g.endX-h.startX,g.endY-h.startY)})}}))}),e.restore())}}class lf extends Qc{constructor(e){super(e);E(this,"uKey",bs);E(this,"Z_INDEX",sf)}shouldRender(e){return this._shadowStrategy==="none"?!1:this._shadowStrategy==="non-editable"?(e==null?void 0:e[Q.View])!==!1&&(e==null?void 0:e[Q.Edit])===!1:this._shadowStrategy==="non-viewable"?(e==null?void 0:e[Q.View])===!1:(e==null?void 0:e[Q.View])!==!1}}class cf extends Qc{constructor(e){super(e);E(this,"uKey",Rs);E(this,"Z_INDEX",af)}shouldRender(e){return this._shadowStrategy==="none"?!1:(e==null?void 0:e[Q.View])===!1}}const ws="worksheet-protection",Ea=25,df=80;class uf extends T.SheetExtension{constructor(e){super();E(this,"uKey",ws);E(this,"Z_INDEX",Ea);E(this,"_pattern");E(this,"_img",new Image);E(this,"_shadowStrategy","always");this._img.src=qc,e&&(this._shadowStrategy=e)}draw(e,t,r){const{worksheet:i}=r;if(!i)return!1;e.save(),this._pattern||(this._pattern=e.createPattern(this._img,"repeat"));const{startRow:s,startColumn:l,endRow:c,endColumn:d}=r.rowColumnSegment,u=r.getCellWithCoordByIndex(s,l,!1),h=r.getCellWithCoordByIndex(c,d,!1),{hasWorksheetRule:g=!1,selectionProtection:S=[]}=i.getCell(s,l)||{};if(!this._pattern)return;if(S.length>0){const f=S[0];(f==null?void 0:f[Q.View])?this.setZIndex(Ea):this.setZIndex(df)}e.fillStyle=this._pattern;let p=g;if(this._shadowStrategy==="none")p=!1;else if(g&&S.length>0){const f=S[0];this._shadowStrategy==="non-editable"?p=(f==null?void 0:f[Q.Edit])===!1:this._shadowStrategy==="non-viewable"&&(p=(f==null?void 0:f[Q.View])===!1)}p&&e.fillRect(u.startX,u.startY,h.endX-u.startX,h.endY-u.startY),e.restore()}setShadowStrategy(e){this._shadowStrategy=e}getShadowStrategy(){return this._shadowStrategy}setZIndex(e){this.Z_INDEX=e}}var hf=Object.getOwnPropertyDescriptor,Es=(n,o,e,t)=>{for(var r=t>1?void 0:t?hf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Fe=(n,o)=>(e,t)=>o(e,t,n);let Pn=class extends a.Disposable{constructor(n,o){super(),this._injector=n,this._componentManager=o,this._init()}_init(){this._initComponents(),this._initUiPartComponents()}_initComponents(){[[qa,ul],[Ou,Vo],[Au,us],[Du,Yt],[Qa,ds],[or,ef],[Ga,rf],[Ka,nf],[tc,of]].forEach(([n,o])=>{this.disposeWithMe(this._componentManager.register(n,o))})}_initUiPartComponents(){const o=this._injector.get(a.IConfigService).getConfig(Ee);if(o!=null&&o.protectedRangeUserSelector){const{component:e,framework:t}=o.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(fr,e,{framework:t}))}}};Pn=Es([Fe(0,a.Inject(a.Injector)),Fe(1,a.Inject(I.ComponentManager))],Pn);let fo=class extends a.Disposable{constructor(o,e,t,r,i){super();E(this,"_rangeProtectionCanViewRenderExtension");E(this,"_rangeProtectionCanNotViewRenderExtension");this._context=o,this._rangeProtectionRuleModel=e,this._sheetSkeletonManagerService=t,this._permissionService=r,this._configService=i;const s=this._configService.getConfig(Ee),l=as(s==null?void 0:s.protectedRangeShadow);this._rangeProtectionCanViewRenderExtension=new lf(l),this._rangeProtectionCanNotViewRenderExtension=new cf(l),this._initSkeleton(),this._initRender(),this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe(c=>{var d,u;((d=c.oldRule)!=null&&d.id&&this._rangeProtectionCanViewRenderExtension.renderCache.has(c.oldRule.id)||this._rangeProtectionCanViewRenderExtension.renderCache.has(c.rule.id))&&this._rangeProtectionCanViewRenderExtension.clearCache(),((u=c.oldRule)!=null&&u.id&&this._rangeProtectionCanNotViewRenderExtension.renderCache.has(c.oldRule.id)||this._rangeProtectionCanNotViewRenderExtension.renderCache.has(c.rule.id))&&this._rangeProtectionCanNotViewRenderExtension.clearCache()}))}_initRender(){const o=this._context.mainComponent;o&&(o.getExtensionByKey(bs)||o.register(this._rangeProtectionCanViewRenderExtension),o.getExtensionByKey(Rs)||o.register(this._rangeProtectionCanNotViewRenderExtension))}_initSkeleton(){const o=()=>{var e;this._sheetSkeletonManagerService.reCalculate(),(e=this._context.mainComponent)==null||e.makeDirty()};this.disposeWithMe(O.merge(this._permissionService.permissionPointUpdate$.pipe(O.throttleTime(300,void 0,{trailing:!0})),this._rangeProtectionRuleModel.rangeRuleInitStateChange$,this._rangeProtectionRuleModel.ruleChange$).pipe().subscribe(o))}};fo=Es([Fe(1,a.Inject(m.RangeProtectionRuleModel)),Fe(2,a.Inject(exports.SheetSkeletonManagerService)),Fe(3,a.IPermissionService),Fe(4,a.IConfigService)],fo);let vo=class extends a.Disposable{constructor(o,e,t,r,i){super();E(this,"_worksheetProtectionRenderExtension");this._context=o,this._renderManagerService=e,this._sheetSkeletonManagerService=t,this._worksheetProtectionRuleModel=r,this._configService=i;const s=this._configService.getConfig(Ee),l=as(s==null?void 0:s.protectedRangeShadow);this._worksheetProtectionRenderExtension=new uf(l),this._initSkeleton(),l!=="none"&&this._initRender()}_initRender(){const o=this._context.unitId,e=o&&this._renderManagerService.getRenderById(o),t=e&&e.mainComponent;t&&(t.getExtensionByKey(ws)||t.register(this._worksheetProtectionRenderExtension))}_initSkeleton(){const o=()=>{var e;this._sheetSkeletonManagerService.reCalculate(),(e=this._context.mainComponent)==null||e.makeDirty()};this.disposeWithMe(O.merge(this._worksheetProtectionRuleModel.worksheetRuleInitStateChange$).pipe().subscribe(o))}};vo=Es([Fe(1,a.Inject(T.IRenderManagerService)),Fe(2,a.Inject(exports.SheetSkeletonManagerService)),Fe(3,a.Inject(m.WorksheetProtectionRuleModel)),Fe(4,a.Inject(a.IConfigService))],vo);var mf=Object.getOwnPropertyDescriptor,gf=(n,o,e,t)=>{for(var r=t>1?void 0:t?mf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Ii=(n,o)=>(e,t)=>o(e,t,n);let Co=class extends a.Disposable{constructor(n,o,e,t){super(),this._context=n,this._sheetSkeletonManagerService=o,this._sheetClipboardService=e,this._sheetClipboardController=t,this._initialize()}_initialize(){this.disposeWithMe(a.toDisposable(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n=>{if(!(n!=null&&n.unitId)||!this._sheetClipboardService.getPasteMenuVisible())return;const o=this._sheetClipboardService.getPasteOptionsCache(),e=o==null?void 0:o.target.unitId;n.unitId===e&&this._sheetClipboardController.refreshOptionalPaste()})))}};Co=gf([Ii(1,a.Inject(exports.SheetSkeletonManagerService)),Ii(2,ke),Ii(3,a.Inject(Ut))],Co);var Sf=Object.getOwnPropertyDescriptor,pf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Sf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},_i=(n,o)=>(e,t)=>o(e,t,n);let Io=class extends a.Disposable{constructor(n,o,e,t){super(),this._context=n,this._formatPainterService=o,this._selectionRenderService=e,this._commandService=t,this._initialize()}_initialize(){this._bindFormatPainterStatus(),this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._selectionRenderService.selectionMoveEnd$.subscribe(n=>{var o;if(this._formatPainterService.getStatus()!==xe.OFF){const{rangeWithCoord:e}=n[n.length-1];this._commandService.executeCommand(wr.id,{unitId:this._context.unitId,subUnitId:((o=this._context.unit.getActiveSheet())==null?void 0:o.getSheetId())||"",range:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}),this._formatPainterService.getStatus()===xe.ONCE&&this._commandService.executeCommand(An.id)}}))}_bindFormatPainterStatus(){this.disposeWithMe(a.toDisposable(this._formatPainterService.status$.subscribe(n=>{const o=this._context.scene;o&&(n!==xe.OFF?o.setDefaultCursor(T.CURSOR_TYPE.CELL):o.setDefaultCursor(T.CURSOR_TYPE.DEFAULT))})))}};Io=pf([_i(1,Xe),_i(2,Ce),_i(3,a.ICommandService)],Io);var Wi=(n=>(n[n.NORMAL=0]="NORMAL",n[n.HIGHLIGHT=1]="HIGHLIGHT",n))(Wi||{});const ff="rgba(0, 0, 0, 0.15)",$e="rgb(0, 0, 0)",zr="rgb(255, 255, 255, 1)";class vf extends T.Shape{constructor(e,t){super(e,t);E(this,"_size",12);E(this,"_iconRatio",.4);E(this,"_mode",0);this.setShapeProps(t)}setShapeProps(e){e!=null&&e.size&&(this._size=e.size),e!=null&&e.mode&&(this._mode=e.mode),this.transformByState({width:this._size,height:this._size})}_draw(e){this._mode===1&&T.Rect.drawWith(e,{width:this._size,height:this._size,radius:this._size,fill:ff});const t=this._size*.5*this._iconRatio,r=Math.PI/180*60,i=t*Math.sin(r),s=t*Math.cos(r);T.RegularPolygon.drawWith(e,{pointsGroup:[[{x:-i+this._size/2,y:-s+this._size/2},{x:i+this._size/2,y:-s+this._size/2},{x:this._size/2,y:t+this._size/2}]],fill:$e})}}var Cf=Object.getOwnPropertyDescriptor,If=(n,o,e,t)=>{for(var r=t>1?void 0:t?Cf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Xr=(n,o)=>(e,t)=>o(e,t,n);const _f="__SpreadsheetHeaderMenuSHAPEControllerShape__",bf="__SpreadsheetHeaderMenuMAINControllerShape__",Rf="rgba(0, 0, 0, 0.1)";let _o=class extends a.Disposable{constructor(o,e,t,r,i){super();E(this,"_hoverRect");E(this,"_hoverMenu");E(this,"_currentColumn",Number.POSITIVE_INFINITY);E(this,"_headerPointerSubs");E(this,"_colHeaderPointerSubs");this._context=o,this._sheetSkeletonManagerService=e,this._contextMenuService=t,this._commandService=r,this._selectionManagerService=i,this._initialize()}dispose(){var o,e,t;(o=this._hoverRect)==null||o.dispose(),(e=this._hoverMenu)==null||e.dispose(),(t=this._headerPointerSubs)==null||t.unsubscribe(),this._headerPointerSubs=null}_initialize(){const o=this._context.scene;this._hoverRect=new T.Rect(_f,{fill:Rf,evented:!1}),this._hoverMenu=new vf(bf,{zIndex:100,visible:!1}),o.addObjects([this._hoverRect,this._hoverMenu],ht),this._initialHover(0),this._initialHover(1),this._initialHoverMenu()}_initialHover(o=0){var h,g,S;const e=this._context.components.get(ue.COLUMN),t=this._context.components.get(ue.ROW),r=o===0?t:e,i=p=>{var M,x,A;const f=(M=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:M.skeleton;if(f==null)return;const{rowHeaderWidth:v,columnHeaderHeight:C}=f,{startX:_,startY:R,endX:w,endY:P,column:y}=ze(p.offsetX,p.offsetY,this._context.scene,f);if(o===0)(x=this._hoverRect)==null||x.transformByState({width:v,height:P-R,left:0,top:R});else{if(this._currentColumn=y,(A=this._hoverRect)==null||A.transformByState({width:w-_,height:C,left:_,top:0}),this._hoverMenu==null)return;if(w-_<C*2){this._hoverMenu.hide();return}const D=C*.8;this._hoverMenu.transformByState({left:w-C,top:C/2-D/2}),this._hoverMenu.setShapeProps({size:D}),this._hoverMenu.show()}},s=()=>{var p;(p=this._hoverRect)==null||p.show()},l=()=>{var p,f;(p=this._hoverRect)==null||p.hide(),(f=this._hoverMenu)==null||f.hide()};this._headerPointerSubs=new O.Subscription;const c=r.onPointerMove$.subscribeEvent(i),d=r.onPointerEnter$.subscribeEvent(s),u=r.onPointerLeave$.subscribeEvent(l);(h=this._headerPointerSubs)==null||h.add(c),(g=this._headerPointerSubs)==null||g.add(d),(S=this._headerPointerSubs)==null||S.add(u)}_initialHoverMenu(){this._hoverMenu!=null&&(this._hoverMenu.onPointerEnter$.subscribeEvent(()=>{this._hoverMenu!=null&&(this._hoverMenu.setProps({mode:Wi.HIGHLIGHT,visible:!0}),this._context.scene.setCursor(T.CURSOR_TYPE.POINTER))}),this._hoverMenu.onPointerLeave$.subscribeEvent(()=>{this._hoverMenu!=null&&(this._hoverMenu.setProps({mode:Wi.NORMAL,visible:!1}),this._context.scene.resetCursor())}),this._hoverMenu.onPointerDown$.subscribeEvent(o=>{var i;const e=this._currentColumn,t=(i=this._selectionManagerService.getCurrentSelections())==null?void 0:i.map(s=>s.range);if(!!!(t!=null&&t.filter(s=>s.rangeType===a.RANGE_TYPE.COLUMN).find(s=>{const{startColumn:l,endColumn:c}=s;return e>=l&&e<=c}))){const s=this._getSelectionOnColumn(e);this._commandService.syncExecuteCommand(m.SetSelectionsOperation.id,s)}o.stopPropagation(),o.preventDefault(),this._contextMenuService.triggerContextMenu(o,I.ContextMenuPosition.COL_HEADER)}))}_getSelectionOnColumn(o){const e=this._context.unit,t=e.getActiveSheet();if(!t)throw new Error("No active worksheet");return{unitId:e.getUnitId(),subUnitId:t.getSheetId(),selections:[{range:{startRow:0,startColumn:o,endRow:t.getRowCount()-1,endColumn:o,rangeType:a.RANGE_TYPE.COLUMN},primary:{startRow:0,startColumn:o,endRow:0,endColumn:o,actualRow:0,actualColumn:o,isMerged:!1,isMergedMainCell:!1},style:null}]}}};_o=If([Xr(1,a.Inject(exports.SheetSkeletonManagerService)),Xr(2,I.IContextMenuService),Xr(3,a.ICommandService),Xr(4,a.Inject(m.SheetsSelectionsService))],_o);var Ui=(n=>(n[n.ROW=0]="ROW",n[n.COLUMN=1]="COLUMN",n))(Ui||{});const Jn=12,wf=.4;class Ta extends T.Shape{constructor(e,t,r){super(e,t);E(this,"_size",Jn);E(this,"_iconRatio",wf);E(this,"_hovered",!0);E(this,"_hasPrevious",!0);E(this,"_hasNext",!0);E(this,"_unhideType");t&&this.setShapeProps(t),this.onPointerEnter$.subscribeEvent(()=>this.setShapeProps({hovered:!0})),this.onPointerLeave$.subscribeEvent(()=>this.setShapeProps({hovered:!1})),this.onPointerDown$.subscribeEvent(()=>r==null?void 0:r())}setShapeProps(e){e.type!==void 0&&(this._unhideType=e.type),e.hovered!==void 0&&(this._hovered=e.hovered),e.hasPrevious!==void 0&&(this._hasPrevious=e.hasPrevious),e.hasNext!==void 0&&(this._hasNext=e.hasNext),this.transformByState({width:this._size*(this._unhideType===1?2:1),height:this._size*(this._unhideType===0?2:1)})}_draw(e){this._unhideType===0?this._drawOnRow(e):this._drawOnCol(e)}_drawOnRow(e){this._hovered&&(!this._hasNext||!this._hasPrevious?T.Rect.drawWith(e,{width:this._size,height:this._size,stroke:$e,fill:zr}):T.Rect.drawWith(e,{width:this._size,height:2*this._size,stroke:$e,fill:zr}));const t=this._size*.5*this._iconRatio,r=Math.PI/3,i=t*Math.cos(r),s=t*Math.sin(r);if(this._hasPrevious&&T.RegularPolygon.drawWith(e,{pointsGroup:[[{x:this._size/2,y:this._size/2-s},{x:this._size/2-s,y:this._size/2+i},{x:this._size/2+s,y:this._size/2+i}]],fill:$e}),this._hasNext){const l=this._hasPrevious?3:1;T.RegularPolygon.drawWith(e,{pointsGroup:[[{x:this._size/2,y:this._size*l/2+s},{x:this._size/2-s,y:this._size*l/2-i},{x:this._size/2+s,y:this._size*l/2-i}]],fill:$e})}}_drawOnCol(e){this._hovered&&(!this._hasNext||!this._hasPrevious?T.Rect.drawWith(e,{width:this._size,height:this._size,stroke:$e,fill:zr}):T.Rect.drawWith(e,{width:2*this._size,height:this._size,stroke:$e,fill:zr}));const t=this._size*.5*this._iconRatio,r=Math.PI/3,i=t*Math.cos(r),s=t*Math.sin(r);if(this._hasPrevious&&T.RegularPolygon.drawWith(e,{pointsGroup:[[{x:-i+this._size/2,y:this._size/2},{x:this._size/2+s,y:this._size/2-s},{x:this._size/2+s,y:this._size/2+s}]],fill:$e}),this._hasNext){const l=this._hasPrevious?3:1;T.RegularPolygon.drawWith(e,{pointsGroup:[[{x:i+this._size*l/2,y:this._size/2},{x:-s+this._size*l/2,y:this._size/2-s},{x:-s+this._size*l/2,y:this._size/2+s}]],fill:$e})}}}var Ef=Object.getOwnPropertyDescriptor,Tf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Ef(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},ya=(n,o)=>(e,t)=>o(e,t,n);const Ma="__SpreadsheetHeaderUnhideSHAPEControllerShape__";let bo=class extends a.RxDisposable{constructor(o,e,t){super();E(this,"_shapes",{cols:[],rows:[]});this._context=o,this._sheetSkeletonManagerService=e,this._commandService=t,this._init()}get _workbook(){return this._context.unit}dispose(){super.dispose(),this._clearShapes()}_init(){let o="";this._context.unit.activeSheet$.pipe(O.takeUntil(this.dispose$)).subscribe(e=>{if(this._clearShapes(),!e){o="";return}o=e.getSheetId(),this._update(this._workbook,e)}),this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{if(e){const{unitId:t,sheetId:r}=e;if(t===this._workbook.getUnitId()&&r===o){const i=this._workbook.getSheetBySheetId(r);i&&this._update(this._workbook,i)}}}))}_update(o,e){var g;const t=(g=this._sheetSkeletonManagerService.getSkeletonParam(e.getSheetId()))==null?void 0:g.skeleton;if(!t)return;const r=e.getHiddenRows(),i=e.getHiddenCols(),s=this._getSheetObject(),{scene:l}=s,c=e.getRowCount(),d=r.map(S=>{const{startRow:p,endRow:f}=S,v=xi(p,0,l,t),C=p!==0,_=f!==c-1;return new Ta(Ma,{type:Ui.ROW,hovered:!1,hasPrevious:C,hasNext:_,top:v.startY-(C?Jn:0),left:v.startX-Jn},()=>this._commandService.executeCommand(m.SetSpecificRowsVisibleCommand.id,{unitId:o.getUnitId(),subUnitId:e.getSheetId(),ranges:[S]}))}),u=e.getColumnCount(),h=i.map(S=>{const{startColumn:p,endColumn:f}=S,v=xi(0,p,l,t),C=p!==0,_=f!==u-1;return new Ta(Ma,{type:Ui.COLUMN,hovered:!1,hasPrevious:C,hasNext:_,top:20-Jn,left:v.startX-(C?Jn:0)},()=>this._commandService.executeCommand(m.SetSpecificColsVisibleCommand.id,{unitId:o.getUnitId(),subUnitId:e.getSheetId(),ranges:[S]}))});l.addObjects(h,Ps),l.addObjects(d,Ps),this._clearShapes(),this._shapes={cols:h,rows:d}}_clearShapes(){this._shapes.cols.forEach(o=>o.dispose()),this._shapes.rows.forEach(o=>o.dispose()),this._shapes={cols:[],rows:[]}}_getSheetObject(){return Ne(this._workbook,this._context)}};bo=Tf([ya(1,a.Inject(exports.SheetSkeletonManagerService)),ya(2,a.ICommandService)],bo);var yf=Object.getOwnPropertyDescriptor,Mf=(n,o,e,t)=>{for(var r=t>1?void 0:t?yf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},tn=(n,o)=>(e,t)=>o(e,t,n);const Pf=[Me.id,Ze.id];let Li=class extends a.Disposable{constructor(n,o,e,t,r,i,s){super(),this._context=n,this._sheetSkeletonManagerService=o,this._commandService=e,this._renderManagerService=t,this._selectionManagerService=r,this._scrollManagerService=i,this._univerInstanceService=s,this._init()}scrollToRange(n){let{endRow:o,endColumn:e,startColumn:t,startRow:r}=n;const i=this._getViewportBounding();if(n.rangeType===a.RANGE_TYPE.ROW?(t=0,e=0):n.rangeType===a.RANGE_TYPE.COLUMN&&(r=0,o=0),i){const s=i.startRow>o?r:o,l=i.startColumn>e?t:e;return this._scrollToCell(s,l)}else return this._scrollToCell(r,t)}_init(){this._initCommandListener(),this._initScrollEventListener(),this._initPointerScrollEvent(),this._initSkeletonListener()}_initCommandListener(){this.disposeWithMe(this._commandService.onCommandExecuted(n=>{if(Pf.includes(n.id))this._scrollToSelection();else if(n.id===m.ScrollToCellOperation.id){const o=n.params.range;this.scrollToRange(o)}else if(n.id===Oe.id){const o=n.params;this._scrollToSelectionForExpand(o)}}))}_scrollToSelectionForExpand(n){setTimeout(()=>{const o=this._selectionManagerService.getCurrentLastSelection();if(o==null)return;const{startRow:e,startColumn:t,endRow:r,endColumn:i}=o.range,s=this._getViewportBounding();if(s==null)return;const{startRow:l,startColumn:c,endRow:d,endColumn:u}=s;let h=0,g=0;e>l?h=r:r<d?h=e:h=l,t>c?g=i:i<u?g=t:g=c,n.direction===a.Direction.DOWN?h=r:n.direction===a.Direction.UP?h=e:n.direction===a.Direction.RIGHT?g=i:n.direction===a.Direction.LEFT&&(g=t),this._scrollToCell(h,g)},0)}_getFreeze(){var o;const n=(o=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:o.skeleton.getWorksheetConfig();if(n!=null)return n.freeze}_initScrollEventListener(){const{scene:n}=this._context;if(n==null)return;const o=n.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);o&&(this.disposeWithMe(a.toDisposable(this._scrollManagerService.rawScrollInfo$.subscribe(e=>{var g;if(e==null){o.scrollToViewportPos({viewportScrollX:0,viewportScrollY:0});return}const t=(g=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:g.skeleton;if(!t)return;const{sheetViewStartRow:r,sheetViewStartColumn:i,offsetX:s,offsetY:l}=e,{startX:c,startY:d}=t.getCellWithCoordByIndex(r,i,!1),u=c+s,h=d+l;o.scrollToViewportPos({viewportScrollX:u,viewportScrollY:h})}))),this.disposeWithMe(o.onScrollAfter$.subscribeEvent(e=>{var p;if(!e)return;const t=(p=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:p.skeleton;if(t==null)return;const r=this._getSheetObject();if(t==null||r==null)return;const{viewportScrollX:i,viewportScrollY:s,scrollX:l,scrollY:c}=e,{row:d,column:u,rowOffset:h,columnOffset:g}=t.getOffsetRelativeToRowCol(i,s),S={sheetViewStartRow:d,sheetViewStartColumn:u,offsetX:g,offsetY:h,viewportScrollX:i,viewportScrollY:s,scrollX:l,scrollY:c};this._scrollManagerService.setValidScrollStateToCurrSheet(S),this._scrollManagerService.validViewportScrollInfo$.next({...S,scrollX:l,scrollY:c,viewportScrollX:i,viewportScrollY:s})})),this.disposeWithMe(o.onScrollByBar$.subscribeEvent(e=>{var g;const t=(g=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:g.skeleton;if(t==null||e.isTrigger===!1)return;const r=this._getSheetObject();if(t==null||r==null)return;const{viewportScrollX:i=0,viewportScrollY:s=0}=e,l=this._getFreeze(),{row:c,column:d,rowOffset:u,columnOffset:h}=t.getOffsetRelativeToRowCol(i,s);this._commandService.executeCommand(Ue.id,{sheetViewStartRow:c+((l==null?void 0:l.ySplit)||0),sheetViewStartColumn:d+((l==null?void 0:l.xSplit)||0),offsetX:h,offsetY:u})})))}_initSkeletonListener(){this.disposeWithMe(a.toDisposable(this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe(n=>{if(n==null)return;const o={unitId:n.unitId,sheetId:n.sheetId};this._scrollManagerService.setSearchParam(o);const e=this._getSheetObject();if(!e)return;const r=e.scene.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),i=this._scrollManagerService.getScrollStateByParam(o),{viewportScrollX:s,viewportScrollY:l}=this._scrollManagerService.calcViewportScrollFromRowColOffset(i);r&&(i?(r.viewportScrollX=s,r.viewportScrollY=l):(r.viewportScrollX=0,r.viewportScrollY=0),this._updateSceneSize(n))})))}_initPointerScrollEvent(){const n=this._getSheetObject();if(!n)return;const o=this._scrollManagerService,e=n.scene,t=n.spreadsheet,r=e.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),i={x:0,y:0};let s=!1;const l={x:0,y:0},c=.95;let d=null;const u=()=>{if(!r)return;l.x*=c,l.y*=c,i.x+=l.x,i.y+=l.y;const g=l.x,S=l.y;(S!==0||g!==0)&&this._commandService.executeCommand(In.id,{offsetY:S,offsetX:g}),Math.abs(l.x)>1||Math.abs(l.y)>1?d=requestAnimationFrame(u):d=null},h=()=>{cancelAnimationFrame(d),d=null};t.onPointerDown$.subscribeEvent((g,S)=>{h(),r&&(i.x=g.offsetX,i.y=g.offsetY,s=!0,S.stopPropagation())}),t.onPointerMove$.subscribeEvent((g,S)=>{if(!s||!r)return;const p=g,f=-(p.offsetX-i.x),v=-(p.offsetY-i.y);l.x=-(p.offsetX-i.x),l.y=-(p.offsetY-i.y);const C=f,_=v;(f!==0||v!==0)&&(_!==0||C!==0)&&this._commandService.executeCommand(In.id,{offsetY:_,offsetX:C}),o.getCurrentScrollState(),i.x=p.offsetX,i.y=p.offsetY,S.stopPropagation()}),t.onPointerUp$.subscribeEvent(g=>{s=!1,d=requestAnimationFrame(u)}),t.onPointerLeave$.subscribeEvent(()=>{s=!1}),t.onPointerOut$.subscribeEvent(()=>{s=!1}),e.onPointerOut$.subscribeEvent(()=>{s=!1}),e.onPointerCancel$.subscribeEvent(()=>{s=!1})}_updateSceneSize(n){var h;if(n==null)return;const{unitId:o}=this._context,{skeleton:e}=n,t=(h=this._renderManagerService.getRenderById(o))==null?void 0:h.scene;if(e==null||t==null)return;const{rowTotalHeight:r,columnTotalWidth:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:l}=e,d=this._context.unit.getActiveSheet();if(!d)return;const u=d.getZoomRatio()||1;t==null||t.setScaleValueOnly(u,u),t==null||t.transformByState({width:s+i,height:l+r})}_getSheetObject(){return Ne(this._context.unit,this._context)}_scrollToSelectionByDirection(n){const o=this._getViewportBounding();if(o==null)return!1;const{startRow:e,startColumn:t,endRow:r,endColumn:i}=o;let s=0,l=0;const{startRow:c,startColumn:d,endRow:u,endColumn:h}=n;c>=e&&(s=u),u<=r&&(s=c),d>=t&&(l=h),h<=i&&(l=d),this._scrollToCell(s,l)}_scrollToSelection(n=!0){const o=this._selectionManagerService.getCurrentLastSelection();if(o==null)return;const{startRow:e,startColumn:t,actualRow:r,actualColumn:i}=o.primary,s=n?r:e,l=n?i:t;this._scrollToCell(s,l)}_getViewportBounding(){var t,r;const n=(t=this._getSheetObject())==null?void 0:t.scene;if(n==null)return;const o=n.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(o==null)return;const e=(r=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:r.skeleton;if(e!=null)return e.getRangeByViewport(o.calcViewportInfo())}_scrollToCell(n,o){var P,y,M,x;const{rowHeightAccumulation:e,columnWidthAccumulation:t}=(y=(P=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:P.skeleton)!=null?y:{};if(e==null||t==null)return!1;const r=(M=this._getSheetObject())==null?void 0:M.scene;if(r==null)return!1;const i=r.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(i==null||((x=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:x.skeleton)==null)return!1;const l=this._context.unit.getActiveSheet();if(!l)return!1;const{startColumn:c,startRow:d,ySplit:u,xSplit:h}=l.getFreeze(),g=this._getViewportBounding();if(g==null)return!1;const{startRow:S,startColumn:p,endRow:f,endColumn:v}=g;let C,_;if(n>=d&&o>=c-h&&(n<=S&&(C=n),n>=f)){const A=e[n]-i.height;for(let D=S;D<=n;D++)if(e[D]>=A){C=D+1;break}}if(o>=c&&n>=d-u&&(o<=p&&(_=o),o>=v)){const A=t[o]-i.width;for(let D=p;D<=o;D++)if(t[D]>=A){_=D+1;break}}if(C===void 0&&_===void 0)return!1;const{offsetX:R,offsetY:w}=this._scrollManagerService.getCurrentScrollState()||{};return this._commandService.syncExecuteCommand(Ue.id,{sheetViewStartRow:C,sheetViewStartColumn:_,offsetX:_===void 0?R:0,offsetY:C===void 0?w:0})}};Li=Mf([tn(1,a.Inject(exports.SheetSkeletonManagerService)),tn(2,a.ICommandService),tn(3,T.IRenderManagerService),tn(4,a.Inject(m.SheetsSelectionsService)),tn(5,a.Inject(exports.SheetScrollManagerService)),tn(6,a.IUniverInstanceService)],Li);var xf=Object.getOwnPropertyDescriptor,Of=(n,o,e,t)=>{for(var r=t>1?void 0:t?xf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Pa=(n,o)=>(e,t)=>o(e,t,n);let Ro=class extends a.Disposable{constructor(n,o,e){super(),this._context=n,this._sheetSkeletonManagerService=o,this._renderManagerService=e,this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe(t=>{this._sheetSkeletonManagerService.disposeSkeleton(t.getSheetId())})),this._sheetSkeletonManagerService.currentSkeleton$.subscribe(t=>{this._updateSceneSize(t)})}_updateSceneSize(n){var u;if(n==null)return;const{unitId:o}=this._context,{skeleton:e}=n,t=(u=this._renderManagerService.getRenderById(o))==null?void 0:u.scene;if(e==null||t==null)return;const{rowTotalHeight:r,columnTotalWidth:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:l}=e;this._context.unit.getActiveSheet()&&(t==null||t.transformByState({width:s+i,height:l+r}))}};Ro=Of([Pa(1,a.Inject(exports.SheetSkeletonManagerService)),Pa(2,T.IRenderManagerService)],Ro);var Af=Object.getOwnPropertyDescriptor,Df=(n,o,e,t)=>{for(var r=t>1?void 0:t?Af(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},xa=(n,o)=>(e,t)=>o(e,t,n);a.createIdentifier("sheets-ui.services.auto-height");function Nf(n,o){const e=[],t=[...n];let r=o;for(;t.length>0;){const i=t.shift();if(!i)break;const s=i.endRow-i.startRow+1;if(s>r){e.push({...i,startRow:i.startRow,endRow:i.startRow+r-1}),t.unshift({...i,startRow:i.startRow+r});break}else e.push(i),r-=s}return{result:e,lasts:t}}const kf=500;let wo=class extends a.Disposable{constructor(o,e,t){super();E(this,"_autoHeightTasks",[]);E(this,"_calculateLoopId",null);this._context=o,this._sheetSkeletonManagerService=e,this._commandService=t,this._initMarkDirty()}_initMarkDirty(){this.disposeWithMe(this._commandService.onCommandExecuted(o=>{if(o.id===m.MarkDirtyRowAutoHeightMutation.id){const e=o.params,{unitId:t,subUnitId:r,ranges:i,id:s}=e;if(t!==this._context.unitId)return;this.startAutoHeightTask({ranges:i,sheetId:r,id:s,maxTime:1e4})}if(o.id===m.CancelMarkDirtyRowAutoHeightMutation.id){const e=o.params,{unitId:t,id:r}=e;if(t!==this._context.unitId)return;this.cancelTask(r)}}))}_loopTask(o){const e=o.skeleton;let t=[],r=[];if(o.maxTime&&o.maxTime+o.startTime<=Date.now())t=o.ranges;else{const l=Nf(o.ranges,kf);t=l.result,r=l.lasts}const s=e.calculateAutoHeightInRange(t).filter(l=>{const{row:c,autoHeight:d}=l;return!(!d||e.getRowHeight(c)===d)});if(r.length&&(o.ranges=r,this._autoHeightTasks.unshift(o)),s.length){const l={unitId:this._context.unitId,subUnitId:o.sheetId,rowsAutoHeightInfo:s};this._commandService.syncExecuteCommand(m.SetWorksheetRowAutoHeightMutation.id,l)}}_calculateLoop(o){for(;this._autoHeightTasks.length&&!(o.timeRemaining()<=0);){const e=this._autoHeightTasks.shift();if(!e){this._calculateLoopId=null;return}this._loopTask(e)}this._calculateLoopId=requestIdleCallback(e=>{this._calculateLoop(e)})}_initialCalculateLoop(){this._calculateLoopId===null&&(this._calculateLoopId=requestIdleCallback(o=>{this._calculateLoop(o)}))}startAutoHeightTask(o){const e=this._sheetSkeletonManagerService.getSkeleton(o.sheetId);if(!e)return;o.ranges=a.Rectangle.mergeRanges(o.ranges.map(r=>({...r,startColumn:0,endColumn:0})));const t=a.Rectangle.subtractMulti(o.ranges,this._autoHeightTasks.filter(r=>r.sheetId===o.sheetId).map(r=>r.ranges).flat());t.length&&(this._autoHeightTasks.push({...o,startTime:Date.now(),skeleton:e,ranges:t}),this._initialCalculateLoop())}cancelTask(o){const e=this._autoHeightTasks.findIndex(t=>t.id===o);e!==-1&&this._autoHeightTasks.splice(e,1)}};wo=Df([xa(1,a.Inject(exports.SheetSkeletonManagerService)),xa(2,a.ICommandService)],wo);function Jc(n){const{popup:o}=n,{extraProps:e}=o,{options:t,defaultValue:r,onChange:i}=e,[s,l]=W.useState(r!=null?r:[]);return b.jsx(F.CascaderList,{options:t,value:s,onChange:i})}Jc.componentKey="sheets.dropdown.cascader";function $c(n){const{popup:o}=n,{extraProps:e}=o,{defaultValue:t,onChange:r}=e;return b.jsx(F.ColorPicker,{value:t,onChange:r})}$c.componentKey="sheets.dropdown.color";function ed(n){const{popup:o}=n,{extraProps:e}=o,{hideFn:t,patternType:r,defaultValue:i,onChange:s,showTime:l}=e,[c,d]=W.useState(i),u=W.useMemo(()=>r!=="time"?a.dayjs():a.dayjs("1900-01-01 00:00:00"),[]),h=c&&c.isValid()?c:u,g=I.useDependency(a.LocaleService),S=async()=>{if(!h)return;await(s==null?void 0:s(h))&&t()};return b.jsxs("div",{className:"univer-rounded univer-bg-white univer-p-2 univer-shadow-lg dark:!univer-bg-black",children:[r==="time"?b.jsx(F.TimeInput,{value:h.toDate(),onValueChange:p=>{d(a.dayjs(p))}}):b.jsx(F.Calendar,{value:h.toDate(),showTime:l!=null?l:r==="datetime",onValueChange:p=>{d(a.dayjs(p))}}),b.jsx("footer",{className:F.clsx("univer-mt-2 univer-flex univer-justify-end univer-pt-2",F.borderTopClassName),children:b.jsx(F.Button,{size:"small",variant:"primary",onClick:S,disabled:!h||!h.isValid(),children:g.t("dataValidation.alert.ok")})})]})}ed.componentKey="sheets.dropdown.date";function Hf(n){return n.filter(Boolean).join(",")}function Vf(n){return n.split(",").filter(Boolean)}function Wf(n){const{value:o,onChange:e,multiple:t,options:r,title:i,onEdit:s,filter:l,style:c,location:d,showEdit:u}=n,h=I.useDependency(a.LocaleService),g=l==null?void 0:l.toLowerCase(),{row:S,col:p,unitId:f,subUnitId:v}=d,C=r.filter(w=>g?w.label.toLowerCase().includes(g):!0),_=I.useDependency(m.SheetPermissionCheckController),R=W.useMemo(()=>_.permissionCheckWithRanges({workbookTypes:[m.WorkbookEditablePermission],rangeTypes:[m.RangeProtectionPermissionEditPoint],worksheetTypes:[m.WorksheetEditPermission]},[{startColumn:p,startRow:S,endColumn:p,endRow:S}],f,v),[_,p,S,f,v]);return b.jsxs("div",{"data-u-comp":"sheets-dropdown-list",className:F.clsx("univer-box-border univer-rounded-lg univer-bg-white univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",F.borderClassName),style:c,children:[b.jsx("div",{className:"univer-px-3.5 univer-py-1 univer-pt-2 univer-text-xs",children:i}),b.jsx("div",{className:F.clsx("univer-flex univer-max-h-52 univer-flex-col univer-gap-1 univer-overflow-y-auto univer-px-2 univer-py-1",F.scrollbarClassName),children:C.map((w,P)=>{const y=o.indexOf(w.value)>-1,M=()=>{let D;y?D=new Set(o.filter(V=>V!==w.value)):D=new Set(t?[...o,w.value]:[w.value]);const N=[];r.forEach(V=>{D.has(V.value)&&N.push(V.value)}),e(N)},x=w.label.toLocaleLowerCase().indexOf(g),A=new a.ColorKit(w.color).isDark();return b.jsxs("div",{className:"univer-flex univer-cursor-pointer univer-flex-row univer-items-center univer-justify-between univer-rounded-md univer-px-1.5 univer-py-1 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",onClick:M,children:[b.jsx("div",{className:F.clsx("univer-inline-flex univer-h-4 univer-w-fit univer-items-center univer-truncate univer-rounded-full univer-px-1.5 univer-text-xs",{"univer-text-gray-900":!A,"univer-text-white":A}),style:{background:w.color},children:g&&w.label.toLowerCase().includes(g)?b.jsxs(b.Fragment,{children:[b.jsx("span",{children:w.label.substring(0,x)}),b.jsx("span",{className:"univer-font-semibold",children:w.label.substring(x,x+g.length)}),b.jsx("span",{children:w.label.substring(x+g.length)})]}):w.label}),b.jsx("div",{className:"univer-ml-3 univer-h-4 univer-w-4 univer-flex-shrink-0 univer-flex-grow-0 univer-text-base univer-text-primary-500",children:y&&b.jsx(Yt,{className:"univer-text-primary-600"})})]},P)})},l),u&&R&&b.jsx("div",{className:F.clsx("univer-box-border univer-px-2 univer-pt-1",F.borderTopClassName),children:b.jsx("a",{className:"univer-block univer-cursor-pointer univer-rounded univer-px-1.5 univer-py-1 univer-text-xs hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",onClick:s,children:h.t("dataValidation.list.edit")})})]})}function td(n){var P,y,M,x;const{popup:{extraProps:o}}=n,{location:e,hideFn:t,onChange:r,onEdit:i,options:s,defaultValue:l,multiple:c,showEdit:d}=o,{worksheet:u}=e,[h,g]=W.useState(""),S=I.useDependency(a.ICommandService),p=I.useDependency(a.LocaleService),[f,v]=W.useState(l),C=I.useDependency(he),_=I.useDependency(a.IUniverInstanceService),R=I.RectPopup.useContext(),w=((y=(P=R.current)==null?void 0:P.right)!=null?y:0)-((x=(M=R.current)==null?void 0:M.left)!=null?x:0);return W.useEffect(()=>{const A=S.onCommandExecuted(D=>{var N,V;if(D.id===ve.RichTextEditingMutation.id){const H=D.params,{unitId:k}=H,U=_.getUnit(k,a.UniverInstanceType.UNIVER_DOC);if(!U||!C.isVisible().visible)return;const L=a.BuildTextUtils.transform.getPlainText((V=(N=U.getSnapshot().body)==null?void 0:N.dataStream)!=null?V:"");g(L)}});return()=>{A.dispose()}},[S,C,_]),u?b.jsx(Wf,{style:{minWidth:w,maxWidth:Math.max(w,200)},title:c?p.t("dataValidation.listMultiple.dropdown"):p.t("dataValidation.list.dropdown"),value:Vf(f!=null?f:""),multiple:c,onChange:async A=>{const D=Hf(A);v(D),await(r==null?void 0:r(A))!==!1&&t()},options:s,onEdit:i,filter:h,location:e,showEdit:d}):null}td.componentKey="sheets.dropdown.list";const Oa={datepicker:ed,list:td,color:$c,cascader:Jc};var Uf=Object.getOwnPropertyDescriptor,Lf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Uf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Yr=(n,o)=>(e,t)=>o(e,t,n);const Ts=a.createIdentifier("ICellDropdownManagerService");exports.SheetCellDropdownManagerService=class extends a.Disposable{constructor(o,e,t,r){super(),this._canvasPopupManagerService=o,this._zenZoneService=e,this._renderManagerService=t,this._componentManager=r,Object.values(Oa).forEach(i=>{this.disposeWithMe(this._componentManager.register(i.componentKey,i))})}showDropdown(o){const{location:e,onHide:t,closeOnOutSide:r=!0}=o,{row:i,col:s,unitId:l,subUnitId:c}=e;if(this._zenZoneService.visible)throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown when zen mode is visible");const d=Oa[o.type],u=this._renderManagerService.getRenderById(a.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY),h=new a.DisposableCollection,g=this._canvasPopupManagerService.attachPopupToCell(i,s,{componentKey:d.componentKey,onClickOutside:()=>{r&&h.dispose()},offset:[0,3],excludeOutside:[u==null?void 0:u.engine.getCanvasElement()].filter(Boolean),extraProps:{...o,...o.props,hideFn:()=>{h.dispose()}}},l,c);if(!g)throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown");return h.add(g),h.add({dispose:()=>{t==null||t()}}),h}};exports.SheetCellDropdownManagerService=Lf([Yr(0,a.Inject(exports.SheetCanvasPopManagerService)),Yr(1,I.IZenZoneService),Yr(2,T.IRenderManagerService),Yr(3,a.Inject(I.ComponentManager))],exports.SheetCellDropdownManagerService);const Bf=a.createInterceptorKey("PRINTING_RANGE"),Ff=a.createInterceptorKey("PRINTING_COMPONENT_COLLECT"),jf=a.createInterceptorKey("PRINTING_DOM_COLLECT");class ys extends a.Disposable{constructor(){super();E(this,"_printComponentMap",new Map);E(this,"interceptor",new a.InterceptorManager({PRINTING_RANGE:Bf,PRINTING_COMPONENT_COLLECT:Ff,PRINTING_DOM_COLLECT:jf}));this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_RANGE,{priority:-1,handler:e=>e})),this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT,{priority:-1,handler:e=>e})),this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT,{priority:-1,handler:e=>e}))}registerPrintComponent(e,t){this._printComponentMap.set(e,t)}getPrintComponent(e){return this._printComponentMap.get(e)}}class zf extends ur{constructor(e,t,r,i){super(e,t,r,i);E(this,"_fillControlTopLeft");E(this,"_fillControlBottomRight");E(this,"_rangeType",a.RANGE_TYPE.NORMAL);this._scene=e,this._zIndex=t,this._themeService=r,this._rangeType=(i==null?void 0:i.rangeType)||a.RANGE_TYPE.NORMAL,this.initControlPoints()}initControlPoints(){const e=this.currentStyle,t=e.expandCornerSize||0,r=(e.expandCornerSize||0)/4,i=e.autofillStrokeWidth||0,s=e.stroke,l=e.autofillStroke,c=this.zIndex;this._fillControlTopLeft=new T.Rect(Ti.fillTopLeft+c,{zIndex:c+2,width:t,height:t,radius:t/2,visualWidth:r,visualHeight:r,strokeWidth:i}),this._fillControlBottomRight=new T.Rect(Ti.fillBottomRight+c,{zIndex:c+2,width:t,height:t,radius:t/2,visualHeight:r,visualWidth:r,strokeWidth:i});const d={fill:s,stroke:l,strokeScaleEnabled:!1};this._fillControlTopLeft.setProps({...d}),this._fillControlBottomRight.setProps({...d});const u=[this._fillControlTopLeft,this._fillControlBottomRight];switch(this._rangeType){case a.RANGE_TYPE.ROW:this.rowHeaderGroup.addObjects(...u);break;case a.RANGE_TYPE.COLUMN:this.columnHeaderGroup.addObjects(...u);break;case a.RANGE_TYPE.NORMAL:this.selectionShapeGroup.addObjects(...u)}this.getScene().addObjects(u,Qr)}get fillControlTopLeft(){return this._fillControlTopLeft}set fillControlTopLeft(e){this._fillControlTopLeft=e}get fillControlBottomRight(){return this._fillControlBottomRight}set fillControlBottomRight(e){this._fillControlBottomRight=e}get rangeType(){return this._rangeType}set rangeType(e){this._rangeType=e}dispose(){var e,t;(e=this._fillControlBottomRight)==null||e.dispose(),(t=this._fillControlTopLeft)==null||t.dispose(),super.dispose()}_updateLayoutOfSelectionControl(e){var i,s;super._updateLayoutOfSelectionControl(e);const t=this.currentStyle;e==null&&(e=t);const{widgets:r=t.widgets}=e;if(this.currentStyle=e,this._enableAutoFill===!0&&!super._hasWidgets(r)){const{viewportScrollX:l,viewportScrollY:c}=this.getViewportMainScrollInfo(),{endX:d,endY:u}=this.selectionModel;this.transformControlPoint(l,c,d,u),this.fillControlTopLeft.show(),this.fillControlBottomRight.show()}else(i=this.fillControlTopLeft)==null||i.hide(),(s=this.fillControlBottomRight)==null||s.hide()}getViewportMainScrollInfo(){const e=this.getScene().getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);return{viewportScrollX:(e==null?void 0:e.viewportScrollX)||0,viewportScrollY:(e==null?void 0:e.viewportScrollY)||0,width:(e==null?void 0:e.width)||0,height:(e==null?void 0:e.height)||0}}transformControlPoint(e=0,t=0,r=0,i=0){const s=this.currentStyle,l=this.selectionModel.rangeType,c=s.expandCornerSize,{startX:d,startY:u,endX:h,endY:g}=this.selectionModel,S=this.getViewportMainScrollInfo(),p=S.width,f=S.height;switch(l){case a.RANGE_TYPE.NORMAL:this.fillControlTopLeft.transformByState({left:-c/2,top:-c/2}),this.fillControlBottomRight.transformByState({left:h-d-c/2,top:g-u-c/2});break;case a.RANGE_TYPE.ROW:{const v=Math.min(p/2+e,r),C=-c/2+v;this.fillControlTopLeft.transformByState({left:C,top:-c/2}),this.fillControlBottomRight.transformByState({left:C,top:-c/2+g-u})}break;case a.RANGE_TYPE.COLUMN:{const v=Math.min(+f/2+t,i),C=-c/2+v;this.fillControlTopLeft.transformByState({left:-c/2,top:C}),this.fillControlBottomRight.transformByState({left:-c/2+h-d,top:C})}break;default:console.error("unknown range type")}}}var Xf=Object.getOwnPropertyDescriptor,Yf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Xf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Je=(n,o)=>(e,t)=>o(e,t,n);let Bi=class extends Xi{constructor(o,e,t,r,i,s,l,c,d,u){super(e,t,r,s,d);E(this,"_workbookSelections");E(this,"_renderDisposable",null);E(this,"_expandingSelection",!1);E(this,"_selectionControls",[]);E(this,"expandingControlMode","bottom-right");this._context=o,this._logService=l,this._commandService=c,this._contextService=d,this._scrollManagerService=u,this._workbookSelections=i.getWorkbookSelections(this._context.unitId),this._init()}_init(){const o=this._getSheetObject();this._initEventListeners(o),this._initSelectionChangeListener(),this._initSkeletonChangeListener(),this._initUserActionSyncListener(),this._updateControlPointWhenScrolling()}_initSkeletonChangeListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(o=>{if(o==null){this._logService.error("[SelectionRenderService]: should not receive null!");return}const e=this._context.unitId,{sheetId:t,skeleton:r}=o,{scene:i}=this._context,s=i.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);this._changeRuntime(r,i,s),this._workbookSelections.getCurrentLastSelection()||this._commandService.syncExecuteCommand(m.SetSelectionsOperation.id,{unitId:e,subUnitId:t,selections:[Mo(r)]})}))}_initSelectionChangeListener(){}_initEventListeners(o){const{spreadsheetRowHeader:e,spreadsheetColumnHeader:t,spreadsheet:r,spreadsheetLeftTopPlaceholder:i}=o,{scene:s}=this._context;this._initSpreadsheetEvent(o),this.disposeWithMe(e==null?void 0:e.onPointerUp$.subscribeEvent((l,c)=>{if(this._normalSelectionDisabled())return;const d=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{row:u}=ze(l.offsetX,l.offsetY,s,d);ql(this._workbookSelections.getCurrentSelections(),u)||(this.createNewSelection(l,(r.zIndex||1)+1,a.RANGE_TYPE.ROW,this._getActiveViewport(l)),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()))})),this.disposeWithMe(t==null?void 0:t.onPointerUp$.subscribeEvent((l,c)=>{if(this._normalSelectionDisabled())return;const d=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{column:u}=ze(l.offsetX,l.offsetY,s,d);Ql(this._workbookSelections.getCurrentSelections(),u)||(this.createNewSelection(l,(r.zIndex||1)+1,a.RANGE_TYPE.COLUMN,this._getActiveViewport(l)),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()))})),this.disposeWithMe(i==null?void 0:i.onPointerUp$.subscribeEvent((l,c)=>{if(this._normalSelectionDisabled())return;this._reset();const d=this._sheetSkeletonManagerService.getCurrentParam().skeleton,u=Yi(d);this._addSelectionControlByModelData(u),this.refreshSelectionMoveStart(),c.stopPropagation(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())}))}_initSpreadsheetEvent(o){const{spreadsheet:e}=o;let t;const r=500,i={x:0,y:0},s=()=>{clearTimeout(t)},l=(u,h)=>{this.createNewSelection(u,e.zIndex+1,a.RANGE_TYPE.NORMAL,this._getActiveViewport(u)),h&&this._selectionMoveEnd$.next(this.getSelectionDataWithStyle())};e==null||e.onPointerMove$.subscribeEvent((u,h)=>{(Math.abs(u.offsetX-i.x)>10||Math.abs(u.offsetY-i.y)>10)&&s()});const c=e==null?void 0:e.onPointerDown$.subscribeEvent((u,h)=>{i.x=u.offsetX,i.y=u.offsetY,t=setTimeout(()=>{l(u,!0)},r),h.stopPropagation()}),d=e==null?void 0:e.onPointerUp$.subscribeEvent((u,h)=>{if(this._normalSelectionDisabled())return;clearTimeout(t);const g=10;Math.abs(u.offsetX-i.x)>g||Math.abs(u.offsetY-i.y)>g||(l(u,!1),h.stopPropagation())});this.disposeWithMe(a.toDisposable(c)),this.disposeWithMe(a.toDisposable(d))}_initUserActionSyncListener(){this.disposeWithMe(this.selectionMoveStart$.subscribe(o=>this._updateSelections(o,m.SelectionMoveType.MOVE_START))),this.disposeWithMe(this.selectionMoving$.subscribe(o=>this._updateSelections(o,m.SelectionMoveType.MOVING))),this.disposeWithMe(this._contextService.subscribeContextValue$(m.REF_SELECTIONS_ENABLED).pipe(O.startWith(!1),O.distinctUntilChanged()).subscribe(o=>{var e;o?((e=this._renderDisposable)==null||e.dispose(),this._renderDisposable=null,this._reset()):this._renderDisposable=a.toDisposable(this.selectionMoveEnd$.subscribe(t=>this._updateSelections(t,m.SelectionMoveType.MOVE_END)))}))}_updateSelections(o,e){const t=this._context.unit,r=t.getUnitId(),i=t.getActiveSheet().getSheetId();o.length!==0&&this._commandService.executeCommand(m.SetSelectionsOperation.id,{unitId:r,subUnitId:i,type:e,selections:o.map(s=>m.convertSelectionDataToRange(s))})}createNewSelection(o,e=0,t=a.RANGE_TYPE.NORMAL,r){this._rangeType=t;const i=this._skeleton,s=this._scene;if(!s||!i)return;r&&(this._activeViewport=r);const{offsetX:l,offsetY:c}=o,d=s.getCoordRelativeToViewport(T.Vector2.FromArray([l,c])),{x:u,y:h}=d;this._startViewportPosX=u,this._startViewportPosY=h;const g=s.getScrollXYInfoByViewport(d),{scaleX:S,scaleY:p}=s.getAncestorScale(),f=this._skeleton.getCellByOffset(u,h,S,p,g);if(!f)return;switch(t){case a.RANGE_TYPE.NORMAL:break;case a.RANGE_TYPE.ROW:f.startColumn=0,f.endColumn=this._skeleton.getColumnCount()-1;break;case a.RANGE_TYPE.COLUMN:f.startRow=0,f.endRow=this._skeleton.getRowCount()-1;break;case a.RANGE_TYPE.ALL:f.startRow=0,f.startColumn=0,f.endRow=this._skeleton.getRowCount()-1,f.endColumn=this._skeleton.getColumnCount()-1}const v={range:f,primary:f,style:null};v.range.rangeType=t;const C=ye(v,this._skeleton);this._startRangeWhenPointerDown={...C.rangeWithCoord};let _=this.getActiveSelectionControl();const R={...C.rangeWithCoord};for(const w of this.getSelectionControls())if(w.model.isEqual(R)){_=w;break}(_==null?void 0:_.model.rangeType)!==t?(this._clearAllSelectionControls(),_=this.newSelectionControl(s,i,v)):_.updateRangeBySelectionWithCoord(C),this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._clearUpdatingListeners(),this._expandingSelection=!1}newSelectionControl(o,e,t){const r=this.getSelectionControls(),{rowHeaderWidth:i,columnHeaderHeight:s}=e,l=t.range.rangeType,c=new zf(o,r.length,this._themeService,{highlightHeader:this._highlightHeader,rowHeaderWidth:i,columnHeaderHeight:s,rangeType:l}),d=ye(t,e);c.updateRangeBySelectionWithCoord(d),this._selectionControls.push(c);const{expandingModeForTopLeft:u,expandingModeForBottomRight:h}=(()=>{switch(l){case a.RANGE_TYPE.NORMAL:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"};case a.RANGE_TYPE.ROW:return{expandingModeForTopLeft:"top",expandingModeForBottomRight:"bottom"};case a.RANGE_TYPE.COLUMN:return{expandingModeForTopLeft:"left",expandingModeForBottomRight:"right"};case a.RANGE_TYPE.ALL:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"};default:return{expandingModeForTopLeft:"top-left",expandingModeForBottomRight:"bottom-right"}}})();return c.fillControlTopLeft.onPointerDown$.subscribeEvent(g=>{this._expandingSelection=!0,this.expandingControlMode=u,this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._fillControlPointerDownHandler(g,l,this._activeViewport)}),c.fillControlBottomRight.onPointerDown$.subscribeEvent(g=>{this._expandingSelection=!0,this.expandingControlMode=h,this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._fillControlPointerDownHandler(g,l,this._activeViewport)}),(l===a.RANGE_TYPE.ROW||l===a.RANGE_TYPE.COLUMN)&&!o.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),c}_getActiveViewport(o){const e=this._getSheetObject();return e==null?void 0:e.scene.getActiveViewportByCoord(T.Vector2.FromArray([o.offsetX,o.offsetY]))}_getSheetObject(){return Ne(this._context.unit,this._context)}_normalSelectionDisabled(){return this._contextService.getContextValue(m.REF_SELECTIONS_ENABLED)}getSelectionControls(){return this._selectionControls}_fillControlPointerDownHandler(o,e=a.RANGE_TYPE.NORMAL,t,r=T.ScrollTimerType.ALL){var h,g,S;const i=this._skeleton,s=this._scene;if(!s||!i)return;t&&(this._activeViewport=t);const l=s.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),c=this.getActiveSelectionControl();if(!c)return;this._changeCurrCellWhenControlPointerDown(),this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._clearUpdatingListeners(),this._addEndingListeners(),this._scrollTimer=T.ScrollTimer.create(this._scene,r),this._scrollTimer.startScroll((h=l==null?void 0:l.left)!=null?h:0,(g=l==null?void 0:l.top)!=null?g:0,l),(S=s.getTransformer())==null||S.clearSelectedObjects();const d=s.getCoordRelativeToViewport(T.Vector2.FromArray([o.offsetX,o.offsetY]));this._setupPointerMoveListener(l,c,e,r,d.x,d.y);const u=this._shortcutService.forceEscape();this._scenePointerUpSub=s.onPointerUp$.subscribeEvent(p=>{this.endSelection(),this._expandingSelection=!1,this.expandingControlMode="bottom-right",this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),u.dispose()})}_changeCurrCellWhenControlPointerDown(){const o=this.getActiveSelectionControl(),e=this._skeleton;let t;const{startRow:r,startColumn:i,endRow:s,endColumn:l}=o.model;switch(this.expandingControlMode){case"top-left":t=e.getCellWithCoordByIndex(s,l);break;case"bottom-right":t=e.getCellWithCoordByIndex(r,i);break;case"left":t=e.getCellWithCoordByIndex(r,l),t.isMerged=!1,t.isMergedMainCell=!1;break;case"right":t=e.getCellWithCoordByIndex(r,i),t.isMerged=!1,t.isMergedMainCell=!1;break;case"top":t=e.getCellWithCoordByIndex(s,i),t.isMerged=!1,t.isMergedMainCell=!1;break;case"bottom":t=e.getCellWithCoordByIndex(r,i),t.isMerged=!1,t.isMergedMainCell=!1;break;default:t=e.getCellWithCoordByIndex(r,i)}return o.updateCurrCell(t),t}_movingHandler(o,e,t,r){var x,A,D,N,V,H,k,U,L,j,B,z,X;this._rangeType=r;const i=this._skeleton,s=this._scene,l={startRow:t.model.startRow,endRow:t.model.endRow,startColumn:t.model.startColumn,endColumn:t.model.endColumn},c=s.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),d=(x=this._getViewportByCell(l.endRow,l.endColumn))!=null?x:c,u=s.getScrollXYInfoByViewport(T.Vector2.FromArray([this._startViewportPosX,this._startViewportPosY]),d),{scaleX:h,scaleY:g}=s.getAncestorScale();r===a.RANGE_TYPE.ROW?o=Number.POSITIVE_INFINITY:r===a.RANGE_TYPE.COLUMN&&(e=Number.POSITIVE_INFINITY);const S=this._getSelectionWithCoordByOffset(o,e,h,g,u);if(!S)return!1;const{rangeWithCoord:p}=S,f=t.model.currentCell,v=(A=f==null?void 0:f.mergeInfo.startRow)!=null?A:-1,C=(D=f==null?void 0:f.mergeInfo.endRow)!=null?D:-1,_=(N=f==null?void 0:f.mergeInfo.startColumn)!=null?N:-1,R=(V=f==null?void 0:f.mergeInfo.endColumn)!=null?V:-1;let w={startRow:Math.min(p.startRow,v),startColumn:Math.min(p.startColumn,_),endRow:Math.max(p.endRow,C),endColumn:Math.max(p.endColumn,R)};if(r===a.RANGE_TYPE.NORMAL?w=i.expandRangeByMerge(w):r===a.RANGE_TYPE.COLUMN?w={startRow:Math.min(p.startRow,(H=f==null?void 0:f.actualRow)!=null?H:-1),startColumn:Math.min(p.startColumn,(k=f==null?void 0:f.actualColumn)!=null?k:-1),endRow:Math.max(p.endRow,(U=f==null?void 0:f.actualRow)!=null?U:-1),endColumn:Math.max(p.endColumn,(L=f==null?void 0:f.actualColumn)!=null?L:-1)}:r===a.RANGE_TYPE.ROW&&(w={startRow:Math.min(p.startRow,(j=f==null?void 0:f.actualRow)!=null?j:-1),startColumn:Math.min(p.startColumn,(B=f==null?void 0:f.actualColumn)!=null?B:-1),endRow:Math.max(p.endRow,(z=f==null?void 0:f.actualRow)!=null?z:-1),endColumn:Math.max(p.endColumn,(X=f==null?void 0:f.actualColumn)!=null?X:-1)}),!w)return!1;const y=ye({range:w,style:null,primary:null},i);(l.startRow!==w.startRow||l.startColumn!==w.startColumn||l.endRow!==w.endRow||l.endColumn!==w.endColumn)&&t&&(t.updateRangeBySelectionWithCoord(y),this._selectionMoving$.next(this.getSelectionDataWithStyle()))}_updateControlPointWhenScrolling(){const{scene:o}=this._context;if(!o.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN))return;const t=this._scrollManagerService.validViewportScrollInfo$.subscribe(r=>{var g;if(r==null)return;const{viewportScrollX:i,viewportScrollY:s}=r,l=this.getActiveSelectionControl();if(l==null)return;const c=(g=this._sheetSkeletonManagerService.getCurrentParam())==null?void 0:g.skeleton,d=c==null?void 0:c.rowTotalHeight,u=c==null?void 0:c.columnTotalWidth,h=l.rangeType;h===a.RANGE_TYPE.COLUMN?l.transformControlPoint(0,s,u,d):h===a.RANGE_TYPE.ROW&&l.transformControlPoint(i,0,u,d)});this.disposeWithMe(a.toDisposable(t))}};Bi=Yf([Je(1,a.Inject(a.Injector)),Je(2,a.Inject(a.ThemeService)),Je(3,I.IShortcutService),Je(4,a.Inject(m.SheetsSelectionsService)),Je(5,a.Inject(exports.SheetSkeletonManagerService)),Je(6,a.ILogService),Je(7,a.ICommandService),Je(8,a.IContextService),Je(9,a.Inject(exports.SheetScrollManagerService))],Bi);var Zf=Object.defineProperty,Gf=Object.getOwnPropertyDescriptor,Kf=(n,o,e)=>o in n?Zf(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e,qf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Gf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Kn=(n,o)=>(e,t)=>o(e,t,n),nd=(n,o,e)=>Kf(n,typeof o!="symbol"?o+"":o,e);exports.UniverSheetsMobileUIPlugin=class extends a.Plugin{constructor(o=io,e,t,r,i,s){super(),this._config=o,this._injector=e,this._renderManagerService=t,this._configService=r,this._univerInstanceService=i,this._componentManager=s;const{menu:l,...c}=a.merge({},io,this._config);if(c.protectedRangeUserSelector){const{component:d,framework:u}=c.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(fr,d,{framework:u}))}l&&this._configService.setConfig("menu",l,{merge:!0}),this._configService.setConfig(Ee,{...c})}onStarting(){a.registerDependencies(this._injector,a.mergeOverrideWithDependencies([[Cn],[he,{useClass:exports.EditorBridgeService}],[ke,{useClass:exports.SheetClipboardService}],[Xt,{useClass:Ja}],[Xe,{useClass:oo}],[Hn,{useClass:ss}],[Vn,{useClass:pl}],[m.IRefSelectionsService,{useClass:m.RefSelectionsService}],[pt,{useClass:exports.AutoFillService}],[ys],[Dr,{useClass:gs}],[Lt,{useClass:exports.MarkSelectionService}],[exports.HoverManagerService],[exports.DragManagerService],[exports.SheetCanvasPopManagerService],[exports.CellPopupManagerService],[exports.CellAlertManagerService],[ns],[Ts,{useClass:exports.SheetCellDropdownManagerService}],[exports.SheetCellEditorResizeService],[bn],[exports.AutoHeightController],[exports.AutoWidthController],[exports.FormulaEditorController],[exports.SheetsRenderService],[mo],[exports.StatusBarController],[exports.AutoFillController],[Tn],[wn],[En],[Rn],[exports.EditingRenderController],[Vt],[yn],[ft],[Mn],[exports.SheetPermissionCheckUIController],[Pn]],this._config.override))}onReady(){this._config.disableAutoFocus||this._initAutoFocus(),a.registerDependencies(this._injector,[[Ut]]),this._registerRenderBasics(),a.touchDependencies(this._injector,[[mo],[exports.SheetsRenderService],[bn],[exports.SheetPermissionCheckUIController],[yn]])}onRendered(){this._registerRenderModules(),a.touchDependencies(this._injector,[[Pn],[Vt],[Ut],[exports.FormulaEditorController],[wn],[exports.StatusBarController],[exports.AutoHeightController],[exports.AutoWidthController],[En],[Rn],[exports.EditingRenderController]])}onSteady(){a.touchDependencies(this._injector,[[Tn],[exports.AutoFillController],[Mn]])}_registerRenderBasics(){[[exports.SheetSkeletonManagerService],[Ro],[exports.SheetRenderController],[Ce,{useClass:Bi}],[exports.SheetScrollManagerService],[wo]].forEach(o=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(a.UniverInstanceType.UNIVER_SHEET,o))})}_registerRenderModules(){var r;const o=[[exports.HeaderMoveRenderController],[bo],[exports.HeaderResizeRenderController],[exports.SheetsScrollRenderController],[Li],[exports.HeaderFreezeRenderController],[ir],[Io],[Co],[lo],[co],[ho],[exports.HoverRenderController],[exports.DragRenderController],[uo],[exports.CellCustomRenderController],[go],[ar],[So],[po],[fo],[vo]],e=this._configService.getConfig(I.UI_PLUGIN_CONFIG_KEY);((r=e==null?void 0:e.contextMenu)!=null?r:!0)&&o.push([_o]),o.forEach(i=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(a.UniverInstanceType.UNIVER_SHEET,i))})}_initAutoFocus(){const o=this._univerInstanceService;this.disposeWithMe(o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).pipe(de.filter(e=>!!e)).subscribe(e=>o.focusUnit(e.getUnitId())))}};nd(exports.UniverSheetsMobileUIPlugin,"pluginName","SHEET_UI_PLUGIN");nd(exports.UniverSheetsMobileUIPlugin,"type",a.UniverInstanceType.UNIVER_SHEET);exports.UniverSheetsMobileUIPlugin=qf([a.DependentOn(m.UniverSheetsPlugin,I.UniverMobileUIPlugin),Kn(1,a.Inject(a.Injector)),Kn(2,T.IRenderManagerService),Kn(3,a.IConfigService),Kn(4,a.IUniverInstanceService),Kn(5,a.Inject(I.ComponentManager))],exports.UniverSheetsMobileUIPlugin);var Qf=Object.getOwnPropertyDescriptor,Jf=(n,o,e,t)=>{for(var r=t>1?void 0:t?Qf(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},bi=(n,o)=>(e,t)=>o(e,t,n);let Fi=class extends a.Disposable{constructor(n,o,e,t){super(),this._context=n,this._contextMenuService=o,this._selectionManagerService=e,this._selectionRenderService=t,this._init()}_init(){var l,c;const o=((c=(l=this._context)==null?void 0:l.mainComponent)==null?void 0:c.onPointerDown$).subscribeEvent(d=>{if(d.button===2){const u=this._selectionManagerService.getCurrentSelections(),h=u==null?void 0:u[0];if(!h)return;const g=h.range.rangeType,S=this._selectionRenderService.getSkeleton(),f=ye(h,S).rangeWithCoord,v=()=>{if(!f)return!1;const _=d.offsetX,R=d.offsetY;switch(g){case a.RANGE_TYPE.ROW:return f.startY<=R&&f.endY>=R;case a.RANGE_TYPE.COLUMN:return f.startX<=_&&f.endX>=_;default:return f.startX<=_&&f.endX>=_&&f.startY<=R&&f.endY>=R}},C=_=>{this._contextMenuService.triggerContextMenu(d,_)};v()?g===a.RANGE_TYPE.COLUMN?C(I.ContextMenuPosition.COL_HEADER):g===a.RANGE_TYPE.ROW?C(I.ContextMenuPosition.ROW_HEADER):C(I.ContextMenuPosition.MAIN_AREA):C(I.ContextMenuPosition.MAIN_AREA)}});this.disposeWithMe(o);const e=this._context.components.get(ue.COLUMN),r=this._context.components.get(ue.ROW).onPointerDown$.subscribeEvent(d=>{d.button===2&&this._contextMenuService.triggerContextMenu(d,I.ContextMenuPosition.ROW_HEADER)});this.disposeWithMe(r);const s=e.onPointerDown$.subscribeEvent(d=>{d.button===2&&this._contextMenuService.triggerContextMenu(d,I.ContextMenuPosition.COL_HEADER)});this.disposeWithMe(s)}};Fi=Jf([bi(1,I.IContextMenuService),bi(2,a.Inject(m.SheetsSelectionsService)),bi(3,Ce)],Fi);var $f=Object.getOwnPropertyDescriptor,ev=(n,o,e,t)=>{for(var r=t>1?void 0:t?$f(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},Aa=(n,o)=>(e,t)=>o(e,t,n);function tv(n){return typeof n.setShadowStrategy=="function"}exports.SheetPermissionRenderManagerService=class extends a.Disposable{constructor(e,t){super();E(this,"_currentStrategy");E(this,"_strategySubject");this._configService=e,this._renderManagerService=t;const r=this._configService.getConfig(Ee);this._currentStrategy=as(r==null?void 0:r.protectedRangeShadow),this._strategySubject=new O.BehaviorSubject(this._currentStrategy),this.disposeWithMe({dispose:()=>{this._strategySubject.complete()}})}_updateAllWorkbooks(e){this._renderManagerService.getRenderAll().forEach(r=>{const i=r.mainComponent;if(!i)return;const s=[{key:bs},{key:Rs},{key:ws}];let l=!1;for(const{key:c}of s){const d=i.getExtensionByKey(c);d&&tv(d)&&(d.setShadowStrategy(e),l=!0)}l&&i.makeDirty(!0)})}setProtectedRangeShadowStrategy(e){this._currentStrategy=e,this._strategySubject.next(e),this._updateAllWorkbooks(e)}getProtectedRangeShadowStrategy(){return this._currentStrategy}getProtectedRangeShadowStrategy$(){return this._strategySubject.asObservable()}dispose(){super.dispose(),this._strategySubject.complete()}};exports.SheetPermissionRenderManagerService=ev([Aa(0,a.IConfigService),Aa(1,T.IRenderManagerService)],exports.SheetPermissionRenderManagerService);var nv=Object.getOwnPropertyDescriptor,rv=(n,o,e,t)=>{for(var r=t>1?void 0:t?nv(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},ct=(n,o)=>(e,t)=>o(e,t,n);exports.SheetSelectionRenderService=class extends Xi{constructor(e,t,r,i,s,l,c,d,u){super(t,r,i,l,u);E(this,"_workbookSelections");E(this,"_renderDisposable",null);this._context=e,this._logService=c,this._commandService=d,this._contextService=u,this._workbookSelections=s.getWorkbookSelections(this._context.unitId),this._init()}_init(){const e=this._getSheetObject();this._contextService.setContextValue(m.SELECTIONS_ENABLED,!0),this._initEventListeners(e),this._initSelectionModelChangeListener(),this._initThemeChangeListener(),this._initSkeletonChangeListener(),this._initUserActionSyncListener()}dispose(){var e;super.dispose(),(e=this._renderDisposable)==null||e.dispose()}_initEventListeners(e){const{spreadsheetRowHeader:t,spreadsheetColumnHeader:r,spreadsheet:i,spreadsheetLeftTopPlaceholder:s}=e,{scene:l}=this._context;this.disposeWithMe(i==null?void 0:i.onPointerDown$.subscribeEvent((c,d)=>{this.isSelectionDisabled()||this.inRefSelectionMode()||(this._onPointerDown(c,i.zIndex+1,a.RANGE_TYPE.NORMAL,this._getActiveViewport(c)),c.button!==2&&d.stopPropagation())})),this.disposeWithMe(t==null?void 0:t.onPointerDown$.subscribeEvent((c,d)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;const u=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{row:h}=ze(c.offsetX,c.offsetY,l,u);ql(this._workbookSelections.getCurrentSelections(),h)||(this._onPointerDown(c,(i.zIndex||1)+1,a.RANGE_TYPE.ROW,this._getActiveViewport(c),T.ScrollTimerType.Y),c.button!==2&&d.stopPropagation())})),this.disposeWithMe(r==null?void 0:r.onPointerDown$.subscribeEvent((c,d)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;const u=this._sheetSkeletonManagerService.getCurrentParam().skeleton,{column:h}=ze(c.offsetX,c.offsetY,l,u);Ql(this._workbookSelections.getCurrentSelections(),h)||(this._onPointerDown(c,(i.zIndex||1)+1,a.RANGE_TYPE.COLUMN,this._getActiveViewport(c),T.ScrollTimerType.X),c.button!==2&&d.stopPropagation())})),this.disposeWithMe(s==null?void 0:s.onPointerDown$.subscribeEvent((c,d)=>{if(this.isSelectionDisabled()||this.inRefSelectionMode())return;this._reset();const u=this._sheetSkeletonManagerService.getCurrentParam().skeleton,h=Yi(u);this._addSelectionControlByModelData(h),this.refreshSelectionMoveEnd(),c.button!==2&&d.stopPropagation()}))}_initThemeChangeListener(){this.disposeWithMe(this._themeService.currentTheme$.subscribe(()=>{this._initSelectionThemeFromThemeService();const e=this._workbookSelections.getCurrentSelections();e&&this.resetSelectionsByModelData(e)}))}_initSelectionModelChangeListener(){this.disposeWithMe(O.merge(this._workbookSelections.selectionMoveEnd$,this._workbookSelections.selectionSet$).subscribe(e=>{this.resetSelectionsByModelData(e)}))}disableSelection(){this._contextService.setContextValue(m.SELECTIONS_ENABLED,!1)}enableSelection(){this._contextService.setContextValue(m.SELECTIONS_ENABLED,!0)}transparentSelection(){const e=this._themeService.getCurrentTheme(),t=a.set(e,"primary.600","transparent");this.setSelectionTheme(t);const r=this._workbookSelections.getCurrentSelections();for(let i=0;i<r.length;i++){const s=r[i];s.style=mt(this._selectionTheme)}this.resetSelectionsByModelData(r)}showSelection(){const e=this._themeService.getCurrentTheme();this.setSelectionTheme(e);const t=this._workbookSelections.getCurrentSelections();for(let r=0;r<t.length;r++){const i=t[r];i.style&&(i.style=mt(this._selectionTheme))}this.resetSelectionsByModelData(t)}_initUserActionSyncListener(){this.disposeWithMe(this.selectionMoveStart$.subscribe(e=>this._updateSelections(e,m.SelectionMoveType.MOVE_START))),this.disposeWithMe(this.selectionMoving$.subscribe(e=>this._updateSelections(e,m.SelectionMoveType.MOVING))),this.disposeWithMe(this._contextService.subscribeContextValue$(m.REF_SELECTIONS_ENABLED).pipe(O.startWith(!1),O.distinctUntilChanged()).subscribe(e=>{e&&this._reset()})),this.disposeWithMe(this._contextService.subscribeContextValue$(m.SELECTIONS_ENABLED).pipe(O.startWith(!0),O.distinctUntilChanged()).subscribe(e=>{var t;e?this._renderDisposable=a.toDisposable(this.selectionMoveEnd$.subscribe(r=>{this._updateSelections(r,m.SelectionMoveType.MOVE_END)})):((t=this._renderDisposable)==null||t.dispose(),this._renderDisposable=null,this._reset())}))}_updateSelections(e,t){const r=this._context.unit,i=r.getUnitId(),s=r.getActiveSheet().getSheetId();if(e.length===0)return;const l=e.map(c=>m.convertSelectionDataToRange(c));this._commandService.executeCommand(m.SetSelectionsOperation.id,{unitId:i,subUnitId:s,type:t,selections:l})}_initSkeletonChangeListener(){this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(e=>{var u,h;if(e==null){this._logService.error("[SelectionRenderService]: should not receive null!");return}const t=this._context.unitId,{sheetId:r,skeleton:i}=e,{scene:s}=this._context,l=s.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN),c=(h=(u=this._skeleton)==null?void 0:u.worksheet)==null?void 0:h.getSheetId();if(this._changeRuntime(i,s,l),c!==i.worksheet.getSheetId()){const g=this._workbookSelections.getCurrentSelections();this._commandService.syncExecuteCommand(m.SetSelectionsOperation.id,{unitId:t,subUnitId:r,selections:g.length!==0?g:[Mo(i)]})}const d=this._workbookSelections.getCurrentSelections();d!=null&&this.resetSelectionsByModelData(d)}))}_getActiveViewport(e){const t=this._getSheetObject();return t==null?void 0:t.scene.getActiveViewportByCoord(T.Vector2.FromArray([e.offsetX,e.offsetY]))}_getSheetObject(){return Ne(this._context.unit,this._context)}_onPointerDown(e,t=0,r=a.RANGE_TYPE.NORMAL,i,s=T.ScrollTimerType.ALL){var N,V;this._rangeType=r;const l=this._skeleton,c=this._scene;if(!c||!l)return;i&&(this._activeViewport=i);const{offsetX:d,offsetY:u}=e,h=c.getViewport(T.SHEET_VIEWPORT_KEY.VIEW_MAIN);if(!h)return;const g=c.getCoordRelativeToViewport(T.Vector2.FromArray([d,u])),{x:S,y:p}=g;this._startViewportPosX=S,this._startViewportPosY=p;const f=c.getScrollXYInfoByViewport(g),{scaleX:v,scaleY:C}=c.getAncestorScale(),_=this._skeleton.getCellByOffset(S,p,v,C,f);if(!_)return;switch(r){case a.RANGE_TYPE.NORMAL:break;case a.RANGE_TYPE.ROW:_.startColumn=0,_.endColumn=this._skeleton.getColumnCount()-1,_.startRow=_.actualRow,_.endRow=_.actualRow;break;case a.RANGE_TYPE.COLUMN:_.startRow=0,_.endRow=this._skeleton.getRowCount()-1,_.startColumn=_.actualColumn,_.endColumn=_.actualColumn;break;case a.RANGE_TYPE.ALL:_.startRow=0,_.startColumn=0,_.endRow=this._skeleton.getRowCount()-1,_.endColumn=this._skeleton.getColumnCount()-1}const R={range:_,primary:_,style:null};R.range.rangeType=r;const w=ye(R,this._skeleton);this._startRangeWhenPointerDown={...w.rangeWithCoord};let P=this.getActiveSelectionControl();const y={...w.rangeWithCoord,rangeType:r},M=this.getSelectionControls();for(const H of M)if(e.button===2&&a.Rectangle.contains(H.model,y)){P=H;return}this._checkClearPreviousControls(e);const x=P==null?void 0:P.model.currentCell,A=e.shiftKey&&x,D=this._remainLastEnabled&&!e.ctrlKey&&!e.shiftKey&&!this._skipLastEnabled&&!this._singleSelectionEnabled;A?this._makeSelectionByTwoCells(x,y,l,r,P):D&&P?P.updateRangeBySelectionWithCoord(w):P=this.newSelectionControl(c,l,R);for(let H=0;H<this.getSelectionControls().length-1;H++)this.getSelectionControls()[H].clearHighlight();c.disableObjectsEvent(),this._clearUpdatingListeners(),this._addEndingListeners(),(N=c.getTransformer())==null||N.clearSelectedObjects(),this._setupPointerMoveListener(h,P,r,s,S,p),this._escapeShortcutDisposable=this._shortcutService.forceEscape(),this._selectionMoveStart$.next(this.getSelectionDataWithStyle()),this._scenePointerUpSub=c.onPointerUp$.subscribeEvent(()=>{var H;this._clearUpdatingListeners(),this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()),(H=this._escapeShortcutDisposable)==null||H.dispose(),this._escapeShortcutDisposable=null}),(V=this._scene.getEngine())==null||V.setCapture()}};exports.SheetSelectionRenderService=rv([ct(1,a.Inject(a.Injector)),ct(2,a.Inject(a.ThemeService)),ct(3,I.IShortcutService),ct(4,a.Inject(m.SheetsSelectionsService)),ct(5,a.Inject(exports.SheetSkeletonManagerService)),ct(6,a.ILogService),ct(7,a.ICommandService),ct(8,a.IContextService)],exports.SheetSelectionRenderService);var ov=Object.defineProperty,iv=Object.getOwnPropertyDescriptor,sv=(n,o,e)=>o in n?ov(n,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[o]=e,av=(n,o,e,t)=>{for(var r=t>1?void 0:t?iv(o,e):o,i=n.length-1,s;i>=0;i--)(s=n[i])&&(r=s(r)||r);return r},qn=(n,o)=>(e,t)=>o(e,t,n),rd=(n,o,e)=>sv(n,typeof o!="symbol"?o+"":o,e);exports.UniverSheetsUIPlugin=class extends a.Plugin{constructor(o=io,e,t,r,i,s){super(),this._config=o,this._injector=e,this._renderManagerService=t,this._configService=r,this._univerInstanceService=i,this._componentManager=s;const{menu:l,...c}=a.merge({},io,this._config);if(c.protectedRangeUserSelector){const{component:d,framework:u}=c.protectedRangeUserSelector;this.disposeWithMe(this._componentManager.register(fr,d,{framework:u}))}l&&this._configService.setConfig("menu",l,{merge:!0}),this._configService.setConfig(Ee,{...c})}onStarting(){a.registerDependencies(this._injector,a.mergeOverrideWithDependencies([[Cn],[he,{useClass:exports.EditorBridgeService}],[ke,{useClass:exports.SheetClipboardService}],[Xt,{useClass:Ja}],[Xe,{useClass:oo}],[Hn,{useClass:ss}],[Vn,{useClass:pl}],[m.IRefSelectionsService,{useClass:m.RefSelectionsService}],[pt,{useClass:exports.AutoFillService}],[ys],[Dr,{useClass:gs}],[Lt,{useClass:exports.MarkSelectionService}],[exports.HoverManagerService],[exports.DragManagerService],[exports.SheetCanvasPopManagerService],[exports.CellPopupManagerService],[exports.CellAlertManagerService],[ns],[Ts,{useClass:exports.SheetCellDropdownManagerService}],[exports.SheetCellEditorResizeService],[bn],[exports.AutoHeightController],[exports.AutoWidthController],[exports.FormulaEditorController],[exports.SheetsRenderService],[exports.SheetUIController],[exports.StatusBarController],[exports.AutoFillController],[Tn],[wn],[En],[Rn],[exports.EditingRenderController],[Vt],[yn],[ft],[exports.SheetPermissionRenderManagerService],[Mn],[exports.SheetPermissionCheckUIController],[Pn]],this._config.override))}onReady(){this._config.disableAutoFocus||this._initAutoFocus(),a.registerDependencies(this._injector,[[Ut]]),this._registerRenderBasics(),a.touchDependencies(this._injector,[[exports.SheetUIController],[exports.SheetsRenderService],[bn],[exports.SheetPermissionCheckUIController],[yn]])}onRendered(){this._registerRenderModules(),a.touchDependencies(this._injector,[[Pn],[Vt],[Ut],[exports.FormulaEditorController],[wn],[exports.StatusBarController],[exports.AutoHeightController],[exports.AutoWidthController],[En],[Rn],[exports.EditingRenderController]])}onSteady(){a.touchDependencies(this._injector,[[Tn],[exports.AutoFillController],[Mn]])}_registerRenderBasics(){[[exports.SheetSkeletonManagerService],[Ro],[exports.SheetRenderController],[Ce,{useClass:exports.SheetSelectionRenderService}],[wo]].forEach(o=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(a.UniverInstanceType.UNIVER_SHEET,o))})}_registerRenderModules(){var r;const o=[[exports.HeaderMoveRenderController],[bo],[exports.HeaderResizeRenderController],[exports.SheetScrollManagerService],[exports.SheetsScrollRenderController],[exports.HeaderFreezeRenderController],[ir],[Io],[Co],[lo],[co],[ho],[exports.HoverRenderController],[exports.DragRenderController],[uo],[exports.CellCustomRenderController],[Fi],[go],[ar],[So],[po],[fo],[vo]],e=this._configService.getConfig(I.UI_PLUGIN_CONFIG_KEY);((r=e==null?void 0:e.contextMenu)!=null?r:!0)&&o.push([_o]),o.forEach(i=>{this.disposeWithMe(this._renderManagerService.registerRenderModule(a.UniverInstanceType.UNIVER_SHEET,i))})}_initAutoFocus(){const o=this._univerInstanceService;this.disposeWithMe(o.getCurrentTypeOfUnit$(a.UniverInstanceType.UNIVER_SHEET).pipe(de.filter(e=>!!e)).subscribe(e=>o.focusUnit(e.getUnitId())))}};rd(exports.UniverSheetsUIPlugin,"pluginName","SHEET_UI_PLUGIN");rd(exports.UniverSheetsUIPlugin,"type",a.UniverInstanceType.UNIVER_SHEET);exports.UniverSheetsUIPlugin=av([a.DependentOn(m.UniverSheetsPlugin),qn(1,a.Inject(a.Injector)),qn(2,T.IRenderManagerService),qn(3,a.IConfigService),qn(4,a.IUniverInstanceService),qn(5,a.Inject(I.ComponentManager))],exports.UniverSheetsUIPlugin);function lv(n,o,e,t){const{from:r,to:i}=e,{column:s,columnOffset:l,row:c,rowOffset:d}=r,{column:u,columnOffset:h,row:g,rowOffset:S}=i,p=t.ensureSkeleton(o);if(p==null)throw new Error("No current skeleton");const f=un(p,{startColumn:s,endColumn:s,startRow:c,endRow:c}),v=un(p,{startColumn:u,endColumn:u,startRow:g,endRow:g}),{startX:C,startY:_}=f,{startX:R,startY:w}=v,P=T.precisionTo(C+l,1),y=T.precisionTo(_+d,1);let M=T.precisionTo(R+h-P,1),x=T.precisionTo(w+S-y,1);return f.startX===v.endX&&(M=0),f.startY===v.endY&&(x=0),{unitId:n,subUnitId:o,left:P,top:y,width:M,height:x}}function cv(n,o,e,t,r,i,s){const{column:l,columnOffset:c,row:d,rowOffset:u}=e,h=s.ensureSkeleton(o);if(h==null)throw new Error("No current skeleton");const g=un(h,{startColumn:l,endColumn:l,startRow:d,endRow:d}),{startX:S,startY:p}=g,f=T.precisionTo(S+c,1),v=T.precisionTo(p+u,1),C=i.getCellWithCoordByOffset(f+t,v+r,h);if(C==null)throw new Error("No end selection cell");const _={column:C.actualColumn,columnOffset:T.precisionTo(f+t-C.startX,1),row:C.actualRow,rowOffset:T.precisionTo(v+r-C.startY,1)};return{unitId:n,subUnitId:o,sheetTransform:{from:{column:l,columnOffset:c,row:d,rowOffset:u},to:_},transform:{left:f,top:v,width:t,height:r}}}exports.AFFECT_LAYOUT_STYLES=ka;exports.APPLY_TYPE=ae;exports.AddRangeProtectionFromContextMenuCommand=Mt;exports.AddRangeProtectionFromSheetBarCommand=Cr;exports.AddRangeProtectionFromToolbarCommand=vr;exports.ApplyFormatPainterCommand=wr;exports.AutoClearContentCommand=mn;exports.AutoFillCommand=dt;exports.BaseSelectionRenderService=Xi;exports.COPY_TYPE=et;exports.CellAlertType=dn;exports.CellEditorManagerService=ss;exports.ChangeSheetProtectionFromSheetBarCommand=xr;exports.ChangeZoomRatioCommand=Nn;exports.DATA_TYPE=Ie;exports.DeleteRangeMoveLeftConfirmCommand=xn;exports.DeleteRangeMoveUpConfirmCommand=kt;exports.DeleteRangeProtectionFromContextMenuCommand=xt;exports.DeleteWorksheetProtectionFormSheetBarCommand=Pr;exports.EMBEDDING_FORMULA_EDITOR=Vl;exports.EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY=yo;exports.ExpandSelectionCommand=Oe;exports.FormatPainterStatus=xe;exports.FormulaBar=fl;exports.HideColConfirmCommand=gr;exports.HideRowConfirmCommand=mr;exports.IAutoFillService=pt;exports.ICellEditorManagerService=Hn;exports.IEditorBridgeService=he;exports.IFormatPainterService=Xe;exports.IFormulaEditorManagerService=Vn;exports.IMarkSelectionService=Lt;exports.ISheetCellDropdownManagerService=Ts;exports.ISheetClipboardService=ke;exports.ISheetSelectionRenderService=Ce;exports.IStatusBarService=Dr;exports.InsertRangeMoveDownConfirmCommand=Ht;exports.InsertRangeMoveRightConfirmCommand=On;exports.JumpOver=Ye;exports.MobileSheetBar=Zc;exports.MoveSelectionCommand=Me;exports.MoveSelectionEnterAndTabCommand=Ze;exports.PASTE_SPECIAL_MENU_ID=tr;exports.PREDEFINED_HOOK_NAME=ge;exports.RANGE_SELECTOR_COMPONENT_KEY=ji;exports.RANGE_SELECTOR_SYMBOLS=kl;exports.RefillCommand=_r;exports.RemoveColConfirmCommand=vn;exports.RemoveRowConfirmCommand=fn;exports.RemoveSheetConfirmCommand=br;exports.RenameSheetOperation=Ar;exports.RenderSheetContent=Ss;exports.RenderSheetFooter=Il;exports.RenderSheetHeader=_l;exports.ResetRangeTextColorCommand=Ao;exports.ResetScrollCommand=Yu;exports.SELECTION_SHAPE_DEPTH=zi;exports.SHEET_UI_PLUGIN_NAME=ah;exports.SHEET_VIEW_KEY=ue;exports.ScrollCommand=Ue;exports.ScrollToCellCommand=rs;exports.ScrollToRangeOperation=ko;exports.SelectAllCommand=yr;exports.SelectionControl=ur;exports.SelectionShape=ur;exports.SelectionShapeExtension=Da;exports.SetActivateCellEditOperation=No;exports.SetCellEditVisibleArrowOperation=Wt;exports.SetCellEditVisibleOperation=Se;exports.SetCellEditVisibleWithF2Operation=Or;exports.SetColumnFrozenCommand=Tr;exports.SetColumnHeaderHeightCommand=dr;exports.SetFormatPainterOperation=Rr;exports.SetInfiniteFormatPainterCommand=Do;exports.SetOnceFormatPainterCommand=An;exports.SetRangeBoldCommand=Bt;exports.SetRangeFontFamilyCommand=pr;exports.SetRangeFontSizeCommand=Sr;exports.SetRangeItalicCommand=Ft;exports.SetRangeProtectionFromContextMenuCommand=Ot;exports.SetRangeStrickThroughCommand=zt;exports.SetRangeSubscriptCommand=es;exports.SetRangeSuperscriptCommand=ts;exports.SetRangeTextColorCommand=pn;exports.SetRangeUnderlineCommand=jt;exports.SetRowFrozenCommand=Er;exports.SetRowHeaderWidthCommand=cr;exports.SetScrollOperation=We;exports.SetScrollRelativeCommand=In;exports.SetSelectionFrozenCommand=rt;exports.SetWorksheetColAutoWidthCommand=Dn;exports.SetZoomRatioCommand=kn;exports.SetZoomRatioOperation=De;exports.SheetBar=vl;exports.SheetCopyCommand=He;exports.SheetCutCommand=xo;exports.SheetMenuPosition=Gl;exports.SheetPasteBesidesBorderCommand=an;exports.SheetPasteColWidthCommand=yt;exports.SheetPasteCommand=Ve;exports.SheetPasteFormatCommand=sn;exports.SheetPasteShortKeyCommand=to;exports.SheetPasteValueCommand=on;exports.SheetPermissionOpenDialogOperation=os;exports.SheetPermissionOpenPanelOperation=je;exports.SheetPermissionUserManagerService=ft;exports.SheetPrintInterceptorService=ys;exports.SheetsUIMenuSchema=ec;exports.SheetsUIPart=is;exports.ShowMenuListCommand=Mr;exports.SidebarDefinedNameOperation=Ho;exports.StatusBarService=gs;exports.UNIVER_SHEET_PERMISSION_USER_PART=fr;exports.ViewSheetPermissionFromContextMenuCommand=Pt;exports.ViewSheetPermissionFromSheetBarCommand=Ir;exports.attachPrimaryWithCoord=nr;exports.attachRangeWithCoord=un;exports.attachSelectionWithCoord=ye;exports.calculateDocSkeletonRects=Wl;exports.checkInHeaderRanges=lr;exports.convertPositionCellToSheetOverGrid=cv;exports.convertPositionSheetOverGridToAbsolute=lv;exports.deriveStateFromActiveSheet$=_e;exports.discreteRangeToRange=gt;exports.functionDisplayNames=Gr;exports.genNormalSelectionStyle=mt;exports.genSelectionByRange=Na;exports.getAllSelection=Yi;exports.getAutoFillRepeatRange=Nd;exports.getCellRealRange=tl;exports.getCoordByCell=xi;exports.getCoordByOffset=ze;exports.getCurrentExclusiveRangeInterest$=Fl;exports.getCurrentRangeDisable$=ee;exports.getCustomRangePosition=Nm;exports.getEditingCustomRangePosition=km;exports.getEditorObject=To;exports.getMatrixPlainText=Fa;exports.getObservableWithExclusiveRange$=Zt;exports.getRepeatRange=hu;exports.getSheetObject=Ne;exports.getTopLeftSelectionOfCurrSheet=Mo;exports.getTransformCoord=er;exports.isEmbeddingFormulaEditor=xm;exports.isRangeSelector=Hl;exports.mergeSetRangeValues=Mi;exports.useActiveWorkbook=vt;exports.useActiveWorksheet=ih;exports.useHighlightRange=Fc;exports.useKeyEventConfig=ms;exports.useWorkbooks=sh;exports.virtualizeDiscreteRanges=St;exports.whenFormulaEditorActivated=Xd;exports.whenSheetEditorFocused=se;
