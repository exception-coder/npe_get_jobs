var Bp = Object.defineProperty;
var Fp = (r, e, t) => e in r ? Bp(r, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : r[e] = t;
var _ = (r, e, t) => Fp(r, typeof e != "symbol" ? e + "" : e, t);
import { DOCS_VIEW_KEY as Up, SetInlineFormatBoldCommand as Xp, SetInlineFormatItalicCommand as zp, SetInlineFormatUnderlineCommand as jp, SetInlineFormatStrikethroughCommand as Yp, SetInlineFormatSubscriptCommand as Zp, SetInlineFormatSuperscriptCommand as Gp, SetInlineFormatFontSizeCommand as qp, SetInlineFormatFontFamilyCommand as Qp, SetInlineFormatTextColorCommand as Yh, IEditorService as Ni, getCanvasOffsetByEngine as vu, VIEWPORT_KEY as ks, DOCS_COMPONENT_MAIN_LAYER_INDEX as Kp, DocSelectionRenderService as Qn, BreakLineCommand as Jp, DeleteLeftCommand as Zh, DeleteRightCommand as $p, ReplaceSnapshotCommand as Gh, MoveSelectionOperation as ev, MoveCursorOperation as tv, CoverContentCommand as nv, NodePositionConvertToCursor as qh, getLineBounding as Qh, DOC_VERTICAL_PADDING as rv, SetInlineFormatCommand as Lo, IMEInputCommand as iv, InsertCommand as ov, convertBodyToHtml as sv } from "@univerjs/docs-ui";
import { CommandType as J, createInterceptorKey as Nn, ColorKit as fn, RANGE_TYPE as z, convertCellToRange as Ds, UniverInstanceType as O, IUniverInstanceService as k, Quantity as bc, Disposable as oe, toDisposable as We, Tools as de, createIdentifier as Yt, InterceptorManager as ki, ThemeService as Ht, Inject as N, Injector as Rt, IConfigService as Vt, generateRandomId as xn, ObjectMatrix as Ge, Direction as U, isFormulaString as od, isFormulaId as lv, CellValueType as yt, numfmt as Bt, ICommandService as W, IUndoRedoService as Zt, Rectangle as se, sequenceExecute as Wo, FOCUSING_SHEET as Nt, FOCUSING_UNIVER_EDITOR as Pr, EDITOR_ACTIVATED as Je, FOCUSING_COMMON_DRAWINGS as Dl, FOCUSING_FX_BAR_EDITOR as Ot, FOCUSING_EDITOR_INPUT_FORMULA as Ls, FOCUSING_EDITOR_STANDALONE as Ll, LRUMap as av, BaselineOffset as Su, BooleanNumber as Ke, DataStreamTreeTokenType as cv, skipParseTagNames as dv, CustomRangeType as sd, DEFAULT_WORKSHEET_ROW_HEIGHT as _c, ILogService as Wl, LocaleService as xe, ErrorService as uv, CellModeEnum as Kh, isNotNullOrUndefined as hv, extractPureTextFromCell as Jh, getReverseDirection as $h, IContextService as De, Workbook as gv, DOCS_NORMAL_EDITOR_UNIT_ID_KEY as Oe, Optional as ld, DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY as Ae, RxDisposable as kn, DisposableCollection as ht, IPermissionService as rt, fromEventSubject as Ws, sortRules as mv, nameCharacterCheck as fv, throttle as pv, debounce as Rc, VerticalAlign as cn, HorizontalAlign as It, WrapStrategy as mr, LocaleType as Cu, FOCUSING_EDITOR_BUT_HIDDEN as Ic, DEFAULT_EMPTY_DOCUMENT_VALUE as eg, isTextFormat as Bo, PresetListType as vv, UserManagerService as Ft, DEFAULT_STYLES as Fo, FontWeight as gs, FontItalic as ms, composeStyles as Sv, Dimension as tg, get as Aa, BorderStyleTypes as Pe, AbsoluteRefType as wu, NilCommand as ad, splitIntoGrid as Cv, UndoCommandId as wv, willLoseNumericPrecision as bv, Range as Ts, cellToRange as _v, handleStyleToString as bu, DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY as _u, DEFAULT_WORKSHEET_COLUMN_WIDTH as Ru, DocumentFlavor as Rv, isRealNum as ng, InterceptorEffectEnum as Iv, IAuthzIoService as Bl, isValidRange as yv, dayjs as fs, BuildTextUtils as Mv, DependentOn as rg, Plugin as ig, merge as og, registerDependencies as Bs, mergeOverrideWithDependencies as sg, touchDependencies as $r, set as Ev } from "@univerjs/core";
import { SELECTION_CONTROL_BORDER_BUFFER_WIDTH as Fs, SELECTION_CONTROL_BORDER_BUFFER_COLOR as ps, convertPrimaryWithCoordToPrimary as Tv, SELECTIONS_ENABLED as Zr, REF_SELECTIONS_ENABLED as vo, SheetSkeletonService as Pv, SheetsSelectionsService as Q, SheetInterceptorService as vn, MarkDirtyRowAutoHeightMutation as lg, CancelMarkDirtyRowAutoHeightMutation as ag, getSheetCommandTarget as Xe, SetWorksheetRowAutoHeightMutationFactory as cg, SetWorksheetRowAutoHeightMutation as er, rangeToDiscreteRange as co, SetSelectionsOperation as Ie, SetRangeValuesMutation as we, generateNullCellValue as xv, SetRangeValuesUndoMutationFactory as $t, SetWorksheetActiveOperation as nt, getPrimaryForRange as dg, DeleteRangeMoveLeftCommand as Iu, DeleteRangeMoveUpCommand as yu, alignToMergedCellsBorders as En, SetRowHiddenCommand as ug, SetColHiddenCommand as hg, SetBoldCommand as cd, SetItalicCommand as dd, SetUnderlineCommand as ud, SetStrikeThroughCommand as hd, SetFontSizeCommand as gd, SetFontFamilyCommand as md, SetTextColorCommand as gg, InsertRangeMoveDownCommand as yc, InsertRangeMoveRightCommand as Mc, EditStateEnum as sn, ViewStateEnum as di, UnitObject as Dt, WorksheetProtectionRuleModel as ft, DeleteWorksheetProtectionCommand as Us, RangeProtectionRuleModel as $e, DeleteRangeProtectionMutation as Mu, AddRangeProtectionMutation as Ov, RemoveRowCommand as mg, RemoveColCommand as fg, RemoveSheetCommand as Av, SetFrozenMutationFactory as pg, SetFrozenMutation as fr, getSelectionsService as Uo, SelectionMoveType as At, getCellAtRowCol as Ps, expandToContinuousRange as Hv, ScrollToCellOperation as fd, SetWorksheetColWidthMutation as ln, BEFORE_CELL_EDIT as Vv, AddWorksheetProtectionCommand as vg, SetRangeValuesCommand as Fl, MoveRangeMutation as tr, RemoveRowMutation as Xo, RemoveColMutation as zo, InsertRowMutation as jo, InsertColMutation as Yo, MoveRowsMutation as Ul, MoveColsMutation as Xl, SetWorksheetRowHeightMutation as So, RemoveSheetMutation as On, RemoveMergeUndoMutationFactory as zl, RemoveWorksheetMergeMutation as Qt, AddWorksheetMergeMutation as Kt, getAddMergeMutationRangeByType as jl, AddMergeUndoMutationFactory as Yl, WorkbookEditablePermission as K, WorksheetEditPermission as te, UnitAction as Co, SetWorksheetShowCommand as pd, RangeProtectionCache as Zo, WorksheetViewPermission as Sg, SetWorksheetOrderMutation as vd, InsertSheetMutation as xr, SetWorksheetNameMutation as Sd, SetWorksheetHideMutation as nr, SetWorksheetActivateCommand as Cd, WorkbookManageCollaboratorPermission as Cg, WorkbookRenameSheetPermission as wg, SetWorksheetOrderCommand as Nv, SetWorksheetNameCommand as kv, SetTabColorMutation as Dv, WorkbookCreateSheetPermission as bg, InsertSheetCommand as Lv, ClearSelectionFormatCommand as uo, COMMAND_LISTENER_SKELETON_CHANGE as Xs, adjustRangeOnMutation as Wv, RangeProtectionPermissionEditPoint as ie, IExclusiveRangeService as Bv, BorderStyleManagerService as Ec, WorksheetSetCellStylePermission as Ze, SetBorderBasicCommand as Tc, ClearSelectionAllCommand as io, WorksheetSetCellValuePermission as qt, ClearSelectionContentCommand as pr, WorkbookDeleteRowPermission as Fv, WorksheetDeleteRowPermission as Uv, WorkbookDeleteColumnPermission as Xv, WorksheetDeleteColumnPermission as zv, ToggleGridlinesCommand as _g, ToggleGridlinesMutation as jv, InsertMultiRowsAfterCommand as Rg, WorkbookInsertRowPermission as Zl, WorksheetInsertRowPermission as Gl, InsertMultiRowsAboveCommand as Ig, InsertMultiColsRightCommand as yg, WorkbookInsertColumnPermission as ql, WorksheetInsertColumnPermission as Ql, InsertMultiColsLeftCommand as Mg, InsertColBeforeCommand as Eg, InsertRowBeforeCommand as Tg, CancelFrozenCommand as xs, SetWorksheetRowIsAutoHeightCommand as wd, WorksheetSetRowStylePermission as Or, SetRowHeightCommand as Pg, SetRowHiddenMutation as xg, SetRowVisibleMutation as Og, SetSelectedRowsVisibleCommand as Ag, WorksheetSetColumnStylePermission as Ar, SetColWidthCommand as Hg, SetColHiddenMutation as Vg, SetColVisibleMutation as Ng, SetSelectedColsVisibleCommand as kg, SetTextRotationCommand as Pc, SetTextWrapCommand as xc, SetVerticalTextAlignCommand as Oc, SetHorizontalTextAlignCommand as Ac, ResetBackgroundColorCommand as Dg, SetBackgroundColorCommand as zs, WorksheetCopyPermission as js, RangeProtectionPermissionViewPoint as Hc, WorkbookCopyPermission as oo, SetWorksheetRowIsAutoHeightMutation as Yv, AddMergeRedoSelectionsOperationFactory as Zv, AddMergeUndoSelectionsOperationFactory as Gv, MergeCellController as qv, MERGE_CELL_INTERCEPTOR_CHECK as Qv, RemoveWorksheetMergeCommand as Lg, WorkbookCreateProtectPermission as Kl, WorksheetDeleteProtectionPermission as Wg, WorksheetManageCollaboratorPermission as Kv, SetWorksheetHideCommand as Bg, SetTabColorCommand as Fg, CopySheetCommand as Ug, WorkbookDeleteSheetPermission as Jv, WorkbookHideSheetPermission as Xg, AddWorksheetMergeCommand as $v, AddWorksheetMergeHorizontalCommand as eS, AddWorksheetMergeVerticalCommand as tS, AddWorksheetMergeAllCommand as nS, ResetTextColorCommand as rS, SheetPermissionCheckController as bd, SetFrozenCommand as iS, InsertRowCommand as oS, InsertColCommand as sS, MoveColsCommand as zg, MoveRowsCommand as jg, DeltaRowHeightCommand as lS, DeltaColumnWidthCommand as aS, COMMAND_LISTENER_VALUE_CHANGE as cS, RefRangeService as dS, IRefSelectionsService as _d, SCOPE_WORKBOOK_VALUE_DEFINED_NAME as Vc, InsertDefinedNameCommand as uS, SetDefinedNameCommand as hS, RemoveDefinedNameCommand as gS, INumfmtService as mS, ToggleCellCheckboxCommand as fS, MoveRangeCommand as Yg, MAX_CELL_PER_SHEET_KEY as pS, INTERCEPTOR_POINT as vS, SheetPermissionInitController as SS, SetProtectionCommand as CS, AddRangeProtectionCommand as wS, setEndForRange as bS, baseProtectionActions as _S, DeleteRangeProtectionCommand as RS, WorksheetProtectionPointModel as IS, SetWorksheetPermissionPointsCommand as yS, getAllWorksheetPermissionPoint as MS, SetSpecificRowsVisibleCommand as ES, SetSpecificColsVisibleCommand as TS, convertSelectionDataToRange as Zg, UniverSheetsPlugin as Gg, RefSelectionsService as qg } from "@univerjs/sheets";
import { IRenderManagerService as fe, withCurrentTypeOfRenderer as Rd, SHEET_VIEWPORT_KEY as F, CURSOR_TYPE as ye, Vector2 as ke, Rect as Se, ScrollTimer as ei, ScrollTimerType as bt, DashedRect as PS, Group as Ha, TRANSFORM_CHANGE_OBSERVABLE_TYPE as Nc, cancelRequestFrame as xS, requestNewFrame as OS, FIX_ONE_PIXEL_BLUR_OFFSET as AS, Layer as HS, SpreadsheetSkeleton as VS, ptToPixel as Eu, RENDER_CLASS_TYPE as NS, DeviceInputEventType as je, convertTransformToOffsetX as Gr, convertTransformToOffsetY as qr, convertTextRotation as Id, RENDER_RAW_FORMULA_KEY as kS, Spreadsheet as Qg, getCurrentTypeOfRenderer as Go, ScrollBar as yd, fixLineWidthByScale as Tu, Shape as Md, SHEET_EXTENSION_PREFIX as Pu, SpreadsheetRowHeader as DS, SpreadsheetColumnHeader as LS, Viewport as Cn, hasCJKText as WS, DEFAULT_PADDING_DATA as BS, SheetExtension as Kg, RegularPolygon as so, precisionTo as Gn } from "@univerjs/engine-render";
import { BehaviorSubject as Me, Subject as He, switchMap as lt, map as Be, of as Ce, merge as St, startWith as xt, takeUntil as ui, distinctUntilChanged as dn, throttleTime as Ys, EMPTY as xu, filter as qo, combineLatest as at, Observable as Fe, combineLatestWith as or, shareReplay as Ou, Subscription as Kn, withLatestFrom as FS } from "rxjs";
import { handleStringToStyle as US, textTrim as Au, IClipboardInterfaceService as Jl, INotificationService as XS, IPlatformService as zS, PLAIN_TEXT_CLIPBOARD_MIME_TYPE as Hu, HTML_CLIPBOARD_MIME_TYPE as Vu, imageMimeTypeSet as jS, FILE__BMP_CLIPBOARD_MIME_TYPE as YS, FILE__WEBP_CLIPBOARD_MIME_TYPE as ZS, FILE__JPEG_CLIPBOARD_MIME_TYPE as GS, FILE_PNG_CLIPBOARD_MIME_TYPE as qS, CopyCommand as QS, CutCommand as KS, PasteCommand as JS, SheetPasteShortKeyCommandName as $S, IConfirmService as tn, ISidebarService as Di, KeyCode as Y, IDialogService as Qo, useDependency as L, useObservable as dt, ComponentManager as kt, DISABLE_AUTO_FOCUS_KEY as Nu, useEvent as ku, useSidebarClick as Jg, MetaKeys as ve, useComponentsOfPart as eC, ComponentContainer as tC, useConfigValue as $l, UI_PLUGIN_CONFIG_KEY as ea, UIMenu as nC, ContextMenuPosition as _t, Slider as rC, IMessageService as $g, IMenuManagerService as Ed, ToolbarItem as iC, ILayoutService as Td, getMenuHiddenObservable as ce, MenuItemType as $, IContextMenuService as Pd, COLOR_PICKER_COMPONENT as xd, FONT_SIZE_LIST as oC, FONT_SIZE_COMPONENT as sC, FONT_FAMILY_LIST as lC, FONT_FAMILY_COMPONENT as aC, FONT_FAMILY_ITEM_COMPONENT as cC, ContextMenuGroup as Qe, RibbonPosition as dC, RibbonStartGroup as vs, ICanvasPopupService as uC, IShortcutService as ta, IUIPartsService as Od, BuiltInUIPart as ti, connectInjector as ni, IZenZoneService as em, RectPopup as hC, UniverMobileUIPlugin as gC } from "@univerjs/ui";
import { useRef as Tn, createElement as st, forwardRef as ut, useState as re, useMemo as Ct, useEffect as Ee, useCallback as An, useLayoutEffect as mC } from "react";
import { DocSkeletonManagerService as Jn, DocSelectionManagerService as Ad, RichTextEditingMutation as wo, SetTextSelectionsOperation as Ko } from "@univerjs/docs";
import { IDefinedNamesService as Jo, FUNCTION_NAMES_STATISTICAL as ze, FUNCTION_NAMES_MATH as na, FUNCTION_NAMES_TEXT as fC, sequenceNodeType as Va, matchToken as tm, LexerTreeBuilder as nm, IFunctionService as rm, SetFormulaCalculationNotificationMutation as pC, operatorToken as Yr, isReferenceStrings as im, isReferenceStringWithEffectiveColumn as vC, serializeRangeWithSheet as om, deserializeRangeWithSheet as sm, NullValueObject as Du, serializeRange as lm } from "@univerjs/engine-formula";
import { jsx as b, jsxs as q, Fragment as $o } from "react/jsx-runtime";
import { DropdownMenu as Hd, clsx as Te, borderClassName as Li, borderBottomClassName as Vd, scrollbarClassName as ra, borderRightClassName as Nd, Dropdown as kc, Button as jt, DropdownLegacy as SC, Tooltip as Zn, MessageType as am, InputNumber as CC, Separator as wC, ColorPicker as cm, Input as Zs, RadioGroup as Dc, Radio as Qr, Select as dm, Confirm as bC, FormLayout as Gs, Avatar as kd, Switch as _C, borderTopClassName as qs, CascaderList as RC, TimeInput as IC, Calendar as yC } from "@univerjs/design";
import { startWith as Na, shareReplay as Lu, switchMap as Pn, map as pn, debounceTime as ia, filter as um } from "rxjs/operators";
import { ITelemetryService as MC } from "@univerjs/telemetry";
function Dd(r, e) {
  if (r == null)
    return;
  const t = e.getRenderById(r);
  if (t == null)
    return;
  const { mainComponent: n, scene: i, engine: o, components: s } = t, l = n, a = s.get(Up.BACKGROUND);
  return {
    document: l,
    docBackground: a,
    scene: i,
    engine: o
  };
}
const Lc = [10, 400], hm = "RANGE_SELECTOR_COMPONENT_KEY", Ld = "EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY";
var Ye = /* @__PURE__ */ ((r) => (r.MAIN = "__SpreadsheetRender__", r.ROW = "__SpreadsheetRowHeader__", r.COLUMN = "__SpreadsheetColumnHeader__", r.LEFT_TOP = "__SpreadsheetLeftTopPlaceholder__", r))(Ye || {});
const Wu = 0, Qs = 1, rr = 10, EC = 11, Bu = 12, oa = {
  id: "sheet.command.set-row-header-width",
  type: J.COMMAND,
  handler: async (r, e) => {
    if (!e)
      return !1;
    const t = r.get(fe);
    if (!t)
      return !1;
    const { unitId: n, subUnitId: i, size: o } = e, s = t.getRenderById(n);
    if (s) {
      t.getRenderById(n).with(ue).setRowHeaderSize(s, i, o);
      const { components: a } = s, c = a.get(Ye.ROW);
      c && c.setCustomHeader({ headerStyle: { size: o } }, i);
    }
    return !0;
  }
}, sa = {
  id: "sheet.command.set-col-header-height",
  type: J.COMMAND,
  handler: async (r, e) => {
    if (!e)
      return !1;
    const t = r.get(fe);
    if (!t)
      return !1;
    const { unitId: n, subUnitId: i, size: o } = e, s = t.getRenderById(n);
    if (s) {
      t.getRenderById(n).with(ue).setColumnHeaderSize(s, i, o);
      const { components: a } = s, c = a.get(Ye.COLUMN);
      c && c.setCustomHeader({ headerStyle: { size: o } }, i);
    }
    return !0;
  }
}, Wc = Nn("rangeMovePermissionCheck"), Bc = Nn("rangeFillPermissionCheck");
var gm = /* @__PURE__ */ ((r) => (r[r.FORMULA_EDITOR_SHOW = 100] = "FORMULA_EDITOR_SHOW", r[r.MARK_SELECTION = 1e4] = "MARK_SELECTION", r))(gm || {});
function Sr(r) {
  const e = r.getColorFromTheme("primary.600"), t = r.getColorFromTheme("white"), n = new fn(e).setAlpha(0.07).toRgbString();
  return {
    strokeWidth: 1,
    stroke: e,
    fill: n,
    // widgets: { tl: true, tc: true, tr: true, ml: true, mr: true, bl: true, bc: true, br: true },
    widgets: {},
    widgetSize: 6,
    widgetStrokeWidth: 1,
    widgetStroke: t,
    autofillSize: 6,
    autofillStrokeWidth: 1,
    autofillStroke: t,
    rowHeaderFill: n,
    rowHeaderStroke: e,
    rowHeaderStrokeWidth: 1,
    columnHeaderFill: n,
    columnHeaderStroke: e,
    columnHeaderStrokeWidth: 1,
    expandCornerSize: 40
  };
}
class TC {
  constructor() {
    _(this, "_startColumn", -1);
    _(this, "_startRow", -1);
    _(this, "_endColumn", -1);
    _(this, "_endRow", -1);
    _(this, "_startX", 0);
    _(this, "_startY", 0);
    _(this, "_endX", 0);
    _(this, "_endY", 0);
    /**
     * The highlight cell of a selection. aka: current cell
     */
    _(this, "_primary");
    _(this, "_rangeType", z.NORMAL);
  }
  get startColumn() {
    return this._startColumn;
  }
  get startRow() {
    return this._startRow;
  }
  get endColumn() {
    return this._endColumn;
  }
  get endRow() {
    return this._endRow;
  }
  get startX() {
    return this._startX;
  }
  get startY() {
    return this._startY;
  }
  get endX() {
    return this._endX;
  }
  get endY() {
    return this._endY;
  }
  get currentCell() {
    return this._primary;
  }
  get rangeType() {
    return this._rangeType;
  }
  /**
   * @deprecated, Duplicate with `Rectangle`
   */
  isEqual(e) {
    const { startColumn: t, startRow: n, endColumn: i, endRow: o } = this, {
      startColumn: s,
      startRow: l,
      endColumn: a,
      endRow: c
    } = e;
    return t === s && n === l && i === a && o === c;
  }
  highlightToSelection() {
    if (this._primary)
      return Ds(this._primary);
  }
  getRange() {
    return {
      startColumn: this._startColumn,
      startRow: this._startRow,
      endColumn: this._endColumn,
      endRow: this._endRow,
      startX: this._startX,
      startY: this._startY,
      endX: this._endX,
      endY: this._endY,
      rangeType: this.rangeType
    };
  }
  getCell() {
    return this._primary;
  }
  getRangeType() {
    return this._rangeType;
  }
  setRangeType(e) {
    this._rangeType = e;
  }
  getValue() {
    return {
      rangeWithCoord: this.getRange(),
      primaryWithCoord: this._primary
    };
  }
  setValue(e, t) {
    const {
      startColumn: n,
      startRow: i,
      endColumn: o,
      endRow: s,
      startX: l,
      startY: a,
      endX: c,
      endY: d,
      rangeType: u
    } = e;
    this._startColumn = n, this._startRow = i, this._endColumn = o, this._endRow = s, this._startX = l, this._startY = a, this._endX = c, this._endY = d, u !== void 0 && (this._rangeType = u), t !== void 0 && this.setCurrentCell(t);
  }
  /**
   * Set primary cell.
   * @TODO lumixraku there are 3 concepts for same thing, primary and current and highlight
   * highlight is best. primary sometimes means the actual cell(actual means ignore merge)
   * @param currentCell
   */
  setCurrentCell(e) {
    this._primary = e;
  }
  clearCurrentCell() {
    this._primary = null;
  }
}
function bo(r, e) {
  const { startRow: t, startColumn: n, endRow: i, endColumn: o, rangeType: s } = e, l = i < t ? i : t, a = i < t ? t : i, c = o < n ? o : n, d = o < n ? n : o, u = r.getNoMergeCellWithCoordByIndex(l, c), h = r.getNoMergeCellWithCoordByIndex(a, d);
  return {
    startRow: t,
    startColumn: n,
    endRow: i,
    endColumn: o,
    rangeType: s,
    startY: (u == null ? void 0 : u.startY) || 0,
    endY: (h == null ? void 0 : h.endY) || 0,
    startX: (u == null ? void 0 : u.startX) || 0,
    endX: (h == null ? void 0 : h.endX) || 0
  };
}
function Wt(r, e) {
  const { range: t, primary: n, style: i } = r, o = bo(e, t), s = n && Ks(e, n);
  return {
    rangeWithCoord: o,
    primaryWithCoord: s,
    style: i
  };
}
function Ks(r, e) {
  const { actualRow: t, actualColumn: n, isMerged: i, isMergedMainCell: o, startRow: s, startColumn: l, endRow: a, endColumn: c } = e, d = r.getNoMergeCellWithCoordByIndex(t, n), u = r.getNoMergeCellWithCoordByIndex(s, l), h = r.getNoMergeCellWithCoordByIndex(a, c);
  return {
    actualRow: t,
    actualColumn: n,
    isMerged: i,
    isMergedMainCell: o,
    startX: d.startX,
    startY: d.startY,
    endX: d.endX,
    endY: d.endY,
    mergeInfo: {
      startRow: s,
      startColumn: l,
      endRow: a,
      endColumn: c,
      startY: (u == null ? void 0 : u.startY) || 0,
      endY: (h == null ? void 0 : h.endY) || 0,
      startX: (u == null ? void 0 : u.startX) || 0,
      endX: (h == null ? void 0 : h.endX) || 0
    }
  };
}
const Fu = "__SpreadsheetHelperSelectionTempRect", PC = 35;
class xC {
  constructor(e, t) {
    _(this, "_startOffsetX", 0);
    _(this, "_startOffsetY", 0);
    _(this, "_relativeSelectionPositionRow", 0);
    _(this, "_relativeSelectionPositionColumn", 0);
    _(this, "_relativeSelectionRowLength", 0);
    _(this, "_relativeSelectionColumnLength", 0);
    _(this, "_scenePointerMoveSub");
    _(this, "_scenePointerUpSub");
    _(this, "_disabled", !1);
    /**
     * The shadow selection under cursor when move whole selection control(for moving normal selection)
     */
    _(this, "_helperSelection");
    _(this, "_scrollTimer");
    _(this, "_activeViewport");
    _(this, "_targetSelection", {
      startY: 0,
      endY: 0,
      startX: 0,
      endX: 0,
      startRow: -1,
      endRow: -1,
      startColumn: -1,
      endColumn: -1
    });
    _(this, "_isInMergeState", !1);
    _(this, "_fillControlColors", []);
    _(this, "_skeleton");
    _(this, "_scene");
    _(this, "_themeService");
    _(this, "_injector");
    _(this, "_selectionHooks");
    this._control = e, this._skeleton = t.skeleton, this._scene = t.scene, this._themeService = t.themeService, this._injector = t.injector, this._selectionHooks = t.selectionHooks, this._initialControl(), this._initialWidget(), this._initialAutoFill(), this._control.dispose$.subscribe(() => {
      this.dispose();
    });
  }
  get isHelperSelection() {
    return this._control.isHelperSelection;
  }
  dispose() {
    var e, t;
    (e = this._scrollTimer) == null || e.dispose(), this._fillControlColors = [], this._clearObserverEvent(), (t = this._helperSelection) == null || t.dispose();
  }
  setDisabled(e) {
    this._disabled = e;
  }
  _getFreeze() {
    var t, n;
    return (n = (t = Rd(
      O.UNIVER_SHEET,
      ue,
      this._injector.get(k),
      this._injector.get(fe)
    )) == null ? void 0 : t.getCurrentParam()) == null ? void 0 : n.skeleton.getWorksheetConfig().freeze;
  }
  _isSelectionInViewport(e, t) {
    const n = this._getFreeze() || {
      startRow: -1,
      startColumn: -1
    };
    switch (t.viewportKey) {
      case F.VIEW_MAIN:
        return e.endRow >= n.startRow && e.endColumn >= n.startColumn;
      case F.VIEW_MAIN_TOP:
      case F.VIEW_COLUMN_RIGHT:
        return e.endColumn >= n.startColumn && e.startRow < n.startRow;
      case F.VIEW_MAIN_LEFT:
      case F.VIEW_ROW_BOTTOM:
        return e.endRow >= n.startRow && e.startColumn < n.startColumn;
      case F.VIEW_MAIN_LEFT_TOP:
      case F.VIEW_COLUMN_LEFT:
      case F.VIEW_ROW_TOP:
      case F.VIEW_LEFT_TOP:
        return e.startRow < n.startRow && e.startColumn < n.startColumn;
    }
  }
  _clearObserverEvent() {
    var e, t;
    (e = this._scenePointerMoveSub) == null || e.unsubscribe(), (t = this._scenePointerUpSub) == null || t.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null;
  }
  _initialControl() {
    const { leftControl: e, rightControl: t, topControl: n, bottomControl: i } = this._control;
    [e, t, n, i].forEach((o) => {
      o.onPointerEnter$.subscribeEvent(() => {
        var l;
        ((l = this._injector.get(gt, bc.OPTIONAL)) == null ? void 0 : l.interceptor.fetchThroughInterceptors(Wc)(!1, null)) !== !1 && o.setCursor(ye.MOVE);
      }), o.onPointerLeave$.subscribeEvent(() => {
        o.resetCursor();
      }), o.onPointerDown$.subscribeEvent(this._controlPointerDownHandler.bind(this));
    });
  }
  /**
   * Move the whole selection control after cursor turn into move state.
   * NOT same as widgetMoving, that's for 8 control points.
   * @param moveOffsetX
   * @param moveOffsetY
   */
  _controlMoving(e, t) {
    var E;
    const n = this._scene, i = n.getScrollXYInfoByViewport(ke.FromArray([e, t])), { scaleX: o, scaleY: s } = n.getAncestorScale(), l = this._skeleton.getCellIndexByOffset(
      e,
      t,
      o,
      s,
      i
    ), { row: a, column: c } = l, d = this._skeleton.getRowCount() - 1, u = this._skeleton.getColumnCount() - 1;
    let h = Math.max(0, a + this._relativeSelectionPositionRow), g = h + this._relativeSelectionRowLength;
    g > d && (g = d, g - h < this._relativeSelectionRowLength && (h = g - this._relativeSelectionRowLength));
    let m = Math.max(0, c + this._relativeSelectionPositionColumn), f = m + this._relativeSelectionColumnLength;
    f > u && (f = u, f - m < this._relativeSelectionColumnLength && (m = f - this._relativeSelectionColumnLength));
    const v = this._skeleton.worksheet.getCellInfoInMergeData(h, m), S = Wt({
      range: { startRow: h, endRow: g, startColumn: m, endColumn: f },
      primary: v,
      style: null
    }, this._skeleton), w = this._skeleton.getNoMergeCellWithCoordByIndex(h, m), C = this._skeleton.getNoMergeCellWithCoordByIndex(g, f), I = (w == null ? void 0 : w.startY) || 0, R = (C == null ? void 0 : C.endY) || 0, y = (w == null ? void 0 : w.startX) || 0, M = (C == null ? void 0 : C.endX) || 0;
    (E = this._helperSelection) == null || E.transformByState({
      left: y,
      top: I,
      width: M - y,
      height: R - I
    }), this._targetSelection = { ...S.rangeWithCoord }, this._control.selectionMoving$.next(S.rangeWithCoord);
  }
  /**
   * Drag move whole selectionControl when cursor turns to crosshair. Not for dragging 8 control points.
   * @param evt
   */
  _controlPointerDownHandler(e) {
    const { offsetX: t, offsetY: n } = e, i = this._scene, o = i.getCoordRelativeToViewport(ke.FromArray([t, n])), { x: s, y: l } = o, a = i.getScrollXYInfoByViewport(o), { scaleX: c, scaleY: d } = i.getAncestorScale(), u = this._skeleton.getCellIndexByOffset(
      s,
      l,
      c,
      d,
      a
    );
    this._startOffsetX = s, this._startOffsetY = l;
    const { row: h, column: g } = u, {
      startRow: m,
      startColumn: f,
      endRow: v,
      endColumn: p
    } = this._control.model;
    let S = 0, w = 0;
    h < m ? S -= 1 : h > v && (S += 1), g < f ? w -= 1 : g > p && (w += 1), this._relativeSelectionPositionRow = m - h + S, this._relativeSelectionPositionColumn = f - g + w, this._relativeSelectionRowLength = v - m, this._relativeSelectionColumnLength = p - f;
    const C = this._control.currentStyle, I = this._getScale();
    this.isHelperSelection && (this._helperSelection = new Se(Fu, {
      stroke: C.stroke,
      strokeWidth: C.strokeWidth / I
    }), i.addObject(this._helperSelection));
    const R = i.getViewport(F.VIEW_MAIN), y = ei.create(i);
    this._scrollTimer = y, y.startScroll(s, l, R), i.disableObjectsEvent(), this._scenePointerMoveSub = i.onPointerMove$.subscribeEvent((M) => {
      var x;
      if (this._disabled)
        return;
      const { offsetX: E, offsetY: T } = M;
      if (((x = this._injector.get(gt, bc.OPTIONAL)) == null ? void 0 : x.interceptor.fetchThroughInterceptors(Wc)(!1, null)) === !1)
        return;
      const { x: H, y: A } = i.getCoordRelativeToViewport(
        ke.FromArray([E, T])
      );
      this._controlMoving(H, A), i.setCursor(ye.MOVE), y.scrolling(H, A, () => {
        this._controlMoving(H, A);
      });
    }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
      var E, T, P, H;
      (E = this._helperSelection) == null || E.dispose();
      const M = this._scene;
      M.resetCursor(), this._clearObserverEvent(), M.enableObjectsEvent(), (T = this._scrollTimer) == null || T.dispose(), this._control.selectionMoveEnd$.next(this._targetSelection), (H = (P = this._selectionHooks).selectionMoveEnd) == null || H.call(P);
    });
  }
  _initialWidget() {
    const {
      topLeftWidget: e,
      topCenterWidget: t,
      topRightWidget: n,
      middleLeftWidget: i,
      middleRightWidget: o,
      bottomLeftWidget: s,
      bottomCenterWidget: l,
      bottomRightWidget: a
    } = this._control, c = [
      ye.NORTH_WEST_RESIZE,
      ye.NORTH_RESIZE,
      ye.NORTH_EAST_RESIZE,
      ye.WEST_RESIZE,
      ye.EAST_RESIZE,
      ye.SOUTH_WEST_RESIZE,
      ye.SOUTH_RESIZE,
      ye.SOUTH_EAST_RESIZE
    ];
    [
      e,
      t,
      n,
      i,
      o,
      s,
      l,
      a
    ].forEach((d, u) => {
      d.onPointerEnter$.subscribeEvent(() => {
        d.setCursor(c[u]);
      }), d.onPointerLeave$.subscribeEvent(() => {
        d.resetCursor();
      }), d.onPointerDown$.subscribeEvent((h) => {
        this._widgetPointerDownEvent(h, c[u]);
      });
    });
  }
  /**
   * Pointer down Events for 8 control point.
   * @param evt
   * @param cursor
   */
  _widgetPointerDownEvent(e, t) {
    const n = this._scene, { offsetX: i, offsetY: o } = e, s = n.getCoordRelativeToViewport(ke.FromArray([i, o])), { x: l, y: a } = s;
    this._startOffsetX = i, this._startOffsetY = o;
    const {
      startRow: c,
      startColumn: d,
      endRow: u,
      endColumn: h
    } = this._control.model, g = Math.min(c, u), m = Math.min(d, h), f = Math.max(c, u), v = Math.max(d, h);
    this._relativeSelectionPositionRow = g, this._relativeSelectionPositionColumn = m, this._relativeSelectionRowLength = f - g, this._relativeSelectionColumnLength = v - m, t === ye.NORTH_WEST_RESIZE ? (this._relativeSelectionPositionRow = f, this._relativeSelectionPositionColumn = v) : t === ye.NORTH_RESIZE ? this._relativeSelectionPositionRow = f : t === ye.NORTH_EAST_RESIZE ? this._relativeSelectionPositionRow = f : t === ye.WEST_RESIZE ? this._relativeSelectionPositionColumn = v : t === ye.SOUTH_WEST_RESIZE ? this._relativeSelectionPositionColumn = v : t === ye.SOUTH_RESIZE && (this._relativeSelectionPositionRow = g);
    const p = ei.create(n), S = n.getViewport(F.VIEW_MAIN);
    p.startScroll(l, a, S), this._scrollTimer = p, n.disableObjectsEvent(), this._scenePointerMoveSub = n.onPointerMove$.subscribeEvent((w) => {
      const { offsetX: C, offsetY: I } = w, { x: R, y } = n.getCoordRelativeToViewport(
        ke.FromArray([C, I])
      );
      this._widgetMoving(R, y, t), n.setCursor(t), p.scrolling(R, y, () => {
        this._widgetMoving(R, y, t);
      });
    }), this._scenePointerUpSub = n.onPointerUp$.subscribeEvent(() => {
      var C, I, R;
      const w = this._scene;
      w.resetCursor(), this._clearObserverEvent(), w.enableObjectsEvent(), (C = this._scrollTimer) == null || C.dispose(), this._control.selectionScaled$.next(this._targetSelection), (R = (I = this._selectionHooks).selectionMoveEnd) == null || R.call(I);
    });
  }
  /**
   * Pointer move Events for 8 control point.
   * @param moveOffsetX
   * @param moveOffsetY
   * @param cursor
   */
  _widgetMoving(e, t, n) {
    const i = this._scene, o = i.getScrollXYInfoByViewport(ke.FromArray([this._startOffsetX, this._startOffsetY])), { scaleX: s, scaleY: l } = i.getAncestorScale(), a = this._skeleton.getCellIndexByOffset(
      e,
      t,
      s,
      l,
      o
    ), { row: c, column: d } = a;
    let u = this._relativeSelectionPositionRow, h = this._relativeSelectionPositionColumn, g = c, m = d;
    n === ye.NORTH_WEST_RESIZE ? (u = c, h = d, g = this._relativeSelectionPositionRow, m = this._relativeSelectionPositionColumn) : n === ye.NORTH_RESIZE ? (u = c, h = this._relativeSelectionPositionColumn, g = this._relativeSelectionPositionRow, m = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength) : n === ye.NORTH_EAST_RESIZE ? (u = c, h = this._relativeSelectionPositionColumn, g = this._relativeSelectionPositionRow, m = d) : n === ye.WEST_RESIZE ? (u = this._relativeSelectionPositionRow, h = d, g = this._relativeSelectionPositionRow + this._relativeSelectionRowLength, m = this._relativeSelectionPositionColumn) : n === ye.EAST_RESIZE ? g = this._relativeSelectionPositionRow + this._relativeSelectionRowLength : n === ye.SOUTH_WEST_RESIZE ? (u = this._relativeSelectionPositionRow, h = d, g = c, m = this._relativeSelectionPositionColumn) : n === ye.SOUTH_RESIZE && (u = this._relativeSelectionPositionRow, h = this._relativeSelectionPositionColumn, g = c, m = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength);
    const f = this._swapPositions(u, h, g, m), v = this._skeleton.getCellWithMergeInfoByIndex(u, h), S = Wt({ range: f, primary: v, style: null }, this._skeleton);
    this._targetSelection = { ...S.rangeWithCoord }, this._control.updateRangeBySelectionWithCoord(S), this._control.selectionScaling$.next(this._targetSelection);
  }
  _initialAutoFill() {
    const { fillControl: e } = this._control;
    e.onPointerEnter$.subscribeEvent((t) => {
      this._injector.get(gt).interceptor.fetchThroughInterceptors(Bc)(!1, { x: t.offsetX, y: t.offsetY, skeleton: this._skeleton, scene: this._scene }) && e.setCursor(ye.CROSSHAIR);
    }), e.onPointerLeave$.subscribeEvent(() => {
      e.resetCursor();
    }), e.onPointerDown$.subscribeEvent(this._autoFillForPointerdown.bind(this));
  }
  // eslint-disable-next-line complexity
  _autoFillMoving(e, t) {
    var T, P, H;
    const n = this._scene, i = n.getViewportScrollXY(this._activeViewport), { scaleX: o, scaleY: s } = n.getAncestorScale(), l = this._skeleton.getCellIndexByOffset(
      e,
      t,
      o,
      s,
      i
    ), { row: a, column: c } = l, d = n.getCoordRelativeToViewport(ke.FromArray([e, t])), u = this._skeleton.getRowCount() - 1, h = this._skeleton.getColumnCount() - 1;
    let g = this._relativeSelectionPositionRow, m = this._relativeSelectionPositionColumn, f = this._relativeSelectionPositionRow + this._relativeSelectionRowLength, v = this._relativeSelectionPositionColumn + this._relativeSelectionColumnLength, p = !1, S = !0;
    if ((c < m || c > v) && a >= g && a <= f) {
      const A = this._fillRuler(
        c,
        m,
        v,
        this._relativeSelectionColumnLength,
        h
      );
      m = A.startRowOrColumn, v = A.endRowOrColumn, p = A.isLighten, S = !1;
    } else if ((a < g || a > f) && c >= m && c <= v) {
      const A = this._fillRuler(a, g, f, this._relativeSelectionRowLength, u);
      g = A.startRowOrColumn, f = A.endRowOrColumn, p = A.isLighten;
    } else if (Math.abs(this._startOffsetX - d.x - i.x) / 2 > Math.abs(this._startOffsetY - d.y - i.y)) {
      const A = this._fillRuler(
        c,
        m,
        v,
        this._relativeSelectionColumnLength,
        h
      );
      m = A.startRowOrColumn, v = A.endRowOrColumn, p = A.isLighten, S = !1;
    } else {
      const A = this._fillRuler(a, g, f, this._relativeSelectionRowLength, u);
      g = A.startRowOrColumn, f = A.endRowOrColumn, p = A.isLighten;
    }
    const w = this._skeleton.getNoMergeCellWithCoordByIndex(g, m), C = this._skeleton.getNoMergeCellWithCoordByIndex(f, v), I = (w == null ? void 0 : w.startY) || 0, R = (C == null ? void 0 : C.endY) || 0, y = (w == null ? void 0 : w.startX) || 0, M = (C == null ? void 0 : C.endX) || 0;
    p ? this._controlHandler((A, x) => {
      const V = new fn(this._fillControlColors[x]).lighten(PC).toRgbString();
      A.setProps({
        fill: V
      });
    }) : this._controlHandler((A, x) => {
      A.setProps({
        fill: this._fillControlColors[x]
      });
    });
    const E = Fs / this._getScale();
    g === f && S === !0 || m === v && S === !1 ? (T = this._helperSelection) == null || T.hide() : ((P = this._helperSelection) == null || P.transformByState({
      left: y - E / 2,
      top: I - E / 2,
      width: M - y,
      height: R - I
    }), (H = this._helperSelection) == null || H.show()), this._targetSelection = {
      startY: I,
      endY: R,
      startX: y,
      endX: M,
      startRow: g,
      endRow: f,
      startColumn: m,
      endColumn: v
    }, this._control.selectionFilling$.next(this._targetSelection);
  }
  // eslint-disable-next-line max-lines-per-function
  _autoFillForPointerdown(e) {
    const { offsetX: t, offsetY: n } = e, i = this._scene, o = i.getCoordRelativeToViewport(ke.FromArray([t, n])), { x: s, y: l } = o;
    this._startOffsetX = s, this._startOffsetY = l;
    const {
      startRow: a,
      startColumn: c,
      endRow: d,
      endColumn: u
    } = this._control.model;
    this._isInMergeState = this._hasMergeInRange(a, c, d, u), this._relativeSelectionPositionRow = a, this._relativeSelectionPositionColumn = c, this._relativeSelectionRowLength = d - a, this._relativeSelectionColumnLength = u - c;
    const h = this._control.currentStyle;
    let g = h == null ? void 0 : h.stroke, m = h == null ? void 0 : h.strokeWidth;
    const f = Sr(this._themeService);
    g == null && (g = f.stroke), m == null && (m = f.strokeWidth);
    const v = this._getScale();
    m /= v;
    const p = Fs / v, S = new fn(g).darken(2).toRgbString();
    this.isHelperSelection && (this._helperSelection = new Se(Fu, {
      stroke: S,
      strokeWidth: m + p / 2
    }), i.addObject(this._helperSelection)), this._activeViewport = i.getActiveViewportByCoord(ke.FromArray([t, n]));
    const w = i.getViewport(F.VIEW_MAIN), C = ei.create(
      i,
      this._activeViewport.viewportKey === F.VIEW_MAIN ? bt.ALL : bt.NONE
    );
    C.startScroll(s, l, w), this._scrollTimer = C, i.disableObjectsEvent(), this._controlHandler((I) => {
      this._fillControlColors.push(I.fill);
    }), this._scenePointerMoveSub = i.onPointerMove$.subscribeEvent((I) => {
      var A;
      const { offsetX: R, offsetY: y } = I, M = i.getActiveViewportByCoord(ke.FromArray([R, y]));
      if (!this._injector.get(gt).interceptor.fetchThroughInterceptors(Bc)(!1, { x: e.offsetX, y: e.offsetY, skeleton: this._skeleton, scene: this._scene }))
        return;
      const { x: T, y: P } = i.getCoordRelativeToViewport(
        ke.FromArray([R, y])
      );
      this._autoFillMoving(T, P), i.setCursor(ye.CROSSHAIR);
      const H = this._targetSelection;
      if (w && M && ((A = this._activeViewport) == null ? void 0 : A.viewportKey) !== (M == null ? void 0 : M.viewportKey)) {
        let x;
        H.startRow !== a ? (C.scrollTimerType = bt.Y, x = {
          ...H,
          endRow: H.startRow
        }) : H.endRow !== d ? (C.scrollTimerType = bt.Y, x = {
          ...H,
          startRow: H.endRow
        }) : H.startColumn !== c ? (C.scrollTimerType = bt.X, x = {
          ...H,
          endColumn: H.startColumn
        }) : (C.scrollTimerType = bt.X, x = {
          ...H,
          startColumn: H.endColumn
        }), this._isSelectionInViewport(x, M) && (this._viewportMainScrollBarNeedResetPosition(C.scrollTimerType, this._activeViewport.viewportKey, M.viewportKey) && w.scrollToBarPos({
          x: C.scrollTimerType === bt.X ? 0 : void 0,
          y: C.scrollTimerType === bt.Y ? 0 : void 0
        }), this._activeViewport = M);
      }
      C.scrolling(T, P, () => {
        this._autoFillMoving(T, P);
      });
    }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
      var R, y;
      (R = this._helperSelection) == null || R.dispose();
      const I = this._scene;
      I.resetCursor(), this._clearObserverEvent(), I.enableObjectsEvent(), (y = this._scrollTimer) == null || y.dispose(), this._control.refreshSelectionFilled(this._targetSelection), this._isInMergeState = !1, this._controlHandler((M, E) => {
        M.setProps({
          fill: this._fillControlColors[E]
        });
      }), this._fillControlColors = [];
    });
  }
  _viewportMainScrollBarNeedResetPosition(e, t, n) {
    return e === bt.X && (t === F.VIEW_MAIN_LEFT || t === F.VIEW_MAIN_LEFT_TOP) && (n === F.VIEW_MAIN || n === F.VIEW_MAIN_TOP) || e === bt.Y && (t === F.VIEW_MAIN_TOP || t === F.VIEW_MAIN_LEFT_TOP) && (n === F.VIEW_MAIN || n === F.VIEW_MAIN_LEFT);
  }
  _hasMergeInRange(e, t, n, i) {
    return this._skeleton.worksheet.getMergedCellRange(e, t, n, i).length > 0;
  }
  /**
   * Make sure startRow < endRow and startColumn < endColumn
   *
   * @param startRow
   * @param startColumn
   * @param endRow
   * @param endColumn
   * @returns {IRange} range
   */
  _swapPositions(e, t, n, i) {
    const o = Math.min(e, n), s = Math.min(t, i), l = Math.max(e, n), a = Math.max(t, i);
    return {
      startRow: o,
      startColumn: s,
      endRow: l,
      endColumn: a
    };
  }
  _controlHandler(e) {
    const {
      leftControl: t,
      rightControl: n,
      topControl: i,
      bottomControl: o,
      backgroundControlTop: s,
      backgroundControlMiddleLeft: l,
      backgroundControlMiddleRight: a,
      backgroundControlBottom: c,
      fillControl: d
    } = this._control, u = [
      t,
      n,
      i,
      o,
      s,
      l,
      a,
      c,
      d
    ];
    for (let h = 0, g = u.length; h < g; h++) {
      const m = u[h];
      e(m, h);
    }
  }
  _fillRuler(e, t, n, i, o) {
    let s = !1;
    if (e < t)
      if (this._isInMergeState && e < t) {
        const l = t - e, a = i + 1, c = Math.ceil(l / a);
        let d = t - c * a;
        d < 0 && (d = t - (c - 1) * a), t = d;
      } else
        t = e;
    else if (e >= t && e <= n)
      s = !0, this._isInMergeState || (n = e);
    else if (this._isInMergeState && e > n) {
      const l = e - n, a = i + 1, c = Math.ceil(l / a);
      let d = n + c * a;
      d > o && (d = n + (c - 1) * a), n = d;
    } else
      n = e;
    return {
      rowOrColumn: e,
      startRowOrColumn: t,
      endRowOrColumn: n,
      isLighten: s
    };
  }
  _getScale() {
    const { scaleX: e, scaleY: t } = this._scene.getAncestorScale();
    return Math.max(e, t);
  }
}
var Fc = /* @__PURE__ */ ((r) => (r.Selection = "__SpreadsheetSelectionShape__", r.top = "__SpreadsheetSelectionTopControl__", r.bottom = "__SpreadsheetSelectionBottomControl__", r.left = "__SpreadsheetSelectionShapeLeftControl__", r.right = "__SpreadsheetSelectionShapeRightControl__", r.backgroundTop = "__SpreadsheetSelectionBackgroundControlTop__", r.backgroundMiddleLeft = "__SpreadsheetSelectionBackgroundControlMiddleLeft__", r.backgroundMiddleRight = "__SpreadsheetSelectionBackgroundControlMiddleRight__", r.backgroundBottom = "__SpreadsheetSelectionBackgroundControlBottom__", r.fill = "__SpreadsheetSelectionFillControl__", r.fillTopLeft = "__SpreadsheetSelectionFillControlTopLeft__", r.fillBottomRight = "__SpreadsheetSelectionFillControlBottomRight__", r.fillTopLeftInner = "__SpreadsheetSelectionFillControlTopLeftInner__", r.fillBottomRightInner = "__SpreadsheetSelectionFillControlBottomRightInner__", r.lineMain = "__SpreadsheetDragLineMainControl__", r.lineContent = "__SpreadsheetDragLineContentControl__", r.line = "__SpreadsheetDragLineControl__", r.dash = "__SpreadsheetDragDashControl__", r.rowHeaderBackground = "__SpreadSheetSelectionRowHeaderBackground__", r.rowHeaderBorder = "__SpreadSheetSelectionRowHeaderBorder__", r.rowHeaderGroup = "__SpreadSheetSelectionRowHeaderGroup__", r.columnHeaderBackground = "__SpreadSheetSelectionColumnHeaderBackground__", r.columnHeaderBorder = "__SpreadSheetSelectionColumnHeaderBorder__", r.columnHeaderGroup = "__SpreadSheetSelectionColumnHeaderGroup__", r.topLeftWidget = "__SpreadSheetSelectionTopLeftWidget__", r.topCenterWidget = "__SpreadSheetSelectionTopCenterWidget__", r.topRightWidget = "__SpreadSheetSelectionTopRightWidget__", r.middleLeftWidget = "__SpreadSheetSelectionMiddleLeftWidget__", r.middleRightWidget = "__SpreadSheetSelectionMiddleRightWidget__", r.bottomLeftWidget = "__SpreadSheetSelectionBottomLeftWidget__", r.bottomCenterWidget = "__SpreadSheetSelectionBottomCenterWidget__", r.bottomRightWidget = "__SpreadSheetSelectionBottomRightWidget__", r))(Fc || {});
const Uu = 0.3;
class Wd extends oe {
  constructor(t, n, i, o) {
    var s, l, a, c;
    super();
    _(this, "_isHelperSelection", !0);
    /**
     * For ref selections, there is no auto fill.
     */
    _(this, "_enableAutoFill", !0);
    /**
     * Only normal selections with primary cell has auto fill.
     * This works for multiple normal selections. Only last selection has primary cell and auto fill.
     */
    _(this, "_showAutoFill", !1);
    /**
     * If rowHeader & col Header would be highlighted with selection.
     */
    _(this, "_highlightHeader", !0);
    _(this, "_selectionRenderModel");
    _(this, "_leftBorder");
    _(this, "_rightBorder");
    _(this, "_topBorder");
    _(this, "_bottomBorder");
    _(this, "_backgroundControlTop");
    _(this, "_backgroundControlBottom");
    _(this, "_backgroundControlMiddleLeft");
    _(this, "_backgroundControlMiddleRight");
    _(this, "_autoFillControl");
    _(this, "_selectionShapeGroup");
    _(this, "_rowHeaderBackground");
    _(this, "_rowHeaderBorder");
    _(this, "_rowHeaderGroup");
    _(this, "_columnHeaderBackground");
    _(this, "_columnHeaderBorder");
    _(this, "_columnHeaderGroup");
    _(this, "_dashedRect");
    // for ref selection
    _(this, "_topLeftWidget");
    _(this, "_topCenterWidget");
    _(this, "_topRightWidget");
    _(this, "_middleLeftWidget");
    _(this, "_middleRightWidget");
    _(this, "_bottomLeftWidget");
    _(this, "_bottomCenterWidget");
    _(this, "_bottomRightWidget");
    // why three style prop? what's diff between _selectionStyle & _currentStyle?
    // protected _selectionStyle: Nullable<ISelectionStyle>;
    _(this, "_defaultStyle");
    _(this, "_currentStyle");
    _(this, "_rowHeaderWidth", 0);
    _(this, "_columnHeaderHeight", 0);
    _(this, "_widgetRects", []);
    _(this, "_controlExtension");
    _(this, "_dispose$", new Me(this));
    _(this, "dispose$", this._dispose$.asObservable());
    /**
     * eventSource: selectionShapeExtension selectionMoving$.next,
     * Observer: prompt.controller
     */
    _(this, "selectionMoving$", new He());
    _(this, "selectionMoveEnd$", new He());
    _(this, "selectionScaling$", new He());
    _(this, "selectionScaled$", new He());
    _(this, "selectionFilling$", new He());
    _(this, "_selectionFilled$", new He());
    _(this, "selectionFilled$", this._selectionFilled$.asObservable());
    _(this, "_antLineOffset", 0);
    _(this, "_antRequestNewFrame", -1);
    this._scene = t, this._zIndex = n, this._themeService = i, this._enableAutoFill = (s = o == null ? void 0 : o.enableAutoFill) != null ? s : !0, this._highlightHeader = (l = o == null ? void 0 : o.highlightHeader) != null ? l : !0, this._rowHeaderWidth = (a = o == null ? void 0 : o.rowHeaderWidth) != null ? a : 0, this._columnHeaderHeight = (c = o == null ? void 0 : o.columnHeaderHeight) != null ? c : 0, this._initializeSheetBody(), this._initialHeader();
  }
  _initializeSheetBody() {
    this._defaultStyle = Sr(this._themeService), this._currentStyle = Sr(this._themeService), this._selectionRenderModel = new TC();
    const t = this._zIndex;
    this._leftBorder = new Se("__SpreadsheetSelectionShapeLeftControl__" + t, {
      zIndex: t
    }), this._rightBorder = new Se("__SpreadsheetSelectionShapeRightControl__" + t, {
      zIndex: t
    }), this._topBorder = new Se("__SpreadsheetSelectionTopControl__" + t, {
      zIndex: t
    }), this._bottomBorder = new Se("__SpreadsheetSelectionBottomControl__" + t, {
      zIndex: t
    }), this._backgroundControlTop = new Se("__SpreadsheetSelectionBackgroundControlTop__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._backgroundControlBottom = new Se("__SpreadsheetSelectionBackgroundControlBottom__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._backgroundControlMiddleLeft = new Se("__SpreadsheetSelectionBackgroundControlMiddleLeft__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._backgroundControlMiddleRight = new Se("__SpreadsheetSelectionBackgroundControlMiddleRight__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._autoFillControl = new Se("__SpreadsheetSelectionFillControl__" + t, {
      zIndex: t + 1
    }), this._autoFillControl.hide(), this._dashedRect = new PS("__SpreadsheetDragDashControl__" + t, {
      zIndex: t + 2,
      evented: !1,
      stroke: "#fff"
    });
    const n = [
      this._autoFillControl,
      this._leftBorder,
      this._rightBorder,
      this._topBorder,
      this._bottomBorder,
      this._backgroundControlTop,
      this._backgroundControlMiddleLeft,
      this._backgroundControlMiddleRight,
      this._backgroundControlBottom,
      this._dashedRect
    ];
    this._widgetRects = this._initialWidget(), this._selectionShapeGroup = new Ha("__SpreadsheetSelectionShape__" + t, ...n, ...this._widgetRects), this._selectionShapeGroup.hide(), this._selectionShapeGroup.evented = !1, this._selectionShapeGroup.zIndex = t;
    const i = this.getScene();
    i.addObject(this._selectionShapeGroup, Qs), this.disposeWithMe(
      We(
        i.onTransformChange$.subscribeEvent((o) => {
          o.type === Nc.scale && (this._updateLayoutOfSelectionControl(this._currentStyle), this._updateControlCoord());
        })
      )
    );
  }
  _initialHeader() {
    const t = this._zIndex;
    this._rowHeaderBackground = new Se("__SpreadSheetSelectionRowHeaderBackground__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._rowHeaderBorder = new Se("__SpreadSheetSelectionRowHeaderBorder__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._rowHeaderGroup = new Ha(
      "__SpreadSheetSelectionRowHeaderGroup__" + t,
      this._rowHeaderBackground,
      this._rowHeaderBorder
    ), this._rowHeaderGroup.hide(), this._rowHeaderGroup.evented = !1, this._rowHeaderGroup.zIndex = t, this._columnHeaderBackground = new Se("__SpreadSheetSelectionColumnHeaderBackground__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._columnHeaderBorder = new Se("__SpreadSheetSelectionColumnHeaderBorder__" + t, {
      zIndex: t - 1,
      evented: !1
    }), this._columnHeaderGroup = new Ha(
      "__SpreadSheetSelectionColumnHeaderGroup__" + t,
      this._columnHeaderBackground,
      this._columnHeaderBorder
    ), this._columnHeaderGroup.hide(), this._columnHeaderGroup.evented = !1, this._columnHeaderGroup.zIndex = t, this.getScene().addObjects([this._rowHeaderGroup, this._columnHeaderGroup], EC);
  }
  _initialWidget() {
    const t = this._zIndex;
    return this._topLeftWidget = new Se("__SpreadSheetSelectionTopLeftWidget__" + t, {
      zIndex: t + 1
    }), this._topCenterWidget = new Se("__SpreadSheetSelectionTopCenterWidget__" + t, {
      zIndex: t + 1
    }), this._topRightWidget = new Se("__SpreadSheetSelectionTopRightWidget__" + t, {
      zIndex: t + 1
    }), this._middleLeftWidget = new Se("__SpreadSheetSelectionMiddleLeftWidget__" + t, {
      zIndex: t + 1
    }), this._middleRightWidget = new Se("__SpreadSheetSelectionMiddleRightWidget__" + t, {
      zIndex: t + 1
    }), this._bottomLeftWidget = new Se("__SpreadSheetSelectionBottomLeftWidget__" + t, {
      zIndex: t + 1
    }), this._bottomCenterWidget = new Se("__SpreadSheetSelectionBottomCenterWidget__" + t, {
      zIndex: t + 1
    }), this._bottomRightWidget = new Se("__SpreadSheetSelectionBottomRightWidget__" + t, {
      zIndex: t + 1
    }), [
      this._topLeftWidget,
      this._topCenterWidget,
      this._topRightWidget,
      this._middleLeftWidget,
      this._middleRightWidget,
      this._bottomLeftWidget,
      this._bottomCenterWidget,
      this._bottomRightWidget
    ];
  }
  get zIndex() {
    return this._zIndex;
  }
  get leftControl() {
    return this._leftBorder;
  }
  get rightControl() {
    return this._rightBorder;
  }
  get topControl() {
    return this._topBorder;
  }
  get bottomControl() {
    return this._bottomBorder;
  }
  get fillControl() {
    return this._autoFillControl;
  }
  get backgroundControlTop() {
    return this._backgroundControlTop;
  }
  get backgroundControlBottom() {
    return this._backgroundControlBottom;
  }
  get backgroundControlMiddleLeft() {
    return this._backgroundControlMiddleLeft;
  }
  get backgroundControlMiddleRight() {
    return this._backgroundControlMiddleRight;
  }
  get selectionShape() {
    return this._selectionShapeGroup;
  }
  get columnHeaderGroup() {
    return this._columnHeaderGroup;
  }
  get rowHeaderGroup() {
    return this._rowHeaderGroup;
  }
  get selectionShapeGroup() {
    return this._selectionShapeGroup;
  }
  // That's so bad! _selectionModel is protected! But I don't want to expose it to the outside world
  get model() {
    return this._selectionRenderModel;
  }
  get topLeftWidget() {
    return this._topLeftWidget;
  }
  get topCenterWidget() {
    return this._topCenterWidget;
  }
  get topRightWidget() {
    return this._topRightWidget;
  }
  get middleLeftWidget() {
    return this._middleLeftWidget;
  }
  get middleRightWidget() {
    return this._middleRightWidget;
  }
  get bottomLeftWidget() {
    return this._bottomLeftWidget;
  }
  get bottomCenterWidget() {
    return this._bottomCenterWidget;
  }
  get bottomRightWidget() {
    return this._bottomRightWidget;
  }
  get themeService() {
    return this._themeService;
  }
  get selectionModel() {
    return this._selectionRenderModel;
  }
  set selectionModel(t) {
    this._selectionRenderModel = t;
  }
  // get defaultStyle(): ISelectionStyle {
  //     return this._defaultStyle;
  // }
  // set defaultStyle(style: ISelectionStyle) {
  //     this._defaultStyle = style;
  // }
  get currentStyle() {
    return this._currentStyle;
  }
  set currentStyle(t) {
    this._currentStyle = t;
  }
  get dashedRect() {
    return this._dashedRect;
  }
  get isHelperSelection() {
    return this._isHelperSelection;
  }
  get rowHeaderWidth() {
    return this._rowHeaderWidth;
  }
  set rowHeaderWidth(t) {
    this._rowHeaderWidth = t;
  }
  get columnHeaderHeight() {
    return this._columnHeaderHeight;
  }
  set columnHeaderHeight(t) {
    this._columnHeaderHeight = t;
  }
  setControlExtension(t) {
    this._controlExtension = new xC(this, t);
  }
  setControlExtensionDisable(t) {
    this._controlExtension && this._controlExtension.setDisabled(t);
  }
  setEvent(t) {
    this.leftControl.evented = t, this.rightControl.evented = t, this.topControl.evented = t, this.bottomControl.evented = t;
  }
  refreshSelectionFilled(t) {
    this._selectionFilled$.next(t);
  }
  /**
   * Update Control Style And Position of SelectionControl
   * @param selectionStyle
   */
  _updateLayoutOfSelectionControl(t) {
    t && (this.currentStyle = Object.assign({}, this._defaultStyle, t));
    const n = this.currentStyle, {
      stroke: i,
      widgets: o,
      autofillStroke: s,
      strokeDash: l,
      isAnimationDash: a
    } = n;
    let c = n.autofillSize, d = n.strokeWidth, u = n.autofillStrokeWidth;
    const h = this._getScale(), g = (d + Fs) / 2 / h;
    d /= h, c /= h, u /= h < 1 ? 1 : h;
    const m = Fs / h, f = AS / h, { startX: v, startY: p, endX: S, endY: w } = this._selectionRenderModel;
    if (this.leftControl.transformByState({
      height: w - p,
      left: -g + f,
      width: d,
      strokeWidth: m,
      top: -m / 2 + f
    }), this.leftControl.setProps({
      fill: i,
      stroke: ps
    }), this.rightControl.transformByState({
      height: w - p,
      left: S - v - g + f,
      width: d,
      strokeWidth: m,
      top: -m / 2 + f
    }), this.rightControl.setProps({
      fill: i,
      stroke: ps
    }), this.topControl.transformByState({
      width: S - v + d,
      top: -g + f,
      left: -g + f,
      height: d,
      strokeWidth: m
    }), this.topControl.setProps({
      fill: i,
      stroke: ps
    }), this.bottomControl.transformByState({
      width: S - v + d,
      top: w - p - g + f,
      height: d,
      left: -g + f,
      strokeWidth: m
    }), this.bottomControl.setProps({
      fill: i,
      stroke: ps
    }), l == null)
      this.dashedRect.hide(), this._stopAntLineAnimation();
    else {
      const C = n.strokeWidth * 2 / h;
      this.dashedRect.transformByState({
        height: w - p,
        width: S - v,
        strokeWidth: C,
        left: -C / 2 + f,
        top: -C / 2 + f
      }), this.dashedRect.setProps({
        strokeDashArray: [0, l / h]
      }), this._stopAntLineAnimation(), a !== !1 && this._startAntLineAnimation(), this.dashedRect.show();
    }
    if (this._showAutoFill = this._showAutoFill && this._enableAutoFill, this._showAutoFill && !this._hasWidgets(o)) {
      const C = {
        fill: i,
        stroke: s,
        strokeScaleEnabled: !1
      }, I = {
        width: c - u,
        height: c - u,
        left: S - v - c / 2 + u / 2 - f,
        top: w - p - c / 2 + u / 2 - f,
        strokeWidth: u
      };
      this._autoFillControl.setProps(C), this._autoFillControl.transformByState(I), this._autoFillControl.show();
    } else
      this._autoFillControl.hide();
    this._updateBackgroundControl(n), this._updateHeaderBackground(n), this._updateWidgets(n);
  }
  /**
   * update selection control coordination by curr selection model
   */
  _updateControlCoord() {
    const { startX: t, startY: n } = this._selectionRenderModel;
    this.selectionShapeGroup.show(), this.selectionShapeGroup.translate(t, n), this.selectionShapeGroup.makeDirtyNoDebounce(!0);
  }
  updateStyle(t) {
    this._updateLayoutOfSelectionControl(t), this._updateControlCoord();
  }
  /**
   * Update range and primary range.
   *
   * highlight cell would update if primaryWithCoord has value.
   * highlight cell would be cleared if primaryWithCoord is null.
   * highlight would keep prev value if primaryWithCoord is undefined.
   * @param rangeWithCoord
   * @param primaryWithCoord
   */
  updateRange(t, n) {
    this._selectionRenderModel.setValue(t, n), this._showAutoFill = n !== null, this._updateLayoutOfSelectionControl(), this._updateControlCoord();
  }
  /**
   * Update range and primary range and style.
   * @param selectionWthCoord
   */
  updateRangeBySelectionWithCoord(t, n) {
    n && (this._rowHeaderWidth = n.rowHeaderWidth, this._columnHeaderHeight = n.columnHeaderHeight), this._selectionRenderModel.setValue(t.rangeWithCoord, t.primaryWithCoord), this._showAutoFill = t.primaryWithCoord !== null, this._updateLayoutOfSelectionControl(t.style), this._updateControlCoord();
  }
  /**
   * Update selection model with new range & primary cell(aka: highlight/current), also update row/col selection size & style.
   *
   * @deprecated  use `updateRangeBySelectionWithCoord` and `updateStyle` to do same thing.
   *
   * @param newSelectionRange
   * @param rowHeaderWidth
   * @param columnHeaderHeight
   * @param style
   * @param primaryCell primary cell
   */
  update(t, n = 0, i = 0, o, s) {
    this._rowHeaderWidth = n, this._columnHeaderHeight = i, this.updateRangeBySelectionWithCoord({
      rangeWithCoord: t,
      primaryWithCoord: s,
      style: o
    }), o && this.updateStyle(o);
  }
  /**
   * Update primary range.
   * highlight cell would update if primary cell has value.
   * highlight cell would be cleared if primary cell is null.
   * highlight would keep prev value if primary cell is undefined.
   *
   * @param primaryCell model.current (aka: highlight)
   */
  // @TODO lumixraku there are 3 concepts for same thing, primary and current and highlight
  // highlight is best. primary sometimes means the actual cell(actual means ignore merge)
  updateCurrCell(t) {
    this._showAutoFill = t !== null, this._selectionRenderModel.setCurrentCell(t);
  }
  clearHighlight() {
    this._showAutoFill = !1, this._selectionRenderModel.clearCurrentCell(), this._updateLayoutOfSelectionControl(this._currentStyle);
  }
  getScene() {
    return this._scene;
  }
  // eslint-disable-next-line complexity
  dispose() {
    var t, n, i, o, s, l, a, c, d, u, h, g, m, f, v, p, S, w, C, I, R, y, M, E, T;
    (t = this._leftBorder) == null || t.dispose(), (n = this._rightBorder) == null || n.dispose(), (i = this._topBorder) == null || i.dispose(), (o = this._bottomBorder) == null || o.dispose(), (s = this._backgroundControlTop) == null || s.dispose(), (l = this._backgroundControlMiddleLeft) == null || l.dispose(), (a = this._backgroundControlMiddleRight) == null || a.dispose(), (c = this._backgroundControlBottom) == null || c.dispose(), this._autoFillControl.dispose(), (d = this._selectionShapeGroup) == null || d.dispose(), (u = this._rowHeaderBackground) == null || u.dispose(), (h = this._rowHeaderBorder) == null || h.dispose(), (g = this._rowHeaderGroup) == null || g.dispose(), (m = this._rowHeaderBackground) == null || m.dispose(), (f = this._columnHeaderBackground) == null || f.dispose(), (v = this._columnHeaderBorder) == null || v.dispose(), (p = this._columnHeaderGroup) == null || p.dispose(), (S = this._topLeftWidget) == null || S.dispose(), (w = this._topCenterWidget) == null || w.dispose(), (C = this._topRightWidget) == null || C.dispose(), (I = this._middleLeftWidget) == null || I.dispose(), (R = this._middleRightWidget) == null || R.dispose(), (y = this._bottomLeftWidget) == null || y.dispose(), (M = this._bottomCenterWidget) == null || M.dispose(), (E = this._bottomRightWidget) == null || E.dispose(), (T = this._controlExtension) == null || T.dispose(), super.dispose(), this._dispose$.next(this), this._dispose$.complete();
  }
  /**
   * Get the cell information of the current selection, considering the case of merging cells
   */
  getCurrentCellInfo() {
    const t = this.model.currentCell;
    if (t) {
      let n;
      if (t.isMerged) {
        const i = t.mergeInfo;
        n = {
          startRow: i.startRow,
          endRow: i.endRow,
          startColumn: i.startColumn,
          endColumn: i.endColumn,
          startX: i.startX,
          endX: i.endX,
          startY: i.startY,
          endY: i.endY
        };
      } else {
        const { actualRow: i, actualColumn: o, startX: s, endX: l, startY: a, endY: c } = t;
        n = {
          startRow: i,
          endRow: i,
          startColumn: o,
          endColumn: o,
          startX: s,
          endX: l,
          startY: a,
          endY: c
        };
      }
      return n;
    }
  }
  getValue() {
    return {
      ...this._selectionRenderModel.getValue(),
      style: this._currentStyle
    };
  }
  getRange() {
    return this._selectionRenderModel.getValue().rangeWithCoord;
  }
  enableHelperSelection() {
    this._isHelperSelection = !0;
  }
  disableHelperSelection() {
    this._isHelperSelection = !1;
  }
  _updateHeaderBackground(t) {
    const { startX: n, startY: i, endX: o, endY: s, rangeType: l } = this._selectionRenderModel, a = this._currentStyle, c = this._getScale(), {
      stroke: d,
      rowHeaderFill: u = a.rowHeaderFill,
      rowHeaderStroke: h = a.rowHeaderStroke,
      columnHeaderFill: g = a.columnHeaderFill,
      columnHeaderStroke: m = a.columnHeaderStroke
    } = t;
    let {
      rowHeaderStrokeWidth: f = a.rowHeaderStrokeWidth,
      columnHeaderStrokeWidth: v = a.columnHeaderStrokeWidth
    } = t;
    f /= c, v /= c;
    const p = this._rowHeaderWidth, S = this._columnHeaderHeight;
    if (this._highlightHeader && S > 0) {
      let w = g;
      l === z.COLUMN && (w = new fn(d).setAlpha(Uu).toString()), this._columnHeaderBackground.setProps({
        fill: w
      }), this._columnHeaderBackground.resize(o - n, S), this._columnHeaderBorder.setProps({
        fill: m
      }), this._columnHeaderBorder.transformByState({
        width: o - n,
        height: v,
        top: S - v + 1 / c
        // + 1 / scale: Avoid appearing thicker due to the adjacency of the first row cells.
      }), this._columnHeaderGroup.show(), this._columnHeaderGroup.translate(n, 0);
    } else
      this._columnHeaderGroup.hide();
    if (this._columnHeaderGroup.makeDirty(!0), this._highlightHeader && p > 0) {
      let w = u;
      l === z.ROW && (w = new fn(d).setAlpha(Uu).toString()), this._rowHeaderBackground.setProps({
        fill: w
      }), this._rowHeaderBackground.resize(p, s - i), this._rowHeaderBorder.setProps({
        fill: h
      }), this._rowHeaderBorder.transformByState({
        width: f,
        height: s - i,
        left: p - f + 1 / c
      }), this._rowHeaderGroup.show(), this._rowHeaderGroup.translate(0, i);
    } else
      this._rowHeaderGroup.hide();
    this._rowHeaderGroup.makeDirty(!0);
  }
  _updateBackgroundControl(t) {
    const { startX: n, startY: i, endX: o, endY: s } = this._selectionRenderModel, l = this._getScale(), { fill: a = t.fill } = t;
    let { strokeWidth: c } = t;
    c /= l;
    const d = this._selectionRenderModel.highlightToSelection();
    if (!d) {
      this._backgroundControlTop.resize(o - n, s - i), this._backgroundControlTop.setProps({ fill: a }), this._backgroundControlBottom.resize(0, 0), this._backgroundControlMiddleLeft.resize(0, 0), this._backgroundControlMiddleRight.resize(0, 0);
      return;
    }
    const { startX: u, startY: h, endX: g, endY: m } = d, f = c / 2, v = {
      left: -f,
      top: -f,
      width: o - n + f * 2,
      height: h - i + f
    };
    v.height < 0 && (v.width = 0, v.height = 0), this._backgroundControlTop.transformByState(v);
    const p = {
      left: -f,
      top: h - i,
      width: u - n + f,
      height: m - h
    };
    p.width < 0 && (p.width = 0, p.height = 0), this._backgroundControlMiddleLeft.transformByState(p);
    const S = {
      left: g - n - f,
      top: h - i,
      width: o - g + f * 2,
      height: m - h
    };
    S.width < 0 && (S.width = 0, S.height = 0), this._backgroundControlMiddleRight.transformByState(S);
    const w = {
      left: -f,
      top: m - i,
      width: o - n + f * 2,
      height: s - m + f
    };
    w.height < 0 && (w.width = 0, w.height = 0), this._backgroundControlBottom.transformByState(w), this._backgroundControlTop.setProps({ fill: a }), this._backgroundControlMiddleLeft.setProps({ fill: a }), this._backgroundControlMiddleRight.setProps({ fill: a }), this._backgroundControlBottom.setProps({ fill: a });
  }
  _updateWidgets(t) {
    const { startX: n, startY: i, endX: o, endY: s } = this._selectionRenderModel, { stroke: l = t.stroke, widgets: a = t.widgets, widgetStroke: c = t.widgetStroke } = t, d = this._getScale();
    let { widgetSize: u, widgetStrokeWidth: h } = t;
    u /= d, h /= d;
    const g = { left: -u / 2 + h / 2, center: (o - n) / 2 - u / 2 + h / 2, right: o - n - u / 2 + h / 2, top: -u / 2, middle: (s - i) / 2 - u / 2, bottom: s - i - u / 2 + h / 2 }, m = u - h;
    this._widgetRects.forEach((f) => {
      f.setProps({ fill: l, stroke: c });
    }), a.tl === !0 ? (this._topLeftWidget.transformByState({ height: m, width: m, left: g.left, top: g.top, strokeWidth: h }), this._topLeftWidget.show()) : this._topLeftWidget.hide(), a.tc === !0 ? (this._topCenterWidget.transformByState({ height: m, width: m, left: g.center, top: g.top, strokeWidth: h }), this._topCenterWidget.show()) : this._topCenterWidget.hide(), a.tr === !0 ? (this._topRightWidget.transformByState({ height: m, width: m, left: g.right, top: g.top, strokeWidth: h }), this._topRightWidget.show()) : this._topRightWidget.hide(), a.ml === !0 ? (this._middleLeftWidget.transformByState({ height: m, width: m, left: g.left, top: g.middle, strokeWidth: h }), this._middleLeftWidget.show()) : this._middleLeftWidget.hide(), a.mr === !0 ? (this._middleRightWidget.transformByState({ height: m, width: m, left: g.right, top: g.middle, strokeWidth: h }), this._middleRightWidget.show()) : this._middleRightWidget.hide(), a.bl === !0 ? (this._bottomLeftWidget.transformByState({ height: m, width: m, left: g.left, top: g.bottom, strokeWidth: h }), this._bottomLeftWidget.show()) : this._bottomLeftWidget.hide(), a.bc === !0 ? (this._bottomCenterWidget.transformByState({ height: m, width: m, left: g.center, top: g.bottom, strokeWidth: h }), this._bottomCenterWidget.show()) : this._bottomCenterWidget.hide(), a.br === !0 ? (this._bottomRightWidget.transformByState({ height: m, width: m, left: g.right, top: g.bottom, strokeWidth: h }), this._bottomRightWidget.show()) : this._bottomRightWidget.hide();
  }
  _hasWidgets(t) {
    if (t == null)
      return !1;
    const n = Object.keys(t);
    if (n.length === 0)
      return !1;
    for (const i of n)
      if (t[i] === !0)
        return !0;
    return !1;
  }
  _getScale() {
    const { scaleX: t, scaleY: n } = this._scene.getAncestorScale();
    return Math.max(t, n);
  }
  _stopAntLineAnimation() {
    this._antLineOffset = 0, xS(this._antRequestNewFrame);
  }
  _startAntLineAnimation() {
    const t = this._getScale();
    this._antLineOffset += 0.6 / t, this._antLineOffset > 160 / t && (this._antLineOffset = 0), this.dashedRect.setProps({
      strokeDashOffset: -this._antLineOffset
    }), this._antRequestNewFrame = OS(() => {
      this._startAntLineAnimation();
    });
  }
}
class OC extends HS {
  render(e, t = !1) {
    const n = de.now();
    return super.render(e, t), this._afterRender(n), this;
  }
  _afterRender(e) {
    this.scene.getEngine().renderFrameTimeMetric$.next(["selectionLayer", de.now() - e]);
  }
}
const gt = Yt("univer.sheet.selection-render-service");
class mm extends oe {
  constructor(t, n, i, o, s) {
    super();
    _(this, "_downObserver");
    _(this, "_scenePointerMoveSub");
    _(this, "_scenePointerUpSub");
    _(this, "_controlFillConfig$", new Me(null));
    _(this, "controlFillConfig$", this._controlFillConfig$.asObservable());
    _(this, "_selectionControls", []);
    // sheetID:Controls
    _(this, "_startRangeWhenPointerDown", {
      startY: 0,
      endY: 0,
      startX: 0,
      endX: 0,
      startRow: -1,
      endRow: -1,
      startColumn: -1,
      endColumn: -1
    });
    _(this, "_activeControlIndex", -1);
    /**
     * the posX of viewport when the pointer down
     */
    _(this, "_startViewportPosX", 0);
    /**
     * the posY of viewport when the pointer down
     */
    _(this, "_startViewportPosY", 0);
    _(this, "_scrollTimer");
    _(this, "_cancelDownSubscription");
    _(this, "_cancelUpSubscription");
    _(this, "_skeleton");
    /**
     * From renderContext.
     */
    _(this, "_scene");
    // The type of selector determines the type of data range and the highlighting style of the title bar, now it always true. In future, this could be configurable by user.
    _(this, "_highlightHeader", !0);
    // protected _shouldDetectMergedCells: boolean = true;
    _(this, "_rangeType", z.NORMAL);
    // The style of the selection area, including dashed lines, color, thickness, autofill, other points for modifying the range of the selection area, title highlighting, and so on, can all be customized.
    _(this, "_selectionStyle");
    // #region ref range selection
    // we put the properties here for simplicity
    // Used in the formula selection feature, a new selection string is added by drawing a box with the mouse.
    _(this, "_remainLastEnabled", !1);
    _(this, "_skipLastEnabled", !1);
    _(this, "_singleSelectionEnabled", !1);
    // #endregion
    /**
     * Mainly emit by pointerup in spreadsheet. (pointerup is handled in _onPointerdown)
     */
    _(this, "_selectionMoveEnd$", new Me([]));
    /**
     * Pointerup in spreadsheet
     */
    _(this, "selectionMoveEnd$", this._selectionMoveEnd$.asObservable());
    /**
     * Mainly emit by pointermove in spreadsheet
     */
    _(this, "_selectionMoving$", new He());
    /**
     * Pointermove in spreadsheet
     */
    _(this, "selectionMoving$", this._selectionMoving$.asObservable());
    _(this, "_selectionMoveStart$", new He());
    _(this, "selectionMoveStart$", this._selectionMoveStart$.asObservable());
    _(this, "_selectionMoving", !1);
    _(this, "_selectionTheme");
    _(this, "_activeViewport");
    _(this, "interceptor", new ki({ RANGE_MOVE_PERMISSION_CHECK: Wc, RANGE_FILL_PERMISSION_CHECK: Bc }));
    _(this, "_escapeShortcutDisposable", null);
    this._injector = t, this._themeService = n, this._shortcutService = i, this._sheetSkeletonManagerService = o, this.contextService = s, this._initSelectionThemeFromThemeService(), this._initMoving();
  }
  get selectionMoving() {
    return this._selectionMoving;
  }
  /**
   * If true, the selector will respond to the range of merged cells and automatically extend the selected range. If false, it will ignore the merged cells.
   */
  get _shouldDetectMergedCells() {
    return this._rangeType === z.NORMAL;
  }
  _initMoving() {
    this.disposeWithMe(this._selectionMoving$.subscribe(() => {
      this._selectionMoving = !0;
    })), this.disposeWithMe(this._selectionMoveEnd$.subscribe(() => {
      this._selectionMoving = !1;
    }));
  }
  _setSelectionStyle(t) {
    this._selectionStyle = t;
  }
  /**
   * Reset this._selectionStyle to default normal selection style
   */
  // protected _resetSelectionStyle(): void {
  //     this._setSelectionStyle(genNormalSelectionStyle(this._themeService));
  // }
  /** @deprecated This should not be provided by the selection render service. */
  getViewPort() {
    return this._activeViewport;
  }
  setSingleSelectionEnabled(t = !1) {
    this._singleSelectionEnabled = t;
  }
  newSelectionControl(t, n, i) {
    const o = this.getSelectionControls().length, { rowHeaderWidth: s, columnHeaderHeight: l } = n, a = new Wd(t, o, this._selectionTheme, {
      highlightHeader: this._highlightHeader,
      rowHeaderWidth: s,
      columnHeaderHeight: l
    });
    this._selectionControls.push(a);
    const c = Wt(i, n);
    return a.updateRangeBySelectionWithCoord(c, n), a.setControlExtension({
      skeleton: n,
      scene: t,
      themeService: this._selectionTheme,
      injector: this._injector,
      selectionHooks: {
        selectionMoveEnd: () => {
          this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
        }
      }
    }), a;
  }
  /**
   * Update the corresponding selectionControl based on selectionsData from WorkbookSelectionModel
   * selectionData[i] --> selectionControls[i]
   * @param selectionsWithStyleList {ISelectionWithStyle[]} selectionsData from WorkbookSelectionModel
   */
  resetSelectionsByModelData(t) {
    const n = this.getSelectionControls(), i = this._skeleton;
    if (!(!n || !i)) {
      for (let o = 0, s = t.length; o < s; o++) {
        const l = t[o], a = Wt(l, this._skeleton), c = n[o];
        c ? c.updateRangeBySelectionWithCoord(a, i) : this.isSelectionEnabled() && this.newSelectionControl(this._scene, i, l);
      }
      t.length < n.length && n.splice(t.length).forEach((s) => s.dispose());
    }
  }
  refreshSelectionMoveStart() {
    this._selectionMoveStart$.next(this.getSelectionDataWithStyle());
  }
  refreshSelectionMoveEnd() {
    this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
  }
  _initSelectionThemeFromThemeService() {
    const t = this._themeService.getCurrentTheme();
    this._selectionTheme = new Ht(), this._selectionTheme.setTheme(t);
  }
  setSelectionTheme(t) {
    this._selectionTheme.setTheme(t);
  }
  _changeRuntime(t, n, i) {
    this._skeleton = t, this._scene = n, this._activeViewport = i || (n == null ? void 0 : n.getViewports()[0]), n.findLayerByZIndex(Qs) || n.addLayer(new OC(n, [], Qs));
  }
  getSkeleton() {
    return this._skeleton;
  }
  /**
   * Generate selectionData from this._selectionControls.model .
   * @returns {ISelectionWithCoord[]} {range, primary, style}[]
   */
  getSelectionDataWithStyle() {
    const t = this._selectionControls;
    if (this._skeleton.worksheet) {
      const [n, i] = this._skeleton.getLocation();
      return t.map((o) => {
        const s = o.getValue();
        return s.rangeWithCoord.sheetId = i, s.rangeWithCoord.unitId = n, s;
      });
    }
    return [];
  }
  /**
   * @TODO lumixraku DO NOT expose private props.
   */
  getSelectionControls() {
    return this._selectionControls;
  }
  /**
   * Add a selection in spreadsheet, create a new SelectionControl and then update this control by range derives from selection.
   * @param {ISelectionWithCoord} selectionWithStyle
   */
  _addSelectionControlByModelData(t) {
    var l;
    const n = this._skeleton, i = (l = t.style) != null ? l : Sr(this._selectionTheme), o = this._scene;
    return t.style = i, this.newSelectionControl(o, n, t);
  }
  _clearAllSelectionControls() {
    const t = this._selectionControls;
    for (const n of t)
      n.dispose();
    this._selectionControls.length = 0;
  }
  _getFreeze() {
    var n;
    return (n = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : n.skeleton.getWorksheetConfig().freeze;
  }
  _getViewportByCell(t, n) {
    if (t === void 0 || n === void 0)
      return null;
    const i = this._getFreeze();
    if (!i || i.startRow <= 0 && i.startColumn <= 0)
      return this._scene.getViewport(F.VIEW_MAIN);
    if (t > i.startRow && n > i.startColumn)
      return this._scene.getViewport(F.VIEW_MAIN);
    if (t <= i.startRow && n <= i.startColumn)
      return this._scene.getViewport(F.VIEW_MAIN_LEFT_TOP);
    if (t <= i.startRow && n > i.startColumn)
      return this._scene.getViewport(F.VIEW_MAIN_TOP);
    if (t > i.startRow && n <= i.startColumn)
      return this._scene.getViewport(F.VIEW_MAIN_LEFT);
  }
  /**
   * Returns the selected range in the active sheet, or null if there is no active range. If multiple ranges are selected this method returns only the last selected range.
   */
  getActiveRange() {
    const t = this.getSelectionControls(), n = t && t[t.length - 1].model;
    return n && {
      startRow: n.startRow,
      startColumn: n.startColumn,
      endRow: n.endRow,
      endColumn: n.endColumn
    };
  }
  setActiveSelectionIndex(t) {
    this._activeControlIndex = t;
  }
  resetActiveSelectionIndex() {
    this._activeControlIndex = -1;
  }
  /**
   * get active(actually last) selection control
   * @returns T extends SelectionControl
   */
  getActiveSelectionControl() {
    const t = this.getSelectionControls();
    if (t)
      return this._activeControlIndex < 0 ? t[t.length - 1] : t[this._activeControlIndex];
  }
  endSelection() {
    var t;
    this._clearUpdatingListeners(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), (t = this._escapeShortcutDisposable) == null || t.dispose(), this._escapeShortcutDisposable = null;
  }
  /**
   * Clear existed selections by workbookSelections.selectionMoveEnd$
   */
  _reset() {
    var t;
    this._clearAllSelectionControls(), (t = this._downObserver) == null || t.unsubscribe(), this._downObserver = null;
  }
  /**
   * Init pointer move listener in each pointer down, unbind in each pointer up.
   * Both cell selections and row-column selections are supported by this method.
   * @param viewportMain
   * @param activeSelectionControl
   * @param rangeType
   * @param scrollTimerType
   * @param moveStartPosX
   * @param moveStartPosY
   */
  // eslint-disable-next-line max-lines-per-function
  _setupPointerMoveListener(t, n, i, o = bt.ALL, s, l) {
    var m, f;
    let a = 0, c = 0, d = s, u = l;
    this._scrollTimer = ei.create(this._scene, o), this._scrollTimer.startScroll((m = t == null ? void 0 : t.left) != null ? m : 0, (f = t == null ? void 0 : t.top) != null ? f : 0, t);
    const h = this._scene, g = h.getActiveViewportByCoord(ke.FromArray([s, l]));
    this._scenePointerMoveSub = h.onPointerMove$.subscribeEvent((v) => {
      var H, A, x, V, D, X, B, j, G;
      const { offsetX: p, offsetY: S } = v, { x: w, y: C } = h.getCoordRelativeToViewport(ke.FromArray([p, S]));
      this._movingHandler(w, C, n, i);
      let I = w, R = C;
      const y = this.getActiveSelectionControl(), M = this._getFreeze(), E = y == null ? void 0 : y.model, T = (H = h.getActiveViewportByCoord(ke.FromArray([p, S]))) != null ? H : this._getViewportByCell(E == null ? void 0 : E.endRow, E == null ? void 0 : E.endColumn);
      if ((() => {
        if (!g || !T || !t)
          return !1;
        const ge = [F.VIEW_MAIN, F.VIEW_MAIN_LEFT_TOP, F.VIEW_MAIN_TOP, F.VIEW_MAIN_LEFT];
        return ge.includes(g.viewportKey) && ge.includes(T.viewportKey);
      })()) {
        if (!g || !T || !t)
          return !1;
        const ge = d < t.left && w > t.left || d > t.left && w < t.left, Re = u < t.top && C > t.top || u > t.top && C < t.top;
        ge && (a += 1), Re && (c += 1);
        const be = g.viewportKey, Ne = T.viewportKey;
        if (be === F.VIEW_ROW_TOP)
          S < t.top && ((A = E == null ? void 0 : E.endRow) != null ? A : 0) < ((x = M == null ? void 0 : M.startRow) != null ? x : 0) ? R = t.top : Re && c % 2 === 1 && t.scrollToViewportPos({
            viewportScrollY: 0
          });
        else if (be === F.VIEW_COLUMN_LEFT)
          p < t.left && ((V = E == null ? void 0 : E.endColumn) != null ? V : 0) < ((D = M == null ? void 0 : M.startColumn) != null ? D : 0) ? I = t.left : ge && a % 2 === 1 && t.scrollToViewportPos({
            viewportScrollX: 0
          });
        else if (be === Ne) {
          let Z = !1, ee = !1;
          be === F.VIEW_MAIN_LEFT_TOP ? (Z = !0, ee = !0) : be === F.VIEW_MAIN_TOP ? ee = !0 : be === F.VIEW_MAIN_LEFT && (Z = !0), ((X = E == null ? void 0 : E.endRow) != null ? X : 0) > ((B = M == null ? void 0 : M.startRow) != null ? B : 0) && (ee = !1), ((j = E == null ? void 0 : E.endColumn) != null ? j : 0) > ((G = M == null ? void 0 : M.startColumn) != null ? G : 0) && (Z = !1), Z && (I = t.left), ee && (R = t.top);
        } else {
          const Z = {
            x: g.scrollX,
            y: g.scrollY
          }, ee = {
            x: T.scrollX,
            y: T.scrollY
          }, ne = Z.x !== ee.x && ge && a % 2 === 1, pe = Z.y !== ee.y && Re && c % 2 === 1;
          (ne || pe) && (t.scrollToBarPos({
            x: ne ? Z.x : void 0,
            y: pe ? Z.y : void 0
          }), ne || (I = t.left), pe || (R = t.top)), (be === F.VIEW_MAIN_LEFT_TOP && Ne === F.VIEW_MAIN_LEFT || Ne === F.VIEW_MAIN_LEFT_TOP && be === F.VIEW_MAIN_LEFT) && (I = t.left), (be === F.VIEW_MAIN_LEFT_TOP && Ne === F.VIEW_MAIN_TOP || Ne === F.VIEW_MAIN_LEFT_TOP && be === F.VIEW_MAIN_TOP) && (R = t.top);
        }
        d = w, u = C;
      }
      this._scrollTimer.scrolling(I, R, () => {
        this._movingHandler(w, C, n, i);
      });
    });
  }
  /** @deprecated Use the function `attachSelectionWithCoord` instead`. */
  attachSelectionWithCoord(t) {
    return Wt(t, this._skeleton);
  }
  /** @deprecated Use the function `attachPrimaryWithCoord` instead`. */
  attachPrimaryWithCoord(t) {
    return Ks(this._skeleton, t);
  }
  /**
   * @deprecated Please use `getCellWithCoordByOffset` instead.
   */
  getSelectionCellByPosition(t, n) {
    return this.getCellWithCoordByOffset(t, n);
  }
  getCellWithCoordByOffset(t, n, i) {
    const o = this._scene, s = i != null ? i : this._skeleton, l = o.getViewportScrollXY(o.getViewport(F.VIEW_MAIN)), { scaleX: a, scaleY: c } = o.getAncestorScale();
    return s.getCellWithCoordByOffset(t, n, a, c, l);
  }
  /**
   * When mousedown and mouseup need to go to the coordination and undo stack, when mousemove does not need to go to the coordination and undo stack
   */
  _movingHandler(t, n, i, o) {
    var I, R, y, M, E;
    const s = this._skeleton, l = this._scene, [a, c] = s.getLocation(), d = {
      startRow: (I = i == null ? void 0 : i.model.startRow) != null ? I : -1,
      endRow: (R = i == null ? void 0 : i.model.endRow) != null ? R : -1,
      startColumn: (y = i == null ? void 0 : i.model.startColumn) != null ? y : -1,
      endColumn: (M = i == null ? void 0 : i.model.endColumn) != null ? M : -1
    }, u = l.getViewport(F.VIEW_MAIN), h = (E = this._getViewportByCell(d.endRow, d.endColumn)) != null ? E : u, g = l.getScrollXYInfoByViewport(
      ke.FromArray([this._startViewportPosX, this._startViewportPosY]),
      h
    ), { scaleX: m, scaleY: f } = l.getAncestorScale();
    o === z.ROW ? t = Number.POSITIVE_INFINITY : o === z.COLUMN && (n = Number.POSITIVE_INFINITY);
    const v = this._skeleton.getCellByOffset(t, n, m, f, g);
    if (!v)
      return;
    let p = {
      startRow: Math.min(v.startRow, this._startRangeWhenPointerDown.startRow),
      startColumn: Math.min(v.startColumn, this._startRangeWhenPointerDown.startColumn),
      endRow: Math.max(v.endRow, this._startRangeWhenPointerDown.endRow),
      endColumn: Math.max(v.endColumn, this._startRangeWhenPointerDown.endColumn)
    };
    this._shouldDetectMergedCells && (p = s.expandRangeByMerge(p));
    const w = Wt({ range: p, primary: void 0, style: null }, s);
    w.rangeWithCoord.unitId = a, w.rangeWithCoord.sheetId = c, w.rangeWithCoord.rangeType = o;
    const C = d.startRow !== p.startRow || d.startColumn !== p.startColumn || d.endRow !== p.endRow || d.endColumn !== p.endColumn;
    i != null && C && (i.updateRangeBySelectionWithCoord(w), this._selectionMoving$.next(this.getSelectionDataWithStyle()));
  }
  _clearUpdatingListeners() {
    var n, i, o, s, l;
    this._scene.enableObjectsEvent(), (n = this._scenePointerMoveSub) == null || n.unsubscribe(), this._scenePointerMoveSub = null, (i = this._scenePointerUpSub) == null || i.unsubscribe(), this._scenePointerUpSub = null, (o = this._cancelDownSubscription) == null || o.unsubscribe(), this._cancelDownSubscription = null, (s = this._cancelUpSubscription) == null || s.unsubscribe(), this._cancelUpSubscription = null, (l = this._scrollTimer) == null || l.dispose();
  }
  _addEndingListeners() {
    var i, o, s;
    const t = this._scene, n = (i = t.getEngine()) == null ? void 0 : i.activeScene;
    !n || n === t || ((o = this._cancelDownSubscription) == null || o.unsubscribe(), this._cancelDownSubscription = null, (s = this._cancelUpSubscription) == null || s.unsubscribe(), this._cancelUpSubscription = null, this._cancelDownSubscription = n.onPointerDown$.subscribeEvent(() => this._clearUpdatingListeners()), this._cancelUpSubscription = n.onPointerUp$.subscribeEvent(() => this._clearUpdatingListeners()));
  }
  /**
   * Get visible selection range & coord by offset on viewport. Nearly same as skeleton.getCellWithCoordByOffset
   * Returning selection is only one cell. primary and range are same cell.
   *
   * visible selection range means getCellWithCoordByOffset needs first matched row/col in rowHeightAccumulation & colWidthAccumulation.
   * Original name: _getCellRangeByCursorPosition
   *
   * @param offsetX position X in viewport.
   * @param offsetY
   * @param scaleX
   * @param scaleY
   * @param scrollXY
   * @returns {Nullable<ISelectionWithCoord>} selection range with coord.
   */
  _getSelectionWithCoordByOffset(t, n, i, o, s) {
    const l = this._skeleton;
    if (l == null) return null;
    if (this._shouldDetectMergedCells) {
      const p = l == null ? void 0 : l.getCellWithCoordByOffset(
        t,
        n,
        i,
        o,
        s,
        { firstMatch: !0 }
      );
      if (!p) return;
      const S = Ds(p);
      return {
        primaryWithCoord: p,
        rangeWithCoord: S
      };
    }
    const { row: a, column: c } = l.getCellIndexByOffset(t, n, i, o, s), d = l.getNoMergeCellWithCoordByIndex(a, c), { startX: u, startY: h, endX: g, endY: m } = d, f = {
      startY: h,
      endY: m,
      startX: u,
      endX: g,
      startRow: a,
      endRow: a,
      startColumn: c,
      endColumn: c
    };
    return {
      primaryWithCoord: {
        mergeInfo: f,
        actualRow: a,
        actualColumn: c,
        isMerged: !1,
        isMergedMainCell: !1,
        startY: h,
        endY: m,
        startX: u,
        endX: g
      },
      rangeWithCoord: f
    };
  }
  _checkClearPreviousControls(t) {
    this.getSelectionControls().length !== 0 && (!t.ctrlKey && !t.shiftKey && !this._remainLastEnabled || this._singleSelectionEnabled && !t.shiftKey) && this._clearAllSelectionControls();
  }
  _makeSelectionByTwoCells(t, n, i, o, s) {
    const { actualRow: l, actualColumn: a, mergeInfo: c } = t;
    this._startRangeWhenPointerDown = { ...t.mergeInfo };
    const d = Math.min(l, n.startRow, c.startRow), u = Math.max(l, n.endRow, c.endRow), h = Math.min(a, n.startColumn, c.startColumn), g = Math.max(a, n.endColumn, c.endColumn), f = {
      range: i.expandRangeByMerge({
        startRow: d,
        startColumn: h,
        endRow: u,
        endColumn: g
      }),
      primary: Tv(t),
      style: null
    }, v = Wt(f, i);
    s.updateRangeBySelectionWithCoord(v);
  }
  isSelectionEnabled() {
    return this.contextService.getContextValue(Zr);
  }
  isSelectionDisabled() {
    return this.contextService.getContextValue(Zr) === !1;
  }
  inRefSelectionMode() {
    return this.contextService.getContextValue(vo);
  }
}
function fm(r) {
  return {
    range: {
      startRow: 0,
      startColumn: 0,
      endRow: r.getRowCount() - 1,
      endColumn: r.getColumnCount() - 1,
      rangeType: z.ALL
    },
    primary: Bd(r).primary,
    style: null
  };
}
function Bd(r) {
  return AC(r, {
    startRow: 0,
    startColumn: 0,
    endRow: 0,
    endColumn: 0
  });
}
function AC(r, e) {
  const t = r.worksheet.getCellInfoInMergeData(e.startRow, e.startColumn), n = r.worksheet.getCellInfoInMergeData(e.endRow, e.endColumn);
  return {
    range: {
      startRow: t.startRow,
      startColumn: t.startColumn,
      endRow: n.endRow,
      endColumn: n.endColumn,
      rangeType: z.NORMAL
    },
    primary: {
      actualRow: t.startRow,
      actualColumn: t.startColumn,
      startRow: t.startRow,
      startColumn: t.startColumn,
      endRow: t.endRow,
      endColumn: t.endColumn,
      isMerged: t.isMerged,
      isMergedMainCell: t.isMergedMainCell
    },
    style: null
  };
}
var HC = Object.getOwnPropertyDescriptor, VC = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? HC(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Xu = (r, e) => (t, n) => e(t, n, r);
let ue = class extends oe {
  constructor(e, t, n) {
    super();
    _(this, "_sheetId", "");
    // @TODO lumixraku, why need this?  How about put dirty & sheetId & unitId in skeleton itself?
    _(this, "_sheetSkeletonParamStore", /* @__PURE__ */ new Map());
    _(this, "_currentSkeleton$", new Me(null));
    _(this, "currentSkeleton$", this._currentSkeleton$.asObservable());
    /**
     * CurrentSkeletonBefore for pre-triggered logic during registration
     */
    _(this, "_currentSkeletonBefore$", new Me(null));
    _(this, "currentSkeletonBefore$", this._currentSkeletonBefore$.asObservable());
    this._context = e, this._injector = t, this._sheetSkService = n, this.disposeWithMe(() => {
      this._currentSkeletonBefore$.complete(), this._currentSkeleton$.complete(), this._sheetSkeletonParamStore.forEach((i) => this.disposeSkeleton(i.sheetId)), this._sheetSkeletonParamStore.clear();
    }), this._initRemoveSheet();
  }
  _initRemoveSheet() {
    this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe((e) => {
      this.disposeSkeleton(e.getSheetId());
    }));
  }
  getCurrentSkeleton() {
    var e;
    return (e = this.getCurrentParam()) == null ? void 0 : e.skeleton;
  }
  /**
   * @deprecated use `getCurrentSkeleton` instead.
   */
  getCurrent() {
    return this.getCurrentParam();
  }
  /**
   * get ISheetSkeletonManagerParam from _currentSkeletonSearchParam
   * @returns
   */
  getCurrentParam() {
    return this._getSkeletonParam(this._sheetId);
  }
  /**
   * Get skeleton by sheetId
   * @param sheetId
   */
  getSkeleton(e) {
    return this._getSkeleton(e);
  }
  /**
   * Get SkeletonParam by sheetId
   * @param sheetId
   */
  getSkeletonParam(e) {
    return this._getSkeletonParam(e);
  }
  /**
   * @deprecated use `getSkeleton` instead.
   */
  getWorksheetSkeleton(e) {
    return this.getSkeletonParam(e);
  }
  // why ?? what does unitId for ??? no need unitId, this service is registered in render unit already.
  getUnitSkeleton(e, t) {
    const n = this._getSkeletonParam(t);
    return n != null && (n.unitId = e), n;
  }
  /**
   * Command in COMMAND_LISTENER_SKELETON_CHANGE would cause setCurrent, see @packages/sheets-ui/src/controllers/render-controllers/sheet.render-controller.ts
   * @param searchParam
   */
  setCurrent(e) {
    this._setCurrent(e.sheetId);
  }
  setSkeletonParam(e, t) {
    this._sheetSkService.setSkeleton(t.unitId, e, t.skeleton), this._sheetSkeletonParamStore.set(e, t);
  }
  _setCurrent(e) {
    this._sheetId = e;
    const t = this._getSkeletonParam(e), n = this._context.unitId;
    if (t != null)
      this.reCalculate(t);
    else {
      const s = this._context.unit.getSheetBySheetId(e);
      if (s == null)
        return;
      const l = this._context.scene, a = this._buildSkeleton(s, l);
      this.setSkeletonParam(e, {
        unitId: n,
        sheetId: e,
        skeleton: a,
        dirty: !1
      });
    }
    const i = this._getSkeletonParam(e);
    this._currentSkeletonBefore$.next(i), this._currentSkeleton$.next(i);
  }
  // @TODO why need this function? How about caller get skeleton and call sk.calculate()?
  reCalculate(e) {
    e || (e = this.getCurrentParam()), e != null && (e.dirty && (e.skeleton.makeDirty(!0), e.dirty = !1), e.skeleton.calculate());
  }
  /**
   * Make param dirty, if param is dirty, then the skeleton will be makeDirty in _reCalculate()
   * @param searchParm
   * @param state
   */
  makeDirty(e, t = !0) {
    const n = this._getSkeletonParam(e.sheetId);
    n != null && (n.dirty = t);
  }
  /**
   * @deprecated Use function `ensureSkeleton` instead.
   * @param searchParam
   */
  getOrCreateSkeleton(e) {
    return this.ensureSkeleton(e.sheetId);
  }
  ensureSkeleton(e) {
    const t = this._getSkeletonParam(e);
    if (t)
      return t.skeleton;
    const i = this._context.unit.getSheetBySheetId(e);
    if (!i)
      return;
    const o = this._buildSkeleton(i);
    return this.setSkeletonParam(e, {
      unitId: this._context.unitId,
      sheetId: e,
      skeleton: o,
      dirty: !1
    }), o;
  }
  disposeSkeleton(e) {
    const t = this.getSkeletonParam(e);
    t && (t.skeleton.dispose(), this._sheetSkeletonParamStore.delete(e), this._sheetSkService.deleteSkeleton(t.unitId, e));
  }
  /** @deprecated Use function `attachRangeWithCoord` instead.  */
  attachRangeWithCoord(e) {
    const t = this.getCurrentSkeleton();
    return t ? bo(t, e) : null;
  }
  _getSkeletonParam(e) {
    return this._sheetSkeletonParamStore.get(e);
  }
  _getSkeleton(e) {
    const t = this._getSkeletonParam(e);
    return t ? t.skeleton : null;
  }
  _buildSkeleton(e, t) {
    return this._injector.createInstance(
      VS,
      e,
      this._context.unit.getStyles()
    );
  }
  setColumnHeaderSize(e, t, n) {
    var c;
    if (!e) return;
    const i = (c = this.getWorksheetSkeleton(t)) == null ? void 0 : c.skeleton;
    if (!i) return;
    i.columnHeaderHeight = n, e.scene.getViewports()[0].top = n, e.scene.getViewport(F.VIEW_COLUMN_RIGHT).setViewportSize({
      height: n
    }), e.scene.getViewport(F.VIEW_COLUMN_LEFT).setViewportSize({
      height: n
    }), e.scene.getViewport(F.VIEW_ROW_BOTTOM).setViewportSize({
      top: n
    }), e.scene.getViewport(F.VIEW_ROW_TOP).setViewportSize({
      top: n
    }), e.scene.getViewport(F.VIEW_LEFT_TOP).setViewportSize({
      height: n
    });
    const o = e == null ? void 0 : e.with(Q), s = e == null ? void 0 : e.with(gt), l = o.getCurrentSelections();
    s.resetSelectionsByModelData(l);
    const a = this.getUnitSkeleton(e.unitId, t);
    a && (a.commandId = sa.id, this._currentSkeleton$.next(a));
  }
  setRowHeaderSize(e, t, n) {
    var g;
    const i = (g = this.getWorksheetSkeleton(t)) == null ? void 0 : g.skeleton;
    if (!e || !i) return;
    i.rowHeaderWidth = n;
    const o = e.scene.getViewport(F.VIEW_LEFT_TOP).width || 46, s = n - o, l = e.scene.getViewports()[0].left;
    e.scene.getViewports()[0].left = l + s, e.scene.getViewport(F.VIEW_ROW_BOTTOM).setViewportSize({
      width: n
    }), e.scene.getViewport(F.VIEW_ROW_TOP).setViewportSize({
      width: n
    }), e.scene.getViewport(F.VIEW_COLUMN_LEFT).setViewportSize({
      left: n
    });
    const a = e.scene.getViewport(F.VIEW_COLUMN_RIGHT).left || 0;
    e.scene.getViewport(F.VIEW_COLUMN_RIGHT).setViewportSize({
      left: a + s
    }), e.scene.getViewport(F.VIEW_LEFT_TOP).setViewportSize({
      width: n
    });
    const c = e == null ? void 0 : e.with(Q), d = e == null ? void 0 : e.with(gt), u = c.getCurrentSelections();
    d.resetSelectionsByModelData(u);
    const h = this.getCurrent();
    h && (h.commandId = oa.id, this._currentSkeleton$.next(h));
  }
};
ue = VC([
  Xu(1, N(Rt)),
  Xu(2, N(Pv))
], ue);
var NC = Object.getOwnPropertyDescriptor, kC = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? NC(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Zi = (r, e) => (t, n) => e(t, n, r);
const DC = ["ff", "fs", "tr", "tb"];
let hi = class extends oe {
  constructor(r, e, t, n, i) {
    super(), this._renderManagerService = r, this._sheetInterceptorService = e, this._selectionManagerService = t, this._univerInstanceService = n, this._configService = i, this._initialize();
  }
  _processLazyAutoHeight(r, e, t, n) {
    if (n != null && n.length) {
      const i = {
        id: lg.id,
        params: {
          unitId: e,
          subUnitId: t,
          ranges: n,
          id: xn()
        },
        options: {
          onlyLocal: !0
        }
      }, o = {
        id: ag.id,
        params: {
          unitId: e,
          subUnitId: t,
          id: i.params.id
        },
        options: {
          onlyLocal: !0
        }
      };
      return {
        redos: [...r.redos, i],
        undos: [...r.undos, o]
      };
    }
    return r;
  }
  getUndoRedoParamsOfAutoHeight(r, e, t) {
    const { _univerInstanceService: n } = this, i = n.getCurrentUnitForType(O.UNIVER_SHEET), o = i.getUnitId();
    let s = i.getActiveSheet(), l = s.getSheetId();
    if (e) {
      const m = Xe(n, { unitId: o, subUnitId: e });
      m && (s = m.worksheet, l = s.getSheetId());
    }
    const c = this._renderManagerService.getRenderById(o).with(ue).ensureSkeleton(l);
    if (!c)
      return {
        redos: [],
        undos: []
      };
    const u = c.calculateAutoHeightInRange(r, t).filter((m) => {
      const { row: f, autoHeight: v } = m;
      return !(!v || s.getRowHeight(f) === v);
    });
    if (u.length === 0)
      return {
        redos: [],
        undos: []
      };
    const h = {
      subUnitId: l,
      unitId: o,
      rowsAutoHeightInfo: u
    }, g = cg(h, s);
    return {
      undos: [
        {
          id: er.id,
          params: g
        }
      ],
      redos: [
        {
          id: er.id,
          params: h
        }
      ]
    };
  }
  _initialize() {
    this.disposeWithMe(this._sheetInterceptorService.interceptAutoHeight({
      getMutations: (r) => {
        const { unitId: e, subUnitId: t, ranges: n, autoHeightRanges: i, lazyAutoHeightRanges: o, cellHeights: s } = r, l = this.getUndoRedoParamsOfAutoHeight(i != null ? i : n, t, s);
        return this._processLazyAutoHeight(l, e, t, o);
      }
    }));
  }
};
hi = kC([
  Zi(0, fe),
  Zi(1, N(vn)),
  Zi(2, N(Q)),
  Zi(3, N(k)),
  Zi(4, Vt)
], hi);
function Cr(r) {
  const { rows: e, cols: t } = r;
  return {
    startRow: e[0],
    endRow: e[e.length - 1],
    startColumn: t[0],
    endColumn: t[t.length - 1]
  };
}
function wr(r) {
  let e = [], t = [];
  const n = [];
  return r.forEach((i) => {
    e = e.concat(i.rows), t = t.concat(i.cols);
  }), e = Array.from(new Set(e)).sort((i, o) => i - o), t = Array.from(new Set(t)).sort((i, o) => i - o), r.forEach((i) => {
    n.push({
      startRow: e.findIndex((o) => o === i.rows[0]),
      endRow: e.findIndex((o) => o === i.rows[i.rows.length - 1]),
      startColumn: t.findIndex((o) => o === i.cols[0]),
      endColumn: t.findIndex((o) => o === i.cols[i.cols.length - 1])
    });
  }), {
    ranges: n,
    mapFunc: (i, o) => ({
      row: e[i],
      col: t[o]
    })
  };
}
function LC(r) {
  const e = new Ge();
  return r.forEach((t) => {
    const { rows: n, cols: i } = t;
    n.forEach((o) => {
      i.forEach((s) => {
        e.setValue(o, s, {
          v: null,
          p: null,
          f: null,
          si: null,
          custom: null
        });
      });
    });
  }), e.getData();
}
const Uc = { : 0, : 1, : 2, : 3, : 4, : 5, : 6, : 7, : 8, : 9 }, Js = ["", "", "", "", "", "", "", "", "", ""], zu = ["", "", "", "", ""], WC = ["", "", "", ""], pm = {
  : { value: 10, secUnit: !1 },
  : { value: 100, secUnit: !1 },
  : { value: 1e3, secUnit: !1 },
  : { value: 1e4, secUnit: !0 },
  : { value: 1e8, secUnit: !0 }
};
function Mn(r) {
  if (!r)
    return 0;
  let e = 0, t = 0, n = 0, i = !1;
  const o = r.split("");
  for (let s = 0; s < o.length; s++) {
    const l = Uc[o[s]];
    if (typeof l < "u")
      n = l, s === o.length - 1 && (t += n);
    else {
      const a = pm[o[s]], c = a.value;
      i = a.secUnit, i ? (t = (t + n) * c, e += t, t = 0) : t += n * c, n = 0;
    }
  }
  return e + t;
}
function BC(r) {
  let e = "", t = "", n = 0, i = !0;
  for (; r > 0; ) {
    const o = r % 10;
    o === 0 ? i || (i = !0, t = Js[o] + t) : (i = !1, e = Js[o], e += WC[n], t = e + t), n++, r = Math.floor(r / 10);
  }
  return t;
}
function FC(r) {
  let e = 0, t = "", n = "", i = !1;
  if (r === 0)
    return Js[0];
  for (; r > 0; ) {
    const o = r % 1e4;
    i && (n = Js[0] + n), t = BC(o), t += o !== 0 ? zu[e] : zu[0], n = t + n, i = o < 1e3 && o > 0, r = Math.floor(r / 1e4), e++;
  }
  return n;
}
function UC(r) {
  if (!r)
    return !1;
  let e = !0;
  if (r)
    if (r.length === 1)
      r === "" || r in Uc ? e = !0 : e = !1;
    else {
      const t = r.split("");
      for (let n = 0; n < t.length; n++)
        if (!(t[n] in Uc || t[n] in pm)) {
          e = !1;
          break;
        }
    }
  return e;
}
function Ss(r) {
  if (!r)
    return {
      isExtendNumber: !1
    };
  const e = /0|([1-9]+[0-9]*)/g, t = e.test(r);
  if (t) {
    const n = r.match(e);
    if (n && n.length > 0) {
      const i = n[n.length - 1], o = r.lastIndexOf(i), s = r.substr(0, o), l = r.substr(o + i.length);
      return {
        isExtendNumber: !0,
        matchTxt: Number(i),
        beforeTxt: s,
        afterTxt: l
      };
    }
    return {
      isExtendNumber: !1
    };
  }
  return {
    isExtendNumber: t
  };
}
function XC(r) {
  let e;
  return r.length === 2 && (r === "" || r === "" || r === "" || r === "" || r === "" || r === "" || r === "") ? e = !0 : e = !1, e;
}
function zC(r) {
  let e;
  return r.length === 3 && (r === "" || r === "" || r === "" || r === "" || r === "" || r === "" || r === "") ? e = !0 : e = !1, e;
}
function jC(r, e) {
  let t = 0;
  for (let n = 0; n < r.length && r[n] < e; n++)
    t++;
  return t;
}
function es(r) {
  let e = !0;
  const t = r[1] - r[0];
  for (let n = 1; n < r.length; n++)
    if (r[n] - r[n - 1] !== t) {
      e = !1;
      break;
    }
  return e;
}
function YC(r, e, t) {
  const n = [], i = Math.floor(e / r), o = e % r;
  let s = 0;
  if (i > 0) {
    for (let l = 0; l < i; l++)
      for (let a = 0; a < t.length; a++)
        n[t[a] + l * r] = s, s++;
    for (let l = 0; l < t.length && t[l] < o; l++)
      n[t[l] + r * i] = s, s++;
  } else
    for (let l = 0; l < t.length && t[l] < o; l++)
      n[t[l]] = s, s++;
  return n;
}
function br(r, e) {
  const t = [];
  for (let n = 1; n <= e; n++) {
    const i = (n - 1) % r.length, o = de.deepClone(r[i]);
    _r(o), t.push({
      v: null,
      s: null,
      p: null,
      f: null,
      si: null,
      t: null,
      ...o
    });
  }
  return t;
}
function ZC(r, e) {
  var n;
  const t = [];
  for (let i = 1; i <= e; i++) {
    const o = (i - 1) % r.length, s = { s: (n = r[o]) == null ? void 0 : n.s };
    t.push(s);
  }
  return t;
}
function GC(r) {
  let e = !0;
  const t = r[1] / r[0];
  for (let n = 1; n < r.length; n++)
    if (r[n] / r[n - 1] !== t) {
      e = !1;
      break;
    }
  return e;
}
function qC(r) {
  const e = [];
  for (let t = 1; t <= r; t++)
    e.push(t);
  return e;
}
function $s(r, e, t) {
  var o, s, l, a;
  const n = [], i = [];
  for (let c = 0; c < r.length; c++)
    i.push(Number((o = r[c]) == null ? void 0 : o.v));
  if (r.length > 2 && GC(i))
    for (let c = 1; c <= e; c++) {
      const d = (c - 1) % r.length, u = de.deepClone(r[d]);
      _r(u);
      const h = Number((s = r[r.length - 1]) == null ? void 0 : s.v) * (Number((l = r[1]) == null ? void 0 : l.v) / Number((a = r[0]) == null ? void 0 : a.v)) ** c;
      u && (Gu(u) && (u.v = h), n.push(u));
    }
  else {
    const c = qC(r.length);
    for (let d = 1; d <= e; d++) {
      const u = (d - 1) % r.length, h = de.deepClone(r[u]);
      _r(h);
      const g = t === U.DOWN || t === U.RIGHT, m = QC(r.length + d, i, c, g);
      h && (Gu(h) && (h.v = m), n.push(h));
    }
  }
  return n;
}
function QC(r, e, t, n = !0) {
  function i(u) {
    let h = 0;
    for (let g = 0; g < u.length; g++)
      h += u[g];
    return h / u.length;
  }
  const o = i(t), s = i(e);
  let l = 0, a = 0;
  for (let u = 0; u < t.length; u++)
    l += (t[u] - o) * (e[u] - s), a += (t[u] - o) * (t[u] - o);
  let c;
  a === 0 ? c = n ? 1 : -1 : c = l / a;
  const d = s - c * o;
  return Math.round((d + c * r) * 1e5) / 1e5;
}
function ju(r, e, t) {
  var o;
  const n = [], i = /0|([1-9]+[0-9]*)/g;
  for (let s = 1; s <= e; s++) {
    const l = (s - 1) % r.length, a = de.deepClone(r[l]);
    _r(a);
    const c = `${(o = r[r.length - 1]) == null ? void 0 : o.v}`;
    if (!c) continue;
    const d = c == null ? void 0 : c.match(i), u = d == null ? void 0 : d[d.length - 1];
    if (!u) continue;
    const h = Math.abs(Number(u) + t * s), g = c.lastIndexOf(u), m = c.substr(0, g) + h.toString() + c.substr(g + u.length);
    a && (a.v = m, n.push(a));
  }
  return n;
}
function gi(r, e, t, n = 0) {
  var l, a;
  const i = [
    ["", "", "", "", "", "", ""],
    ["", "", "", "", "", "", ""],
    ["", "", "", "", "", "", ""]
  ];
  if (n >= i.length) return [];
  const o = i[n], s = [];
  for (let c = 1; c <= e; c++) {
    const d = (c - 1) % r.length, u = de.deepClone(r[d]);
    _r(u);
    let h = 0;
    if (((l = r[r.length - 1]) == null ? void 0 : l.v) === o[0])
      h = 7 + t * c;
    else {
      const m = `${(a = r[r.length - 1]) == null ? void 0 : a.v}`;
      if (m) {
        const f = m.substr(m.length - 1, 1);
        h = Mn(f) + t * c;
      }
    }
    h < 0 && (h = Math.ceil(Math.abs(h) / 7) * 7 + h);
    const g = h % 7;
    u && (u.v = o[g], s.push(u));
  }
  return s;
}
function Yu(r, e, t) {
  var i;
  const n = [];
  for (let o = 1; o <= e; o++) {
    const s = (o - 1) % r.length, l = de.deepClone(r[s]);
    _r(l);
    const a = `${(i = r[r.length - 1]) == null ? void 0 : i.v}`, c = Mn(a) + t * o;
    let d;
    c <= 0 ? d = "" : d = FC(c), l && (l.v = d, n.push(l));
  }
  return n;
}
const ho = {
  enWeek1: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
  enWeek2: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
  enMonth1: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
  enMonth2: [
    "January",
    "February",
    "March",
    "April",
    "May",
    "June",
    "July",
    "August",
    "September",
    "October",
    "November",
    "December"
  ],
  chnMonth1: ["", "", "", "", "", "", "", "", "", "", "", ""],
  chnMonth2: ["", "", "", "", "", "", "", "", "", "", "", ""],
  chHour1: ["", "", "", "", "", "", "", "", "", "", "", ""],
  chHour2: ["", "", "", "", "", "", "", "", "", "", "", ""],
  chYear1: ["", "", "", "", "", "", "", "", "", ""],
  chSeason1: ["", "", "", ""],
  chSeason2: ["", "", "", ""]
};
function KC(r) {
  let e = !1;
  return Object.keys(ho).forEach((t) => {
    ho[t].includes(r) && (e = !0);
  }), e;
}
function ka(r) {
  let e = "";
  const t = [];
  return Object.keys(ho).forEach((n) => {
    ho[n].includes(r) && (e = n, t.push(...ho[n]));
  }), { name: e, series: t };
}
function Zu(r, e, t, n) {
  var s;
  const i = n.length, o = [];
  for (let l = 1; l <= e; l++) {
    const a = (l - 1) % r.length, c = de.deepClone(r[a]);
    _r(c);
    const d = `${(s = r[r.length - 1]) == null ? void 0 : s.v}`;
    let u = n.indexOf(d) + t * l;
    u < 0 && (u += Math.abs(t) * i);
    const h = u % i;
    c && (c.v = n[h], o.push(c));
  }
  return o;
}
function zy(r, e) {
  const t = [];
  let n;
  if (e.startRow < r.startRow)
    n = U.UP;
  else if (e.endRow > r.endRow)
    n = U.DOWN;
  else if (e.startColumn < r.startColumn)
    n = U.LEFT;
  else if (e.endColumn > r.endColumn)
    n = U.RIGHT;
  else
    return [];
  if (n === U.DOWN || n === U.UP) {
    const i = r.endRow - r.startRow + 1, o = e.endRow - e.startRow + 1, s = Math.floor(o / i), l = o % i, a = {
      startRow: 0,
      startColumn: 0,
      endRow: r.endRow - r.startRow,
      endColumn: r.endColumn - r.startColumn
    };
    if (n === U.DOWN) {
      for (let c = 0; c < s; c++)
        t.push({
          repeatStartCell: {
            row: r.startRow + (c + 1) * i,
            col: r.startColumn
          },
          relativeRange: a
        });
      l > 0 && t.push({
        repeatStartCell: {
          row: r.startRow + (s + 1) * i,
          col: r.startColumn
        },
        relativeRange: {
          startRow: 0,
          startColumn: 0,
          endRow: l - 1,
          endColumn: r.endColumn - r.startColumn
        }
      });
    } else {
      for (let c = 0; c < s; c++)
        t.push({
          repeatStartCell: {
            row: r.startRow - (c + 1) * i,
            col: r.startColumn
          },
          relativeRange: a
        });
      l > 0 && t.push({
        repeatStartCell: {
          row: r.startRow - (s + 1) * i,
          col: r.startColumn
        },
        relativeRange: {
          startRow: i - l,
          endRow: i - 1,
          startColumn: 0,
          endColumn: r.endColumn - r.startColumn
        }
      });
    }
  }
  if (n === U.RIGHT || n === U.LEFT) {
    const i = r.endColumn - r.startColumn + 1, o = e.endColumn - e.startColumn + 1, s = Math.floor(o / i), l = o % i, a = {
      startRow: 0,
      startColumn: 0,
      endRow: r.endRow - r.startRow,
      endColumn: r.endColumn - r.startColumn
    };
    if (n === U.RIGHT) {
      for (let c = 0; c < s; c++)
        t.push({
          repeatStartCell: {
            row: r.startRow,
            col: r.startColumn + (c + 1) * i
          },
          relativeRange: a
        });
      l > 0 && t.push({
        repeatStartCell: {
          row: r.startRow,
          col: r.startColumn + (s + 1) * i
        },
        relativeRange: {
          startRow: 0,
          startColumn: 0,
          endRow: r.endRow - r.startRow,
          endColumn: l - 1
        }
      });
    } else {
      for (let c = 0; c < s; c++)
        t.push({
          repeatStartCell: {
            row: r.startRow,
            col: r.startColumn - (c + 1) * i
          },
          relativeRange: a
        });
      l > 0 && t.push({
        repeatStartCell: {
          row: r.startRow,
          col: r.startColumn - (s + 1) * i
        },
        relativeRange: {
          startRow: 0,
          startColumn: i - l,
          endRow: r.endRow - r.startRow,
          endColumn: i - 1
        }
      });
    }
  }
  return t;
}
function Gu(r) {
  return !(od(r.f) || lv(r.si) || r.t === yt.BOOLEAN);
}
function _r(r) {
  r && "custom" in r && delete r.custom;
}
var Kr = /* @__PURE__ */ ((r) => (r.Append = "APPEND", r.Default = "DEFAULT", r.Only = "ONLY", r))(Kr || {}), mt = /* @__PURE__ */ ((r) => (r.NUMBER = "number", r.DATE = "date", r.EXTEND_NUMBER = "extendNumber", r.CHN_NUMBER = "chnNumber", r.CHN_WEEK2 = "chnWeek2", r.CHN_WEEK3 = "chnWeek3", r.LOOP_SERIES = "loopSeries", r.FORMULA = "formula", r.OTHER = "other", r))(mt || {}), Le = /* @__PURE__ */ ((r) => (r.COPY = "COPY", r.SERIES = "SERIES", r.ONLY_FORMAT = "ONLY_FORMAT", r.NO_FORMAT = "NO_FORMAT", r))(Le || {});
const JC = {
  type: mt.DATE,
  priority: 1100,
  match: (r, e) => {
    var t;
    if (r != null && r.f || r != null && r.si)
      return !1;
    if ((typeof (r == null ? void 0 : r.v) == "number" || (r == null ? void 0 : r.t) === yt.NUMBER) && r.s) {
      if (typeof r.s == "string") {
        const i = e.get(k).getFocusedUnit().getStyles().get(r.s), o = (t = i == null ? void 0 : i.n) == null ? void 0 : t.pattern;
        if (o)
          return Bt.getFormatInfo(o).isDate;
      } else if (r.s.n && Bt.getFormatInfo(r.s.n.pattern).isDate)
        return !0;
    }
    return !1;
  },
  isContinue: (r, e) => r.type === mt.DATE,
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      const { data: n } = r;
      return t === U.LEFT || t === U.UP ? (n.reverse(), $s(n, e, t).reverse()) : $s(n, e, t);
    }
  }
}, $C = {
  type: mt.NUMBER,
  priority: 1e3,
  match: (r) => typeof (r == null ? void 0 : r.v) == "number" || (r == null ? void 0 : r.t) === yt.NUMBER,
  isContinue: (r, e) => r.type === mt.NUMBER,
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      const { data: n } = r;
      return t === U.LEFT || t === U.UP ? (n.reverse(), $s(n, e, t).reverse()) : $s(n, e, t);
    }
  }
}, vm = {
  type: mt.OTHER,
  priority: 0,
  match: () => !0,
  isContinue: (r, e) => r.type === mt.OTHER
}, e1 = {
  type: mt.EXTEND_NUMBER,
  priority: 900,
  match: (r) => Ss(`${r == null ? void 0 : r.v}` || "").isExtendNumber,
  isContinue: (r, e) => {
    var t;
    if (r.type === mt.EXTEND_NUMBER) {
      const { beforeTxt: n, afterTxt: i } = Ss(`${(t = r.cellData) == null ? void 0 : t.v}` || ""), { beforeTxt: o, afterTxt: s } = Ss(`${e == null ? void 0 : e.v}` || "");
      if (n === o && i === s)
        return !0;
    }
    return !1;
  },
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      var l;
      const { data: n } = r, i = t === U.UP || t === U.LEFT;
      let o;
      if (n.length === 1)
        return o = i ? -1 : 1, Xt(ju(n, e, o), i);
      const s = [];
      for (let a = 0; a < n.length; a++) {
        const c = `${(l = n[a]) == null ? void 0 : l.v}`;
        c && s.push(Number(Ss(c).matchTxt));
      }
      return i && (n.reverse(), s.reverse()), es(s) ? (o = s[1] - s[0], Xt(ju(n, e, o), i)) : br(n, e);
    }
  }
}, t1 = {
  type: mt.CHN_NUMBER,
  priority: 830,
  match: (r) => !!UC(`${r == null ? void 0 : r.v}` || ""),
  isContinue: (r, e) => r.type === mt.CHN_NUMBER,
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      var a, c, d;
      const { data: n } = r, i = t === U.LEFT || t === U.UP;
      if (n.length === 1) {
        const u = `${(a = n[0]) == null ? void 0 : a.v}`;
        let h;
        return i ? h = -1 : h = 1, u && (u === "" || Mn(u) < 7) ? Xt(gi(n, e, h), i) : Xt(Yu(n, e, h), i);
      }
      let o = !1;
      for (let u = 0; u < n.length; u++)
        if (((c = n[u]) == null ? void 0 : c.v) === "") {
          o = !0;
          break;
        }
      const s = [];
      let l = 0;
      for (let u = 0; u < n.length; u++) {
        const h = `${(d = n[u]) == null ? void 0 : d.v}`;
        h === "" ? u === 0 ? s.push(0) : (l++, s.push(l * 7)) : o && Mn(h) > 0 && Mn(h) < 7 ? s.push(Mn(h) + l * 7) : s.push(Mn(h));
      }
      if (i && (n.reverse(), s.reverse()), es(s)) {
        if (o || s[s.length - 1] < 6 && s[0] > 0 || s[0] < 6 && s[s.length - 1] > 0) {
          const h = s[1] - s[0];
          return Xt(gi(n, e, h), i);
        }
        const u = s[1] - s[0];
        return Xt(Yu(n, e, u), i);
      }
      return br(n, e);
    }
  }
}, n1 = {
  type: mt.CHN_WEEK2,
  priority: 820,
  match: (r) => !!XC(`${r == null ? void 0 : r.v}` || ""),
  isContinue: (r, e) => r.type === mt.CHN_WEEK2,
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      var l;
      const { data: n } = r, i = t === U.LEFT || t === U.UP;
      if (n.length === 1) {
        let a;
        return i ? a = -1 : a = 1, Xt(gi(n, e, a, 1), i);
      }
      const o = [];
      let s = 0;
      for (let a = 0; a < n.length; a++) {
        const c = `${(l = n[a]) == null ? void 0 : l.v}`, d = c == null ? void 0 : c.substr(c.length - 1, 1);
        c === "" ? a === 0 ? o.push(0) : (s++, o.push(s * 7)) : o.push(Mn(d) + s * 7);
      }
      if (i && (n.reverse(), o.reverse()), es(o)) {
        const a = o[1] - o[0];
        return Xt(gi(n, e, a, 1), i);
      }
      return br(n, e);
    }
  }
}, r1 = {
  type: mt.CHN_WEEK3,
  priority: 810,
  match: (r) => zC(`${r == null ? void 0 : r.v}` || ""),
  isContinue: (r, e) => r.type === mt.CHN_WEEK3,
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      var l;
      const { data: n } = r, i = t === U.LEFT || t === U.UP;
      if (n.length === 1) {
        let a;
        return i ? a = -1 : a = 1, Xt(gi(n, e, a, 2), i);
      }
      const o = [];
      let s = 0;
      for (let a = 0; a < n.length; a++) {
        const c = `${(l = n[a]) == null ? void 0 : l.v}`;
        if (c) {
          const d = c.substr(c.length - 1, 1);
          c === "" ? a === 0 ? o.push(0) : (s++, o.push(s * 7)) : o.push(Mn(d) + s * 7);
        }
      }
      if (i && (n.reverse(), o.reverse()), es(o)) {
        const a = o[1] - o[0];
        return Xt(gi(n, e, a, 2), i);
      }
      return br(n, e);
    }
  }
}, i1 = {
  type: mt.LOOP_SERIES,
  priority: 800,
  match: (r) => KC(`${r == null ? void 0 : r.v}` || ""),
  isContinue: (r, e) => {
    var t;
    return r.type === mt.LOOP_SERIES ? ka(`${(t = r.cellData) == null ? void 0 : t.v}` || "").name === ka(`${e == null ? void 0 : e.v}` || "").name : !1;
  },
  applyFunctions: {
    [Le.SERIES]: (r, e, t) => {
      var a, c;
      const { data: n } = r, i = t === U.LEFT || t === U.UP, { series: o } = ka(`${(a = n[0]) == null ? void 0 : a.v}` || "");
      if (n.length === 1) {
        let d;
        return i ? d = -1 : d = 1, Xt(Zu(n, e, d, o), i);
      }
      const s = [];
      let l = 0;
      for (let d = 0; d < n.length; d++) {
        const u = `${(c = n[d]) == null ? void 0 : c.v}`;
        u && (u === o[0] ? d === 0 ? s.push(0) : (l++, s.push(l * o.length)) : s.push(o.indexOf(u) + l * 7));
      }
      if (i && (n.reverse(), s.reverse()), es(s)) {
        const d = s[1] - s[0];
        return Xt(Zu(n, e, d, o), i);
      }
      return br(n, e);
    }
  }
};
function Xt(r, e) {
  return e ? r.reverse() : r;
}
var o1 = Object.getOwnPropertyDescriptor, s1 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? o1(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Wr = (r, e) => (t, n) => e(t, n, r);
let el = class extends oe {
  constructor(e, t, n, i, o, s) {
    super();
    _(this, "_rules", []);
    _(this, "_hooks", []);
    _(this, "_applyType$", new Me(Le.SERIES));
    _(this, "_isFillingStyle", !0);
    _(this, "_prevUndos", []);
    _(this, "_autoFillLocation$", new Me(null));
    _(this, "autoFillLocation$", this._autoFillLocation$.asObservable());
    _(this, "_showMenu$", new Me(!1));
    _(this, "showMenu$", this._showMenu$.asObservable());
    _(this, "_direction", U.DOWN);
    _(this, "applyType$", this._applyType$.asObservable());
    _(this, "_menu$", new Me([
      {
        label: "autoFill.copy",
        value: Le.COPY,
        disable: !1
      },
      {
        label: "autoFill.series",
        value: Le.SERIES,
        disable: !1
      },
      {
        label: "autoFill.formatOnly",
        value: Le.ONLY_FORMAT,
        disable: !1
      },
      {
        label: "autoFill.noFormat",
        value: Le.NO_FORMAT,
        disable: !1
      }
    ]));
    _(this, "menu$", this._menu$.asObservable());
    this._commandService = e, this._undoRedoService = t, this._renderManagerService = n, this._univerInstanceService = i, this._selectionManagerService = o, this._injector = s, this._init();
  }
  _init() {
    this._rules = [
      JC,
      $C,
      e1,
      t1,
      n1,
      r1,
      i1,
      vm
    ].sort((e, t) => t.priority - e.priority), this._isFillingStyle = !0;
  }
  _getOneByPriority(e) {
    return e.length <= 0 ? [] : [e.reduce((n, i) => (i.priority || 0) > (n.priority || 0) ? i : n, e[0])];
  }
  // a cache to undo commands of last apply-type
  _initPrevUndo() {
    this._prevUndos = [];
  }
  // eslint-disable-next-line max-lines-per-function
  async triggerAutoFill(e, t, n, i) {
    var h;
    if (n.startColumn === i.startColumn && n.startRow === i.startRow && n.endColumn === i.endColumn && n.endRow === i.endRow)
      return !1;
    if (i.endColumn < n.endColumn && i.endColumn > n.startColumn)
      return this._commandService.executeCommand(_o.id, {
        clearRange: {
          startRow: i.startRow,
          endRow: i.endRow,
          startColumn: i.endColumn + 1,
          endColumn: n.endColumn
        },
        selectionRange: i
      });
    if (i.endRow < n.endRow && i.endRow > n.startRow)
      return this._commandService.executeCommand(_o.id, {
        clearRange: {
          startRow: i.endRow + 1,
          endRow: n.endRow,
          startColumn: i.startColumn,
          endColumn: i.endColumn
        },
        selectionRange: i
      });
    const o = {
      startRow: i.startRow,
      endRow: i.endRow,
      startColumn: i.startColumn,
      endColumn: i.endColumn
    };
    let s = null;
    if (i.startRow < n.startRow)
      s = U.UP, o.endRow = n.startRow - 1;
    else if (i.endRow > n.endRow)
      s = U.DOWN, o.startRow = n.endRow + 1;
    else if (i.startColumn < n.startColumn)
      s = U.LEFT, o.endColumn = n.startColumn - 1;
    else if (i.endColumn > n.endColumn)
      s = U.RIGHT, o.startColumn = n.endColumn + 1;
    else
      return !1;
    this.direction = s;
    const l = this._injector.invoke((g) => co(n, g)), a = this._injector.invoke((g) => co(o, g));
    if (!l || !a)
      return !1;
    this.autoFillLocation = {
      source: l,
      target: a,
      unitId: e,
      subUnitId: t
    };
    const c = [];
    this.getActiveHooks().forEach((g) => {
      var f;
      const m = (f = g == null ? void 0 : g.onBeforeFillData) == null ? void 0 : f.call(g, { source: l, target: a, unitId: e, subUnitId: t }, s);
      m && c.unshift(m);
    }), this._initPrevUndo();
    for (let g = 0; g < c.length; g++) {
      const m = this.menu.find((f) => f.value === c[g]);
      if (m && !m.disable)
        return this.fillData(c[g]);
    }
    const u = (h = this.menu.find((g) => g.disable === !1)) == null ? void 0 : h.value;
    return u ? this.fillData(u) : !1;
  }
  addHook(e) {
    if (this._hooks.find((t) => t.id === e.id))
      throw new Error(`Add hook failed, hook id '${e.id}' already exist!`);
    return e.priority === void 0 && (e.priority = 0), e.type === void 0 && (e.type = Kr.Append), this._hooks.push(e), We(() => {
      const t = this._hooks.findIndex((n) => n === e);
      t > -1 && this._hooks.splice(t, 1);
    });
  }
  registerRule(e) {
    if (this._rules.find((n) => n.type === e.type))
      throw new Error(`Registry rule failed, type '${e.type}' already exist!`);
    const t = this._rules.findIndex((n) => n.priority < e.priority);
    this._rules.splice(t === -1 ? this._rules.length : t, 0, e);
  }
  getRules() {
    return this._rules;
  }
  getAllHooks() {
    return this._hooks;
  }
  getActiveHooks() {
    const { source: e, target: t, unitId: n, subUnitId: i } = this.autoFillLocation || {};
    if (!e || !t || !n || !i)
      return [];
    const o = this._hooks.filter(
      (c) => {
        var d;
        return !((d = c.disable) != null && d.call(c, { source: e, target: t, unitId: n, subUnitId: i }, this._direction, this.applyType));
      }
    ), s = o.filter((c) => c.type === Kr.Only);
    if (s.length > 0)
      return this._getOneByPriority(s);
    const l = this._getOneByPriority(o.filter((c) => c.type === Kr.Default)), a = o.filter((c) => c.type === Kr.Append) || [];
    return [...l, ...a];
  }
  get applyType() {
    return this._applyType$.getValue();
  }
  set applyType(e) {
    this._applyType$.next(e);
  }
  get menu() {
    return this._menu$.getValue();
  }
  get direction() {
    return this._direction;
  }
  set direction(e) {
    this._direction = e;
  }
  isFillingStyle() {
    return this._isFillingStyle;
  }
  setFillingStyle(e) {
    this._isFillingStyle = e;
  }
  get autoFillLocation() {
    return this._autoFillLocation$.getValue();
  }
  set autoFillLocation(e) {
    this._autoFillLocation$.next(e);
  }
  setDisableApplyType(e, t) {
    this._menu$.next(
      this._menu$.getValue().map((n) => n.value === e ? {
        ...n,
        disable: t
      } : n)
    );
  }
  setShowMenu(e) {
    this._showMenu$.next(e);
  }
  // eslint-disable-next-line max-lines-per-function
  fillData(e) {
    var v, p, S;
    this.applyType = e;
    const { source: t, target: n, unitId: i = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId(), subUnitId: o = (v = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet()) == null ? void 0 : v.getSheetId() } = this.autoFillLocation || {};
    if (!t || !n || !i || !o)
      return !1;
    const s = this.direction;
    this._prevUndos.length > 0 && this._prevUndos.forEach((w) => {
      this._commandService.syncExecuteCommand(w.id, w.params);
    }), this._prevUndos = [];
    const l = se.union(Cr(t), Cr(n)), a = this.getActiveHooks(), c = this._univerInstanceService.getUnit(i, O.UNIVER_SHEET);
    this._commandService.syncExecuteCommand(Ie.id, {
      selections: [
        {
          primary: { ...(S = (p = this._selectionManagerService.getCurrentLastSelection()) == null ? void 0 : p.primary) != null ? S : l },
          range: {
            ...l,
            rangeType: z.NORMAL
          }
        }
      ],
      unitId: i,
      subUnitId: o
    });
    const d = [], u = [];
    a.forEach((w) => {
      var R;
      const { undos: C, redos: I } = ((R = w.onFillData) == null ? void 0 : R.call(w, { source: t, target: n, unitId: i, subUnitId: o }, s, e)) || {};
      C && d.push(...C), I && u.push(...I);
    });
    const h = u.every((w) => this._commandService.syncExecuteCommand(w.id, w.params)), g = [];
    e !== Le.NO_FORMAT && u.forEach((w) => {
      if (w.id === we.id) {
        const { cellValue: C } = w.params;
        new Ge(C).forValue((R, y, M) => {
          const E = Object.keys(c.getStyles().get(M == null ? void 0 : M.s) || {});
          (M != null && M.p || E.length && DC.some((T) => E.includes(T))) && g.push({ startRow: R, endRow: R, startColumn: y, endColumn: y });
        });
      }
    });
    const m = this._getAutoHeightUndoRedos(i, o, g);
    return m.redos.every((w) => this._commandService.syncExecuteCommand(w.id, w.params)) && (d.push(...m.undos), u.push(...m.redos)), h && (this._prevUndos = d, this._undoRedoService.pushUndoRedo({
      unitID: i,
      undoMutations: d,
      redoMutations: u
    })), a.forEach((w) => {
      var C;
      (C = w.onAfterFillData) == null || C.call(w, { source: t, target: n, unitId: i, subUnitId: o }, s, e);
    }), this.setShowMenu(!0), !0;
  }
  _getAutoHeightUndoRedos(e, t, n) {
    var d, u;
    const i = (d = this._renderManagerService.getRenderById(e)) == null ? void 0 : d.with(ue), o = (u = i == null ? void 0 : i.getCurrentParam()) == null ? void 0 : u.skeleton;
    if (!o) return { redos: [], undos: [] };
    const s = o.calculateAutoHeightInRange(n), l = { subUnitId: t, unitId: e, rowsAutoHeightInfo: s }, a = o.worksheet, c = cg(l, a);
    return {
      undos: [{ id: er.id, params: c }],
      redos: [{ id: er.id, params: l }]
    };
  }
};
el = s1([
  Wr(0, W),
  Wr(1, Zt),
  Wr(2, fe),
  Wr(3, N(k)),
  Wr(4, N(Q)),
  Wr(5, N(Rt))
], el);
const Hr = Yt("univer.auto-fill-service"), gr = {
  type: J.COMMAND,
  id: "sheet.command.auto-fill",
  handler: async (r, e) => {
    const t = r.get(Hr), n = r.get(k), { sourceRange: i, targetRange: o } = e, s = Xe(n);
    if (!s) return !1;
    const { subUnitId: l, unitId: a } = s;
    return t.triggerAutoFill(a, l, i, o);
  }
}, _o = {
  id: "sheet.command.auto-clear-content",
  type: J.COMMAND,
  handler: async (r, e) => {
    const t = r.get(k), n = r.get(W), i = r.get(Zt), o = r.get(vn), s = Xe(t);
    if (!s) return !1;
    const { unitId: l, subUnitId: a } = s, { clearRange: c, selectionRange: d } = e, u = {
      subUnitId: a,
      unitId: l,
      cellValue: xv([c])
    }, h = $t(
      r,
      u
    ), { startColumn: g, startRow: m } = d, f = {
      selections: [
        {
          primary: {
            startColumn: g,
            startRow: m,
            endColumn: g,
            endRow: m,
            actualRow: m,
            actualColumn: g,
            isMerged: !1,
            isMergedMainCell: !1
          },
          range: {
            ...d
          }
        }
      ],
      unitId: l,
      subUnitId: a
    };
    if (n.executeCommand(Ie.id, f), n.syncExecuteCommand(we.id, u)) {
      const p = o.afterCommandExecute({
        id: we.id,
        params: u
      });
      return Wo(p.redos, n), i.pushUndoRedo({
        // If there are multiple mutations that form an encapsulated project, they must be encapsulated in the same undo redo element.
        // Hooks can be used to hook the code of external controllers to add new actions.
        unitID: l,
        undoMutations: [{ id: we.id, params: h }, ...p.undos],
        redoMutations: [{ id: we.id, params: u }, ...p.redos]
      }), !0;
    }
    return !1;
  }
};
function Fd(r) {
  return r.getContextValue(Nt);
}
function Ve(r) {
  return r.getContextValue(Nt) && r.getContextValue(Pr) && !r.getContextValue(Je) && !r.getContextValue(Dl);
}
function Sm(r) {
  return r.getContextValue(Nt) && r.getContextValue(Pr) && !r.getContextValue(Je) && !r.getContextValue(Ot) && !r.getContextValue(Dl);
}
function l1(r) {
  return r.getContextValue(Nt) && r.getContextValue(Pr) && r.getContextValue(Je);
}
function Ud(r) {
  return r.getContextValue(Pr) && r.getContextValue(Je);
}
function la(r) {
  return r.getContextValue(Ot) && r.getContextValue(Pr);
}
function jy(r) {
  return r.getContextValue(Nt) && r.getContextValue(Je) && r.getContextValue(Ls) && r.getContextValue(Pr);
}
function mi(r) {
  return r.getContextValue(Nt) && r.getContextValue(Pr) && r.getContextValue(Je) && !r.getContextValue(Ls) && !r.getContextValue(Ll);
}
var a1 = Object.getOwnPropertyDescriptor, c1 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? a1(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Da = (r, e) => (t, n) => e(t, n, r);
const qu = gm.MARK_SELECTION, Wi = Yt("univer.mark-selection-service");
let tl = class extends oe {
  constructor(e, t, n) {
    super();
    _(this, "_shapeMap", /* @__PURE__ */ new Map());
    this._currentService = e, this._renderManagerService = t, this._themeService = n;
  }
  addShape(e, t = [], n = qu) {
    var a;
    const i = this._currentService.getCurrentUnitForType(O.UNIVER_SHEET), o = (a = i.getActiveSheet()) == null ? void 0 : a.getSheetId();
    if (!o) return null;
    const s = xn(), l = {
      selection: e,
      subUnitId: o,
      unitId: i.getUnitId(),
      zIndex: n,
      control: null,
      exits: t
    };
    return this._shapeMap.set(s, l), this.refreshShapes(), s;
  }
  addShapeWithNoFresh(e, t = [], n = qu) {
    var l;
    const i = this._currentService.getCurrentUnitForType(O.UNIVER_SHEET), o = (l = i.getActiveSheet()) == null ? void 0 : l.getSheetId();
    if (!o) return null;
    const s = xn();
    return this._shapeMap.set(s, {
      selection: e,
      subUnitId: o,
      unitId: i.getUnitId(),
      zIndex: n,
      control: null,
      exits: t
    }), s;
  }
  refreshShapes() {
    var i;
    const e = this._currentService.getCurrentUnitForType(O.UNIVER_SHEET);
    if (!e) return;
    const t = e.getUnitId(), n = (i = e.getActiveSheet()) == null ? void 0 : i.getSheetId();
    this._shapeMap.forEach((o) => {
      const { unitId: s, subUnitId: l, selection: a, control: c, zIndex: d } = o;
      if (c == null || c.dispose(), s !== t || l !== n)
        return;
      const u = this._renderManagerService.getRenderById(s);
      if (!u) return;
      const h = u.with(ue).getCurrentSkeleton();
      if (!h) return;
      const { scene: g } = u, { rowHeaderWidth: m, columnHeaderHeight: f } = h, v = new Wd(g, d, this._themeService, {
        enableAutoFill: !1,
        highlightHeader: !1,
        rowHeaderWidth: m,
        columnHeaderHeight: f
      }), p = Wt(a, h);
      v.updateRangeBySelectionWithCoord(p), o.control = v;
    });
  }
  getShapeMap() {
    return this._shapeMap;
  }
  removeShape(e) {
    const t = this._shapeMap.get(e);
    if (!t) return;
    const { control: n } = t;
    n == null || n.dispose(), this._shapeMap.delete(e);
  }
  removeAllShapes() {
    for (const e of this._shapeMap.values()) {
      const { control: t } = e;
      t == null || t.dispose();
    }
    this._shapeMap.clear();
  }
};
tl = c1([
  Da(0, k),
  Da(1, fe),
  Da(2, N(Ht))
], tl);
function Cm(r) {
  return {
    strokeWidth: 1.5,
    stroke: r.getColorFromTheme("primary.600"),
    fill: "rgba(178, 178, 178, 0.10)",
    widgets: {},
    strokeDash: 8
  };
}
const d1 = 10, u1 = 6;
function h1() {
  return xn(u1);
}
function g1(r) {
  const e = r.match(/data-copy-id="([^\s]+)"/);
  return e && e[1] ? e[1] : null;
}
class m1 {
  constructor() {
    _(this, "_cache", new av(d1));
  }
  set(e, t) {
    this._cache.set(e, t);
  }
  get(e) {
    return this._cache.get(e);
  }
  del(e) {
    this._cache.delete(e);
  }
  clear() {
    this._cache.clear();
  }
  clearWithUnitId(e) {
    this._cache.forEach((t, n) => {
      t.unitId === e && this._cache.delete(n);
    });
  }
}
function nl(r, e) {
  const t = e != null ? e : r.style, n = {}, i = r.tagName.toLowerCase();
  switch (i) {
    case "b":
    case "em":
    case "strong": {
      n.bl = Ke.TRUE;
      break;
    }
    case "s": {
      n.st = {
        s: Ke.TRUE
      };
      break;
    }
    case "u": {
      n.ul = {
        s: Ke.TRUE
      };
      break;
    }
    case "i": {
      n.it = Ke.TRUE;
      break;
    }
    case "sub":
    case "sup": {
      n.va = i === "sup" ? Su.SUPERSCRIPT : Su.SUBSCRIPT;
      break;
    }
  }
  return f1(t, n), n;
}
function f1(r, e) {
  if (r instanceof CSSStyleDeclaration)
    for (let t = 0; t < r.length; t++) {
      const n = r[t], i = r.getPropertyValue(n);
      Qu(n, i, e);
    }
  else
    for (const t in r) {
      const n = r[t];
      Qu(t, n, e);
    }
}
function Qu(r, e, t) {
  switch (r) {
    case "font-family":
      t.ff = e;
      break;
    case "font-size": {
      const n = Number.parseInt(e);
      Number.isNaN(n) || (e.endsWith("pt") ? t.fs = n : e.endsWith("px") && (t.fs = n * 0.75));
      break;
    }
    case "font-style":
      e === "italic" && (t.it = Ke.TRUE);
      break;
    case "font-weight": {
      (Number(e) > 400 || e === "bold") && (t.bl = Ke.TRUE);
      break;
    }
    case "text-decoration": {
      /underline/.test(e) ? t.ul = { s: Ke.TRUE } : /overline/.test(e) ? t.ol = { s: Ke.TRUE } : /line-through/.test(e) && (t.st = { s: Ke.TRUE });
      break;
    }
    case "color": {
      try {
        const n = new fn(e);
        n.isValid && (t.cl = {
          rgb: n.toRgbString()
        });
      } catch {
      }
      break;
    }
    case "background-color": {
      const n = new fn(e);
      n.isValid && (t.bg = {
        rgb: n.toRgbString()
      });
      break;
    }
  }
}
function p1(r) {
  const e = document.createElement("body");
  return e.innerHTML = r, e;
}
function wm(r) {
  const e = r.style, t = {};
  for (let n = 0; n < e.length; n++) {
    const i = e[n], o = e.getPropertyValue(i);
    switch (i) {
      case "margin-top": {
        const s = Number.parseInt(o);
        t.spaceAbove = { v: /pt/.test(o) ? Eu(s) : s };
        break;
      }
      case "margin-bottom": {
        const s = Number.parseInt(o);
        t.spaceBelow = { v: /pt/.test(o) ? Eu(s) : s };
        break;
      }
      case "line-height": {
        const s = Number.parseFloat(o);
        t.lineSpacing = s;
        break;
      }
    }
  }
  return Object.getOwnPropertyNames(t).length ? t : null;
}
function La(r, e) {
  const t = [];
  for (let n = 0, i = r.length; n < i; n++)
    r[n] === cv.PARAGRAPH && t.push({
      startIndex: n
    });
  return t;
}
function Ku(r, e, t) {
  var s, l, a;
  const n = e.length, o = ((s = t == null ? void 0 : t.length) != null ? s : 0) === 1 && t[0].st === 0 && t[0].ed === n;
  return r.p ? o && ((a = (l = r.p.body) == null ? void 0 : l.textRuns) != null && a.length) ? (r.p.body.textRuns = [], {
    ...r,
    s: t[0].ts
  }) : r : o ? {
    ...r,
    s: t[0].ts
  } : r;
}
const Ju = [
  // Rich Text Style Rules,
  "color",
  "background",
  "font-size",
  "text-align",
  "vertical-align",
  "font-weight",
  "font-style",
  "font-family",
  "text-decoration",
  "white-space",
  "word-wrap",
  // Border Style Rules,
  "border-left",
  "border-right",
  "border-top",
  "border-bottom",
  // Custom Style Rules, '--' needs to be used as a prefix.
  "--data-rotate"
];
function $u(r, e) {
  const t = r.tagName.toLowerCase();
  return typeof e == "string" ? t === e : Array.isArray(e) ? e.some((n) => n === t) : e(r);
}
const kl = class kl {
  constructor(e) {
    _(this, "_styleMap", /* @__PURE__ */ new Map());
    _(this, "_styleCache", /* @__PURE__ */ new Map());
    _(this, "_styleRules", []);
    _(this, "_afterProcessRules", []);
    _(this, "_dom", null);
    _(this, "_getCurrentSkeleton");
    this._getCurrentSkeleton = e.getCurrentSkeleton;
  }
  static use(e) {
    if (this._pluginList.includes(e))
      throw new Error(`Univer paste plugin ${e.name} already added`);
    this._pluginList.push(e);
  }
  // eslint-disable-next-line max-lines-per-function
  convert(e) {
    const t = kl._pluginList.find((f) => f.checkPasteType(e));
    t && (this._styleRules = [...t.stylesRules], this._afterProcessRules = [...t.afterProcessRules]);
    const n = new Ge();
    this._dom = p1(e);
    const i = this._dom.querySelector("style");
    if (i) {
      const f = document.createElement("div"), v = f.attachShadow({ mode: "open" });
      document.body.appendChild(f), v.appendChild(i);
      for (const p of i.sheet.cssRules) {
        const S = p, w = S.selectorText, C = S.style;
        this._styleMap.set(w, C);
      }
      i.remove(), f.remove();
    }
    const o = {
      dataStream: "",
      textRuns: []
    }, s = [], l = [], a = e.match(/<table\b[^>]*>([\s\S]*?)<\/table>/gi), c = [];
    this.process(null, this._dom.childNodes, o, c);
    const { paragraphs: d, dataStream: u, textRuns: h, payloads: g, customRanges: m } = o;
    if (d) {
      const f = d.map((v) => v.startIndex + 1);
      f.unshift(0);
      for (let v = 0; v < f.length; v++) {
        let p;
        if (v === f.length - 1) {
          if (p = `${u.substring(f[v])}\r
`, p === `\r
`)
            continue;
        } else
          p = `${u.substring(f[v], f[v + 1] - 1)}\r
`;
        const S = [];
        h == null || h.forEach((R) => {
          R.st >= f[v] && R.ed <= f[v + 1] && S.push({
            st: R.st - f[v],
            ed: R.ed - f[v],
            ts: R.ts
          });
        });
        const w = [];
        m == null || m.forEach((R) => {
          R.startIndex >= f[v] && R.endIndex <= f[v + 1] && w.push({
            ...R,
            startIndex: R.startIndex - f[v],
            endIndex: R.endIndex - f[v]
          });
        });
        const C = this._generateDocumentDataModelSnapshot({
          body: {
            dataStream: p,
            textRuns: S,
            paragraphs: La(p),
            customRanges: w
          }
        }), I = Object.keys(n.getMatrix()).length === 0;
        n.setValue(I ? 0 : n.getLength(), 0, {
          v: p,
          p: C
        }), s.push({});
      }
    } else if (u) {
      const f = `${u}\r
`, v = {
        dataStream: f,
        textRuns: h,
        paragraphs: La(f),
        payloads: g,
        customRanges: m
      };
      if (!(m != null && m.length))
        n.setValue(0, 0, Ku({ v: u }, u, h));
      else {
        const p = this._generateDocumentDataModelSnapshot({
          body: v
        });
        n.setValue(0, 0, Ku({ v: u, p }, u, h));
      }
      s.push({});
    }
    return a && a.forEach((f, v) => {
      const p = n.getDataRange().endRow + 1, { cellMatrix: S, rowProperties: w, colProperties: C } = this._parseTable(f, v);
      S && S.forValue((I, R, y) => {
        n.setValue(p + I, R, y);
      }), C && l.push(...C), s.push(...w);
    }), this.dispose(), {
      rowProperties: s,
      colProperties: l,
      cellMatrix: n
    };
  }
  _getStyleBySelectorText(e, t) {
    var i;
    const n = (i = this._styleMap.get(e)) == null ? void 0 : i.getPropertyValue(t);
    return n || "";
  }
  _getStyle(e, t) {
    const n = eh(t), i = e.style;
    let o = "";
    for (let s = 0; s < Ju.length; s++) {
      const l = Ju[s];
      if (l === "background") {
        let c = "";
        e.classList.forEach((u) => {
          c = this._getStyleBySelectorText(`.${u}`, "background-color") || this._getStyleBySelectorText(`.${u}`, l);
        });
        const d = i.getPropertyValue("background-color") || c || this._getStyleBySelectorText(`#${e.id}`, "background-color") || this._getStyleBySelectorText(`#${e.id}`, l) || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l) || this._getStyleBySelectorText(e.nodeName, "background-color") || n["background-color"] || "";
        d && (o += `background:${d};`);
        continue;
      }
      if (l === "text-decoration") {
        let c = "";
        e.classList.forEach((u) => {
          c = this._getStyleBySelectorText(`.${u}`, "text-decoration-line") || this._getStyleBySelectorText(`.${u}`, l);
        });
        const d = i.getPropertyValue("text-decoration-line") || i.getPropertyValue("text-decoration") || c || this._getStyleBySelectorText(`#${e.id}`, "text-decoration-line") || this._getStyleBySelectorText(`#${e.id}`, l) || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l) || this._getStyleBySelectorText(e.nodeName, "text-decoration-line") || n["text-decoration-line"] || "";
        d && (o += `text-decoration:${d};`);
        continue;
      }
      let a = "";
      e.classList.forEach((c) => {
        a = this._getStyleBySelectorText(`.${c}`, l);
      }), a = i.getPropertyValue(l) || this._getStyleBySelectorText(`#${e.id}`, l) || a || this._getStyleBySelectorText(e.nodeName.toLowerCase(), l) || n[l] || "", a && (o += `${l}:${a};`);
    }
    return o;
  }
  _parseTable(e, t) {
    var l, a;
    const n = new Ge(), i = (l = S1(e)) != null ? l : [], { rowProperties: o = [] } = v1(e), s = this._parseTableByHtml(this._dom, t, (a = this._getCurrentSkeleton()) == null ? void 0 : a.skeleton);
    return s && s.forValue((c, d, u) => {
      var m, f, v, p, S, w, C, I, R, y, M, E, T, P, H, A, x, V, D, X, B, j, G, ge;
      let h = US(void 0, u.style);
      if ((p = (v = (f = (m = u == null ? void 0 : u.richTextParma) == null ? void 0 : m.p) == null ? void 0 : f.body) == null ? void 0 : v.textRuns) != null && p.length) {
        const Re = (w = (S = u == null ? void 0 : u.richTextParma) == null ? void 0 : S.v) == null ? void 0 : w.length;
        for (let be = 0; be < ((y = (R = (I = (C = u == null ? void 0 : u.richTextParma) == null ? void 0 : C.p) == null ? void 0 : I.body) == null ? void 0 : R.textRuns) == null ? void 0 : y.length); be++) {
          const Ne = (T = (E = (M = u == null ? void 0 : u.richTextParma) == null ? void 0 : M.p) == null ? void 0 : E.body) == null ? void 0 : T.textRuns[be];
          Ne.st === 0 && Ne.ed === Re && (h = { ...Ne.ts, ...h }, (A = (H = (P = u == null ? void 0 : u.richTextParma) == null ? void 0 : P.p) == null ? void 0 : H.body) == null || A.textRuns.splice(be, 1), be--);
        }
        ((X = (D = (V = (x = u == null ? void 0 : u.richTextParma) == null ? void 0 : x.p) == null ? void 0 : V.body) == null ? void 0 : D.textRuns) == null ? void 0 : X.length) === 0 && (u.content = (B = u == null ? void 0 : u.richTextParma) == null ? void 0 : B.v, delete u.richTextParma);
      }
      const g = (ge = (G = (j = u == null ? void 0 : u.richTextParma) == null ? void 0 : j.p) == null ? void 0 : G.body) != null && ge.textRuns ? {
        v: u.richTextParma.v,
        p: u.richTextParma.p,
        s: h,
        rowSpan: u.rowSpan,
        colSpan: u.colSpan
      } : {
        v: u.content,
        s: h,
        rowSpan: u.rowSpan,
        colSpan: u.colSpan
      };
      n.setValue(c, d, g);
    }), {
      rowProperties: o,
      colProperties: i,
      cellMatrix: n
    };
  }
  _parseTableByHtml(e, t, n) {
    var a, c;
    const i = new Ge(), o = e.querySelectorAll("table")[t];
    if (!o)
      return i;
    const s = this._getStyle(o, ""), l = o == null ? void 0 : o.querySelectorAll("tr");
    for (let d = 0; d < l.length; d++) {
      const u = l[d], h = this._getStyle(u, s), g = u.querySelectorAll("td, th");
      let m = 0;
      for (let f = 0; f < g.length; ) {
        const v = g[f];
        let p = "";
        const S = Number(v.getAttribute("rowSpan")) || 1, w = Number(v.getAttribute("colSpan")) || 1;
        if (p = this._getStyle(v, h), d > 0) {
          const y = i.getValue(d - 1, m);
          if ((a = y == null ? void 0 : y.style) != null && a.includes("border-bottom") && p.includes("border-top")) {
            const M = th(y.style, "border-bottom");
            M && Au(M.substr(M.indexOf(":") + 1)) !== "none" && (p = p.replace(/border-top:[^;]+;/, ""));
          }
        }
        if (f > 0) {
          const y = i.getValue(d, m - 1);
          if ((c = y == null ? void 0 : y.style) != null && c.includes("border-right") && p.includes("border-left")) {
            const M = th(y.style, "border-right");
            M && Au(M.substr(M.indexOf(":") + 1)) !== "none" && (p = p.replace(/border-left:[^;]+;/, ""));
          }
        }
        const { cellText: C, cellRichStyle: I } = this._getCellTextAndRichText(v, p, n), R = {
          rowSpan: S,
          colSpan: w,
          content: C,
          style: p,
          richTextParma: {
            p: I,
            v: C
          }
        };
        if (i.getValue(d, m)) {
          m += 1;
          continue;
        } else
          S > 1 || w > 1 ? w1(i, p, R, { colSpan: w, rowSpan: S, rowIndex: d, colSetValueIndex: m }) : i.setValue(d, m, R), m += w, f++;
      }
    }
    return i;
  }
  _parseCellHtml(e, t, n, i = /* @__PURE__ */ new Map(), o) {
    var s;
    for (const l of t)
      if (l.nodeType === Node.TEXT_NODE) {
        const a = (s = l.nodeValue) == null ? void 0 : s.replace(/[\r\n]/g, "");
        let c;
        e && i.has(e) && (c = i.get(e)), n.dataStream += a, c && Object.getOwnPropertyNames(c).length && n.textRuns.push({
          st: n.dataStream.length - a.length,
          ed: n.dataStream.length,
          ts: c
        });
      } else {
        if (l.nodeType === Node.COMMENT_NODE || l.nodeName === "STYLE")
          continue;
        if (l.nodeName.toLowerCase() === "br")
          n.paragraphs || (n.paragraphs = []), n.paragraphs.push({ startIndex: n.dataStream.length }), n.dataStream += "\r";
        else if (l.nodeType === Node.ELEMENT_NODE) {
          const a = this._getStyle(l, o), c = e ? i.get(e) : {}, d = eh(a), u = nl(l, d);
          i.set(l, { ...c, ...u });
          const { childNodes: h } = l;
          this._parseCellHtml(l, h, n, i, a);
        }
      }
  }
  _getCellTextAndRichText(e, t, n) {
    var l;
    if (e.innerHTML.includes("mso-spacerun:yes")) {
      const a = e.innerHTML.replace(/<span[^>]*mso-spacerun:yes[^>]*>[\s\S]*?<\/span>/gi, ""), c = Bt.parseNumber(a);
      if (c && c.v !== void 0 && c.v !== null)
        return {
          cellText: a,
          cellRichStyle: void 0
        };
    }
    let i = "", o;
    if (/<[^>]+>/.test(e.innerHTML) && n) {
      const a = {
        dataStream: "",
        textRuns: []
      };
      this._parseCellHtml(null, e.childNodes, a, void 0, t);
      const c = (l = n.getBlankCellDocumentModel()) == null ? void 0 : l.documentModel, d = c == null ? void 0 : c.getSnapshot(), u = `${a.dataStream}\r
`, h = {
        ...d,
        body: {
          dataStream: u,
          textRuns: a.textRuns,
          paragraphs: La(u)
        }
      };
      c == null || c.reset(h), o = c == null ? void 0 : c.getSnapshot(), i = a.dataStream;
    } else
      i = C1(e.innerHTML.replace(/[\r\n]/g, ""));
    return {
      cellText: i,
      cellRichStyle: o
    };
  }
  _generateDocumentDataModelSnapshot(e) {
    var l;
    const t = this._getCurrentSkeleton();
    if (t == null)
      return null;
    const { skeleton: n } = t, i = (l = n.getBlankCellDocumentModel()) == null ? void 0 : l.documentModel, s = { ...i == null ? void 0 : i.getSnapshot(), ...e };
    return i == null || i.reset(s), i == null ? void 0 : i.getSnapshot();
  }
  process(e, t, n, i) {
    var o, s, l;
    for (const a of t)
      if (a.nodeName.toLowerCase() === "table")
        i.push({
          index: ((o = n == null ? void 0 : n.paragraphs) == null ? void 0 : o.length) || 0
        });
      else if (a.nodeType === Node.TEXT_NODE) {
        if (((s = a.nodeValue) == null ? void 0 : s.trim()) === "")
          continue;
        const c = (l = a.nodeValue) == null ? void 0 : l.replace(/[\r\n]/g, "");
        let d;
        e && this._styleCache.has(e) && (d = this._styleCache.get(e));
        const u = {
          dataStream: "",
          textRuns: []
        };
        n.dataStream += c, u.dataStream += c, d && Object.getOwnPropertyNames(d).length && (n.textRuns.push({
          st: n.dataStream.length - c.length,
          ed: n.dataStream.length,
          ts: d
        }), u.textRuns.push({
          st: n.dataStream.length - c.length,
          ed: n.dataStream.length,
          ts: d
        }));
      } else {
        if (dv.includes(a.nodeName.toLowerCase()))
          continue;
        if (a.nodeName.toLowerCase() === "br")
          n.paragraphs || (n.paragraphs = []), n.paragraphs.push({ startIndex: n.dataStream.length }), n.dataStream += "\r";
        else if (a.nodeType === Node.ELEMENT_NODE) {
          if (a.nodeName === "STYLE")
            continue;
          const c = a, d = this._processBeforeLink(c, { body: n }), u = e ? this._styleCache.get(e) : {}, h = this._styleRules.find(({ filter: v }) => $u(a, v)), g = h ? h.getStyle(a) : nl(a);
          this._styleCache.set(a, { ...u, ...g });
          const { childNodes: m } = a;
          this.process(a, m, n, i);
          const f = this._afterProcessRules.find(
            ({ filter: v }) => $u(a, v)
          );
          f && f.handler(n, a), this._processAfterLink(c, { body: n }, d);
        }
      }
  }
  _processBeforeLink(e, t) {
    return t.body.dataStream.length;
  }
  _processAfterLink(e, t, n) {
    var s, l;
    const i = t.body, o = e;
    o.tagName.toUpperCase() === "A" && (i.customRanges = (s = i.customRanges) != null ? s : [], i.customRanges.push({
      startIndex: n,
      endIndex: i.dataStream.length - 1,
      rangeId: (l = o.dataset.rangeid) != null ? l : xn(),
      rangeType: sd.HYPERLINK,
      properties: { url: o.href }
    }));
  }
  dispose() {
    this._dom = null, this._styleCache.clear(), this._styleMap.clear();
  }
};
_(kl, "_pluginList", []);
let fi = kl;
function v1(r) {
  const e = /<tr([\s\S]*?)>([\s\S]*?)<\/tr>/gi, t = r.matchAll(e);
  if (!t)
    return {
      rowProperties: [],
      rowCount: 0
    };
  const i = Array.from(t).map((o) => bm(o[1])).map((o) => {
    if (!o.height) {
      const s = o.style, l = s && s.match(/height\s*:\s*(\d+(\.\d+)?)px/);
      o.height = `${l ? Number.parseInt(l[1], 10) : _c}`;
    }
    return o;
  });
  return {
    rowProperties: i,
    rowCount: i.length
  };
}
function eh(r) {
  const e = {};
  return r.split(";").forEach((n) => {
    const [i, o] = n.split(":");
    e[i] = o;
  }), e;
}
function bm(r) {
  if (!r)
    return {};
  const e = {}, t = /([\w-]+)\s*=\s*(?:(['"])([^'"]*)\2|(\S+))/g;
  let n;
  for (; (n = t.exec(r)) !== null; ) {
    const [, i, , o, s] = n, l = o !== void 0 ? o : s;
    e[i] = l;
  }
  return e;
}
function S1(r) {
  const e = /<colgroup([\s\S]*?)>(.*?)<\/colgroup>/, t = r.match(e), n = /<col([\s\S]*?)>/g;
  let i;
  if (t != null && t[2] ? i = t[2].matchAll(n) : i = r.matchAll(n), !i)
    return null;
  const o = Array.from(i).map((l) => bm(l[1])), s = [];
  return o.forEach((l) => {
    const a = Number(l.span);
    if (a)
      for (let c = 0; c < a; c++) {
        const d = { ...l };
        delete d.span, s.push(d);
      }
    else
      s.push(l);
  }), s;
}
function C1(r) {
  const e = {
    "&lt;": "<",
    "&gt;": ">",
    "&amp;": "&",
    "&quot;": '"',
    "&#39;": "'",
    "&nbsp;": " "
  };
  return r.replace(/&lt;|&gt;|&amp;|&quot;|&#39;|&nbsp;|<br>/g, (t) => e[t]);
}
function th(r, e) {
  if (!r || !e) return null;
  const t = new RegExp(`(${e}\\s*:\\s*[^;]+);`, "i"), n = r.match(t);
  return n ? n[1] : null;
}
function w1(r, e, t, n) {
  const { rowSpan: i, colSpan: o, rowIndex: s, colSetValueIndex: l } = n;
  for (let a = s; a < s + i; a++)
    for (let c = l; c < l + o; c++)
      a === s && c === l ? r.setValue(a, c, { ...t, style: e }) : r.setValue(a, c, { style: e });
}
const b1 = {
  name: "univer-doc-paste-plugin-lark",
  checkPasteType(r) {
    return /lark-record-clipboard/i.test(r);
  },
  // TODO: @JOCS, support inline code copy from lark.
  stylesRules: [
    {
      filter: ["s"],
      getStyle(r) {
        const e = nl(r);
        return {
          st: {
            s: Ke.TRUE
          },
          ...e
        };
      }
    }
  ],
  afterProcessRules: [
    {
      filter(r) {
        return r.tagName === "DIV" && /ace-line/i.test(r.className);
      },
      handler(r) {
        r.paragraphs == null && (r.paragraphs = []), r.paragraphs.push({
          startIndex: r.dataStream.length
        }), r.dataStream += "\r";
      }
    }
  ]
}, _1 = {
  name: "univer-doc-paste-plugin-univer",
  checkPasteType(r) {
    return /UniverNormal/i.test(r);
  },
  stylesRules: [],
  afterProcessRules: [
    {
      filter(r) {
        return r.tagName === "P" && /UniverNormal/i.test(r.className);
      },
      handler(r, e) {
        r.paragraphs == null && (r.paragraphs = []);
        const t = {
          startIndex: r.dataStream.length
        }, n = wm(e);
        n && (t.paragraphStyle = n), r.paragraphs.push(t), r.dataStream += "\r";
      }
    }
  ]
}, R1 = {
  name: "univer-doc-paste-plugin-word",
  checkPasteType(r) {
    return /word|mso/i.test(r);
  },
  stylesRules: [
    {
      filter: ["b"],
      getStyle(r) {
        const e = nl(r);
        return { bl: Ke.TRUE, ...e };
      }
    }
  ],
  afterProcessRules: [
    {
      filter(r) {
        return r.tagName === "P" && /mso/i.test(r.className);
      },
      handler(r, e) {
        r.paragraphs == null && (r.paragraphs = []);
        const t = {
          startIndex: r.dataStream.length
        }, n = wm(e);
        n && (t.paragraphStyle = n), r.paragraphs.push(t), r.dataStream += "\r";
      }
    }
  ]
};
var Yn = /* @__PURE__ */ ((r) => (r.COPY = "COPY", r.CUT = "CUT", r))(Yn || {});
function I1(r, e, t, n, i) {
  const o = t.map((c) => {
    var d;
    return (d = c.onCopyRow) == null ? void 0 : d.call(c, r);
  }).filter((c) => !!c), s = Xd(o), l = zd(s), a = e.map((c) => {
    if (!i.has(`${r}-${c}`)) {
      const d = n.getValue(r, c);
      if (d != null && d.rowSpan && (d != null && d.colSpan))
        for (let u = r; u < r + d.rowSpan; u++)
          for (let h = c; h < c + d.colSpan; h++)
            i.add(`${u}-${h}`);
      return y1(r, c, t, n);
    }
    return null;
  }).filter((c) => !!c).join("");
  return `<tr${l}>${a}</tr>`;
}
function y1(r, e, t, n) {
  const i = n.getValue(r, e), o = t.map((c) => {
    var d;
    return (d = c.onCopyCellStyle) == null ? void 0 : d.call(c, r, e, i == null ? void 0 : i.rowSpan, i == null ? void 0 : i.colSpan);
  }).filter((c) => !!c), s = Xd(o), l = zd(s), a = t.reduce((c, d) => {
    var u;
    return c || ((u = d.onCopyCellContent) == null ? void 0 : u.call(d, r, e)) || "";
  }, "");
  return `<td${l}>${a}</td>`;
}
function M1(r, e) {
  return `<colgroup>${r.map((n) => {
    const i = e.map((l) => {
      var a;
      return (a = l.onCopyColumn) == null ? void 0 : a.call(l, n);
    }).filter((l) => !!l), o = Xd(i);
    return `<col ${zd(o)} />`;
  }).join("")}</colgroup>`;
}
function Xd(r) {
  return r.reduce((e, t) => (Object.keys(t).forEach((i) => {
    e[i] ? e[i] += `;${t[i]}` : e[i] = t[i];
  }), e), {});
}
function zd(r) {
  return Object.keys(r).reduce((e, t) => `${e} ${t}="${r[t]}"`, "");
}
class E1 {
  convert(e, t, n) {
    const { cols: i, rows: o } = t;
    if (!i.length)
      return "";
    const s = M1(i, n), l = [], a = /* @__PURE__ */ new Set();
    return o.forEach((d) => {
      l.push(I1(d, i, n, e, a));
    }), `<google-sheets-html-origin><table xmlns="http://www.w3.org/1999/xhtml" cellspacing="0" cellpadding="0" dir="ltr" style="table-layout:fixed;font-size:10pt;font-family:Arial;width:0px;border-collapse:collapse;border:none">${s}
<tbody>${l.join("")}</tbody></table>`;
  }
}
const Yy = (r, e, t = !1) => {
  const n = (u) => u.endRow - u.startRow + 1, i = (u) => u.endColumn - u.startColumn + 1, o = n(e) % n(r), s = i(e) % i(r), l = {
    startRow: 0,
    endRow: n(r) - 1,
    startColumn: 0,
    endColumn: i(r) - 1
  }, a = Math.floor(n(e) / n(r)), c = Math.floor(i(e) / i(r)), d = [];
  if (!o && !s)
    for (let u = 1; u <= a; u++)
      for (let h = 1; h <= c; h++) {
        const g = n(r) * (u - 1), m = i(r) * (h - 1), f = {
          startRow: g + e.startRow,
          endRow: g + e.startRow,
          startColumn: m + e.startColumn,
          endColumn: m + e.startColumn
        };
        d.push({ repeatRelativeRange: l, startRange: f });
      }
  else if (!o && s && !t)
    for (let u = 1; u <= a; u++) {
      const h = n(r) * (u - 1), g = 0, m = {
        startRow: h + e.startRow,
        endRow: h + e.startRow,
        startColumn: g + e.startColumn,
        endColumn: g + e.startColumn
      };
      d.push({ repeatRelativeRange: l, startRange: m });
    }
  else if (o && !s && !t)
    for (let u = 1; u <= c; u++) {
      const g = i(r) * (u - 1), m = {
        startRow: 0 + e.startRow,
        endRow: 0 + e.startRow,
        startColumn: g + e.startColumn,
        endColumn: g + e.startColumn
      };
      d.push({ repeatRelativeRange: l, startRange: m });
    }
  else {
    const u = {
      startRow: e.startRow,
      endRow: e.startRow,
      startColumn: e.startColumn,
      endColumn: e.startColumn
    };
    d.push({ startRange: u, repeatRelativeRange: l });
  }
  return d;
};
function nh(r) {
  return r ? [
    // Excel class names
    /<td[^>]*class=".*?xl.*?"[^>]*>/i,
    // Excel namespace
    /xmlns:x="urn:schemas-microsoft-com:office:excel"/i,
    // Excel ProgID
    /ProgId="Excel.Sheet"/i,
    // Office specific namespace
    /xmlns:o="urn:schemas-microsoft-com:office:office"/i,
    // Excel specific style markers
    /@mso-|mso-excel/i,
    // Excel workbook metadata
    /<x:ExcelWorkbook>/i
  ].some((t) => t.test(r)) : !1;
}
function T1(r) {
  if (!r)
    return !1;
  const e = /<img[^>]*src\s*=\s*["']data:image\/[^;]+;base64,[^"']*["'][^>]*>/i;
  return (r.match(e) || []).length > 0;
}
function P1(...r) {
  if (r.length === 1)
    return r[0];
  const e = new Ge();
  return r.forEach((t) => {
    t && new Ge(t).forValue((i, o, s) => {
      e.setValue(i, o, { ...e.getValue(i, o), ...s });
    });
  }), e.getMatrix();
}
function x1(r, e) {
  return r.id === e.id && r.params.unitId === e.params.unitId && r.params.subUnitId === e.params.subUnitId;
}
function rh(r) {
  const e = [];
  for (let t = 0; t < r.length; ) {
    let n = 1;
    if (r[t].id === we.id) {
      const i = r[t], o = [i];
      for (; t + n < r.length && x1(i, r[t + n]); )
        o.push(r[t + n]), n += 1;
      const s = P1(...o.map((l) => l.params.cellValue || {}));
      e.push({
        ...i,
        params: {
          ...i.params,
          cellValue: s
        }
      });
    } else
      e.push(r[t]);
    t += n;
  }
  return e;
}
function Wa(r, e) {
  const { startRow: t, endRow: n, startColumn: i, endColumn: o } = r;
  for (let s = t; s <= n; s++)
    for (let l = i; l <= o; l++)
      if (e.rows.includes(s) && e.cols.includes(l))
        return !0;
}
function ih(r, e) {
  const { startRow: t, endRow: n, startColumn: i, endColumn: o } = e;
  for (let s = t; s <= n; s++)
    if (!r.rows.includes(s))
      return !1;
  for (let s = i; s <= o; s++)
    if (!r.cols.includes(s))
      return !1;
  return !0;
}
function O1(r) {
  const e = r.trim().split(`
`);
  let t = "<table>";
  return e.forEach((n) => {
    const i = n.split("	");
    t += "<tr>", i.forEach((o) => {
      t += `<td>${o}</td>`;
    }), t += "</tr>";
  }), t += "</table>", t;
}
var A1 = Object.getOwnPropertyDescriptor, H1 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? A1(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Pt = (r, e) => (t, n) => e(t, n, r);
const et = {
  DEFAULT_COPY: "default-copy",
  DEFAULT_PASTE: "default-paste",
  SPECIAL_PASTE_VALUE: "special-paste-value",
  SPECIAL_PASTE_FORMAT: "special-paste-format",
  SPECIAL_PASTE_COL_WIDTH: "special-paste-col-width",
  SPECIAL_PASTE_BESIDES_BORDER: "special-paste-besides-border",
  SPECIAL_PASTE_FORMULA: "special-paste-formula"
}, V1 = {
  [qS]: "png",
  [GS]: "jpg",
  [ZS]: "webp",
  [YS]: "bmp"
};
fi.use(R1);
fi.use(b1);
fi.use(_1);
const nn = Yt("sheet.clipboard-service");
let rl = class extends oe {
  constructor(e, t, n, i, o, s, l, a, c, d, u, h, g, m) {
    super();
    _(this, "_clipboardHooks", []);
    _(this, "_clipboardHooks$", new Me([]));
    _(this, "clipboardHooks$", this._clipboardHooks$.asObservable());
    _(this, "_htmlToUSM");
    _(this, "_usmToHtml");
    _(this, "_copyContentCache");
    _(this, "_copyMarkId", null);
    // Record the parsed matrix and row and column attributes
    _(this, "_pasteOptionsCache$", new Me(null));
    _(this, "pasteOptionsCache$", this._pasteOptionsCache$.asObservable());
    //Control the visibility of the Paste Options menu
    _(this, "_showMenu$", new Me(!1));
    _(this, "showMenu$", this._showMenu$.asObservable());
    this._logService = e, this._univerInstanceService = t, this._selectionManagerService = n, this._clipboardInterfaceService = i, this._undoRedoService = o, this._commandService = s, this._markSelectionService = l, this._notificationService = a, this._platformService = c, this._renderManagerService = d, this._themeService = u, this._localeService = h, this._errorService = g, this._injector = m, this._htmlToUSM = new fi({
      getCurrentSkeleton: () => {
        var f;
        return (f = Rd(
          O.UNIVER_SHEET,
          ue,
          this._univerInstanceService,
          this._renderManagerService
        )) == null ? void 0 : f.getCurrentParam();
      }
    }), this._usmToHtml = new E1(), this._copyContentCache = new m1(), this.disposeWithMe(this._htmlToUSM), this._initUnitDisposed();
  }
  setShowMenu(e) {
    this._showMenu$.next(e);
  }
  getPasteMenuVisible() {
    return this._showMenu$.getValue();
  }
  getPasteOptionsCache() {
    return this._pasteOptionsCache$.getValue();
  }
  copyContentCache() {
    return this._copyContentCache;
  }
  generateCopyContent(e, t, n, i = Yn.COPY) {
    const o = this._clipboardHooks;
    o.forEach((l) => {
      var a;
      return (a = l.onBeforeCopy) == null ? void 0 : a.call(l, e, t, n, i);
    });
    const s = this._generateCopyContent(e, t, n, this._clipboardHooks);
    return o.forEach((l) => {
      var a;
      return (a = l.onAfterCopy) == null ? void 0 : a.call(l);
    }), s;
  }
  async copy(e = Yn.COPY) {
    const t = this._selectionManagerService.getCurrentLastSelection();
    if (!t)
      return !1;
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), i = n.getActiveSheet();
    if (!i)
      return !1;
    const o = n.getUnitId(), s = i.getSheetId(), l = this.generateCopyContent(o, s, t.range);
    if (!l)
      return !1;
    const { html: a, plain: c, matrixFragment: d, copyId: u, discreteRange: h } = l;
    this._copyContentCache.set(u, {
      unitId: n.getUnitId(),
      subUnitId: i.getSheetId(),
      range: h,
      matrix: d,
      copyType: e
    }), await this._clipboardInterfaceService.write(c, a), this._markSelectionService.removeAllShapes();
    const g = Cm(this._themeService);
    return this._copyMarkId = this._markSelectionService.addShape({ ...t, style: g }), !0;
  }
  async cut() {
    return this.copy(Yn.CUT);
  }
  async paste(e, t = et.DEFAULT_PASTE) {
    const n = e.types, i = n.indexOf(Hu) !== -1 ? await e.getType(Hu).then((a) => a && a.text()) : "", o = n.indexOf(Vu) !== -1 ? await e.getType(Vu).then((a) => a && a.text()) : "", s = n.findIndex((a) => jS.has(a)), l = s === -1 || !T1(o);
    if (o && l)
      return this._platformService.isWindows && nh(o) && this._notificationService.show({
        type: "warning",
        title: this._localeService.t("clipboard.shortCutNotify.title"),
        content: this._localeService.t("clipboard.shortCutNotify.useShortCutInstead")
      }), this._pasteHTML(o, t);
    if (s !== -1) {
      const a = n[s], c = await e.getType(a);
      if (c) {
        const d = V1[a], u = new File(
          [c],
          `clipboard-image.${d}`,
          { type: a }
        );
        return this._pasteFiles([u], t);
      }
    }
    return i ? this._pastePlainText(i, t) : (this._logService.error("[SheetClipboardService]", "No valid data on clipboard"), !1);
  }
  async legacyPaste(e, t, n) {
    const i = nh(e != null ? e : "");
    return n && !i ? this._pasteFiles(n, et.DEFAULT_PASTE) : e ? this._pasteHTML(e, et.DEFAULT_PASTE) : t ? /[\n\t]/.test(t) ? this._pasteHTML(O1(t), et.DEFAULT_PASTE) : this._pastePlainText(t, et.DEFAULT_PASTE) : this._pasteUnrecognized();
  }
  rePasteWithPasteType(e) {
    const t = this._pasteOptionsCache$.getValue();
    if (!t)
      return !1;
    const n = this._injector.get(Zt), i = n.pitchTopUndoElement();
    i && Wo(i.undoMutations, this._commandService) && n.popUndoToRedo();
    const { cellMatrix: o, rowProperties: s = [], colProperties: l = [], source: a, target: c } = t;
    return this._pasteUSM({
      cellMatrix: o,
      colProperties: l,
      rowProperties: s
    }, c, et[e], a), !0;
  }
  updatePasteOptionsCache(e) {
    this._pasteOptionsCache$.next(e);
  }
  addClipboardHook(e) {
    if (this._clipboardHooks.findIndex((n) => n.id === e.id) !== -1)
      return this._logService.error("[SheetClipboardService]", "hook already exists", e.id), { dispose: () => {
      } };
    const t = this._clipboardHooks.findIndex((n) => {
      const i = n.priority || 0;
      return (e.priority || 0) < i;
    });
    return this._clipboardHooks.splice(t !== -1 ? t : this._clipboardHooks.length, 0, e), this._notifyClipboardHook(), We(() => {
      const n = this._clipboardHooks.indexOf(e);
      n > -1 && (this._clipboardHooks.splice(n, 1), this._notifyClipboardHook());
    });
  }
  getClipboardHooks() {
    return this._clipboardHooks;
  }
  _generateCopyContent(e, t, n, i) {
    const o = this._univerInstanceService.getUniverSheetInstance(e), s = o == null ? void 0 : o.getSheetBySheetId(t);
    if (!o || !s)
      return null;
    const l = i.reduce((C, I) => {
      var y;
      const R = (y = I.getFilteredOutRows) == null ? void 0 : y.call(I, n);
      return R == null || R.forEach((M) => C.add(M)), C;
    }, /* @__PURE__ */ new Set()), { startColumn: a, startRow: c, endColumn: d, endRow: u } = n, h = s.getMatrixWithMergedCells(c, a, u, d, Kh.Both), g = new Ge();
    let m = c;
    const f = new Ge(), v = { rows: [], cols: [] };
    for (let C = c; C <= u; C++)
      if (!l.has(C)) {
        v.rows.push(C);
        for (let I = a; I <= d; I++) {
          const R = h.getValue(C, I);
          if (R) {
            const y = de.deepClone(R);
            f.setValue(m - c, I - a, {
              ...Gi(),
              ...y
            }), delete y.displayV, g.setValue(m - c, I - a, {
              ...Gi(),
              ...y
            });
          } else
            f.setValue(m - c, I - a, Gi()), g.setValue(m - c, I - a, Gi()), h.setValue(C, I, Gi());
        }
        m += 1;
      }
    for (let C = a; C <= d; C++)
      v.cols.push(C);
    let p = this._usmToHtml.convert(h, v, i);
    const S = N1(f), w = h1();
    return p = p.replace(/(<[a-z]+)/, (C, I) => `${I} data-copy-id="${w}"`), {
      copyId: w,
      plain: S,
      html: p,
      matrixFragment: g,
      discreteRange: v
    };
  }
  _notifyClipboardHook() {
    this._clipboardHooks$.next(this._clipboardHooks);
  }
  async _executePaste(e) {
    const t = this._getPastingTarget();
    if (!t.subUnitId || !t.selection)
      return !1;
    const n = this._injector.invoke((h) => co(t.selection.range, h, t.unitId, t.subUnitId));
    if (!n)
      return !1;
    const { unitId: i, subUnitId: o } = t, s = this._clipboardHooks, l = [];
    if (s.some(
      (h) => {
        var g;
        return l.push(h) && ((g = h.onBeforePaste) == null ? void 0 : g.call(h, { unitId: i, subUnitId: o, range: n })) === !1;
      }
    ))
      return l.forEach((h) => {
        var g;
        return (g = h.onAfterPaste) == null ? void 0 : g.call(h, !1);
      }), !1;
    const c = [], d = [];
    l.forEach((h) => {
      const g = e(h, {
        unitId: i,
        subUnitId: o,
        range: n
      });
      g && (c.push(...g.redos), d.push(...g.undos));
    });
    const u = c.every((h) => this._commandService.executeCommand(h.id, h.params));
    return u && this._undoRedoService.pushUndoRedo({
      unitID: this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId(),
      undoMutations: d,
      redoMutations: c
    }), u;
  }
  async _pasteFiles(e, t) {
    return this._executePaste((n, i) => {
      var o;
      return (o = n.onPasteFiles) == null ? void 0 : o.call(n, i, e, { pasteType: t });
    });
  }
  async _pastePlainText(e, t) {
    return this._executePaste((n, i) => {
      var o;
      return (o = n.onPastePlainText) == null ? void 0 : o.call(n, i, e, { pasteType: t });
    });
  }
  _pasteUnrecognized() {
    return this._executePaste((e, t) => {
      var n;
      return (n = e.onPasteUnrecognized) == null ? void 0 : n.call(e, t);
    });
  }
  async _pasteHTML(e, t) {
    const n = g1(e);
    return n && this._copyContentCache.get(n) ? this._pasteInternal(n, t) : this._pasteExternal(e, t);
  }
  async _pasteExternal(e, t) {
    var d;
    const { rowProperties: n, colProperties: i, cellMatrix: o } = this._htmlToUSM.convert(e);
    if (!o)
      return !1;
    const s = this._getPastedRange(o);
    if (!s)
      return !1;
    const l = (d = this._univerInstanceService.getUniverSheetInstance(s.unitId)) == null ? void 0 : d.getSheetBySheetId(s.subUnitId);
    if (!l)
      return !1;
    const a = l == null ? void 0 : l.getMergeData();
    return a.length && a.some((h) => Wa(h, s.pastedRange) && !ih(s.pastedRange, h)) ? (this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")), !1) : this._pasteUSM(
      {
        rowProperties: n,
        colProperties: i,
        cellMatrix: o
      },
      s,
      t
    );
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  async _pasteInternal(e, t) {
    var C, I;
    const n = de.deepClone(this._copyContentCache.get(e)), { range: i, matrix: o, unitId: s, subUnitId: l } = n || {};
    if (!o || !n || !i || !s || !l || !o || !n)
      return !1;
    const { mapFunc: a } = wr([i]), c = (C = this._univerInstanceService.getUniverSheetInstance(s)) == null ? void 0 : C.getSheetBySheetId(l);
    o.forValue((R, y, M) => {
      const { row: E, col: T } = a(R, y), P = c == null ? void 0 : c.getComposedCellStyle(E, T), H = de.deepClone(M);
      if (H.s = P, o.setValue(R, y, H), M.colSpan || M.rowSpan)
        for (let A = 0; A < M.rowSpan; A++)
          for (let x = 0; x < M.colSpan; x++) {
            if (A === 0 && x === 0) continue;
            const V = R + A, D = y + x;
            o.setValue(V, D, { s: P });
          }
    });
    const d = this._getPastedRange(o);
    if (!d) return !1;
    const u = (I = this._univerInstanceService.getUniverSheetInstance(d.unitId)) == null ? void 0 : I.getSheetBySheetId(d.subUnitId);
    if (!u)
      return !1;
    const h = u == null ? void 0 : u.getMergeData();
    if (h && h.some((y) => Wa(y, d.pastedRange) && !ih(d.pastedRange, y)))
      return this._errorService.emit(this._localeService.t("clipboard.paste.overlappingMergedCells")), !1;
    const g = this._univerInstanceService.getUnit(s);
    if (!g) return !1;
    const m = g.getSheetBySheetId(l);
    if (!m) return !1;
    const f = m.getColumnManager(), v = m.getRowManager(), p = [], S = [];
    if (i.cols.forEach((R) => {
      p.push({ width: `${f.getColumnWidth(R)}` });
    }), i.rows.forEach((R) => {
      S.push({ height: `${v.getRowHeight(R)}` });
    }), n.copyType === Yn.CUT) {
      const R = d.pastedRange.rows[0], y = i.rows[i.rows.length - 1] - i.rows[0] + R;
      d.pastedRange.rows = Array.from(new Array(y + 1).keys()).slice(R);
    }
    const w = this._pasteUSM(
      {
        cellMatrix: o,
        colProperties: p,
        rowProperties: S
      },
      // paste data
      d,
      t,
      {
        range: i,
        // paste source
        unitId: n.unitId,
        subUnitId: n.subUnitId,
        copyType: n.copyType,
        copyId: e
      }
    );
    return n.copyType === Yn.CUT && (this._copyContentCache.set(e, { ...n, matrix: null }), this._copyMarkId && this._markSelectionService.removeShape(this._copyMarkId), this._copyMarkId = null), w;
  }
  // eslint-disable-next-line max-lines-per-function
  _pasteUSM(e, t, n, i) {
    const { rowProperties: o, colProperties: s, cellMatrix: l } = e, { unitId: a, subUnitId: c, pastedRange: d } = t, u = d.cols.length, h = this._clipboardHooks, g = [];
    if (h.some(
      (R) => {
        var y;
        return g.push(R) && ((y = R.onBeforePaste) == null ? void 0 : y.call(R, { unitId: a, subUnitId: c, range: d })) === !1;
      }
    ))
      return g.forEach((R) => {
        var y;
        return (y = R.onAfterPaste) == null ? void 0 : y.call(R, !1);
      }), !1;
    if (!l) return !1;
    const f = i ? {
      unitId: i.unitId,
      subUnitId: i.subUnitId,
      range: i.range
    } : null, v = {
      copyType: (i == null ? void 0 : i.copyType) || Yn.COPY,
      copyId: i == null ? void 0 : i.copyId,
      pasteType: n
    };
    let p = [], S = [];
    const w = g.filter(
      (R) => !R.specialPasteInfo && R.id !== et.DEFAULT_PASTE || n === R.id
    );
    w.forEach((R) => {
      var E, T, P;
      if (o) {
        const H = (E = R.onPasteRows) == null ? void 0 : E.call(R, { range: d, unitId: a, subUnitId: c }, o, {
          pasteType: n
        });
        H && (p.push(...H.redos), S.push(...H.undos));
      }
      const y = (T = R.onPasteColumns) == null ? void 0 : T.call(
        R,
        { range: d, unitId: a, subUnitId: c },
        s || new Array(u).map(() => ({})),
        { pasteType: n }
      );
      y && (p.push(...y.redos), S.push(...y.undos));
      const M = (P = R.onPasteCells) == null ? void 0 : P.call(
        R,
        f,
        { range: d, unitId: a, subUnitId: c },
        l,
        v
      );
      M && (p.push(...M.redos), S.push(...M.undos));
    });
    const C = this._getSetSelectionOperation(a, c, d, l, n);
    C && p.push(C), p = rh(p), S = rh(S), S.push({ id: nt.id, params: { unitId: t.unitId, subUnitId: t.subUnitId } }), this._logService.log("[SheetClipboardService]", "pasting mutations", {
      undoMutationsInfo: S,
      redoMutationsInfo: p
    });
    const I = p.every((R) => this._commandService.syncExecuteCommand(R.id, R.params));
    return I && (this._undoRedoService.pushUndoRedo({
      unitID: a,
      undoMutations: S,
      redoMutations: p
    }), this.updatePasteOptionsCache({
      target: {
        pastedRange: d,
        unitId: a,
        subUnitId: c
      },
      cellMatrix: l,
      rowProperties: o,
      colProperties: s,
      pasteType: n,
      source: i
    }), this.setShowMenu(!0)), w.forEach((R) => {
      var y;
      return (y = R.onAfterPaste) == null ? void 0 : y.call(R, I);
    }), I;
  }
  _getSetSelectionOperation(e, t, n, i, o) {
    var C;
    const s = (C = this._univerInstanceService.getUniverSheetInstance(e)) == null ? void 0 : C.getSheetBySheetId(t);
    if (!s)
      return null;
    const { rows: l, cols: a } = n, c = l[0], d = a[0], u = l[l.length - 1], h = a[a.length - 1], m = dg({
      startRow: c,
      endRow: c,
      startColumn: d,
      endColumn: d
    }, s), f = i.getValue(0, 0), v = (f == null ? void 0 : f.rowSpan) || 1, p = (f == null ? void 0 : f.colSpan) || 1;
    if ((o === et.DEFAULT_PASTE || o === et.SPECIAL_PASTE_BESIDES_BORDER || o === et.SPECIAL_PASTE_FORMAT) && (v > 1 || p > 1)) {
      const I = {
        startRow: c,
        endRow: c + v - 1,
        startColumn: d,
        endColumn: d + p - 1
      };
      m.startRow = I.startRow, m.endRow = I.endRow, m.startColumn = I.startColumn, m.endColumn = I.endColumn, m.isMerged = !0, m.isMergedMainCell = !0;
    }
    const w = {
      unitId: e,
      subUnitId: t,
      selections: [{
        range: {
          startRow: c,
          endRow: u,
          startColumn: d,
          endColumn: h
        },
        primary: m,
        style: null
      }]
    };
    return {
      id: Ie.id,
      params: w
    };
  }
  _getPastingTarget() {
    const e = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), t = e.getActiveSheet(), n = this._selectionManagerService.getCurrentLastSelection();
    return {
      unitId: e.getUnitId(),
      subUnitId: t == null ? void 0 : t.getSheetId(),
      selection: n
    };
  }
  /**
   * Handles copying one range to another range, obtained by the following rules
   *
   * [Content to be assigned] => [Target range]
   *
   * I. There are no merged cells in the upper left corner of the pasted area
   *
   * 1. 1 -> 1: 1 => 1
   * 2. N -> 1: N => N
   * 3. 1 -> N: N => N
   * 4. N1 -> N2:
   *     1) N1 <N2: If N2 is a multiple of N1 (X), N1 * X => N2; If not, N1 => N1 (refer to office excel, different from google sheet)
   *     2) N1> N2: N1 => N1
   *
   * The above four cases can be combined and processed as
   *
   * Case 1, 1/2/4-2 merged into N1 => N1
   * Case 2, 3/4-1 merge into N1 * X => N2 or Case 1
   *
   * In the end we only need to judge whether N2 is a multiple of N1
   *
   * II. The pasted area contains merged cells
   *
   * 1. If N2 is a multiple of N1,
   *   1) If N2 === N1, paste this area directly and the range remains unchanged.
   *   2) Otherwise, determine whether other cells are included
   *     1] If included, tile, the range remains unchanged
   *     2] If not included, determine whether the source data is a combined cell
   *       1} If yes, tile, the range remains unchanged
   *       2} If not, only the content will be pasted, the original style will be discarded, and the scope will remain unchanged.
   *
   * 2. If N2 is not a multiple of N1, determine whether the upper left corner cell (merged or non-merged or combined) is consistent with the size of the original data.
   *   1) If consistent, only paste this area;
   *   2) If inconsistent, then determine whether the pasted area contains other cells.
   *     1] If yes, pasting is not allowed and an error will pop up;
   *     2] If not, only the content will be pasted and the original style will be discarded.
   *
   * @param rowCount
   * @param colCount
   * @param cellMatrix
   * @param range
   */
  // eslint-disable-next-line max-lines-per-function, complexity
  _transformPastedData(e, t, n) {
    const i = this._getPastingTarget(), { selection: o, unitId: s, subUnitId: l } = i;
    if (!l || !o)
      return null;
    const a = this._injector.invoke((T) => co(o.range, T, s, l));
    if (!a)
      return null;
    const { ranges: [c], mapFunc: d } = wr([a]), { startRow: u, startColumn: h, endRow: g, endColumn: m } = c, f = g - u + 1, v = m - h + 1, p = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), S = p == null ? void 0 : p.getActiveSheet();
    if (!S)
      return null;
    const C = S.getMergeData().filter(
      (T) => a.rows.includes(T.startRow) && a.cols.includes(T.startColumn)
    ), I = C[0];
    let R = 0, y = 0, M = 0, E = 0;
    if (I && (R = I.startRow, y = I.startColumn, M = I.endRow, E = I.endColumn), f % e === 0 && v % t === 0)
      if (C.length > 0 && (f !== e || v !== t))
        if (R === a.rows[0] && y === a.cols[0] && M === a.rows[f - 1] && E === a.cols[v - 1])
          if (W1(n))
            for (let P = 0; P < f; P++)
              for (let H = 0; H < v; H++) {
                const A = n.getValue(P % e, H % t);
                A && n.setValue(P, H, A);
              }
          else
            n.forValue((P, H, A) => {
              A.s = null, delete A.colSpan, delete A.rowSpan;
            });
        else
          for (let T = 0; T < f; T++)
            for (let P = 0; P < v; P++) {
              const H = n.getValue(T % e, P % t);
              H && n.setValue(T, P, H);
            }
      else
        for (let T = 0; T < f; T++)
          for (let P = 0; P < v; P++) {
            const H = n.getValue(T % e, P % t);
            H && n.setValue(T, P, H);
          }
    else if (C.length > 0) {
      const { row: T, col: P } = d(u, h);
      if (this._topLeftCellsMatch(e, t, {
        topRow: T,
        leftCol: P
      })) {
        const A = this._expandOrShrinkRowsCols(s, l, a, t, e);
        a.rows = A.rows, a.cols = A.cols;
      } else {
        if (g > I.endRow || m > I.endColumn)
          return null;
        n.forValue((A, x, V) => {
          V.s = null, delete V.colSpan, delete V.rowSpan;
        });
      }
    } else {
      const T = this._expandOrShrinkRowsCols(s, l, a, t, e);
      a.rows = T.rows, a.cols = T.cols;
    }
    return {
      pastedRange: a,
      unitId: s,
      subUnitId: l
    };
  }
  _getPastedRange(e) {
    var S;
    const t = this._getPastingTarget(), { selection: n, unitId: i, subUnitId: o } = t;
    if (!o || !n)
      return null;
    const s = this._injector.invoke((w) => co(n.range, w, i, o));
    if (!s)
      return null;
    const { startColumn: l, endColumn: a, startRow: c, endRow: d } = e.getDataRange(), u = d - c + 1, h = a - l + 1;
    if (u <= 0 || h <= 0) return null;
    const g = s.rows.length, m = s.cols.length, f = (S = this._univerInstanceService.getUniverSheetInstance(i)) == null ? void 0 : S.getSheetBySheetId(o);
    if (!f)
      return null;
    const v = f == null ? void 0 : f.getMergeData();
    if (g % u === 0 && m % h === 0 && !(v == null ? void 0 : v.some((C) => Wa(C, s)))) {
      for (let C = 0; C < g; C++)
        for (let I = 0; I < m; I++) {
          const R = e.getValue(C % u, I % h);
          R && e.setValue(C, I, R);
        }
      return {
        pastedRange: s,
        unitId: i,
        subUnitId: o
      };
    }
    const p = this._expandOrShrinkRowsCols(i, o, s, h, u);
    return s.rows = p.rows, s.cols = p.cols, {
      pastedRange: s,
      unitId: i,
      subUnitId: o
    };
  }
  _expandOrShrinkRowsCols(e, t, n, i, o) {
    const { rows: s, cols: l } = n, a = this._univerInstanceService.getUniverSheetInstance(e), c = a == null ? void 0 : a.getSheetBySheetId(t);
    let d, u;
    if (s.length >= o)
      d = s.slice(0, o);
    else {
      d = s.slice(0);
      let h = s[s.length - 1] + 1;
      for (; d.length < o; )
        c.getRowFiltered(h) || d.push(h), h++;
    }
    if (l.length >= i)
      u = l.slice(0, i);
    else {
      u = l.slice(0);
      let h = l[l.length - 1] + 1;
      for (; u.length < i; )
        u.push(h), h++;
    }
    return {
      rows: d,
      cols: u
    };
  }
  /**
   * Determine whether the cells starting from the upper left corner of the range (merged or non-merged or combined) are consistent with the size of the original data
   * @param cellMatrix
   * @param range
   */
  _topLeftCellsMatch(e, t, n) {
    const i = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), o = i == null ? void 0 : i.getActiveSheet();
    if (!o)
      return !1;
    const { topRow: s, leftCol: l } = n, a = D1(
      s + e - 1,
      l,
      l + t - 1,
      o
    ), c = L1(
      l + t - 1,
      s,
      s + e - 1,
      o
    );
    return !a && !c;
  }
  removeMarkSelection() {
    this._copyMarkId && (this._markSelectionService.removeShape(this._copyMarkId), this._copyMarkId = null);
  }
  _initUnitDisposed() {
    this.disposeWithMe(
      this._univerInstanceService.getTypeOfUnitDisposed$(O.UNIVER_SHEET).subscribe((e) => {
        e && this.copyContentCache().clearWithUnitId(e.getUnitId());
      })
    );
  }
  disposePasteOptionsCache() {
    this.setShowMenu(!1), this.updatePasteOptionsCache(null);
  }
};
rl = H1([
  Pt(0, Wl),
  Pt(1, k),
  Pt(2, N(Q)),
  Pt(3, Jl),
  Pt(4, Zt),
  Pt(5, W),
  Pt(6, Wi),
  Pt(7, XS),
  Pt(8, zS),
  Pt(9, fe),
  Pt(10, N(Ht)),
  Pt(11, N(xe)),
  Pt(12, N(uv)),
  Pt(13, N(Rt))
], rl);
function N1(r) {
  let e = "";
  const t = r.getLength();
  return r.forRow((n, i) => {
    const o = [];
    i.forEach((s) => {
      const l = r.getValue(n, s);
      if (l) {
        const a = k1(l);
        o.push(a);
      }
    }), e += o.join("	"), n !== t - 1 && (e += `
`);
  }), e;
}
function k1(r) {
  return hv(r.displayV) ? r.displayV : Jh(r);
}
function D1(r, e, t, n) {
  return n.getMergeData().some(
    (i) => i.startRow <= r && r < i.endRow && e <= i.startColumn && i.startColumn <= t
  );
}
function L1(r, e, t, n) {
  return n.getMergeData().some(
    (i) => i.startColumn <= r && r < i.endColumn && e <= i.startRow && i.startRow <= t
  );
}
function W1(r) {
  let e = 0;
  return r.forValue((t, n, i) => {
    if (i && e++, e > 1)
      return !1;
  }), e > 1;
}
function Gi() {
  return {
    p: null,
    v: null,
    s: null,
    f: null,
    si: null,
    t: null
  };
}
const jd = 998, un = {
  id: QS.id,
  name: "sheet.command.copy",
  type: J.COMMAND,
  multi: !0,
  priority: jd,
  preconditions: Fd,
  handler: async (r) => r.get(nn).copy()
}, Yd = {
  id: KS.id,
  name: "sheet.command.cut",
  type: J.COMMAND,
  multi: !0,
  priority: jd,
  preconditions: Fd,
  handler: async (r) => r.get(nn).cut()
}, hn = {
  id: JS.id,
  type: J.COMMAND,
  multi: !0,
  name: "sheet.command.paste",
  priority: jd,
  preconditions: Fd,
  handler: async (r, e) => {
    const n = await r.get(Jl).read(), i = r.get(nn);
    return n.length !== 0 ? i.paste(n[0], e == null ? void 0 : e.value) : !1;
  }
}, Xc = {
  id: $S,
  type: J.COMMAND,
  handler: async (r, e) => {
    const t = r.get(nn), { htmlContent: n, textContent: i, files: o } = e;
    return t.legacyPaste(n, i, o), !0;
  }
}, go = {
  id: "sheet.command.paste-value",
  type: J.COMMAND,
  handler: async (r) => r.get(W).executeCommand(hn.id, { value: et.SPECIAL_PASTE_VALUE })
}, mo = {
  id: "sheet.command.paste-format",
  type: J.COMMAND,
  handler: async (r) => r.get(W).executeCommand(hn.id, {
    value: et.SPECIAL_PASTE_FORMAT
  })
}, ri = {
  id: "sheet.command.paste-col-width",
  type: J.COMMAND,
  handler: async (r) => r.get(W).executeCommand(hn.id, {
    value: et.SPECIAL_PASTE_COL_WIDTH
  })
}, fo = {
  id: "sheet.command.paste-besides-border",
  type: J.COMMAND,
  handler: async (r) => r.get(W).executeCommand(hn.id, {
    value: et.SPECIAL_PASTE_BESIDES_BORDER
  })
}, _m = {
  id: "sheet.command.optional-paste",
  type: J.COMMAND,
  handler: async (r, { type: e }) => r.get(nn).rePasteWithPasteType(e)
}, ts = {
  type: J.COMMAND,
  id: "sheet.command.delete-range-move-left-confirm",
  handler: async (r) => {
    const e = r.get(tn), t = r.get(W), n = r.get(xe), i = r.get(Q), o = r.get(k), s = i.getCurrentSelections();
    if (!s)
      return !1;
    const l = Xe(o);
    if (!l) return !1;
    const { worksheet: a } = l;
    let c = s[0].range;
    if (!c)
      return !1;
    c = { ...c, endColumn: a.getColumnCount() - 1 };
    const d = (g) => g.endRow - g.startRow;
    return a.getMergeData().find((g) => {
      const m = se.getIntersects(g, c);
      return m ? d(g) > d(m) : !1;
    }) ? await e.confirm({
      id: ts.id,
      title: { title: n.t("merge.confirm.warning") },
      children: { title: n.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: n.t("button.cancel"),
      confirmText: n.t("button.confirm")
    }) ? t.executeCommand(Iu.id) : !0 : t.executeCommand(Iu.id);
  }
}, pi = {
  type: J.COMMAND,
  id: "sheet.command.delete-range-move-up-confirm",
  handler: async (r) => {
    const e = r.get(tn), t = r.get(W), n = r.get(xe), i = r.get(Q), o = r.get(k), s = i.getCurrentSelections();
    if (!s) return !1;
    const l = Xe(o);
    if (!l) return !1;
    const { worksheet: a } = l;
    let c = s[0].range;
    if (!c) return !1;
    c = { ...c, endRow: a.getRowCount() - 1 };
    for (let g = c.startRow; g <= c.endRow; g++)
      if (a.getRowFiltered(g) && await e.confirm({
        id: pi.id,
        title: { title: n.t("filter.confirm.error") },
        children: { title: n.t("filter.confirm.notAllowedToInsertRange") },
        confirmText: n.t("button.confirm")
      }))
        return !1;
    const d = (g) => g.endColumn - g.startColumn;
    return a.getMergeData().find((g) => {
      const m = se.getIntersects(g, c);
      return m ? d(g) > d(m) : !1;
    }) ? await e.confirm({
      id: pi.id,
      title: { title: n.t("merge.confirm.warning") },
      children: { title: n.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: n.t("button.cancel"),
      confirmText: n.t("button.confirm")
    }) ? t.executeCommand(yu.id) : !0 : t.executeCommand(yu.id);
  }
};
var aa = /* @__PURE__ */ ((r) => (r.MergeAll = "mergeAll", r.MergeVertical = "mergeVertical", r.MergeHorizontal = "mergeHorizontal", r))(aa || {});
function qn(r, e, t, n, i = !0, o = 1, s = !0) {
  let l = { ...r };
  n == null && (n = {
    startRow: 0,
    endRow: t.getRowCount() - 1,
    startColumn: 0,
    endColumn: t.getColumnCount() - 1
  });
  let a;
  switch (e) {
    case U.UP:
      for (a = r.startRow - o; a > -1 && !t.getRowVisible(a); )
        a -= 1;
      a >= n.startRow ? (l.startRow = a, l.endRow = a) : s && (l.startRow = n.endRow, l.endRow = n.endRow, i && (l = qn(l, U.LEFT, t, n, !1)));
      break;
    case U.DOWN:
      for (a = r.endRow + o; a < t.getRowCount() && !t.getRowVisible(a); )
        a += 1;
      a <= n.endRow ? (l.startRow = a, l.endRow = a) : s && (l.startRow = n.startRow, l.endRow = n.startRow, i && (l = qn(l, U.RIGHT, t, n, !1)));
      break;
    case U.LEFT:
      for (a = r.startColumn - o; a > -1 && !t.getColVisible(a); )
        a -= 1;
      a >= n.startColumn ? (l.startColumn = a, l.endColumn = a) : s && (l.startColumn = n.endColumn, l.endColumn = n.endColumn, i && (l = qn(l, U.UP, t, n, !1)));
      break;
    case U.RIGHT:
      for (a = r.endColumn + o; a < t.getColumnCount() && !t.getColVisible(a); )
        a += 1;
      a <= n.endColumn ? (l.startColumn = a, l.endColumn = a) : s && (l.startColumn = n.startColumn, l.endColumn = n.startColumn, i && (l = qn(l, U.DOWN, t, n, !1)));
      break;
  }
  return l;
}
function Zd(r, e, t) {
  const n = { ...r }, { startRow: i, startColumn: o, endRow: s, endColumn: l } = Ro(r, e, t);
  let a = qi(t, i, o, s, l).hasValue, c = !0, d = !0;
  for (; d; ) {
    if (U.UP === e) {
      let u = n.startRow - 1;
      for (; u > -1 && !t.getRowVisible(u); )
        u -= 1;
      if (u === -1) {
        d = !1;
        break;
      }
      const { hasValue: h, matrix: g } = qi(
        t,
        u,
        n.startColumn,
        u,
        n.endColumn
      );
      if (a && !h && !c) {
        d = !1;
        break;
      } else {
        if (g.getLength() !== 0) {
          let m = u;
          g.forValue((f) => {
            m = Math.min(f, m);
          }), n.startRow = m;
        } else
          n.startRow = u;
        if (n.endRow = n.startRow, !a && h) {
          d = !1;
          break;
        }
        a = h, c = !1;
      }
    }
    if (U.DOWN === e) {
      let u = n.endRow + 1;
      for (; u < t.getRowCount() && !t.getRowVisible(u); )
        u += 1;
      if (u === t.getRowCount()) {
        d = !1;
        break;
      }
      const { hasValue: h, matrix: g } = qi(
        t,
        u,
        n.startColumn,
        u,
        n.endColumn
      );
      if (a && !h && !c) {
        d = !1;
        break;
      } else {
        if (g.getLength() !== 0) {
          let m = u;
          g.forValue((f, v, p) => {
            m = Math.max(f + (p.rowSpan || 1) - 1, m);
          }), n.endRow = m;
        } else
          n.endRow = u;
        if (n.startRow = n.endRow, !a && h) {
          d = !1;
          break;
        }
        a = h, c = !1;
      }
    }
    if (U.LEFT === e) {
      let u = n.startColumn - 1;
      for (; u > -1 && !t.getColVisible(u); )
        u -= 1;
      if (u === -1) {
        d = !1;
        break;
      }
      const { hasValue: h, matrix: g } = qi(
        t,
        n.startRow,
        u,
        n.endRow,
        u
      );
      if (a && !h && !c) {
        d = !1;
        break;
      } else {
        if (g.getLength() !== 0) {
          let m = u;
          g.forValue((f, v) => {
            m = Math.min(v, m);
          }), n.startColumn = m;
        } else
          n.startColumn = u;
        if (n.endColumn = n.startColumn, !a && h) {
          d = !1;
          break;
        }
        a = h, c = !1;
      }
    }
    if (U.RIGHT === e) {
      let u = n.endColumn + 1;
      for (; u < t.getColumnCount() && !t.getColVisible(u); )
        u += 1;
      if (u === t.getColumnCount()) {
        d = !1;
        break;
      }
      const { hasValue: h, matrix: g } = qi(
        t,
        n.startRow,
        u,
        n.endRow,
        u
      );
      if (a && !h && !c) {
        d = !1;
        break;
      } else {
        if (g.getLength() !== 0) {
          let m = u;
          g.forValue((f, v, p) => {
            m = Math.max(v + (p.colSpan || 1) - 1, m);
          }), n.endColumn = m;
        } else
          n.endColumn = u;
        if (n.startColumn = n.endColumn, !a && h) {
          d = !1;
          break;
        }
        a = h, c = !1;
      }
    }
  }
  return En(n, t, !0);
}
function Rm(r, e, t) {
  return qn(r, e, t, void 0, !1, 1, !1);
}
function B1(r, e, t) {
  const n = Zd(r, e, t);
  return En(se.union(n, r), t, !0);
}
function F1(r, e, t) {
  const n = Rm(r, e, t), i = {
    startRow: Math.min(r.startRow, n.startRow),
    startColumn: Math.min(r.startColumn, n.startColumn),
    endRow: Math.max(r.endRow, n.endRow),
    endColumn: Math.max(r.endColumn, n.endColumn)
  };
  return En(se.union(r, i), t);
}
function U1(r, e, t, n) {
  const i = $h(t), o = Zd(Ro(r, i, n), t, n);
  return t === U.UP && o.startRow <= r.startRow ? En(
    { ...e, startColumn: r.startColumn, endColumn: r.endColumn },
    n,
    !0
  ) : t === U.DOWN && o.endRow >= r.endRow ? En(
    { ...e, startColumn: r.startColumn, endColumn: r.endColumn },
    n,
    !0
  ) : t === U.LEFT && o.startColumn <= r.startColumn ? En(
    { ...e, startRow: r.startRow, endRow: r.endRow },
    n,
    !0
  ) : t === U.RIGHT && o.endColumn >= r.endColumn ? En(
    { ...e, startRow: r.startRow, endRow: r.endRow },
    n,
    !0
  ) : se.union(se.clone(e), o);
}
function X1(r, e, t) {
  const n = $h(e), i = Ro(r, n, t), o = Ro(r, e, t), s = Rm(i, e, t);
  return En(se.union(o, s), t, !1);
}
function oh(r) {
  return {
    startRow: 0,
    startColumn: 0,
    endRow: r.getRowCount() - 1,
    endColumn: r.getColumnCount() - 1,
    rangeType: z.ALL
  };
}
function Ro(r, e, t) {
  let n;
  switch (e) {
    case U.UP:
      n = {
        startRow: r.startRow,
        startColumn: r.startColumn,
        endRow: r.startRow,
        endColumn: r.endColumn,
        rangeType: z.NORMAL
      };
      break;
    case U.DOWN:
      n = {
        startRow: r.endRow,
        startColumn: r.startColumn,
        endRow: r.endRow,
        endColumn: r.endColumn,
        rangeType: z.NORMAL
      };
      break;
    case U.LEFT:
      n = {
        startRow: r.startRow,
        startColumn: r.startColumn,
        endRow: r.endRow,
        endColumn: r.startColumn,
        rangeType: z.NORMAL
      };
      break;
    case U.RIGHT:
      n = {
        startRow: r.startRow,
        startColumn: r.endColumn,
        endRow: r.endRow,
        endColumn: r.endColumn,
        rangeType: z.NORMAL
      };
      break;
    default:
      throw new Error("Invalid direction");
  }
  return En(n, t, !1);
}
function qi(r, e, t, n, i) {
  let o = !1;
  const s = r.getMatrixWithMergedCells(e, t, n, i).forValue((l, a, c) => {
    if (j1(c))
      return o = !0, !1;
  });
  return {
    hasValue: o,
    matrix: s
  };
}
function zc(r, e, t) {
  const n = se.clone(r);
  if (e == null)
    return n;
  switch (t) {
    case U.UP:
    case U.DOWN:
      n.startColumn = n.endColumn = e.actualColumn;
      break;
    case U.LEFT:
    case U.RIGHT:
      n.startRow = n.endRow = e.actualRow;
      break;
  }
  return n;
}
function z1(r, e, t) {
  var l, a, c, d;
  const { primary: n, range: i } = r, o = se.clone(i);
  switch (e) {
    case U.UP:
    case U.DOWN:
      o.startRow = (l = n == null ? void 0 : n.startRow) != null ? l : i.startRow, o.endRow = (a = n == null ? void 0 : n.endRow) != null ? a : i.startRow;
      break;
    case U.LEFT:
    case U.RIGHT:
      o.startColumn = (c = n == null ? void 0 : n.startColumn) != null ? c : i.startColumn, o.endColumn = (d = n == null ? void 0 : n.endColumn) != null ? d : i.startColumn;
      break;
  }
  const s = Ro(o, e, t);
  switch (e) {
    case U.DOWN:
      return i.startRow < s.startRow;
    case U.UP:
      return i.endRow > s.endRow;
    case U.LEFT:
      return s.endColumn < i.endColumn;
    case U.RIGHT:
      return s.startColumn > i.startColumn;
  }
}
function Im(r, e) {
  let t = r[0].startRow, n = r[0].endRow;
  r.forEach((o) => {
    const { startRow: s, endRow: l } = o;
    t = Math.min(t, s), n = Math.max(n, l);
  });
  const i = new Array(n - t + 1).fill(!1);
  return e.forEach((o) => {
    const { startRow: s, endRow: l } = o;
    for (let a = Math.max(s, t); a <= Math.min(l, n); a++)
      i[a - t] = !0;
  }), r.every((o) => {
    const { startRow: s, endRow: l } = o;
    for (let a = s; a <= l; a++)
      if (!i[a - t])
        return !1;
    return !0;
  });
}
function ym(r, e) {
  let t = r[0].startColumn, n = r[0].endColumn;
  r.forEach((o) => {
    const { startColumn: s, endColumn: l } = o;
    t = Math.min(t, s), n = Math.max(n, l);
  });
  const i = new Array(n - t + 1).fill(!1);
  return e.forEach((o) => {
    const { startColumn: s, endColumn: l } = o;
    for (let a = Math.max(s, t); a <= Math.min(l, n); a++)
      i[a - t] = !0;
  }), r.every((o) => {
    const { startColumn: s, endColumn: l } = o;
    for (let a = s; a <= l; a++)
      if (!i[a - t])
        return !1;
    return !0;
  });
}
function Gd(r, e) {
  return e ? r === "mergeAll" ? e.filter((t) => !(t.startRow === t.endRow && t.startColumn === t.endColumn)) : r === "mergeVertical" ? e.filter((t) => t.startRow !== t.endRow) : r === "mergeHorizontal" ? e.filter((t) => t.startColumn !== t.endColumn) : e : null;
}
function j1(r) {
  return r.v !== void 0 && r.v !== null && r.v !== "" || r.p !== void 0;
}
const ca = {
  id: "sheet.command.hide-row-confirm",
  type: J.COMMAND,
  handler: async (r) => {
    var a;
    const t = (a = r.get(Q).getCurrentSelections()) == null ? void 0 : a.map((c) => c.range);
    if (!(t != null && t.length)) return !1;
    const n = r.get(W), i = r.get(k), o = Xe(i);
    if (!o) return !1;
    const { worksheet: s } = o, l = s.getVisibleRows();
    if (Im(l, t)) {
      const c = r.get(tn), d = r.get(xe);
      return await c.confirm({
        id: "sheet.confirm.hide-row",
        title: {
          title: d.t("info.problem")
        },
        children: { title: d.t("rightClick.hideAllRowsAlert") },
        cancelText: d.t("button.cancel"),
        confirmText: d.t("button.confirm")
      }), !1;
    }
    return await n.executeCommand(ug.id), !0;
  }
}, da = {
  id: "sheet.command.hide-col-confirm",
  type: J.COMMAND,
  handler: async (r) => {
    var a;
    const t = (a = r.get(Q).getCurrentSelections()) == null ? void 0 : a.map((c) => c.range);
    if (!(t != null && t.length))
      return !1;
    const n = r.get(W), i = r.get(k), o = Xe(i);
    if (!o) return !1;
    const { worksheet: s } = o, l = s.getVisibleCols();
    if (ym(l, t)) {
      const c = r.get(tn), d = r.get(xe);
      return await c.confirm({
        id: "sheet.confirm.hide-col",
        title: {
          title: d.t("info.problem")
        },
        children: { title: d.t("rightClick.hideAllColumnsAlert") },
        cancelText: d.t("button.cancel"),
        confirmText: d.t("button.confirm")
      }), !1;
    }
    return await n.executeCommand(hg.id), !0;
  }
}, Bi = {
  type: J.COMMAND,
  id: "sheet.command.set-range-bold",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(Xp.id) : e.executeCommand(cd.id);
  }
}, Fi = {
  type: J.COMMAND,
  id: "sheet.command.set-range-italic",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(zp.id) : e.executeCommand(dd.id);
  }
}, Ui = {
  type: J.COMMAND,
  id: "sheet.command.set-range-underline",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(jp.id) : e.executeCommand(ud.id);
  }
}, Xi = {
  type: J.COMMAND,
  id: "sheet.command.set-range-stroke",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(Yp.id) : e.executeCommand(hd.id);
  }
}, Mm = {
  type: J.COMMAND,
  id: "sheet.command.set-range-subscript",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(Zp.id) : !1;
  }
}, Em = {
  type: J.COMMAND,
  id: "sheet.command.set-range-superscript",
  handler: async (r) => {
    const e = r.get(W);
    return r.get(De).getContextValue(Je) ? e.executeCommand(Gp.id) : !1;
  }
}, ua = {
  type: J.COMMAND,
  id: "sheet.command.set-range-fontsize",
  handler: async (r, e) => {
    const t = r.get(W);
    return r.get(De).getContextValue(Je) ? t.executeCommand(qp.id, e) : t.executeCommand(gd.id, e);
  }
}, ha = {
  type: J.COMMAND,
  id: "sheet.command.set-range-font-family",
  handler: async (r, e) => {
    const t = r.get(W);
    return r.get(De).getContextValue(Je) ? t.executeCommand(Qp.id, e) : t.executeCommand(md.id, e);
  }
}, Io = {
  type: J.COMMAND,
  id: "sheet.command.set-range-text-color",
  handler: async (r, e) => {
    const t = r.get(W);
    return r.get(De).getContextValue(Je) ? t.executeCommand(Yh.id, e) : t.executeCommand(gg.id, e);
  }
}, qd = {
  type: J.COMMAND,
  id: "sheet.command.reset-range-text-color",
  handler: async (r) => {
    const e = r.get(W), n = r.get(De).getContextValue(Je), i = r.get(Ht);
    return n ? e.executeCommand(Yh.id, { value: null }) : e.executeCommand(gg.id, {
      value: i.getColorFromTheme("gray.900")
    });
  }
}, vi = {
  type: J.COMMAND,
  id: "sheet.command.insert-range-move-down-confirm",
  handler: async (r) => {
    const e = r.get(tn), t = r.get(W), n = r.get(xe), i = r.get(Q), o = r.get(k), s = i.getCurrentSelections();
    if (!s)
      return !1;
    const l = Xe(o);
    if (!l) return !1;
    const { worksheet: a } = l;
    let c = s[0].range;
    if (!c)
      return !1;
    c = { ...c, endRow: a.getRowCount() - 1 };
    for (let g = c.startRow; g <= c.endRow; g++)
      if (a.getRowFiltered(g) && await e.confirm({
        id: vi.id,
        title: { title: n.t("filter.confirm.error") },
        children: { title: n.t("filter.confirm.notAllowedToInsertRange") },
        confirmText: n.t("button.confirm")
      }))
        return !1;
    const d = (g) => g.endColumn - g.startColumn;
    return a.getMergeData().find((g) => {
      const m = se.getIntersects(g, c);
      return m ? d(g) > d(m) : !1;
    }) ? await e.confirm({
      id: vi.id,
      title: { title: n.t("merge.confirm.warning") },
      children: { title: n.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: n.t("button.cancel"),
      confirmText: n.t("button.confirm")
    }) ? t.executeCommand(yc.id) : !0 : t.executeCommand(yc.id);
  }
}, ns = {
  type: J.COMMAND,
  id: "sheet.command.insert-range-move-right-confirm",
  handler: async (r) => {
    const e = r.get(tn), t = r.get(W), n = r.get(xe), i = r.get(Q), o = r.get(k), s = i.getCurrentSelections();
    if (!s)
      return !1;
    const l = Xe(o);
    if (!l) return !1;
    const { worksheet: a } = l;
    let c = s[0].range;
    if (!c)
      return !1;
    c = { ...c, endColumn: a.getColumnCount() - 1 };
    const d = (g) => g.endRow - g.startRow;
    return a.getMergeData().find((g) => {
      const m = se.getIntersects(g, c);
      return m ? d(g) > d(m) : !1;
    }) ? await e.confirm({
      id: ns.id,
      title: { title: n.t("merge.confirm.warning") },
      children: { title: n.t("merge.confirm.dismantleMergeCellWarning") },
      cancelText: n.t("button.cancel"),
      confirmText: n.t("button.confirm")
    }) ? t.executeCommand(Mc.id) : !0 : t.executeCommand(Mc.id);
  }
};
var Tm = /* @__PURE__ */ ((r) => (r[r.UNIVER_UNKNOWN = 0] = "UNIVER_UNKNOWN", r[r.UNIVER_DOC = 1] = "UNIVER_DOC", r[r.UNIVER_SHEET = 2] = "UNIVER_SHEET", r[r.UNIVER_SLIDE = 3] = "UNIVER_SLIDE", r[r.UNIVER_PROJECT = 4] = "UNIVER_PROJECT", r[r.UNRECOGNIZED = -1] = "UNRECOGNIZED", r))(Tm || {}), ae = /* @__PURE__ */ ((r) => (r[r.View = 0] = "View", r[r.Edit = 1] = "Edit", r[r.ManageCollaborator = 2] = "ManageCollaborator", r[r.Print = 3] = "Print", r[r.Duplicate = 4] = "Duplicate", r[r.Comment = 5] = "Comment", r[r.Copy = 6] = "Copy", r[r.Share = 7] = "Share", r[r.Export = 8] = "Export", r[r.MoveWorksheet = 9] = "MoveWorksheet", r[r.DeleteWorksheet = 10] = "DeleteWorksheet", r[r.HideWorksheet = 11] = "HideWorksheet", r[r.RenameWorksheet = 12] = "RenameWorksheet", r[r.CreateWorksheet = 13] = "CreateWorksheet", r[r.SetWorksheetStyle = 14] = "SetWorksheetStyle", r[r.EditWorksheetCell = 15] = "EditWorksheetCell", r[r.InsertHyperlink = 16] = "InsertHyperlink", r[r.Sort = 17] = "Sort", r[r.Filter = 18] = "Filter", r[r.PivotTable = 19] = "PivotTable", r[r.FloatImg = 20] = "FloatImg", r[r.History = 21] = "History", r[r.RwHgtClWdt = 22] = "RwHgtClWdt", r[r.ViemRwHgtClWdt = 23] = "ViemRwHgtClWdt", r[r.ViewFilter = 24] = "ViewFilter", r[r.MoveSheet = 25] = "MoveSheet", r[r.DeleteSheet = 26] = "DeleteSheet", r[r.HideSheet = 27] = "HideSheet", r[r.CopySheet = 28] = "CopySheet", r[r.RenameSheet = 29] = "RenameSheet", r[r.CreateSheet = 30] = "CreateSheet", r[r.SelectProtectedCells = 31] = "SelectProtectedCells", r[r.SelectUnProtectedCells = 32] = "SelectUnProtectedCells", r[r.SetCellStyle = 33] = "SetCellStyle", r[r.SetCellValue = 34] = "SetCellValue", r[r.SetRowStyle = 35] = "SetRowStyle", r[r.SetColumnStyle = 36] = "SetColumnStyle", r[r.InsertRow = 37] = "InsertRow", r[r.InsertColumn = 38] = "InsertColumn", r[r.DeleteRow = 39] = "DeleteRow", r[r.DeleteColumn = 40] = "DeleteColumn", r[r.EditExtraObject = 41] = "EditExtraObject", r[r.Delete = 42] = "Delete", r[r.RecoverHistory = 43] = "RecoverHistory", r[r.ViewHistory = 44] = "ViewHistory", r[r.CreatePermissionObject = 45] = "CreatePermissionObject", r[r.UNRECOGNIZED = -1] = "UNRECOGNIZED", r))(ae || {}), Lt = /* @__PURE__ */ ((r) => (r[r.Reader = 0] = "Reader", r[r.Editor = 1] = "Editor", r[r.Owner = 2] = "Owner", r[r.UNRECOGNIZED = -1] = "UNRECOGNIZED", r))(Lt || {}), yn = /* @__PURE__ */ ((r) => (r[r.Unkonwn = 0] = "Unkonwn", r[r.Workbook = 1] = "Workbook", r[r.Worksheet = 2] = "Worksheet", r[r.SelectRange = 3] = "SelectRange", r[r.Document = 4] = "Document", r[r.Slide = 5] = "Slide", r[r.UNRECOGNIZED = -1] = "UNRECOGNIZED", r))(yn || {}), on = /* @__PURE__ */ ((r) => (r[r.SomeCollaborator = 0] = "SomeCollaborator", r[r.AllCollaborator = 1] = "AllCollaborator", r[r.OneSelf = 2] = "OneSelf", r[r.UNRECOGNIZED = -1] = "UNRECOGNIZED", r))(on || {});
const yo = "UNIVER_SHEET_PERMISSION_PANEL", ga = "UNIVER_SHEET_PERMISSION_USER_PART", Pm = "UNIVER_SHEET_PERMISSION_USER_DIALOG", xm = "UNIVER_SHEET_PERMISSION_DIALOG", il = "UNIVER_SHEET_PERMISSION_USER_DIALOG_ID", ol = "UNIVER_SHEET_PERMISSION_DIALOG_ID", Cs = {
  [ae.Copy]: "Copy",
  [ae.SetCellStyle]: "SetCellStyle",
  [ae.SetCellValue]: "SetCellValue",
  [ae.SetRowStyle]: "SetRowStyle",
  [ae.SetColumnStyle]: "SetColumnStyle",
  [ae.InsertRow]: "InsertRow",
  [ae.InsertColumn]: "InsertColumn",
  [ae.InsertHyperlink]: "InsertHyperlink",
  [ae.DeleteRow]: "DeleteRow",
  [ae.DeleteColumn]: "DeleteColumn",
  [ae.Sort]: "Sort",
  [ae.Filter]: "Filter",
  [ae.PivotTable]: "PivotTable",
  [ae.EditExtraObject]: "EditExtraObject"
}, Y1 = [
  ae.Copy,
  ae.SetCellStyle,
  ae.SetCellValue,
  ae.SetRowStyle,
  ae.SetColumnStyle,
  ae.InsertRow,
  ae.InsertColumn,
  ae.InsertHyperlink,
  ae.DeleteRow,
  ae.DeleteColumn,
  ae.Sort,
  ae.Filter,
  ae.PivotTable,
  ae.EditExtraObject,
  ae.View
], Om = "sheet-permission-menu-icon", Z1 = "sheet-permission-delete-icon", G1 = "sheet-permission-edit-icon", q1 = "sheet-permission-check-icon", Am = "sheet-permission-lock-icon", Q1 = {
  unitId: "",
  subUnitId: "",
  permissionId: "",
  unitType: Dt.SelectRange,
  id: "",
  ranges: [],
  viewState: di.OthersCanView,
  editState: sn.OnlyMe
};
class Rr {
  constructor() {
    _(this, "_rule", Q1);
    _(this, "_visible", !1);
  }
  setVisible(e) {
    this._visible = e;
  }
  getVisible() {
    return this._visible;
  }
  reset() {
    this.setVisible(!1);
  }
}
class Vr {
  constructor() {
    _(this, "_userList", []);
    _(this, "_userList$", new Me(this._userList));
    _(this, "userList$", this._userList$.asObservable());
    _(this, "_oldCollaboratorList", []);
    _(this, "_selectUserList", []);
    _(this, "_selectUserList$", new Me(this._selectUserList));
    _(this, "selectUserList$", this._selectUserList$.asObservable());
  }
  get userList() {
    return this._userList;
  }
  // Set all editable users of this unit
  setCanEditUserList(e) {
    this._userList = e, this._userList$.next(e);
  }
  reset() {
    this._userList = [], this._oldCollaboratorList = [], this._selectUserList = [], this._selectUserList$.next([]);
  }
  get oldCollaboratorList() {
    return this._oldCollaboratorList;
  }
  setOldCollaboratorList(e) {
    this._oldCollaboratorList = e;
  }
  get selectUserList() {
    return this._selectUserList;
  }
  // The results of the user dialog selection panel should be rendered in the permission panel
  setSelectUserList(e) {
    this._selectUserList = e, this._selectUserList$.next(e);
  }
}
const Hn = {
  type: J.OPERATION,
  id: "sheet-permission.operation.openPanel",
  async handler(r, e = {}) {
    const t = r.get(Di), n = r.get(Rr), i = r.get(Vr), { showDetail: o = !0, fromSheetBar: s = !1, rule: l, oldRule: a } = e, c = {
      header: { title: "permission.panel.title" },
      children: {
        label: yo,
        showDetail: o,
        fromSheetBar: s,
        rule: l,
        oldRule: a
      },
      width: 330,
      onClose: () => {
        n.reset(), i.reset();
      }
    };
    return n.setVisible(!0), t.open(c), !0;
  }
}, ma = {
  type: J.COMMAND,
  id: "sheet.command.add-range-protection-from-toolbar",
  async handler(r) {
    return await r.get(W).executeCommand(Hn.id, { showDetail: !0 }), !0;
  }
}, ii = {
  type: J.COMMAND,
  id: "sheet.command.add-range-protection-from-context-menu",
  async handler(r) {
    return await r.get(W).executeCommand(Hn.id, { showDetail: !0 }), !0;
  }
}, oi = {
  type: J.COMMAND,
  id: "sheet.command.view-sheet-permission-from-context-menu",
  async handler(r) {
    return await r.get(W).executeCommand(Hn.id, { showDetail: !1 }), !0;
  }
}, fa = {
  type: J.COMMAND,
  id: "sheet.command.add-range-protection-from-sheet-bar",
  async handler(r) {
    return await r.get(W).executeCommand(Hn.id, { fromSheetBar: !0, showDetail: !0 }), !0;
  }
}, pa = {
  type: J.COMMAND,
  id: "sheet.command.view-sheet-permission-from-sheet-bar",
  async handler(r) {
    return await r.get(W).executeCommand(Hn.id, { showDetail: !1 }), !0;
  }
}, si = {
  type: J.COMMAND,
  id: "sheet.command.delete-range-protection-from-context-menu",
  async handler(r) {
    var u;
    const e = r.get(W), t = r.get(k), n = r.get(Zt), i = r.get(Q), o = r.get(ft), s = t.getCurrentUnitForType(O.UNIVER_SHEET), l = s.getActiveSheet(), a = s.getUnitId(), c = l.getSheetId(), d = o.getRule(a, c);
    if (d != null && d.permissionId)
      return e.executeCommand(Us.id, { unitId: a, subUnitId: c, rule: d });
    {
      const h = (u = i.getCurrentLastSelection()) == null ? void 0 : u.range;
      if (!h)
        return !1;
      const f = r.get($e).getSubunitRuleList(a, c).find((v) => v.ranges.some((p) => se.intersects(p, h)));
      if (f) {
        const v = {
          unitId: a,
          subUnitId: c,
          ruleIds: [f.id]
        };
        return await e.executeCommand(Mu.id, v) && n.pushUndoRedo({
          unitID: a,
          redoMutations: [{ id: Mu.id, params: v }],
          undoMutations: [{ id: Ov.id, params: { unitId: a, subUnitId: c, rules: [f] } }]
        }), !0;
      } else
        return !1;
    }
  }
}, li = {
  type: J.COMMAND,
  id: "sheet.command.set-range-protection-from-context-menu",
  async handler(r) {
    var d;
    const e = r.get(W), t = r.get(k), n = r.get(Q), i = r.get(ft), o = t.getCurrentUnitForType(O.UNIVER_SHEET), s = o.getActiveSheet(), l = o.getUnitId(), a = s.getSheetId(), c = i.getRule(l, a);
    if (c != null && c.permissionId) {
      const u = {
        ...c,
        unitId: l,
        subUnitId: a,
        ranges: []
      };
      return await e.executeCommand(Hn.id, { showDetail: !0, rule: de.deepClone(u), oldRule: de.deepClone(u) }), !0;
    } else {
      const u = (d = n.getCurrentLastSelection()) == null ? void 0 : d.range;
      if (!u)
        return !1;
      const m = r.get($e).getSubunitRuleList(l, a).find((f) => {
        var v;
        return (v = f == null ? void 0 : f.ranges) == null ? void 0 : v.some((p) => se.intersects(p, u));
      });
      if (m) {
        const f = {
          ...m,
          unitId: l,
          subUnitId: a
        };
        return await e.executeCommand(Hn.id, { showDetail: !0, rule: de.deepClone(f), oldRule: de.deepClone(f) }), !0;
      } else
        return !1;
    }
  }
}, va = {
  id: "sheet.command.refill",
  type: J.COMMAND,
  handler: async (r, e) => r.get(Hr).fillData(e.type)
}, Mo = {
  id: "sheet.command.remove-row-confirm",
  type: J.COMMAND,
  handler: async (r, e) => {
    var c;
    const t = r.get(Q);
    let n = e == null ? void 0 : e.range;
    if (n || (n = (c = t.getCurrentLastSelection()) == null ? void 0 : c.range), !n)
      return !1;
    const i = r.get(W), o = r.get(k), s = Xe(o);
    if (!s) return !1;
    const { worksheet: l } = s, a = l.getVisibleRows();
    if (Im(a, [n])) {
      const d = r.get(tn), u = r.get(xe);
      return await d.confirm({
        id: "sheet.confirm.remove-row",
        title: {
          title: u.t("info.problem")
        },
        children: { title: u.t("rightClick.deleteAllRowsAlert") },
        cancelText: u.t("button.cancel"),
        confirmText: u.t("button.confirm")
      }), !1;
    }
    return await i.executeCommand(mg.id, { range: n }), !0;
  }
}, Eo = {
  id: "sheet.command.remove-col-confirm",
  type: J.COMMAND,
  handler: async (r, e) => {
    var c;
    const t = r.get(Q);
    let n = e == null ? void 0 : e.range;
    if (n || (n = (c = t.getCurrentLastSelection()) == null ? void 0 : c.range), !n)
      return !1;
    const i = r.get(W), o = r.get(k), s = Xe(o);
    if (!s) return !1;
    const { worksheet: l } = s, a = l.getVisibleCols();
    if (ym(a, [n])) {
      const d = r.get(tn), u = r.get(xe);
      return await d.confirm({
        id: "sheet.confirm.remove-col",
        title: {
          title: u.t("info.problem")
        },
        children: { title: u.t("rightClick.deleteAllColumnsAlert") },
        cancelText: u.t("button.cancel"),
        confirmText: u.t("button.confirm")
      }), !1;
    }
    return await i.executeCommand(fg.id, { range: n }), !0;
  }
}, Sa = {
  id: "sheet.command.remove-sheet-confirm",
  type: J.COMMAND,
  handler: async (r, e) => {
    const { subUnitId: t } = e, n = r.get(tn), i = r.get(W), o = r.get(xe);
    return await n.confirm({
      id: "sheet.confirm.remove-sheet",
      title: {
        title: o.t("sheetConfig.deleteSheet")
      },
      children: { title: o.t("sheetConfig.deleteSheetContent") },
      cancelText: o.t("button.cancel"),
      confirmText: o.t("button.confirm")
    }) ? (await i.executeCommand(Av.id, { subUnitId: t }), !0) : !1;
  }
};
var K1 = Object.getOwnPropertyDescriptor, J1 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? K1(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Br = (r, e) => (t, n) => e(t, n, r), zt = /* @__PURE__ */ ((r) => (r[r.OFF = 0] = "OFF", r[r.ONCE = 1] = "ONCE", r[r.INFINITE = 2] = "INFINITE", r))(zt || {});
const Dn = Yt("univer.format-painter-service");
let sl = class extends oe {
  constructor(e, t, n, i, o, s) {
    super();
    _(this, "status$");
    _(this, "_selectionFormat");
    _(this, "_markId", null);
    _(this, "_status$");
    _(this, "_defaultHook", null);
    _(this, "_extendHooks", []);
    this._selectionManagerService = e, this._themeService = t, this._markSelectionService = n, this._logService = i, this._commandService = o, this._undoRedoService = s, this._status$ = new Me(
      0
      /* OFF */
    ), this.status$ = this._status$.asObservable(), this._selectionFormat = { styles: new Ge(), merges: [] };
  }
  addHook(e) {
    var t, n, i;
    e.isDefaultHook && ((t = e.priority) != null ? t : 0) > ((i = (n = this._defaultHook) == null ? void 0 : n.priority) != null ? i : -1) ? this._defaultHook = e : (this._extendHooks.push(e), this._extendHooks.sort((o, s) => (o.priority || 0) - (s.priority || 0)));
  }
  getHooks() {
    return this._defaultHook ? [this._defaultHook, ...this._extendHooks] : this._extendHooks;
  }
  setStatus(e) {
    this._updateRangeMark(e), this._status$.next(e), this.getHooks().forEach((n) => {
      n.onStatusChange !== void 0 && n.onStatusChange(e);
    });
  }
  getStatus() {
    return this._status$.getValue();
  }
  setSelectionFormat(e) {
    this._selectionFormat = e;
  }
  getSelectionFormat() {
    return this._selectionFormat;
  }
  applyFormatPainter(e, t, n) {
    const i = this.getHooks(), o = [], s = [];
    i.forEach((a) => {
      if (a.onApply !== void 0) {
        const c = a.onApply(
          e,
          t,
          n,
          this._selectionFormat
        );
        c && (o.push(...c.redos), s.push(...c.undos));
      }
    });
    for (const a of i)
      if (a.onBeforeApply !== void 0 && !a.onBeforeApply({
        unitId: e,
        subUnitId: t,
        range: n,
        redoMutationsInfo: o,
        format: this._selectionFormat,
        undoMutationsInfo: s
      }))
        return !1;
    this._logService.log("[FormatPainterService]", "apply mutations", {
      undoMutationsInfo: s,
      redoMutationsInfo: o
    });
    const l = o.every((a) => this._commandService.executeCommand(a.id, a.params));
    return l && this._undoRedoService.pushUndoRedo({
      unitID: e,
      undoMutations: s,
      redoMutations: o
    }), l;
  }
  _updateRangeMark(e) {
    if (this._markSelectionService.removeAllShapes(), e !== 0) {
      const t = this._selectionManagerService.getCurrentLastSelection();
      if (t) {
        const n = Cm(this._themeService);
        e === 2 ? this._markId = this._markSelectionService.addShape({ ...t, style: n }) : this._markId = this._markSelectionService.addShape({ ...t, style: n }, [
          we.id
        ]);
      }
    }
  }
};
sl = J1([
  Br(0, N(Q)),
  Br(1, N(Ht)),
  Br(2, Wi),
  Br(3, Wl),
  Br(4, W),
  Br(5, Zt)
], sl);
const Ca = {
  id: "sheet.operation.set-format-painter",
  type: J.OPERATION,
  handler: (r, e) => e ? (r.get(Dn).setStatus(e.status), !0) : !1
}, Qd = {
  type: J.COMMAND,
  id: "sheet.command.set-infinite-format-painter",
  handler: async (r) => {
    const t = r.get(Dn).getStatus();
    let n;
    return t !== zt.OFF ? n = zt.OFF : n = zt.INFINITE, r.get(W).executeCommand(Ca.id, { status: n });
  }
}, rs = {
  type: J.COMMAND,
  id: "sheet.command.set-once-format-painter",
  handler: async (r) => {
    const t = r.get(Dn).getStatus();
    let n;
    return t !== zt.OFF ? n = zt.OFF : n = zt.ONCE, r.get(W).executeCommand(Ca.id, { status: n });
  }
}, wa = {
  type: J.COMMAND,
  id: "sheet.command.apply-format-painter",
  handler: async (r, e) => r.get(Dn).applyFormatPainter(e.unitId, e.subUnitId, e.range)
};
var $1 = Object.getOwnPropertyDescriptor, ew = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? $1(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, tw = (r, e) => (t, n) => e(t, n, r);
let Et = class {
  constructor(r, e) {
    /**
     * a map holds all scroll info for each sheet(valid value)
     */
    _(this, "_scrollStateMap", /* @__PURE__ */ new Map());
    /**
     * a subject for current sheet scrollInfo, no limit by viewport.
     */
    _(this, "_rawScrollInfo$", new Me(null));
    /**
     * a subject for current sheet scrollInfo ( events, ex wheel event and point events add deltaXY to rawScrollInfo$)
     */
    _(this, "rawScrollInfo$", this._rawScrollInfo$.asObservable());
    /**
     * a subject for current valid scrollInfo, viewport@_scrollCore would limit rawScrollInfo$ exclude negative value or over max value.
     * use this subject not rawScrollInfo$ when get scrolling state of viewport.
     * The value of this subject is the same as the value of onScrollAfter$
     *
     */
    _(this, "validViewportScrollInfo$", new Me(null));
    /**
     * a subject for current valid scrollInfo, viewport@_scrollCore would limit rawScrollInfo$ exclude negative value or over max value.
     * use this subject not rawScrollInfo$ when get scrolling state of viewport.
     */
    _(this, "_searchParamForScroll", null);
    this._context = r, this._sheetSkeletonManagerService = e;
  }
  dispose() {
    this._rawScrollInfo$.complete();
  }
  calcViewportScrollFromRowColOffset(r) {
    if (!r)
      return {
        viewportScrollX: 0,
        viewportScrollY: 0
      };
    let { sheetViewStartColumn: e, sheetViewStartRow: t, offsetX: n, offsetY: i } = r;
    t = t || 0, i = i || 0;
    const o = this._sheetSkeletonManagerService.getCurrentSkeleton(), s = (o == null ? void 0 : o.rowHeightAccumulation[t - 1]) || 0, a = ((o == null ? void 0 : o.columnWidthAccumulation[e - 1]) || 0) + n, c = s + i;
    return {
      viewportScrollX: a,
      viewportScrollY: c
    };
  }
  setSearchParam(r) {
    this._searchParamForScroll = r;
  }
  getScrollStateByParam(r) {
    return this._getCurrentScroll(r);
  }
  getCurrentScrollState() {
    return this._getCurrentScroll(this._searchParamForScroll);
  }
  setValidScrollState(r) {
    this._setScrollState(r);
  }
  /**
   * emit raw scrollInfo by SetScrollOperation, call by ScrollCommand.id.
   * raw scrollInfo means not handled by limit scroll method.
   * @param param
   */
  emitRawScrollParam(r) {
    this._emitRawScroll(r);
  }
  /**
   * Set _scrollStateMap
   * @param scroll
   */
  setValidScrollStateToCurrSheet(r) {
    if (this._searchParamForScroll == null)
      return;
    this._setScrollState({
      ...this._searchParamForScroll,
      ...r
    });
    const e = this._searchParamForScroll.sheetId, t = this._sheetSkeletonManagerService.getSkeleton(e);
    t && t.setScroll(r.viewportScrollX, r.viewportScrollY);
  }
  clear() {
    this._searchParamForScroll != null && this._clearByParamAndNotify(this._searchParamForScroll);
  }
  /**
   * scroll
   * @param scrollInfo
   */
  _setScrollState(r) {
    const { unitId: e, sheetId: t, sheetViewStartColumn: n, sheetViewStartRow: i, offsetX: o, offsetY: s } = r;
    this._scrollStateMap.has(e) || this._scrollStateMap.set(e, /* @__PURE__ */ new Map());
    const l = this._scrollStateMap.get(e), a = {
      sheetViewStartRow: i,
      sheetViewStartColumn: n,
      offsetX: o,
      offsetY: s
    };
    l.set(t, a);
  }
  _clearByParamAndNotify(r) {
    this._setScrollState({
      ...r,
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    }), this._emitRawScroll({
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    });
  }
  _getCurrentScroll(r) {
    var o;
    const e = {
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0,
      offsetX: 0,
      offsetY: 0
    };
    if (r == null)
      return e;
    const { unitId: t, sheetId: n } = r;
    return ((o = this._scrollStateMap.get(t)) == null ? void 0 : o.get(n)) || e;
  }
  _emitRawScroll(r) {
    this._rawScrollInfo$.next(r);
  }
};
Et = ew([
  tw(1, N(ue))
], Et);
const $n = {
  type: J.COMMAND,
  id: "sheet.command.set-selection-frozen",
  handler: async (r, e) => {
    const { type: t } = e || {}, n = r.get(k), i = r.get(Zt), o = Xe(n);
    if (!o) return !1;
    const { unitId: s, subUnitId: l } = o, a = r.get(W), d = r.get(Q).getCurrentSelections();
    if (!d)
      return !1;
    const u = d[(d == null ? void 0 : d.length) - 1], { range: h } = u, m = r.get(fe).getRenderById(s).with(Et), { sheetViewStartRow: f = 0, sheetViewStartColumn: v = 0 } = m.getCurrentScrollState() || {};
    let p, S, w, C;
    const { startRow: I, startColumn: R, rangeType: y } = h;
    if (y === z.ROW || t === 1)
      p = I, w = I - f, S = -1, C = 0;
    else if (y === z.COLUMN || t === 2)
      p = -1, w = 0, S = R, C = R - v;
    else if (y === z.NORMAL)
      p = I, w = I - f, S = R, C = R - v;
    else
      return !1;
    const M = {
      unitId: s,
      subUnitId: l,
      startRow: p,
      startColumn: S,
      xSplit: S > 0 ? Math.max(1, C) : C,
      ySplit: p > 0 ? Math.max(1, w) : w
    }, E = pg(r, M);
    return a.syncExecuteCommand(fr.id, M) && i.pushUndoRedo({
      unitID: s,
      undoMutations: [{ id: fr.id, params: E }],
      redoMutations: [{ id: fr.id, params: M }]
    }), !0;
  }
}, ba = {
  type: J.COMMAND,
  id: "sheet.command.set-row-frozen",
  handler: async (r) => (r.get(W).executeCommand($n.id, {
    type: 1
    /* Row */
  }), !0)
}, _a = {
  type: J.COMMAND,
  id: "sheet.command.set-col-frozen",
  handler: async (r) => (r.get(W).executeCommand($n.id, {
    type: 2
    /* Column */
  }), !0)
};
class Kd extends oe {
  constructor() {
    super(...arguments);
    _(this, "rangesStack", []);
    _(this, "selectedRangeWorksheet", "");
  }
}
var nw = Object.getOwnPropertyDescriptor, rw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? nw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, sh = (r, e) => (t, n) => e(t, n, r);
let Si = class {
  constructor(r, e) {
    _(this, "_current", null);
    _(this, "_shortcutParam", []);
    this._univerInstanceService = r, this._localeService = e;
  }
  dispose() {
    this._shortcutParam = [];
  }
  getCurrentBySearch(r) {
    return this._getCurrentBySearch(r);
  }
  getCurrent() {
    return this._getCurrentBySearch(this._current);
  }
  addOrUpdate(r) {
    const e = this._getCurrentBySearch({
      unitId: r.unitId,
      sheetId: r.sheetId,
      keycode: r.keycode
    });
    if (e != null) {
      const t = this._shortcutParam.indexOf(e);
      this._shortcutParam.splice(t, 1);
    }
    return this._shortcutParam.push(r), e;
  }
  remove(r) {
    if (r == null)
      return;
    const e = this._getCurrentBySearch(r);
    if (e == null)
      return;
    const t = this._shortcutParam.indexOf(e);
    return this._shortcutParam.splice(t, 1)[0];
  }
  _getCurrentBySearch(r) {
    return r == null ? void 0 : this._shortcutParam.find(
      (t) => t.unitId === r.unitId && t.sheetId === r.sheetId && t.keycode === r.keycode
    );
  }
};
Si = rw([
  sh(0, k),
  sh(1, N(xe))
], Si);
var Ln = /* @__PURE__ */ ((r) => (r[r.moveStopeOne = 0] = "moveStopeOne", r[r.moveGap = 1] = "moveGap", r[r.moveStepPage = 2] = "moveStepPage", r[r.moveStepEnd = 3] = "moveStepEnd", r))(Ln || {});
const Ut = {
  id: "sheet.command.move-selection",
  type: J.COMMAND,
  handler: (r, e) => {
    if (!e)
      return !1;
    const t = Xe(r.get(k));
    if (!t) return !1;
    const { workbook: n, worksheet: i } = t, o = Uo(r, e.fromCurrentSelection).getCurrentLastSelection();
    if (!o)
      return !1;
    const { direction: s, jumpOver: l, extra: a } = e, { range: c, primary: d } = o, u = zc(c, d, s), h = l === 1 ? Zd(u, s, i) : qn(u, s, i), g = Ps(h.startRow, h.startColumn, i);
    if (se.equals(g, u))
      return !1;
    const m = n.getUnitId();
    r.get(Si).remove({
      unitId: m,
      sheetId: i.getSheetId(),
      keycode: Y.TAB
    });
    const f = [
      {
        range: se.clone(g),
        primary: {
          startRow: g.startRow,
          startColumn: g.startColumn,
          endRow: g.endRow,
          endColumn: g.endColumn,
          actualRow: h.startRow,
          actualColumn: h.startColumn,
          isMerged: g.isMerged,
          isMergedMainCell: g.startRow === h.startRow && g.startColumn === h.startColumn
        }
      }
    ];
    return r.get(W).executeCommand(Ie.id, {
      unitId: n.getUnitId(),
      subUnitId: i.getSheetId(),
      selections: f,
      type: At.MOVE_END,
      extra: a,
      reveal: !0
    });
  }
}, Wn = {
  id: "sheet.command.move-selection-enter-tab",
  type: J.COMMAND,
  // eslint-disable-next-line max-lines-per-function, complexity
  handler: (r, e) => {
    var V;
    if (!e)
      return !1;
    const t = Xe(r.get(k));
    if (!t) return !1;
    const { workbook: n, worksheet: i } = t, o = Uo(r), { direction: s, keycode: l } = e, a = s === U.LEFT || s === U.UP, c = o.getCurrentSelections().concat(), d = c.findIndex((D) => D.primary), u = c[d];
    if (!u)
      return !1;
    const h = a ? -1 : 1, g = d + h !== c.length ? c[d + h] : c[0], m = c.findIndex((D) => D === g), f = n.getUnitId(), v = i.getSheetId();
    if (!u)
      return !1;
    const { range: p } = u, S = u.primary;
    let w = zc(p, S, s);
    const C = r.get(Si), I = C.getCurrentBySearch({
      unitId: f,
      sheetId: v,
      keycode: Y.TAB
    });
    let R;
    const { startRow: y, endRow: M, startColumn: E, endColumn: T } = p, P = a ? S.startRow === y && S.startColumn === E : S.endRow === M && S.endColumn === T;
    if (se.equals(p, S)) {
      if (l === Y.TAB)
        I == null && C.addOrUpdate({
          unitId: f,
          sheetId: v,
          keycode: Y.TAB,
          selection: u
        });
      else {
        const B = I == null ? void 0 : I.selection;
        if (B != null) {
          const { range: j, primary: G } = B;
          w = zc(j, G, s);
        }
        C.remove({
          unitId: f,
          sheetId: v,
          keycode: Y.TAB
        });
      }
      const D = qn(w, s, i), X = Ps(D.startRow, D.startColumn, i);
      if (se.equals(X, w))
        return !1;
      R = {
        range: se.clone(X),
        primary: {
          startRow: X.startRow,
          startColumn: X.startColumn,
          endRow: X.endRow,
          endColumn: X.endColumn,
          actualRow: D.startRow,
          actualColumn: D.startColumn,
          isMerged: X.isMerged,
          isMergedMainCell: X.startRow === D.startRow && X.startColumn === D.startColumn
        }
      };
    } else {
      C.remove({
        unitId: f,
        sheetId: v,
        keycode: Y.TAB
      });
      const D = de.deepClone(S), X = P ? g.range : qn(
        {
          startRow: D.startRow,
          startColumn: D.startColumn,
          endRow: D.endRow,
          endColumn: D.endColumn
        },
        s,
        i,
        {
          startRow: y,
          endRow: M,
          startColumn: E,
          endColumn: T
        }
      ), B = P && a, j = B ? Ps(X.endRow, X.endColumn, i) : Ps(X.startRow, X.startColumn, i);
      R = {
        range: P ? g.range : se.clone(p),
        primary: {
          startRow: j.startRow,
          startColumn: j.startColumn,
          endRow: j.endRow,
          endColumn: j.endColumn,
          actualRow: B ? j.startRow : X.startRow,
          actualColumn: B ? j.startColumn : X.startColumn,
          isMerged: j.isMerged,
          isMergedMainCell: j.startRow === X.startRow && j.startColumn === X.startColumn
        },
        style: P ? g.style : u.style
      };
    }
    P ? (c[d].primary = null, c[m] = R, o.setSelections(f, v, [], At.MOVE_END)) : c[d] = R;
    const H = r.get(W).executeCommand(Ie.id, {
      unitId: f,
      subUnitId: v,
      type: At.MOVE_END,
      selections: c,
      reveal: !0,
      extra: e.extra
    }), x = (V = r.get(fe).getRenderById(f)) == null ? void 0 : V.with(gt);
    return x == null || x.refreshSelectionMoveEnd(), H;
  }
}, Gt = {
  id: "sheet.command.expand-selection",
  type: J.COMMAND,
  handler: (r, e) => {
    if (!e) return !1;
    const t = Xe(r.get(k));
    if (!t) return !1;
    const { worksheet: n, unitId: i, subUnitId: o } = t, s = Uo(r).getCurrentLastSelection();
    if (!s) return !1;
    const { range: l, primary: a } = s, { jumpOver: c, direction: d, extra: u } = e, g = z1(s, d, n) ? c === 1 ? U1(
      l,
      { ...se.clone(a), rangeType: z.NORMAL },
      d,
      n
    ) : X1(l, d, n) : c === 1 ? B1(l, d, n) : F1(l, d, n);
    return g.rangeType = s.range.rangeType, se.equals(g, l) ? !1 : r.get(W).syncExecuteCommand(Ie.id, {
      unitId: i,
      subUnitId: o,
      type: At.MOVE_END,
      selections: [
        {
          range: g,
          primary: a
          // this remains unchanged
        }
      ],
      extra: u,
      reveal: !0
    });
  }
}, Ra = {
  id: "sheet.command.select-all",
  type: J.COMMAND,
  // eslint-disable-next-line max-lines-per-function
  handler: async (r, e = { expandToGapFirst: !0, loop: !1 }) => {
    const t = Xe(r.get(k));
    if (!t) return !1;
    const n = Uo(r).getCurrentLastSelection();
    if (!n) return !1;
    const i = r.get(Kd), { worksheet: o, unitId: s, subUnitId: l } = t, a = `${s}|${l}`;
    a !== i.selectedRangeWorksheet && (i.rangesStack = [], i.selectedRangeWorksheet = a);
    const c = o.getMaxRows(), d = o.getMaxColumns(), { expandToGapFirst: u, loop: h } = e, { range: g, primary: m } = n, f = g.endColumn === d - 1 && g.endRow === c - 1 && g.startRow === 0 && g.startColumn === 0;
    i.rangesStack.some((I) => se.equals(I, g)) || (i.rangesStack = [], i.rangesStack.push(g));
    let v;
    if (f)
      if (h) {
        if (i.rangesStack.findIndex((R) => se.equals(R, g)) !== i.rangesStack.length - 1)
          return !1;
        v = i.rangesStack[0];
      } else
        return !1;
    else u ? (v = Hv(g, { left: !0, right: !0, up: !0, down: !0 }, o), se.equals(v, g) && (v = oh(o))) : v = oh(o);
    i.rangesStack.some((I) => se.equals(I, v)) || i.rangesStack.push(v);
    const p = [];
    p.push({
      id: Ie.id,
      params: {
        unitId: s,
        subUnitId: l,
        reveal: !0,
        selections: [
          {
            range: v,
            primary: m
            // this remains unchanged
          }
        ]
      }
    });
    const w = r.get(vn).onCommandExecute({
      id: Ra.id,
      params: { range: g }
    });
    w.redos.length && p.push(...w.redos);
    const C = r.get(W);
    return Wo(p, C), !0;
  }
};
function iw(r) {
  return typeof r.isMainScene > "u";
}
function en(r, e) {
  const t = r instanceof gv ? r : r.getCurrentUnitForType(O.UNIVER_SHEET);
  if (!t) return null;
  const n = t.getUnitId();
  let i, o, s, l;
  if (iw(e)) {
    const h = e.getRenderById(n);
    if (h == null) return null;
    i = h.components, i = h.components, o = h.mainComponent, s = h.scene, l = h.engine;
  } else
    i = e.components, o = e.mainComponent, s = e.scene, l = e.engine;
  if (!i || !o) return null;
  const a = o, c = i.get(Ye.ROW), d = i.get(Ye.COLUMN), u = i.get(Ye.LEFT_TOP);
  return {
    spreadsheet: a,
    spreadsheetRowHeader: c,
    spreadsheetColumnHeader: d,
    spreadsheetLeftTopPlaceholder: u,
    scene: s,
    engine: l
  };
}
function lh(r, e, t, n) {
  const { startX: i, startY: o, endX: s, endY: l } = n.getCellWithCoordByIndex(r, e);
  return { startX: i, startY: o, endX: s, endY: l };
}
function Vn(r, e, t, n, i, o) {
  const s = t.getCoordRelativeToViewport(ke.FromArray([r, e])), { x: l, y: a } = s, c = t.getScrollXYInfoByViewport(s, i), { scaleX: d, scaleY: u } = t.getAncestorScale(), h = n.getCellIndexByOffset(
    l,
    a,
    d,
    u,
    c,
    { closeFirst: o }
  ), { row: g, column: m } = h, f = n.getNoMergeCellWithCoordByIndex(g, m), { startX: v, startY: p, endX: S, endY: w } = f;
  return {
    startX: v,
    startY: p,
    endX: S,
    endY: w,
    row: g,
    column: m
  };
}
function Os(r, e, t, n) {
  const i = t.getCoordRelativeToViewport(ke.FromArray([r, e])), o = t.getViewport(F.VIEW_MAIN), s = t.getScrollXYInfoByViewport(i, o), { scaleX: l, scaleY: a } = t.getAncestorScale(), { x: c, y: d } = s, u = r / l + c, h = e / a + d;
  return { x: u, y: h };
}
var ow = Object.getOwnPropertyDescriptor, sw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ow(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Fr = (r, e) => (t, n) => e(t, n, r);
Ut.id, Wn.id;
const lw = 3;
let Ci = class extends oe {
  constructor(r, e, t, n, i, o, s) {
    super(), this._context = r, this._injector = e, this._sheetSkeletonManagerService = t, this._contextService = n, this._commandService = i, this._renderManagerService = o, this._scrollManagerService = s, this._initCommandListener(), this._wheelEventListener(), this._scrollBarEventListener(), this._initSkeletonListener();
  }
  _wheelEventListener() {
    const { scene: r } = this._context;
    if (!r) return;
    const e = r.getViewport(F.VIEW_MAIN);
    e && this.disposeWithMe(
      r.onMouseWheel$.subscribeEvent((t, n) => {
        if (t.ctrlKey || !this._contextService.getContextValue(Nt))
          return;
        let i = 0, o = 0;
        i = t.deltaX, t.shiftKey ? i = (t.deltaY || t.deltaX) * lw : o = t.deltaY, this._commandService.executeCommand(To.id, { offsetX: i, offsetY: o }), this._context.scene.makeDirty(!0);
        const s = e.limitedScroll(e.scrollX + i, e.scrollY + o);
        s && !s.isLimitedX && !s.isLimitedY && (t.preventDefault(), r.getParent().classType === NS.SCENE_VIEWER && n.stopPropagation()), e.isWheelPreventDefaultX && e.isWheelPreventDefaultY && t.preventDefault();
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function
  _scrollBarEventListener() {
    const { scene: r } = this._context;
    if (r == null) return;
    const e = r.getViewport(F.VIEW_MAIN);
    e && (this.disposeWithMe(
      We(
        this._scrollManagerService.rawScrollInfo$.subscribe((t) => {
          var g;
          const n = (g = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : g.skeleton;
          if (!n) return;
          if (t == null) {
            e.scrollToViewportPos({
              viewportScrollX: 0,
              viewportScrollY: 0
            });
            return;
          }
          const { sheetViewStartRow: i, sheetViewStartColumn: o, offsetX: s, offsetY: l, duration: a } = t, { startX: c, startY: d } = n.getCellWithCoordByIndex(
            i,
            o,
            !1
          ), u = c + s, h = d + l;
          e.scrollAnimationFrameId !== null && cancelAnimationFrame(e.scrollAnimationFrameId), a ? this._smoothScrollToViewportPos({ viewportMain: e, viewportScrollX: u, viewportScrollY: h, duration: a }) : e.scrollToViewportPos({ viewportScrollX: u, viewportScrollY: h });
        })
      )
    ), this.disposeWithMe(
      // set scrollInfo, the event is triggered in viewport@_scrollToScrollbarPos
      e.onScrollAfter$.subscribeEvent((t) => {
        var m;
        const n = (m = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : m.skeleton;
        if (n == null || t.isTrigger === !1)
          return;
        const i = this._getSheetObject();
        if (n == null || i == null)
          return;
        const { viewportScrollX: o, viewportScrollY: s, scrollX: l, scrollY: a } = t, { row: c, column: d, rowOffset: u, columnOffset: h } = n.getOffsetRelativeToRowCol(
          o,
          s
        ), g = {
          sheetViewStartRow: c,
          sheetViewStartColumn: d,
          offsetX: h,
          offsetY: u,
          viewportScrollX: o,
          viewportScrollY: s,
          scrollX: l,
          scrollY: a
        };
        this._scrollManagerService.setValidScrollStateToCurrSheet(g), this._scrollManagerService.validViewportScrollInfo$.next({
          ...g,
          viewportScrollX: o,
          viewportScrollY: s,
          scrollX: l,
          scrollY: a
        });
      })
    ), this.disposeWithMe(
      // get scrollByBar event from viewport and exec ScrollCommand.id.
      e.onScrollByBar$.subscribeEvent((t) => {
        var u;
        const n = (u = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : u.skeleton;
        if (n == null || t.isTrigger === !1)
          return;
        const i = this._getSheetObject();
        if (n == null || i == null)
          return;
        const { viewportScrollX: o = 0, viewportScrollY: s = 0 } = t;
        this._getFreeze();
        const { row: l, column: a, rowOffset: c, columnOffset: d } = n.getOffsetRelativeToRowCol(
          o,
          s
        );
        this._commandService.executeCommand(mn.id, {
          sheetViewStartRow: l,
          sheetViewStartColumn: a,
          offsetX: d,
          offsetY: c
        });
      })
    ));
  }
  _initSkeletonListener() {
    this.disposeWithMe(We(
      this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe((r) => {
        if (r == null)
          return;
        const e = { unitId: r.unitId, sheetId: r.sheetId };
        if (this._scrollManagerService.setSearchParam(e), !this._getSheetObject()) return;
        const n = this._scrollManagerService.getScrollStateByParam(e), { viewportScrollX: i, viewportScrollY: o } = this._scrollManagerService.calcViewportScrollFromRowColOffset(n);
        n && this._updateViewportScroll(i, o);
      })
    ));
  }
  _smoothScrollToViewportPos(r) {
    const { viewportMain: e, viewportScrollX: t, viewportScrollY: n, duration: i } = r, o = performance.now(), s = e.viewportScrollX, l = e.viewportScrollY, a = t - s, c = n - l;
    function d(u) {
      const h = u - o, g = Math.min(h / i, 1), m = 1 - (1 - g) ** 3, f = s + a * m, v = l + c * m;
      e.scrollToViewportPos({
        viewportScrollX: f,
        viewportScrollY: v
      }), g < 1 ? e.scrollAnimationFrameId = requestAnimationFrame(d) : e.scrollAnimationFrameId = null;
    }
    e.scrollAnimationFrameId = requestAnimationFrame(d);
  }
  _updateViewportScroll(r = 0, e = 0) {
    const t = this._getSheetObject();
    if (!t) return;
    const n = t.scene, i = n.getViewport(F.VIEW_MAIN), o = n.getViewport(F.VIEW_COLUMN_RIGHT), s = n.getViewport(F.VIEW_ROW_BOTTOM), l = n.getViewport(F.VIEW_MAIN_LEFT), a = n.getViewport(F.VIEW_MAIN_TOP);
    i && (i.viewportScrollX = r, i.viewportScrollY = e), s && (s.viewportScrollY = e), o && (o.viewportScrollX = r), l && (l.viewportScrollY = e), a && (a.viewportScrollX = r);
  }
  scrollToRange(r, e, t) {
    let { endRow: n, endColumn: i, startColumn: o, startRow: s } = r;
    const l = this._getViewportBounding();
    if (r.rangeType === z.ROW ? (o = 0, i = 0) : r.rangeType === z.COLUMN && (s = 0, n = 0), l && !e && !t) {
      const a = l.startRow > n ? s : n, c = l.startColumn > i ? o : i;
      return this._scrollToCell(a, c);
    } else
      return this._scrollToCell(s, o, e, t);
  }
  /**
   * Scroll spreadsheet(viewMain) to cell position. Based on the limitations of viewport and the number of rows and columns, you can only scroll to the maximum scrollable range.
   *
   * if column A ~ B is frozen. set second param to 0 would make viewMain start at column C.
   * set second param to 2 would make viewMain start at column E.
   * @param {number} row - Cell row
   * @param {number} column - Cell column
   * @returns {boolean} - true if scroll is successful
   */
  scrollToCell(r, e, t) {
    const n = this._context.unit.getActiveSheet(), {
      ySplit: i,
      xSplit: o
    } = n.getFreeze();
    return this._commandService.syncExecuteCommand(mn.id, {
      sheetViewStartRow: r - i,
      sheetViewStartColumn: e - o,
      offsetX: 0,
      offsetY: 0,
      duration: t
    });
  }
  _initCommandListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((r) => {
      switch (r.id) {
        case Ie.id:
          {
            const e = r.params;
            e.unitId === this._context.unitId && e.reveal && this._scrollToSelection();
          }
          break;
        case fd.id:
          {
            const e = r.params;
            if (e.unitId === this._context.unitId) {
              const t = e.range;
              this.scrollToRange(t);
            }
          }
          break;
        case Gt.id:
          {
            const e = r.params;
            this._scrollToSelectionForExpand(e);
          }
          break;
      }
    }));
  }
  _scrollToSelectionForExpand(r) {
    setTimeout(() => {
      const e = this._getSelectionsService().getCurrentLastSelection();
      if (e == null)
        return;
      const { startRow: t, startColumn: n, endRow: i, endColumn: o } = e.range, s = this._getViewportBounding();
      if (s == null)
        return;
      const { startRow: l, startColumn: a, endRow: c, endColumn: d } = s;
      let u = 0, h = 0;
      t > l ? u = i : i < c ? u = t : u = l, n > a ? h = o : o < d ? h = n : h = a, r.direction === U.DOWN ? u = i : r.direction === U.UP ? u = t : r.direction === U.RIGHT ? h = o : r.direction === U.LEFT && (h = n), this._scrollToCell(u, h);
    }, 0);
  }
  _getFreeze() {
    var e;
    const r = (e = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : e.skeleton.getWorksheetConfig();
    if (r != null)
      return r.freeze;
  }
  _updateSceneSize(r) {
    var d;
    if (r == null)
      return;
    const { unitId: e } = this._context, { skeleton: t } = r, n = (d = this._renderManagerService.getRenderById(e)) == null ? void 0 : d.scene;
    if (t == null || n == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o, rowHeaderWidthAndMarginLeft: s, columnHeaderHeightAndMarginTop: l } = t;
    this._context.unit.getActiveSheet() && (n == null || n.transformByState({
      width: s + o,
      height: l + i
    }));
  }
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  _scrollToSelectionByDirection(r) {
    const e = this._getViewportBounding();
    if (e == null)
      return !1;
    const {
      startRow: t,
      startColumn: n,
      endRow: i,
      endColumn: o
    } = e;
    let s = 0, l = 0;
    const { startRow: a, startColumn: c, endRow: d, endColumn: u } = r;
    a >= t && (s = d), d <= i && (s = a), c >= n && (l = u), u <= o && (l = c), this._scrollToCell(s, l);
  }
  _scrollToSelection(r = !0) {
    var a;
    const e = this._getSelectionsService().getCurrentLastSelection();
    if (!e) return;
    const { startRow: t, startColumn: n, actualRow: i, actualColumn: o } = (a = e.primary) != null ? a : e.range, s = r && i != null ? i : t, l = r && o != null ? o : n;
    this._scrollToCell(s, l);
  }
  _getSelectionsService() {
    return Uo(this._injector);
  }
  _getViewportBounding() {
    var i, o;
    const r = (i = this._getSheetObject()) == null ? void 0 : i.scene;
    if (r == null)
      return;
    const e = r.getViewport(F.VIEW_MAIN);
    if (e == null)
      return;
    const t = (o = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : o.skeleton;
    if (t == null)
      return;
    const n = e.calcViewportInfo();
    return t.getRangeByViewBound(n.viewBound);
  }
  // For arrow key to active cell cause scrolling.
  // eslint-disable-next-line max-lines-per-function, complexity
  _scrollToCell(r, e, t = !1, n = !1) {
    var E, T, P;
    const { rowHeightAccumulation: i, columnWidthAccumulation: o } = (E = this._sheetSkeletonManagerService.getCurrentSkeleton()) != null ? E : {};
    if (i == null || o == null) return !1;
    const s = (T = this._getSheetObject()) == null ? void 0 : T.scene;
    if (s == null) return !1;
    const l = s.getViewport(F.VIEW_MAIN);
    if (l == null) return !1;
    const a = (P = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : P.skeleton;
    if (a == null) return !1;
    const c = this._context.unit.getActiveSheet();
    if (!c) return !1;
    r = de.clamp(r, 0, i.length - 1), e = de.clamp(e, 0, o.length - 1);
    const {
      startColumn: d,
      startRow: u,
      ySplit: h,
      xSplit: g
    } = c.getFreeze(), m = this._getViewportBounding();
    if (m == null) return !1;
    const {
      startRow: f,
      startColumn: v,
      endRow: p,
      endColumn: S
    } = m;
    let w, C;
    if (r >= u && e >= d - h && (r <= f && (w = r, t = !0), r >= p)) {
      const H = i[r] - l.height;
      for (let A = f; A <= r && (w = A + 1, !(i[A] >= H)); A++)
        ;
    }
    if (e >= d && r >= u - h && (e <= v && (C = e, n = !0), e >= S)) {
      const H = o[e] - l.width;
      for (let A = v; A <= e && (C = A + 1, !(o[A] >= H)); A++)
        ;
    }
    if (w === void 0 && C === void 0) return !1;
    let { offsetX: I, offsetY: R, sheetViewStartRow: y, sheetViewStartColumn: M } = this._scrollManagerService.getCurrentScrollState() || {};
    if (w = w ? Math.min(w, r) : y + h, C = C ? Math.min(C, e) : M + g, n) {
      I = 0, C = e;
      const H = a.getHiddenColumnsInRange({ startColumn: C - g, endColumn: C });
      C = C - H.length;
    }
    if (t) {
      R = 0, w = r;
      const H = a.getHiddenRowsInRange({ startRow: w - h, endRow: w });
      w = w - H.length;
    }
    return this._commandService.syncExecuteCommand(mn.id, {
      // sheetViewStartRow & offsetX should never be undefined, it's rendering, there should always be a value!
      // sheetViewStartRow: forceTop ? Math.max(0, row - freezeYSplit) : ((startSheetViewRow ?? 0) - freezeYSplit),
      // sheetViewStartColumn: forceLeft ? Math.max(0, column - freezeXSplit) : ((startSheetViewColumn ?? 0) - freezeXSplit),
      // offsetX: startSheetViewColumn === undefined ? offsetX : 0,
      // offsetY: startSheetViewRow === undefined ? offsetY : 0,
      sheetViewStartRow: Math.max(0, w - h),
      sheetViewStartColumn: Math.max(0, C - g),
      offsetX: I,
      offsetY: R
    });
  }
};
Ci = sw([
  Fr(1, N(Rt)),
  Fr(2, N(ue)),
  Fr(3, De),
  Fr(4, W),
  Fr(5, fe),
  Fr(6, N(Et))
], Ci);
const gn = {
  id: "sheet.operation.set-scroll",
  type: J.OPERATION,
  handler: (r, e) => {
    if (!e)
      return !1;
    const { unitId: t, sheetId: n, offsetX: i = 0, offsetY: o = 0, sheetViewStartColumn: s, sheetViewStartRow: l, duration: a, screenRatioX: c, screenRatioY: d } = e, u = r.get(fe), h = u.getRenderById(t).with(Et), g = u.getRenderById(t);
    if (!g)
      return !1;
    const m = g.engine, f = m.width, v = m.height, p = c !== void 0 ? f * c + i : i, S = d !== void 0 ? v * d + o : o;
    return h.emitRawScrollParam({
      unitId: t,
      sheetId: n,
      offsetX: p,
      offsetY: S,
      sheetViewStartRow: l,
      sheetViewStartColumn: s,
      duration: a
    }), !0;
  }
}, To = {
  id: "sheet.command.set-scroll-relative",
  type: J.COMMAND,
  // offsetXY derived from mouse wheel event
  // this._commandService.executeCommand(SetScrollRelativeCommand.id, { offsetY });
  handler: async (r, e) => {
    const t = r.get(W), n = r.get(k), i = r.get(fe), o = Xe(n);
    if (!o) return !1;
    const { unitId: s, subUnitId: l } = o, c = i.getRenderById(s).with(Et).getCurrentScrollState(), { offsetX: d = 0, offsetY: u = 0 } = e || {}, {
      sheetViewStartRow: h = 0,
      sheetViewStartColumn: g = 0,
      offsetX: m = 0,
      offsetY: f = 0
    } = c || {};
    return t.executeCommand(gn.id, {
      unitId: s,
      sheetId: l,
      // why + ySplit? receiver - ySplit in scroll.operation.ts
      // sheetViewStartRow: sheetViewStartRow + ySplit,
      // sheetViewStartColumn: sheetViewStartColumn + xSplit,
      sheetViewStartRow: h,
      sheetViewStartColumn: g,
      offsetX: m + d,
      // currentOffsetX + offsetX may be negative or over max
      offsetY: f + u
    });
  }
}, mn = {
  id: "sheet.command.scroll-view",
  type: J.COMMAND,
  handler: (r, e) => {
    if (!e)
      return !1;
    const t = r.get(k), n = r.get(fe), i = Xe(t);
    if (!i) return !1;
    const { workbook: o, worksheet: s, unitId: l } = i, c = n.getRenderById(l).with(Et).getCurrentScrollState();
    if (!s)
      return !1;
    const { sheetViewStartRow: d, sheetViewStartColumn: u, offsetX: h, offsetY: g, duration: m } = e, {
      sheetViewStartColumn: f,
      sheetViewStartRow: v,
      offsetX: p,
      offsetY: S
    } = c || {}, { xSplit: w, ySplit: C } = i.worksheet.getConfig().freeze;
    return r.get(W).syncExecuteCommand(gn.id, {
      unitId: o.getUnitId(),
      sheetId: s.getSheetId(),
      // why + ySplit? receiver - ySplit in scroll.operation.ts
      // sheetViewStartRow: sheetViewStartRow + ySplit,
      // sheetViewStartColumn: sheetViewStartColumn + xSplit,
      sheetViewStartRow: d != null ? d : v != null ? v : 0 + C,
      sheetViewStartColumn: u != null ? u : f != null ? f : 0 + w,
      offsetX: h != null ? h : p,
      offsetY: g != null ? g : S,
      duration: m
    });
  }
}, Hm = {
  id: "sheet.command.scroll-to-cell",
  type: J.COMMAND,
  handler: (r, e) => {
    const t = r.get(k);
    return r.get(fe).getRenderById(t.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId()).with(Ci).scrollToRange(e.range, e.forceTop, e.forceLeft);
  }
}, Zy = {
  id: "sheet.command.scroll-view-reset",
  type: J.COMMAND,
  handler: async (r) => {
    const e = r.get(k), t = Xe(e);
    if (!t) return !1;
    const { subUnitId: n, unitId: i } = t;
    return r.get(W).executeCommand(gn.id, {
      unitId: i,
      sheetId: n,
      sheetViewStartRow: 0,
      sheetViewStartColumn: 0
    });
  }
};
var aw = Object.getOwnPropertyDescriptor, cw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? aw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ah = (r, e) => (t, n) => e(t, n, r);
const dw = (r, e) => {
  const { unitId: t, subUnitId: n, ranges: i } = r, o = {}, s = e.getColumnManager();
  for (let l = 0; l < i.length; l++) {
    const a = i[l];
    for (let c = a.startColumn; c < a.endColumn + 1; c++)
      o[c] = s.getColumnWidth(c);
  }
  return {
    unitId: t,
    subUnitId: n,
    ranges: i,
    colWidth: o
  };
};
let Ir = class extends oe {
  constructor(r, e) {
    super(), this._renderManagerService = r, this._univerInstanceService = e;
  }
  getUndoRedoParamsOfColWidth(r) {
    const e = { redos: [], undos: [] }, { _univerInstanceService: t } = this, n = Xe(t);
    if (!n) return e;
    const { unitId: i, subUnitId: o, worksheet: s } = n, l = this._renderManagerService.getRenderById(i).with(ue);
    if (!l.getCurrentParam()) return e;
    const { skeleton: a } = l.getCurrentParam(), c = a.calculateAutoWidthInRange(r.ranges), d = {};
    for (const { col: g, width: m } of c)
      d[g] = m;
    const u = {
      subUnitId: o,
      unitId: i,
      ranges: r.ranges,
      colWidth: d
    }, h = dw(u, s);
    return {
      undos: [
        {
          id: ln.id,
          params: h
        }
      ],
      redos: [
        {
          id: ln.id,
          params: u
        }
      ]
    };
  }
};
Ir = cw([
  ah(0, fe),
  ah(1, N(k))
], Ir);
const is = {
  type: J.COMMAND,
  id: "sheet.command.set-col-auto-width",
  handler: (r, e) => {
    const t = r.get(W), n = r.get(Zt), i = r.get(Q), o = r.get(k), s = Xe(o, e);
    if (!s) return !1;
    const { unitId: l, subUnitId: a } = s;
    let c = [];
    if (e != null && e.ranges)
      c = [...e.ranges];
    else {
      const m = i.getCurrentSelections();
      for (let f = 0; f < m.length; f++)
        c.push(m[f].range);
    }
    if (!(c != null && c.length))
      return !1;
    const d = {
      unitId: l,
      subUnitId: a,
      ranges: c
    }, { redos: u, undos: h } = r.get(Ir).getUndoRedoParamsOfColWidth(d);
    return Wo([...u], t).result ? (n.pushUndoRedo({
      unitID: l,
      undoMutations: [...h],
      redoMutations: [...u]
    }), !0) : !1;
  }
};
var uw = Object.getOwnPropertyDescriptor, hw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? uw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Ur = (r, e) => (t, n) => e(t, n, r);
let ll = class extends oe {
  constructor(e, t, n, i, o, s) {
    super();
    _(this, "_editorUnitId", Oe);
    _(this, "_editorIsDirty", !1);
    _(this, "_visibleParams", {
      visible: !1,
      eventType: je.Dblclick,
      unitId: ""
    });
    _(this, "_currentEditCell", null);
    _(this, "_currentEditCellState", null);
    _(this, "_currentEditCellLayout", null);
    _(this, "helpFunctionVisible$", new Me(!0));
    // TODO: @weird94 this should split into to subjects, documentDataModel & position
    _(this, "_currentEditCellState$", new Me(null));
    _(this, "currentEditCellState$", this._currentEditCellState$.asObservable());
    _(this, "_currentEditCellLayout$", new Me(null));
    _(this, "currentEditCellLayout$", this._currentEditCellLayout$.asObservable());
    _(this, "currentEditCell$", this._currentEditCellState$.pipe(
      lt((e) => this._currentEditCellLayout$.pipe(Be((t) => e && t ? { ...e, ...t } : null)))
    ));
    _(this, "_visibleParams$", new Me(this._visibleParams));
    _(this, "visible$", this._visibleParams$.asObservable());
    _(this, "_afterVisibleParams$", new Me(this._visibleParams));
    _(this, "afterVisible$", this._afterVisibleParams$.asObservable());
    _(this, "_forceKeepVisible$", new Me(!1));
    _(this, "forceKeepVisible$", this._forceKeepVisible$.asObservable());
    this._sheetInterceptorService = e, this._renderManagerService = t, this._themeService = n, this._univerInstanceService = i, this._editorService = o, this._contextService = s, this.disposeWithMe(We(() => {
      this._currentEditCellState$.complete(), this._currentEditCell = null;
    })), this._univerInstanceService.getTypeOfUnitDisposed$(O.UNIVER_SHEET).subscribe((l) => {
      var a;
      l.getUnitId() === ((a = this._currentEditCellState) == null ? void 0 : a.unitId) && this._clearCurrentEditCellState();
    });
  }
  refreshEditCellState() {
    const e = this.getLatestEditCellState();
    if (!e) {
      this._currentEditCellState = null, this._currentEditCellLayout = null, this._currentEditCellState$.next(null), this._currentEditCellLayout$.next(null);
      return;
    }
    const { position: t, scaleX: n, scaleY: i, canvasOffset: o, ...s } = e;
    this._currentEditCellState = s, this._currentEditCellLayout = { position: t, scaleX: n, scaleY: i, canvasOffset: o }, this._currentEditCellState$.next(this._currentEditCellState), this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  refreshEditCellPosition(e) {
    var C;
    const t = this._currentEditCell;
    if (t == null)
      return;
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET);
    if (!n) return;
    const i = this._renderManagerService.getRenderUnitById(n.getUnitId());
    if (!i) return;
    const o = (C = i.with(ue).getSkeletonParam(t.sheetId)) == null ? void 0 : C.skeleton, s = i.with(gt);
    if (!o || !this._currentEditCellState) return;
    const { primary: l, scene: a, engine: c } = t, d = Ks(o, l);
    if (d == null)
      return;
    const u = Ds(d), h = vu(c);
    let { startX: g, startY: m, endX: f, endY: v } = u;
    const { scaleX: p, scaleY: S } = a.getAncestorScale(), w = a.getViewportScrollXY(s.getViewPort());
    g = Gr(g, p, w), m = qr(m, S, w), f = Gr(f, p, w), v = qr(v, S, w), e && this._currentEditCellLayout && (f = f - g + this._currentEditCellLayout.position.startX, v = v - m + this._currentEditCellLayout.position.startY, g = this._currentEditCellLayout.position.startX, m = this._currentEditCellLayout.position.startY), this._currentEditCellLayout = {
      position: {
        startX: g,
        startY: m,
        endX: f,
        endY: v
      },
      canvasOffset: h,
      scaleX: p,
      scaleY: S
    }, this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  setEditCell(e) {
    this._currentEditCell = e, this._editorService.getFocusEditor() || (this._editorService.focus(Oe), this._contextService.setContextValue(Je, !1), this._contextService.setContextValue(Ll, !1));
    const t = this.getLatestEditCellState();
    if (!t) {
      this._currentEditCellState = t, this._currentEditCellLayout = t, this._currentEditCellState$.next(t), this._currentEditCellLayout$.next(t);
      return;
    }
    const { position: n, canvasOffset: i, scaleX: o, scaleY: s, ...l } = t;
    this._currentEditCellState = l, this._currentEditCellLayout = { position: n, canvasOffset: i, scaleX: o, scaleY: s }, this._currentEditCellState$.next(this._currentEditCellState), this._currentEditCellLayout$.next(this._currentEditCellLayout);
  }
  _clearCurrentEditCellState() {
    this._currentEditCellState = null, this._currentEditCellState$.next(null), this._currentEditCellLayout = null, this._currentEditCellLayout$.next(null);
  }
  getEditCellState() {
    return this._currentEditCellState == null || this._currentEditCellLayout == null ? null : { ...this._currentEditCellState, ...this._currentEditCellLayout };
  }
  getEditCellLayout() {
    return this._currentEditCellLayout;
  }
  getEditLocation() {
    return this._currentEditCellState;
  }
  updateEditLocation(e, t) {
    this._currentEditCellState && (this._currentEditCellState = {
      ...this._currentEditCellState,
      row: e,
      column: t
    });
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  getLatestEditCellState() {
    var H, A, x;
    const e = this._currentEditCell;
    if (e == null) return;
    const t = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET);
    if (!t) return;
    const n = this._renderManagerService.getRenderUnitById(t.getUnitId());
    if (!n) return;
    const i = n.with(ue).getCurrentSkeleton(), o = n.with(gt);
    if (!i) return;
    const { primary: s, unitId: l, sheetId: a, scene: c, engine: d } = e, { startRow: u, startColumn: h } = s, g = Ks(i, s);
    if (g == null) return;
    const m = Ds(g), f = vu(d);
    let { startX: v, startY: p, endX: S, endY: w } = m;
    const { scaleX: C, scaleY: I } = c.getAncestorScale(), R = c.getViewportScrollXY(o.getViewPort());
    v = Gr(v, C, R), p = qr(p, I, R), S = Gr(S, C, R), w = qr(w, I, R);
    const y = t.getActiveSheet();
    if (!y) return;
    const M = {
      workbook: t,
      worksheet: y,
      unitId: t.getUnitId(),
      subUnitId: y.getSheetId(),
      row: u,
      col: h,
      origin: y.getCellRaw(u, h)
    };
    let E;
    const T = this._sheetInterceptorService.writeCellInterceptor.fetchThroughInterceptors(Vv)(
      y.getCell(u, h),
      M
    );
    E = T && y.getCellDocumentModelWithFormula(T, M.row, M.col);
    const P = (H = E == null ? void 0 : E.documentModel) == null ? void 0 : H.documentStyle.renderConfig;
    if (P != null && (P.cellValueType = yt.STRING), !E || E.documentModel == null) {
      const V = y.getBlankCellDocumentModel(T, M.row, M.col);
      if (E != null) {
        const { verticalAlign: D, horizontalAlign: X, wrapStrategy: B, textRotation: j, fill: G } = E, { centerAngle: ge, vertexAngle: Re } = Id(j);
        V.documentModel.documentStyle.renderConfig = {
          ...P,
          verticalAlign: D,
          horizontalAlign: X,
          wrapStrategy: B,
          background: { rgb: G },
          centerAngle: ge,
          vertexAngle: Re
        };
      }
      E = V;
    }
    if (E.fill = E.fill || "#fff", (A = E.documentModel) == null || A.setZoomRatio(Math.max(C, I)), (T == null ? void 0 : T.isInArrayFormulaRange) === !0) {
      const V = (x = E.documentModel) == null ? void 0 : x.getBody();
      V && (V.textRuns = [
        {
          st: 0,
          ed: V.dataStream.length - 2,
          ts: {
            cl: {
              rgb: this._themeService.getColorFromTheme("gray.600")
            }
          }
        }
      ]);
    }
    return {
      position: {
        startX: v,
        startY: p,
        endX: S,
        endY: w
      },
      scaleX: C,
      scaleY: I,
      canvasOffset: f,
      row: u,
      column: h,
      unitId: l,
      sheetId: a,
      documentLayoutObject: E,
      editorUnitId: this._editorUnitId,
      isInArrayFormulaRange: T == null ? void 0 : T.isInArrayFormulaRange
    };
  }
  getCurrentEditorId() {
    return this._editorUnitId;
  }
  changeVisible(e) {
    this._visibleParams = e, e.visible && (this._editorIsDirty = !1), this._visibleParams$.next(this._visibleParams), this._afterVisibleParams$.next(this._visibleParams);
  }
  isVisible() {
    return this._visibleParams;
  }
  enableForceKeepVisible() {
    this._forceKeepVisible$.next(!0);
  }
  disableForceKeepVisible() {
    this._forceKeepVisible$.next(!1);
  }
  isForceKeepVisible() {
    return this._forceKeepVisible$.getValue();
  }
  changeEditorDirty(e) {
    this._editorIsDirty = e;
  }
  getEditorDirty() {
    return this._editorIsDirty;
  }
};
ll = hw([
  Ur(0, N(vn)),
  Ur(1, fe),
  Ur(2, N(Ht)),
  Ur(3, k),
  Ur(4, Ni),
  Ur(5, De)
], ll);
const qe = Yt("univer.sheet-editor-bridge.service");
var gw = Object.getOwnPropertyDescriptor, mw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? gw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ws = (r, e) => (t, n) => e(t, n, r);
let Po = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "_zoom");
    this._context = e, this._sheetSkeletonManagerService = t, this._commandService = n, this._contextService = i, this._editorBridgeService = o, this._initSkeletonListener(), this._initZoomEventListener();
  }
  updateZoom(e, t) {
    const n = this._context.unit.getSheetBySheetId(e);
    return n ? (n.getConfig().zoomRatio = t, n === this._context.unit.getActiveSheet() && this._updateViewZoom(t), !0) : !1;
  }
  _initZoomEventListener() {
    const e = en(this._context.unit, this._context).scene;
    this.disposeWithMe(
      // hold ctrl & mousewheel ---> zoom
      e.onMouseWheel$.subscribeEvent((t) => {
        if (!t.ctrlKey || !this._contextService.getContextValue(Nt))
          return;
        if (this._editorBridgeService) {
          const c = this._editorBridgeService.isVisible();
          if ((c.unitId === this._context.unitId || c.unitId === Ae) && c.visible)
            return;
        }
        const n = Math.abs(t.deltaX);
        let i = n < 40 ? 0.2 : n < 80 ? 0.4 : 0.2;
        i *= t.deltaY > 0 ? -1 : 1, e.scaleX < 1 && (i /= 2);
        const o = this._context.unit, s = o.getActiveSheet();
        if (!s) return;
        const l = s.getZoomRatio();
        let a = +Number.parseFloat(`${l + i}`).toFixed(1);
        a = a >= 4 ? 4 : a <= 0.1 ? 0.1 : a, this._commandService.executeCommand(ss.id, {
          zoomRatio: Math.round(a * 10) / 10,
          unitId: o.getUnitId(),
          subUnitId: s.getSheetId()
        }), t.preventDefault();
      })
    );
  }
  _initSkeletonListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (e == null)
        return;
      const n = this._context.unit.getActiveSheet();
      if (!n) return;
      const i = n.getZoomRatio() || 1;
      this._zoom !== i && this._updateViewZoom(i);
    }));
  }
  /**
   * Triggered when zoom and switch sheet.
   * @param zoomRatio
   */
  _updateViewZoom(e) {
    this._zoom = e;
    const t = en(this._context.unit, this._context);
    t == null || t.scene.scale(e, e), t == null || t.spreadsheet.makeForceDirty();
  }
};
Po = mw([
  ws(1, N(ue)),
  ws(2, W),
  ws(3, De),
  ws(4, ld(qe))
], Po);
const Jt = {
  id: "sheet.operation.set-zoom-ratio",
  type: J.OPERATION,
  handler: (r, e) => {
    const n = r.get(fe).getRenderById(e.unitId);
    return n ? n.with(Po).updateZoom(e.subUnitId, e.zoomRatio) : !1;
  }
}, os = {
  id: "sheet.command.change-zoom-ratio",
  type: J.COMMAND,
  handler: (r, e) => {
    if (!e)
      return !1;
    const t = r.get(k), n = Xe(t);
    if (!n) return !1;
    const { worksheet: i, subUnitId: o, unitId: s } = n, { delta: l, reset: a } = e;
    let c = a ? 100 : Math.round((i.getConfig().zoomRatio + l) * 100);
    c = Math.max(Lc[0], c), c = Math.min(Lc[1], c);
    const d = c / 100, h = r.get(qe).isVisible();
    return (h.unitId === s || h.unitId === Ae) && h.visible ? !1 : r.get(W).executeCommand(Jt.id, {
      unitId: s,
      subUnitId: o,
      zoomRatio: d
    });
  }
}, ss = {
  id: "sheet.command.set-zoom-ratio",
  type: J.COMMAND,
  handler: (r, e) => {
    if (!e)
      return !1;
    const { unitId: t, subUnitId: n, zoomRatio: i } = e, s = r.get(qe).isVisible();
    return (s.unitId === t || s.unitId === Ae) && s.visible ? !1 : r.get(W).executeCommand(Jt.id, {
      unitId: t,
      subUnitId: n,
      zoomRatio: i
    });
  }
}, Nr = Yt("univer.sheetbar-service");
class Vm extends oe {
  constructor() {
    super();
    _(this, "renameId$");
    _(this, "removeId$");
    _(this, "scroll$");
    _(this, "scrollX$");
    _(this, "addSheet$");
    _(this, "_renameId$");
    _(this, "_removeId$");
    _(this, "_scroll$");
    _(this, "_scrollX$");
    _(this, "_addSheet$");
    _(this, "_currentHandler", null);
    this._renameId$ = new He(), this.renameId$ = this._renameId$.asObservable(), this._removeId$ = new He(), this.removeId$ = this._removeId$.asObservable(), this._scroll$ = new He(), this.scroll$ = this._scroll$.asObservable(), this._scrollX$ = new He(), this.scrollX$ = this._scrollX$.asObservable(), this._addSheet$ = new He(), this.addSheet$ = this._addSheet$.asObservable();
  }
  setRenameId(t) {
    this._renameId$.next(t);
  }
  setRemoveId(t) {
    this._removeId$.next(t);
  }
  setScroll(t) {
    this._scroll$.next(t);
  }
  setScrollX(t) {
    this._scrollX$.next(t);
  }
  setAddSheet(t) {
    this._addSheet$.next(t);
  }
  triggerSheetBarMenu() {
    var t;
    (t = this._currentHandler) == null || t.handleSheetBarMenu();
  }
  registerSheetBarMenuHandler(t) {
    if (this._currentHandler)
      throw new Error("There is already a context menu handler!");
    return this._currentHandler = t, We(() => {
      this._currentHandler = null;
    });
  }
}
const Ia = {
  id: "ui-sheet.command.show-menu-list",
  type: J.OPERATION,
  handler: async (r) => (r.get(Nr).triggerSheetBarMenu(), !0)
}, ya = {
  type: J.COMMAND,
  id: "sheet.command.delete-worksheet-protection-from-sheet-bar",
  async handler(r, e) {
    if (!e)
      return !1;
    const t = r.get(W), n = r.get(Zt), i = r.get(ft), s = r.get(k).getCurrentUnitForType(Tm.UNIVER_SHEET), l = s == null ? void 0 : s.getActiveSheet(), a = s.getUnitId();
    if (!l)
      return !1;
    const c = l.getSheetId(), d = i.getRule(a, c);
    if (await t.executeCommand(Us.id, {
      unitId: a,
      subUnitId: c
    })) {
      const h = [{ id: Us.id, params: { unitId: a, subUnitId: c } }], g = [{ id: vg.id, params: { unitId: a, rule: d } }];
      n.pushUndoRedo({
        unitID: a,
        redoMutations: h,
        undoMutations: g
      });
    }
    return !0;
  }
}, Ma = {
  type: J.COMMAND,
  id: "sheet.command.change-sheet-protection-from-sheet-bar",
  async handler(r) {
    return await r.get(W).executeCommand("sheet-permission.operation.openDialog"), !0;
  }
}, Jd = {
  id: "sheet.operation.set-activate-cell-edit",
  type: J.OPERATION,
  handler: (r, e) => (r.get(qe).setEditCell(e), !0)
}, tt = {
  id: "sheet.operation.set-cell-edit-visible",
  type: J.OPERATION,
  handler: (r, e) => {
    if (!e)
      return !1;
    const { unitId: t } = e, i = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET);
    return i ? (r.get(qe).changeVisible({
      ...e,
      unitId: t != null ? t : i.getUnitId()
    }), !0) : !1;
  }
}, Ea = {
  id: "sheet.operation.set-cell-edit-visible-f2",
  type: J.OPERATION,
  handler: (r, e) => {
    const t = r.get(W), i = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET);
    return i ? t.syncExecuteCommand(tt.id, {
      ...e,
      unitId: i.getUnitId()
    }) : !1;
  }
}, wi = {
  id: "sheet.operation.set-cell-edit-visible-arrow",
  type: J.OPERATION,
  handler: () => !0
}, Ta = {
  id: "sheet.operation.rename-sheet",
  type: J.OPERATION,
  handler: async (r, e) => {
    const t = r.get(Nr);
    return e && t.setRenameId(e.subUnitId), !0;
  }
}, $d = {
  id: "sheet.operation.scroll-to-range",
  type: J.OPERATION,
  handler: (r, e) => {
    if (!e)
      return !1;
    const t = r.get(k);
    return r.get(fe).getRenderById(t.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId()).with(Ci).scrollToRange(e.range, e.forceTop, e.forceLeft);
  }
}, Nm = {
  type: J.OPERATION,
  id: "sheet-permission.operation.openDialog",
  async handler(r, e) {
    const t = r.get(Qo);
    return t.close("DESKTOP_FIND_REPLACE_DIALOG"), t.open({
      id: ol,
      title: { title: "permission.dialog.allowedPermissionType" },
      children: { label: xm },
      width: 393,
      destroyOnClose: !0,
      onClose: () => t.close(ol)
    }), !0;
  }
}, xo = "DefinedNameContainer", eu = {
  id: "sidebar.operation.defined-name",
  type: J.COMMAND,
  handler: async (r, e) => {
    const t = r.get(Di);
    r.get(Ni);
    const n = r.get(xe), i = r.get(k), o = Xe(i);
    if (!o) return !1;
    const { unitId: s } = o;
    switch (e.value) {
      case "open":
        t.open({
          id: xo,
          header: { title: n.t("definedName.featureTitle") },
          children: { label: xo },
          onClose: () => {
          },
          width: 333
        });
        break;
      case "close":
      default:
        t.close();
        break;
    }
    return !0;
  }
};
function fw(r, e) {
  if (r.length !== e.length) return !1;
  const t = r.sort((i, o) => i.id.localeCompare(o.id)), n = e.sort((i, o) => i.id.localeCompare(o.id));
  return t.every((i, o) => {
    var s, l;
    return ((s = i.subject) == null ? void 0 : s.userID) === ((l = n[o].subject) == null ? void 0 : l.userID) && i.role === n[o].role;
  });
}
function km(r, e) {
  return e.some((t) => pw(r, t));
}
function pw(r, e) {
  const { startRow: t, startColumn: n, endColumn: i, endRow: o } = e, s = r.getMatrixWithMergedCells(t, n, o, i);
  let l = !1;
  return s.forValue((a, c, d) => {
    if (d && (a !== t || c !== n) && r.cellHasValue(d))
      return l = !0, !1;
  }), l;
}
function Dm(r, e, t, n) {
  const i = [], o = [], s = t.getSheetId();
  return n.forEach((l) => {
    const a = vw(t, l), c = {
      unitId: e,
      subUnitId: s,
      cellValue: a.getData()
    }, d = $t(
      r,
      c
    );
    i.push({ id: we.id, params: d }), o.push({ id: we.id, params: c });
  }), {
    undos: i,
    redos: o
  };
}
function vw(r, e) {
  const { startRow: t, startColumn: n, endColumn: i, endRow: o } = e, s = r.getMatrixWithMergedCells(t, n, o, i, Kh.Raw), l = new Ge();
  let a = null;
  return s.forValue((c, d, u) => {
    var h, g, m, f;
    u && c >= t && d >= n && (!a && r.cellHasValue(u) && (u.v !== "" || ((f = (m = (g = (h = u.p) == null ? void 0 : h.body) == null ? void 0 : g.dataStream) == null ? void 0 : m.length) != null ? f : 0) > 2) && (a = u), l.setValue(c, d, null));
  }), l.setValue(t, n, a), l;
}
function Sw(r, e, t, n) {
  const i = t.getActiveViewportByCoord(
    ke.FromArray([r, e])
  );
  if (!i)
    return;
  const { scaleX: o, scaleY: s } = t.getAncestorScale(), l = {
    x: i.viewportScrollX,
    y: i.viewportScrollY
  }, a = n.getCellIndexByOffset(r, e, o, s, l), c = n.worksheet.getMergedCell(a.row, a.column);
  return {
    actualRow: c ? c.startRow : a.row,
    actualCol: c ? c.startColumn : a.column,
    mergeCell: c,
    row: a.row,
    col: a.column
  };
}
function ch(r, e, t, n) {
  const i = n.getFreeze();
  if (!i || i.startRow <= 0 && i.startColumn <= 0)
    return t.getViewport(F.VIEW_MAIN);
  if (r >= i.startRow && e >= i.startColumn)
    return t.getViewport(F.VIEW_MAIN);
  if (r < i.startRow && e < i.startColumn)
    return t.getViewport(F.VIEW_MAIN_LEFT_TOP);
  if (r < i.startRow && e >= i.startColumn)
    return t.getViewport(F.VIEW_MAIN_TOP);
  if (r >= i.startRow && e < i.startColumn)
    return t.getViewport(F.VIEW_MAIN_LEFT);
}
function Cw(r, e, t, n) {
  const i = dh(r.left, r.top, e, t, n), o = dh(r.right, r.bottom, e, t, n);
  return {
    left: i.x,
    top: i.y,
    right: o.x,
    bottom: o.y
  };
}
function dh(r, e, t, n, i) {
  const { scaleX: o, scaleY: s } = t.getAncestorScale(), l = t.getViewport(F.VIEW_MAIN);
  if (!l)
    return {
      x: r,
      y: e
    };
  const a = i.getFreeze(), { startColumn: c, startRow: d, xSplit: u, ySplit: h } = a, g = n.getNoMergeCellWithCoordByIndex(d - h, c - u, !1), m = n.getNoMergeCellWithCoordByIndex(d, c, !1), { rowHeaderWidth: f, columnHeaderHeight: v } = n, p = m.startX - g.startX, S = m.startY - g.startY, { top: w, left: C, viewportScrollX: I, viewportScrollY: R } = l;
  let y;
  r > C ? y = (r - I) * o : y = (p + f - (C - r)) * o;
  let M;
  return e > w ? M = (e - R) * s : M = (S + v - (w - e)) * o, {
    x: y,
    y: M
  };
}
function ww(r, e, t, n, i) {
  let o = n, s = i;
  t.overflowCache.forValue((c, d, u) => {
    u.startRow <= o && u.endRow >= o && u.startColumn <= s && u.endColumn >= s && (s = d, o = c);
  });
  const l = t.getCellWithCoordByIndex(o, s);
  return {
    unitId: r.getUnitId(),
    subUnitId: e.getSheetId(),
    workbook: r,
    worksheet: e,
    row: l.actualRow,
    col: l.actualColumn
  };
}
function Lm(r, e, t, n, i, o) {
  const { scene: s } = r, l = e.getUnitId(), { skeleton: a, sheetId: c } = n, d = Sw(i, o, s, a);
  if (!d)
    return null;
  let { actualCol: u, actualRow: h } = d;
  const g = {
    unitId: l,
    subUnitId: c,
    workbook: e,
    worksheet: t,
    row: h,
    col: u
  };
  a.overflowCache.forValue((R, y, M) => {
    M.startRow <= h && M.endRow >= h && M.startColumn <= u && M.endColumn >= u && (u = y, h = R);
  });
  const m = a.getCellWithCoordByIndex(h, u), f = ww(e, t, a, h, u);
  let v;
  m.mergeInfo ? v = m.mergeInfo : v = {
    startRow: f.row,
    endRow: f.row,
    startColumn: f.col,
    endColumn: f.col
  };
  const p = s.getActiveViewportByCoord(
    ke.FromArray([i, o])
  );
  if (!p)
    return;
  const { scaleX: S, scaleY: w } = s.getAncestorScale(), C = {
    x: p.viewportScrollX,
    y: p.viewportScrollY
  };
  return {
    position: {
      startX: (a.getOffsetByColumn(v.startColumn - 1) - C.x) * S,
      endX: (a.getOffsetByColumn(v.endColumn) - C.x) * S,
      startY: (a.getOffsetByRow(v.startRow - 1) - C.y) * w,
      endY: (a.getOffsetByRow(v.endRow) - C.y) * w
    },
    location: g,
    overflowLocation: f
  };
}
function kr() {
  const r = L(k), e = dt(() => r.getCurrentTypeOfUnit$(O.UNIVER_SHEET), void 0, void 0, []);
  return e != null ? e : null;
}
function Gy(r) {
  return dt(() => {
    var t;
    return (t = r == null ? void 0 : r.activeSheet$) != null ? t : Ce(null);
  }, void 0, void 0, [r]);
}
function qy() {
  const r = L(k);
  return dt(() => St([
    r.getTypeOfUnitAdded$(O.UNIVER_SHEET),
    r.getTypeOfUnitDisposed$(O.UNIVER_SHEET)
  ]).pipe(
    Be(() => r.getAllUnitsForType(O.UNIVER_SHEET)),
    xt(r.getAllUnitsForType(O.UNIVER_SHEET))
  ), [], void 0, [r]);
}
const Qy = "SheetUI";
var Wm = /* @__PURE__ */ ((r) => (r.FILTER_PANEL_EMBED_POINT = "filter-panel-embed-point", r.SHEETS_FOOTER = "sheets-footer", r.FORMULA_AUX = "formula-aux", r))(Wm || {}), bw = Object.getOwnPropertyDescriptor, _w = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? bw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, bs = (r, e) => (t, n) => e(t, n, r);
const uh = "univer-sheet-main-canvas";
let ir = class extends kn {
  constructor(e, t, n, i) {
    super();
    _(this, "_skeletonChangeMutations", /* @__PURE__ */ new Set());
    this._contextService = e, this._instanceSrv = t, this._renderManagerService = n, this._themeService = i, Promise.resolve().then(() => this._init());
  }
  /**
   * Register a mutation id that will trigger the skeleton change.
   *
   * @param mutationId the id of the mutation
   * @returns a disposable to unregister the mutation
   */
  registerSkeletonChangingMutations(e) {
    return this._skeletonChangeMutations.has(e) ? We(() => {
    }) : (this._skeletonChangeMutations.add(e), We(() => this._skeletonChangeMutations.delete(e)));
  }
  /**
   * Examine if a mutation would make the skeleton to change.
   */
  checkMutationShouldTriggerRerender(e) {
    return this._skeletonChangeMutations.has(e);
  }
  _init() {
    this._initWorkbookListener(), this._initContextListener();
  }
  _initWorkbookListener() {
    this._instanceSrv.getTypeOfUnitAdded$(O.UNIVER_SHEET).pipe(ui(this.dispose$)).subscribe((e) => this._createRenderer(e)), this._instanceSrv.getAllUnitsForType(O.UNIVER_SHEET).forEach((e) => this._createRenderer(e)), this._instanceSrv.getTypeOfUnitDisposed$(O.UNIVER_SHEET).pipe(ui(this.dispose$)).subscribe((e) => this._disposeRenderer(e));
  }
  _createRenderer(e) {
    const t = e.getUnitId();
    this._renderManagerService.created$.subscribe((n) => {
      n.unitId === t && (n.engine.getCanvas().setId(`${uh}_${t}`), n.engine.getCanvas().getContext().setId(`${uh}_${t}`));
    }), this._renderManagerService.createRender(t);
  }
  _disposeRenderer(e) {
    const t = e.getUnitId();
    this._renderManagerService.removeRender(t);
  }
  _initContextListener() {
    this.disposeWithMe(this._contextService.subscribeContextValue$(kS).pipe(dn()).subscribe(() => {
      this._renderManagerService.getRenderAll().forEach((e) => {
        e.mainComponent instanceof Qg && e.mainComponent.makeForceDirty(!0);
      });
    }));
  }
};
ir = _w([
  bs(0, De),
  bs(1, k),
  bs(2, fe),
  bs(3, N(Ht))
], ir);
var Rw = Object.getOwnPropertyDescriptor, Iw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Rw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, lr = (r, e) => (t, n) => e(t, n, r);
let bi = class extends oe {
  constructor(e, t, n, i, o, s, l) {
    super();
    _(this, "_beforeApplyData", []);
    _(this, "_currentLocation", null);
    _(this, "_copyData", []);
    _(this, "_defaultHook");
    this._univerInstanceService = e, this._commandService = t, this._autoFillService = n, this._editorBridgeService = i, this._renderManagerService = o, this._injector = s, this._sheetsRenderService = l, this._defaultHook = {
      id: "default",
      type: Kr.Default,
      priority: 0,
      onBeforeFillData: (a, c) => this._presetAndCacheData(a, c),
      onFillData: (a, c, d) => this._fillData(a, c, d)
    }, this._init();
  }
  _init() {
    this._initDefaultHook(), this._initSelectionControlFillChanged(), this._initQuitListener(), this._initSkeletonChange();
  }
  _initSkeletonChange() {
    this.disposeWithMe(this._sheetsRenderService.registerSkeletonChangingMutations(gr.id));
  }
  _initDefaultHook() {
    this.disposeWithMe(this._autoFillService.addHook(this._defaultHook));
  }
  _initQuitListener() {
    const e = [
      tt.id,
      _o.id,
      Fl.id,
      Jt.id,
      nt.id,
      tr.id,
      Xo.id,
      zo.id,
      jo.id,
      Yo.id,
      Ul.id,
      Xl.id,
      ln.id,
      So.id,
      we.id
    ];
    this.disposeWithMe(this._commandService.onCommandExecuted((t, n) => {
      var l, a;
      const i = n == null ? void 0 : n.fromCollab, o = n == null ? void 0 : n.fromSync, s = n == null ? void 0 : n.fromFormula;
      e.includes(t.id) && !i && !o && !s && t.params.trigger !== gr.id && t.params.trigger !== va.id && this._quit(), t.id === On.id && t.params.unitId === ((l = this._currentLocation) == null ? void 0 : l.unitId) && t.params.subUnitId === ((a = this._currentLocation) == null ? void 0 : a.subUnitId) && this._quit();
    })), this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe((t) => {
      var n;
      t.getUnitId() === ((n = this._currentLocation) == null ? void 0 : n.unitId) && this._quit();
    }));
  }
  _quit() {
    this._currentLocation = null, this._beforeApplyData = [], this._copyData = [], this._autoFillService.setShowMenu(!1);
  }
  _initSelectionControlFillChanged() {
    const e = new ht(), t = () => {
      e.dispose();
      const n = Go(O.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService);
      if (!n) return;
      n.with(gt).getSelectionControls().forEach((s) => {
        e.add(s.selectionFilled$.subscribe((l) => {
          if (l == null || l.startColumn === -1 || l.startRow === -1 || l.endColumn === -1 || l.endRow === -1)
            return;
          const a = {
            startColumn: s.model.startColumn,
            endColumn: s.model.endColumn,
            startRow: s.model.startRow,
            endRow: s.model.endRow
          }, c = {
            startColumn: l.startColumn,
            endColumn: l.endColumn,
            startRow: l.startRow,
            endRow: l.endRow
          };
          this._commandService.executeCommand(gr.id, { sourceRange: a, targetRange: c });
        })), e.add(s.fillControl.onDblclick$.subscribeEvent(() => {
          const l = {
            startColumn: s.model.startColumn,
            endColumn: s.model.endColumn,
            startRow: s.model.startRow,
            endRow: s.model.endRow
          };
          this._handleDbClickFill(l);
        })), e.add(s.fillControl.onPointerDown$.subscribeEvent(() => {
          this._editorBridgeService.isVisible().visible && this._commandService.syncExecuteCommand(
            tt.id,
            {
              visible: !1,
              eventType: je.PointerDown,
              unitId: n.unitId
            }
          );
        }));
      });
    };
    t(), this.disposeWithMe(this._commandService.onCommandExecuted((n) => {
      n.id === Ie.id && t();
    })), this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe(() => t()));
  }
  _handleDbClickFill(e) {
    const t = this._detectFillRange(e);
    t.endRow <= e.endRow || this._commandService.executeCommand(gr.id, { sourceRange: e, targetRange: t });
  }
  _detectFillRange(e) {
    var u, h, g, m, f, v;
    const { startRow: t, endRow: n, startColumn: i, endColumn: o } = e, s = (u = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET)) == null ? void 0 : u.getActiveSheet();
    if (!s)
      return e;
    const l = s.getCellMatrix(), a = s.getMaxRows() - 1, c = s.getMaxColumns() - 1;
    let d = n;
    if (i > 0 && ((h = l.getValue(t, i - 1)) == null ? void 0 : h.v) != null) {
      let p = t;
      for (; ((g = l.getValue(p, i - 1)) == null ? void 0 : g.v) != null && p < a; )
        p += 1;
      d = p - 1;
    } else if (o < c && ((m = l.getValue(n, o + 1)) == null ? void 0 : m.v) != null) {
      let p = t;
      for (; ((f = l.getValue(p, o + 1)) == null ? void 0 : f.v) != null && p < a; )
        p += 1;
      d = p - 1;
    }
    for (let p = n + 1; p <= d; p++)
      for (let S = i; S <= o; S++)
        if (((v = l.getValue(p, S)) == null ? void 0 : v.v) != null) {
          d = p - 1;
          break;
        }
    return {
      startColumn: i,
      endColumn: o,
      startRow: t,
      endRow: d
    };
  }
  // calc apply data according to copy data and direction
  _getApplyData(e, t, n, i, o, s = !0, l) {
    const a = [], c = Math.floor(n / t), d = n % t, u = this._autoFillService.getRules();
    if (!s && o === Le.ONLY_FORMAT)
      return console.error("ERROR: only format can not be applied when hasStyle is false"), [];
    const h = {};
    u.forEach((g) => {
      h[g.type] = [];
    }), u.forEach((g) => {
      const { type: m, applyFunctions: f = {} } = g, v = e[m];
      v && v.forEach((p) => {
        const S = jC(p.index, d), w = p.index.length * c + S, C = this._applyFunctions(
          p,
          w,
          i,
          o,
          f,
          e,
          l
        ), I = YC(t, n, p.index);
        h[m].push({ data: C, index: I });
      });
    });
    for (let g = 0; g < n; g++)
      u.forEach((m) => {
        const { type: f } = m, v = h[f];
        for (let p = 0; p < v.length; p++)
          g in v[p].index && a.push(v[p].data[v[p].index[g]]);
      });
    return a;
  }
  _applyFunctions(e, t, n, i, o, s, l) {
    const { data: a } = e, c = n === U.UP || n === U.LEFT;
    if (i === Le.COPY) {
      const d = o == null ? void 0 : o[Le.COPY];
      return d ? d(e, t, n, s, l) : (c && a.reverse(), br(a, t));
    }
    if (i === Le.SERIES) {
      const d = o == null ? void 0 : o[Le.SERIES];
      return d ? d(e, t, n, s) : (c && a.reverse(), o != null && o[Le.COPY] ? o[Le.COPY](e, t, n, s, l) : br(a, t));
    }
    if (i === Le.ONLY_FORMAT) {
      const d = o == null ? void 0 : o[Le.ONLY_FORMAT];
      return d ? d(e, t, n, s) : ZC(a, t);
    }
  }
  _getCopyData(e, t) {
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet();
    if (!n)
      throw new Error("No active sheet found");
    const i = n.getCellMatrix(), o = this._autoFillService.getRules(), s = [], l = t === U.DOWN || t === U.UP;
    let a, c;
    return l ? (a = e.cols, c = e.rows) : (a = e.rows, c = e.cols), a.forEach((d) => {
      const u = this._getEmptyCopyDataPiece(), h = {
        type: void 0,
        cellData: void 0
      };
      c.forEach((g) => {
        let m;
        l ? m = i.getValue(g, d) : m = i.getValue(d, g);
        const { type: f, isContinue: v } = o.find((p) => p.match(m, this._injector)) || vm;
        if (v(h, m)) {
          const p = u[f], S = p[p.length - 1];
          S.data.push(m), S.index.push(g - c[0]);
        } else {
          const p = u[f];
          p ? p.push({
            data: [m],
            index: [g - c[0]]
          }) : u[f] = [
            {
              data: [m],
              index: [g - c[0]]
            }
          ];
        }
        h.type = f, h.cellData = m;
      }), s.push(u);
    }), s;
  }
  _getEmptyCopyDataPiece() {
    const e = {};
    return this._autoFillService.getRules().forEach((t) => {
      e[t.type] = [];
    }), e;
  }
  _getMergeApplyData(e, t, n, i) {
    const o = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet();
    if (!o)
      throw new Error("No active sheet found");
    const s = [];
    for (let l = e.startRow; l <= e.endRow; l++)
      for (let a = e.startColumn; a <= e.endColumn; a++) {
        const { isMergedMainCell: c, startRow: d, startColumn: u, endRow: h, endColumn: g } = o.getCellInfoInMergeData(l, a);
        if (c) {
          if (n === U.DOWN) {
            let m = d + i, f = h + i;
            for (; f <= t.endRow; )
              s.push({
                startRow: m,
                startColumn: u,
                endRow: f,
                endColumn: g
              }), m += i, f += i;
          } else if (n === U.UP) {
            let m = d - i, f = h - i;
            for (; m >= t.startRow; )
              s.push({
                startRow: m,
                startColumn: u,
                endRow: f,
                endColumn: g
              }), m -= i, f -= i;
          } else if (n === U.RIGHT) {
            let m = u + i, f = g + i;
            for (; f <= t.endColumn; )
              s.push({
                startRow: d,
                startColumn: m,
                endRow: h,
                endColumn: f
              }), m += i, f += i;
          } else if (n === U.LEFT) {
            let m = u - i, f = g - i;
            for (; m >= t.startColumn; )
              s.push({
                startRow: d,
                startColumn: m,
                endRow: h,
                endColumn: f
              }), m -= i, f -= i;
          }
        }
      }
    return s;
  }
  _presetAndCacheData(e, t) {
    const { source: n, target: i } = e, o = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet();
    if (!o)
      throw new Error("No active sheet found");
    const s = o.getCellMatrix(), l = [];
    return i.rows.forEach((a) => {
      const c = [];
      i.cols.forEach((d) => {
        c.push(de.deepClone(s.getValue(a, d)));
      }), l.push(c);
    }), this._beforeApplyData = l, this._copyData = this._getCopyData(n, t), this._currentLocation = e, this._shouldDisableSeries(this._copyData) ? (this._autoFillService.setDisableApplyType(Le.SERIES, !0), Le.COPY) : (this._autoFillService.setDisableApplyType(Le.SERIES, !1), this._getPreferredApplyType(this._copyData));
  }
  // auto fill entry
  // eslint-disable-next-line max-lines-per-function
  _fillData(e, t, n) {
    var H, A;
    const i = [], o = [];
    let s = !0;
    n === Le.NO_FORMAT && (s = !1, n = Le.SERIES);
    const { source: l, target: a, unitId: c, subUnitId: d } = e;
    if (!l || !a || t == null)
      return {
        undos: i,
        redos: o
      };
    const u = Cr(l), h = Cr(a), { cols: g, rows: m } = a, { cols: f, rows: v } = l, p = this._copyData;
    let S;
    t === U.DOWN || t === U.UP ? S = v.length : S = f.length;
    const w = [];
    if (t === U.DOWN || t === U.UP) {
      const x = m.length, V = [];
      g.forEach((D, X) => {
        const B = p[X], j = this._getApplyData(B, S, x, t, n, s, e);
        V.push(j);
      });
      for (let D = 0; D < V[0].length; D++) {
        const X = [];
        for (let B = 0; B < V.length; B++)
          X.push({
            s: null,
            ...V[B][D]
          });
        w.push(X);
      }
    } else {
      const x = g.length;
      m.forEach((V, D) => {
        const X = p[D], B = this._getApplyData(X, S, x, t, n, s, e), j = [];
        for (let G = 0; G < B.length; G++)
          j.push({
            s: null,
            ...B[G]
          });
        w.push(j);
      });
    }
    let C = [];
    const I = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getStyles();
    if (s ? (C = this._getMergeApplyData(u, h, t, S), w.forEach((x) => {
      x.forEach((V) => {
        V && I && I && (V.s = I.getStyleByCell(V));
      });
    })) : w.forEach((x, V) => {
      x.forEach((D, X) => {
        D && I && (D.s = I.getStyleByCell(this._beforeApplyData[V][X]) || null);
      });
    }), n === Le.ONLY_FORMAT && w.forEach((x, V) => {
      x.forEach((D, X) => {
        if (D) {
          const B = this._beforeApplyData[V][X] || {};
          D.f = B.f, D.si = B.si, D.t = B.t, D.v = B.v;
        }
      });
    }), s) {
      const x = [], V = (A = (H = this._univerInstanceService.getUniverSheetInstance(c)) == null ? void 0 : H.getSheetBySheetId(d)) == null ? void 0 : A.getMergeData();
      V && V.forEach((B) => {
        se.intersects(B, h) && x.push(B);
      });
      const D = {
        unitId: c,
        subUnitId: d,
        ranges: x
      }, X = this._injector.invoke(
        zl,
        D
      );
      x.length && (o.push({ id: Qt.id, params: D }), i.unshift({ id: Kt.id, params: X }));
    }
    const R = {
      subUnitId: d,
      unitId: c,
      cellValue: LC([a])
    }, y = this._injector.invoke(
      $t,
      R
    );
    o.push({ id: we.id, params: R }), i.unshift({ id: we.id, params: y });
    const M = new Ge();
    m.forEach((x, V) => {
      g.forEach((D, X) => {
        w[V][X] && M.setValue(x, D, w[V][X]);
      });
    });
    const E = M.getMatrix(), T = {
      subUnitId: d,
      unitId: c,
      cellValue: E
    }, P = this._injector.invoke(
      $t,
      T
    );
    if (this._autoFillService.getActiveHooks().forEach((x) => {
      var V;
      (V = x.onBeforeSubmit) == null || V.call(x, e, t, n, E);
    }), i.unshift({ id: we.id, params: P }), o.push({ id: we.id, params: T }), C != null && C.length) {
      const x = jl(C), V = {
        unitId: c,
        subUnitId: d,
        ranges: x
      }, D = this._injector.invoke(
        Yl,
        V
      );
      i.unshift({ id: Qt.id, params: D }), o.push({ id: Kt.id, params: V });
    }
    return {
      undos: i,
      redos: o
    };
  }
  _shouldDisableSeries(e) {
    return e.every(
      (t) => Object.keys(t).every(
        (n) => {
          var i;
          return ((i = t[n]) == null ? void 0 : i.length) === 0 || [mt.OTHER, mt.FORMULA].includes(n);
        }
      )
    );
  }
  _getPreferredApplyType(e) {
    return e.every(
      (n) => Object.keys(n).every(
        (i) => {
          var o, s;
          return ((o = n[i]) == null ? void 0 : o.length) === 0 || ((s = n[i]) == null ? void 0 : s.length) === 1 && n[i][0].data.length === 1 && mt.NUMBER === i;
        }
      )
    ) ? Le.COPY : Le.SERIES;
  }
};
bi = Iw([
  lr(0, k),
  lr(1, W),
  lr(2, Hr),
  lr(3, qe),
  lr(4, fe),
  lr(5, N(Rt)),
  lr(6, N(ir))
], bi);
var yw = Object.getOwnPropertyDescriptor, Mw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? yw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Ba = (r, e) => (t, n) => e(t, n, r);
let al = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_enterActiveRender");
    this._context = e, this._sheetSkeletonManagerService = t, this._renderManagerService = n, this._permissionService = i, this._initEventBinding();
  }
  // eslint-disable-next-line max-lines-per-function
  _initEventBinding() {
    const e = new ht(), t = this._context.unit, n = (i) => {
      if (e.dispose(), !i)
        return;
      const o = this._context.unitId, { skeleton: s } = i, l = this._renderManagerService.getRenderById(o);
      if (l && l.mainComponent) {
        const a = l.mainComponent, c = (h) => {
          const { offsetX: g, offsetY: m } = h, f = l.scene, v = t.getActiveSheet();
          if (!v)
            return;
          const p = f.getActiveViewportByCoord(
            ke.FromArray([g, m])
          );
          if (!p)
            return;
          const { scaleX: S, scaleY: w } = f.getAncestorScale(), C = {
            x: p.viewportScrollX,
            y: p.viewportScrollY
          }, I = s.getCellIndexByOffset(g, m, S, w, C), R = s.worksheet.getMergedCell(I.row, I.column), y = {
            actualRow: R ? R.startRow : I.row,
            actualCol: R ? R.startColumn : I.column,
            row: I.row,
            col: I.column
          };
          if (!y || !s)
            return;
          const M = v.getCell(y.actualRow, y.actualCol);
          if (!M)
            return;
          const E = M.customRender;
          if (!(E != null && E.length))
            return;
          const T = y.actualRow, P = y.actualCol, H = E.sort(mv), A = v.getSheetId(), x = {
            data: M,
            style: s.getStyles().getStyleByCell(M),
            primaryWithCoord: s.getCellWithCoordByIndex(y.actualRow, y.actualCol),
            unitId: o,
            subUnitId: A,
            row: T,
            col: P,
            workbook: t,
            worksheet: v
          }, V = {
            x: C.x + g / S,
            y: C.y + m / w
          }, D = H.find((X) => {
            var B;
            return (B = X.isHit) == null ? void 0 : B.call(X, V, x);
          });
          if (D)
            return [D, x];
        }, d = a.onPointerDown$.subscribeEvent((h) => {
          var m, f, v, p;
          const g = c(h);
          if (g) {
            const [S, w] = g, { row: C, col: I, worksheet: R, unitId: y, subUnitId: M } = w;
            if (!((m = this._permissionService.composePermission(
              [new K(y).id, new te(y, M).id]
            )) == null ? void 0 : m.every((P) => P.value)))
              return !1;
            const T = (v = (f = R.getCell(C, I)) == null ? void 0 : f.selectionProtection) == null ? void 0 : v[0];
            if ((T == null ? void 0 : T[Co.Edit]) === !1)
              return !1;
            (p = S.onPointerDown) == null || p.call(S, w, h);
          }
        }), u = Ws(a.onPointerMove$).pipe(Ys(30)).subscribe((h) => {
          var m, f, v, p, S, w;
          const g = c(h);
          if (g) {
            const [C, I] = g;
            this._enterActiveRender ? this._enterActiveRender.render !== C && ((f = (m = this._enterActiveRender.render).onPointerLeave) == null || f.call(m, this._enterActiveRender.cellContext, h), this._enterActiveRender = {
              render: C,
              cellContext: I
            }, (v = C.onPointerEnter) == null || v.call(C, I, h)) : (this._enterActiveRender = {
              render: C,
              cellContext: I
            }, (p = C.onPointerEnter) == null || p.call(C, I, h));
          } else
            this._enterActiveRender && ((w = (S = this._enterActiveRender.render).onPointerLeave) == null || w.call(S, this._enterActiveRender.cellContext, h), this._enterActiveRender = null);
        });
        d && e.add(d), u && e.add(u);
      }
    };
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe(n)), n(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(e);
  }
};
al = Mw([
  Ba(1, N(ue)),
  Ba(2, fe),
  Ba(3, rt)
], al);
var Ew = Object.getOwnPropertyDescriptor, Tw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Ew(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, hh = (r, e) => (t, n) => e(t, n, r);
let Oo = class extends oe {
  constructor(e, t) {
    super();
    _(this, "_currentCell$", new He());
    _(this, "currentCell$", this._currentCell$.asObservable().pipe(dn(
      (e, t) => {
        var n, i, o, s, l, a, c, d;
        return ((n = e == null ? void 0 : e.location) == null ? void 0 : n.unitId) === ((i = t == null ? void 0 : t.location) == null ? void 0 : i.unitId) && ((o = e == null ? void 0 : e.location) == null ? void 0 : o.subUnitId) === ((s = t == null ? void 0 : t.location) == null ? void 0 : s.subUnitId) && ((l = e == null ? void 0 : e.location) == null ? void 0 : l.row) === ((a = t == null ? void 0 : t.location) == null ? void 0 : a.row) && ((c = e == null ? void 0 : e.location) == null ? void 0 : c.col) === ((d = t == null ? void 0 : t.location) == null ? void 0 : d.col);
      }
    )));
    _(this, "_endCell$", new He());
    _(this, "endCell$", this._endCell$.asObservable());
    this._univerInstanceService = e, this._renderManagerService = t, this._initCellDisposableListener();
  }
  dispose() {
    super.dispose(), this._currentCell$.complete(), this._endCell$.complete();
  }
  _initCellDisposableListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe((e) => {
      e || (this._currentCell$.next(null), this._endCell$.next(null));
    }));
  }
  _calcActiveCell(e, t) {
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET);
    if (!n)
      return null;
    const i = n.getActiveSheet();
    if (!i) return;
    const o = this._renderManagerService.getRenderById(n.getUnitId());
    if (!o) return;
    const s = o.with(ue).getCurrentParam(), a = o.with(Et).getCurrentScrollState();
    if (!(!s || !a || !o))
      return Lm(o, n, i, s, e, t);
  }
  onDragOver(e) {
    const { offsetX: t, offsetY: n, dataTransfer: i } = e, o = this._calcActiveCell(t, n);
    if (!o) {
      this._currentCell$.next(null);
      return;
    }
    const { location: s, position: l } = o;
    this._currentCell$.next({
      location: s,
      position: l,
      dataTransfer: i
    });
  }
  onDrop(e) {
    const { offsetX: t, offsetY: n, dataTransfer: i } = e, o = this._calcActiveCell(t, n);
    if (!o) {
      this._endCell$.next(null);
      return;
    }
    const { location: s, position: l } = o;
    this._endCell$.next({
      location: s,
      position: l,
      dataTransfer: i
    });
  }
};
Oo = Tw([
  hh(0, k),
  hh(1, fe)
], Oo);
var Pw = Object.getOwnPropertyDescriptor, xw = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Pw(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Fa = (r, e) => (t, n) => e(t, n, r);
let cl = class extends oe {
  constructor(r, e, t, n) {
    super(), this._context = r, this._renderManagerService = e, this._dragManagerService = t, this._sheetSkeletonManagerService = n, this._initDragEvent();
  }
  _initDragEvent() {
    const r = new ht(), e = (t) => {
      if (r.dispose(), !t)
        return;
      const { scene: n } = this._context, i = n.onDragOver$.subscribeEvent((s) => {
        this._dragManagerService.onDragOver(s);
      }), o = n.onDrop$.subscribeEvent((s) => {
        this._dragManagerService.onDrop(s);
      });
      r.add({
        dispose() {
          i.unsubscribe(), o.unsubscribe();
        }
      });
    };
    e(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t) => {
      e(t);
    }));
  }
};
cl = xw([
  Fa(1, fe),
  Fa(2, N(Oo)),
  Fa(3, N(ue))
], cl);
class Bm {
  constructor() {
    _(this, "_state", null);
    _(this, "_rect", null);
    _(this, "_state$", new Me(null));
    _(this, "state$", this._state$.asObservable());
    _(this, "_rect$", new Me(null));
    _(this, "rect$", this._rect$.asObservable());
    _(this, "_focus", !1);
    _(this, "_focus$", new Me(this._focus));
    _(this, "focus$", this._focus$.asObservable());
  }
  dispose() {
    this._state$.complete(), this._state = null, this._rect$.complete(), this._rect = null;
  }
  setState(e) {
    this._state = e, this._refresh(e);
  }
  getRect() {
    return this._rect;
  }
  setRect(e) {
    this._rect = e, this._rect$.next(e);
  }
  getState() {
    return this._state;
  }
  setFocus(e = !1) {
    this._focus = e, this._focus$.next(e);
  }
  _refresh(e) {
    this._state$.next(e);
  }
}
const ls = Yt(
  "univer.sheet-cell-editor-manager.service"
), Tt = "sheets-ui.config", dl = {
  formulaBar: !0,
  statusBarStatistic: !0,
  protectedRangeShadow: !0,
  maxAutoHeightCount: 1e3
};
function tu(r) {
  return r === !0 ? "always" : r === !1 ? "none" : r || "always";
}
function ct({ ref: r, ...e }) {
  const { icon: t, id: n, className: i, extend: o, ...s } = e, l = `univerjs-icon univerjs-icon-${n} ${i || ""}`.trim(), a = Tn(`_${Hw()}`);
  return Fm(t, `${n}`, {
    defIds: t.defIds,
    idSuffix: a.current
  }, {
    ref: r,
    className: l,
    ...s
  }, o);
}
function Fm(r, e, t, n, i) {
  return st(r.tag, {
    key: e,
    ...Ow(r, t, i),
    ...n
  }, (Aw(r, t).children || []).map((o, s) => Fm(o, `${e}-${r.tag}-${s}`, t, void 0, i)));
}
function Ow(r, e, t) {
  const n = { ...r.attrs };
  t != null && t.colorChannel1 && n.fill === "colorChannel1" && (n.fill = t.colorChannel1), r.tag === "mask" && n.id && (n.id = n.id + e.idSuffix), Object.entries(n).forEach(([o, s]) => {
    o === "mask" && typeof s == "string" && (n[o] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  });
  const { defIds: i } = e;
  return !i || i.length === 0 || (r.tag === "use" && n["xlink:href"] && (n["xlink:href"] = n["xlink:href"] + e.idSuffix), Object.entries(n).forEach(([o, s]) => {
    typeof s == "string" && (n[o] = s.replace(/url\(#(.*)\)/, `url(#$1${e.idSuffix})`));
  })), n;
}
function Aw(r, e) {
  var n;
  const { defIds: t } = e;
  return !t || t.length === 0 ? r : r.tag === "defs" && ((n = r.children) != null && n.length) ? {
    ...r,
    children: r.children.map((i) => typeof i.attrs.id == "string" && t && t.includes(i.attrs.id) ? {
      ...i,
      attrs: {
        ...i.attrs,
        id: i.attrs.id + e.idSuffix
      }
    } : i)
  } : r;
}
function Hw() {
  return Math.random().toString(36).substring(2, 8);
}
ct.displayName = "UniverIcon";
const Vw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, Dr = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "check-mark-icon",
    ref: t,
    icon: Vw
  }));
});
Dr.displayName = "CheckMarkIcon";
const Nw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z"
    }
  }]
}, Um = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "close-icon",
    ref: t,
    icon: Nw
  }));
});
Um.displayName = "CloseIcon";
const kw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "g",
    attrs: {
      fill: "currentColor",
      clipPath: "url(#convert-icon_clip0_911_593)"
    },
    children: [
      {
        tag: "path",
        attrs: {
          d: "M2.44766 0.848145C1.564 0.848145 0.847656 1.56449 0.847656 2.44814V6.44814C0.847656 7.3318 1.564 8.04814 2.44766 8.04814H6.44766C7.33131 8.04814 8.04766 7.3318 8.04766 6.44814V2.44814C8.04766 1.56449 7.33131 0.848145 6.44766 0.848145H2.44766ZM2.04766 6.44814V5.04824H3.84775V6.84814H2.44766C2.22674 6.84814 2.04766 6.66906 2.04766 6.44814ZM2.04766 3.84824H3.84775V2.04814H2.44766C2.22674 2.04814 2.04766 2.22723 2.04766 2.44814V3.84824ZM5.04775 6.84814V5.04824H6.84766V6.44814C6.84766 6.66906 6.66857 6.84814 6.44766 6.84814H5.04775ZM5.04775 3.84824H6.84766V2.44814C6.84766 2.22723 6.66857 2.04814 6.44766 2.04814H5.04775V3.84824Z",
          fillRule: "evenodd",
          clipRule: "evenodd"
        }
      },
      {
        tag: "path",
        attrs: {
          d: "M9.55215 7.95166C8.66849 7.95166 7.95215 8.668 7.95215 9.55166V13.5517C7.95215 14.4353 8.66849 15.1517 9.55215 15.1517L11.5522 15.1517L13.5521 15.1517C14.4358 15.1517 15.1521 14.4353 15.1521 13.5517L15.1521 11.5518L15.1521 9.55166C15.1521 8.668 14.4358 7.95166 13.5521 7.95166H9.55215ZM13.9521 10.9518V9.55166C13.9521 9.33075 13.7731 9.15166 13.5521 9.15166H12.1522V10.9518H13.9521ZM10.9522 10.9518V9.15166H9.55215C9.33123 9.15166 9.15215 9.33075 9.15215 9.55166V10.9518H10.9522ZM9.15215 12.1518H10.9522V13.9517H9.55215C9.33123 13.9517 9.15215 13.7726 9.15215 13.5517V12.1518ZM12.1522 12.1518H13.9521V13.5517C13.9521 13.7726 13.7731 13.9517 13.5521 13.9517H12.1522V12.1518Z",
          fillRule: "evenodd",
          clipRule: "evenodd"
        }
      },
      {
        tag: "path",
        attrs: { d: "M9.62158 2.44912C9.62158 2.11775 9.89021 1.84912 10.2216 1.84912H12.7516C13.6352 1.84912 14.3516 2.56547 14.3516 3.44912V5.9791C14.3516 6.31047 14.0829 6.5791 13.7516 6.5791C13.4202 6.5791 13.1516 6.31047 13.1516 5.9791V3.44912C13.1516 3.22821 12.9725 3.04912 12.7516 3.04912H10.2216C9.89021 3.04912 9.62158 2.78049 9.62158 2.44912Z" }
      },
      {
        tag: "path",
        attrs: { d: "M5.77871 14.1507C6.11008 14.1507 6.37871 13.8821 6.37871 13.5507C6.37871 13.2193 6.11008 12.9507 5.77871 12.9507L3.24873 12.9507C3.02782 12.9507 2.84873 12.7716 2.84873 12.5507L2.84873 10.0207C2.84873 9.68933 2.5801 9.4207 2.24873 9.4207C1.91736 9.4207 1.64873 9.68933 1.64873 10.0207L1.64873 12.5507C1.64873 13.4343 2.36507 14.1507 3.24873 14.1507H5.77871Z" }
      }
    ]
  }, {
    tag: "defs",
    attrs: {},
    children: [{
      tag: "clipPath",
      attrs: { id: "convert-icon_clip0_911_593" },
      children: [{
        tag: "path",
        attrs: {
          fill: "white",
          d: "M0 0H16V16H0z"
        }
      }]
    }]
  }],
  defIds: ["convert-icon_clip0_911_593"]
}, Xm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "convert-icon",
    ref: t,
    icon: kw
  }));
});
Xm.displayName = "ConvertIcon";
const Dw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.3313 1.4667C5.3313 1.13533 5.59993 0.866699 5.9313 0.866699H10.069C10.4004 0.866699 10.669 1.13533 10.669 1.4667C10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443C14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928L9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171C10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778L9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539C9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263L6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539C5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778L6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
}, Pa = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "delete-icon",
    ref: t,
    icon: Dw
  }));
});
Pa.displayName = "DeleteIcon";
const Lw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.85869 12.9216C8.38445 13.4708 7.61555 13.4708 7.14131 12.9216L0.358114 5.06726C-0.406895 4.18144 0.134916 2.66683 1.2168 2.66683L14.7832 2.66683C15.8651 2.66683 16.4069 4.18144 15.6419 5.06726L8.85869 12.9216Z"
    }
  }]
}, zm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "dropdown-icon",
    ref: t,
    icon: Lw
  }));
});
zm.displayName = "DropdownIcon";
const Ww = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM10.3097 5.69014C10.544 5.92445 10.544 6.30435 10.3097 6.53867L8.84843 7.9999L10.3099 9.46137C10.5442 9.69569 10.5442 10.0756 10.3099 10.3099C10.0756 10.5442 9.69569 10.5442 9.46137 10.3099L7.9999 8.84843L6.53842 10.3099C6.30411 10.5442 5.92421 10.5442 5.6899 10.3099C5.45558 10.0756 5.45558 9.69569 5.6899 9.46137L7.15137 7.9999L5.69014 6.53867C5.45583 6.30435 5.45583 5.92445 5.69014 5.69014C5.92445 5.45583 6.30435 5.45583 6.53867 5.69014L7.9999 7.15137L9.46113 5.69014C9.69544 5.45583 10.0753 5.45583 10.3097 5.69014Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, nu = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "error-icon",
    ref: t,
    icon: Ww
  }));
});
nu.displayName = "ErrorIcon";
const Bw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.28096 4.6541C1.57489 4.50109 1.93721 4.61533 2.09022 4.90926C2.27315 5.26067 2.55999 5.60455 2.94829 5.92278C4.04628 6.82266 5.87505 7.44865 7.99828 7.44865C10.1215 7.44865 11.9503 6.82267 13.0482 5.92279C13.4366 5.60455 13.7234 5.26067 13.9063 4.90927C14.0594 4.61533 14.4217 4.50109 14.7156 4.65409C15.0095 4.8071 15.1238 5.16941 14.9708 5.46334C14.6995 5.98445 14.2981 6.44997 13.8089 6.8509C13.7298 6.91575 13.6481 6.97914 13.564 7.041L15.2245 8.70153C15.4588 8.93585 15.4588 9.31575 15.2245 9.55006C14.9902 9.78438 14.6103 9.78438 14.376 9.55006L12.5041 7.67822C11.8977 7.97568 11.2181 8.21208 10.4884 8.37706L11.0996 10.6581C11.1853 10.9782 10.9954 11.3072 10.6753 11.393C10.3552 11.4787 10.0262 11.2888 9.94045 10.9687L9.29949 8.57652C8.8758 8.62404 8.44081 8.64865 7.99828 8.64865C7.55276 8.64865 7.11487 8.62371 6.68846 8.57555L6.04723 10.9687C5.96147 11.2888 5.63247 11.4788 5.31239 11.393C4.99231 11.3073 4.80236 10.9783 4.88812 10.6582L5.49983 8.37516C4.7743 8.2105 4.09843 7.9752 3.49498 7.67947L1.62436 9.55009C1.39005 9.78441 1.01015 9.78441 0.775835 9.5501C0.54152 9.31578 0.541518 8.93588 0.775832 8.70157L2.43478 7.04261C2.34987 6.98024 2.26746 6.91632 2.18764 6.8509C1.69842 6.44997 1.29706 5.98445 1.0258 5.46335C0.872791 5.16942 0.987031 4.80711 1.28096 4.6541Z"
    }
  }]
}, jm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "eyelash-icon",
    ref: t,
    icon: Bw
  }));
});
jm.displayName = "EyelashIcon";
const Fw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 17",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M6.06409 5.53454C5.93592 5.53454 5.84083 5.41567 5.86897 5.29063L5.95442 4.9109C6.05444 4.48178 6.23806 4.11547 6.51182 3.81952C6.81082 3.49628 7.25398 3.35405 7.79738 3.35405C7.99847 3.35405 8.21359 3.37775 8.44188 3.42245C8.46089 3.42617 8.47974 3.43006 8.49846 3.4341C8.7099 3.4798 8.93698 3.38478 9.02031 3.18514L9.24767 2.6404C9.33457 2.43219 9.23178 2.19404 9.01582 2.12874C8.98358 2.11899 8.95028 2.10912 8.91591 2.09914C8.62745 2.01631 8.28392 1.97217 7.88074 1.97217C6.82015 1.97217 6.02714 2.23936 5.4746 2.7444C4.90987 3.26069 4.50889 3.99917 4.28413 4.9762L2.83703 11.1909C2.76126 11.5286 2.666 11.8917 2.54844 12.2812C2.42975 12.6734 2.2873 13.0595 2.12221 13.4373C1.95577 13.8159 1.76813 14.1762 1.55955 14.5171C1.49345 14.6251 1.42515 14.7282 1.35467 14.8263C1.26508 14.9509 1.3347 15.133 1.48655 15.1554C2.13635 15.2509 2.8179 15.0763 3.18197 14.5296C3.32661 14.3124 3.46779 14.0646 3.60509 13.7851C3.96635 13.0497 4.30522 12.0103 4.61867 10.6574L5.469 7.01534C5.49013 6.92483 5.57082 6.86081 5.66376 6.86081H7.62478C7.8097 6.86081 7.97051 6.73405 8.01371 6.55425L8.14014 6.02798C8.20057 5.77642 8.00992 5.53454 7.75121 5.53454H6.06409Z"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.3211 5.72037L12.5124 7.96963L11.4089 5.77754C11.3422 5.63012 11.1954 5.5354 11.0336 5.5354H10.3129C10.0085 5.5354 9.80921 5.85428 9.9427 6.1279L11.4089 9.05502L8.79783 12.1493C8.56587 12.4158 8.75519 12.8315 9.10855 12.8315H9.68607C9.80672 12.8315 9.9605 12.7822 10.0388 12.6904L12.1108 10.2648L13.1176 12.561C13.1786 12.7231 13.333 12.8315 13.5061 12.8315H14.3C14.5831 12.8315 14.7417 12.6175 14.6426 12.3524L13.1728 9.28628C13.1728 9.28628 15.4009 6.45542 15.6013 6.17892C15.7966 5.90929 15.6023 5.5354 15.2693 5.5354H14.6661C14.5275 5.5354 14.4333 5.58887 14.3211 5.72037Z"
    }
  }]
}, Ym = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "fx-icon",
    ref: t,
    icon: Fw
  }));
});
Ym.displayName = "FxIcon";
const Uw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z"
    }
  }]
}, ru = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "increase-icon",
    ref: t,
    icon: Uw
  }));
});
ru.displayName = "IncreaseIcon";
const Xw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M8.00016 1.33203C6.68162 1.33203 5.39269 1.72302 4.29636 2.45557C3.20004 3.18811 2.34555 4.2293 1.84097 5.44747C1.33638 6.66565 1.20436 8.00609 1.4616 9.2993C1.71883 10.5925 2.35377 11.7804 3.28612 12.7127C4.21847 13.6451 5.40636 14.28 6.69956 14.5373C7.99277 14.7945 9.33321 14.6625 10.5514 14.1579C11.7696 13.6533 12.8108 12.7988 13.5433 11.7025C14.2758 10.6062 14.6668 9.31724 14.6668 7.9987C14.6649 6.23118 13.9619 4.53662 12.7121 3.2868C11.4622 2.03697 9.76768 1.33397 8.00016 1.33203ZM7.66683 3.9987C7.86461 3.9987 8.05795 4.05735 8.2224 4.16723C8.38685 4.27711 8.51502 4.43329 8.59071 4.61601C8.6664 4.79874 8.6862 4.99981 8.64762 5.19379C8.60903 5.38777 8.51379 5.56595 8.37394 5.7058C8.23409 5.84566 8.0559 5.9409 7.86192 5.97948C7.66794 6.01807 7.46687 5.99826 7.28415 5.92258C7.10142 5.84689 6.94524 5.71872 6.83536 5.55427C6.72548 5.38982 6.66683 5.19648 6.66683 4.9987C6.66683 4.73348 6.77219 4.47913 6.95972 4.29159C7.14726 4.10405 7.40162 3.9987 7.66683 3.9987ZM9.3335 11.332H6.66683C6.49002 11.332 6.32045 11.2618 6.19543 11.1368C6.0704 11.0117 6.00016 10.8422 6.00016 10.6654C6.00016 10.4886 6.0704 10.319 6.19543 10.194C6.32045 10.0689 6.49002 9.9987 6.66683 9.9987H7.3335V7.9987H6.66683C6.49002 7.9987 6.32045 7.92846 6.19543 7.80343C6.0704 7.67841 6.00016 7.50884 6.00016 7.33203C6.00016 7.15522 6.0704 6.98565 6.19543 6.86063C6.32045 6.7356 6.49002 6.66536 6.66683 6.66536H8.00016C8.17698 6.66536 8.34655 6.7356 8.47157 6.86063C8.59659 6.98565 8.66683 7.15522 8.66683 7.33203V9.9987H9.3335C9.51031 9.9987 9.67988 10.0689 9.8049 10.194C9.92993 10.319 10.0002 10.4886 10.0002 10.6654C10.0002 10.8422 9.92993 11.0117 9.8049 11.1368C9.67988 11.2618 9.51031 11.332 9.3335 11.332Z"
    }
  }]
}, Zm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "info-icon",
    ref: t,
    icon: Xw
  }));
});
Zm.displayName = "InfoIcon";
const zw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.62402 7.72905C2.58427 7.72905 2.55205 7.76127 2.55205 7.80102V13.6782C2.55205 13.7179 2.58427 13.7502 2.62402 13.7502H13.3755C13.4152 13.7502 13.4474 13.7179 13.4474 13.6782V7.80102C13.4474 7.76127 13.4152 7.72905 13.3755 7.72905H2.62402ZM1.35205 7.80102C1.35205 7.09853 1.92153 6.52905 2.62402 6.52905H13.3755C14.0779 6.52905 14.6474 7.09853 14.6474 7.80102V13.6782C14.6474 14.3807 14.0779 14.9502 13.3755 14.9502H2.62402C1.92153 14.9502 1.35205 14.3807 1.35205 13.6782V7.80102Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8 2.25005C6.69847 2.25003 5.64336 3.30513 5.64336 4.60666V7.12895C5.64336 7.46032 5.37473 7.72895 5.04336 7.72895C4.71199 7.72895 4.44336 7.46032 4.44336 7.12895V4.60666C4.44336 2.64239 6.04451 1.05565 8.00879 1.05566M8 2.25005L8.00879 1.05566L8 2.25005ZM8.00879 1.05566L8 2.25005C9.30154 2.25003 10.3567 3.30513 10.3567 4.60666V7.12895C10.3567 7.46032 10.6253 7.72895 10.9567 7.72895C11.288 7.72895 11.5567 7.46032 11.5567 7.12895V4.60666C11.5567 2.64239 9.97306 1.05565 8.00879 1.05566Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.00039 9.4668C8.33176 9.4668 8.60039 9.73543 8.60039 10.0668V12.0827C8.60039 12.4141 8.33176 12.6827 8.00039 12.6827C7.66902 12.6827 7.40039 12.4141 7.40039 12.0827V10.0668C7.40039 9.73543 7.66902 9.4668 8.00039 9.4668Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
}, iu = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "lock-icon",
    ref: t,
    icon: zw
  }));
});
iu.displayName = "LockIcon";
const jw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M11.3536 6.14645C11.5488 6.34171 11.5488 6.65829 11.3536 6.85355L8.35355 9.85355C8.15829 10.0488 7.84171 10.0488 7.64645 9.85355L4.64645 6.85355C4.45118 6.65829 4.45118 6.34171 4.64645 6.14645C4.84171 5.95118 5.15829 5.95118 5.35355 6.14645L8 8.79289L10.6464 6.14645C10.8417 5.95118 11.1583 5.95118 11.3536 6.14645Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, _i = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "more-down-icon",
    ref: t,
    icon: jw
  }));
});
_i.displayName = "MoreDownIcon";
const Yw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, jc = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "more-icon",
    ref: t,
    icon: Yw
  }));
});
jc.displayName = "MoreIcon";
const Zw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M12.666 2.70571C11.7769 1.76476 10.3295 1.76476 9.4404 2.70571L3.37843 9.12427C3.31779 9.18848 3.27756 9.26409 3.24979 9.3439C3.24809 9.3493 3.24299 9.3529 3.24129 9.3583L2.02912 13.2097C1.96112 13.4251 2.01439 13.6633 2.16626 13.8236C2.27393 13.9382 2.41901 14 2.56692 14C2.62699 14 2.68762 13.9898 2.74599 13.9688L6.3825 12.6846C6.3876 12.6828 6.391 12.678 6.39553 12.6762C6.47147 12.6474 6.54287 12.6042 6.60351 12.54L12.666 6.12202C13.5558 5.18048 13.5558 3.64725 12.666 2.70571ZM8.62832 5.26209L9.04031 5.69836C9.03918 5.69956 9.03748 5.70016 9.03634 5.70136L4.99182 9.9836L4.58096 9.54853L8.62832 5.26209ZM3.46287 12.4512L4.02673 10.6593L5.15446 11.8535L3.46287 12.4512ZM6.20342 11.2672L5.79256 10.8321L9.83709 6.54988C9.83822 6.54868 9.83879 6.54688 9.83992 6.54568L10.2513 6.98135L6.20342 11.2672ZM11.8647 5.27349L11.0532 6.13282L9.42963 4.41356L10.2411 3.55423C10.6888 3.08016 11.417 3.08076 11.8642 3.55423C12.3124 4.0283 12.3124 4.79942 11.8647 5.27349Z"
    }
  }]
}, Gm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "pen-icon",
    ref: t,
    icon: Zw
  }));
});
Gm.displayName = "PenIcon";
const Gw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M5.785 6.77762C5.78908 6.7777 5.79316 6.77774 5.79725 6.77774C5.80134 6.77774 5.80543 6.7777 5.8095 6.77762H10.0184C10.0225 6.7777 10.0266 6.77774 10.0307 6.77774C10.0347 6.77774 10.0388 6.7777 10.0429 6.77762H13.6638V7.63727C13.6638 7.96864 13.9324 8.23727 14.2638 8.23727C14.5951 8.23727 14.8638 7.96864 14.8638 7.63727V3.9999C14.8638 2.56395 13.6997 1.39989 12.2637 1.3999L3.56389 1.39999C2.12797 1.40001 0.96393 2.56405 0.96392 3.99998L0.963867 11.6666C0.963857 13.1025 2.12792 14.2666 3.56387 14.2666H8.0542C8.38557 14.2666 8.6542 13.9979 8.6542 13.6666C8.6542 13.3352 8.38557 13.0666 8.0542 13.0666H3.56387C2.79067 13.0666 2.16386 12.4398 2.16387 11.6666L2.1639 6.77762H5.785ZM6.39725 2.59996L9.43065 2.59993V5.57762H6.39725V2.59996ZM5.19725 5.57762V2.59998L3.56391 2.59999C2.79072 2.6 2.16393 3.22679 2.16392 3.99998L2.16391 5.57762H5.19725ZM13.6638 5.57762V3.9999C13.6638 3.2267 13.037 2.59989 12.2638 2.5999L10.6307 2.59992V5.57762H13.6638Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M14.1223 10.2333V10.7496C14.7087 10.9869 15.1223 11.5618 15.1223 12.2333V12.8999C15.1223 13.7836 14.406 14.4999 13.5223 14.4999H11.5223C10.6387 14.4999 9.92235 13.7836 9.92235 12.8999V12.2333C9.92235 11.5618 10.336 10.9869 10.9223 10.7496V10.2333C10.9223 9.34961 11.6387 8.63328 12.5223 8.63328C13.406 8.63328 14.1223 9.34961 14.1223 10.2333ZM11.1223 12.2333C11.1223 12.0124 11.3014 11.8333 11.5223 11.8333H13.5223C13.7433 11.8333 13.9223 12.0124 13.9223 12.2333V12.8999C13.9223 13.1209 13.7433 13.2999 13.5223 13.2999H11.5223C11.3014 13.2999 11.1223 13.1209 11.1223 12.8999V12.2333ZM12.9223 10.2333V10.6333H12.1223V10.2333C12.1223 10.0124 12.3014 9.83328 12.5223 9.83328C12.7433 9.83328 12.9223 10.0124 12.9223 10.2333Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, qm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "protect-icon",
    ref: t,
    icon: Gw
  }));
});
qm.displayName = "ProtectIcon";
const qw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M15 8C15 11.866 11.866 15 8 15C4.13401 15 1 11.866 1 8C1 4.13401 4.13401 1 8 1C11.866 1 15 4.13401 15 8ZM8.00008 12.3671C8.46031 12.3671 8.83342 11.994 8.83342 11.5338C8.83342 11.0735 8.46031 10.7004 8.00008 10.7004C7.53985 10.7004 7.16675 11.0735 7.16675 11.5338C7.16675 11.994 7.53985 12.3671 8.00008 12.3671ZM8.5999 4.4335C8.5999 4.10213 8.33127 3.8335 7.9999 3.8335C7.66853 3.8335 7.3999 4.10213 7.3999 4.4335V9.36683C7.3999 9.6982 7.66853 9.96683 7.9999 9.96683C8.33127 9.96683 8.5999 9.6982 8.5999 9.36683V4.4335Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, Qm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "warning-icon",
    ref: t,
    icon: qw
  }));
});
Qm.displayName = "WarningIcon";
const Qw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M12.6551 1.98906C11.7476 1.08113 10.2757 1.08149 9.3686 1.98987L4.82542 6.53955C4.75087 6.61421 4.69336 6.70411 4.65682 6.80309L3.2461 10.625C3.16506 10.8446 3.21909 11.0912 3.3845 11.2568C3.54991 11.4224 3.79651 11.4767 4.01616 11.3959L7.85031 9.98517C7.94979 9.94856 8.04014 9.89077 8.11508 9.81579L12.6552 5.27327C13.5618 4.36621 13.5618 2.89607 12.6551 1.98906ZM10.2177 2.83779C10.6562 2.39869 11.3677 2.39851 11.8064 2.8374C12.2447 3.27584 12.2447 3.9865 11.8065 4.42497L7.3392 8.89457L4.82213 9.82068L5.74706 7.31487L10.2177 2.83779Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.79238 13.2999C1.46101 13.2999 1.19238 13.5685 1.19238 13.8999C1.19238 14.2313 1.46101 14.4999 1.79238 14.4999H14.4924C14.8238 14.4999 15.0924 14.2313 15.0924 13.8999C15.0924 13.5685 14.8238 13.2999 14.4924 13.2999H1.79238Z"
    }
  }]
}, ou = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "write-icon",
    ref: t,
    icon: Qw
  }));
});
ou.displayName = "WriteIcon";
const Kw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M11.0363 12.2367V14.0367C11.0363 14.3681 11.3049 14.6367 11.6363 14.6367C11.9676 14.6367 12.2363 14.3681 12.2363 14.0367V12.2367H14.0364C14.3677 12.2367 14.6364 11.9681 14.6364 11.6367C14.6364 11.3054 14.3677 11.0367 14.0364 11.0367H12.2363V9.23672C12.2363 8.90535 11.9676 8.63672 11.6363 8.63672C11.3049 8.63672 11.0363 8.90535 11.0363 9.23672V11.0367H9.23635C8.90498 11.0367 8.63635 11.3054 8.63635 11.6367C8.63635 11.9681 8.90498 12.2367 9.23635 12.2367H11.0363Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.56365 1.36377C1.90091 1.36377 1.36365 1.90103 1.36365 2.56377V6.16377C1.36365 6.82651 1.90091 7.36377 2.56365 7.36377H6.16365C6.82639 7.36377 7.36365 6.82651 7.36365 6.16377V2.56377C7.36365 1.90103 6.82639 1.36377 6.16365 1.36377H2.56365ZM6.16365 2.56377H2.56365L2.56365 6.16377H6.16365V2.56377Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M2.56365 8.63647C1.90091 8.63647 1.36365 9.17373 1.36365 9.83647V13.4365C1.36365 14.0992 1.90091 14.6365 2.56365 14.6365H6.16365C6.82639 14.6365 7.36365 14.0992 7.36365 13.4365V9.83647C7.36365 9.17373 6.82639 8.63647 6.16365 8.63647H2.56365ZM6.16365 9.83647H2.56365L2.56365 13.4365H6.16365V9.83647Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M9.83635 7.36377C9.17361 7.36377 8.63635 6.82651 8.63635 6.16377V2.56377C8.63635 1.90103 9.17361 1.36377 9.83635 1.36377H13.4364C14.0991 1.36377 14.6364 1.90103 14.6364 2.56377V6.16377C14.6364 6.82651 14.0991 7.36377 13.4364 7.36377H9.83635ZM9.83635 6.16377V2.56377L13.4364 2.56377V6.16377H9.83635Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
}, Km = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "autofill-double-icon",
    ref: t,
    icon: Kw
  }));
});
Km.displayName = "AutofillDoubleIcon";
const Jw = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [{
    tag: "path",
    attrs: {
      fill: "colorChannel1",
      d: "M6.4833 1.65005C6.4833 1.31868 6.21467 1.05005 5.8833 1.05005C5.55193 1.05005 5.2833 1.31868 5.2833 1.65005V5.28345H1.65029C1.31892 5.28345 1.05029 5.55208 1.05029 5.88345C1.05029 6.21482 1.31892 6.48345 1.65029 6.48345H5.2833V9.51684H1.65029C1.31892 9.51684 1.05029 9.78547 1.05029 10.1168C1.05029 10.4482 1.31892 10.7168 1.65029 10.7168H5.2833V14.35C5.2833 14.6814 5.55193 14.95 5.8833 14.95C6.21467 14.95 6.4833 14.6814 6.4833 14.35V10.7168H9.5167V14.35C9.5167 14.6814 9.78533 14.95 10.1167 14.95C10.4481 14.95 10.7167 14.6814 10.7167 14.35V10.7168H14.3503C14.6817 10.7168 14.9503 10.4482 14.9503 10.1168C14.9503 9.78547 14.6817 9.51685 14.3503 9.51685H10.7167V6.48345H14.3503C14.6817 6.48345 14.9503 6.21482 14.9503 5.88345C14.9503 5.55208 14.6817 5.28345 14.3503 5.28345H10.7167V1.65005C10.7167 1.31868 10.4481 1.05005 10.1167 1.05005C9.78533 1.05005 9.5167 1.31868 9.5167 1.65005V5.28345L6.4833 5.28345V1.65005ZM6.4833 6.48345V9.51684L9.5167 9.51685V6.48345L6.4833 6.48345Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }, {
    tag: "path",
    attrs: {
      fill: "currentColor",
      d: "M1.0498 3.65005C1.0498 2.21411 2.21386 1.05005 3.6498 1.05005H12.3498C13.7857 1.05005 14.9498 2.21411 14.9498 3.65005V12.3501C14.9498 13.786 13.7857 14.95 12.3498 14.95H3.6498C2.21386 14.95 1.0498 13.786 1.0498 12.35V3.65005ZM3.6498 2.25005C2.87661 2.25005 2.2498 2.87685 2.2498 3.65005V12.35C2.2498 13.1232 2.87661 13.75 3.6498 13.75H12.3498C13.123 13.75 13.7498 13.1232 13.7498 12.3501V3.65005C13.7498 2.87685 13.123 2.25005 12.3498 2.25005H3.6498Z",
      fillRule: "evenodd",
      clipRule: "evenodd"
    }
  }]
}, su = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "hide-gridlines-double-icon",
    ref: t,
    icon: Jw
  }));
});
su.displayName = "HideGridlinesDoubleIcon";
const $w = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 17 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M8.01281 1.36643C8.79386 0.585377 10.0602 0.585378 10.8412 1.36643L12.9223 3.44752C13.7034 4.22857 13.7034 5.4949 12.9223 6.27595L9.36445 9.83383C8.5834 10.6149 7.31707 10.6149 6.53602 9.83383L4.45493 7.75273C3.67388 6.97168 3.67388 5.70535 4.45493 4.9243L8.01281 1.36643ZM9.9927 2.21495C9.68028 1.90253 9.17375 1.90253 8.86133 2.21495L5.30346 5.77283L5.29671 5.77966L10.839 6.66224L12.0738 5.42742C12.3862 5.115 12.3862 4.60847 12.0738 4.29605L9.9927 2.21495Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M14.5179 9.48875C14.5179 9.99175 14.1101 10.3995 13.607 10.3995C13.1041 10.3995 12.6963 9.99175 12.6963 9.48875C12.6963 9.1773 13.0455 8.59966 13.3114 8.20487C13.4549 7.99177 13.7591 7.99177 13.9027 8.20486C14.1687 8.59965 14.5179 9.1773 14.5179 9.48875Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M1.98682 13.4992C1.98682 12.5603 2.74793 11.7992 3.68682 11.7992H14.2868C15.2257 11.7992 15.9868 12.5603 15.9868 13.4992V13.4992C15.9868 14.4381 15.2257 15.1992 14.2868 15.1992H3.68682C2.74793 15.1992 1.98682 14.4381 1.98682 13.4992V13.4992Z"
      }
    }
  ]
}, Jm = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "paint-bucket-double-icon",
    ref: t,
    icon: $w
  }));
});
Jm.displayName = "PaintBucketDoubleIcon";
const e0 = {
  tag: "svg",
  attrs: {
    xmlns: "http://www.w3.org/2000/svg",
    fill: "none",
    viewBox: "0 0 16 16",
    width: "1em",
    height: "1em"
  },
  children: [
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M7.74692 9.12463C7.74692 9.46018 8.01893 9.73219 8.35448 9.73219H11.4933C11.8288 9.73219 12.1009 9.46018 12.1009 9.12463C12.1009 8.78909 11.8288 8.51707 11.4933 8.51707H8.35448C8.01893 8.51707 7.74692 8.78909 7.74692 9.12463Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "colorChannel1",
        d: "M10.8636 10.8523C10.8636 11.1879 10.5915 11.4599 10.256 11.4599H8.35448C8.01893 11.4599 7.74692 11.1879 7.74692 10.8523C7.74692 10.5168 8.01893 10.2447 8.35448 10.2447H10.256C10.5915 10.2447 10.8636 10.5168 10.8636 10.8523Z"
      }
    },
    {
      tag: "path",
      attrs: {
        fill: "currentColor",
        d: "M5.4791 1.98268C5.47913 1.71529 5.87912 1.49854 6.37252 1.49854C6.86593 1.49854 7.26592 1.71529 7.26595 1.98268H7.62187C8.22277 1.98268 8.72459 2.39534 8.84412 2.9452H9.39563C10.0856 2.9452 10.6449 3.48923 10.6449 4.16032V6.00569H12.1261C13.161 6.00569 14 6.82174 14 7.82838V11.334C14 11.8174 13.8025 12.281 13.4511 12.6228L12.0693 13.9647C11.7179 14.3065 11.2412 14.4985 10.7442 14.4985H7.91116C7.05024 14.4985 6.32492 14.0431 6.10535 13.2737H3.34925C2.6593 13.2737 2.09998 12.7297 2.09998 12.0586V4.16032C2.09998 3.48923 2.6593 2.9452 3.34925 2.9452H3.90107C4.0206 2.39534 4.52241 1.98268 5.12332 1.98268H5.4791ZM3.97249 4.16032H3.24925L3.24925 12.0586H6.03725V7.82838C6.03725 6.82174 6.87623 6.00569 7.91116 6.00569H9.49563V4.16032H8.7727C8.58289 4.59611 8.13909 4.90183 7.62187 4.90183H5.12332C4.6061 4.90183 4.1623 4.59611 3.97249 4.16032ZM5.12332 2.89403H7.62187C7.79436 2.89403 7.93419 3.03003 7.93419 3.19781V3.68671C7.93419 3.85448 7.79436 3.99049 7.62187 3.99049H5.12332C4.95083 3.99049 4.811 3.85448 4.811 3.68671V3.19781C4.811 3.03003 4.95083 2.89403 5.12332 2.89403ZM7.91116 7.11157C7.56618 7.11157 7.28652 7.38359 7.28652 7.71913V12.7851C7.28652 13.1206 7.56618 13.3927 7.91116 13.3927H10.7442C10.8401 13.3927 10.9337 13.3712 11.0182 13.3311C11.1373 13.2746 11.1859 13.1423 11.1859 13.0134V12.0066C11.1859 11.8724 11.2978 11.7636 11.4358 11.7636H12.4709C12.6034 11.7636 12.7394 11.7163 12.7975 11.6004C12.8388 11.5182 12.8608 11.4272 12.8608 11.334V7.71913C12.8608 7.38359 12.5811 7.11157 12.2362 7.11157H7.91116Z",
        fillRule: "evenodd",
        clipRule: "evenodd"
      }
    }
  ]
}, $m = ut(function(e, t) {
  return st(ct, Object.assign({}, e, {
    id: "paste-special-double-icon",
    ref: t,
    icon: e0
  }));
});
$m.displayName = "PasteSpecialDoubleIcon";
const t0 = () => {
  const [, r] = re({});
  return An(() => r((e) => !e), []);
};
function n0() {
  const r = L(W), e = L(k), t = L(fe), n = L(Hr), i = L(xe), [o, s] = re([]), [l, a] = re(!1), [c, d] = re({ row: -1, col: -1 }), [u, h] = re(Le.SERIES), [g, m] = re(!1), f = kr(), { sheetSkeletonManagerService: v, selectionRenderService: p } = Ct(() => {
    if (f) {
      const G = t.getRenderById(f.getUnitId());
      return {
        sheetSkeletonManagerService: G == null ? void 0 : G.with(ue),
        selectionRenderService: G == null ? void 0 : G.with(gt)
      };
    }
    return { sheetSkeletonManagerService: null, selectionRenderService: null };
  }, [f, t]), S = () => {
    m(!0);
  }, w = () => {
    m(!1);
  }, C = t0();
  if (Ee(() => r.onCommandExecuted((ge, Re) => {
    ge.id === gn.id && C();
  }).dispose, [C, r]), Ee(() => {
    const G = v && We(
      v.currentSkeleton$.subscribe((ge) => {
        ge && C();
      })
    );
    return G == null ? void 0 : G.dispose;
  }, [v, C]), Ee(() => We(
    n.menu$.subscribe((ge) => {
      s(ge.map((Re) => ({ ...Re, index: ge.indexOf(Re) })));
    })
  ).dispose, [n]), Ee(() => We(
    n.showMenu$.subscribe((ge) => {
      const { source: Re, target: be } = n.autoFillLocation || { source: null, target: null };
      if (ge && Re && be) {
        const Ne = Math.max(Re.rows[Re.rows.length - 1], be.rows[be.rows.length - 1]), Z = Math.max(Re.cols[Re.cols.length - 1], be.cols[be.cols.length - 1]);
        d({ row: Ne, col: Z });
      } else
        d({ row: -1, col: -1 });
    })
  ).dispose, [n]), Ee(() => We(
    n.applyType$.subscribe((ge) => {
      h(ge);
    })
  ).dispose, [n]), Ee(() => {
    function G() {
      a(!1);
    }
    return document.addEventListener("wheel", G), () => {
      document.removeEventListener("wheel", G);
    };
  }, [l]), c.col < 0 || c.row < 0)
    return null;
  const I = en(e, t);
  if (!I || !p) return null;
  const { scene: R } = I, y = v == null ? void 0 : v.getCurrentSkeleton(), M = p.getViewPort(), E = R == null ? void 0 : R.scaleX, T = R == null ? void 0 : R.scaleY, P = R == null ? void 0 : R.getViewportScrollXY(M);
  if (!E || !R || !E || !T || !P) return null;
  const H = (y == null ? void 0 : y.getNoMergeCellWithCoordByIndex(c.row, c.col).endX) || 0, A = (y == null ? void 0 : y.getNoMergeCellWithCoordByIndex(c.row, c.col).endY) || 0, x = Gr(H, E, P), V = qr(A, T, P);
  if (x == null || V == null) return null;
  const D = (G) => {
    a(G);
  }, X = (G) => {
    r.executeCommand(va.id, { type: G.value }), a(!1);
  }, B = l || g, j = o.filter((G) => !G.disable);
  return /* @__PURE__ */ b("div", { className: "univer-absolute univer-inset-0 univer-z-10 univer-size-0", children: /* @__PURE__ */ b(
    "div",
    {
      className: "univer-absolute",
      style: { left: `${x + 2}px`, top: `${V + 2}px` },
      onMouseEnter: S,
      onMouseLeave: w,
      children: /* @__PURE__ */ b(
        Hd,
        {
          align: "start",
          items: j.map((G) => ({
            type: "radio",
            value: u,
            options: [{ label: i.t(G.label), value: G.value }],
            onSelect: () => X(G)
          })),
          open: l,
          onOpenChange: D,
          children: /* @__PURE__ */ q(
            "div",
            {
              className: Te("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800", Li, {
                "univer-bg-gray-100 dark:!univer-bg-gray-800": l,
                "univer-bg-white dark:!univer-bg-gray-900": !l
              }),
              children: [
                /* @__PURE__ */ b(
                  Km,
                  {
                    className: "univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"
                  }
                ),
                B && /* @__PURE__ */ b(_i, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      )
    }
  ) });
}
function ef(r, e) {
  const t = L(qe), n = L(W);
  return Ct(() => ({
    keyCodes: [
      { keyCode: Y.ENTER },
      { keyCode: Y.ESC },
      { keyCode: Y.TAB }
    ],
    handler: (o) => {
      (o === Y.ENTER || o === Y.ESC || o === Y.TAB) && (t.disableForceKeepVisible(), n.syncExecuteCommand(tt.id, {
        visible: !1,
        eventType: je.Keyboard,
        keycode: o,
        unitId: e
      }));
    }
  }), [n, t, e]);
}
const ul = -1e3, gh = {
  width: 0,
  height: 0,
  top: ul,
  left: ul
}, r0 = () => {
  const [r, e] = re({
    ...gh
  }), t = L(ls), n = L(Ni), i = L(De), o = L(kt), s = L(qe), l = dt(s.visible$), a = L(W), c = Tn(0), d = dt(
    () => i.subscribeContextValue$(Nu),
    !1,
    void 0,
    [i, Nu]
  ), u = o.get(Ld), h = s.getEditLocation();
  Ee(() => {
    const v = t.state$.subscribe((p) => {
      if (p == null)
        return;
      const {
        startX: S = ul,
        startY: w = ul,
        endX: C = 0,
        endY: I = 0,
        show: R = !1
      } = p;
      if (!R)
        e({
          ...gh
        });
      else {
        e({
          width: C - S,
          height: I - w,
          left: S,
          top: w
        });
        const y = n.getEditor(Oe);
        if (y == null)
          return;
        const { left: M, top: E, width: T, height: P } = y.getBoundingClientRect();
        t.setRect({ left: M, top: E, width: T, height: P });
      }
    });
    return () => {
      v.unsubscribe();
    };
  }, []), Ee(() => {
    d || t.setFocus(!0);
  }, [d, r]);
  const g = ku(() => {
    s.isVisible().visible && a.executeCommand(tt.id, {
      visible: !1,
      eventType: je.PointerUp,
      unitId: h == null ? void 0 : h.unitId
    });
  });
  Jg(g);
  const m = ef(c, h == null ? void 0 : h.unitId), f = ku((v, p) => {
    a.executeCommand(wi.id, {
      keycode: v,
      visible: !1,
      eventType: je.Keyboard,
      isShift: p === ve.SHIFT || p === (ve.CTRL_COMMAND | ve.SHIFT),
      unitId: h == null ? void 0 : h.unitId
    });
  });
  return /* @__PURE__ */ b(
    "div",
    {
      className: "univer-absolute univer-z-10 univer-flex",
      style: {
        left: r.left,
        top: r.top,
        width: r.width,
        height: r.height
      },
      children: u && /* @__PURE__ */ b(
        u,
        {
          editorId: Oe,
          className: "univer-relative univer-flex univer-h-full univer-w-full [&_canvas]:univer-absolute",
          initValue: "",
          onChange: () => {
          },
          isFocus: l == null ? void 0 : l.visible,
          unitId: h == null ? void 0 : h.unitId,
          subUnitId: h == null ? void 0 : h.sheetId,
          keyboardEventConfig: m,
          onMoveInEditor: f,
          isSupportAcrossSheet: !0,
          resetSelectionOnBlur: !1,
          isSingle: !1,
          autoScrollbar: !1,
          onFormulaSelectingChange: (v, p) => {
            c.current = v, p && (v ? s.enableForceKeepVisible() : s.disableForceKeepVisible());
          },
          disableSelectionOnClick: !0,
          disableContextMenu: !1
        }
      )
    }
  );
};
class tf {
  constructor() {
    _(this, "_position", null);
    _(this, "_position$", new Me(null));
    _(this, "position$", this._position$.asObservable());
    _(this, "_focus", !1);
    _(this, "_focus$", new Me(this._focus));
    _(this, "focus$", this._focus$.asObservable());
    _(this, "_fxBtnClick$", new He());
    _(this, "fxBtnClick$", this._fxBtnClick$.asObservable());
    _(this, "_foldBtnStatus$", new He());
    _(this, "foldBtnStatus$", this._foldBtnStatus$.asObservable());
  }
  dispose() {
    this._position$.complete(), this._focus$.complete(), this._position = null, this._focus = !1;
  }
  setPosition(e) {
    this._position = e, this._refresh(e);
  }
  getPosition() {
    return this._position;
  }
  setFocus(e = !1) {
    this._focus = e, this._focus$.next(e);
  }
  handleFxBtnClick(e) {
    this._fxBtnClick$.next(e);
  }
  handleFoldBtnClick(e) {
    this._foldBtnStatus$.next(e);
  }
  _refresh(e) {
    this._position$.next(e);
  }
}
const as = Yt(
  "univer.sheet-formula-editor-manager.service"
);
function i0() {
  const r = L(W), e = L(xe), t = L(Jo), n = L(k), i = L(Di), s = n.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId(), l = () => {
    const h = t.getDefinedNameMap(s);
    return h ? Array.from(Object.values(h)) : [];
  }, [a, c] = re(l());
  Ee(() => {
    const h = t.update$.subscribe(() => {
      c(l());
    });
    return () => {
      h.unsubscribe();
    };
  }, []), Ee(() => {
    const h = i.sidebarOptions$.subscribe((g) => {
      g.id === xo && (g.visible || setTimeout(() => {
        i.sidebarOptions$.next({ visible: !1 });
      }));
    });
    return () => {
      h.unsubscribe();
    };
  }, []);
  const d = () => {
    r.executeCommand(eu.id, { value: "open" });
  }, u = async (h) => {
    const { formulaOrRefString: g, id: m } = h, f = t.getWorksheetByRef(s, g);
    if (!f)
      return;
    f.isSheetHidden() && await r.executeCommand(pd.id, { unitId: s, subUnitId: f.getSheetId() }), t.focusRange(s, m);
  };
  return /* @__PURE__ */ q("div", { className: "univer-w-[300px]", children: [
    /* @__PURE__ */ b(
      "ul",
      {
        className: Te("univer-m-0 univer-max-h-[360px] univer-list-none univer-overflow-y-auto univer-p-0", ra),
        children: a.map((h, g) => /* @__PURE__ */ b(
          "li",
          {
            className: "univer-cursor-pointer univer-px-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",
            onClick: () => {
              u(h);
            },
            children: /* @__PURE__ */ q(
              "div",
              {
                className: Te("univer-flex univer-items-center univer-justify-between univer-gap-2 univer-py-1", Vd),
                children: [
                  /* @__PURE__ */ b(
                    "div",
                    {
                      className: "univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-sm univer-text-gray-600 dark:!univer-text-gray-200",
                      title: h.name,
                      children: h.name
                    }
                  ),
                  /* @__PURE__ */ b(
                    "div",
                    {
                      className: "univer-w-[50%] univer-flex-shrink-0 univer-truncate univer-text-xs univer-text-gray-400",
                      title: h.formulaOrRefString,
                      children: h.formulaOrRefString
                    }
                  )
                ]
              }
            )
          },
          g
        ))
      }
    ),
    /* @__PURE__ */ q(
      "div",
      {
        className: "univer-cursor-pointer univer-p-2 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-600",
        onClick: d,
        children: [
          /* @__PURE__ */ b(
            "div",
            {
              className: "univer-mb-2 univer-text-sm univer-font-semibold univer-text-gray-600 dark:!univer-text-gray-200",
              children: e.t("definedName.managerTitle")
            }
          ),
          /* @__PURE__ */ b("div", { className: "univer-text-xs univer-text-gray-400", children: e.t("definedName.managerDescription") })
        ]
      }
    )
  ] });
}
function o0({ disable: r }) {
  const [e, t] = re(""), n = L(Jo);
  Ee(() => {
    const o = n.currentRange$.subscribe(() => {
      t(n.getCurrentRangeForString());
    });
    return () => {
      o.unsubscribe();
    };
  }, []);
  function i() {
  }
  return /* @__PURE__ */ q(
    "div",
    {
      "data-u-comp": "defined-name",
      className: "univer-relative univer-box-border univer-flex univer-h-full univer-w-24 univer-border-r-gray-200 univer-py-1.5 univer-transition-all",
      children: [
        /* @__PURE__ */ b(
          "input",
          {
            className: Te("univer-box-border univer-h-full univer-w-full univer-appearance-none univer-px-1.5 univer-text-gray-900 focus:univer-outline-none dark:!univer-border-r-gray-700 dark:!univer-bg-gray-900 dark:!univer-text-white", Nd, {
              "univer-cursor-not-allowed": r
            }),
            type: "text",
            value: e,
            onChange: i
          }
        ),
        /* @__PURE__ */ b(
          kc,
          {
            overlay: /* @__PURE__ */ b("div", { className: "univer-z-[1001]", children: /* @__PURE__ */ b(i0, {}) }),
            disabled: r,
            children: /* @__PURE__ */ b(
              "a",
              {
                className: Te("univer-absolute univer-right-0 univer-top-0 univer-flex univer-h-full univer-cursor-pointer univer-items-center univer-justify-center univer-px-1 univer-transition-colors univer-duration-200 hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-800", {
                  "univer-cursor-not-allowed univer-text-gray-300 hover:univer-bg-transparent dark:!univer-text-gray-700": r
                }),
                children: /* @__PURE__ */ b(_i, {})
              }
            )
          }
        )
      ]
    }
  );
}
function s0(r) {
  var ne, pe, Ue, me;
  const { className: e, disableDefinedName: t } = r, [n, i] = re(!1), [o, s] = re(
    0
    /* Down */
  ), l = L(as), a = L(qe), c = L(ft), d = L($e), u = L(k), h = L(Q), g = L(rt), m = L(Zo), f = L(W), [v, p] = re({
    editDisable: !1,
    viewDisable: !1
  }), [S, w] = re(!1), C = L(kt), I = dt(() => u.getCurrentTypeOfUnit$(O.UNIVER_SHEET), void 0, void 0, []), R = Tn(0), y = dt(a.currentEditCellState$), M = ef(R, (ne = y == null ? void 0 : y.unitId) != null ? ne : ""), E = C.get(Ld), T = eC(Wm.FORMULA_AUX), P = L(De);
  dt(Ct(() => P.subscribeContextValue$(Ot), [P]));
  const H = P.getContextValue(Ot), A = Tn(null), x = L(Ni);
  mC(() => {
    const _e = I.activeSheet$.pipe(
      lt((le) => le ? St(
        c.ruleChange$,
        d.ruleChange$,
        h.selectionMoveEnd$,
        h.selectionSet$
      ).pipe(
        lt(() => {
          var Bn, Fn;
          const it = I.getUnitId(), ot = le.getSheetId();
          if (!((Bn = h.getCurrentLastSelection()) == null ? void 0 : Bn.range)) return xu;
          const wt = (Fn = h.getCurrentLastSelection()) == null ? void 0 : Fn.primary;
          return wt ? Ce({
            unitId: it,
            subUnitId: ot,
            primary: wt
          }) : Ce(null);
        })
      ) : xu)
    ).subscribe((le) => {
      var it, ot, vt, wt, Bn, Fn;
      if (le) {
        const { unitId: us, subUnitId: hs, primary: Np } = le;
        if (c.getRule(us, hs)) {
          const Lp = !((ot = (it = g.getPermissionPoint(new te(us, hs).id)) == null ? void 0 : it.value) == null || ot), Wp = !((wt = (vt = g.getPermissionPoint(new Sg(us, hs).id)) == null ? void 0 : vt.value) == null || wt);
          p({
            viewDisable: Wp,
            editDisable: Lp
          });
          return;
        }
        const { actualRow: kp, actualColumn: Dp } = Np, Lr = m.getCellInfo(us, hs, kp, Dp);
        p({
          editDisable: !((Bn = Lr == null ? void 0 : Lr[Co.Edit]) == null || Bn),
          viewDisable: !((Fn = Lr == null ? void 0 : Lr[Co.View]) == null || Fn)
        });
      } else
        p({
          viewDisable: !1,
          editDisable: !1
        });
    });
    return () => {
      _e.unsubscribe();
    };
  }, [I]), Ee(() => {
    const _e = a.visible$.subscribe((le) => {
      i(le.visible);
    });
    return () => _e.unsubscribe();
  }, [a.visible$]), Ee(() => {
    const _e = a.currentEditCellState$.subscribe((le) => {
      var it, ot, vt;
      (vt = (ot = (it = le == null ? void 0 : le.documentLayoutObject.documentModel) == null ? void 0 : it.getBody()) == null ? void 0 : ot.customBlocks) != null && vt.length ? w(!0) : w(!1);
    });
    return () => _e.unsubscribe();
  }, [a.currentEditCellState$]), Ee(() => {
    const _e = () => {
      if (!A.current) return;
      const le = A.current.getBoundingClientRect();
      l.setPosition(le);
    };
    if (A.current) {
      _e();
      const le = new ResizeObserver(_e);
      return le.observe(A.current), () => le.disconnect();
    }
  }, [l]);
  function V() {
    s(
      o === 0 ? 1 : 0
      /* Down */
    ), setTimeout(() => {
      l.handleFoldBtnClick(
        o === 1
        /* Up */
      );
    }, 150);
  }
  function D() {
    a.isVisible().visible && f.executeCommand(tt.id, {
      visible: !1,
      eventType: je.Keyboard,
      keycode: Y.ESC,
      unitId: y.unitId
    });
  }
  function X() {
    a.isVisible().visible && f.executeCommand(tt.id, {
      visible: !1,
      eventType: je.PointerDown,
      unitId: y.unitId
    });
  }
  function B() {
    l.handleFxBtnClick(!0);
  }
  const { viewDisable: j, editDisable: G } = v, ge = G || S, Re = Tn(!1), be = () => {
    try {
      if (a.isVisible().visible === !1 && !f.syncExecuteCommand(
        tt.id,
        {
          visible: !0,
          eventType: je.PointerDown,
          unitId: y.unitId
        }
      )) {
        Re.current = !0;
        return;
      }
      P.setContextValue(Ot, !0);
    } catch (_e) {
      throw Re.current = !0, _e;
    }
  }, Ne = () => {
    Re.current && setTimeout(() => {
      x.blur(!0);
    }, 30), Re.current = !1;
  }, ee = ((me = (Ue = (pe = y == null ? void 0 : y.documentLayoutObject.documentModel) == null ? void 0 : pe.getDrawingsOrder()) == null ? void 0 : Ue.length) != null ? me : 0) > 0 || j;
  return /* @__PURE__ */ q(
    "div",
    {
      "data-u-comp": "formula-bar",
      className: Te("univer-box-border univer-flex univer-bg-white univer-transition-[height] univer-ease-linear dark:!univer-bg-gray-900", Vd, e, {
        "univer-h-7": o === 0,
        "univer-h-20": o === 1,
        "univer-pointer-events-none": G
      }),
      children: [
        /* @__PURE__ */ b("div", { className: "univer-relative univer-box-border univer-h-full univer-w-[100px]", children: /* @__PURE__ */ b(o0, { disable: t != null ? t : G }) }),
        /* @__PURE__ */ q("div", { className: "univer-flex univer-h-full univer-w-full", children: [
          /* @__PURE__ */ b("div", { className: Te("univer-py-1.5", { "univer-cursor-not-allowed univer-text-gray-200": ge }), children: /* @__PURE__ */ q(
            "div",
            {
              className: Te("univer-relative univer-box-border univer-flex univer-h-full univer-w-20 univer-items-center univer-justify-center univer-text-xs", Nd),
              children: [
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: Te("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white", {
                      "univer-cursor-pointer univer-text-red-600 hover:univer-bg-gray-100 dark:!univer-text-green-400 dark:hover:!univer-bg-gray-700": n
                    }),
                    onClick: D,
                    children: /* @__PURE__ */ b(Um, {})
                  }
                ),
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: Te("univer-flex univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base dark:!univer-text-white", {
                      "univer-cursor-pointer univer-text-green-600 hover:univer-bg-gray-100 dark:!univer-text-red-400 dark:hover:!univer-bg-gray-700": n
                    }),
                    onClick: X,
                    children: /* @__PURE__ */ b(Dr, {})
                  }
                ),
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: "univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-p-1 univer-text-base hover:univer-bg-gray-100 dark:!univer-text-white dark:hover:!univer-bg-gray-700",
                    onClick: B,
                    children: /* @__PURE__ */ b(Ym, {})
                  }
                )
              ]
            }
          ) }),
          /* @__PURE__ */ q("div", { className: "univer-flex univer-w-full univer-flex-1 univer-overflow-hidden univer-pl-3", children: [
            /* @__PURE__ */ q(
              "div",
              {
                ref: A,
                className: "univer-relative univer-flex-1",
                onPointerDown: be,
                onPointerUp: Ne,
                style: { pointerEvents: ee ? "none" : "auto" },
                children: [
                  E && /* @__PURE__ */ b(
                    E,
                    {
                      className: "univer-relative univer-h-full univer-w-full univer-break-words univer-outline-none [&>div]:univer-ring-transparent",
                      disableSelectionOnClick: !0,
                      editorId: Ae,
                      initValue: "",
                      onChange: () => {
                      },
                      isFocus: H,
                      unitId: y == null ? void 0 : y.unitId,
                      subUnitId: y == null ? void 0 : y.sheetId,
                      isSupportAcrossSheet: !0,
                      resetSelectionOnBlur: !1,
                      isSingle: !1,
                      keyboardEventConfig: M,
                      onFormulaSelectingChange: (_e, le) => {
                        R.current = _e, le && (_e ? a.enableForceKeepVisible() : a.disableForceKeepVisible());
                      },
                      autoScrollbar: !1,
                      disableContextMenu: !1
                    }
                  ),
                  ee && /* @__PURE__ */ b(
                    "div",
                    {
                      className: "univer-pointer-events-none univer-relative univer-left-0 univer-top-0 univer-z-[100] univer-h-full univer-w-full univer-cursor-not-allowed univer-bg-white"
                    }
                  )
                ]
              }
            ),
            /* @__PURE__ */ b(
              "div",
              {
                className: Te("univer-flex univer-h-full univer-w-5 univer-cursor-pointer univer-items-center univer-justify-center univer-text-xs univer-text-gray-700 dark:!univer-text-gray-200", { "univer-cursor-not-allowed univer-text-gray-200 dark:!univer-text-gray-700": G }),
                onClick: V,
                children: /* @__PURE__ */ b(
                  zm,
                  {
                    className: Te({
                      "univer-rotate-180": o === 1
                      /* Up */
                    })
                  }
                )
              }
            )
          ] })
        ] }),
        /* @__PURE__ */ b(tC, { components: T }, "formula-aux")
      ]
    }
  );
}
function As(r) {
  const { children: e, className: t, style: n, disabled: i = !1, onClick: o, ...s } = r;
  return /* @__PURE__ */ b(
    jt,
    {
      "data-u-comp": "sheet-bar-append-button",
      className: t,
      size: "small",
      disabled: i,
      style: n,
      variant: "text",
      onClick: (a) => {
        if (i) {
          a.preventDefault();
          return;
        }
        o && o(a);
      },
      ...s,
      children: e
    }
  );
}
function l0() {
  const [r, e] = re([]), [t, n] = re(!1), i = L(k), o = L(W), s = L(Nr), l = L(ft), a = dt(() => i.getCurrentTypeOfUnit$(O.UNIVER_SHEET), null, !1, []), c = (f) => {
    const { sheetId: v } = f;
    !v || !a || (f.hidden ? o.executeCommand(pd.id, {
      unitId: a.getUnitId(),
      subUnitId: v,
      value: v
    }) : f.selected || o.executeCommand(Cd.id, {
      unitId: a.getUnitId(),
      subUnitId: v
    }), n(!1));
  }, d = An(() => {
    if (!a) return;
    const f = a.getSheets(), v = a.getActiveSheet(), p = f.map((S, w) => ({
      label: S.getName(),
      index: `${w}`,
      sheetId: S.getSheetId(),
      hidden: S.isSheetHidden() === Ke.TRUE,
      selected: v === S
    }));
    e(p);
  }, [a, l]), u = An(() => o.onCommandExecuted((f) => {
    switch (f.id) {
      case nr.id:
      case On.id:
      case Sd.id:
      case xr.id:
      case vd.id:
      case nt.id:
        d();
        break;
    }
  }), [o, d]);
  function h() {
    n(!0);
  }
  const g = (f) => {
    n(f);
  };
  Ee(() => {
    d();
    const f = new ht();
    return f.add(u()), f.add(s.registerSheetBarMenuHandler({ handleSheetBarMenu: h })), () => f.dispose();
  }, [u, s, d, a]);
  const m = Ct(() => r.map((f) => ({
    type: "item",
    children: /* @__PURE__ */ q("div", { className: "univer-relative univer-box-border univer-pl-6", children: [
      (f.selected || f.hidden) && /* @__PURE__ */ q("span", { className: "univer-absolute univer-left-1 univer-top-0.5", children: [
        f.selected && /* @__PURE__ */ b(Dr, { className: "univer-size-4 univer-text-primary-600" }),
        f.hidden && /* @__PURE__ */ b(jm, { className: "univer-size-4 univer-text-gray-400" })
      ] }),
      /* @__PURE__ */ b(
        "span",
        {
          className: Te({
            "univer-text-primary-600": f.selected
          }),
          children: f.label
        }
      )
    ] }),
    onSelect: () => {
      c(f);
    }
  })), [r]);
  return /* @__PURE__ */ b(
    Hd,
    {
      align: "start",
      items: m,
      open: t,
      onOpenChange: g,
      children: /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(As, { children: /* @__PURE__ */ b(Xm, {}) }) })
    }
  );
}
function a0(r) {
  const { sheetId: e, label: t, color: n, selected: i, menuOverlay: o } = r, [s, l] = re(i), a = L(Ht);
  Ee(() => {
    l(i);
  }, [i]);
  const c = (d) => {
    const u = a.getColorFromTheme("gray.900"), h = a.getColorFromTheme("white");
    return new fn(d).isDark() ? h : u;
  };
  return /* @__PURE__ */ b(
    "div",
    {
      "data-u-comp": "slide-tab-item",
      "data-id": e,
      className: Te("univer-mx-1 univer-box-border univer-flex univer-flex-grow univer-cursor-pointer univer-select-none univer-flex-row univer-items-center univer-rounded univer-text-xs univer-transition-[colors,box-shadow]", {
        "dark:!univer-text-white": !n || n && !c(n),
        "univer-justify-center univer-bg-white univer-font-bold univer-text-primary-700 univer-shadow": s,
        "dark:!univer-bg-gray-900": s && !n,
        "univer-font-medium univer-text-gray-900 hover:univer-bg-gray-100": !s,
        "dark:hover:!univer-bg-gray-700": !s && !n
      }),
      style: {
        backgroundColor: !s && n ? n : "",
        color: !s && n ? c(n) : "",
        boxShadow: s && n ? `0px 0px 8px rgba(0, 0, 0, 0.08), inset 0px -2px 0px 0px ${n}` : ""
      },
      children: /* @__PURE__ */ b(
        "div",
        {
          className: "univer-box-border univer-flex univer-items-center univer-gap-1 univer-whitespace-nowrap univer-rounded univer-border-2 univer-border-solid univer-border-transparent univer-px-1.5 univer-py-1",
          children: t
        }
      )
    },
    e
  );
}
const c0 = {
  easeOutStrong(r, e, t, n) {
    return -t * ((r = r / n - 1) * r * r * r - 1) + e;
  },
  backOut(r, e, t, n, i) {
    return typeof i > "u" && (i = 0.7), t * ((r = r / n - 1) * r * ((i + 1) * r + i) + 1) + e;
  }
}, d0 = {
  loop: !1,
  begin: 0,
  end: 0,
  duration: 300,
  delay: 0,
  type: "easeOutStrong",
  receive(r) {
  },
  success(r) {
  },
  cancel(r) {
  },
  complete(r) {
  }
};
class u0 {
  constructor(e) {
    _(this, "_config");
    _(this, "_status", 0);
    _(this, "_start", 0);
    _(this, "_handle", 0);
    _(this, "_delayHandle", null);
    this._config = {
      ...d0,
      ...e
    }, this._config.loop && (this._config.complete = () => {
    }, this._config.success = () => {
      this.request();
    });
  }
  static success(...e) {
    let t = 0;
    return new Promise((n) => {
      for (let i = 0; i < e.length; i++) {
        const o = e[i], s = o._config, l = s.success;
        s.loop || (s.success = (c) => {
          t++, l && l.call(o, c), t === e.length && n();
        });
      }
    });
  }
  request() {
    this._config.delay === 0 ? (this._status = 0, this._start = Date.now(), this._fakeHandle()) : (this._delayHandle && clearTimeout(this._delayHandle), this._delayHandle = setTimeout(() => {
      this._status = 0, this._start = Date.now(), this._fakeHandle();
    }, this._config.delay));
  }
  cancel() {
    this._status = 1, this._delayHandle && clearTimeout(this._delayHandle), cancelAnimationFrame(this._handle);
  }
  _fakeHandle() {
    let e = Date.now() - this._start;
    e = e >= this._config.duration ? this._config.duration : e;
    const n = c0[this._config.type](
      e,
      this._config.begin,
      this._config.end - this._config.begin,
      this._config.duration,
      0.7
    ).toFixed(2);
    if (this._config.receive(n), this._status === 1) {
      this._config.cancel(n), this._config.complete(n);
      return;
    }
    if (e === this._config.duration) {
      this._config.success(n), this._config.complete(n);
      return;
    }
    this._handle = requestAnimationFrame(() => {
      this._fakeHandle();
    });
  }
}
class vr {
  constructor(e, t) {
    _(this, "_slideTabItem");
    _(this, "_animate");
    _(this, "_midline", 0);
    _(this, "_translateX");
    _(this, "_scrollbar");
    _(this, "_slideTabBar");
    _(this, "_editMode");
    _(this, "_placeholder");
    this._slideTabItem = e, this._animate = null, this._translateX = 0, this._editMode = !1, this._slideTabBar = t, this._placeholder = null, this._scrollbar = t.getScrollbar(), this.update();
  }
  static midline(e) {
    return e.getBoundingRect().x + e.getBoundingRect().width / 2;
  }
  static leftLine(e) {
    return e.getBoundingRect().x;
  }
  static rightLine(e) {
    return e.getBoundingRect().x + e.getBoundingRect().width;
  }
  static make(e, t) {
    const n = [];
    return e.forEach((i) => n.push(new vr(i, t))), n;
  }
  getSlideTabItem() {
    return this._slideTabItem;
  }
  getEditor() {
    return this._slideTabItem.querySelector("span");
  }
  focus() {
    var e;
    (e = this.getEditor()) == null || e.focus();
  }
  selectAll() {
    const e = this.getEditor();
    e && ai.keepSelectAll(e);
  }
  isEditMode() {
    return this._editMode;
  }
  classList() {
    return this._slideTabItem.classList;
  }
  translateX(e) {
    return this._translateX = e, this._slideTabItem.style.transform = `translateX(${e}px)`, this.getTranslateXDirection();
  }
  setEditor(e) {
    if (!this._slideTabBar.getConfig().onNameChangeCheck())
      return;
    let t = !0;
    if (this._editMode === !1) {
      const n = this._slideTabItem.querySelector("span"), i = (c) => {
        if (!this.nameCheck()) {
          if (this._editMode = !1, n && (n.removeAttribute("contentEditable"), n.removeEventListener("focusout", i), n.removeEventListener("compositionstart", s), n.removeEventListener("compositionend", l), n.removeEventListener("input", a), n.removeEventListener("keydown", o)), this._slideTabBar.removeListener(), this._slideTabBar.updateItems(), this._slideTabBar.getConfig().onChangeName) {
            const d = (n == null ? void 0 : n.innerText) || "", u = this.getId();
            this._slideTabBar.getConfig().onChangeName(u, d);
          }
          e && e(c);
        }
      };
      let o = (c) => {
        n && (c.stopPropagation(), c.key === "Enter" && n.blur());
      };
      const s = (c) => {
        t = !1;
      }, l = (c) => {
        t = !0;
      }, a = (c) => {
        if (!n) return;
        const d = 31;
        setTimeout(() => {
          if (t) {
            const u = n.innerText;
            u.length > d && (n.innerText = u.substring(0, d), ai.keepLastIndex(n));
          }
        }, 0);
      };
      n && (n.setAttribute("contentEditable", "true"), n.addEventListener("focusout", i), n.addEventListener("compositionstart", s), n.addEventListener("compositionend", l), n.addEventListener("input", a), n.addEventListener("keydown", o), this._editMode = !0, ai.keepSelectAll(n));
    }
  }
  nameCheck() {
    const e = this._slideTabItem.querySelector("span");
    if (!e) return !1;
    const t = e.innerText;
    return this._slideTabBar.getConfig().onNameCheckAlert(t);
  }
  animate() {
    return {
      translateX: (e) => {
        this._translateX !== e && (this._animate && (this._animate.cancel(), this._animate = null), this._animate = new u0({
          begin: this._translateX,
          end: e,
          receive: (t) => {
            this._slideTabItem.style.transform = `translateX(${t}px)`;
          }
        }), this._translateX = e, this._animate.request());
      },
      cancel: () => {
        this._animate && (this._animate.cancel(), this._animate = null);
      }
    };
  }
  after(e) {
    this._slideTabItem.after(e._slideTabItem || e);
  }
  update() {
    this._midline = vr.midline(this);
  }
  disableFixed() {
    if (this._placeholder) {
      const e = this._slideTabBar.primeval();
      this._slideTabItem.style.removeProperty("position"), this._slideTabItem.style.removeProperty("left"), this._slideTabItem.style.removeProperty("top"), this._slideTabItem.style.removeProperty("width"), this._slideTabItem.style.removeProperty("height"), this._slideTabItem.style.removeProperty("background"), this._slideTabItem.style.removeProperty("padding"), this._slideTabItem.style.removeProperty("box-sizing"), this._slideTabItem.style.removeProperty("font-size"), this._slideTabItem.style.removeProperty("font-family"), this._slideTabItem.style.removeProperty("font-weight"), this._slideTabItem.style.removeProperty("color"), this._slideTabItem.style.removeProperty("border-radius"), this._placeholder.after(this._slideTabItem), e.removeChild(this._placeholder), this._placeholder = null;
    }
  }
  enableFixed() {
    const e = document.createElement("div"), t = this.getBoundingRect(), n = getComputedStyle(this._slideTabItem), i = this._slideTabItem.querySelector("span");
    if (this._placeholder = e, this._placeholder.style.width = `${t.width}px`, this._placeholder.style.height = `${t.height}px`, this._placeholder.style.flexShrink = "0", this._placeholder.style.margin = n.margin, this._slideTabItem.style.background = n.background, i) {
      const o = getComputedStyle(i).padding;
      this._slideTabItem.style.padding = o;
    }
    this._slideTabItem.style.boxSizing = n.boxSizing, this._slideTabItem.style.fontSize = n.fontSize, this._slideTabItem.style.fontFamily = n.fontFamily, this._slideTabItem.style.fontWeight = n.fontWeight, this._slideTabItem.style.color = n.color, this._slideTabItem.style.borderRadius = n.borderRadius, this._slideTabItem.style.left = `${t.x - this.getScrollbar().getScrollX()}px`, this._slideTabItem.style.top = `${t.y}px`, this._slideTabItem.style.width = `${t.width}px`, this._slideTabItem.style.height = `${t.height}px`, this._slideTabItem.style.position = "fixed", this._slideTabItem.after(e), document.body.appendChild(this._slideTabItem);
  }
  addEventListener(e, t, n) {
    this._slideTabItem.addEventListener(e, t, n);
  }
  removeEventListener(e, t, n) {
    this._slideTabItem.removeEventListener(e, t, n);
  }
  getScrollbar() {
    return this._scrollbar;
  }
  getMidLine() {
    return this._midline;
  }
  getBoundingRect() {
    const e = this._slideTabItem.getBoundingClientRect();
    return e.x += this._scrollbar.getScrollX(), e;
  }
  getWidth() {
    return this.getBoundingRect().width;
  }
  getTranslateXDirection() {
    const e = vr.midline(this);
    return e > this._midline ? 1 : e < this._midline ? -1 : 0;
  }
  equals(e) {
    return e && e._slideTabItem === this._slideTabItem;
  }
  getId() {
    return this._slideTabItem.dataset.id || "";
  }
}
class h0 {
  constructor(e) {
    _(this, "_slideTabBar");
    _(this, "_scrollX");
    const t = e.primeval();
    this._scrollX = t.scrollLeft, this._slideTabBar = e;
  }
  scrollX(e) {
    const t = this._slideTabBar.primeval();
    t.scrollLeft = e, this._scrollX = t.scrollLeft;
  }
  scrollRight() {
    const e = this._slideTabBar.primeval();
    e.scrollLeft = e.scrollWidth, this._scrollX = e.scrollLeft;
  }
  getScrollX() {
    return this._scrollX;
  }
}
const Jr = class Jr {
  // eslint-disable-next-line max-lines-per-function
  constructor(e) {
    // in milliseconds
    _(this, "_activeTabItemIndex", 0);
    _(this, "_slideTabBar");
    _(this, "_slideTabItems", []);
    _(this, "_config");
    _(this, "_downActionX", 0);
    _(this, "_moveActionX", 0);
    _(this, "_compareIndex", 0);
    _(this, "_activeTabItem", null);
    _(this, "_moveAction");
    _(this, "_upAction");
    _(this, "_downAction");
    _(this, "_wheelAction");
    _(this, "_scrollIncremental", 0);
    _(this, "_compareDirection", 0);
    _(this, "_autoScrollTime", null);
    _(this, "_slideScrollbar");
    _(this, "_longPressTimer", null);
    /**
     * left border line
     */
    _(this, "_leftBoundingLine", 0);
    /**
     * right border line
     */
    _(this, "_rightBoundingLine", 0);
    /**
     * The distance required to move to the left border
     */
    _(this, "_leftMoveX", 0);
    /**
     * The distance required to move to the right border
     */
    _(this, "_rightMoveX", 0);
    if (e.slideTabBarContainer == null)
      throw new Error("not found slide-tab-bar root element");
    const t = e.slideTabBarContainer.querySelector(`${e.slideTabBarSelector}`);
    if (t == null)
      throw new Error("not found slide-tab-bar");
    this._slideTabBar = t, this._slideScrollbar = new h0(this), this._config = e, this._initConfig();
    let n = 0, i = 0, o = 0;
    this._downAction = (s) => {
      var I, R, y, M, E, T;
      if ((I = this._activeTabItem) != null && I.isEditMode())
        return;
      this._longPressTimer && (clearTimeout(this._longPressTimer), this._longPressTimer = null);
      const l = (y = (R = s.target) == null ? void 0 : R.closest(`${e.slideTabBarItemSelector}`)) == null ? void 0 : y.getAttribute("data-id"), a = this._slideTabItems.findIndex((P) => P.getId() === l);
      if (l == null || a === -1) return;
      if (this._activeTabItemIndex !== a) {
        (M = this._activeTabItem) == null || M.removeEventListener("pointermove", this._moveAction), (E = this._activeTabItem) == null || E.removeEventListener("pointerup", this._upAction), this.removeListener(), this._config.onChangeTab(s, l);
        return;
      }
      if (this._compareIndex = a, this._downActionX = s.pageX, this._moveActionX = 0, this._scrollIncremental = 0, this._activeTabItem = this._slideTabItems[a], !this._activeTabItem) {
        console.error("Not found active slide-tab-item in sheet bar");
        return;
      }
      const c = this._activeTabItem.getSlideTabItem();
      c == null || c.setPointerCapture(s.pointerId), (T = this._activeTabItem) == null || T.addEventListener("pointerup", this._upAction);
      const { x: d, width: u } = this._activeTabItem.getBoundingRect(), { x: h, width: g } = this.getBoundingRect(), m = this._slideScrollbar.getScrollX();
      if (this._leftBoundingLine = this._downActionX - (d - m), this._rightBoundingLine = d - m + u - this._downActionX, this._leftMoveX = d - h - m, this._rightMoveX = h + g - (d + u) + m, s.button === 2 || this._hasEditItem())
        return;
      const { pageX: f, pageY: v } = s, p = Date.now(), S = p - o <= Jr.DoubleClickDelay, w = Math.abs(f - n) < 10, C = Math.abs(v - i) < 10;
      S && w && C && this._activeTabItem.setEditor(), n = f, i = v, o = p, this._longPressTimer = setTimeout(() => {
        var P, H, A;
        !c || (P = this._activeTabItem) != null && P.isEditMode() || ((H = this._activeTabItem) == null || H.enableFixed(), this._startAutoScroll(), c.setPointerCapture(s.pointerId), c.style.cursor = "move", (A = this._activeTabItem) == null || A.addEventListener("pointermove", this._moveAction));
      }, Jr.LongPressDelay);
    }, this._upAction = (s) => {
      var c, d, u, h;
      if ((c = this._activeTabItem) != null && c.isEditMode() || (this._longPressTimer && (clearTimeout(this._longPressTimer), this._longPressTimer = null), !this._activeTabItem)) return;
      const l = this._autoScrollTime !== null;
      this._closeAutoScroll(), this._activeTabItem.disableFixed(), this.updateItems();
      const a = (d = this._activeTabItem) == null ? void 0 : d.getSlideTabItem();
      a && (a.style.cursor = "", a.releasePointerCapture(s.pointerId), (u = this._activeTabItem) == null || u.removeEventListener("pointermove", this._moveAction), (h = this._activeTabItem) == null || h.removeEventListener("pointerup", this._upAction), this._config.onSlideEnd && this._activeTabItemIndex !== this._compareIndex && l && (this.removeListener(), this._config.onSlideEnd(s, this._compareIndex || 0)), this._scrollIncremental = 0, this._downActionX = 0, this._moveActionX = 0, this._compareIndex = 0);
    }, this._moveAction = (s) => {
      this._activeTabItem && (this._moveActionX = s.pageX - this._downActionX, this._moveActionX <= -this._leftMoveX ? this._moveActionX = -this._leftMoveX : this._moveActionX >= this._rightMoveX && (this._moveActionX = this._rightMoveX), this._scrollIncremental = 0, this._scrollLeft(s), this._scrollRight(s));
    }, this._wheelAction = (s) => {
      this.setScroll(s.deltaY);
    }, this.addListener();
  }
  static checkedSkipSlide(e) {
    let t = e.target;
    for (; t != null && t !== document.body; ) {
      if (t.getAttribute("data-slide-skip"))
        return !0;
      t = t.parentElement;
    }
    return !1;
  }
  static keepLastIndex(e) {
    setTimeout(() => {
      const t = window.getSelection();
      t && (t.selectAllChildren(e), t.collapseToEnd());
    });
  }
  static keepSelectAll(e) {
    setTimeout(() => {
      const t = window.getSelection();
      if (!t) return;
      const n = document.createRange();
      n.selectNodeContents(e), t.removeAllRanges(), t.addRange(n);
    });
  }
  /**
   * The current instance is persistent, but some parameters need to be updated after refreshing
   * @param currentIndex
   */
  update(e) {
    this._config.currentIndex = e, this._initConfig(), this.removeListener(), this.addListener(), this.scrollToItem(e);
  }
  primeval() {
    return this._slideTabBar;
  }
  updateItems() {
    for (let e = 0; e < this._slideTabItems.length; e++)
      this._slideTabItems[e].animate().cancel(), this._slideTabItems[e].translateX(0), this._slideTabItems[e].update();
  }
  getScrollbar() {
    return this._slideScrollbar;
  }
  getConfig() {
    return this._config;
  }
  getBoundingRect() {
    return this._slideTabBar.getBoundingClientRect();
  }
  getSlideTabItems() {
    return this._slideTabItems;
  }
  getActiveItem() {
    return this._activeTabItem;
  }
  isLeftEnd() {
    return this._slideTabBar.scrollLeft === 0;
  }
  isRightEnd() {
    const e = this._slideTabBar.parentElement;
    return e ? this._slideTabBar.scrollWidth - e.clientWidth === this._slideTabBar.scrollLeft : !1;
  }
  addListener() {
    this._slideTabBar.addEventListener("wheel", this._wheelAction), this._slideTabItems.forEach((e) => {
      e.addEventListener("pointerdown", this._downAction);
    });
  }
  removeListener() {
    this._slideTabBar.removeEventListener("wheel", this._wheelAction), this._slideTabItems.forEach((e) => {
      e.removeEventListener("pointerdown", this._downAction);
    });
  }
  setScroll(e) {
    if (this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + e), e > 0) {
      const t = this.calculateLeftScrollX();
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t);
    } else if (e < 0) {
      const t = this.calculateRightScrollX();
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t);
    }
    this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  flipPage(e) {
    if (e > 0) {
      const t = this.calculateLeftScrollX(!0);
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t);
    } else if (e < 0) {
      const t = this.calculateRightScrollX(!0);
      this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t);
    }
    this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  scrollToItem(e) {
    if (e = e != null ? e : this._config.currentIndex, e < 0 || e >= this._slideTabItems.length) {
      console.error("Index out of bounds");
      return;
    }
    const t = this.calculateTabItemScrollX(e);
    this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + t), this._config.onScroll({
      leftEnd: this.isLeftEnd(),
      rightEnd: this.isRightEnd()
    });
  }
  calculateLeftScrollX(e) {
    let t = 0;
    const n = 4;
    return this._slideTabItems.some((i) => {
      const o = this._slideTabBar.getBoundingClientRect(), s = o.left + o.width, l = i.getSlideTabItem().getBoundingClientRect(), a = l.left, c = l.width;
      return a < s && a + c + n * 2 > s ? (t = e ? a - o.left - n : a + c - s + n, !0) : !1;
    }), t;
  }
  calculateRightScrollX(e) {
    let t = 0;
    const n = 4;
    return this._slideTabItems.some((i) => {
      const o = this._slideTabBar.getBoundingClientRect(), s = o.left, l = i.getSlideTabItem().getBoundingClientRect(), a = l.left, c = l.width;
      return a - n * 2 < s && a + c > s ? (t = e ? a + c - o.left - o.width + n : a - s - n, !0) : !1;
    }), t;
  }
  calculateTabItemScrollX(e) {
    let t = 0;
    const n = 4, i = this._slideTabBar.getBoundingClientRect(), o = i.left, s = i.left + i.width, l = this._slideTabItems[e].getSlideTabItem().getBoundingClientRect(), a = l.left, c = l.width;
    return a - n * 2 < o && (t = a - o - n), a + c + n * 2 > s && (t = a + c - s + n), t;
  }
  calculateActiveTabItemScrollX() {
    var c;
    let e = 0;
    const t = 4, n = this._slideTabBar.getBoundingClientRect(), i = n.left, o = n.left + n.width, s = (c = this._activeTabItem) == null ? void 0 : c.getSlideTabItem().getBoundingClientRect();
    if (!s) return 0;
    const l = s.left, a = s.width;
    return l - t * 2 < i && l + a > i && (e = l - i - t), l < o && l + a + t * 2 > o && (e = l + a - o + t), e;
  }
  destroy() {
    this.removeListener(), this._downActionX = 0, this._moveActionX = 0, this._compareDirection = 0, this._compareIndex = 0, this._slideTabItems = [], this._activeTabItem = null;
  }
  _hasEditItem() {
    for (let e = 0; e < this._slideTabItems.length; e++)
      if (this._slideTabItems[e].isEditMode())
        return !0;
    return !1;
  }
  _autoScrollFrame() {
    if (this._activeTabItem)
      switch (this._compareDirection = this._activeTabItem.translateX(this._moveActionX), this._compareDirection) {
        case 1: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareRight();
          break;
        }
        case 0: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareIndex = this._activeTabItemIndex;
          break;
        }
        case -1: {
          this._slideScrollbar.scrollX(this._slideScrollbar.getScrollX() + this._scrollIncremental), this._compareLeft();
          break;
        }
      }
    this._autoScrollTime = requestAnimationFrame(() => {
      this._autoScrollFrame();
    });
  }
  _startAutoScroll() {
    this._autoScrollTime == null && this._autoScrollFrame();
  }
  _closeAutoScroll() {
    this._autoScrollTime && cancelAnimationFrame(this._autoScrollTime), this._autoScrollTime = null;
  }
  _scrollLeft(e) {
    const t = this.getBoundingRect(), n = e.pageX - t.x;
    n < this._leftBoundingLine && (this._scrollIncremental = -Math.min(Math.abs(n - this._leftBoundingLine) * 0.1, 50));
  }
  _scrollRight(e) {
    const t = this.getBoundingRect(), n = e.pageX - t.x;
    n > t.width - this._rightBoundingLine && (this._scrollIncremental = Math.min(Math.abs(n - (t.width - this._rightBoundingLine)) * 0.1, 50));
  }
  _sortedItems() {
    if (this._activeTabItem != null && this._activeTabItemIndex != null && this._compareIndex != null && (this._slideTabItems.splice(this._activeTabItemIndex, 1), this._slideTabItems.splice(this._compareIndex, 0, this._activeTabItem), this._config.slideTabBarItemAutoSort))
      for (let e = 0; e < this._slideTabItems.length; e++) {
        const t = this._slideTabItems[e], n = this._slideTabItems[e + 1];
        n && t.after(n);
      }
  }
  _compareLeft() {
    if (this._activeTabItem && this._activeTabItemIndex) {
      const e = this._slideTabItems.findIndex((o) => o.equals(this._activeTabItem)), t = this._slideTabItems.length, n = [];
      for (let o = 0; o < e && !(o >= e); o++)
        n.push(this._slideTabItems[o]);
      for (let o = e + 1; o < t; o++)
        this._slideTabItems[o].animate().translateX(0);
      let i = !0;
      for (let o = n.length - 1; o >= 0; o--) {
        const s = n[o];
        vr.leftLine(this._activeTabItem) < s.getMidLine() ? (s.animate().translateX(this._activeTabItem.getWidth()), this._compareIndex = o, i = !1) : (s.animate().translateX(0), i && (this._compareIndex = this._activeTabItemIndex));
      }
    }
  }
  _compareRight() {
    if (this._activeTabItem) {
      const e = this._slideTabItems.findIndex((o) => o.equals(this._activeTabItem)), t = this._slideTabItems.length, n = [];
      for (let o = e + 1; o < t; o++)
        n.push(this._slideTabItems[o]);
      for (let o = 0; o < e; o++)
        this._slideTabItems[o].animate().translateX(0);
      let i = !0;
      for (let o = 0; o < n.length; o++) {
        const s = n[o];
        vr.rightLine(this._activeTabItem) > s.getMidLine() ? (s.animate().translateX(-this._activeTabItem.getWidth()), this._compareIndex = e + o + 1, i = !1) : (s.animate().translateX(0), i && (this._compareIndex = this._activeTabItemIndex));
      }
    }
  }
  _initConfig() {
    const e = this._slideTabBar.querySelectorAll(`${this._config.slideTabBarItemSelector}`);
    this._downActionX = 0, this._moveActionX = 0, this._compareDirection = 0, this._compareIndex = 0, this._slideTabItems = vr.make(e, this), this._activeTabItemIndex = this._config.currentIndex, this._activeTabItem = this._slideTabItems[this._activeTabItemIndex];
  }
};
/** Time in milliseconds to wait to raise long press events if button is still pressed */
_(Jr, "LongPressDelay", 500), // in milliseconds
/** Time in milliseconds with two consecutive clicks will be considered as a double click */
_(Jr, "DoubleClickDelay", 300);
let ai = Jr;
function g0() {
  var Ne;
  const [r, e] = re([]), [t, n] = re(""), [i, o] = re(""), [s, l] = re(!1), [a, c] = re([0, 0]), d = Tn({ slideTabBar: null }), u = Tn(null), h = L(W), g = L(Nr), m = L(xe), f = L(tn), v = L(qe, bc.OPTIONAL), p = L(ft), S = L($e), w = dt(p.resetOrder$), C = kr(), I = L(rt), R = An(() => {
    var Ue;
    const Z = ((Ue = C.getActiveSheet()) == null ? void 0 : Ue.getSheetId()) || "";
    n(Z);
    const ee = C.getSheets(), ne = C.getActiveSheet(), pe = ee.filter((me) => !me.isSheetHidden()).map((me, _e) => {
      var wt;
      const le = p.getRule(C.getUnitId(), me.getSheetId()), it = S.getSubunitRuleList(C.getUnitId(), me.getSheetId()).length > 0, vt = (le == null ? void 0 : le.permissionId) || it ? /* @__PURE__ */ q($o, { children: [
        /* @__PURE__ */ b(iu, {}),
        /* @__PURE__ */ b("span", { className: "univer-outline-none", children: me.getName() })
      ] }) : /* @__PURE__ */ b("span", { className: "univer-outline-none", children: me.getName() });
      return {
        sheetId: me.getSheetId(),
        label: vt,
        index: _e,
        selected: ne === me,
        color: (wt = me.getTabColor()) != null ? wt : void 0
      };
    });
    e(pe), n(Z);
  }, [S, C, p]);
  Ee(() => {
    R();
    const { slideTabBar: Z, disconnectResizeObserver: ee } = y(), ne = D(), pe = [
      X(),
      B(),
      j()
      // When adding a sheet, it no longer slides, which has been uniformly handled in setupSlideTabBarUpdate
    ];
    return () => {
      ne.dispose(), Z.destroy(), pe.forEach((Ue) => Ue.unsubscribe()), ee && ee();
    };
  }, [w, C]), Ee(() => {
    r.length > 0 && V();
  }, [r]), Ee(() => {
    const Z = St(
      p.ruleChange$,
      S.ruleChange$
    ).subscribe(() => {
      R();
    });
    return () => {
      Z.unsubscribe();
    };
  }, [p, R]);
  const y = () => {
    const Z = new ai({
      slideTabBarSelector: "[data-u-comp=slide-tab-bar]",
      slideTabBarItemSelector: "[data-u-comp=slide-tab-item]",
      slideTabBarItemAutoSort: !0,
      slideTabBarContainer: u.current,
      currentIndex: 0,
      onChangeName: (ne, pe) => {
        h.executeCommand(kv.id, {
          subUnitId: ne,
          name: pe
        });
      },
      onSlideEnd: async (ne, pe) => {
        await h.executeCommand(Nv.id, { order: pe });
      },
      onChangeTab: (ne, pe) => {
        h.executeCommand(nt.id, {
          subUnitId: pe,
          unitId: C.getUnitId()
        }).then(() => {
          ne.button === 2 && be(!0);
        });
      },
      onScroll: (ne) => {
        g.setScroll(ne);
      },
      onNameCheckAlert: (ne) => T(ne) || P(ne) || H(ne),
      onNameChangeCheck: () => {
        var le, it, ot, vt;
        const ne = C.getUnitId(), pe = C == null ? void 0 : C.getActiveSheet();
        if (!pe)
          throw new Error("No active sheet found");
        const Ue = pe.getSheetId(), me = p.getRule(ne, Ue), _e = S.getSubunitRuleList(ne, Ue).length > 0;
        return me || _e ? (it = (le = I.getPermissionPoint(new Cg(ne).id)) == null ? void 0 : le.value) != null ? it : !1 : (vt = (ot = I.getPermissionPoint(new wg(ne).id)) == null ? void 0 : ot.value) != null ? vt : !1;
      }
    });
    d.current.slideTabBar = Z;
    const ee = Re(Z);
    return { slideTabBar: Z, disconnectResizeObserver: ee };
  }, M = $l(ea), E = (Ne = M == null ? void 0 : M.contextMenu) != null ? Ne : !0, T = (Z) => {
    if (Z.trim() === "") {
      const ee = "sheetNameEmptyAlert";
      return f.open({
        id: ee,
        title: { title: m.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: m.t("sheetConfig.sheetNameCannotIsEmptyError") },
        cancelText: m.t("button.cancel"),
        confirmText: m.t("button.confirm"),
        onClose() {
          A(), f.close(ee);
        },
        onConfirm() {
          A(), f.close(ee);
        }
      }), !0;
    }
    return !1;
  }, P = (Z) => {
    if (!fv(Z)) {
      const ee = "sheetNameSpecCharAlert";
      return f.open({
        id: ee,
        title: { title: m.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: m.t("sheetConfig.sheetNameSpecCharError") },
        cancelText: m.t("button.cancel"),
        confirmText: m.t("button.confirm"),
        onClose() {
          A(), f.close(ee);
        },
        onConfirm() {
          A(), f.close(ee);
        }
      }), !0;
    }
    return !1;
  }, H = (Z) => {
    const ee = C.getActiveSheet();
    if ((ee == null ? void 0 : ee.getName()) === Z) return !1;
    const pe = C.checkSheetName(Z);
    if (pe) {
      const Ue = "sheetNameRepeatAlert";
      f.open({
        id: Ue,
        title: { title: m.t("sheetConfig.sheetNameErrorTitle") },
        children: { title: m.t("sheetConfig.sheetNameAlreadyExistsError") },
        cancelText: m.t("button.cancel"),
        confirmText: m.t("button.confirm"),
        onClose() {
          f.close(Ue), A();
        },
        onConfirm() {
          f.close(Ue), A();
        }
      });
    }
    return pe;
  }, A = () => {
    setTimeout(() => {
      var ee;
      const Z = (ee = d.current.slideTabBar) == null ? void 0 : ee.getActiveItem();
      Z && (Z.focus(), Z.selectAll());
    }, 0);
  }, x = () => {
    var Z, ee;
    (ee = (Z = d.current.slideTabBar) == null ? void 0 : Z.getActiveItem()) == null || ee.setEditor();
  }, V = () => {
    var ee;
    const Z = r.findIndex((ne) => ne.selected);
    (ee = d.current.slideTabBar) == null || ee.update(Z);
  }, D = () => h.onCommandExecuted((Z) => {
    switch (Z.id) {
      case Dv.id:
      case nr.id:
      case On.id:
      case Sd.id:
      case xr.id:
      case vd.id:
      case nt.id:
        R();
        break;
    }
  }), X = () => g.scroll$.subscribe((Z) => {
    G(Z);
  }), B = () => g.scrollX$.subscribe((Z) => {
    var ee;
    (ee = d.current.slideTabBar) == null || ee.flipPage(Z);
  }), j = () => g.renameId$.subscribe(() => {
    x();
  }), G = (Z) => {
    const { leftEnd: ee, rightEnd: ne } = Z;
    let pe = "";
    ee && ne ? pe = "" : ee && !ne ? pe = "inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)" : !ee && ne ? pe = "inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2)" : !ee && !ne && (pe = "inset 10px 0px 10px -10px rgba(0, 0, 0, 0.2), inset -10px 0px 10px -10px rgba(0, 0, 0, 0.2)"), o(pe);
  }, ge = (Z) => {
    const ee = Z.calculateActiveTabItemScrollX();
    if (ee) {
      const ne = Z.getScrollbar();
      ne.scrollX(ne.getScrollX() + ee);
    }
    g.setScroll({
      leftEnd: Z.isLeftEnd(),
      rightEnd: Z.isRightEnd()
    });
  }, Re = (Z) => {
    var pe;
    const ee = (pe = u.current) == null ? void 0 : pe.querySelector("[data-u-comp=slide-tab-bar]");
    if (!ee) return;
    const ne = new ResizeObserver(() => {
      ge(Z);
    });
    return ne.observe(ee), () => ne.disconnect();
  }, be = (Z) => {
    var ee, ne, pe, Ue, me;
    if (E && !(v != null && v.isForceKeepVisible())) {
      if (Z) {
        const { left: _e } = (ne = (ee = u.current) == null ? void 0 : ee.getBoundingClientRect()) != null ? ne : {}, { left: le } = (me = (Ue = (pe = d.current.slideTabBar) == null ? void 0 : pe.getActiveItem()) == null ? void 0 : Ue.getSlideTabItem().getBoundingClientRect()) != null ? me : {};
        _e !== void 0 && le !== void 0 && c([le - _e, 0]);
      }
      l(Z);
    }
  };
  return /* @__PURE__ */ b(
    SC,
    {
      className: "univer-select-none",
      visible: s,
      align: { offset: a },
      trigger: ["contextMenu"],
      overlay: /* @__PURE__ */ b(
        nC,
        {
          menuType: _t.FOOTER_TABS,
          onOptionSelect: (Z) => {
            const { label: ee, value: ne, commandId: pe } = Z;
            h.executeCommand(pe != null ? pe : ee, { value: ne, subUnitId: t }), l(!1);
          }
        }
      ),
      onVisibleChange: be,
      children: /* @__PURE__ */ b(
        "div",
        {
          className: "univer-max-w-[calc(100%-112px)] univer-overflow-hidden",
          ref: u,
          onDragStart: (Z) => Z.preventDefault(),
          onContextMenu: (Z) => Z.preventDefault(),
          children: /* @__PURE__ */ b(
            "div",
            {
              "data-u-comp": "slide-tab-bar",
              className: "univer-flex univer-select-none univer-flex-row univer-items-center univer-overflow-hidden univer-px-1.5 univer-py-1",
              style: { boxShadow: i },
              children: r.map((Z) => /* @__PURE__ */ st(a0, { ...Z, key: Z.sheetId, selected: t === Z.sheetId }))
            }
          )
        }
      )
    }
  );
}
const mh = 100, m0 = () => {
  var f, v;
  const [r, e] = re(!0), [t, n] = re(!0), i = L(W), o = L(Nr), s = L(rt), a = kr().getUnitId(), c = dt(s.getPermissionPoint$((f = new K(a)) == null ? void 0 : f.id)), d = dt(s.getPermissionPoint$((v = new bg(a)) == null ? void 0 : v.id)), u = (p) => {
    const { leftEnd: S, rightEnd: w } = p;
    e(S), n(w);
  };
  Ee(() => {
    const p = o.scroll$.subscribe(pv((S) => {
      u(S);
    }, 100));
    return () => {
      p.unsubscribe();
    };
  }, []);
  const h = () => {
    i.executeCommand(Lv.id), setTimeout(() => {
      o.setAddSheet(0);
    }, 0);
  }, g = () => {
    o.setScrollX(-mh);
  }, m = () => {
    o.setScrollX(mh);
  };
  return /* @__PURE__ */ q("div", { className: "univer-relative univer-flex univer-h-full univer-min-w-0 univer-flex-1", children: [
    /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center", children: [
      /* @__PURE__ */ b(
        As,
        {
          className: "univer-mr-2",
          onClick: h,
          disabled: !(d != null && d.value && (c != null && c.value)),
          children: /* @__PURE__ */ b(ru, {})
        }
      ),
      /* @__PURE__ */ b(l0, {})
    ] }),
    /* @__PURE__ */ b(g0, {}),
    (!r || !t) && /* @__PURE__ */ q(
      "div",
      {
        className: 'univer-relative univer-flex univer-items-center univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]',
        children: [
          /* @__PURE__ */ b(As, { disabled: r, onClick: g, children: /* @__PURE__ */ b(jc, { className: "univer-rotate-180" }) }),
          /* @__PURE__ */ b(As, { disabled: t, onClick: m, children: /* @__PURE__ */ b(jc, {}) })
        ]
      }
    )
  ] });
}, f0 = [50, 75, 100, 125, 150, 175, 200, 400];
function p0() {
  const r = L(W), e = L(k), t = kr(), n = L(qe), i = dt(n.visible$), o = An(() => {
    if (!t) return 100;
    const d = t.getActiveSheet(), u = d && d.getZoomRatio() * 100 || 100;
    return Math.round(u);
  }, [t]), [s, l] = re(() => o());
  Ee(() => (l(o()), r.onCommandExecuted((u) => {
    if (u.id === Jt.id || u.id === nt.id) {
      const h = o();
      l(h);
    }
  }).dispose), [r, o]);
  function a(d) {
    l(d);
    const u = e.getCurrentUnitForType(O.UNIVER_SHEET), h = u == null ? void 0 : u.getActiveSheet();
    if (h == null)
      return;
    const g = d / 100;
    r.executeCommand(ss.id, {
      unitId: u.getUnitId(),
      subUnitId: h.getSheetId(),
      zoomRatio: g
    });
  }
  const c = (i == null ? void 0 : i.visible) && (i.unitId === (t == null ? void 0 : t.getUnitId()) || i.unitId === Ae);
  return /* @__PURE__ */ b(
    rC,
    {
      disabled: c,
      min: Lc[0],
      value: s,
      shortcuts: f0,
      onChange: a
    }
  );
}
function v0() {
  return /* @__PURE__ */ b("section", { className: "univer-flex univer-flex-shrink-0 univer-justify-end", children: /* @__PURE__ */ b(p0, {}) });
}
class nf {
  constructor() {
    _(this, "_functions", [
      {
        func: ze.MAX,
        filter: (e) => {
          var t, n, i, o;
          return ((n = (t = e.values.find((s) => s.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1 && ((o = (i = e.values.find((s) => s.func === ze.COUNT)) == null ? void 0 : i.value) != null ? o : 0) > 0;
        }
      },
      {
        func: ze.MIN,
        filter: (e) => {
          var t, n, i, o;
          return ((n = (t = e.values.find((s) => s.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1 && ((o = (i = e.values.find((s) => s.func === ze.COUNT)) == null ? void 0 : i.value) != null ? o : 0) > 0;
        }
      },
      {
        func: na.SUM,
        filter: (e) => {
          var t, n, i, o;
          return ((n = (t = e.values.find((s) => s.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1 && ((o = (i = e.values.find((s) => s.func === ze.COUNT)) == null ? void 0 : i.value) != null ? o : 0) > 0;
        }
      },
      {
        func: ze.COUNTA,
        filter: (e) => {
          var t, n;
          return ((n = (t = e.values.find((i) => i.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1;
        }
      },
      {
        func: ze.COUNT,
        filter: (e) => {
          var t, n, i, o;
          return ((n = (t = e.values.find((s) => s.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1 && ((o = (i = e.values.find((s) => s.func === ze.COUNT)) == null ? void 0 : i.value) != null ? o : 0) > 0;
        }
      },
      {
        func: ze.AVERAGE,
        filter: (e) => {
          var t, n, i, o;
          return ((n = (t = e.values.find((s) => s.func === ze.COUNTA)) == null ? void 0 : t.value) != null ? n : 0) > 1 && ((o = (i = e.values.find((s) => s.func === ze.COUNT)) == null ? void 0 : i.value) != null ? o : 0) > 0;
        }
      }
    ]);
    _(this, "_state$", new Me(null));
    _(this, "state$", this._state$.asObservable());
  }
  dispose() {
    this._state$.complete();
  }
  setState(e) {
    var n;
    const t = {
      values: [],
      pattern: null
    };
    e == null || e.values.forEach((i) => {
      const o = this._functions.find((s) => s.func === i.func);
      o && (o.filter === void 0 || o.filter(e)) && t.values.push(i);
    }), t.pattern = (n = e == null ? void 0 : e.pattern) != null ? n : null, this._state$.next(t);
  }
  getState() {
    return this._state$.getValue();
  }
  getFunctions() {
    return this._functions;
  }
  addFunctions(e) {
    this._functions.push(...e);
  }
}
const xa = Yt("univer.sheet-status-bar.service"), S0 = [
  na.SUM,
  ze.AVERAGE,
  ze.MIN,
  ze.MAX
], Ua = {
  [na.SUM]: "statusbar.sum",
  [ze.AVERAGE]: "statusbar.average",
  [ze.MIN]: "statusbar.min",
  [ze.MAX]: "statusbar.max",
  [ze.COUNT]: "statusbar.count",
  [ze.COUNTA]: "statusbar.countA",
  [fC.CONCATENATE]: "concatenate"
}, C0 = (r) => {
  const e = L(xe), t = L($g), n = L(Jl), i = w0(r), o = async () => {
    await n.writeText(r.value.toString()), t.show({
      type: am.Success,
      content: e.t("statusbar.copied")
    });
  };
  return /* @__PURE__ */ b(Zn, { title: e.t("statusbar.clickToCopy"), placement: "top", children: /* @__PURE__ */ b(
    "div",
    {
      className: "univer-flex univer-cursor-pointer univer-truncate univer-text-center univer-text-xs univer-text-gray-400",
      onClick: o,
      children: /* @__PURE__ */ b("span", { children: `${e.t(
        (Ua == null ? void 0 : Ua[r.name]) || r.name
      )}: ${i}` })
    },
    r.name
  ) });
};
function w0(r) {
  const { pattern: e, value: t } = r;
  return typeof t != "number" ? 0 : t >= 1e8 ? t.toExponential(2) : e && S0.includes(r.name) ? Bt.format(e, t, { throws: !1 }) : t.toLocaleString();
}
const fh = 800, b0 = 3, _0 = () => {
  var u, h;
  const r = (h = (u = $l(Tt)) == null ? void 0 : u.statusBarStatistic) != null ? h : !0, [e, t] = re(window.innerWidth < fh), n = L(xa), i = n.getFunctions().map((g, m) => ({
    name: g.func,
    value: 0,
    show: !0,
    disable: !1,
    pattern: null
  })), o = (g, m, f, v) => {
    const [p, S] = re(g), [w, C] = re(!0), I = Ct(() => p.filter((E) => E.show && !E.disable), [p]), R = Ct(() => I.find((E) => E.show && !E.disable), [I]), y = Ct(() => f && R ? [R] : I, [f, R, I]), M = An((E) => {
      const T = E == null ? void 0 : E.values;
      if (!(T != null && T.length)) {
        C(!1);
        return;
      }
      C(!0), S(
        (P) => P.map((H) => {
          var A, x, V;
          return {
            ...H,
            value: (x = (A = T.find((D) => D.func === H.name)) == null ? void 0 : A.value) != null ? x : H.value,
            disable: !T.some((D) => D.func === H.name),
            pattern: (V = E == null ? void 0 : E.pattern) != null ? V : null
          };
        })
      );
    }, []);
    return Ee(() => {
      if (!v) return;
      const E = m.state$.subscribe(M);
      return () => E.unsubscribe();
    }, [v, m, M]), {
      statistics: p,
      showList: y,
      show: w
    };
  }, { showList: s, show: l } = o(
    i,
    n,
    e,
    r
  ), a = Rc(() => {
    const g = window.innerWidth < fh;
    e !== g && t(g);
  }, 100);
  Ee(() => (window.addEventListener("resize", a), () => {
    window.removeEventListener("resize", a);
  }), [e]);
  const d = ((g, m, f) => r ? Ct(() => g.length > m ? g.reduce((S, w, C) => (C % 2 === 0 && S.push(g.slice(C, C + 2)), S), []).map((S, w) => /* @__PURE__ */ q("div", { className: "univer-grid univer-h-full univer-items-center", children: [
    S[0] && /* @__PURE__ */ b(
      f,
      {
        ...S[0]
      },
      S[0].name
    ),
    S[1] && /* @__PURE__ */ b(
      f,
      {
        ...S[1]
      },
      S[1].name
    )
  ] }, `stat-col-${w}`)) : g.map((p) => /* @__PURE__ */ b("div", { className: "univer-grid univer-h-full univer-items-center", children: /* @__PURE__ */ b(f, { ...p }) }, p.name)), [g, m, f]) : null)(s, b0, C0);
  return l && /* @__PURE__ */ b(
    "div",
    {
      className: Te('univer-relative univer-box-border univer-flex univer-h-full univer-items-center univer-overflow-hidden univer-px-2 after:univer-absolute after:univer-right-0 after:univer-top-1/2 after:univer-block after:univer-h-4 after:univer-w-px after:-univer-translate-y-1/2 after:univer-bg-gray-200 after:univer-content-[""]', {
        "univer-max-w-32": e,
        "univer-max-w-fit": !e
      }),
      children: /* @__PURE__ */ b("div", { className: "univer-flex univer-h-full univer-gap-x-2", children: d })
    }
  );
}, rf = 36;
function R0() {
  var c;
  const r = $l(Tt), e = L(Ed), t = (c = r == null ? void 0 : r.footer) != null ? c : !0;
  if (!kr() || !t) return null;
  const i = e.getMenuByPositionKey(_t.FOOTER_MENU), { sheetBar: o = !0, statisticBar: s = !0, menus: l = !0, zoomSlider: a = !0 } = (r == null ? void 0 : r.footer) || {};
  return !o && !s && !l && !a ? null : /* @__PURE__ */ q(
    "section",
    {
      className: "univer-box-border univer-grid univer-w-full univer-grid-flow-col univer-grid-cols-[1fr,auto,auto,auto] univer-items-center univer-justify-between univer-bg-white univer-px-5 univer-text-gray-900 dark:!univer-bg-gray-900 dark:!univer-text-gray-200",
      style: {
        height: rf
      },
      "data-range-selector": !0,
      children: [
        o && /* @__PURE__ */ b(m0, {}),
        s && /* @__PURE__ */ b(_0, {}),
        l && i.length > 0 && /* @__PURE__ */ b("div", { className: "univer-box-border univer-flex univer-gap-2 univer-px-2", children: i.map((d) => {
          var u;
          return (u = d.children) == null ? void 0 : u.map((h) => (h == null ? void 0 : h.item) && /* @__PURE__ */ b(
            iC,
            {
              ...h.item
            },
            h.key
          ));
        }) }),
        a && /* @__PURE__ */ b(v0, {})
      ]
    }
  );
}
function I0() {
  const r = $l(Tt);
  return sf() && (r == null ? void 0 : r.formulaBar) !== !1 ? /* @__PURE__ */ b(s0, {}) : null;
}
function of() {
  return sf() ? /* @__PURE__ */ q($o, { children: [
    /* @__PURE__ */ b(r0, {}),
    /* @__PURE__ */ b(n0, {})
  ] }) : null;
}
function sf() {
  const r = L(k), t = !!dt(() => r.getCurrentTypeOfUnit$(O.UNIVER_SHEET), null, !1, []);
  return Ct(
    () => r.getAllUnitsForType(O.UNIVER_SHEET).length > 0,
    [r, t]
  );
}
var y0 = Object.getOwnPropertyDescriptor, M0 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? y0(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Xr = (r, e) => (t, n) => e(t, n, r);
const ph = 5, vh = 2;
let Ao = class extends oe {
  constructor(r, e, t, n, i, o) {
    super(), this._layoutService = r, this._cellEditorManagerService = e, this._editorBridgeService = t, this._renderManagerService = n, this._univerInstanceService = i, this._configService = o;
  }
  get _currentRenderer() {
    return Go(O.UNIVER_SHEET, this._univerInstanceService, this._renderManagerService);
  }
  get _editingUnitId() {
    var r, e;
    return (e = (r = this._editorBridgeService.getEditCellState()) == null ? void 0 : r.unitId) != null ? e : "";
  }
  get _editingRenderer() {
    return this._renderManagerService.getRenderById(this._editingUnitId);
  }
  get _renderer() {
    var e;
    const r = (e = this._univerInstanceService.getCurrentUnitOfType(O.UNIVER_SHEET)) == null ? void 0 : e.getUnitId();
    return this._editingUnitId === r ? this._editingRenderer : this._currentRenderer;
  }
  get _sheetSkeletonManagerService() {
    var r;
    return (r = this._renderer) == null ? void 0 : r.with(ue);
  }
  get engine() {
    var r;
    return (r = this._renderer) == null ? void 0 : r.engine;
  }
  // eslint-disable-next-line complexity
  fitTextSize(r) {
    var M, E, T, P;
    const e = this._editorBridgeService.getEditCellState();
    if (!e) return;
    const { position: t, documentLayoutObject: n, canvasOffset: i, scaleX: o, scaleY: s } = e, { startX: l, startY: a, endX: c, endY: d } = t, u = this._univerInstanceService.getUnit(Oe, O.UNIVER_DOC);
    if (u == null)
      return;
    const h = this._getEditorSkeleton();
    if (!h) return;
    const g = this._predictingSize(
      t,
      i,
      h,
      n,
      o,
      s
    );
    if (!g || g.actualWidth <= 0) return;
    let { actualWidth: m, actualHeight: f } = g;
    const { verticalAlign: v, horizontalAlign: p, paddingData: S, fill: w } = n;
    m = m + ((M = S.l) != null ? M : 0) + ((E = S.r) != null ? E : 0), f = f + ((T = S.t) != null ? T : 0) + ((P = S.b) != null ? P : 0);
    let C = c - l, I = d - a;
    C < m && (C = Math.ceil(m)), I < f && (I = Math.ceil(f));
    let R = 0;
    v === cn.MIDDLE ? R = (I - f) / 2 / s : v === cn.TOP ? R = S.t || 0 : R = (I - f) / s;
    let y = 0;
    p === It.CENTER || (p === It.RIGHT ? y = (C - m) / o : y = S.l || 0), R = R < (S.t || 0) ? S.t || 0 : R, y = y < (S.l || 0) ? S.l || 0 : y, u.updateDocumentDataMargin({
      t: R,
      l: y
    }), h.calculate(), this._editAreaProcessing(
      C,
      I,
      t,
      i,
      w,
      o,
      s,
      p,
      r
    );
  }
  /**
   * Mainly used to pre-calculate the width of the editor,
   * to determine whether it needs to be automatically widened.
   */
  _predictingSize(r, e, t, n, i = 1, o = 1) {
    const { startX: s, endX: l } = r, { textRotation: a, wrapStrategy: c, paddingData: d } = n, u = this._univerInstanceService.getUnit(Oe, O.UNIVER_DOC), { vertexAngle: h } = Id(a);
    if (c === mr.WRAP && h === 0) {
      u == null || u.updateDocumentDataPageSize(l - s), u == null || u.updateDocumentDataMargin({ l: d.l, t: d.t }), t.calculate();
      const { actualWidth: v, actualHeight: p } = t.getActualSize();
      return {
        actualWidth: v * i,
        actualHeight: p * o
      };
    }
    const g = this._getEditorMaxSize(r, e, n.horizontalAlign);
    if (!g) return;
    u == null || u.updateDocumentDataPageSize(g.width / i), t.calculate();
    const m = t.getActualSize();
    let f = l - s;
    return f < m.actualWidth * i + ph * i && (f = m.actualWidth * i + ph * i), u == null || u.updateDocumentDataPageSize(f / i), u == null || u.updateDocumentRenderConfig({
      horizontalAlign: It.UNSPECIFIED,
      cellValueType: void 0
    }), {
      actualWidth: m.actualWidth * i,
      actualHeight: m.actualHeight * o
    };
  }
  _getEditorMaxSize(r, e, t) {
    var S, w, C, I;
    if (this._getEditorObject() == null)
      return;
    function i(R) {
      return Number.parseInt(R.replace("px", ""));
    }
    const o = this.engine;
    if (!o) return;
    const s = o.getCanvasElement(), l = s.getBoundingClientRect(), a = i(s.style.width), { width: c } = l, d = c / a, { startX: u, startY: h, endX: g } = r, m = o.width, f = ((w = (S = this._configService.getConfig(ea)) == null ? void 0 : S.footer) == null || w) && ((I = (C = this._configService.getConfig(Tt)) == null ? void 0 : C.footer) == null || I) ? rf : 0, v = document.body.clientHeight - h - f - e.top - vh * 2;
    let p = c - u;
    if (t === It.CENTER) {
      const R = m - g, y = u;
      p = g - u + Math.min(y, R) * 2;
    } else t === It.RIGHT && (p = g);
    return {
      height: v,
      width: p - vh,
      scaleAdjust: d
    };
  }
  /**
   * Mainly used to calculate the volume of scenes and objects,
   * determine whether a scrollbar appears,
   * and calculate the editor's boundaries relative to the browser.
   */
  // eslint-disable-next-line max-lines-per-function
  _editAreaProcessing(r, e, t, n, i, o = 1, s = 1, l, a) {
    var A;
    const c = this._getEditorObject();
    if (c == null)
      return;
    const d = this.engine;
    if (!d) return;
    const u = d.getCanvasElement();
    let { startX: h, startY: g } = t;
    const { document: m, scene: f, engine: v } = c, p = f.getViewport(ks.VIEW_MAIN), S = this._getEditorMaxSize(t, n, l), { height: w, width: C, scaleAdjust: I } = S;
    let R = e, y = p == null ? void 0 : p.getScrollBar();
    R > w ? (y == null ? p && new yd(p, { enableHorizontal: !1, barSize: 8 }) : p == null || p.resetCanvasSizeAndUpdateScroll(), p == null || p.scrollToViewportPos({
      viewportScrollY: R - w
    }), R = w) : (y = null, (A = p == null ? void 0 : p.getScrollBar()) == null || A.dispose()), r += (y == null ? void 0 : y.barSize) || 0, r > C && (r = C), this._addBackground(f, r / o, e / s, i);
    const { scaleX: M, scaleY: E } = f.getPrecisionScale();
    f.transformByState({
      width: r * I / o,
      height: e * I / s,
      scaleX: o * I,
      scaleY: s * I
    }), m.resize(r * I / o, e * I / s), setTimeout(() => {
      v.resizeBySize(
        Tu(r, M),
        Tu(R, E)
      ), a == null || a();
    }, 0);
    const T = this._layoutService.getContentElement().getBoundingClientRect(), P = u.getBoundingClientRect();
    h = h * I + (P.left - T.left), g = g * I + (P.top - T.top);
    const H = t.endX - t.startX;
    l === It.RIGHT ? h += (H - r) * I : l === It.CENTER && (h += (H - r * I) / 2), this._cellEditorManagerService.setState({
      startX: h,
      startY: g,
      endX: r * I + h,
      endY: R * I + g,
      show: !0
    });
  }
  /**
   * Since the document does not support cell background color, an additional rect needs to be added.
   */
  _addBackground(r, e, t, n) {
    const i = "_backgroundRectHelperColor_", o = r.getObject(i);
    o == null && n == null || (o == null ? r.addObjects(
      [
        new Se(i, {
          width: e,
          height: t,
          fill: n,
          evented: !1
        })
      ],
      Kp
    ) : n == null ? o.dispose() : (o.setProps({
      fill: n
    }), o.transformByState({
      width: e,
      height: t
    })));
  }
  resizeCellEditor(r) {
    var I, R;
    const e = this._cellEditorManagerService.getState();
    if (!e || !this._editorBridgeService.isVisible().visible) return;
    this._editorBridgeService.refreshEditCellPosition(!0);
    const t = this._editorBridgeService.getEditCellState();
    if (!t) return;
    const n = (R = (I = this._sheetSkeletonManagerService) == null ? void 0 : I.getSkeletonParam(t.sheetId)) == null ? void 0 : R.skeleton;
    if (!n) return;
    const { row: i, column: o, scaleX: s, scaleY: l, position: a, canvasOffset: c, documentLayoutObject: d } = t, { horizontalAlign: u } = d, h = this._getEditorMaxSize(a, c, u);
    if (!h) return;
    const { height: g, width: m, scaleAdjust: f } = h, v = n.getCellWithCoordByIndex(i, o), p = Math.min((v.mergeInfo.endY - v.mergeInfo.startY) * l, g) * f, S = Math.min((v.mergeInfo.endX - v.mergeInfo.startX) * s, m) * f, w = e.endY - e.startY, C = e.endX - e.startX;
    if (w !== p || C !== S) {
      if (this._editorBridgeService.refreshEditCellPosition(!0), !this._getEditorSkeleton())
        return;
      this.fitTextSize(r);
    }
  }
  _getEditorObject() {
    return Dd(this._editorBridgeService.getCurrentEditorId(), this._renderManagerService);
  }
  _getEditorSkeleton() {
    var r;
    return (r = this._renderManagerService.getRenderById(Oe)) == null ? void 0 : r.with(Jn).getSkeleton();
  }
};
Ao = M0([
  Xr(0, Td),
  Xr(1, ls),
  Xr(2, qe),
  Xr(3, fe),
  Xr(4, k),
  Xr(5, Vt)
], Ao);
var E0 = Object.getOwnPropertyDescriptor, T0 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? E0(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ar = (r, e) => (t, n) => e(t, n, r);
let Ho = class extends kn {
  constructor(e, t, n, i, o, s, l, a) {
    super();
    _(this, "_d");
    this._context = e, this._instanceSrv = t, this._commandService = n, this._editorBridgeService = i, this._selectionManagerService = o, this._contextService = s, this._renderManagerService = l, this._sheetSkeletonManagerService = a, this.disposeWithMe(this._instanceSrv.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe((c) => {
      c && c.getUnitId() === this._context.unitId ? this._d = this._init() : this._disposeCurrent();
    }));
  }
  _init() {
    const e = new ht();
    return this._initSelectionChangeListener(e), this._initEventListener(e), this._commandExecutedListener(e), this._initialKeyboardListener(e), e;
  }
  _disposeCurrent() {
    var e;
    (e = this._d) == null || e.dispose(), this._d = null;
  }
  _initSelectionChangeListener(e) {
    e.add(St(
      this._selectionManagerService.selectionMoveEnd$,
      this._selectionManagerService.selectionSet$,
      this._selectionManagerService.selectionMoveStart$
    ).subscribe((t) => this._updateEditorPosition(t)));
  }
  _updateEditorPosition(e) {
    var n, i, o;
    if (this._editorBridgeService.isVisible().visible) return;
    const t = (n = e == null ? void 0 : e[e.length - 1]) == null ? void 0 : n.primary;
    if (t) {
      const s = this._getSheetObject(), { scene: l, engine: a } = s, c = this._context.unitId, d = (i = this._context.unit.getActiveSheet()) == null ? void 0 : i.getSheetId();
      if (!d) return;
      const u = (o = this._sheetSkeletonManagerService.getSkeletonParam(d)) == null ? void 0 : o.skeleton.getCellWithCoordByIndex(t.actualRow, t.actualColumn), h = u ? {
        actualRow: u.actualRow,
        actualColumn: u.actualColumn,
        isMerged: u.isMerged,
        startRow: u.mergeInfo.startRow,
        startColumn: u.mergeInfo.startColumn,
        endRow: u.mergeInfo.endRow,
        endColumn: u.mergeInfo.endColumn,
        isMergedMainCell: u.isMergedMainCell
      } : t;
      this._commandService.executeCommand(Jd.id, {
        scene: l,
        engine: a,
        primary: h,
        unitId: c,
        sheetId: d
      });
    }
  }
  refreshEditorPosition() {
    const e = this._selectionManagerService.getWorkbookSelections(this._context.unitId);
    if (e) {
      const t = e.getCurrentSelections();
      t && this._updateEditorPosition([...t]);
    }
  }
  _initEventListener(e) {
    const t = this._getSheetObject(), { spreadsheet: n, spreadsheetColumnHeader: i, spreadsheetLeftTopPlaceholder: o, spreadsheetRowHeader: s } = t;
    e.add(n.onDblclick$.subscribeEvent((l) => {
      l.button !== 2 && this._commandService.executeCommand(tt.id, {
        visible: !0,
        eventType: je.Dblclick,
        unitId: this._context.unitId
      });
    })), e.add(n.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(i.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(o.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    })), e.add(s.onPointerDown$.subscribeEvent({
      next: this._tryHideEditor.bind(this),
      priority: -1
    }));
  }
  /**
   * Should activate the editor when the user inputs text.
   * @param d DisposableCollection
   */
  _initialKeyboardListener(e) {
    let t = null;
    const n = (o) => {
      const s = o.with(Qn);
      s && (t = We(s.onInputBefore$.subscribe((l) => {
        if (!this._isCurrentSheetFocused())
          return;
        const a = this._contextService.getContextValue(Ot), c = this._contextService.getContextValue(Nt), d = o.unitId;
        this._editorBridgeService.isVisible().visible || d && c && !a && this._showEditorByKeyboard(l);
      })), e.add(t));
    }, i = this._renderManagerService.getRenderById(Oe);
    i ? n(i) : this.disposeWithMe(this._renderManagerService.created$.pipe(qo((o) => o.unitId === Oe)).subscribe((o) => {
      t == null || t.dispose(), n(o);
    }));
  }
  _commandExecutedListener(e) {
    const t = /* @__PURE__ */ new Set([uo.id, ss.id]);
    e.add(this._commandService.onCommandExecuted((n) => {
      if (t.has(n.id)) {
        if (this._editorBridgeService.isVisible().visible) return;
        this._editorBridgeService.refreshEditCellState();
      }
      if (n.id === we.id) {
        const i = n.params, { cellValue: o, unitId: s, subUnitId: l } = i;
        if (!o) return;
        const a = this._editorBridgeService.getEditLocation();
        if (a) {
          const { unitId: c, sheetId: d, row: u, column: h } = a;
          s === c && l === d && o && o[u] && Object.prototype.hasOwnProperty.call(o[u], h) && this._editorBridgeService.refreshEditCellState();
        }
      }
    })), e.add(this._commandService.beforeCommandExecuted((n, i) => {
      i != null && i.fromCollab || n.id === nt.id && this._tryHideEditor();
    }));
  }
  _showEditorByKeyboard(e) {
    const t = e == null ? void 0 : e.event;
    e == null || !t.data && t.inputType !== "InsertParagraph" || this._commandService.syncExecuteCommand(tt.id, {
      visible: !0,
      eventType: je.Keyboard,
      keycode: t.which,
      unitId: this._context.unitId
    });
  }
  _tryHideEditor() {
    this._editorBridgeService.isForceKeepVisible() || this._hideEditor();
  }
  _hideEditor() {
    this._editorBridgeService.isVisible().visible === !0 && this._commandService.syncExecuteCommand(tt.id, {
      visible: !1,
      eventType: je.PointerDown,
      unitId: this._context.unitId
    });
  }
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  _isCurrentSheetFocused() {
    var e;
    return ((e = this._instanceSrv.getFocusedUnit()) == null ? void 0 : e.getUnitId()) === this._context.unitId;
  }
};
Ho = T0([
  ar(1, k),
  ar(2, W),
  ar(3, qe),
  ar(4, N(Q)),
  ar(5, De),
  ar(6, fe),
  ar(7, N(ue))
], Ho);
const lf = [
  Y.ARROW_DOWN,
  Y.ARROW_UP,
  Y.ARROW_LEFT,
  Y.ARROW_RIGHT
], P0 = [Y.ENTER, Y.TAB, ...lf];
function af() {
  const r = [];
  for (const e of lf)
    r.push({
      id: wi.id,
      binding: e,
      preconditions: (t) => mi(t),
      staticParameters: {
        visible: !1,
        eventType: je.Keyboard,
        keycode: e,
        isShift: !1
      }
    }), r.push({
      id: wi.id,
      binding: e | ve.SHIFT,
      preconditions: (t) => mi(t),
      staticParameters: {
        visible: !1,
        eventType: je.Keyboard,
        keycode: e,
        isShift: !0
      }
    });
  return r;
}
const cf = {
  id: Ea.id,
  binding: Y.F2,
  description: "shortcut.sheet.start-editing",
  group: "4_sheet-edit",
  preconditions: Ve,
  staticParameters: {
    visible: !0,
    eventType: je.Keyboard,
    keycode: Y.F2
  }
}, df = {
  id: tt.id,
  binding: Y.ENTER,
  description: "shortcut.sheet.toggle-editing",
  group: "4_sheet-edit",
  preconditions: (r) => mi(r),
  staticParameters: {
    visible: !1,
    eventType: je.Keyboard,
    keycode: Y.ENTER
  }
}, uf = {
  id: tt.id,
  binding: Y.TAB,
  preconditions: (r) => mi(r),
  staticParameters: {
    visible: !1,
    eventType: je.Keyboard,
    keycode: Y.TAB
  }
}, hf = {
  id: tt.id,
  binding: Y.ESC,
  description: "shortcut.sheet.abort-editing",
  group: "4_sheet-edit",
  preconditions: (r) => mi(r),
  staticParameters: {
    visible: !1,
    eventType: je.Keyboard,
    keycode: Y.ESC
  }
}, gf = {
  id: tt.id,
  binding: Y.ENTER | ve.CTRL_COMMAND,
  mac: Y.ENTER | ve.MAC_CTRL,
  preconditions: (r) => mi(r),
  staticParameters: {
    visible: !1,
    eventType: je.Keyboard,
    keycode: Y.ENTER | ve.CTRL_COMMAND
  }
}, mf = {
  id: Jp.id,
  description: "shortcut.sheet.break-line",
  group: "4_sheet-edit",
  preconditions: (r) => l1(r),
  binding: Y.ENTER | ve.ALT
}, ff = {
  id: Zh.id,
  preconditions: (r) => Ud(r) || la(r),
  binding: Y.BACKSPACE
}, pf = {
  id: $p.id,
  preconditions: (r) => Ud(r) || la(r),
  binding: Y.DELETE
}, vf = {
  id: Zh.id,
  preconditions: (r) => Ud(r) || la(r),
  binding: Y.BACKSPACE | ve.SHIFT
}, Sf = {
  id: tt.id,
  description: "shortcut.sheet.delete-and-start-editing",
  group: "4_sheet-edit",
  preconditions: (r) => Ve(r) && !la(r),
  binding: Y.BACKSPACE,
  staticParameters: {
    visible: !0,
    eventType: je.Keyboard,
    keycode: Y.BACKSPACE
  }
};
function x0(r) {
  return r.startsWith("'");
}
function O0(r) {
  return r.slice(1);
}
const A0 = {
  "": "0",
  "": "1",
  "": "2",
  "": "3",
  "": "4",
  "": "5",
  "": "6",
  "": "7",
  "": "8",
  "": "9",
  : "A",
  : "B",
  : "C",
  : "D",
  : "E",
  : "F",
  : "G",
  : "H",
  : "I",
  : "J",
  : "K",
  : "L",
  : "M",
  : "N",
  : "O",
  : "P",
  : "Q",
  : "R",
  : "S",
  : "T",
  : "U",
  : "V",
  : "W",
  : "X",
  : "Y",
  : "Z",
  : "a",
  : "b",
  : "c",
  : "d",
  : "e",
  : "f",
  : "g",
  : "h",
  : "i",
  : "j",
  : "k",
  : "l",
  : "m",
  : "n",
  : "o",
  : "p",
  : "q",
  : "r",
  : "s",
  : "t",
  : "u",
  : "v",
  : "w",
  : "x",
  : "y",
  : "z",
  "": "%",
  "": "-",
  "": ".",
  "": ":",
  "": "/",
  "": "+",
  "": "@",
  "": "&",
  "": "*",
  "": "#",
  "": "=",
  "": ">",
  "": "<",
  "": "$",
  "": '"',
  "": "'",
  "": "(",
  "": ")",
  "": " ",
  "": ",",
  "": "!",
  "": "?",
  "": ";",
  "": "[",
  "": "]",
  "": "{",
  "": "}"
}, Yc = {
  true: "TRUE",
  false: "FALSE"
};
function H0(r) {
  return [Cu.ZH_CN, Cu.ZH_TW].includes(r);
}
function V0(r, e, t, n) {
  let i = r;
  if (H0(t)) {
    if (r.startsWith("") || r.startsWith("'"))
      return `'${r.slice(1)}`;
    i = N0(i);
  }
  if (i.startsWith("="))
    return k0(r, i, e, n);
  const o = i.toLowerCase();
  return Yc[o] ? Yc[o] : Bt.parseValue(i) == null ? r : i;
}
function N0(r) {
  const e = /['"].*?['"]/g, t = [], n = r.split(e);
  r.replace(e, (o) => (t.push(o), ""));
  let i = n.join("").split("").map(W0).join("");
  return t.forEach((o, s) => {
    i = i.slice(0, s * 2) + o + i.slice((s + 1) * 2);
  }), i;
}
function k0(r, e, t, n) {
  const i = t.sequenceNodesBuilder(e);
  if (!i) return r;
  let o = e, s = 0;
  return i.forEach((l, a) => {
    if (typeof l == "object") {
      const c = l.token;
      if (Yc[c.toLowerCase()]) {
        const d = l.startIndex + s + 1, u = l.endIndex + s + 2;
        o = zr(c.toLocaleUpperCase(), o, d, u);
      } else if (l.nodeType === Va.FUNCTION && D0(c, n, i, a) || l.nodeType === Va.REFERENCE) {
        const d = c.indexOf("!");
        if (d > -1) {
          const u = c.substring(d + 1), h = l.startIndex + s + (d + 1) + 1, g = l.endIndex + s + 2;
          o = zr(u.toLocaleUpperCase(), o, h, g);
        } else {
          const u = l.startIndex + s + 1, h = l.endIndex + s + 2;
          o = zr(c.toLocaleUpperCase(), o, u, h);
        }
      } else if (c.startsWith('"') && c.endsWith('"') || c.startsWith("'") && c.endsWith("'")) {
        const d = l.startIndex + s + 2, u = l.endIndex + s + 1;
        o = zr(r.slice(d, u), o, d, u);
      } else if (l.nodeType !== Va.ARRAY) {
        const d = Bt.parseValue(c);
        if (d == null) {
          const u = l.startIndex + s + 1, h = l.endIndex + s + 2;
          o = zr(r.slice(u, h), o, u, h);
        } else if (typeof d.v == "number" && (d.z === void 0 || !Bt.getFormatInfo(d.z).isDate)) {
          const u = `${d.v}`, h = l.startIndex + s + 1, g = l.endIndex + s + 2, { processedString: m, offset: f } = B0(c, u);
          o = zr(m, o, h, g), s += f;
        }
      }
    }
  }), o;
}
function D0(r, e, t, n) {
  const i = e.getDescriptions();
  return t[n + 1] !== tm.OPEN_BRACKET ? !1 : i.get(L0(r).toLocaleUpperCase()) !== void 0;
}
function L0(r) {
  const e = /^@+/;
  return r.replace(e, "");
}
function W0(r) {
  return A0[r] || r;
}
function zr(r, e, t, n) {
  return e.substring(0, t) + r + e.substring(n);
}
function B0(r, e) {
  var s, l;
  const t = ((s = r.match(/^\s*/)) == null ? void 0 : s[0]) || "", n = ((l = r.match(/\s*$/)) == null ? void 0 : l[0]) || "", i = t + e + n, o = i.length - r.length;
  return { processedString: i, offset: o };
}
const F0 = "range_selector", U0 = (r) => r.includes(F0);
var X0 = Object.getOwnPropertyDescriptor, z0 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? X0(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Mt = (r, e) => (t, n) => e(t, n, r);
const Sh = -1e3;
let Ri = class extends oe {
  constructor(e, t, n, i, o, s, l, a, c, d, u, h, g, m, f) {
    super();
    /**
     * It is used to distinguish whether the user has actively moved the cursor in the editor, mainly through mouse clicks.
     */
    _(this, "_cursorChange", 0);
    /** If the corresponding unit is active and prepared for editing. */
    _(this, "_editingUnit", "");
    _(this, "_cursorTimeout");
    this._undoRedoService = e, this._contextService = t, this._renderManagerService = n, this._editorBridgeService = i, this._cellEditorManagerService = o, this._lexerTreeBuilder = s, this._functionService = l, this._textSelectionManagerService = a, this._commandService = c, this._localService = d, this._editorService = u, this._univerInstanceService = h, this._sheetInterceptorService = g, this._sheetCellEditorResizeService = m, this._selectionManagerService = f, this.disposeWithMe(this._init()), this._initEditorVisibilityListener();
  }
  dispose() {
    super.dispose();
  }
  get _workbookSelections() {
    return this._selectionManagerService.getWorkbookSelections(this._editingUnit);
  }
  _init() {
    const e = new ht();
    return this._subscribeToCurrentCell(e), this._initialCursorSync(e), this._listenEditorFocus(e), this._commandExecutedListener(e), this._initSkeletonListener(e), e.add(() => {
      clearTimeout(this._cursorTimeout);
    }), this._cursorTimeout = setTimeout(() => {
      this._cursorStateListener(e);
    }, 1e3), e;
  }
  _initEditorVisibilityListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe(async (e) => {
      var t;
      if (this._editingUnit && (e == null ? void 0 : e.getUnitId()) !== this._editingUnit && !this._editorBridgeService.isForceKeepVisible()) {
        this._commandService.syncExecuteCommand(tt.id, {
          visible: !1,
          eventType: je.Keyboard,
          keycode: Y.ESC,
          unitId: this._editingUnit
        });
        const n = (t = this._renderManagerService.getRenderById(e.getUnitId())) == null ? void 0 : t.with(Ho);
        n && n.refreshEditorPosition();
      }
    })), this.disposeWithMe(
      this._editorBridgeService.visible$.pipe(dn((e, t) => e.visible === t.visible)).subscribe(async (e) => {
        e.visible ? (this._editingUnit = e.unitId, this._handleEditorVisible(e)) : this._editingUnit && (await this._handleEditorInvisible(e), this._editingUnit = "");
      })
    );
  }
  _listenEditorFocus(e) {
    const t = this._getEditorObject();
    t && e.add(t.document.onPointerDown$.subscribeEvent(() => {
      var n;
      if (this._editingUnit && this._editorBridgeService.isVisible()) {
        const i = this._editorBridgeService.getEditCellState(), o = this._editorBridgeService.getCurrentEditorId();
        if (!i || !o)
          return;
        (n = this._sheetCellEditorResizeService) == null || n.fitTextSize();
      }
    }));
  }
  _initialCursorSync(e) {
    e.add(this._cellEditorManagerService.focus$.pipe(qo((t) => !!t)).subscribe(() => {
      var i;
      const t = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_DOC);
      if (!t) return;
      const n = (i = this._renderManagerService.getRenderById(t == null ? void 0 : t.getUnitId())) == null ? void 0 : i.with(Qn);
      n && n.sync();
    }));
  }
  _initSkeletonListener(e) {
    const t = new Set(Xs);
    t.delete(nt.id), e.add(this._commandService.onCommandExecuted((n) => {
      var i;
      if (t.has(n.id)) {
        switch (n.id) {
          case Ul.id:
          case Xl.id:
          case zo.id:
          case Xo.id:
          case Yo.id:
          case jo.id: {
            const o = this._editorBridgeService.getEditLocation();
            if (!o) break;
            const s = {
              startRow: o.row,
              startColumn: o.column,
              endRow: o.row,
              endColumn: o.column
            }, l = Wv(s, n);
            if (!l) break;
            const a = l.startRow, c = l.startColumn;
            this._editorBridgeService.updateEditLocation(a, c);
            break;
          }
        }
        (i = this._sheetCellEditorResizeService) == null || i.resizeCellEditor(() => {
          this._textSelectionManagerService.refreshSelection({
            unitId: Oe,
            subUnitId: Oe
          });
        });
      }
    }));
  }
  /**
   * Should update current editing cell info when selection is changed.
   * @param d DisposableCollection
   */
  _subscribeToCurrentCell(e) {
    e.add(this._editorBridgeService.currentEditCellState$.subscribe((t) => {
      var p, S;
      if (t == null || this._editorBridgeService.isForceKeepVisible())
        return;
      const n = this._editorBridgeService.getEditCellState();
      if (n == null)
        return;
      const { position: i, documentLayoutObject: o, scaleX: s, editorUnitId: l } = n;
      if (this._contextService.getContextValue(Ll))
        return;
      const a = this._getDocumentDataModel();
      if (a == null) return;
      const { startX: c, endX: d } = i, { textRotation: u, wrapStrategy: h, documentModel: g } = o, { vertexAngle: m } = Id(u);
      h === mr.WRAP && m === 0 && a.updateDocumentDataPageSize((d - c) / s), this._commandService.syncExecuteCommand(Gh.id, {
        unitId: l,
        snapshot: g.getSnapshot()
      }), this._contextService.setContextValue(Ic, !0), this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: 0,
          endOffset: 0
        }],
        {
          unitId: Oe,
          subUnitId: Oe
        }
      );
      const f = (p = this._renderManagerService.getRenderById(Oe)) == null ? void 0 : p.with(Qn), v = (S = this._renderManagerService.getRenderById(Ae)) == null ? void 0 : S.with(Qn);
      (f != null && f.canFocusing || v != null && v.canFocusing) && (this._univerInstanceService.setCurrentUnitForType(Oe), f == null || f.activate(
        Sh,
        Sh,
        !0
      ));
    }));
  }
  /**
   * Listen to document edits to refresh the size of the sheet editor, not for normal editor.
   */
  _commandExecutedListener(e) {
    e.add(this._commandService.onCommandExecuted((n) => {
      var i;
      if (n.id === wo.id) {
        const o = n.params, { unitId: s } = o;
        if (U0(s) || (this._editorBridgeService.changeEditorDirty(!0), !this._editorBridgeService.isVisible().visible))
          return;
        s === Oe && ((i = this._sheetCellEditorResizeService) == null || i.fitTextSize());
      }
    }));
    const t = [wi.id];
    e.add(this._commandService.onCommandExecuted((n) => {
      if (t.includes(n.id)) {
        const i = n.params, { keycode: o, isShift: s } = i;
        if (o != null && (this._cursorChange === 2 || this._contextService.getContextValue(Ot))) {
          this._moveInEditor(o, s);
          return;
        }
        this._commandService.syncExecuteCommand(tt.id, i);
      }
      n.id === Ea.id && (this._cursorChange = 2);
    }));
  }
  // You can double-click on the cell or input content by keyboard to put the cell into the edit state.
  // eslint-disable-next-line complexity
  _handleEditorVisible(e) {
    var g, m, f, v;
    const { eventType: t, keycode: n } = e;
    this._cursorChange = t === je.PointerDown || t === je.Dblclick ? 2 : 1;
    const i = this._editorBridgeService.getEditLocation();
    if (i == null)
      return;
    this._commandService.syncExecuteCommand($d.id, {
      range: {
        startRow: i.row,
        startColumn: i.column,
        endRow: i.row,
        endColumn: i.column
      }
    }), this._editorBridgeService.refreshEditCellPosition(!1);
    const { unitId: o, isInArrayFormulaRange: s = !1 } = i, l = this._getEditorObject();
    if (l == null)
      return;
    const { document: a, scene: c } = l;
    this._contextService.setContextValue(Je, !0);
    const d = this._getDocumentDataModel(), u = this._getEditorSkeleton(Oe);
    if (!u || !d)
      return;
    (g = this._sheetCellEditorResizeService) == null || g.fitTextSize(() => {
      const p = c.getViewport(ks.VIEW_MAIN);
      p == null || p.scrollToViewportPos({
        viewportScrollX: Number.POSITIVE_INFINITY,
        viewportScrollY: Number.POSITIVE_INFINITY
      });
    });
    const h = () => {
      this._emptyDocumentDataModel(d.getSnapshot().documentStyle, !!s), a.makeDirty(), (n === Y.BACKSPACE || t === je.Dblclick) && (u.calculate(), this._editorBridgeService.changeEditorDirty(!0)), this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: 0,
          endOffset: 0
        }],
        {
          unitId: Oe,
          subUnitId: Oe
        }
      );
    };
    if (this._isCellImageData(d.getSnapshot()))
      h();
    else if (t === je.Keyboard && n === Y.F2) {
      a.makeDirty(), this._textSelectionManagerService.replaceDocRanges([
        {
          startOffset: 0,
          endOffset: 0
        }
      ]);
      const p = ((f = (m = d.getBody()) == null ? void 0 : m.dataStream.length) != null ? f : 2) - 2;
      this._textSelectionManagerService.replaceDocRanges(
        [{
          startOffset: p,
          endOffset: p
        }],
        {
          unitId: Oe,
          subUnitId: Oe
        }
      );
    } else if (
      // clear and edit
      t === je.Keyboard || t === je.Dblclick && s
    )
      h();
    else if (t === je.Dblclick) {
      if (this._contextService.getContextValue(Ls))
        return;
      const p = d.getBody().dataStream.length - 2 || 0;
      this._textSelectionManagerService.replaceDocRanges([
        {
          startOffset: p,
          endOffset: p
        }
      ]);
    }
    (v = this._renderManagerService.getRenderById(o)) == null || v.scene.resetCursor();
  }
  _refreshCurrentSelections(e) {
    const t = this._workbookSelections.getSelectionsOfWorksheet(e);
    t && (this._contextService.setContextValue(vo, !1), this._commandService.syncExecuteCommand(Ie.id, {
      unitId: this._editingUnit,
      subUnitId: e,
      selections: t
    }));
  }
  async _handleEditorInvisible(e) {
    var f, v;
    const t = this._editorBridgeService.getEditCellState(), n = this._univerInstanceService.getUnit(Oe), i = de.deepClone(n == null ? void 0 : n.getSnapshot()), { keycode: o } = e;
    this._cursorChange = 0;
    const s = (f = t == null ? void 0 : t.unitId) != null ? f : "";
    if (this._exitInput(e), t == null)
      return;
    const l = this._univerInstanceService.getUnit(s, O.UNIVER_SHEET);
    if (!l)
      return;
    const a = l.getActiveSheet(), c = l.getUnitId(), d = a.getSheetId(), { unitId: u, sheetId: h } = t;
    if (c === u && h !== d && await this._commandService.executeCommand(Cd.id, {
      subUnitId: h,
      unitId: u
    }), o === Y.ESC) {
      this._editorBridgeService.isForceKeepVisible() && this._editorBridgeService.disableForceKeepVisible(), this._refreshCurrentSelections(h);
      return;
    }
    const g = ((v = i == null ? void 0 : i.body) == null ? void 0 : v.dataStream.length) === 2, m = t.documentLayoutObject.documentModel ? this._isCellImageData(t.documentLayoutObject.documentModel.getSnapshot()) : !1;
    i && !(g && m) && await this._submitEdit(i, o === (ve.CTRL_COMMAND | Y.ENTER) || o === (ve.MAC_CTRL | Y.ENTER)) === !1 || o !== void 0 && this._moveSelection(o, s, d);
  }
  _getEditorObject() {
    return Dd(this._editorBridgeService.getCurrentEditorId(), this._renderManagerService);
  }
  _isCellImageData(e) {
    var n, i;
    return ((i = (n = e.drawingsOrder) == null ? void 0 : n.length) != null ? i : 0) > 0;
  }
  submitCellData(e) {
    return this._submitEdit(e.getSnapshot());
  }
  async _submitEdit(e, t = !1) {
    var v;
    const n = this._editorBridgeService.getEditCellState();
    if (n == null)
      return !0;
    const { unitId: i, sheetId: o, row: s, column: l } = n, a = this._univerInstanceService.getUnit(i, O.UNIVER_SHEET);
    if (!a)
      return !0;
    let c = a.getActiveSheet();
    if (!a.getSheetBySheetId(o))
      return !0;
    c = a.getActiveSheet();
    const u = j0(
      { ...c.getCellRaw(s, l) || {} },
      e,
      this._lexerTreeBuilder,
      this._localService,
      this._functionService,
      a.getStyles()
    );
    if (!u)
      return !0;
    this._removeComposedCellStyleInCellData(u, c.getComposedCellStyle(s, l));
    const h = this._sheetInterceptorService.onWriteCell(a, c, s, l, u);
    if (de.diffValue(wh(h), wh(c.getCellRaw(s, l))))
      return !0;
    const g = t ? (v = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : v.range : {
      startRow: s,
      startColumn: l,
      endRow: s,
      endColumn: l
    }, m = xn(6);
    return this._commandService.syncExecuteCommand(Fl.id, {
      subUnitId: o,
      unitId: i,
      range: g,
      value: h,
      redoUndoId: m
    }) && await this._sheetInterceptorService.onValidateCell(a, c, s, l) === !1 ? (this._undoRedoService.rollback(m, i), !1) : !0;
  }
  _removeComposedCellStyleInCellData(e, t) {
    if (!e.s || typeof e.s == "string")
      return;
    const n = Object.keys(e.s);
    for (const i of n)
      t[i] !== void 0 && de.diffValue(e.s[i], t[i]) && delete e.s[i];
  }
  _exitInput(e) {
    var i, o;
    this._contextService.setContextValue(Ls, !1), this._contextService.setContextValue(Je, !1), this._contextService.setContextValue(Ic, !1), this._contextService.setContextValue(Ot, !1), this._cellEditorManagerService.setState({
      show: e.visible
    });
    const t = this._getEditorObject();
    (i = t == null ? void 0 : t.scene.getViewport(ks.VIEW_MAIN)) == null || i.scrollToViewportPos({
      viewportScrollX: 0,
      viewportScrollY: 0
    });
    const n = this._editorBridgeService.getCurrentEditorId();
    n == null || !this._editorService.isSheetEditor(n) || (n === Oe && ((o = this._getEditorSkeleton(Oe)) == null || o.resetInitialWidth()), this._undoRedoService.clearUndoRedo(n), this._undoRedoService.clearUndoRedo(Ae));
  }
  _moveSelection(e, t, n) {
    if (e == null || !P0.includes(e)) {
      this._refreshCurrentSelections(n);
      return;
    }
    let i = U.LEFT;
    switch (e) {
      case Y.ENTER:
        i = U.DOWN;
        break;
      case Y.TAB:
        i = U.RIGHT;
        break;
      case Y.ARROW_DOWN:
        i = U.DOWN;
        break;
      case Y.ARROW_UP:
        i = U.UP;
        break;
      case Y.ARROW_LEFT:
        i = U.LEFT;
        break;
      case Y.ARROW_RIGHT:
        i = U.RIGHT;
        break;
    }
    const o = this._univerInstanceService.getCurrentUnitOfType(O.UNIVER_SHEET);
    t && (o == null ? void 0 : o.getUnitId()) !== t && this._univerInstanceService.setCurrentUnitForType(t), e === Y.ENTER || e === Y.TAB ? this._commandService.executeCommand(Wn.id, {
      keycode: e,
      direction: i
    }) : this._commandService.executeCommand(Ut.id, {
      direction: i
    });
  }
  /**
   * The user's operations follow the sequence of opening the editor and then moving the cursor.
   * The logic here predicts the user's first cursor movement behavior based on this rule
   */
  _cursorStateListener(e) {
    const t = this._getEditorObject();
    if (!(t != null && t.document)) return;
    const { document: n } = t;
    e.add(We(n.onPointerDown$.subscribeEvent(() => {
      this._cursorChange === 1 && (this._cursorChange = 2);
    })));
  }
  // TODO: @JOCS, is it necessary to move these commands MoveSelectionOperation\MoveCursorOperation to shortcut? and use multi-commands?
  _moveInEditor(e, t) {
    let n = U.LEFT;
    e === Y.ARROW_DOWN ? n = U.DOWN : e === Y.ARROW_UP ? n = U.UP : e === Y.ARROW_RIGHT && (n = U.RIGHT), t ? this._commandService.executeCommand(ev.id, {
      direction: n
    }) : this._commandService.executeCommand(tv.id, {
      direction: n
    });
  }
  _getDocumentDataModel() {
    return this._univerInstanceService.getUnit(Oe, O.UNIVER_DOC);
  }
  _getEditorSkeleton(e) {
    var t;
    return (t = this._renderManagerService.getRenderById(e)) == null ? void 0 : t.with(Jn).getSkeleton();
  }
  _getEditorViewModel(e) {
    var t;
    return (t = this._renderManagerService.getRenderById(e)) == null ? void 0 : t.with(Jn).getViewModel();
  }
  _getEditingUnit() {
    return this._editingUnit ? this._univerInstanceService.getUnit(this._editingUnit, O.UNIVER_SHEET) : null;
  }
  _emptyDocumentDataModel(e, t) {
    const n = (s, l) => {
      const a = de.deepClone(s.getSnapshot()), c = this._getEditorViewModel(s.getUnitId());
      c != null && (Y0(a.body, t), l && (a.documentStyle = e), a.drawings = {}, a.drawingsOrder = [], s.reset(a), c.reset(s));
    }, i = this._getDocumentDataModel();
    i && n(i, !0);
    const o = this._univerInstanceService.getUnit(Ae, O.UNIVER_DOC);
    o && n(o);
  }
};
Ri = z0([
  Mt(0, Zt),
  Mt(1, De),
  Mt(2, fe),
  Mt(3, qe),
  Mt(4, ls),
  Mt(5, N(nm)),
  Mt(6, rm),
  Mt(7, N(Ad)),
  Mt(8, W),
  Mt(9, N(xe)),
  Mt(10, Ni),
  Mt(11, k),
  Mt(12, N(vn)),
  Mt(13, N(Ao)),
  Mt(14, N(Q))
], Ri);
function j0(r, e, t, n, i, o) {
  var u, h, g;
  if ((e == null ? void 0 : e.body) == null)
    return null;
  const { body: s } = e;
  r.t = void 0;
  const l = s.dataStream;
  let c = l.substring(l.length - 2, l.length) === eg ? l.substring(0, l.length - 2) : l;
  const d = n.getCurrentLocale();
  if (c = V0(c, t, d, i), (u = e.drawingsOrder) != null && u.length)
    r.v = "", r.f = null, r.si = null, r.p = e, r.t = yt.STRING;
  else if (r.s && Bo((g = (h = o == null ? void 0 : o.get(r.s)) == null ? void 0 : h.n) == null ? void 0 : g.pattern)) {
    r.v = c, r.f = null, r.si = null, r.p = null, r.t = yt.STRING, Zc(s) && s.dataStream !== `\r
` && (r.p = e);
    const m = Ch(e);
    m && (r.s = m);
  } else if (od(c)) {
    if (r.f === c)
      return null;
    const m = t.checkIfAddBracket(c);
    for (let f = 0; f < m; f++)
      c += tm.CLOSE_BRACKET;
    r.f = c, r.si = null, r.v = null, r.p = null;
  } else if (x0(c)) {
    const m = O0(c);
    r.v = m, r.f = null, r.si = null, r.p = null, r.t = yt.FORCE_STRING;
  } else if (Zc(s))
    s.dataStream === `\r
` ? (r.v = "", r.f = null, r.si = null, r.p = null) : (r.p = e, r.v = null, r.f = null, r.si = null);
  else {
    if (c === "" && r.v == null && r.p == null)
      return null;
    r.v = c, r.f = null, r.si = null, r.p = null;
    const m = Ch(e);
    m && (r.s = m);
  }
  return r;
}
function Zc(r) {
  const { textRuns: e = [], paragraphs: t = [], customRanges: n, customBlocks: i = [] } = r, o = r.dataStream.replace(/(\r\n)+$/, ""), s = ["va"];
  return (
    // This is because after editing, an inexplicable second paragraph style will appear \r\n
    e.filter((l) => l.st < o.length).some((l) => {
      var c;
      return !!(l.ts && Object.keys(l.ts).some((d) => s.includes(d))) || Object.keys((c = l.ts) != null ? c : {}).length && l.ed - l.st < o.length;
    }) || t.some((l) => l.bullet) || t.length >= 2 || !!(n != null && n.length) || i.length > 0
  );
}
function Ch(r) {
  const { body: e } = r;
  if (!e) return null;
  const { textRuns: t = [] } = e;
  let n = {};
  const i = e.dataStream.replace(`\r
`, "");
  return t.forEach((o) => {
    const { st: s, ed: l, ts: a } = o;
    l - s >= i.length && (n = { ...n, ...a });
  }), Object.keys(n).length ? n : null;
}
function Y0(r, e = !1) {
  r.dataStream = eg, r.textRuns != null && (r.textRuns.length === 1 && !e ? (r.textRuns[0].st = 0, r.textRuns[0].ed = 1) : r.textRuns = void 0), r.paragraphs != null && (r.paragraphs = [
    {
      startIndex: 0
    }
  ]), r.sectionBreaks != null && (r.sectionBreaks = void 0), r.tables != null && (r.tables = void 0), r.customRanges != null && (r.customRanges = void 0), r.customBlocks != null && (r.customBlocks = void 0);
}
function wh(r) {
  return r && Object.fromEntries(
    Object.entries(r).filter(([e, t]) => !(t == null || Array.isArray(t) && t.length === 0 || typeof t == "object" && Object.keys(t).length === 0))
  );
}
var Z0 = Object.getOwnPropertyDescriptor, G0 = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Z0(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, wn = (r, e) => (t, n) => e(t, n, r);
let yr = class extends kn {
  constructor(e, t, n, i, o, s, l, a, c) {
    super();
    _(this, "_loadedMap", /* @__PURE__ */ new WeakSet());
    _(this, "_scheduledCallback", -1);
    this._univerInstanceService = e, this._renderManagerService = t, this._editorBridgeService = n, this._commandService = i, this._contextService = o, this._formulaEditorManagerService = s, this._undoRedoService = l, this._textSelectionManagerService = a, this._editorService = c, this._initialize();
  }
  _initialize() {
    this._syncEditorSize(), this._listenFxBtnClick(), this._handleContentChange(), this._univerInstanceService.focused$.pipe(ui(this.dispose$)).subscribe((e) => {
      this._create(e);
    }), this._create(Ae), this.disposeWithMe(this._editorService.focus$.subscribe(() => {
      var t;
      ((t = this._editorService.getFocusEditor()) == null ? void 0 : t.getEditorId()) !== Ae ? this._contextService.setContextValue(Ot, !1) : this._contextService.setContextValue(Ot, !0);
    }));
  }
  _handleContentChange() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        if (e.id === wo.id) {
          const t = e.params, { unitId: n } = t;
          n === Ae && this.autoScroll();
        }
      })
    );
  }
  _create(e) {
    if (e !== Ae)
      return;
    const t = this._renderManagerService.getRenderById(e);
    if (t == null)
      return;
    const { mainComponent: n } = t;
    n != null && (this._loadedMap.has(n) || this._loadedMap.add(n));
  }
  _listenFxBtnClick() {
    this._formulaEditorManagerService.fxBtnClick$.pipe(ui(this.dispose$)).subscribe(() => {
      var t;
      if (this._contextService.getContextValue(Ic) && !this._contextService.getContextValue(Je)) {
        this._univerInstanceService.setCurrentUnitForType(Ae);
        const n = this._univerInstanceService.getUniverDocInstance(
          Ae
        );
        this._editorBridgeService.isVisible().visible === !1 && this._commandService.syncExecuteCommand(
          tt.id,
          {
            visible: !0,
            eventType: je.PointerDown,
            unitId: Ae
          }
        );
        const o = (t = n == null ? void 0 : n.getBody()) == null ? void 0 : t.dataStream;
        if (o == null)
          return;
        let s = o.startsWith("=") ? o : `=${o}`;
        s = s.replace(/\r\n$/, "");
        const l = [
          {
            startOffset: s.length,
            endOffset: s.length
          }
        ], a = {
          unitId: Ae,
          body: {
            dataStream: s
          },
          segmentId: "",
          textRanges: l
        };
        this._commandService.syncExecuteCommand(nv.id, a), requestAnimationFrame(() => {
          this._textSelectionManagerService.replaceDocRanges([], {
            unitId: Oe,
            subUnitId: Oe
          }), this._textSelectionManagerService.replaceDocRanges(l, {
            unitId: Ae,
            subUnitId: Ae
          }), this._contextService.setContextValue(Ot, !0);
        });
      }
    });
  }
  _syncEditorSize() {
    const e = this._univerInstanceService.unitAdded$.pipe(qo((t) => t.getUnitId() === Ae));
    this.disposeWithMe(at([this._formulaEditorManagerService.position$, e]).subscribe(([t]) => {
      if (!t) return this._clearScheduledCallback();
      const n = Dd(Ae, this._renderManagerService), i = this._univerInstanceService.getUniverDocInstance(
        Ae
      );
      if (n == null || i == null) return this._clearScheduledCallback();
      const { width: o, height: s } = t;
      if (o === 0 || s === 0) return this._clearScheduledCallback();
      const { engine: l } = n;
      i.updateDocumentDataPageSize(o), this.autoScroll(), this._scheduledCallback = requestIdleCallback(() => l.resizeBySize(o, s));
    }));
  }
  _clearScheduledCallback() {
    this._scheduledCallback !== -1 && cancelIdleCallback(this._scheduledCallback), this._scheduledCallback = -1;
  }
  autoScroll() {
    var m, f;
    const e = this._formulaEditorManagerService.getPosition(), t = (m = this._renderManagerService.getRenderById(Ae)) == null ? void 0 : m.with(Jn).getSkeleton(), n = this._renderManagerService.getRenderById(Ae), i = this._univerInstanceService.getUniverDocInstance(
      Ae
    );
    if (t == null || e == null || n == null || i == null)
      return;
    const { marginTop: o = 0, marginBottom: s = 0 } = i.getSnapshot().documentStyle, { scene: l, mainComponent: a } = n;
    let { actualHeight: c } = t.getActualSize();
    c += o + s;
    const { width: d, height: u } = e, h = l.getViewport(ks.VIEW_MAIN);
    let g = h == null ? void 0 : h.getScrollBar();
    l.transformByState({
      width: d,
      height: c
    }), a == null || a.resize(d, c), c > u ? g == null ? h && new yd(h, { enableHorizontal: !1, barSize: 8 }) : h == null || h.resetCanvasSizeAndUpdateScroll() : (g = null, h == null || h.scrollToViewportPos({ viewportScrollX: 0, viewportScrollY: 0 }), (f = h == null ? void 0 : h.getScrollBar()) == null || f.dispose());
  }
};
yr = G0([
  wn(0, k),
  wn(1, fe),
  wn(2, qe),
  wn(3, W),
  wn(4, De),
  wn(5, as),
  wn(6, Zt),
  wn(7, N(Ad)),
  wn(8, Ni)
], yr);
const q0 = "embedding_formula_editor", Ky = (r) => r.includes(q0), lu = (r, e) => {
  var u, h, g, m, f;
  const n = e.findNodePositionByCharIndex(r.startOffset, !0, r.segmentId, -1), i = e.getSkeletonData();
  let o = r.endOffset;
  if (r.segmentId) {
    const v = (f = Array.from((h = (u = i == null ? void 0 : i.skeFooters.get(r.segmentId)) == null ? void 0 : u.values()) != null ? h : [])[0]) != null ? f : Array.from((m = (g = i == null ? void 0 : i.skeHeaders.get(r.segmentId)) == null ? void 0 : g.values()) != null ? m : [])[0];
    v && (o = Math.min(v.ed, o));
  }
  const s = e.findNodePositionByCharIndex(o, !0, r.segmentId, -1);
  if (!s || !n)
    return;
  const l = {
    docsLeft: 0,
    docsTop: 0,
    pageMarginLeft: 0,
    pageMarginTop: 0
  }, a = new qh(l, e), { borderBoxPointGroup: c } = a.getRangePointData(n, s);
  return Qh(c).map((v) => ({
    top: v.top,
    bottom: v.bottom,
    left: v.left,
    right: v.right
  }));
}, Q0 = (r, e, t = -1) => {
  const n = e.findPositionByGlyph(r, t);
  if (!n)
    return;
  const i = { ...n, isBack: !0 }, o = {
    docsLeft: 0,
    docsTop: 0,
    pageMarginLeft: 0,
    pageMarginTop: 0
  }, s = new qh(o, e), { borderBoxPointGroup: l } = s.getRangePointData(i, i), c = Qh(l)[0];
  return {
    top: c.top,
    bottom: c.bottom,
    left: c.left,
    right: c.right
  };
}, K0 = (r, e, t = 0, n = 0) => {
  const i = lu({ startOffset: e.startIndex, endOffset: e.endIndex + 1 }, r);
  if (i)
    return {
      rects: i.map((o) => ({
        top: o.top + n,
        bottom: o.bottom + n,
        left: o.left + t,
        right: o.right + t
      })),
      range: e
    };
}, J0 = (r, e, t = 0, n = 0) => {
  var u, h, g;
  const i = r.findNodeByCharIndex(e.startIndex), o = i == null ? void 0 : i.parent, s = o == null ? void 0 : o.parent, l = s == null ? void 0 : s.parent, a = l == null ? void 0 : l.lines.find((m) => m.paragraphStart && m.paragraphIndex === e.startIndex), c = (g = (h = (u = a == null ? void 0 : a.divides) == null ? void 0 : u[0]) == null ? void 0 : h.glyphGroup) == null ? void 0 : g[0];
  if (!c || !c)
    return;
  const d = Q0(c, r);
  if (d)
    return {
      rect: {
        top: d.top + n,
        bottom: d.bottom + n,
        left: d.left + t,
        right: d.right + t
      },
      segmentId: void 0,
      segmentPageIndex: -1,
      paragraph: e
    };
}, $0 = (r, e = 0, t = 0) => {
  var l, a, c, d, u, h, g;
  const n = r.getViewModel().getDataModel(), i = (c = (a = (l = n.getBody()) == null ? void 0 : l.customRanges) == null ? void 0 : a.filter((m) => m.rangeType === sd.HYPERLINK)) != null ? c : [], o = (h = (u = (d = n.getBody()) == null ? void 0 : d.paragraphs) == null ? void 0 : u.filter((m) => {
    var f;
    return ((f = m.bullet) == null ? void 0 : f.listType.indexOf(vv.CHECK_LIST)) === 0;
  })) != null ? h : [], s = (g = r.getSkeletonData()) == null ? void 0 : g.pages[0].skeDrawings;
  return {
    links: i.map((m) => K0(r, m, e, t)).filter(Boolean),
    checkLists: o.map((m) => J0(r, m, e, t)).filter(Boolean),
    drawings: s ? Array.from(s.keys()).map((m) => ({
      drawingId: m,
      rect: {
        top: s.get(m).aTop,
        bottom: s.get(m).aTop + s.get(m).width,
        left: s.get(m).aLeft,
        right: s.get(m).aLeft + s.get(m).height
      },
      drawing: s.get(m)
    })) : []
  };
};
function Cf(r, e, t) {
  var c, d, u, h, g, m;
  const n = (u = (d = (c = e.documentSkeleton) == null ? void 0 : c.getSkeletonData()) == null ? void 0 : d.pages[0].height) != null ? u : 0, i = (m = (g = (h = e.documentSkeleton) == null ? void 0 : h.getSkeletonData()) == null ? void 0 : g.pages[0].width) != null ? m : 0, o = e.verticalAlign, s = e.horizontalAlign;
  let l = 0;
  switch (o) {
    case cn.UNSPECIFIED:
    case cn.BOTTOM:
      l = r.mergeInfo.endY - r.mergeInfo.startY - n;
      break;
    case cn.MIDDLE:
      l = (r.mergeInfo.endY - r.mergeInfo.startY - n) / 2;
      break;
  }
  let a = 0;
  switch (s) {
    case It.RIGHT:
      a = r.mergeInfo.endX - r.mergeInfo.startX - i;
      break;
    case It.CENTER:
      a = (r.mergeInfo.endX - r.mergeInfo.startX - i) / 2;
      break;
    case It.UNSPECIFIED: {
      t && (a = r.mergeInfo.endX - r.mergeInfo.startX - i);
      break;
    }
  }
  return {
    paddingLeft: a,
    paddingTop: l
  };
}
const Jy = (r, e, t, n, i, o) => {
  var P, H, A;
  const s = r.get(k), l = r.get(fe), a = s.getUnit(e, O.UNIVER_SHEET);
  if (!a)
    return null;
  const c = a.getSheetBySheetId(t);
  if (!c)
    return null;
  const d = l.getRenderById(a.getUnitId()), u = d == null ? void 0 : d.with(ue).getSkeletonParam(c.getSheetId()), h = u == null ? void 0 : u.skeleton;
  if (!h || !d) return;
  const g = h.getFont(n, i), m = g == null ? void 0 : g.documentSkeleton;
  if (!m)
    return null;
  const f = (H = (P = m.getViewModel().getBody()) == null ? void 0 : P.customRanges) == null ? void 0 : H.find((x) => x.rangeId === o);
  if (!f)
    return null;
  const v = rv, p = h.getCellWithCoordByIndex(n, i);
  let { actualColumn: S, actualRow: w } = p;
  h.overflowCache.forValue((x, V, D) => {
    D.startRow <= w && D.endRow >= w && D.startColumn <= S && D.endColumn >= S && (S = V, w = x);
  });
  const C = h.getCellWithCoordByIndex(w, S), I = c.getCell(C.actualRow, C.actualColumn), { topOffset: R = 0, leftOffset: y = 0 } = (A = I == null ? void 0 : I.fontRenderExtension) != null ? A : {}, { paddingLeft: M, paddingTop: E } = Cf(C, g, !1), T = lu({ startOffset: f.startIndex, endOffset: f.endIndex }, m);
  return {
    rects: T == null ? void 0 : T.map((x) => ({
      top: x.top + C.mergeInfo.startY + E + R + v,
      bottom: x.bottom + C.mergeInfo.startY + E + R + v,
      left: x.left + C.mergeInfo.startX + M + y,
      right: x.right + C.mergeInfo.startX + M + y
    })),
    customRange: f,
    label: m.getViewModel().getBody().dataStream.slice(f.startIndex, f.endIndex + 1)
  };
}, $y = (r, e, t, n, i, o) => {
  var y, M, E;
  const s = r.get(qe), l = s.getEditCellState();
  if (!l || !s.isVisible().visible)
    return null;
  const { editorUnitId: c, unitId: d, sheetId: u, row: h, column: g } = l;
  if (e !== d || t !== u || h !== n || g !== i)
    return null;
  const m = r.get(fe), f = m.getRenderById(c), v = m.getRenderById(e);
  if (!f || !v)
    return null;
  const p = f.with(Jn).getSkeleton(), S = (y = v.with(ue).getSkeletonParam(u)) == null ? void 0 : y.skeleton;
  if (!p || !S)
    return null;
  const w = (E = (M = p.getViewModel().getBody()) == null ? void 0 : M.customRanges) == null ? void 0 : E.find((T) => T.rangeId === o);
  if (!w)
    return null;
  const C = 4, I = lu({ startOffset: w.startIndex, endOffset: w.endIndex }, p), R = f.engine.getCanvasElement().getBoundingClientRect();
  return {
    rects: I == null ? void 0 : I.map((T) => ({
      top: T.top + R.top - C,
      bottom: T.bottom + R.top + C,
      left: T.left + R.left,
      right: T.right + R.left
    })),
    customRange: w,
    label: p.getViewModel().getBody().dataStream.slice(w.startIndex, w.endIndex + 1)
  };
};
var eb = Object.getOwnPropertyDescriptor, tb = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? eb(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, bh = (r, e) => (t, n) => e(t, n, r);
function cr(r) {
  const { workbook: e, worksheet: t, ...n } = r;
  return n;
}
let Mr = class extends oe {
  constructor(e, t) {
    super();
    _(this, "_currentCell$", new Me(null));
    _(this, "_currentRichText$", new Me(null));
    _(this, "_currentClickedCell$", new He());
    _(this, "_currentDbClickedCell$", new He());
    _(this, "_currentCellWithEvent$", new He());
    _(this, "_currentPointerDownCell$", new He());
    _(this, "_currentPointerUpCell$", new He());
    _(this, "_currentHoveredRowHeader$", new Me(null));
    _(this, "_currentHoveredColHeader$", new Me(null));
    _(this, "_currentRowHeaderClick$", new He());
    _(this, "_currentColHeaderClick$", new He());
    _(this, "_currentRowHeaderDbClick$", new He());
    _(this, "_currentColHeaderDbClick$", new He());
    _(this, "_currentRowHeaderPointerDown$", new He());
    _(this, "_currentColHeaderPointerDown$", new He());
    _(this, "_currentRowHeaderPointerUp$", new He());
    _(this, "_currentColHeaderPointerUp$", new He());
    // Notify when hovering over different cells
    _(this, "currentCell$", this._currentCell$.asObservable().pipe(
      dn(
        (e, t) => {
          var n, i, o, s, l, a, c, d;
          return ((n = e == null ? void 0 : e.location) == null ? void 0 : n.unitId) === ((i = t == null ? void 0 : t.location) == null ? void 0 : i.unitId) && ((o = e == null ? void 0 : e.location) == null ? void 0 : o.subUnitId) === ((s = t == null ? void 0 : t.location) == null ? void 0 : s.subUnitId) && ((l = e == null ? void 0 : e.location) == null ? void 0 : l.row) === ((a = t == null ? void 0 : t.location) == null ? void 0 : a.row) && ((c = e == null ? void 0 : e.location) == null ? void 0 : c.col) === ((d = t == null ? void 0 : t.location) == null ? void 0 : d.col);
        }
      )
    ));
    _(this, "currentRichTextNoDistinct$", this._currentRichText$.pipe(
      Be((e) => e && {
        unitId: e.location.unitId,
        subUnitId: e.location.subUnitId,
        row: e.location.row,
        col: e.location.col,
        customRange: e.customRange,
        bullet: e.bullet,
        rect: e.rect,
        drawing: e.drawing
      })
    ));
    // Notify when hovering over different cells and different custom range or bullet
    _(this, "currentRichText$", this._currentRichText$.pipe(
      dn(
        // eslint-disable-next-line complexity
        (e, t) => {
          var n, i, o, s, l, a, c, d, u, h, g, m, f, v, p, S, w, C;
          return ((n = e == null ? void 0 : e.location) == null ? void 0 : n.unitId) === ((i = t == null ? void 0 : t.location) == null ? void 0 : i.unitId) && ((o = e == null ? void 0 : e.location) == null ? void 0 : o.subUnitId) === ((s = t == null ? void 0 : t.location) == null ? void 0 : s.subUnitId) && ((l = e == null ? void 0 : e.location) == null ? void 0 : l.row) === ((a = t == null ? void 0 : t.location) == null ? void 0 : a.row) && ((c = e == null ? void 0 : e.location) == null ? void 0 : c.col) === ((d = t == null ? void 0 : t.location) == null ? void 0 : d.col) && ((u = e == null ? void 0 : e.customRange) == null ? void 0 : u.rangeId) === ((h = t == null ? void 0 : t.customRange) == null ? void 0 : h.rangeId) && ((g = e == null ? void 0 : e.bullet) == null ? void 0 : g.startIndex) === ((m = t == null ? void 0 : t.bullet) == null ? void 0 : m.startIndex) && ((f = e == null ? void 0 : e.customRange) == null ? void 0 : f.startIndex) === ((v = t == null ? void 0 : t.customRange) == null ? void 0 : v.startIndex) && ((p = e == null ? void 0 : e.customRange) == null ? void 0 : p.endIndex) === ((S = t == null ? void 0 : t.customRange) == null ? void 0 : S.endIndex) && ((w = e == null ? void 0 : e.drawing) == null ? void 0 : w.drawingId) === ((C = t == null ? void 0 : t.drawing) == null ? void 0 : C.drawingId);
        }
      ),
      Be((e) => e && {
        unitId: e.location.unitId,
        subUnitId: e.location.subUnitId,
        row: e.location.row,
        col: e.location.col,
        customRange: e.customRange,
        bullet: e.bullet,
        rect: e.rect,
        drawing: e.drawing
      })
    ));
    /**
     * Nearly same as currentRichText$, but with event
     */
    _(this, "currentCellPosWithEvent$", this._currentCellWithEvent$.pipe(
      dn(
        (e, t) => {
          var n, i, o, s, l, a, c, d;
          return ((n = e == null ? void 0 : e.location) == null ? void 0 : n.unitId) === ((i = t == null ? void 0 : t.location) == null ? void 0 : i.unitId) && ((o = e == null ? void 0 : e.location) == null ? void 0 : o.subUnitId) === ((s = t == null ? void 0 : t.location) == null ? void 0 : s.subUnitId) && ((l = e == null ? void 0 : e.location) == null ? void 0 : l.row) === ((a = t == null ? void 0 : t.location) == null ? void 0 : a.row) && ((c = e == null ? void 0 : e.location) == null ? void 0 : c.col) === ((d = t == null ? void 0 : t.location) == null ? void 0 : d.col);
        }
      ),
      Be((e) => e && {
        unitId: e.location.unitId,
        subUnitId: e.location.subUnitId,
        row: e.location.row,
        col: e.location.col,
        event: e.event
      })
    ));
    // Notify when mouse position changes
    _(this, "currentPosition$", this._currentCell$.asObservable());
    _(this, "currentClickedCell$", this._currentClickedCell$.asObservable());
    _(this, "currentDbClickedCell$", this._currentDbClickedCell$.asObservable());
    _(this, "currentPointerDownCell$", this._currentPointerDownCell$.asObservable());
    _(this, "currentPointerUpCell$", this._currentPointerUpCell$.asObservable());
    _(this, "currentHoveredRowHeader$", this._currentHoveredRowHeader$.asObservable());
    _(this, "currentHoveredColHeader$", this._currentHoveredColHeader$.asObservable());
    _(this, "currentRowHeaderClick$", this._currentRowHeaderClick$.asObservable());
    _(this, "currentColHeaderClick$", this._currentColHeaderClick$.asObservable());
    _(this, "currentRowHeaderDbClick$", this._currentRowHeaderDbClick$.asObservable());
    _(this, "currentColHeaderDbClick$", this._currentColHeaderDbClick$.asObservable());
    _(this, "currentRowHeaderPointerDown$", this._currentRowHeaderPointerDown$.asObservable());
    _(this, "currentColHeaderPointerDown$", this._currentColHeaderPointerDown$.asObservable());
    _(this, "currentRowHeaderPointerUp$", this._currentRowHeaderPointerUp$.asObservable());
    _(this, "currentColHeaderPointerUp$", this._currentColHeaderPointerUp$.asObservable());
    this._univerInstanceService = e, this._renderManagerService = t, this._initCellDisposableListener();
  }
  dispose() {
    super.dispose(), this._currentCell$.complete(), this._currentClickedCell$.complete(), this._currentPointerDownCell$.complete(), this._currentPointerUpCell$.complete(), this._currentCellWithEvent$.complete(), this._currentRichText$.complete(), this._currentDbClickedCell$.complete(), this._currentHoveredRowHeader$.complete(), this._currentHoveredColHeader$.complete(), this._currentRowHeaderClick$.complete(), this._currentColHeaderClick$.complete(), this._currentRowHeaderDbClick$.complete(), this._currentColHeaderDbClick$.complete(), this._currentRowHeaderPointerDown$.complete(), this._currentColHeaderPointerDown$.complete(), this._currentRowHeaderPointerUp$.complete(), this._currentColHeaderPointerUp$.complete(), this.currentCellPosWithEvent$ = Ce(null), this.currentRichText$ = Ce(null);
  }
  _initCellDisposableListener() {
    this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe((e) => {
      e || this._currentCell$.next(null);
    })), this.disposeWithMe(this._univerInstanceService.unitDisposed$.subscribe((e) => {
      var t, n;
      ((t = this._currentCell$.getValue()) == null ? void 0 : t.location.unitId) === e.getUnitId() && this._currentCell$.next(null), ((n = this._currentRichText$.getValue()) == null ? void 0 : n.location.unitId) === e.getUnitId() && this._currentRichText$.next(null);
    }));
  }
  _getCalcDeps(e) {
    const t = this._univerInstanceService.getUnit(e, O.UNIVER_SHEET);
    if (!t)
      return null;
    const n = t.getActiveSheet();
    if (!n)
      return null;
    const i = this._renderManagerService.getRenderById(t.getUnitId());
    if (!i) return null;
    const o = i.with(ue).getSkeletonParam(n.getSheetId());
    if (!o) return null;
    const s = i.with(Et);
    if (!(!(s != null && s.getCurrentScrollState()) || !i))
      return { currentRender: i, workbook: t, worksheet: n, skeletonParam: o };
  }
  _calcActiveCell(e, t, n, i, o, s) {
    var R, y, M;
    const l = Lm(e, t, n, i, o, s), a = i.skeleton;
    if (!l)
      return null;
    const { position: c, overflowLocation: d, location: u } = l, h = a.getFont(d.row, d.col);
    let g = null, m = null, f = null;
    const v = a.getCellWithCoordByIndex(d.row, d.col), p = n.getCell(d.row, d.col), { topOffset: S = 0, leftOffset: w = 0 } = (R = p == null ? void 0 : p.fontRenderExtension) != null ? R : {};
    if (h != null && h.documentSkeleton) {
      const { paddingLeft: E, paddingTop: T } = Cf(v, h, (p == null ? void 0 : p.v) !== null && (p == null ? void 0 : p.v) !== void 0 ? !Number.isNaN(+p.v) : !1), P = $0(h.documentSkeleton, E, T), H = o - c.startX - w, A = s - c.startY - S;
      g = P.links.find((x) => x.rects.some((V) => V.left <= H && H <= V.right && V.top <= A && A <= V.bottom)), m = P.checkLists.find((x) => x.rect.left <= H && H <= x.rect.right && x.rect.top <= A && A <= x.rect.bottom), f = P.drawings.find((x) => x.rect.left <= H && H <= x.rect.right && x.rect.top <= A && A <= x.rect.bottom);
    }
    const C = (M = (y = g == null ? void 0 : g.rects.pop()) != null ? y : m == null ? void 0 : m.rect) != null ? M : f == null ? void 0 : f.rect, I = C && (() => {
      const E = C.top + v.mergeInfo.startY + S, T = C.bottom + v.mergeInfo.startY + S, P = C.left + v.mergeInfo.startX + w, H = C.right + v.mergeInfo.startX + w, A = v.mergeInfo.startY + S, x = v.mergeInfo.endY + S, V = v.mergeInfo.startX + w, D = v.mergeInfo.endX + w, X = Math.min(Math.max(E, A), A), B = Math.min(T, x), j = Math.min(Math.max(P, V), V), G = Math.min(H, D);
      return {
        top: X,
        bottom: B,
        left: j,
        right: G
      };
    })();
    return {
      location: u,
      position: c,
      overflowLocation: d,
      customRange: g == null ? void 0 : g.range,
      bullet: m == null ? void 0 : m.paragraph,
      drawing: f,
      rect: I
    };
  }
  _calcActiveRowHeader(e, t, n) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o, worksheet: s, skeletonParam: l } = i, { scaleY: a } = o.scene.getAncestorScale(), c = o.scene.getViewports().find((h) => h.isHit(new ke(t, n)));
    if (!c || c.viewportKey !== F.VIEW_ROW_TOP && c.viewportKey !== F.VIEW_ROW_BOTTOM)
      return;
    const d = {
      x: c.viewportScrollX,
      y: c.viewportScrollY
    }, u = l.skeleton.getRowIndexByOffsetY(n, a, d);
    return { unitId: e, index: u, subUnitId: s.getSheetId() };
  }
  _calcActiveColHeader(e, t, n) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o, worksheet: s, skeletonParam: l } = i, { scaleX: a } = o.scene.getAncestorScale(), c = o.scene.getViewports().find((h) => h.isHit(new ke(t, n)));
    if (!c || c.viewportKey !== F.VIEW_COLUMN_LEFT && c.viewportKey !== F.VIEW_COLUMN_RIGHT)
      return;
    const d = {
      x: c.viewportScrollX,
      y: c.viewportScrollY
    }, u = l.skeleton.getColumnIndexByOffsetX(t, a, d);
    return { unitId: e, index: u, subUnitId: s.getSheetId() };
  }
  triggerPointerDown(e, t) {
    const n = this._getCalcDeps(e);
    if (!n)
      return;
    const { currentRender: i, workbook: o, worksheet: s, skeletonParam: l } = n, a = this._calcActiveCell(i, o, s, l, t.offsetX, t.offsetY);
    if (a && a.location) {
      const { unitId: c, subUnitId: d, row: u, col: h } = cr(a.location);
      this._currentPointerDownCell$.next({
        unitId: c,
        subUnitId: d,
        row: u,
        col: h,
        event: t
      });
    }
  }
  triggerPointerUp(e, t) {
    const n = this._getCalcDeps(e);
    if (!n)
      return;
    const { currentRender: i, workbook: o, worksheet: s, skeletonParam: l } = n, a = this._calcActiveCell(i, o, s, l, t.offsetX, t.offsetY);
    if (a) {
      const c = cr(a.location);
      this._currentPointerUpCell$.next({
        ...c,
        event: t
      });
    }
  }
  triggerMouseMove(e, t) {
    const n = this._getCalcDeps(e);
    if (!n)
      return;
    const { currentRender: i, workbook: o, worksheet: s, skeletonParam: l } = n, a = this._calcActiveCell(i, o, s, l, t.offsetX, t.offsetY);
    this._currentCell$.next(a && {
      location: cr(a.location),
      position: a.position
    }), this._currentRichText$.next(a && {
      ...a,
      location: cr(a.overflowLocation)
    }), this._currentCellWithEvent$.next(a && {
      ...a,
      location: cr(a.location),
      event: t
    });
  }
  /**
   * Trigger by pointerup.
   * @param unitId
   * @param offsetX
   * @param offsetY
   */
  triggerClick(e, t, n) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o, workbook: s, worksheet: l, skeletonParam: a } = i, c = this._calcActiveCell(o, s, l, a, t, n);
    c && this._currentClickedCell$.next({
      ...c,
      location: cr(c.location)
    });
  }
  triggerDbClick(e, t, n) {
    const i = this._getCalcDeps(e);
    if (!i)
      return;
    const { currentRender: o, workbook: s, worksheet: l, skeletonParam: a } = i, c = this._calcActiveCell(o, s, l, a, t, n);
    c && this._currentDbClickedCell$.next({
      ...c,
      location: cr(c.location)
    });
  }
  triggerScroll() {
    this._currentCell$.next(null);
  }
  triggerRowHeaderClick(e, t, n) {
    const i = this._calcActiveRowHeader(e, t, n);
    i && this._currentRowHeaderClick$.next(i);
  }
  triggerColHeaderClick(e, t, n) {
    const i = this._calcActiveColHeader(e, t, n);
    i && this._currentColHeaderClick$.next(i);
  }
  triggerRowHeaderDbClick(e, t, n) {
    const i = this._calcActiveRowHeader(e, t, n);
    i && this._currentRowHeaderDbClick$.next(i);
  }
  triggerColHeaderDbClick(e, t, n) {
    const i = this._calcActiveColHeader(e, t, n);
    i && this._currentColHeaderDbClick$.next(i);
  }
  triggerRowHeaderMouseMove(e, t, n) {
    this._currentHoveredRowHeader$.next(this._calcActiveRowHeader(e, t, n));
  }
  triggerColHeaderMouseMove(e, t, n) {
    this._currentHoveredColHeader$.next(this._calcActiveColHeader(e, t, n));
  }
  triggerRowHeaderPoniterDown(e, t, n) {
    const i = this._calcActiveRowHeader(e, t, n);
    i && this._currentRowHeaderPointerDown$.next(i);
  }
  triggerColHeaderPoniterDown(e, t, n) {
    const i = this._calcActiveColHeader(e, t, n);
    i && this._currentColHeaderPointerDown$.next(i);
  }
  triggerRowHeaderPoniterUp(e, t, n) {
    const i = this._calcActiveRowHeader(e, t, n);
    i && this._currentRowHeaderPointerUp$.next(i);
  }
  triggerColHeaderPoniterUp(e, t, n) {
    const i = this._calcActiveColHeader(e, t, n);
    i && this._currentColHeaderPointerUp$.next(i);
  }
};
Mr = tb([
  bh(0, k),
  bh(1, fe)
], Mr);
var nb = Object.getOwnPropertyDescriptor, rb = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? nb(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Xa = (r, e) => (t, n) => e(t, n, r);
let hl = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_active", !1);
    this._context = e, this._hoverManagerService = t, this._sheetSkeletonManagerService = n, this._scrollManagerService = i, this._initPointerEvent(), this._initScrollEvent();
  }
  get active() {
    return this._active;
  }
  // eslint-disable-next-line max-lines-per-function
  _initPointerEvent() {
    const e = new ht(), t = (n) => {
      if (e.dispose(), !n)
        return;
      const { mainComponent: i, unitId: o, components: s } = this._context;
      if (!i)
        return;
      e.add(i.onPointerEnter$.subscribeEvent((c) => {
        this._active = !0;
      })), e.add(Ws(i.onPointerMove$).subscribe((c) => {
        this._active = !0, this._hoverManagerService.triggerMouseMove(o, c);
      })), e.add(i.onPointerDown$.subscribeEvent((c) => {
        this._hoverManagerService.triggerPointerDown(o, c);
      })), e.add(i.onPointerUp$.subscribeEvent((c) => {
        this._hoverManagerService.triggerPointerUp(o, c);
      })), e.add(i.onClick$.subscribeEvent((c) => {
        this._hoverManagerService.triggerClick(o, c.offsetX, c.offsetY);
      })), e.add(i.onDblclick$.subscribeEvent((c) => {
        this._hoverManagerService.triggerDbClick(o, c.offsetX, c.offsetY);
      })), e.add(i.onPointerLeave$.subscribeEvent(() => {
        this._active = !1;
      }));
      const l = s.get(Ye.ROW), a = s.get(Ye.COLUMN);
      l && (e.add(l.onPointerMove$.subscribeEvent((c) => {
        this._hoverManagerService.triggerRowHeaderMouseMove(o, c.offsetX, c.offsetY);
      })), e.add(l.onPointerDown$.subscribeEvent((c) => {
        this._hoverManagerService.triggerRowHeaderPoniterDown(o, c.offsetX, c.offsetY);
      })), e.add(l.onPointerUp$.subscribeEvent((c) => {
        this._hoverManagerService.triggerRowHeaderPoniterUp(o, c.offsetX, c.offsetY), this._hoverManagerService.triggerRowHeaderClick(o, c.offsetX, c.offsetY);
      })), e.add(l.onDblclick$.subscribeEvent((c) => {
        this._hoverManagerService.triggerRowHeaderDbClick(o, c.offsetX, c.offsetY);
      }))), a && (e.add(a.onPointerMove$.subscribeEvent((c) => {
        this._hoverManagerService.triggerColHeaderMouseMove(o, c.offsetX, c.offsetY);
      })), e.add(a.onPointerDown$.subscribeEvent((c) => {
        this._hoverManagerService.triggerColHeaderPoniterDown(o, c.offsetX, c.offsetY);
      })), e.add(a.onPointerUp$.subscribeEvent((c) => {
        this._hoverManagerService.triggerColHeaderPoniterUp(o, c.offsetX, c.offsetY), this._hoverManagerService.triggerColHeaderClick(o, c.offsetX, c.offsetY);
      })), e.add(a.onDblclick$.subscribeEvent((c) => {
        this._hoverManagerService.triggerColHeaderDbClick(o, c.offsetX, c.offsetY);
      })));
    };
    t(this._sheetSkeletonManagerService.getCurrentParam()), this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((n) => {
      t(n);
    }));
  }
  _initScrollEvent() {
    this.disposeWithMe(this._scrollManagerService.validViewportScrollInfo$.subscribe(() => this._hoverManagerService.triggerScroll()));
  }
};
hl = rb([
  Xa(1, N(Mr)),
  Xa(2, N(ue)),
  Xa(3, N(Et))
], hl);
const wf = "UI_PLUGIN_SHEETS", au = `${wf}_BORDER_PANEL_COMPONENT`, bf = [
  {
    label: "borderLine.borderTop",
    icon: "UpBorderDoubleIcon",
    value: "top"
  },
  {
    label: "borderLine.borderBottom",
    icon: "DownBorderDoubleIcon",
    value: "bottom"
  },
  {
    label: "borderLine.borderLeft",
    icon: "LeftBorderDoubleIcon",
    value: "left"
  },
  {
    label: "borderLine.borderRight",
    icon: "RightBorderDoubleIcon",
    value: "right"
  },
  {
    label: "borderLine.borderNone",
    icon: "NoBorderIcon",
    value: "none"
  },
  {
    label: "borderLine.borderAll",
    icon: "AllBorderIcon",
    value: "all"
  },
  {
    label: "borderLine.borderOutside",
    icon: "OuterBorderDoubleIcon",
    value: "outside"
  },
  {
    label: "borderLine.borderInside",
    icon: "InnerBorderDoubleIcon",
    value: "inside"
  },
  {
    label: "borderLine.borderHorizontal",
    icon: "HorizontalBorderDoubleIcon",
    value: "horizontal"
  },
  {
    label: "borderLine.borderVertical",
    icon: "VerticalBorderDoubleIcon",
    value: "vertical"
  },
  {
    label: "borderLine.borderTlbr",
    icon: "BackSlashDoubleIcon",
    value: "tlbr"
  },
  {
    label: "borderLine.borderTlbcTlmr",
    icon: "LeftDoubleDiagonalDoubleIcon",
    value: "tlbc_tlmr"
  },
  {
    label: "borderLine.borderTlbrTlbcTlmr",
    icon: "LeftTridiagonalDoubleIcon",
    value: "tlbr_tlbc_tlmr"
  },
  {
    label: "borderLine.borderBlTr",
    icon: "SlashDoubleIcon",
    value: "bltr"
  },
  {
    label: "borderLine.borderMltrBctr",
    icon: "RightDoubleDiagonalDoubleIcon",
    value: "mltr_bctr"
  }
];
function ib(r) {
  return r.getCurrentTypeOfUnit$(O.UNIVER_SHEET).pipe(Pn((e) => e ? e.activeSheet$.pipe(pn((t) => t ? { workbook: e, worksheet: t } : null)) : Ce(null)));
}
function pt(r, e, t) {
  return ib(r).pipe(Pn((n) => n ? t(n) : Ce(e)));
}
function ob(r, e) {
  const t = r.get(k), n = r.get(Bv), i = r.get(Q);
  return t.getCurrentTypeOfUnit$(O.UNIVER_SHEET).pipe(
    Pn((s) => s ? at([i.selectionMoveEnd$, s.activeSheet$]).pipe(
      Pn(([l, a]) => {
        if (!a)
          return Ce(!1);
        if (l.length === 0)
          return Ce(!1);
        const c = n.getInterestGroupId(l);
        if (e) {
          const d = c.filter((u) => e.has(u));
          return Ce(d.length > 0);
        } else
          return Ce(c.length > 0);
      })
    ) : Ce(!1))
  );
}
function zi(r, e, t) {
  return at([e, ob(r, t)]).pipe(
    pn(([n, i]) => n || i)
  );
}
function he(r, e = {}, t = !1) {
  var h;
  const i = r.get(k).getCurrentTypeOfUnit$(O.UNIVER_SHEET), o = r.get(Ft), s = r.has(qe) ? r.get(qe) : null, l = r.get(De), c = ((h = s == null ? void 0 : s.visible$) != null ? h : Ce(null)).pipe(
    Na(null),
    Lu(1)
  ), d = l.subscribeContextValue$(Ot).pipe(
    Na(!1),
    Lu(1)
  );
  return at([o.currentUser$, i, c, d]).pipe(
    Pn(([g, m, f, v]) => !m || f != null && f.visible && f.unitId === m.getUnitId() && !t || v && !t ? Ce(!0) : m.activeSheet$.pipe(
      Pn((p) => {
        if (!p)
          return Ce(!0);
        const S = r.get(Q), w = r.get($e), C = r.get(ft), R = r.get(De).subscribeContextValue$(Dl).pipe(Na(!1));
        return at([S.selectionMoveEnd$, R]).pipe(
          Pn(([y, M]) => {
            if (M)
              return Ce(!0);
            const E = m.getUnitId(), T = p.getSheetId(), P = r.get(rt), { workbookTypes: H = [K], worksheetTypes: A, rangeTypes: x } = e, V = [];
            if (H == null || H.forEach((j) => {
              V.push(new j(E).id);
            }), A == null || A.forEach((j) => {
              V.push(new j(E, T).id);
            }), C.getRule(E, T))
              return P.composePermission$(V).pipe(pn((j) => j.some((G) => G.value === !1)));
            const X = y == null ? void 0 : y.map((j) => j.range), B = w.getSubunitRuleList(E, T).filter((j) => X == null ? void 0 : X.some((G) => j.ranges.some((ge) => se.intersects(G, ge))));
            return x == null || x.forEach((j) => {
              B.forEach((G) => {
                V.push(new j(E, T, G.permissionId).id);
              });
            }), P.composePermission$(V).pipe(pn((j) => j.some((G) => G.value === !1)));
          })
        );
      })
    ))
  );
}
function ji(r) {
  const e = r.get(k), t = r.get(Q), n = r.get($e), i = r.get(rt);
  return St(t.selectionMoveEnd$, i.permissionPointUpdate$.pipe(ia(100))).pipe(
    pn(() => {
      var u;
      const o = (u = t.getCurrentLastSelection()) == null ? void 0 : u.range;
      if (!o) return !0;
      const s = e.getCurrentUnitForType(O.UNIVER_SHEET), l = s == null ? void 0 : s.getActiveSheet();
      if (!s || !l)
        return !0;
      const a = s.getUnitId(), c = l.getSheetId(), d = [new K(a).id, new te(a, c).id];
      return n.getSubunitRuleList(a, c).filter((h) => h.ranges.some((g) => se.intersects(o, g))).forEach((h) => {
        d.push(new ie(a, c, h.permissionId).id);
      }), i.composePermission(d).some((h) => h.value === !1);
    })
  );
}
function _f(r, e) {
  const t = r.get(k), n = r.get(Q), i = r.get($e), o = r.get(rt);
  return St(n.selectionMoveEnd$, o.permissionPointUpdate$.pipe(ia(100))).pipe(
    pn(() => {
      var h;
      const s = (h = n.getCurrentLastSelection()) == null ? void 0 : h.range;
      if (!s) return !0;
      const l = t.getCurrentUnitForType(O.UNIVER_SHEET), a = l == null ? void 0 : l.getActiveSheet();
      if (!l || !a)
        return !0;
      const c = l.getUnitId(), d = a.getSheetId(), u = [new K(c).id, new te(c, d).id];
      return i.getSubunitRuleList(c, d).filter((g) => e === "row" ? g.ranges.some((m) => s.startRow > m.startRow && s.startRow <= m.endRow) : g.ranges.some((m) => s.startColumn > m.startColumn && s.startColumn <= m.endColumn)).forEach((g) => {
        u.push(new ie(c, d, g.permissionId).id);
      }), o.composePermission(u).some((g) => g.value === !1);
    })
  );
}
function Rf(r, e) {
  const t = r.get(k), n = r.get(Q), i = r.get($e), o = r.get(rt);
  return St(n.selectionMoveEnd$, o.permissionPointUpdate$.pipe(ia(100))).pipe(
    pn(() => {
      var g;
      const s = (g = n.getCurrentLastSelection()) == null ? void 0 : g.range;
      if (!s) return !0;
      const l = t.getCurrentUnitForType(O.UNIVER_SHEET), a = l == null ? void 0 : l.getActiveSheet();
      if (!l || !a)
        return !0;
      const c = l.getUnitId(), d = a.getSheetId(), u = [new K(c).id, new te(c, d).id], h = de.deepClone(s);
      return e === "row" ? (h.startColumn = 0, h.endColumn = a.getColumnCount() - 1) : (h.startRow = 0, h.endRow = a.getRowCount() - 1), i.getSubunitRuleList(c, d).filter((m) => m.ranges.some((f) => se.intersects(h, f))).forEach((m) => {
        u.push(new ie(c, d, m.permissionId).id);
      }), o.composePermission(u).some((m) => m.value === !1);
    })
  );
}
function Oa(r, e) {
  const t = r.get(k), n = r.get(Q), i = r.get($e), o = r.get(rt);
  return St(n.selectionMoveEnd$, o.permissionPointUpdate$.pipe(ia(100))).pipe(
    pn(() => {
      var g;
      const s = (g = n.getCurrentLastSelection()) == null ? void 0 : g.range;
      if (!s) return !0;
      const l = t.getCurrentUnitForType(O.UNIVER_SHEET), a = l == null ? void 0 : l.getActiveSheet();
      if (!l || !a)
        return !0;
      const c = l.getUnitId(), d = a.getSheetId(), u = [new K(c).id, new te(c, d).id], h = de.deepClone(s);
      return e === "row" ? h.endRow = a.getRowCount() - 1 : h.endColumn = a.getColumnCount() - 1, i.getSubunitRuleList(c, d).filter((m) => m.ranges.some((f) => se.intersects(h, f))).forEach((m) => {
        u.push(new ie(c, d, m.permissionId).id);
      }), o.composePermission(u).some((m) => m.value === !1);
    })
  );
}
function Yi(r, e) {
  const n = r.get(k).getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(ft), o = r.get($e), s = r.get(rt), l = r.get(Ft);
  return at([l.currentUser$, n]).pipe(
    Pn(([a, c]) => c ? c.activeSheet$.pipe(
      Pn((d) => {
        if (!d)
          return Ce(!0);
        const u = c.getUnitId(), h = [];
        return e.forEach((m) => h.push(new m(u).id)), s.composePermission$(h).pipe(pn((m) => m.every((f) => f.value === !0))).pipe(
          pn((m) => {
            if (!m)
              return !0;
            const f = d.getSheetId(), v = i.getRule(u, f), p = o.getSubunitRuleList(u, f);
            return !!(v || p.length);
          })
        );
      })
    ) : Ce(!0))
  );
}
function sb(r) {
  const e = r.get(Ec), t = he(r, { workbookTypes: [K], worksheetTypes: [te, Ze], rangeTypes: [ie] });
  return {
    id: Tc.id,
    icon: new Fe((n) => {
      const i = "AllBorderIcon", o = r.get(Ec), s = r.get(W).onCommandExecuted((l) => {
        var h;
        if (l.id !== Tc.id)
          return;
        const { type: c } = o.getBorderInfo(), d = bf.find((g) => g.value === c), u = (h = d == null ? void 0 : d.icon) != null ? h : i;
        n.next(u);
      });
      return n.next(i), s.dispose;
    }),
    tooltip: "toolbar.border.main",
    type: $.BUTTON_SELECTOR,
    slot: !0,
    selections: [
      {
        label: {
          name: au,
          hoverable: !1,
          selectable: !1
        },
        value$: e.borderInfo$
      }
    ],
    value$: e.borderInfo$,
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: t
  };
}
const Hs = "sheet.menu.clear-selection";
function za(r) {
  return {
    id: Hs,
    type: $.SUBITEMS,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearSelection",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function ja(r) {
  return {
    id: pr.id,
    type: $.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearContent",
    disabled$: zi(r, he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, qt],
      rangeTypes: [ie]
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Ya(r) {
  return {
    id: uo.id,
    type: $.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearFormat",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function _s(r) {
  return {
    id: io.id,
    type: $.BUTTON,
    icon: "ClearFormatDoubleIcon",
    title: "rightClick.clearAll",
    tooltip: "rightClick.clearAll",
    disabled$: zi(r, he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, qt, Ze],
      rangeTypes: [ie]
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
const If = "sheet.menu.delete";
function lb(r) {
  return {
    id: If,
    type: $.SUBITEMS,
    title: "rightClick.delete",
    icon: "ReduceDoubleIcon",
    hidden$: zi(r, ji(r)),
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te] })
  };
}
function _h(r) {
  return {
    id: Eo.id,
    type: $.BUTTON,
    icon: "DeleteColumnDoubleIcon",
    title: "rightClick.deleteSelectedColumn",
    hidden$: Rf(r, "col"),
    disabled$: he(r, { workbookTypes: [K, Xv], worksheetTypes: [te, zv] })
  };
}
function Rh(r) {
  return {
    id: Mo.id,
    type: $.BUTTON,
    icon: "DeleteRowDoubleIcon",
    title: "rightClick.deleteSelectedRow",
    disabled$: he(r, { workbookTypes: [K, Fv], worksheetTypes: [te, Uv] }),
    hidden$: Rf(r, "row")
  };
}
function ab(r) {
  return {
    id: ts.id,
    type: $.BUTTON,
    title: "rightClick.moveLeft",
    icon: "DeleteCellShiftLeftDoubleIcon",
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te], rangeTypes: [ie] }),
    hidden$: Oa(r, "col")
  };
}
function cb(r) {
  return {
    id: pi.id,
    type: $.BUTTON,
    title: "rightClick.moveUp",
    icon: "DeleteCellShiftUpDoubleIcon",
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te], rangeTypes: [ie] }),
    hidden$: Oa(r, "row")
  };
}
function db(r) {
  const e = r.get(W), t = r.get(k);
  return {
    id: _g.id,
    type: $.BUTTON,
    tooltip: "toolbar.toggleGridlines",
    icon: "HideGridlinesDoubleIcon",
    activated$: new Fe((n) => {
      const i = () => {
        const s = t.getCurrentUnitForType(O.UNIVER_SHEET);
        return s ? s.getActiveSheet().getConfig().showGridlines === Ke.TRUE : !1;
      }, o = new ht();
      return o.add(e.onCommandExecuted((s) => {
        (s.id === jv.id || s.id === nt.id) && n.next(i());
      })), o.add(t.getCurrentTypeOfUnit$(O.UNIVER_SHEET).subscribe(() => {
        n.next(i());
      })), n.next(i()), () => o.dispose();
    }),
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te] })
  };
}
const Sn = `${wf}_MENU_ITEM_INPUT_COMPONENT`, yf = (r) => {
  const { prefix: e, suffix: t, value: n, onChange: i, min: o = Number.MIN_SAFE_INTEGER, max: s = Number.MAX_SAFE_INTEGER } = r, l = L(xe), a = L(Pd), [c, d] = re(), u = (g) => {
    if (!g) {
      d(o.toString());
      return;
    }
    const m = g.toString();
    d(m), i(m);
  };
  Ee(() => {
    a.visible || d(n);
  }, [a.visible]), Ee(() => {
    +n < o ? d(o.toString()) : +n > s ? d(s.toString()) : d(n);
  }, [n]);
  function h() {
    c && i(c);
  }
  return /* @__PURE__ */ q("div", { className: "univer-inline-flex univer-items-center univer-gap-1", children: [
    l.t(e),
    /* @__PURE__ */ b("div", { className: "univer-w-16", onClick: (g) => g.stopPropagation(), children: /* @__PURE__ */ b(
      CC,
      {
        value: Number(c),
        size: "mini",
        precision: 0,
        min: o,
        max: s,
        onPressEnter: h,
        onChange: u
      }
    ) }),
    l.t(t)
  ] });
}, Mf = "sheet.menu.cell-insert";
function ub(r) {
  return {
    id: Mf,
    type: $.SUBITEMS,
    title: "rightClick.insert",
    icon: "InsertDoubleIcon",
    hidden$: zi(r, ji(r)),
    disabled$: he(r, { workbookTypes: [K, ql, Zl], worksheetTypes: [Ql, Gl, te], rangeTypes: [ie] })
  };
}
function hb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: Tg.id,
    type: $.BUTTON,
    icon: "InsertRowAboveDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertRowsAbove",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAboveSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endRow) - (a == null ? void 0 : a.startRow) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, Zl], worksheetTypes: [Gl, te], rangeTypes: [ie] }),
    hidden$: _f(r, "row")
  };
}
function gb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: Eg.id,
    type: $.BUTTON,
    icon: "LeftInsertColumnDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertColsLeft",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsLeftSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endColumn) - (a == null ? void 0 : a.startColumn) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, ql], worksheetTypes: [Ql, te], rangeTypes: [ie] }),
    hidden$: _f(r, "col")
  };
}
function mb(r) {
  return {
    id: ns.id,
    type: $.BUTTON,
    title: "rightClick.moveRight",
    icon: "InsertCellShiftRightDoubleIcon",
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te], rangeTypes: [ie] }),
    hidden$: Oa(r, "col")
  };
}
function fb(r) {
  return {
    id: vi.id,
    type: $.BUTTON,
    title: "rightClick.moveDown",
    icon: "InsertCellDownDoubleIcon",
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te], rangeTypes: [ie] }),
    hidden$: Oa(r, "row")
  };
}
function pb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: Rg.id,
    type: $.BUTTON,
    icon: "InsertRowBelowDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertRowsAfter",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAfterSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endRow) - (a == null ? void 0 : a.startRow) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, Zl], worksheetTypes: [Gl, te], rangeTypes: [ie] }),
    hidden$: ji(r)
  };
}
function vb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: Ig.id,
    type: $.BUTTON,
    icon: "InsertRowAboveDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertRowsAbove",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertRowsAboveSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endRow) - (a == null ? void 0 : a.startRow) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, Zl], worksheetTypes: [Gl, te], rangeTypes: [ie] }),
    hidden$: ji(r)
  };
}
function Sb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: Mg.id,
    type: $.BUTTON,
    icon: "LeftInsertColumnDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertColsLeft",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsLeftSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endColumn) - (a == null ? void 0 : a.startColumn) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, ql], worksheetTypes: [Ql, te], rangeTypes: [ie] }),
    hidden$: ji(r)
  };
}
function Cb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = 1;
  return {
    id: yg.id,
    type: $.BUTTON,
    icon: "RightInsertColumnDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.insertColsRight",
        min: 1,
        max: 1e3,
        suffix: "rightClick.insertColsRightSuffix"
      }
    },
    value$: pt(e, i, () => new Fe((o) => {
      function s() {
        var d;
        const a = (d = t.getCurrentLastSelection()) == null ? void 0 : d.range;
        let c = i;
        a && (c = (a == null ? void 0 : a.endColumn) - (a == null ? void 0 : a.startColumn) + 1), o.next(c);
      }
      const l = n.onCommandExecuted((a) => {
        if (a.id === Ie.id)
          return s();
      });
      return s(), l.dispose;
    })),
    disabled$: he(r, { workbookTypes: [K, ql], worksheetTypes: [Ql, te], rangeTypes: [ie] }),
    hidden$: ji(r)
  };
}
var wb = /* @__PURE__ */ ((r) => (r.ROW_HEADER_CONTEXT_MENU = "ROW_HEADER_CONTEXT_MENU", r.COL_HEADER_CONTEXT_MENU = "COL_HEADER_CONTEXT_MENU", r.SHEET_BAR = "SHEET_BAR", r.SHEET_FOOTER = "SHEET_FOOTER", r))(wb || {});
function bb(r) {
  const e = r.get(Dn);
  return {
    id: rs.id,
    subId: Qd.id,
    type: $.BUTTON,
    icon: "BrushIcon",
    title: "Format Painter",
    tooltip: "toolbar.formatPainter",
    activated$: new Fe((t) => {
      let n = !1;
      const i = e.status$.subscribe((o) => {
        n = o !== zt.OFF, t.next(n);
      });
      return t.next(n), () => {
        i.unsubscribe();
      };
    }),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [js, te], rangeTypes: [ie] }, !0)
  };
}
function _b(r) {
  const e = r.get(W), t = r.get(k), n = r.get(De), i = r.get(Q);
  return {
    id: Bi.id,
    type: $.BUTTON,
    icon: "BoldIcon",
    title: "Set bold",
    tooltip: "toolbar.bold",
    disabled$: he(r, { workbookTypes: [K], worksheetTypes: [te, Ze], rangeTypes: [ie] }, !0),
    activated$: pt(t, !1, ({ worksheet: o }) => new Fe((s) => {
      var d;
      const l = e.onCommandExecuted((u) => {
        var g, m;
        const h = u.id;
        if (h === we.id || h === Ie.id || h === nt.id) {
          const f = (g = i.getCurrentLastSelection()) == null ? void 0 : g.primary;
          let v = gs.NORMAL;
          if (f != null) {
            const p = o.getRange(f.startRow, f.startColumn);
            v = p == null ? void 0 : p.getFontWeight();
          }
          s.next(v === gs.BOLD);
        }
        if ((h === Ko.id || h === Lo.id) && n.getContextValue(Je) && n.getContextValue(Nt)) {
          const f = ds(r);
          if (f == null)
            return;
          const v = (m = f.ts) == null ? void 0 : m.bl;
          s.next(v === Ke.TRUE);
        }
      }), a = (d = i.getCurrentLastSelection()) == null ? void 0 : d.primary;
      if (!o) {
        s.next(!1);
        return;
      }
      let c = gs.NORMAL;
      if (a != null) {
        const u = o.getRange(a.startRow, a.startColumn);
        c = u == null ? void 0 : u.getFontWeight();
      }
      return s.next(c === gs.BOLD), l.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Rb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = r.get(De);
  return {
    id: Fi.id,
    type: $.BUTTON,
    icon: "ItalicIcon",
    title: "Set italic",
    tooltip: "toolbar.italic",
    disabled$: he(
      r,
      {
        workbookTypes: [K],
        worksheetTypes: [te, Ze],
        rangeTypes: [ie]
      },
      !0
    ),
    activated$: pt(t, !1, ({ worksheet: o }) => new Fe((s) => {
      var d;
      const l = e.onCommandExecuted((u) => {
        var g, m;
        const h = u.id;
        if (h === we.id || h === Ie.id || h === nt.id) {
          const f = (g = n.getCurrentLastSelection()) == null ? void 0 : g.primary;
          let v = ms.NORMAL;
          if (f != null) {
            const p = o.getRange(f.startRow, f.startColumn);
            v = p == null ? void 0 : p.getFontStyle();
          }
          s.next(v === ms.ITALIC);
        }
        if ((h === Ko.id || h === Lo.id) && i.getContextValue(Je) && i.getContextValue(Nt)) {
          const f = ds(r);
          if (f == null) return;
          const v = (m = f.ts) == null ? void 0 : m.it;
          s.next(v === Ke.TRUE);
        }
      }), a = (d = n.getCurrentLastSelection()) == null ? void 0 : d.primary;
      let c = ms.NORMAL;
      if (a != null) {
        const u = o.getRange(a.startRow, a.startColumn);
        c = u == null ? void 0 : u.getFontStyle();
      }
      return s.next(c === ms.ITALIC), l.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Ib(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = r.get(De);
  return {
    id: Ui.id,
    type: $.BUTTON,
    icon: "UnderlineIcon",
    title: "Set underline",
    tooltip: "toolbar.underline",
    activated$: pt(t, !1, ({ worksheet: o }) => new Fe((s) => {
      var d;
      const l = e.onCommandExecuted((u) => {
        var g, m;
        const h = u.id;
        if (h === we.id || h === Ie.id || h === nt.id) {
          const f = (g = n.getCurrentLastSelection()) == null ? void 0 : g.primary;
          let v;
          if (f != null) {
            const p = o.getRange(f.startRow, f.startColumn);
            v = p == null ? void 0 : p.getUnderline();
          }
          s.next(!!(v && v.s));
        }
        if ((h === Ko.id || h === Lo.id) && i.getContextValue(Je) && i.getContextValue(Nt)) {
          const f = ds(r);
          if (f == null) return;
          const v = (m = f.ts) == null ? void 0 : m.ul;
          s.next((v == null ? void 0 : v.s) === Ke.TRUE);
        }
      }), a = (d = n.getCurrentLastSelection()) == null ? void 0 : d.primary;
      let c;
      if (a != null) {
        const u = o.getRange(a.startRow, a.startColumn);
        c = u == null ? void 0 : u.getUnderline();
      }
      return s.next(!!(c && c.s)), l.dispose;
    })),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }, !0),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function yb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = r.get(De);
  return {
    id: Xi.id,
    type: $.BUTTON,
    icon: "StrikethroughIcon",
    title: "Set strike through",
    tooltip: "toolbar.strikethrough",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }, !0),
    activated$: pt(t, !1, ({ worksheet: o }) => new Fe((s) => {
      var d;
      const l = e.onCommandExecuted((u) => {
        var g, m;
        const h = u.id;
        if (h === we.id || h === Ie.id || h === nt.id) {
          const f = (g = n.getCurrentLastSelection()) == null ? void 0 : g.primary;
          let v;
          if (f != null) {
            const p = o.getRange(f.startRow, f.startColumn);
            v = p == null ? void 0 : p.getStrikeThrough();
          }
          s.next(!!(v && v.s));
        }
        if ((h === Ko.id || h === Lo.id) && i.getContextValue(Je) && i.getContextValue(Nt)) {
          const f = ds(r);
          if (f == null)
            return;
          const v = (m = f.ts) == null ? void 0 : m.st;
          s.next((v == null ? void 0 : v.s) === Ke.TRUE);
        }
      }), a = (d = n.getCurrentLastSelection()) == null ? void 0 : d.primary;
      let c;
      if (a != null) {
        const u = o.getRange(a.startRow, a.startColumn);
        c = u == null ? void 0 : u.getStrikeThrough();
      }
      return s.next(!!(c && c.s)), l.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Mb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = Fo.ff;
  return {
    id: ha.id,
    tooltip: "toolbar.font",
    type: $.SELECTOR,
    label: aC,
    selections: lC.map((o) => ({
      label: {
        name: cC
      },
      value: o.value
    })),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }, !0),
    value$: pt(t, i, ({ worksheet: o }) => new Fe((s) => {
      const l = () => {
        var u;
        let c = i;
        const d = (u = n.getCurrentLastSelection()) == null ? void 0 : u.primary;
        if (d != null) {
          const h = o.getCellStyle(d.startRow, d.startColumn), g = o.getDefaultCellStyleInternal(), m = o.getRowStyle(d.startRow), f = o.getColumnStyle(d.startColumn), v = Sv(g, m, f, h);
          v.ff && (c = v.ff);
        }
        s.next(c);
      }, a = e.onCommandExecuted((c) => {
        const d = c.id;
        (d === we.id || d === Ie.id || d === nt.id) && l();
      });
      return l(), a.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Eb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = r.get(De), o = Fo.fs, s = he(r, {
    workbookTypes: [K],
    worksheetTypes: [te, Ze],
    rangeTypes: [ie]
  }, !0);
  return {
    id: ua.id,
    type: $.SELECTOR,
    tooltip: "toolbar.fontSize",
    label: {
      name: sC,
      props: {
        min: 1,
        max: 400,
        disabled$: s
      }
    },
    selections: oC,
    disabled$: s,
    value$: pt(t, o, ({ worksheet: l }) => new Fe((a) => {
      const c = () => {
        var m;
        let h = o;
        const g = (m = n.getCurrentLastSelection()) == null ? void 0 : m.primary;
        if (g != null) {
          const f = l.getComposedCellStyle(g.startRow, g.startColumn);
          f.fs && (h = f.fs);
        }
        a.next(h);
      }, d = () => {
        var g, m;
        const h = ds(r);
        if (h != null) {
          const f = (m = (g = h.ts) == null ? void 0 : g.fs) != null ? m : o;
          a.next(f);
        }
      }, u = e.onCommandExecuted((h) => {
        const g = h.id;
        (g === we.id || g === Ie.id || g === nt.id) && c(), (g === Ko.id || g === Lo.id) && i.getContextValue(Je) && i.getContextValue(Nt) && d();
      });
      return c(), u.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Tb(r) {
  return {
    id: qd.id,
    type: $.BUTTON,
    title: "toolbar.resetColor",
    icon: "NoColorDoubleIcon",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }, !0),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Pb(r) {
  const e = r.get(W), t = r.get(Ht), n = r.get(Q);
  return {
    id: Io.id,
    icon: "FontColorDoubleIcon",
    tooltip: "toolbar.textColor.main",
    type: $.BUTTON_SELECTOR,
    selections: [
      {
        label: {
          name: xd,
          hoverable: !1,
          selectable: !1
        },
        value$: new Fe((i) => {
          var a;
          const o = Fo.cl.rgb, { isAllValuesSame: s, value: l } = n.getCellStylesProperty("cl");
          s ? i.next((a = l == null ? void 0 : l.rgb) != null ? a : o) : i.next(o);
        })
      }
    ],
    value$: new Fe((i) => {
      const o = t.getColorFromTheme("gray.900"), s = e.onCommandExecuted((l) => {
        if (l.id === Io.id) {
          const a = l.params.value;
          i.next(a != null ? a : o);
        }
      });
      return i.next(o), s.dispose;
    }),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    }, !0)
  };
}
function xb(r) {
  return {
    id: Dg.id,
    type: $.BUTTON,
    title: "toolbar.resetColor",
    icon: "NoColorDoubleIcon",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
function Ob(r) {
  const e = r.get(W), t = r.get(Ht), n = r.get(Q);
  return {
    id: zs.id,
    tooltip: "toolbar.fillColor.main",
    type: $.BUTTON_SELECTOR,
    icon: "PaintBucketDoubleIcon",
    selections: [
      {
        label: {
          name: xd,
          hoverable: !1,
          selectable: !1
        },
        value$: new Fe((i) => {
          var a;
          const o = Fo.bg.rgb, { isAllValuesSame: s, value: l } = n.getCellStylesProperty("bg");
          s ? i.next((a = l == null ? void 0 : l.rgb) != null ? a : o) : i.next(o);
        })
      }
    ],
    value$: new Fe((i) => {
      const o = t.getColorFromTheme("primary.600"), s = e.onCommandExecuted((l) => {
        if (l.id === zs.id) {
          const a = l.params.value;
          i.next(a != null ? a : o);
        }
      });
      return i.next(o), s.dispose;
    }),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
const Ih = [
  {
    label: "align.left",
    icon: "LeftJustifyingIcon",
    value: It.LEFT
  },
  {
    label: "align.center",
    icon: "HorizontallyIcon",
    value: It.CENTER
  },
  {
    label: "align.right",
    icon: "RightJustifyingIcon",
    value: It.RIGHT
  }
];
function Ab(r) {
  var s, l;
  const e = r.get(k), t = r.get(Q), n = e.getCurrentUnitOfType(O.UNIVER_SHEET), i = n == null ? void 0 : n.getActiveSheet().getDefaultCellStyleInternal(), o = (s = i == null ? void 0 : i.ht) != null ? s : It.LEFT;
  return {
    id: Ac.id,
    icon: (l = Ih.find((a) => a.value === o)) == null ? void 0 : l.icon,
    tooltip: "toolbar.horizontalAlignMode.main",
    type: $.SELECTOR,
    selections: Ih,
    value$: pt(e, o, ({ worksheet: a }) => new Fe((c) => {
      var g, m;
      const d = r.get(W).onCommandExecuted((f) => {
        var w, C;
        const v = f.id;
        if (v !== Ac.id && v !== Ie.id && v !== nt.id)
          return;
        const p = (w = t.getCurrentLastSelection()) == null ? void 0 : w.primary;
        let S;
        if (p != null) {
          const I = a.getRange(p.startRow, p.startColumn), R = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(p.startRow, p.startColumn);
          S = (C = R == null ? void 0 : R.ht) != null ? C : I == null ? void 0 : I.getHorizontalAlignment();
        }
        c.next(S != null ? S : o);
      }), u = (g = t.getCurrentLastSelection()) == null ? void 0 : g.primary;
      let h;
      if (u != null) {
        const f = a.getRange(u.startRow, u.startColumn), v = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(u.startRow, u.startColumn);
        h = (m = v == null ? void 0 : v.ht) != null ? m : f == null ? void 0 : f.getHorizontalAlignment();
      }
      return c.next(h != null ? h : o), d.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
const yh = [
  {
    label: "align.top",
    icon: "AlignTopIcon",
    value: cn.TOP
  },
  {
    label: "align.middle",
    icon: "VerticalCenterIcon",
    value: cn.MIDDLE
  },
  {
    label: "align.bottom",
    icon: "AlignBottomIcon",
    value: cn.BOTTOM
  }
];
function Hb(r) {
  var s, l;
  const e = r.get(k), t = r.get(Q), n = e.getCurrentUnitOfType(O.UNIVER_SHEET), i = n == null ? void 0 : n.getActiveSheet().getDefaultCellStyleInternal(), o = (s = i == null ? void 0 : i.vt) != null ? s : cn.BOTTOM;
  return {
    id: Oc.id,
    icon: (l = yh.find((a) => a.value === o)) == null ? void 0 : l.icon,
    tooltip: "toolbar.verticalAlignMode.main",
    type: $.SELECTOR,
    selections: yh,
    value$: pt(e, o, ({ worksheet: a }) => new Fe((c) => {
      var g, m;
      const d = r.get(W).onCommandExecuted((f) => {
        var w, C;
        const v = f.id;
        if (v !== Oc.id && v !== Ie.id && v !== nt.id)
          return;
        const p = (w = t.getCurrentLastSelection()) == null ? void 0 : w.primary;
        let S;
        if (p != null) {
          const I = a.getRange(p.startRow, p.startColumn), R = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(p.startRow, p.startColumn);
          S = (C = R == null ? void 0 : R.vt) != null ? C : I == null ? void 0 : I.getVerticalAlignment();
        }
        c.next(S != null ? S : o);
      }), u = (g = t.getCurrentLastSelection()) == null ? void 0 : g.primary;
      let h;
      if (u != null) {
        const f = a.getRange(u.startRow, u.startColumn), v = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(u.startRow, u.startColumn);
        h = (m = v == null ? void 0 : v.vt) != null ? m : f == null ? void 0 : f.getVerticalAlignment();
      }
      return c.next(h != null ? h : o), d.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
const Mh = [
  {
    label: "textWrap.overflow",
    icon: "OverflowIcon",
    value: mr.OVERFLOW
  },
  {
    label: "textWrap.wrap",
    icon: "AutowrapIcon",
    value: mr.WRAP
  },
  {
    label: "textWrap.clip",
    icon: "TruncationIcon",
    value: mr.CLIP
  }
];
function Vb(r) {
  var s, l;
  const e = r.get(Q), t = r.get(k), n = t.getCurrentUnitOfType(O.UNIVER_SHEET), i = n == null ? void 0 : n.getActiveSheet().getDefaultCellStyleInternal(), o = (s = i == null ? void 0 : i.tb) != null ? s : mr.OVERFLOW;
  return {
    id: xc.id,
    tooltip: "toolbar.textWrapMode.main",
    icon: (l = Mh.find((a) => a.value === o)) == null ? void 0 : l.icon,
    type: $.SELECTOR,
    selections: Mh,
    value$: pt(t, o, ({ worksheet: a }) => new Fe((c) => {
      var g, m;
      const d = r.get(W).onCommandExecuted((f) => {
        var w, C;
        const v = f.id;
        if (v !== xc.id && v !== Ie.id && v !== nt.id)
          return;
        const p = (w = e.getCurrentLastSelection()) == null ? void 0 : w.primary;
        let S;
        if (p != null) {
          const I = a.getRange(p.startRow, p.startColumn), R = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(p.startRow, p.startColumn);
          S = (C = R == null ? void 0 : R.tb) != null ? C : I == null ? void 0 : I.getWrapStrategy();
        }
        c.next(S != null ? S : o);
      }), u = (g = e.getCurrentLastSelection()) == null ? void 0 : g.primary;
      let h;
      if (u != null) {
        const f = a.getRange(u.startRow, u.startColumn), v = n == null ? void 0 : n.getActiveSheet().getComposedCellStyle(u.startRow, u.startColumn);
        h = (m = v == null ? void 0 : v.tb) != null ? m : f == null ? void 0 : f.getWrapStrategy();
      }
      return c.next(h != null ? h : o), d.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
const Eh = [
  {
    label: "textRotate.none",
    icon: "NoRotationIcon",
    value: 0
  },
  {
    label: "textRotate.angleUp",
    icon: "LeftRotationFortyFiveDegreesIcon",
    value: -45
  },
  {
    label: "textRotate.angleDown",
    icon: "RightRotationFortyFiveDegreesIcon",
    value: 45
  },
  {
    label: "textRotate.vertical",
    icon: "VerticalTextIcon",
    value: "v"
  },
  {
    label: "textRotate.rotationUp",
    icon: "LeftRotationNinetyDegreesIcon",
    value: -90
  },
  {
    label: "textRotate.rotationDown",
    icon: "RightRotationNinetyDegreesIcon",
    value: 90
  }
];
function Nb(r) {
  const e = r.get(Q), t = r.get(k), n = 0;
  return {
    id: Pc.id,
    tooltip: "toolbar.textRotateMode.main",
    icon: Eh[0].icon,
    type: $.SELECTOR,
    selections: Eh,
    value$: pt(t, n, ({ worksheet: i }) => new Fe((o) => {
      var c, d;
      const s = r.get(W).onCommandExecuted((u) => {
        var f, v;
        const h = u.id;
        if (h !== Pc.id && h !== Ie.id && h !== nt.id)
          return;
        const g = (f = e.getCurrentLastSelection()) == null ? void 0 : f.primary;
        let m;
        if (g != null) {
          const p = i.getRange(g.startRow, g.startColumn);
          m = p == null ? void 0 : p.getTextRotation();
        }
        (m == null ? void 0 : m.v) === Ke.TRUE ? o.next("v") : o.next((v = m && m.a) != null ? v : n);
      }), l = (c = e.getCurrentLastSelection()) == null ? void 0 : c.primary;
      let a;
      if (l != null) {
        const u = i.getRange(l.startRow, l.startColumn);
        a = u == null ? void 0 : u.getTextRotation();
      }
      return (a == null ? void 0 : a.v) === Ke.TRUE ? o.next("v") : o.next((d = a && a.a) != null ? d : n), s.dispose;
    })),
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ze],
      rangeTypes: [ie]
    })
  };
}
function cs(r) {
  return new Fe((t) => t.next(!r.get(Jl).supportClipboard));
}
function ci(r) {
  return {
    id: un.name,
    commandId: un.id,
    type: $.BUTTON,
    title: "rightClick.copy",
    icon: "CopyDoubleIcon",
    disabled$: he(r, {
      workbookTypes: [oo],
      worksheetTypes: [js],
      rangeTypes: [Hc]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Za(r) {
  return {
    id: hn.name,
    commandId: hn.id,
    type: $.BUTTON,
    title: "rightClick.paste",
    icon: "PasteSpecialDoubleIcon",
    disabled$: cs(r).pipe(
      or(he(r, {
        rangeTypes: [ie],
        worksheetTypes: [te, Ze, qt],
        workbookTypes: [K]
      })),
      Be(([e, t]) => e || t)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
const Vs = "sheet.menu.paste-special";
function Ga(r) {
  return {
    id: Vs,
    type: $.SUBITEMS,
    icon: "PasteSpecialDoubleIcon",
    title: "rightClick.pasteSpecial",
    hidden$: zi(r, ce(r, O.UNIVER_SHEET))
  };
}
function qa(r) {
  return {
    id: go.id,
    type: $.BUTTON,
    title: "rightClick.pasteValue",
    disabled$: cs(r).pipe(
      or(he(r, {
        rangeTypes: [ie],
        worksheetTypes: [qt, te],
        workbookTypes: [K]
      })),
      Be(([e, t]) => e || t)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Qa(r) {
  return {
    id: mo.id,
    type: $.BUTTON,
    title: "rightClick.pasteFormat",
    disabled$: cs(r).pipe(
      or(he(r, {
        rangeTypes: [ie],
        worksheetTypes: [Ze, te],
        workbookTypes: [K]
      })),
      Be(([e, t]) => e || t)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Ka(r) {
  return {
    id: ri.id,
    type: $.BUTTON,
    title: "rightClick.pasteColWidth",
    disabled$: cs(r).pipe(
      or(he(r, {
        rangeTypes: [ie],
        worksheetTypes: [Ar, te],
        workbookTypes: [K]
      })),
      Be(([e, t]) => e || t)
    )
  };
}
function Ja(r) {
  return {
    id: fo.id,
    type: $.BUTTON,
    title: "rightClick.pasteBesidesBorder",
    disabled$: cs(r).pipe(
      or(he(r, {
        rangeTypes: [ie],
        worksheetTypes: [
          te,
          Ze,
          qt,
          Or,
          Ar
        ],
        workbookTypes: [K]
      })),
      Be(([e, t]) => e || t)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function kb(r) {
  return {
    id: wd.id,
    type: $.BUTTON,
    icon: "AutoHeightDoubleIcon",
    title: "rightClick.fitContent",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [Or, te],
      rangeTypes: [ie]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Db(r) {
  return {
    id: is.id,
    type: $.BUTTON,
    icon: "AutoWidthDoubleIcon",
    title: "rightClick.fitContent",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [Or, te],
      rangeTypes: [ie]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
const Ef = "sheet.menu.sheet-frozen";
function Lb(r) {
  return {
    id: Ef,
    type: $.SUBITEMS,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
const Gc = "sheet.header-menu.sheet-frozen";
function Th(r) {
  return {
    id: Gc,
    type: $.SUBITEMS,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function $a(r) {
  return {
    id: $n.id,
    type: $.BUTTON,
    title: "rightClick.freeze",
    icon: "FreezeToSelectedIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Wb(r) {
  return {
    id: ba.id,
    type: $.BUTTON,
    title: "rightClick.freezeRow",
    icon: "FreezeRowIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Bb(r) {
  return {
    id: _a.id,
    type: $.BUTTON,
    title: "rightClick.freezeCol",
    icon: "FreezeColumnIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function ec(r) {
  return {
    id: xs.id,
    type: $.BUTTON,
    title: "rightClick.cancelFreeze",
    icon: "CancelFreezeIcon",
    // disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission], rangeTypes: [RangeProtectionPermissionEditPoint] }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Fb(r) {
  return {
    id: ca.id,
    type: $.BUTTON,
    icon: "HideDoubleIcon",
    title: "rightClick.hideSelectedRow",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [Or, te],
      rangeTypes: [ie]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Ub(r) {
  return {
    id: da.id,
    type: $.BUTTON,
    icon: "HideDoubleIcon",
    title: "rightClick.hideSelectedColumn",
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ar],
      rangeTypes: [ie]
    }),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Xb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = [Ie, xg, Og].map((o) => o.id);
  return {
    id: Ag.id,
    type: $.BUTTON,
    icon: "EyeOutlineIcon",
    title: "rightClick.showHideRow",
    hidden$: pt(e, !0, ({ worksheet: o }) => new Fe((s) => {
      function l() {
        var d;
        const c = (d = t.getCurrentSelections()) == null ? void 0 : d.map((u) => u.range).filter((u) => u.rangeType === z.ROW);
        return !!(c != null && c.some((u) => {
          for (let h = u.startRow; h <= u.endRow; h++)
            if (!o.getRowRawVisible(h)) return !0;
          return !1;
        }));
      }
      const a = n.onCommandExecuted((c) => {
        i.findIndex((d) => d === c.id) !== -1 && s.next(!l());
      });
      return s.next(!l()), () => a.dispose();
    })),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Or],
      rangeTypes: [ie]
    })
  };
}
function zb(r) {
  const e = r.get(k), t = r.get(Q), n = r.get(W), i = [Ie, Vg, Ng].map((o) => o.id);
  return {
    id: kg.id,
    type: $.BUTTON,
    icon: "EyeOutlineIcon",
    title: "rightClick.showHideColumn",
    hidden$: pt(e, !0, ({ worksheet: o }) => new Fe((s) => {
      function l() {
        var d;
        const c = (d = t.getCurrentSelections()) == null ? void 0 : d.map((u) => u.range).filter((u) => u.rangeType === z.COLUMN);
        return !c || c.length === 0 ? !1 : !!c.some((u) => {
          for (let h = u.startColumn; h <= u.endColumn; h++)
            if (!o.getColVisible(h)) return !0;
          return !1;
        });
      }
      const a = n.onCommandExecuted((c) => {
        i.findIndex((d) => d === c.id) !== -1 && s.next(!l());
      });
      return s.next(!l()), () => a.dispose();
    })),
    disabled$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [Ar, te],
      rangeTypes: [ie]
    })
  };
}
function jb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = 2;
  return {
    id: Pg.id,
    type: $.BUTTON,
    icon: "AdjustHeightDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.rowHeight",
        suffix: "px",
        min: i,
        max: 1e3
      }
    },
    value$: pt(t, i, ({ worksheet: o }) => new Fe((s) => {
      function l() {
        var u;
        const c = (u = n.getCurrentLastSelection()) == null ? void 0 : u.primary, d = c ? o.getRowHeight(c.startRow) : o.getConfig().defaultRowHeight;
        s.next(d);
      }
      const a = e.onCommandExecuted((c) => {
        const d = c.id;
        if (d === we.id || d === Ie.id || d === Yv.id)
          return l();
      });
      return l(), a.dispose;
    })),
    hidden$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Or],
      rangeTypes: [ie]
    })
  };
}
function Yb(r) {
  const e = r.get(W), t = r.get(k), n = r.get(Q), i = 2;
  return {
    id: Hg.id,
    type: $.BUTTON,
    icon: "AdjustWidthDoubleIcon",
    label: {
      name: Sn,
      props: {
        prefix: "rightClick.columnWidth",
        suffix: "px",
        min: i,
        max: 1e3
      }
    },
    value$: pt(t, i, ({ worksheet: o }) => new Fe((s) => {
      function l() {
        var u;
        const c = (u = n.getCurrentLastSelection()) == null ? void 0 : u.primary, d = c ? o.getColumnWidth(c.startColumn) : o.getConfig().defaultColumnWidth;
        s.next(d);
      }
      const a = e.onCommandExecuted((c) => {
        const d = c.id;
        if (d === we.id || d === Ie.id || d === ln.id)
          return l();
      });
      return l(), a.dispose;
    })),
    hidden$: he(r, {
      workbookTypes: [K],
      worksheetTypes: [te, Ar],
      rangeTypes: [ie]
    })
  };
}
function ds(r) {
  var a;
  const e = r.get(k), t = r.get(Ad), n = e.getUnit(Oe), i = t.getActiveTextRange();
  if (n == null || i == null) return null;
  const o = (a = n.getBody()) == null ? void 0 : a.textRuns;
  if (o == null) return;
  const { startOffset: s } = i;
  return o.find(({ st: c, ed: d }) => s >= c && s <= d);
}
const sr = {
  type: J.COMMAND,
  id: "sheet.command.add-worksheet-merge",
  handler: async (r, e) => {
    const t = r.get(W), n = r.get(Zt), i = r.get(k), o = r.get(tn), s = r.get(xe), l = e.unitId, a = e.subUnitId, c = e.selections, d = jl(c, e.value), u = i.getUniverSheetInstance(l).getSheetBySheetId(a), h = [], g = [], m = km(u, d);
    if (m && !e.defaultMerge && !await o.confirm({
      id: "merge.confirm.add-worksheet-merge",
      title: {
        title: "merge.confirm.warning"
      },
      children: {
        title: "merge.confirm.title"
      },
      cancelText: s.t("merge.confirm.cancel"),
      confirmText: s.t("merge.confirm.confirm")
    }))
      return !1;
    const f = {
      unitId: l,
      subUnitId: a,
      ranges: de.deepClone(d)
    }, v = {
      unitId: l,
      subUnitId: a,
      ranges: de.deepClone(d)
    }, p = zl(r, f), S = Yl(r, v);
    if (p.ranges.length > 0 && h.push({ id: Qt.id, params: p }), h.push({ id: Kt.id, params: v }), g.push({ id: Qt.id, params: S }), p.ranges.length > 0 && g.push({ id: Kt.id, params: p }), m) {
      const M = Dm(r, l, u, d);
      h.unshift(...M.redos), g.push(...M.undos);
    }
    const w = Zv(r, e, d);
    w && h.push(w);
    const C = Gv(r, e);
    C && g.push(C);
    const R = r.get(vn).onCommandExecute({
      id: sr.id,
      params: { unitId: l, subUnitId: a, ranges: d }
    });
    return h.push(...R.redos), g.push(...R.undos), Wo(h, t).result ? (n.pushUndoRedo({
      unitID: l,
      undoMutations: g,
      redoMutations: h
    }), !0) : !1;
  }
}, cu = {
  type: J.COMMAND,
  id: "sheet.command.add-worksheet-merge-all",
  handler: async (r) => {
    var d;
    const e = r.get(W), n = (d = r.get(Q).getCurrentSelections()) == null ? void 0 : d.map((u) => u.range), i = Gd(aa.MergeAll, n);
    if (!(i != null && i.length))
      return !1;
    const s = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET);
    if (!s) return !1;
    const l = s.getActiveSheet();
    if (!l) return !1;
    const a = s.getUnitId(), c = l.getSheetId();
    return e.executeCommand(sr.id, {
      selections: i,
      unitId: a,
      subUnitId: c
    });
  }
}, du = {
  type: J.COMMAND,
  id: "sheet.command.add-worksheet-merge-vertical",
  handler: async (r) => {
    var d;
    const e = r.get(W), n = (d = r.get(Q).getCurrentSelections()) == null ? void 0 : d.map((u) => u.range), i = Gd(aa.MergeVertical, n);
    if (!(i != null && i.length))
      return !1;
    const s = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET);
    if (!s) return !1;
    const l = s.getActiveSheet();
    if (!l) return !1;
    const a = s.getUnitId(), c = l.getSheetId();
    return e.executeCommand(sr.id, {
      value: tg.COLUMNS,
      selections: i,
      unitId: a,
      subUnitId: c
    });
  }
}, uu = {
  type: J.COMMAND,
  id: "sheet.command.add-worksheet-merge-horizontal",
  handler: async (r) => {
    var d;
    const e = r.get(W), n = (d = r.get(Q).getCurrentSelections()) == null ? void 0 : d.map((u) => u.range), i = Gd(aa.MergeHorizontal, n);
    if (!(i != null && i.length))
      return !1;
    const s = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET);
    if (!s) return !1;
    const l = s.getActiveSheet();
    if (!l) return !1;
    const a = s.getUnitId(), c = l.getSheetId();
    return e.executeCommand(sr.id, {
      value: tg.ROWS,
      selections: i,
      unitId: a,
      subUnitId: c
    });
  }
};
function Zb(r) {
  const e = r.get(Q), t = r.get($e), n = r.get(k), i = r.get(qv), o = n.getCurrentTypeOfUnit$(O.UNIVER_SHEET);
  return at([
    e.selectionMoveEnd$,
    o.pipe(Be((s) => {
      var l;
      return (l = s == null ? void 0 : s.getUnitId()) != null ? l : "";
    })),
    o.pipe(lt((s) => {
      var l;
      return (l = s == null ? void 0 : s.activeSheet$) != null ? l : Ce(null);
    }))
  ]).pipe(
    Be(([s, l, a]) => {
      if (!a || !s || s.length === 0) return !1;
      const c = a.getSheetId(), d = s.map((g) => g.range);
      if (i.interceptor.fetchThroughInterceptors(Qv)(!1, d))
        return !0;
      const h = t.getSubunitRuleList(l, c).map((g) => g.ranges).flat();
      if (s.length < 2) {
        const g = s[0].range;
        return h.some((f) => se.intersects(f, g) && !se.contains(f, g));
      }
      for (let g = 0; g < s.length; g++)
        for (let m = g + 1; m < s.length; m++)
          if (se.intersects(s[g].range, s[m].range))
            return !0;
      return !1;
    })
  );
}
function Tf(r, e) {
  return !!gl(r, e, z.ROW);
}
function Pf(r, e) {
  return !!gl(r, e, z.COLUMN);
}
function gl(r, e, t) {
  return r.find((i) => {
    const o = i.range, { startRow: s, endRow: l, startColumn: a, endColumn: c, rangeType: d } = o;
    return d === z.ALL || d === z.NORMAL ? !1 : d === t && (t === z.COLUMN && a <= e && e <= c || t === z.ROW && s <= e && e <= l);
  });
}
function Gb(r) {
  const e = zi(r, he(r, { workbookTypes: [K], worksheetTypes: [te, qt, Ze], rangeTypes: [ie] })), t = Zb(r);
  return {
    id: sr.id,
    icon: "MergeAllIcon",
    tooltip: "toolbar.mergeCell.main",
    type: $.SUBITEMS,
    // selections: [...MERGE_CHILDREN],
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: e.pipe(
      or(t),
      Be(([n, i]) => n || i)
    )
  };
}
function qb(r) {
  return {
    id: cu.id,
    type: $.BUTTON,
    title: "merge.all",
    icon: "MergeAllIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Qb(r) {
  return {
    id: du.id,
    type: $.BUTTON,
    title: "merge.vertical",
    icon: "VerticalIntegrationIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Kb(r) {
  return {
    id: uu.id,
    type: $.BUTTON,
    title: "merge.horizontal",
    icon: "HorizontalMergeIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function Jb(r) {
  return {
    id: Lg.id,
    type: $.BUTTON,
    title: "merge.cancel",
    icon: "CancelMergeIcon",
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function $b(r) {
  const t = r.get(k).getCurrentTypeOfUnit$(O.UNIVER_SHEET), n = r.get(Ft);
  return at([t, n.currentUser$]).pipe(
    lt(([i, o]) => i ? i.activeSheet$.pipe(
      lt((s) => {
        if (!s)
          return Ce(!0);
        const l = r.get($e), a = r.get(ft), c = r.get(Q);
        return St(
          c.selectionMoveEnd$,
          l.ruleChange$,
          a.ruleChange$
        ).pipe(
          Be(() => {
            const d = i.getUnitId(), u = s.getSheetId(), h = l.getSubunitRuleList(d, u), g = c.getCurrentSelections(), m = g == null ? void 0 : g.map((p) => p.range), f = h.map((p) => p.ranges).flat();
            if (!m)
              return !1;
            const v = a.getRule(d, u);
            return v != null && v.permissionId ? !0 : m == null ? void 0 : m.some((p) => f.some((S) => se.intersects(p, S)));
          })
        );
      })
    ) : Ce(!0))
  );
}
function e_(r) {
  const e = r.get(k), t = r.get($e), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        if (!l)
          return Ce(!0);
        const a = r.get($e), c = r.get(ft), d = r.get(rt), u = r.get(Q);
        return St(
          u.selectionMoveEnd$,
          a.ruleChange$,
          c.ruleChange$
        ).pipe(
          Be(() => {
            var M, E;
            const h = o.getUnitId(), g = l.getSheetId(), m = t.getSubunitRuleList(h, g), f = (M = u.getCurrentSelections()) == null ? void 0 : M.map((T) => T.range);
            if (m.map((T) => T.ranges).flat(), !(f != null && f.length) || f.length > 1)
              return !0;
            const v = f[0];
            if ((v == null ? void 0 : v.rangeType) === z.ALL || (v == null ? void 0 : v.rangeType) === z.COLUMN || (v == null ? void 0 : v.rangeType) === z.ROW)
              return !0;
            const p = c.getRule(h, g);
            if (p != null && p.permissionId)
              return ((E = d.getPermissionPoint(new Kv(h, g).id)) == null ? void 0 : E.value) === !1;
            if (m.filter((T) => T.ranges.some((P) => se.intersects(P, v))).length !== 1)
              return !0;
            const { startRow: w, endRow: C, startColumn: I, endColumn: R } = v, y = r.get(Zo);
            for (let T = w; T <= C; T++)
              for (let P = I; P <= R; P++) {
                const H = y.getCellInfo(h, g, T, P);
                if (H)
                  return H[Co.ManageCollaborator] === !1;
              }
            return !1;
          })
        );
      })
    ) : Ce(!0))
  );
}
function t_(r) {
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        var m;
        if (!l)
          return Ce(!0);
        const a = o.getUnitId(), c = r.get(Q), d = r.get($e), u = r.get(ft), h = (m = t.composePermission$([new K(a).id]).pipe(Be((f) => f.every((v) => v.value)))) != null ? m : Ce(!1), g = St(
          d.ruleChange$,
          u.ruleChange$
        ).pipe(
          xt(null)
        );
        return at([h, g, c.selectionMoveEnd$]).pipe(
          Be(([f, v, p]) => {
            if (!f)
              return !0;
            const S = c.getCurrentSelections(), w = S == null ? void 0 : S.map((C) => C.range);
            return w != null && w.length ? w.length > 1 : !1;
          })
        );
      })
    ) : Ce(!0))
  );
}
function xf(r) {
  var c;
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft), o = r.has(qe) ? r.get(qe) : null, l = r.get(De).subscribeContextValue$(Ot).pipe(
    xt(!1),
    Ou(1)
  ), a = (c = o == null ? void 0 : o.visible$.pipe(
    xt(null),
    Ou(1)
  )) != null ? c : Ce(null);
  return at([n, i.currentUser$, a, l]).pipe(
    lt(([d, u, h, g]) => !d || h != null && h.visible && h.unitId === d.getUnitId() || g ? Ce(!0) : d.activeSheet$.pipe(
      lt((m) => {
        var M;
        if (!m)
          return Ce(!0);
        const v = r.get(De).subscribeContextValue$(Dl).pipe(xt(!1)), p = d.getUnitId(), S = m.getSheetId(), w = r.get($e), C = r.get(ft), I = r.get(Q), R = (M = t.composePermission$([new Kl(p).id]).pipe(Be((E) => E.every((T) => T.value)))) != null ? M : Ce(!1), y = St(
          w.ruleChange$,
          C.ruleChange$
        ).pipe(
          xt(null)
        );
        return at([R, y, I.selectionMoveEnd$, v]).pipe(
          Be(([E, T, P, H]) => {
            if (!E || H)
              return !0;
            const A = I.getCurrentSelections(), x = A == null ? void 0 : A.map((B) => B.range);
            if (!(x != null && x.length))
              return !0;
            const V = C.getRule(p, S);
            if (V != null && V.permissionId)
              return !0;
            const D = w.getSubunitRuleList(p, S);
            return x == null ? void 0 : x.some((B) => D.some((j) => j.ranges.some((G) => se.intersects(B, G))));
          })
        );
      })
    ))
  );
}
function n_(r) {
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        var m;
        if (!l)
          return Ce(!0);
        const a = o.getUnitId(), c = l.getSheetId(), d = r.get($e), u = r.get(ft), h = (m = t.composePermission$([new Kl(a).id]).pipe(Be((f) => f.every((v) => v.value)))) != null ? m : Ce(!1), g = St(
          d.ruleChange$,
          u.ruleChange$
        ).pipe(
          xt(null)
        );
        return at([h, g]).pipe(
          Be(([f, v]) => {
            var w;
            if (!f) return !0;
            const p = u.getRule(a, c);
            return p != null && p.permissionId ? !0 : ((w = d.getSubunitRuleList(a, c)) == null ? void 0 : w.filter((C) => C == null ? void 0 : C.permissionId)).length > 0;
          })
        );
      })
    ) : Ce(!0))
  );
}
function r_(r) {
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        if (!l)
          return Ce(!0);
        const a = o.getUnitId(), c = l.getSheetId(), d = r.get(ft);
        return d.ruleChange$.pipe(xt(null)).pipe(
          Be(() => {
            var h;
            return d.getRule(a, c) ? ((h = t.getPermissionPoint(new Wg(a, c).id)) == null ? void 0 : h.value) === !1 : !0;
          })
        );
      })
    ) : Ce(!0))
  );
}
function i_(r) {
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        var m;
        if (!l)
          return Ce(!0);
        const a = o.getUnitId(), c = r.get($e), d = r.get(ft), u = (m = t.composePermission$([new Kl(a).id, new Cg(a).id]).pipe(Be((f) => f.every((v) => v.value)))) != null ? m : Ce(!1), h = d.ruleChange$.pipe(xt(null)), g = c.ruleChange$.pipe(xt(null));
        return at([u, h, g]).pipe(
          Be(([f, v, p]) => {
            if (!f)
              return !0;
            const S = l.getSheetId(), w = d.getRule(a, S), C = c.getSubunitRuleList(a, S);
            return !(w || C.length);
          })
        );
      })
    ) : Ce(!0))
  );
}
function o_(r) {
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft);
  return at([n, i.currentUser$]).pipe(
    lt(([o, s]) => o ? o.activeSheet$.pipe(
      lt((l) => {
        if (!l)
          return Ce(!0);
        const a = o.getUnitId(), c = l.getSheetId(), d = r.get(Q), u = r.get($e), h = r.get(ft), g = St(
          u.ruleChange$,
          h.ruleChange$,
          d.selectionMoveEnd$
        ).pipe(xt(null));
        return at([g]).pipe(
          Be(([m]) => {
            var E;
            const f = r.get(Q).getCurrentSelections(), v = f == null ? void 0 : f.map((T) => T.range);
            if (!(v != null && v.length) || v.length > 1)
              return !0;
            const p = v[0];
            if ((p == null ? void 0 : p.rangeType) === z.ALL || (p == null ? void 0 : p.rangeType) === z.COLUMN || (p == null ? void 0 : p.rangeType) === z.ROW)
              return !0;
            const S = h.getRule(a, c);
            if (S != null && S.permissionId)
              return ((E = t.getPermissionPoint(new Wg(a, c).id)) == null ? void 0 : E.value) === !1;
            if (u.getSubunitRuleList(a, c).filter((T) => T.ranges.some((P) => se.intersects(P, p))).length !== 1)
              return !0;
            const { startRow: C, endRow: I, startColumn: R, endColumn: y } = p, M = r.get(Zo);
            for (let T = C; T <= I; T++)
              for (let P = R; P <= y; P++) {
                const H = M.getCellInfo(a, c, T, P);
                if (H)
                  return H[Co.Delete] === !1;
              }
            return !1;
          })
        );
      })
    ) : Ce(!0))
  );
}
function Of(r) {
  var c;
  const e = r.get(k), t = r.get(rt), n = e.getCurrentTypeOfUnit$(O.UNIVER_SHEET), i = r.get(Ft), o = r.has(qe) ? r.get(qe) : null, l = r.get(De).subscribeContextValue$(Ot), a = (c = o == null ? void 0 : o.visible$) != null ? c : Ce(null);
  return at([n, i.currentUser$, a, l]).pipe(
    lt(([d, u, h, g]) => !d || h != null && h.visible && h.unitId === d.getUnitId() || g ? Ce(!0) : d.activeSheet$.pipe(
      lt((m) => {
        var p, S;
        if (!m)
          return Ce(!0);
        const f = d.getUnitId();
        return ((S = (p = t.getPermissionPoint$(new K(f).id)) == null ? void 0 : p.pipe(Be((w) => !!w.value))) != null ? S : Ce(!1)).pipe(
          Be((w) => !w)
        );
      })
    ))
  );
}
const Ns = "sheet.contextMenu.permission";
function s_(r) {
  return {
    id: ma.id,
    type: $.BUTTON,
    icon: Om,
    tooltip: "permission.toolbarMenu",
    hidden$: ce(r, O.UNIVER_SHEET),
    disabled$: xf(r)
  };
}
function tc(r) {
  return {
    id: Ns,
    type: $.SUBITEMS,
    title: "rightClick.protectRange",
    icon: Am,
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function nc(r) {
  return {
    id: ii.id,
    type: $.BUTTON,
    title: "rightClick.turnOnProtectRange",
    hidden$: $b(r),
    disabled$: xf(r)
  };
}
function rc(r) {
  return {
    id: li.id,
    type: $.BUTTON,
    title: "rightClick.editProtectRange",
    disabled$: t_(r),
    hidden$: e_(r)
  };
}
function ic(r) {
  return {
    id: si.id,
    type: $.BUTTON,
    title: "rightClick.removeProtectRange",
    disabled$: o_(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function oc(r) {
  return {
    id: oi.id,
    type: $.BUTTON,
    title: "rightClick.viewAllProtectArea",
    disabled$: Of(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function l_(r) {
  return {
    id: fa.id,
    type: $.BUTTON,
    title: "sheetConfig.addProtectSheet",
    disabled$: n_(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function a_(r) {
  return {
    id: ya.id,
    type: $.BUTTON,
    title: "sheetConfig.removeProtectSheet",
    disabled$: r_(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function c_(r) {
  return {
    id: Ma.id,
    type: $.BUTTON,
    title: "sheetConfig.changeSheetPermission",
    disabled$: i_(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function d_(r) {
  return {
    id: pa.id,
    type: $.BUTTON,
    title: "sheetConfig.viewAllProtectArea",
    disabled$: Of(r),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function u_(r) {
  const e = r.get(k), t = r.get(W), n = new Fe((o) => {
    const s = t.onCommandExecuted((l) => {
      const a = l.id;
      (a === On.id || a === xr.id || a === nr.id) && ml(e, o);
    });
    return ml(e, o), s.dispose;
  }), i = Yi(r, [K, Jv]);
  return {
    id: Sa.id,
    type: $.BUTTON,
    title: "sheetConfig.delete",
    disabled$: at([n, i]).pipe(
      Be(([o, s]) => o || s)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function h_(r) {
  return {
    id: Ug.id,
    type: $.BUTTON,
    title: "sheetConfig.copy",
    disabled$: Yi(r, [K, bg]),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function g_(r) {
  return {
    id: Ta.id,
    type: $.BUTTON,
    title: "sheetConfig.rename",
    disabled$: Yi(r, [K, wg]),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function m_(r) {
  return {
    id: Fg.id,
    title: "sheetConfig.changeColor",
    type: $.SELECTOR,
    selections: [
      {
        label: {
          name: xd,
          hoverable: !1
        }
      }
    ],
    hidden$: Yi(r, [K])
  };
}
function f_(r) {
  const e = r.get(k), t = r.get(W);
  return {
    id: Bg.id,
    type: $.BUTTON,
    title: "sheetConfig.hide",
    disabled$: new Fe((n) => {
      const i = t.onCommandExecuted((o) => {
        const s = o.id;
        (s === On.id || s === xr.id || s === nr.id) && ml(e, n);
      });
      return ml(e, n), i.dispose;
    }).pipe(
      or(Yi(r, [K, Xg])),
      Be(([n, i]) => n || i)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function p_(r) {
  const e = r.get(k), t = r.get(W);
  return {
    id: Ia.id,
    type: $.BUTTON,
    title: "sheetConfig.unhide",
    disabled$: new Fe((n) => {
      function i() {
        const s = e.getCurrentUnitForType(O.UNIVER_SHEET).getWorksheets(), l = Array.from(s.values());
        n.next(l.length === 1);
      }
      const o = t.onCommandExecuted((s) => {
        const l = s.id;
        (l === On.id || l === xr.id || l === nr.id) && i();
      });
      return i(), o.dispose;
    }).pipe(
      or(Yi(r, [K, Xg])),
      Be(([n, i]) => n || i)
    ),
    hidden$: ce(r, O.UNIVER_SHEET)
  };
}
function ml(r, e) {
  const t = r.getCurrentUnitForType(O.UNIVER_SHEET).getWorksheets(), n = Array.from(t.values()).filter(
    (i) => i.getConfig().hidden === Ke.FALSE
  );
  e.next(n.length === 1);
}
const v_ = {
  [dC.START]: {
    [vs.HISTORY]: {
      [rs.id]: {
        order: 2,
        menuItemFactory: bb
      },
      [io.id]: {
        order: 3,
        menuItemFactory: _s
      }
    },
    [vs.FORMAT]: {
      [ha.id]: {
        order: 1,
        menuItemFactory: Mb
      },
      [ua.id]: {
        order: 2,
        menuItemFactory: Eb
      },
      // TODO: fontsize +
      // TODO: fontsize -
      [Bi.id]: {
        order: 5,
        menuItemFactory: _b
      },
      [Fi.id]: {
        order: 6,
        menuItemFactory: Rb
      },
      [Ui.id]: {
        order: 7,
        menuItemFactory: Ib
      },
      [Xi.id]: {
        order: 8,
        menuItemFactory: yb
      },
      [Io.id]: {
        order: 9,
        menuItemFactory: Pb,
        [rS.id]: {
          order: 0,
          menuItemFactory: Tb
        }
      },
      [zs.id]: {
        order: 10,
        menuItemFactory: Ob,
        [Dg.id]: {
          order: 0,
          menuItemFactory: xb
        }
      },
      [Tc.id]: {
        order: 11,
        menuItemFactory: sb
      }
    },
    [vs.LAYOUT]: {
      [Ac.id]: {
        order: 0,
        menuItemFactory: Ab
      },
      [Oc.id]: {
        order: 3,
        menuItemFactory: Hb
      },
      [xc.id]: {
        order: 6,
        menuItemFactory: Vb
      },
      [Pc.id]: {
        order: 7,
        menuItemFactory: Nb
      },
      [$v.id]: {
        order: 8,
        menuItemFactory: Gb,
        [nS.id]: {
          order: 0,
          menuItemFactory: qb
        },
        [tS.id]: {
          order: 1,
          menuItemFactory: Qb
        },
        [eS.id]: {
          order: 2,
          menuItemFactory: Kb
        },
        [Lg.id]: {
          order: 3,
          menuItemFactory: Jb
        }
      }
    },
    [vs.OTHERS]: {
      [ma.id]: {
        order: 0,
        menuItemFactory: s_
      }
    }
  },
  [_t.MAIN_AREA]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [hn.name]: {
        order: 2,
        menuItemFactory: Za
      },
      [Vs]: {
        order: 3,
        menuItemFactory: Ga,
        [go.id]: {
          order: 0,
          menuItemFactory: qa
        },
        [mo.id]: {
          order: 1,
          menuItemFactory: Qa
        },
        [ri.id]: {
          order: 2,
          menuItemFactory: Ka
        },
        [fo.id]: {
          order: 3,
          menuItemFactory: Ja
        }
      },
      [Hs]: {
        order: 4,
        menuItemFactory: za,
        [pr.id]: {
          order: 0,
          menuItemFactory: ja
        },
        [uo.id]: {
          order: 1,
          menuItemFactory: Ya
        },
        [io.id]: {
          order: 2,
          menuItemFactory: _s
        }
      }
    },
    [Qe.LAYOUT]: {
      order: 1,
      [Mf]: {
        order: 0,
        menuItemFactory: ub,
        [Tg.id]: {
          order: 0,
          menuItemFactory: hb
        },
        [Eg.id]: {
          order: 1,
          menuItemFactory: gb
        },
        [ns.id]: {
          order: 2,
          menuItemFactory: mb
        },
        [vi.id]: {
          order: 3,
          menuItemFactory: fb
        }
      },
      [If]: {
        order: 0,
        menuItemFactory: lb,
        [Eo.id]: {
          order: 0,
          menuItemFactory: _h
        },
        [Mo.id]: {
          order: 1,
          menuItemFactory: Rh
        },
        [ts.id]: {
          order: 2,
          menuItemFactory: ab
        },
        [pi.id]: {
          order: 3,
          menuItemFactory: cb
        }
      },
      [Ef]: {
        order: 2,
        menuItemFactory: Lb,
        [$n.id]: {
          order: 0,
          menuItemFactory: $a
        },
        [ba.id]: {
          order: 1,
          menuItemFactory: Wb
        },
        [_a.id]: {
          order: 2,
          menuItemFactory: Bb
        },
        [xs.id]: {
          order: 3,
          menuItemFactory: ec
        }
      },
      [Ns]: {
        order: 3,
        menuItemFactory: tc,
        [ii.id]: {
          order: 0,
          menuItemFactory: nc
        },
        [li.id]: {
          order: 1,
          menuItemFactory: rc
        },
        [si.id]: {
          order: 2,
          menuItemFactory: ic
        },
        [oi.id]: {
          order: 3,
          menuItemFactory: oc
        }
      }
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  },
  [_t.COL_HEADER]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [hn.name]: {
        order: 2,
        menuItemFactory: Za
      },
      [Vs]: {
        order: 3,
        menuItemFactory: Ga,
        [go.id]: {
          order: 0,
          menuItemFactory: qa
        },
        [mo.id]: {
          order: 1,
          menuItemFactory: Qa
        },
        [ri.id]: {
          order: 2,
          menuItemFactory: Ka
        },
        [fo.id]: {
          order: 3,
          menuItemFactory: Ja
        }
      },
      [Hs]: {
        order: 4,
        menuItemFactory: za,
        [pr.id]: {
          order: 0,
          menuItemFactory: ja
        },
        [uo.id]: {
          order: 1,
          menuItemFactory: Ya
        },
        [io.id]: {
          order: 2,
          menuItemFactory: _s
        }
      }
    },
    [Qe.LAYOUT]: {
      order: 1,
      [Mg.id]: {
        order: 0,
        menuItemFactory: Sb
      },
      [yg.id]: {
        order: 0,
        menuItemFactory: Cb
      },
      [da.id]: {
        order: 1,
        menuItemFactory: Ub
      },
      [kg.id]: {
        order: 2,
        menuItemFactory: zb
      },
      [Eo.id]: {
        order: 2,
        menuItemFactory: _h
      },
      [Hg.id]: {
        order: 3,
        menuItemFactory: Yb
      },
      [is.id]: {
        order: 4,
        menuItemFactory: Db
      },
      [Gc]: {
        order: 5,
        menuItemFactory: Th,
        [$n.id]: {
          order: 0,
          menuItemFactory: $a
        },
        [xs.id]: {
          order: 3,
          menuItemFactory: ec
        }
      },
      [Ns]: {
        order: 6,
        menuItemFactory: tc,
        [ii.id]: {
          order: 0,
          menuItemFactory: nc
        },
        [li.id]: {
          order: 1,
          menuItemFactory: rc
        },
        [si.id]: {
          order: 2,
          menuItemFactory: ic
        },
        [oi.id]: {
          order: 3,
          menuItemFactory: oc
        }
      }
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  },
  [_t.ROW_HEADER]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      },
      // [SheetCutCommand.name]: {
      //     order: 1,
      //     menuItemFactory: CutMenuItemFactory,
      // },
      [hn.name]: {
        order: 2,
        menuItemFactory: Za
      },
      [Vs]: {
        order: 3,
        menuItemFactory: Ga,
        [go.id]: {
          order: 0,
          menuItemFactory: qa
        },
        [mo.id]: {
          order: 1,
          menuItemFactory: Qa
        },
        [ri.id]: {
          order: 2,
          menuItemFactory: Ka
        },
        [fo.id]: {
          order: 3,
          menuItemFactory: Ja
        }
      },
      [Hs]: {
        order: 4,
        menuItemFactory: za,
        [pr.id]: {
          order: 0,
          menuItemFactory: ja
        },
        [uo.id]: {
          order: 1,
          menuItemFactory: Ya
        },
        [io.id]: {
          order: 2,
          menuItemFactory: _s
        }
      }
    },
    [Qe.LAYOUT]: {
      order: 1,
      [Ig.id]: {
        order: 0,
        menuItemFactory: vb
      },
      [Rg.id]: {
        order: 1,
        menuItemFactory: pb
      },
      [Mo.id]: {
        order: 1,
        menuItemFactory: Rh
      },
      [ca.id]: {
        order: 2,
        menuItemFactory: Fb
      },
      [Ag.id]: {
        order: 2,
        menuItemFactory: Xb
      },
      [Pg.id]: {
        order: 3,
        menuItemFactory: jb
      },
      [wd.id]: {
        order: 4,
        menuItemFactory: kb
      },
      [Gc]: {
        order: 5,
        menuItemFactory: Th,
        [$n.id]: {
          order: 0,
          menuItemFactory: $a
        },
        [xs.id]: {
          order: 3,
          menuItemFactory: ec
        }
      },
      [Ns]: {
        order: 6,
        menuItemFactory: tc,
        [ii.id]: {
          order: 0,
          menuItemFactory: nc
        },
        [li.id]: {
          order: 1,
          menuItemFactory: rc
        },
        [si.id]: {
          order: 2,
          menuItemFactory: ic
        },
        [oi.id]: {
          order: 3,
          menuItemFactory: oc
        }
      }
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  },
  [_t.FOOTER_TABS]: {
    [Qe.OTHERS]: {
      order: 0,
      [Sa.id]: {
        order: 0,
        menuItemFactory: u_
      },
      [Ug.id]: {
        order: 1,
        menuItemFactory: h_
      },
      [Ta.id]: {
        order: 2,
        menuItemFactory: g_
      },
      [Fg.id]: {
        order: 3,
        menuItemFactory: m_
      },
      [Bg.id]: {
        order: 4,
        menuItemFactory: f_
      },
      // [SetWorksheetShowCommand.id]: {
      //     order: 5,
      //     menuItemFactory: UnHideSheetMenuItemFactory,
      // },
      [Ia.id]: {
        order: 6,
        menuItemFactory: p_
      },
      [fa.id]: {
        order: 7,
        menuItemFactory: l_
      },
      [ya.id]: {
        order: 8,
        menuItemFactory: a_
      },
      [Ma.id]: {
        order: 9,
        menuItemFactory: c_
      },
      [pa.id]: {
        order: 10,
        menuItemFactory: d_
      }
    }
  },
  [_t.FOOTER_MENU]: {
    [Qe.OTHERS]: {
      [_g.id]: {
        order: 1,
        menuItemFactory: db
      }
    }
  }
}, sc = "UNIVER_SHEET_PERMISSION_ALERT_DIALOG_ID", Af = "UNIVER_SHEET_PERMISSION_ALERT_DIALOG";
var S_ = Object.getOwnPropertyDescriptor, C_ = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? S_(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, bn = (r, e) => (t, n) => e(t, n, r);
let Ii = class extends oe {
  constructor(e, t, n, i, o, s, l, a, c) {
    super();
    _(this, "disposableCollection", new ht());
    this._commandService = e, this._univerInstanceService = t, this._permissionService = n, this._dialogService = i, this._rangeProtectionRuleModel = o, this._autoFillService = s, this._localeService = l, this._contextService = a, this._sheetPermissionCheckController = c, this._initialize(), this._initUIEvent();
  }
  _initUIEvent() {
    this.disposeWithMe(
      this._sheetPermissionCheckController.triggerPermissionUIEvent$.subscribe((e) => {
        this._haveNotPermissionHandle(e);
      })
    );
  }
  _haveNotPermissionHandle(e) {
    const t = {
      id: sc,
      title: { title: "permission.dialog.alert" },
      children: {
        label: Af,
        errorMsg: e
      },
      width: 320,
      destroyOnClose: !0,
      showOk: !0,
      onClose: () => {
        this._dialogService.close(sc);
      },
      onOk: () => {
        this._dialogService.close(sc);
      },
      className: "sheet-permission-user-dialog"
    };
    this._permissionService.getShowComponents() && this._dialogService.open(t);
  }
  _getPermissionCheck(e, t) {
    var o, s;
    let n = !0, i = "";
    switch (e) {
      case ov.id:
      case iv.id:
        if (this._contextService.getContextValue(Ll) === !0)
          break;
        n = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [K],
          rangeTypes: [ie],
          worksheetTypes: [qt, te]
        }), i = this._localeService.t("permission.dialog.editErr");
        break;
      case tt.id:
        if (t.visible === !1)
          break;
        n = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [K],
          rangeTypes: [ie],
          worksheetTypes: [qt, te]
        }), i = this._localeService.t("permission.dialog.editErr");
        break;
      case ri.id:
        n = this._sheetPermissionCheckController.permissionCheckWithoutRange({
          workbookTypes: [K],
          rangeTypes: [ie],
          worksheetTypes: [te, Ar]
        }), i = this._localeService.t("permission.dialog.pasteErr");
        break;
      case Xc.id:
        n = this._permissionCheckByPaste(t), i = this._localeService.t("permission.dialog.pasteErr");
        break;
      case wa.id:
        n = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [K],
          rangeTypes: [ie],
          worksheetTypes: [te, qt, Ze]
        }), i = this._localeService.t("permission.dialog.commonErr");
        break;
      case zs.id:
      case Bi.id:
      case Fi.id:
      case Ui.id:
      case Xi.id:
        n = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [K],
          rangeTypes: [ie],
          worksheetTypes: [Ze, te]
        }), i = this._localeService.t("permission.dialog.setStyleErr");
        break;
      case un.id:
        n = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [oo],
          rangeTypes: [Hc],
          worksheetTypes: [js]
        }), i = this._localeService.t("permission.dialog.copyErr"), (o = this._permissionService.getPermissionPoint(new oo(this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId()).id)) != null && o.value || (i = this._localeService.t("permission.dialog.workbookCopyErr"));
        break;
      case Yd.id:
        n = this._sheetPermissionCheckController.permissionCheckWithRanges({
          workbookTypes: [oo, K],
          rangeTypes: [Hc, ie],
          worksheetTypes: [js, te]
        }), i = this._localeService.t("permission.dialog.copyErr"), (s = this._permissionService.getPermissionPoint(new oo(this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getUnitId()).id)) != null && s.value || (i = this._localeService.t("permission.dialog.workbookCopyErr"));
        break;
      case gr.id:
        n = this._permissionCheckByAutoFillCommand(t), i = this._localeService.t("permission.dialog.autoFillErr");
        break;
    }
    n || this._sheetPermissionCheckController.blockExecuteWithoutPermission(i);
  }
  _initialize() {
    this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._commandService.beforeCommandExecuted((e) => {
        this._getPermissionCheck(e.id, e == null ? void 0 : e.params);
      })
    );
  }
  _permissionCheckByPaste(e) {
    return e.value === et.SPECIAL_PASTE_VALUE || e.value === et.SPECIAL_PASTE_FORMULA ? this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [K],
      rangeTypes: [ie],
      worksheetTypes: [Ze, te]
    }) : e.value === et.SPECIAL_PASTE_FORMAT ? this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [K],
      rangeTypes: [ie],
      worksheetTypes: [Ze, te]
    }) : this._sheetPermissionCheckController.permissionCheckWithRanges({
      workbookTypes: [K],
      rangeTypes: [ie],
      worksheetTypes: [qt, Ze, te]
    });
  }
  _permissionCheckByAutoFillCommand(e) {
    if (!e)
      return !1;
    const { targetRange: t } = e, n = Xe(this._univerInstanceService);
    if (!n)
      return !1;
    const { worksheet: i, unitId: o, subUnitId: s } = n;
    return !this._rangeProtectionRuleModel.getSubunitRuleList(o, s).reduce((c, d) => [...c, ...d.ranges], []).filter((c) => se.intersects(c, t)).some((c) => {
      var d, u;
      for (let h = c.startRow; h <= c.endRow; h++)
        for (let g = c.startColumn; g <= c.endColumn; g++) {
          const m = (u = (d = i.getCell(h, g)) == null ? void 0 : d.selectionProtection) == null ? void 0 : u[0];
          if ((m == null ? void 0 : m[ae.Edit]) === !1)
            return !0;
        }
      return !1;
    });
  }
};
Ii = C_([
  bn(0, W),
  bn(1, k),
  bn(2, rt),
  bn(3, Qo),
  bn(4, N($e)),
  bn(5, Hr),
  bn(6, N(xe)),
  bn(7, De),
  bn(8, N(bd))
], Ii);
var w_ = Object.getOwnPropertyDescriptor, b_ = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? w_(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, dr = (r, e) => (t, n) => e(t, n, r);
const __ = "__SpreadsheetFreezeRowMainName__", R_ = "__SpreadsheetFreezeRowHeaderName__", I_ = "__SpreadsheetFreezeColumnMainName__", y_ = "__SpreadsheetFreezeColumnHeaderName__", lc = 2, M_ = 0.01, Qi = Nn("freezePermissionCheck");
let Vo = class extends oe {
  constructor(e, t, n, i, o, s, l, a) {
    super();
    _(this, "_rowFreezeHeaderRect");
    _(this, "_rowFreezeMainRect");
    _(this, "_columnFreezeHeaderRect");
    _(this, "_columnFreezeMainRect");
    _(this, "_freezeDownSubs");
    _(this, "_freezePointerEnterSubs");
    _(this, "_freezePointerLeaveSubs");
    _(this, "_scenePointerMoveSub");
    _(this, "_scenePointerUpSub");
    _(this, "_changeToRow", -1);
    _(this, "_changeToColumn", -1);
    _(this, "_changeToOffsetX", 0);
    _(this, "_changeToOffsetY", 0);
    _(this, "_activeViewport", null);
    _(this, "_freezeNormalHeaderColor", "");
    _(this, "_freezeNormalMainColor", "");
    _(this, "_freezeActiveColor", "");
    _(this, "_freezeHoverColor", "");
    _(this, "_lastFreeze");
    _(this, "interceptor", new ki({ FREEZE_PERMISSION_CHECK: Qi }));
    this._context = e, this._sheetSkeletonManagerService = t, this._commandService = n, this._selectionManagerService = i, this._scrollManagerService = o, this._themeService = s, this._sheetInterceptorService = l, this._injector = a, this._initialize();
  }
  dispose() {
    super.dispose();
  }
  _initialize() {
    this._skeletonListener(), this._commandExecutedListener(), this._themeChangeListener(), this._interceptorCommands(), this._bindViewportScroll(), this._zoomRefresh();
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _createFreeze(e = 0, t) {
    var y;
    const n = t != null ? t : this._getFreeze();
    if (n == null) return null;
    const i = (y = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y.skeleton, { startRow: o, startColumn: s } = n, l = this._getPositionByIndex(o, s);
    if (l == null || i == null) return null;
    const a = this._getSheetObject(), c = a.engine, d = (c == null ? void 0 : c.width) || 0, u = (c == null ? void 0 : c.height) || 0, h = a.scene, { startX: g, startY: m } = l, { rowTotalHeight: f, columnTotalWidth: v, rowHeaderWidthAndMarginLeft: p, columnHeaderHeightAndMarginTop: S } = i, w = d > v + p ? d : v + S, C = u > f + S ? u : f + S;
    this._changeToRow = o, this._changeToColumn = s, this._changeToOffsetX = g, this._changeToOffsetY = m;
    const I = Math.max(h.scaleX, h.scaleY);
    let R = lc / Math.max(1, I);
    if (e === 0) {
      (o === -1 || o === 0) && (R = R * 2);
      const M = R;
      this._rowFreezeHeaderRect = new Se(R_, {
        fill: this._freezeNormalHeaderColor,
        width: p,
        height: R,
        left: 0,
        top: m - M,
        zIndex: 3
      });
      let E = this._freezeNormalHeaderColor;
      (o === -1 || o === 0) && (E = this._freezeNormalMainColor), this._rowFreezeMainRect = new Se(__, {
        fill: E,
        width: w * 2 / I,
        height: R,
        left: p,
        top: m - M,
        zIndex: 3
      }), h.addObjects([this._rowFreezeHeaderRect, this._rowFreezeMainRect], rr);
    } else {
      (s === -1 || s === 0) && (R = R * 2);
      const M = R;
      this._columnFreezeHeaderRect = new Se(y_, {
        fill: this._freezeNormalHeaderColor,
        width: R,
        height: S,
        left: g - M,
        top: 0,
        zIndex: 3
      });
      let E = this._freezeNormalHeaderColor;
      (s === -1 || s === 0) && (E = this._freezeNormalMainColor), this._columnFreezeMainRect = new Se(I_, {
        fill: E,
        width: R,
        height: C * 2 / I,
        left: g - M,
        top: S,
        zIndex: 3
      }), h.addObjects([this._columnFreezeHeaderRect, this._columnFreezeMainRect], rr);
    }
    this._eventBinding(e);
  }
  // eslint-disable-next-line max-lines-per-function
  _eventBinding(e = 0) {
    let t = this._rowFreezeHeaderRect, n = this._rowFreezeMainRect;
    e === 1 && (t = this._columnFreezeHeaderRect, n = this._columnFreezeMainRect);
    const i = this._getSheetObject();
    if (i == null)
      return;
    const { scene: o } = i;
    if (this._freezePointerEnterSubs = new Kn(), this._freezePointerLeaveSubs = new Kn(), this._freezeDownSubs = new Kn(), n) {
      const a = n.onPointerEnter$.subscribeEvent(() => {
        if (!this.interceptor.fetchThroughInterceptors(Qi)(!0, null))
          return !1;
        t == null || t.setProps({
          fill: this._freezeHoverColor,
          zIndex: 4
        }), o.setCursor(ye.GRAB);
      });
      this._freezePointerEnterSubs.add(a);
      const c = n.onPointerLeave$.subscribeEvent(() => {
        t == null || t.setProps({
          fill: this._freezeNormalHeaderColor,
          zIndex: 3
        }), o.resetCursor();
      });
      this._freezePointerLeaveSubs.add(c);
    }
    if (t) {
      const a = t.onPointerEnter$.subscribeEvent(() => {
        if (!this.interceptor.fetchThroughInterceptors(Qi)(!0, null))
          return !1;
        t == null || t.setProps({
          fill: this._freezeHoverColor,
          zIndex: 4
        }), o.setCursor(ye.GRAB);
      });
      this._freezePointerEnterSubs.add(a);
      const c = t.onPointerLeave$.subscribeEvent(() => {
        t == null || t.setProps({
          fill: this._freezeNormalHeaderColor,
          zIndex: 3
        }), o.resetCursor();
      });
      this._freezePointerLeaveSubs.add(c);
    }
    const s = t == null ? void 0 : t.onPointerDown$.subscribeEvent((a) => {
      this._freezeDown(a, t, n, e);
    });
    s && this._freezeDownSubs.add(s);
    const l = n == null ? void 0 : n.onPointerDown$.subscribeEvent((a) => {
      this._freezeDown(a, t, n, e);
    });
    l && this._freezeDownSubs.add(l);
  }
  // eslint-disable-next-line complexity
  _getCurrentLastVisible() {
    var v, p, S, w, C, I, R;
    const e = this._getSheetObject();
    if (e == null)
      return;
    const t = (v = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : v.skeleton;
    if (t == null)
      return;
    const n = e.scene, i = Math.max(n.scaleX, n.scaleY), o = this._scrollManagerService.getCurrentScrollState(), s = (e.engine.height - t.columnHeaderHeight) / i, l = (e.engine.width - t.rowHeaderWidth) / i, a = (p = o == null ? void 0 : o.sheetViewStartRow) != null ? p : 0, c = a === 0 ? -((S = o == null ? void 0 : o.offsetY) != null ? S : 0) : t.rowHeightAccumulation[a - 1] - ((w = o == null ? void 0 : o.offsetY) != null ? w : 0);
    let d = 0, u = !1;
    for (let y = a, M = t.rowHeightAccumulation.length; y < M; y++)
      if (t.rowHeightAccumulation[y] - c > s) {
        d = y, u = !0;
        break;
      }
    u || (d = t.rowHeightAccumulation.length - 1);
    const h = (C = o == null ? void 0 : o.sheetViewStartColumn) != null ? C : 0, g = h === 0 ? -((I = o == null ? void 0 : o.offsetX) != null ? I : 0) : t.columnWidthAccumulation[h - 1] - ((R = o == null ? void 0 : o.offsetX) != null ? R : 0);
    let m = 0, f = !1;
    for (let y = h, M = t.columnWidthAccumulation.length; y < M; y++)
      if (t.columnWidthAccumulation[y] - g > l) {
        m = y, f = !0;
        break;
      }
    return f || (m = t.columnWidthAccumulation.length - 1), { lastRow: d, lastColumn: m };
  }
  _getActiveViewport(e) {
    var n;
    const t = (n = this._getSheetObject()) == null ? void 0 : n.scene.getViewports();
    return t && t.find((i) => i.isHit(new ke(e.offsetX, e.offsetY))) || null;
  }
  // eslint-disable-next-line max-lines-per-function
  _freezeDown(e, t, n, i = 0) {
    var g;
    const o = (g = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : g.skeleton;
    if (o == null)
      return;
    const s = this._getSheetObject();
    if (s == null)
      return;
    if (!this.interceptor.fetchThroughInterceptors(Qi)(!0, null))
      return !1;
    const { scene: a } = s;
    a.setCursor(ye.GRABBING), a.disableObjectsEvent();
    const c = this._getCurrentLastVisible(), d = c === void 0 ? Number.POSITIVE_INFINITY : o.rowHeightAccumulation[c.lastRow], u = c === void 0 ? Number.POSITIVE_INFINITY : o.columnWidthAccumulation[c.lastColumn - 1] + o.rowHeaderWidth;
    this._activeViewport = null;
    const h = this._getFreeze();
    h && (this._changeToColumn = h.startColumn, this._changeToRow = h.startRow), this._scenePointerMoveSub = a.onPointerMove$.subscribeEvent((m) => {
      var R, y, M, E;
      const f = this._getActiveViewport(m), { startX: v, startY: p, row: S, column: w } = Vn(
        m.offsetX,
        m.offsetY,
        a,
        o,
        f || void 0,
        !0
      );
      if (!this.interceptor.fetchThroughInterceptors(Qi)(!0, null))
        return !1;
      a.setCursor(ye.GRABBING);
      const I = lc / Math.max(a.scaleX, a.scaleY);
      i === 0 ? ((R = t.transformByState({
        top: Math.min(p, d) - I / 2
      })) == null || R.setProps({
        fill: this._freezeActiveColor
      }), (y = n.transformByState({
        top: Math.min(p, d) - I / 2
      })) == null || y.setProps({
        fill: this._freezeNormalHeaderColor
      }), this._changeToRow = c === void 0 ? S : Math.min(S, c.lastRow), this._changeToOffsetY = Math.min(p, d), this._activeViewport = f) : ((M = t.transformByState({
        left: Math.min(v, u) - I / 2
      })) == null || M.setProps({
        fill: this._freezeActiveColor
      }), (E = n.transformByState({
        left: Math.min(v, u) - I / 2
      })) == null || E.setProps({
        fill: this._freezeNormalHeaderColor
      }), this._changeToColumn = c === void 0 ? w : Math.min(w, c.lastColumn), this._changeToOffsetX = v, this._activeViewport = f);
    }), this._scenePointerUpSub = a.onPointerUp$.subscribeEvent(() => {
      var T, P;
      a.resetCursor(), a.enableObjectsEvent(), this._clearObserverEvent();
      const { rowHeaderWidthAndMarginLeft: m, columnHeaderHeightAndMarginTop: f } = o;
      i === 0 && (this._changeToRow === 0 || this._changeToRow === -1) || i === 1 && (this._changeToColumn === 0 || this._changeToColumn === -1) ? (t.setProps({
        fill: this._freezeNormalHeaderColor
      }), n.setProps({
        fill: this._freezeNormalMainColor
      })) : (t == null || t.setProps({
        fill: this._freezeNormalHeaderColor
      }), n == null || n.setProps({
        fill: this._freezeNormalHeaderColor
      }));
      const v = lc / Math.max(a.scaleX, a.scaleY);
      i === 0 ? (this._changeToRow === 0 || this._changeToRow === -1) && (t.transformByState({
        top: f - v
      }), n.transformByState({
        top: f - v
      })) : (this._changeToColumn === 0 || this._changeToColumn === -1) && (t.transformByState({
        left: m - v
      }), n.transformByState({
        left: m - v
      }));
      const p = this._scrollManagerService.getCurrentScrollState() || {
        sheetViewStartRow: 0,
        sheetViewStartColumn: 0
      }, { sheetViewStartRow: S, sheetViewStartColumn: w } = p;
      if (w == null || S == null)
        return;
      const C = this._context.unit, I = C.getActiveSheet();
      if (!I) return;
      const R = (T = I.getConfig()) == null ? void 0 : T.freeze;
      let y = (R == null ? void 0 : R.xSplit) || 0, M = (R == null ? void 0 : R.ySplit) || 0;
      const E = (P = this._activeViewport) == null ? void 0 : P.viewportKey;
      i === 0 && (!E || E === F.VIEW_LEFT_TOP || E === F.VIEW_MAIN_LEFT_TOP || E === F.VIEW_MAIN_TOP || E === F.VIEW_ROW_TOP ? M = this._changeToRow - (R.startRow - R.ySplit) : M = this._changeToRow - S, M = M < 0 ? 0 : M), i === 1 && (!E || E === F.VIEW_LEFT_TOP || E === F.VIEW_MAIN_LEFT_TOP || E === F.VIEW_MAIN_LEFT || E === F.VIEW_COLUMN_LEFT ? y = this._changeToColumn - (R.startColumn - R.xSplit) : y = this._changeToColumn - w, y = y < 0 ? 0 : y), this._commandService.executeCommand(iS.id, {
        startRow: M === 0 ? -1 : this._changeToRow,
        startColumn: y === 0 ? -1 : this._changeToColumn,
        ySplit: M,
        xSplit: y,
        unitId: C.getUnitId(),
        subUnitId: I.getSheetId()
      });
    });
  }
  _getViewports() {
    const e = this._getSheetObject();
    if (e == null)
      return;
    const { scene: t } = e, n = t.getViewport(F.VIEW_COLUMN_LEFT), i = t.getViewport(F.VIEW_COLUMN_RIGHT), o = t.getViewport(F.VIEW_ROW_TOP), s = t.getViewport(F.VIEW_ROW_BOTTOM), l = t.getViewport(F.VIEW_LEFT_TOP), a = t.getViewport(F.VIEW_MAIN), c = t.getViewport(F.VIEW_MAIN_LEFT_TOP), d = t.getViewport(F.VIEW_MAIN_LEFT), u = t.getViewport(F.VIEW_MAIN_TOP);
    if (!(n == null || i == null || o == null || s == null || l == null || a == null || c == null || d == null || u == null))
      return {
        viewMain: a,
        viewMainLeftTop: c,
        viewMainLeft: d,
        viewMainTop: u,
        viewColumnLeft: n,
        viewColumnRight: i,
        viewRowTop: o,
        viewRowBottom: s,
        viewLeftTop: l
      };
  }
  _bindViewportScroll() {
    const e = this._getViewports();
    if (!e)
      return;
    const { viewRowBottom: t, viewColumnRight: n, viewMainLeft: i, viewMainTop: o } = e;
    this.disposeWithMe(
      this._scrollManagerService.validViewportScrollInfo$.subscribe((s) => {
        if (!s) return;
        const { scrollX: l, scrollY: a, viewportScrollX: c, viewportScrollY: d } = s;
        t.isActive && t.updateScrollVal({
          scrollY: a,
          viewportScrollY: d
        }), n.isActive && n.updateScrollVal({
          scrollX: l,
          viewportScrollX: c
        }), i.isActive && i.updateScrollVal({
          scrollY: a,
          viewportScrollY: d
        }), o.isActive && o.updateScrollVal({
          scrollX: l,
          viewportScrollX: c
        });
      })
    );
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _updateViewport(e = -1, t = -1, n = 0, i = 0, o = 3) {
    var y;
    const s = (y = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y.skeleton;
    if (s == null)
      return;
    const { rowHeaderWidthAndMarginLeft: l, columnHeaderHeightAndMarginTop: a } = s, c = this._getViewports();
    if (!c)
      return;
    const {
      viewMain: d,
      viewMainLeftTop: u,
      viewMainLeft: h,
      viewMainTop: g,
      viewColumnLeft: m,
      viewColumnRight: f,
      viewRowTop: v,
      viewRowBottom: p,
      viewLeftTop: S
    } = c;
    f.resizeWhenFreezeChange({
      left: l,
      top: 0,
      // ctx.clip by the size of viewport, and selection header border is slightly below column header
      // I think it's a bad design, Should not clip for selection rendering in viewport,
      height: a + 1,
      right: 0
    }), p.resizeWhenFreezeChange({
      left: 0,
      top: a,
      bottom: 0,
      width: l + 1
    }), S.resizeWhenFreezeChange({
      left: 0,
      top: 0,
      width: l + 1,
      height: a
    });
    let w = !0, C = !0;
    u.enable(), (e === -1 || e === 0) && (w = !1), (t === -1 || t === 0) && (C = !1);
    const I = s.getNoMergeCellWithCoordByIndex(e - n, t - i, !1), R = s.getNoMergeCellWithCoordByIndex(e, t, !1);
    if (u.disable(), g.disable(), h.disable(), v.disable(), m.disable(), u.resetPadding(), g.resetPadding(), h.resetPadding(), v.resetPadding(), m.resetPadding(), w === !1 && C === !1)
      d.resizeWhenFreezeChange({
        left: l,
        top: a,
        bottom: 0,
        right: 0
      }), d.resetPadding(), h.resizeWhenFreezeChange({
        left: l,
        top: a,
        bottom: 0,
        width: 0
      }), g.resizeWhenFreezeChange({
        left: l,
        top: a,
        height: 0,
        right: 0
      }), u.resizeWhenFreezeChange({
        left: l,
        top: a,
        width: 0,
        height: 0
      }), v.resizeWhenFreezeChange({
        left: 0,
        top: a,
        width: l + 1,
        height: 0
      }), m.resizeWhenFreezeChange({
        left: 0,
        top: 0,
        height: a + 1,
        width: 0
      });
    else if (w === !0 && C === !1) {
      const M = R.startY - I.startY;
      d.resizeWhenFreezeChange({
        left: l,
        top: a + M,
        bottom: 0,
        right: 0
      }), d.setPadding({
        startY: I.startY,
        endY: R.startY,
        startX: 0,
        endX: 0
      }), o & 2 && this._commandService.executeCommand(mn.id, {
        sheetViewStartRow: 0,
        offsetY: 0
      }), g.resizeWhenFreezeChange({
        left: l,
        top: a,
        height: M,
        right: 0
      }), g.updateScrollVal({
        viewportScrollY: I.startY,
        rawScrollX: d.scrollX,
        viewportScrollX: d.viewportScrollX
      }), v.resizeWhenFreezeChange({
        left: 0,
        top: a,
        width: l + 1,
        height: M
      }), v.updateScrollVal({
        viewportScrollY: I.startY
      }), p.resizeWhenFreezeChange({
        left: 0,
        top: a + M,
        bottom: 0,
        width: l + 1
      }), g.enable(), v.enable();
    } else if (w === !1 && C === !0) {
      const M = R.startX - I.startX;
      d.resizeWhenFreezeChange({
        left: l + M,
        top: a,
        bottom: 0,
        right: 0
      }), d.setPadding({
        startX: I.startX,
        endX: R.startX,
        startY: 0,
        endY: 0
      }), o & 1 && this._commandService.executeCommand(mn.id, {
        sheetViewStartColumn: 0,
        offsetX: 0
      }), h.resizeWhenFreezeChange({
        left: l,
        top: a,
        width: M,
        bottom: 0,
        right: 0
      }), h.updateScrollVal({
        viewportScrollX: I.startX,
        rawScrollY: d.scrollY,
        viewportScrollY: d.viewportScrollY
      }), m.resizeWhenFreezeChange({
        left: l,
        top: 0,
        width: M,
        height: a + 1
      }), m.updateScrollVal({
        viewportScrollX: I.startX
      }), f.resizeWhenFreezeChange({
        left: l + M,
        top: 0,
        height: a + 1,
        right: 0
      }), h.enable(), m.enable();
    } else {
      const M = R.startX - I.startX, E = R.startY - I.startY;
      d.resizeWhenFreezeChange({
        left: l + M,
        top: a + E,
        bottom: 0,
        right: 0
      }), d.setPadding({
        startY: I.startY,
        endY: R.startY,
        startX: I.startX,
        endX: R.startX
      }), o && this._commandService.executeCommand(mn.id, {
        ...o & 1 ? {
          sheetViewStartColumn: 0,
          offsetX: 0
        } : null,
        ...o & 2 ? {
          sheetViewStartRow: 0,
          offsetY: 0
        } : null
      }), h.resizeWhenFreezeChange({
        left: l,
        top: a + E,
        width: M,
        bottom: 0
      }), h.updateScrollVal({
        viewportScrollX: I.startX,
        rawScrollY: d.scrollY,
        viewportScrollY: d.viewportScrollY
      }), g.resizeWhenFreezeChange({
        left: l + M,
        top: a,
        height: E,
        right: 0
      }), g.updateScrollVal({
        viewportScrollY: I.startY,
        rawScrollX: d.scrollX,
        viewportScrollX: d.viewportScrollX
      }), u.resizeWhenFreezeChange({
        left: l,
        top: a,
        width: M,
        height: E
      }), u.updateScrollVal({
        viewportScrollX: I.startX,
        viewportScrollY: I.startY
      }), v.resizeWhenFreezeChange({
        left: 0,
        top: a,
        width: l + 1,
        height: E
      }), v.updateScrollVal({
        viewportScrollY: I.startY
      }), p.resizeWhenFreezeChange({
        left: 0,
        top: a + E,
        bottom: 0,
        width: l + 1
      }), m.resizeWhenFreezeChange({
        left: l,
        top: 0,
        width: M,
        height: a + 1
      }), m.updateScrollVal({
        viewportScrollX: I.startX
      }), f.resizeWhenFreezeChange({
        left: l + M,
        top: 0,
        height: a + 1,
        right: 0
      }), u.enable(), g.enable(), h.enable(), v.enable(), m.enable();
    }
  }
  /**
   * When switching sheet tabs, it is necessary to update the frozen state of the current view.
   */
  _skeletonListener() {
    this.disposeWithMe(
      We(
        this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
          [
            nt.id,
            yc.id,
            Mc.id
          ].includes((e == null ? void 0 : e.commandId) || "") && this._refreshCurrent();
        })
      )
    );
  }
  _refreshCurrent() {
    const t = this._context.unit.getActiveSheet();
    if (!t) return;
    const n = t.getConfig().freeze, { startRow: i = -1, startColumn: o = -1, ySplit: s = 0, xSplit: l = 0 } = n;
    this._refreshFreeze(
      i,
      o,
      s,
      l,
      0
      /* NONE */
    );
  }
  _themeChangeListener() {
    this._themeChange(this._themeService.getCurrentTheme()), this.disposeWithMe(
      this._themeService.currentTheme$.subscribe((e) => {
        this._clearFreeze(), this._themeChange(e), this._refreshCurrent();
      })
    );
  }
  _themeChange(e) {
    this._freezeNormalHeaderColor = Aa(e, "gray.300"), this._freezeNormalMainColor = new fn(this._freezeNormalHeaderColor).setAlpha(M_).toRgbString(), this._freezeActiveColor = Aa(e, "primary.600"), this._freezeHoverColor = Aa(e, "gray.500");
  }
  // eslint-disable-next-line max-lines-per-function
  _interceptorCommands() {
    this.disposeWithMe(
      this._sheetInterceptorService.interceptCommand({
        // eslint-disable-next-line complexity, max-lines-per-function
        getMutations: (e) => {
          const t = {
            redos: [],
            undos: []
          }, n = this._getFreeze();
          if (!n)
            return t;
          const i = (o) => {
            const s = this._context.unit, l = s.getUnitId(), a = s.getActiveSheet();
            if (!a)
              return t;
            const c = a.getSheetId();
            this._refreshFreeze(
              o.startRow,
              o.startColumn,
              o.ySplit,
              o.xSplit,
              0
              /* NONE */
            );
            const d = {
              ...o,
              unitId: l,
              subUnitId: c,
              resetScroll: !1
            }, u = pg(this._injector, d);
            return {
              undos: [{ id: fr.id, params: u }],
              redos: [{ id: fr.id, params: d }]
            };
          };
          if (e.id === oS.id) {
            const o = e.params, { range: s, direction: l } = o, a = s.endRow - s.startRow + 1;
            if (s.startRow < n.startRow || s.startRow + 1 === n.startRow && l === U.UP) {
              const c = {
                ...n,
                startRow: Math.max(1, n.startRow + a),
                ySplit: Math.max(1, n.ySplit + a)
              };
              return i(c);
            }
          }
          if (e.id === sS.id) {
            const o = e.params, { range: s, direction: l } = o, a = s.endColumn - s.startColumn + 1;
            if (s.startColumn < n.startColumn || s.startColumn + 1 === n.startColumn && l === U.LEFT) {
              const c = {
                ...n,
                startColumn: Math.max(1, n.startColumn + a),
                xSplit: Math.max(1, n.xSplit + a)
              };
              return i(c);
            }
          }
          if (e.id === zg.id) {
            const o = this._selectionManagerService.getCurrentSelections(), {
              fromRange: { startColumn: s },
              toRange: { startColumn: l }
            } = e.params, a = o == null ? void 0 : o.filter(
              (v) => v.range.rangeType === z.COLUMN && v.range.startColumn <= s && s <= v.range.endColumn
            );
            if (!(a != null && a.length))
              return t;
            const c = a[0].range, d = {
              ...c,
              startColumn: l,
              endColumn: l + c.endColumn - c.startColumn
            };
            if (!n || n.startColumn <= 0 || // move out of freeze
            c.startColumn >= n.startColumn && d.startColumn >= n.startColumn || // not move
            c.startColumn === d.startColumn || // move in freeze range
            c.endColumn < n.startColumn && d.startColumn < n.startColumn)
              return t;
            const u = c.endColumn - c.startColumn + 1, h = Math.max(
              Math.min(n.startColumn, c.endColumn + 1) - c.startColumn,
              0
            );
            let g, m;
            d.startColumn >= n.startColumn ? (g = Math.max(n.startColumn - h, 1), m = Math.max(n.xSplit - h, 1)) : (g = n.startColumn + u - h, m = n.xSplit + u - h);
            const f = {
              ...n,
              startColumn: g,
              xSplit: m
            };
            return i(f);
          }
          if (e.id === jg.id) {
            const o = this._selectionManagerService.getCurrentSelections(), {
              fromRange: { startRow: s },
              toRange: { startRow: l }
            } = e.params, a = o == null ? void 0 : o.filter(
              (v) => v.range.rangeType === z.ROW && v.range.startRow <= s && s <= v.range.endRow
            );
            if (!(a != null && a.length))
              return t;
            const c = a[0].range, d = {
              ...c,
              startRow: l,
              endRow: l + c.endRow - c.startRow
            };
            if (!n || n.startRow <= 0 || // move out of freeze
            c.startRow >= n.startRow && d.startRow >= n.startRow || // not move
            c.startRow === d.startRow || // move in freeze range
            c.endRow < n.startRow && d.startRow < n.startRow)
              return t;
            const u = c.endRow - c.startRow + 1, h = Math.max(
              Math.min(n.startRow, c.endRow + 1) - c.startRow,
              0
            );
            let g, m;
            d.startRow >= n.startRow ? (g = Math.max(n.startRow - h, 1), m = Math.max(n.ySplit - h, 1)) : (g = n.startRow + u - h, m = n.ySplit + u - h);
            const f = {
              ...n,
              startRow: g,
              ySplit: m
            };
            return i(f);
          }
          if (e.id === fg.id || e.id === mg.id) {
            const o = e.params, s = o.range;
            if (s.rangeType === z.COLUMN && s.startColumn < n.startColumn) {
              const l = Math.min(n.startColumn, s.endColumn + 1) - s.startColumn, a = {
                ...n,
                startColumn: Math.max(1, n.startColumn - l),
                xSplit: Math.max(1, n.xSplit - l)
              };
              return i(a);
            }
            if (o.range.rangeType === z.ROW && s.startRow < n.startRow) {
              const l = Math.min(n.startRow, s.endRow + 1) - s.startRow, a = {
                ...n,
                startRow: Math.max(1, n.startRow - l),
                ySplit: Math.max(1, n.ySplit - l)
              };
              return i(a);
            }
          }
          return t;
        }
      })
    );
  }
  /**
   * Update freeze line position when some cmds cause sk change.
   */
  // TODO @lumixraku But there is a _zoomRefresh method? Duplicated?
  _commandExecutedListener() {
    this.disposeWithMe(
      // eslint-disable-next-line complexity
      this._commandService.onCommandExecuted((e) => {
        switch (e.id) {
          case fr.id:
          case Jt.id:
            {
              const t = this._lastFreeze, n = this._context.unit, i = n.getActiveSheet(), o = e.params, { unitId: s, subUnitId: l } = o;
              if (!(s === n.getUnitId() && l === (i == null ? void 0 : i.getSheetId())))
                return;
              const a = i.getConfig().freeze;
              if (this._lastFreeze = a, a == null)
                return;
              let c = 0;
              const { startRow: d = -1, startColumn: u = -1, ySplit: h = 0, xSplit: g = 0 } = a;
              (!t || t.startRow !== d || t.ySplit !== h) && (c |= 2), (!t || t.startColumn !== u || t.xSplit !== g) && (c |= 1), o.resetScroll === !1 && (c = 0), this._refreshFreeze(d, u, h, g, c);
            }
            break;
          case So.id:
            {
              const t = this._getFreeze(), n = t && e.params.ranges.some((i) => i.startRow < t.startRow);
              e.params && n && this._refreshCurrent();
            }
            break;
          case ln.id:
            {
              const t = this._getFreeze();
              e.params && t && e.params.ranges.some(
                (n) => n.startColumn < t.startColumn
              ) && this._refreshCurrent();
            }
            break;
          case er.id:
            {
              const t = e.params, n = this._getFreeze();
              if (n && n.startRow > -1 && t.rowsAutoHeightInfo.some((i) => i.row < n.startRow)) {
                const i = this._sheetSkeletonManagerService.currentSkeleton$.subscribe(() => {
                  this._refreshCurrent(), setTimeout(() => {
                    i.unsubscribe();
                  });
                });
              }
            }
            break;
          case Vg.id:
          case Ng.id:
            {
              const t = e.params, n = this._getFreeze(), i = t.ranges;
              n && n.startColumn > -1 && i.some((o) => o.startColumn < n.startColumn) && this._refreshCurrent();
            }
            break;
          case xg.id:
          case Og.id:
            {
              const t = e.params, n = this._getFreeze(), i = t.ranges;
              n && n.startRow > -1 && i.some((o) => o.startRow < n.startRow) && this._refreshCurrent();
            }
            break;
          case oa.id:
          case sa.id:
            this._refreshCurrent();
        }
      })
    );
  }
  _zoomRefresh() {
    const e = this._getSheetObject();
    if (e == null)
      return;
    const { scene: t } = e;
    this.disposeWithMe(t.onTransformChange$.subscribeEvent((n) => {
      [Nc.scale, Nc.all].includes(n.type) && this._refreshCurrent();
    }));
  }
  _clearObserverEvent() {
    var t, n;
    this._getSheetObject() != null && ((t = this._scenePointerMoveSub) == null || t.unsubscribe(), (n = this._scenePointerUpSub) == null || n.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null);
  }
  _clearFreeze() {
    var t, n, i, o, s, l;
    (t = this._rowFreezeHeaderRect) == null || t.dispose(), (n = this._rowFreezeMainRect) == null || n.dispose(), (i = this._columnFreezeHeaderRect) == null || i.dispose(), (o = this._columnFreezeMainRect) == null || o.dispose(), this._getSheetObject() != null && ([this._freezeDownSubs, this._freezePointerEnterSubs, this._freezePointerLeaveSubs].forEach((a) => {
      a == null || a.unsubscribe();
    }), this._freezeDownSubs = null, this._freezePointerEnterSubs = null, this._freezePointerLeaveSubs = null, (s = this._scenePointerMoveSub) == null || s.unsubscribe(), (l = this._scenePointerUpSub) == null || l.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null);
  }
  _getPositionByIndex(e, t) {
    var a;
    if (this._getSheetObject() == null)
      return;
    const i = (a = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : a.skeleton, o = i == null ? void 0 : i.getNoMergeCellWithCoordByIndex(e, t);
    if (i == null)
      return;
    if (o != null && (!isNaN(o.endX) || !isNaN(o.endY)))
      return o;
    const { rowHeaderWidthAndMarginLeft: s, columnHeaderHeightAndMarginTop: l } = i;
    return {
      startX: s,
      endX: s,
      startY: l,
      endY: l
    };
  }
  _getFreeze() {
    var t;
    const e = (t = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : t.skeleton.getWorksheetConfig();
    if (e != null)
      return e.freeze;
  }
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  /**
   * Core function of _refreshCurrent
   * @param startRow
   * @param startColumn
   * @param ySplit
   * @param xSplit
   * @param resetScroll
   */
  _refreshFreeze(e, t, n, i, o) {
    var l;
    const s = {
      startRow: e,
      startColumn: t,
      ySplit: n,
      xSplit: i
    };
    this._clearFreeze(), this._createFreeze(0, s), this._createFreeze(1, s), this._updateViewport(e, t, n, i, o), (l = this._getSheetObject()) == null || l.spreadsheet.makeForceDirty();
  }
};
Vo = b_([
  dr(1, N(ue)),
  dr(2, W),
  dr(3, N(Q)),
  dr(4, N(Et)),
  dr(5, N(Ht)),
  dr(6, N(vn)),
  dr(7, N(Rt))
], Vo);
var E_ = Object.getOwnPropertyDescriptor, T_ = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? E_(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ac = (r, e) => (t, n) => e(t, n, r);
const P_ = "__SpreadsheetHeaderMoveControllerBackground__", x_ = "__SpreadsheetHeaderMoveControllerShapeLine__", O_ = "rgba(0, 0, 0, 0.1)", A_ = "rgb(119, 119, 119)", H_ = 4, cc = Nn("headerMovePermissionCheck");
let No = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_startOffsetX", Number.NEGATIVE_INFINITY);
    _(this, "_startOffsetY", Number.NEGATIVE_INFINITY);
    _(this, "_moveHelperBackgroundShape");
    _(this, "_moveHelperLineShape");
    _(this, "_headerPointerDownSubs");
    _(this, "_headerPointerMoveSubs");
    _(this, "_headerPointerLeaveSubs");
    _(this, "_dragHeaderMoveSub");
    _(this, "_scenePointerUpSub");
    _(this, "_scrollTimer");
    _(this, "_changeFromColumn", -1);
    _(this, "_changeFromRow", -1);
    _(this, "_changeToColumn", -1);
    _(this, "_changeToRow", -1);
    _(this, "interceptor", new ki({ HEADER_MOVE_PERMISSION_CHECK: cc }));
    _(this, "_workbookSelections");
    this._context = e, this._sheetSkeletonManagerService = n, this._commandService = i, this._workbookSelections = t.getWorkbookSelections(this._context.unitId), this._init();
  }
  dispose() {
    var e, t, n, i, o, s, l, a;
    (e = this._moveHelperBackgroundShape) == null || e.dispose(), (t = this._moveHelperLineShape) == null || t.dispose(), (n = this._headerPointerMoveSubs) == null || n.unsubscribe(), (i = this._headerPointerLeaveSubs) == null || i.unsubscribe(), (o = this._headerPointerDownSubs) == null || o.unsubscribe(), this._headerPointerMoveSubs = null, this._headerPointerLeaveSubs = null, this._headerPointerDownSubs = null, (s = this._dragHeaderMoveSub) == null || s.unsubscribe(), (l = this._scenePointerUpSub) == null || l.unsubscribe(), this._dragHeaderMoveSub = null, this._scenePointerUpSub = null, (a = this._scrollTimer) == null || a.dispose();
  }
  _init() {
    this._initialRowOrColumn(z.ROW), this._initialRowOrColumn(z.COLUMN);
  }
  // eslint-disable-next-line max-lines-per-function
  _initialRowOrColumn(e = z.ROW) {
    const t = this._context.components.get(Ye.COLUMN), n = this._context.components.get(Ye.ROW), i = this._context.scene, o = e === z.ROW ? n : t, s = (c) => {
      var p, S;
      const d = (p = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : p.skeleton;
      if (d == null)
        return;
      const u = (S = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : S.range;
      if (!u || !this.interceptor.fetchThroughInterceptors(cc)(!1, u))
        return;
      const g = this._workbookSelections.getCurrentSelections(), { row: m, column: f } = Vn(c.offsetX, c.offsetY, i, d);
      if (!gl(
        g,
        e === z.ROW ? m : f,
        e
      )) {
        i.resetCursor();
        return;
      }
      i.setCursor(ye.GRAB);
    }, l = () => {
      var c, d;
      (c = this._moveHelperBackgroundShape) == null || c.hide(), (d = this._moveHelperLineShape) == null || d.hide(), i.resetCursor();
    }, a = (c, d) => {
      var H, A;
      if (d.isStopPropagation) return;
      const u = (H = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : H.skeleton;
      if (u == null)
        return;
      const h = (A = this._workbookSelections.getCurrentLastSelection()) == null ? void 0 : A.range;
      if (!h || !this.interceptor.fetchThroughInterceptors(cc)(!1, h))
        return;
      const { offsetX: m, offsetY: f } = c, v = i.getCoordRelativeToViewport(ke.FromArray([m, f])), { x: p, y: S } = v;
      this._startOffsetX = p, this._startOffsetY = S;
      const { row: w, column: C } = Vn(c.offsetX, c.offsetY, i, u);
      let I;
      e === z.ROW ? (this._changeFromRow = w, I = bt.Y) : (this._changeFromColumn = C, I = bt.X);
      const R = this._workbookSelections.getCurrentSelections(), y = gl(
        R,
        e === z.ROW ? w : C,
        e
      );
      if (!y)
        return;
      const M = i.getScrollXYInfoByViewport(
        ke.FromArray([this._startOffsetX, this._startOffsetY])
      );
      this._newBackgroundAndLine(), i.setCursor(ye.GRABBING), i.disableObjectsEvent();
      let E = !1, T;
      const P = () => {
        if (E)
          return;
        T = ei.create(i, I), this._scrollTimer = T;
        const x = i.getViewport(F.VIEW_MAIN);
        T.startScroll(p, S, x), E = !0;
      };
      this._dragHeaderMoveSub = i.onPointerMove$.subscribeEvent((x) => {
        P();
        const { offsetX: V, offsetY: D } = x, { x: X, y: B } = i.getCoordRelativeToViewport(
          ke.FromArray([V, D])
        );
        this._rowColumnMoving(
          X,
          B,
          y,
          M,
          e
        ), T.scrolling(X, B, () => {
          this._rowColumnMoving(
            X,
            B,
            y,
            M,
            e
          );
        });
      }), this._scenePointerUpSub = i.onPointerUp$.subscribeEvent(() => {
        var V, D, X;
        this._disposeBackgroundAndLine(), i.resetCursor(), i.enableObjectsEvent(), this._clearObserverEvent(), (V = this._scrollTimer) == null || V.dispose();
        const x = this._workbookSelections.getCurrentSelections();
        if (e === z.ROW) {
          if (this._changeFromRow !== this._changeToRow && this._changeToRow !== -1) {
            const j = (D = ((x == null ? void 0 : x.filter(
              (G) => G.range.rangeType === z.ROW && G.range.startRow <= this._changeFromRow && this._changeFromRow <= G.range.endRow
            )) || [])[0]) == null ? void 0 : D.range;
            j && this._commandService.executeCommand(jg.id, {
              fromRange: j,
              toRange: {
                ...j,
                startRow: this._changeToRow,
                endRow: this._changeToRow + j.endRow - j.startRow
              }
            });
          }
          this._changeToRow = this._changeFromRow = -1;
        } else {
          if (this._changeFromColumn !== this._changeToColumn && this._changeToColumn !== -1) {
            const j = (X = ((x == null ? void 0 : x.filter(
              (G) => G.range.rangeType === z.COLUMN && G.range.startColumn <= this._changeFromColumn && this._changeFromColumn <= G.range.endColumn
            )) || [])[0]) == null ? void 0 : X.range;
            j && this._commandService.executeCommand(zg.id, {
              fromRange: j,
              toRange: {
                ...j,
                startColumn: this._changeToColumn,
                endColumn: this._changeToColumn + j.endColumn - j.startColumn
              }
            });
          }
          this._changeToColumn = this._changeFromColumn = -1;
        }
      });
    };
    this._headerPointerMoveSubs = new Kn(), this._headerPointerMoveSubs.add(o.onPointerMove$.subscribeEvent(s)), this._headerPointerLeaveSubs = new Kn(), this._headerPointerLeaveSubs.add(o == null ? void 0 : o.onPointerLeave$.subscribeEvent(l)), this._headerPointerDownSubs = new Kn(), this._headerPointerDownSubs.add(o == null ? void 0 : o.onPointerDown$.subscribeEvent(a));
  }
  // eslint-disable-next-line max-lines-per-function
  _rowColumnMoving(e, t, n, i, o) {
    var B, j, G, ge, Re, be, Ne;
    const s = this._context.scene, l = (B = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : B.skeleton;
    if (l == null)
      return;
    const { rowHeaderWidth: a, columnHeaderHeight: c, rowTotalHeight: d, columnTotalWidth: u } = l, h = s.getViewportScrollXY(s.getViewport(F.VIEW_MAIN)), { scaleX: g, scaleY: m } = s.getAncestorScale(), f = l.getCellIndexByOffset(
      e,
      t,
      g,
      m,
      h
    ), { row: v, column: p } = f, S = l.getNoMergeCellWithCoordByIndex(v, p), { startX: w, startY: C, endX: I, endY: R } = S, y = this._sheetSkeletonManagerService.attachRangeWithCoord(n.range);
    if (y == null)
      return;
    const M = Math.max(g, g), {
      startX: E,
      endX: T,
      startY: P,
      endY: H,
      startRow: A,
      startColumn: x,
      endRow: V,
      endColumn: D
    } = y;
    o === z.ROW ? (j = this._moveHelperBackgroundShape) == null || j.transformByState({
      height: H - P,
      width: u + a,
      left: 0,
      top: P + (t - this._startOffsetY) / M + h.y - i.y
    }) : (G = this._moveHelperBackgroundShape) == null || G.transformByState({
      height: d + c,
      width: T - E,
      left: E + (e - this._startOffsetX) / M + h.x - i.x,
      top: 0
    }), (ge = this._moveHelperBackgroundShape) == null || ge.show();
    const X = H_ / M;
    if (o === z.ROW) {
      let Z = 0;
      if (v <= A)
        Z = C - X / 2, this._changeToRow = v;
      else if (v > V)
        Z = R - X / 2, this._changeToRow = v + 1;
      else
        return;
      (Re = this._moveHelperLineShape) == null || Re.transformByState({
        height: X,
        width: u,
        left: a,
        top: Z
      });
    } else {
      let Z = 0;
      if (p <= x)
        Z = w - X / 2, this._changeToColumn = p;
      else if (p > D)
        Z = I - X / 2, this._changeToColumn = p + 1;
      else
        return;
      (be = this._moveHelperLineShape) == null || be.transformByState({
        height: d,
        width: X,
        left: Z,
        top: c
      });
    }
    (Ne = this._moveHelperLineShape) == null || Ne.show();
  }
  _clearObserverEvent() {
    var e, t;
    (e = this._dragHeaderMoveSub) == null || e.unsubscribe(), (t = this._scenePointerUpSub) == null || t.unsubscribe(), this._dragHeaderMoveSub = null, this._scenePointerUpSub = null;
  }
  _newBackgroundAndLine() {
    const e = this._context.scene;
    this._moveHelperBackgroundShape = new Se(P_, {
      fill: O_,
      evented: !1,
      zIndex: 100
    }), this._moveHelperLineShape = new Se(x_, {
      fill: A_,
      evented: !1,
      zIndex: 100
    }), e.addObjects(
      [this._moveHelperBackgroundShape, this._moveHelperLineShape],
      rr
    );
  }
  _disposeBackgroundAndLine() {
    var e, t;
    (e = this._moveHelperBackgroundShape) == null || e.dispose(), (t = this._moveHelperLineShape) == null || t.dispose();
  }
};
No = T_([
  ac(1, N(Q)),
  ac(2, N(ue)),
  ac(3, W)
], No);
var qc = /* @__PURE__ */ ((r) => (r[r.VERTICAL = 0] = "VERTICAL", r[r.HORIZONTAL = 1] = "HORIZONTAL", r))(qc || {});
const V_ = "rgba(120, 120, 120, 0.01)", dc = "rgb(68, 71, 70)", lo = 12, N_ = 44, Qc = 4;
class Ph extends Md {
  constructor(t, n) {
    super(t, n);
    _(this, "_size", lo);
    _(this, "_color", dc);
    _(this, "_mode", 0);
    this.setShapeProps(n);
  }
  get size() {
    return this._size;
  }
  get mode() {
    return this._mode;
  }
  get color() {
    return this._color;
  }
  _draw(t) {
    const n = this.getScene();
    if (!n) return;
    const { scaleX: i, scaleY: o } = n.getAncestorScale(), s = Math.max(i, o), l = lo / s, a = Qc / s;
    let { width: c, height: d } = this, u = 0, h = 0;
    this.mode === 0 ? (c = a, u = l - a) : (d = a, h = l - a), Se.drawWith(t, {
      width: this.width,
      height: this.height,
      left: 0,
      top: 0,
      fill: V_
    }), Se.drawWith(t, {
      width: c,
      height: d,
      fill: dc,
      radius: a
    }), t.save(), t.transform(1, 0, 0, 1, u, h), Se.drawWith(t, {
      width: c,
      height: d,
      fill: dc,
      radius: a
    }), t.restore();
  }
  setShapeProps(t) {
    return t != null && t.size && (this._size = t.size), t != null && t.mode && (this._mode = t.mode), t != null && t.color && (this._color = t.color), this.mode === 0 ? this.transformByState({
      width: lo,
      height: this.size
    }) : this.transformByState({
      width: this.size,
      height: lo
    }), this;
  }
}
var k_ = Object.getOwnPropertyDescriptor, D_ = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? k_(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, uc = (r, e) => (t, n) => e(t, n, r);
const L_ = "__SpreadsheetHeaderResizeControllerShapeRow__", W_ = "__SpreadsheetHeaderResizeControllerShapeColumn__", xh = "__SpreadsheetHeaderResizeControllerShapeHelper__", Oh = "rgb(199, 199, 199)", B_ = 2, hc = Nn("headerResizePermissionCheck");
let ko = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_currentRow", 0);
    _(this, "_currentColumn", 0);
    _(this, "_rowResizeRect");
    _(this, "_columnResizeRect");
    _(this, "_headerPointerSubs");
    // private _colHeaderPointerSubs: Array<Subscription>;
    _(this, "_scenePointerMoveSub");
    _(this, "_scenePointerUpSub");
    _(this, "_resizeHelperShape");
    _(this, "_startOffsetX", Number.POSITIVE_INFINITY);
    _(this, "_startOffsetY", Number.POSITIVE_INFINITY);
    _(this, "interceptor", new ki({ HEADER_RESIZE_PERMISSION_CHECK: hc }));
    this._context = e, this._sheetSkeletonManagerService = t, this._selectionManagerService = n, this._commandService = i, this._init();
  }
  dispose() {
    var e, t, n;
    (e = this._rowResizeRect) == null || e.dispose(), this._rowResizeRect = null, (t = this._columnResizeRect) == null || t.dispose(), this._columnResizeRect = null, (n = this._headerPointerSubs) == null || n.unsubscribe(), this._headerPointerSubs = null;
  }
  _init() {
    const e = this._context.scene;
    this._rowResizeRect = new Ph(L_, {
      visible: !1,
      mode: qc.HORIZONTAL,
      zIndex: 100
    }), this._columnResizeRect = new Ph(W_, {
      visible: !1,
      mode: qc.VERTICAL,
      zIndex: 100
    }), e.addObjects([this._rowResizeRect, this._columnResizeRect], rr), this._initialHover(
      0
      /* ROW */
    ), this._initialHover(
      1
      /* COLUMN */
    ), this._initialHoverResize(
      0
      /* ROW */
    ), this._initialHoverResize(
      1
      /* COLUMN */
    );
  }
  _initialHover(e = 0) {
    const t = this._context.components.get(Ye.COLUMN), n = this._context.components.get(Ye.ROW), i = this._context.scene, o = e === 0 ? n : t, s = (a, c) => {
      var d, u;
      (d = this._rowResizeRect) == null || d.hide(), (u = this._columnResizeRect) == null || u.hide();
    }, l = (a, c) => {
      var M;
      const d = (M = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : M.skeleton;
      if (d == null || this._rowResizeRect == null || this._columnResizeRect == null)
        return;
      const { rowHeaderWidth: u, columnHeaderHeight: h } = d, { startX: g, startY: m, endX: f, endY: v, row: p, column: S } = Vn(
        a.offsetX,
        a.offsetY,
        i,
        d
      ), w = Os(a.offsetX, a.offsetY, i), { scaleX: C, scaleY: I } = i.getAncestorScale(), R = Math.max(C, I), y = lo / R;
      if (e === 0) {
        let E = m - y / 2;
        if (w.y <= m + y / 2 && w.y >= m)
          this._currentRow = p - 1;
        else if (w.y >= v - y / 2 && w.y <= v)
          this._currentRow = p, E = v - y / 2;
        else {
          this._rowResizeRect.hide();
          return;
        }
        if (this._currentRow === -1)
          return;
        if (!this.interceptor.fetchThroughInterceptors(hc)(null, { row: this._currentRow }))
          return !1;
        const P = Math.min(N_, u / 3);
        this._rowResizeRect.transformByState({
          left: u / 2 - P / 2,
          top: E
        }), this._rowResizeRect.setShapeProps({
          size: P
        }), this._rowResizeRect.show();
      } else {
        let E = g - y / 2;
        if (w.x <= g + y / 2 && w.x >= g)
          this._currentColumn = S - 1;
        else if (w.x >= f - y / 2 && w.x <= f)
          this._currentColumn = S, E = f - y / 2;
        else {
          this._columnResizeRect.hide();
          return;
        }
        if (this._currentColumn === -1)
          return;
        if (!this.interceptor.fetchThroughInterceptors(hc)(null, { col: this._currentColumn }))
          return !1;
        const P = h * 0.7;
        this._columnResizeRect.transformByState({
          left: E,
          top: h / 2 - P / 2
        }), this._columnResizeRect.setShapeProps({
          size: P
        }), this._columnResizeRect.show();
      }
    };
    this._headerPointerSubs = new Kn(), this._headerPointerSubs.add(o == null ? void 0 : o.onPointerMove$.subscribeEvent(l)), this._headerPointerSubs.add(o == null ? void 0 : o.onPointerLeave$.subscribeEvent(s));
  }
  _initialHoverResize(e = 0) {
    const t = this._context.scene, n = e === 0 ? this._rowResizeRect : this._columnResizeRect;
    n != null && (this.disposeWithMe(
      n.onPointerEnter$.subscribeEvent(() => {
        n != null && (n.show(), t.setCursor(
          e === 0 ? ye.ROW_RESIZE : ye.COLUMN_RESIZE
        ));
      })
    ), this.disposeWithMe(
      n.onPointerLeave$.subscribeEvent(() => {
        n != null && (n.hide(), t.resetCursor());
      })
    ), this.disposeWithMe(
      n.onPointerDown$.subscribeEvent((i) => {
        var D, X, B, j, G, ge, Re;
        const o = (D = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : D.skeleton;
        if (o == null) return;
        const s = this._context.scene, l = s.getEngine(), a = (l == null ? void 0 : l.height) || 0, c = (l == null ? void 0 : l.width) || 0, d = s.getViewport(F.VIEW_MAIN), u = (((B = (X = d == null ? void 0 : d.getScrollBar()) == null ? void 0 : X.horizonScrollTrack) == null ? void 0 : B.height) || 0) + 10, h = (((G = (j = d == null ? void 0 : d.getScrollBar()) == null ? void 0 : j.verticalScrollTrack) == null ? void 0 : G.width) || 0) + 10, g = Os(i.offsetX, i.offsetY, s), { scaleX: m, scaleY: f } = s.getAncestorScale();
        this._startOffsetX = g.x, this._startOffsetY = g.y;
        const v = o.getOffsetByColumn(this._currentColumn), p = o.getOffsetByRow(this._currentRow), S = o.getNoMergeCellWithCoordByIndex(this._currentRow, this._currentColumn);
        let w = !1, C = 0, I = 0;
        const { columnTotalWidth: R, rowHeaderWidth: y, rowTotalHeight: M, columnHeaderHeight: E } = o, T = c > R + y ? c : R + y, P = a > M + E ? a : M + E, H = Math.max(m, f), A = Qc / H;
        e === 0 ? this._resizeHelperShape = new Se(xh, {
          width: T,
          height: A,
          fill: Oh,
          left: 0,
          top: p - A / 2
        }) : this._resizeHelperShape = new Se(xh, {
          width: A,
          height: P,
          fill: Oh,
          left: v - A / 2,
          top: 0
        });
        const x = ((ge = this._columnResizeRect) == null ? void 0 : ge.left) || 0, V = ((Re = this._rowResizeRect) == null ? void 0 : Re.top) || 0;
        s.addObject(this._resizeHelperShape, rr), s.disableObjectsEvent(), this._scenePointerMoveSub = s.onPointerMove$.subscribeEvent((be) => {
          var it, ot, vt, wt, Bn, Fn;
          const Ne = s.getCoordRelativeToViewport(
            ke.FromArray([this._startOffsetX, this._startOffsetY])
          ), Z = s.getScrollXYInfoByViewport(Ne, d), ee = Os(be.offsetX, be.offsetY, s), { x: ne, y: pe } = ee, { scaleX: Ue, scaleY: me } = s.getAncestorScale(), _e = Math.max(Ue, me), le = Qc / _e;
          C = ne - this._startOffsetX - le / 2, I = pe - this._startOffsetY - le / 2, Math.abs(e === 0 ? I : C) >= B_ && (w = !0), e === 0 ? (I > a - u + Z.y - S.startY && (I = a - u + Z.y - S.startY), I < -(S.endY - S.startY) + 2 && (I = -(S.endY - S.startY) + 2), w && ((it = this._resizeHelperShape) == null || it.transformByState({
            top: p + I
          }), (ot = this._rowResizeRect) == null || ot.transformByState({
            top: V + I + le / 2
          }), (vt = this._rowResizeRect) == null || vt.show(), s.setCursor(ye.ROW_RESIZE))) : (C > c - h + Z.x - S.startX && (C = c - h + Z.x - S.startX), C < -(S.endX - S.startX) + 2 && (C = -(S.endX - S.startX) + 2), w && ((wt = this._resizeHelperShape) == null || wt.transformByState({
            left: v + C
          }), (Bn = this._columnResizeRect) == null || Bn.transformByState({
            left: x + C + le / 2
          }), (Fn = this._columnResizeRect) == null || Fn.show(), s.setCursor(ye.COLUMN_RESIZE)));
        }), this._scenePointerUpSub = s.onPointerUp$.subscribeEvent((be) => {
          var Z, ee, ne;
          const Ne = this._context.scene;
          this._clearObserverEvent(), (Z = this._resizeHelperShape) == null || Z.dispose(), this._resizeHelperShape = null, Ne.enableObjectsEvent(), w && (Ne.resetCursor(), (ee = this._rowResizeRect) == null || ee.hide(), (ne = this._columnResizeRect) == null || ne.hide(), e === 0 ? this._commandService.executeCommand(lS.id, {
            deltaY: I,
            anchorRow: this._currentRow
          }) : this._commandService.executeCommand(
            aS.id,
            {
              deltaX: C,
              anchorCol: this._currentColumn
            }
          ));
        });
      })
    ), this.disposeWithMe(
      n.onDblclick$.subscribeEvent(() => {
        var d, u, h;
        this._context.scene.resetCursor();
        const o = (d = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : d.skeleton;
        if (!o) return;
        const s = 0, l = 0, a = o.worksheet.getRowCount() - 1 || 0, c = o.worksheet.getColumnCount() - 1 || 0;
        switch (e) {
          case 1: {
            const g = this._selectionManagerService.getCurrentSelections(), m = [];
            for (let f = 0; f < g.length; f++) {
              const v = g[f];
              v.range.rangeType === z.COLUMN && this._currentColumn <= v.range.endColumn && this._currentColumn >= v.range.startColumn && m.push({
                startColumn: v.range.startColumn,
                endColumn: v.range.endColumn,
                startRow: s,
                endRow: a
              });
            }
            m.length === 0 && m.push({
              startColumn: this._currentColumn,
              endColumn: this._currentColumn,
              startRow: s,
              endRow: a
            }), this._commandService.executeCommand(
              is.id,
              { ranges: m }
            ), (u = this._columnResizeRect) == null || u.hide();
            break;
          }
          case 0:
            this._commandService.executeCommand(
              wd.id,
              {
                ranges: [{
                  startRow: this._currentRow,
                  endRow: this._currentRow,
                  startColumn: l,
                  endColumn: c
                }]
              }
            ), (h = this._rowResizeRect) == null || h.hide();
            break;
        }
      })
    ));
  }
  _clearObserverEvent() {
    var e, t;
    (e = this._scenePointerMoveSub) == null || e.unsubscribe(), (t = this._scenePointerUpSub) == null || t.unsubscribe(), this._scenePointerMoveSub = null, this._scenePointerUpSub = null;
  }
};
ko = D_([
  uc(1, N(ue)),
  uc(2, N(Q)),
  uc(3, W)
], ko);
var F_ = Object.getOwnPropertyDescriptor, U_ = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? F_(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Ki = (r, e) => (t, n) => e(t, n, r);
const X_ = 60;
let fl = class extends kn {
  constructor(e, t, n, i, o, s) {
    super();
    _(this, "_renderMetric$", new He());
    _(this, "renderMetric$", this._renderMetric$.asObservable());
    _(this, "_renderFrameTimeMetric", null);
    _(this, "_renderFrameTags", {});
    _(this, "_afterRenderMetric$", new He());
    this._context = e, this._configService = t, this._sheetSkeletonManagerService = n, this._sheetRenderService = i, this._commandService = o, this._telemetryService = s, this._addNewRender(), this._initRenderMetricSubscriber();
  }
  _addNewRender() {
    const { scene: e, engine: t, unit: n } = this._context;
    this._addComponent(n), this._initRerenderScheduler(), this._initCommandListener();
    const i = this._context.unit.getActiveSheet();
    if (!i)
      throw new Error("No active sheet found");
    const o = i.getSheetId();
    this._sheetSkeletonManagerService.setCurrent({ sheetId: o });
    const s = () => e.render();
    this.disposeWithMe(this._context.activated$.subscribe((l) => {
      l ? t.runRenderLoop(s) : t.stopRenderLoop(s);
    }));
  }
  _initRenderMetricSubscriber() {
    const { engine: e } = this._context;
    e.beginFrame$.subscribe(() => {
      this._renderFrameTimeMetric = null, this._renderFrameTags = {};
    }), e.endFrame$.subscribe(() => {
      this._renderFrameTimeMetric && Object.keys(this._renderFrameTimeMetric).filter((i) => i.startsWith(Pu)).length > 0 && this._afterRenderMetric$.next({
        frameTimeMetric: this._renderFrameTimeMetric,
        tags: this._renderFrameTags
      });
    }), e.renderFrameTimeMetric$.subscribe(([n, i]) => {
      this._renderFrameTimeMetric || (this._renderFrameTimeMetric = {}), this._renderFrameTimeMetric[n] || (this._renderFrameTimeMetric[n] = []), this._renderFrameTimeMetric[n].push(Math.round(i * 100) / 100);
    }), e.renderFrameTags$.subscribe(([n, i]) => {
      this._renderFrameTags[n] = i;
    });
    const t = [];
    this._afterRenderMetric$.pipe(FS(e.endFrame$)).subscribe(([n, i]) => {
      t.push({
        FPS: i.FPS,
        elapsedTime: i.elapsedTime,
        frameTime: Math.round(i.frameTime * 100) / 100,
        ...n.frameTimeMetric,
        ...n.tags
      }), t.length > X_ && (this._captureRenderMetric(t), t.length = 0);
    });
  }
  /**
   * Send render metric to telemetry service
   * @param frameInfoList
   */
  _captureRenderMetric(e) {
    var u;
    const t = e;
    if (t.length === 0) return;
    const n = (h) => {
      let g = 0;
      const f = Object.entries(h).filter(([p, S]) => Array.isArray(S)).map(([p]) => p).reduce((p, S) => {
        const w = h[S].reduce((C, I) => C + I, 0);
        return p[S] = w, p;
      }, {});
      return Object.keys(h).filter((p) => p.startsWith(Pu)).forEach((p) => {
        g += f[p];
      }), { ...f, extensionTotal: g };
    }, i = e.map((h) => ({ ...h, ...n(h) })), s = ((h) => Object.entries(h[0]).filter(([f, v]) => !["elapsedTime"].includes(f)).filter(([f, v]) => typeof v == "number").map(([f]) => f).reduce((f, v) => {
      const p = h.map((I) => I[v]), S = Math.max(...p), w = Math.min(...p), C = p.reduce((I, R) => I + R, 0) / p.length;
      return f[v] = {
        max: Math.round(S * 100) / 100,
        min: Math.round(w * 100) / 100,
        avg: Math.round(C * 100) / 100
      }, f;
    }, {}))(i), l = t[t.length - 1].elapsedTime, a = this._context.unit.getActiveSheet().getSheetId(), c = this._context.unit.getUnitId(), d = { sheetId: a, unitId: c, elapsedTimeToStart: l, ...s };
    this._renderMetric$.next(d), (u = this._telemetryService) == null || u.capture("sheet_render_cost", d);
  }
  _addComponent(e) {
    const { scene: t, components: n } = this._context, i = e.getActiveSheet(), o = new Qg(Ye.MAIN);
    this._addViewport(i);
    const s = new DS(Ye.ROW), l = new LS(Ye.COLUMN), a = new Se(Ye.LEFT_TOP, {
      zIndex: 2,
      left: -1,
      top: -1,
      fill: "rgb(248, 249, 250)",
      stroke: "rgb(217, 217, 217)",
      strokeWidth: 1
    });
    this._context.mainComponent = o, n.set(Ye.MAIN, o), n.set(Ye.ROW, s), n.set(Ye.COLUMN, l), n.set(Ye.LEFT_TOP, a), t.addObjects([o], Wu), t.addObjects(
      [s, l, a],
      rr
    ), t.enableLayerCache(Wu, rr);
  }
  _initViewports(e, t, n) {
    const s = new Cn(F.VIEW_MAIN, e, {
      left: t.width,
      top: n.height,
      bottom: 0,
      right: 0,
      isWheelPreventDefaultX: !0,
      allowCache: !0,
      bufferEdgeX: 100,
      bufferEdgeY: 100
    }), l = new Cn(F.VIEW_MAIN_LEFT_TOP, e, {
      isWheelPreventDefaultX: !0,
      active: !1,
      allowCache: !0,
      bufferEdgeX: 0,
      bufferEdgeY: 0
    }), a = new Cn(F.VIEW_MAIN_LEFT, e, {
      isWheelPreventDefaultX: !0,
      active: !1,
      allowCache: !0,
      bufferEdgeX: 0,
      bufferEdgeY: 100
    }), c = new Cn(F.VIEW_MAIN_TOP, e, {
      isWheelPreventDefaultX: !0,
      active: !1,
      allowCache: !0,
      bufferEdgeX: 100,
      bufferEdgeY: 0
    }), d = new Cn(F.VIEW_ROW_TOP, e, {
      active: !1,
      isWheelPreventDefaultX: !0
    }), u = new Cn(F.VIEW_ROW_BOTTOM, e, {
      left: 0,
      top: n.height,
      bottom: 0,
      width: t.width + 1,
      isWheelPreventDefaultX: !0
    }), h = new Cn(F.VIEW_COLUMN_LEFT, e, {
      active: !1,
      isWheelPreventDefaultX: !0
    }), g = new Cn(F.VIEW_COLUMN_RIGHT, e, {
      left: t.width,
      top: 0,
      height: n.height + 1,
      right: 0,
      isWheelPreventDefaultX: !0
    }), m = new Cn(F.VIEW_LEFT_TOP, e, {
      left: 0,
      top: 0,
      width: t.width,
      height: n.height,
      isWheelPreventDefaultX: !0
    });
    return {
      viewMain: s,
      viewLeftTop: m,
      viewMainLeftTop: l,
      viewMainLeft: a,
      viewMainTop: c,
      viewColumnLeft: h,
      viewRowTop: d,
      viewRowBottom: u,
      viewColumnRight: g
    };
  }
  /**
   *
   * initViewport & wheel event
   * +-----------------+--------------------+-------------------+
   * |  VIEW_LEFT_TOP  |  VIEW_COLUMN_LEFT  | VIEW_COLUMN_RIGHT |
   * +-----------------+--------------------+-------------------+
   * |  VIEW_ROW_TOP   | VIEW_MAIN_LEFT_TOP |   VIEW_MAIN_TOP   |
   * +-----------------+--------------------+-------------------+
   * | VIEW_ROW_BOTTOM |   VIEW_MAIN_LEFT   |     VIEW_MAIN     |
   * +-----------------+--------------------+-------------------+
   */
  _addViewport(e) {
    const t = this._context.scene, { rowHeader: n, columnHeader: i } = e.getConfig(), { viewMain: o } = this._initViewports(t, n, i), s = this._configService.getConfig(Tt), l = s == null ? void 0 : s.scrollConfig;
    return new yd(o, l), t.attachControl(), o;
  }
  _initRerenderScheduler() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (!e) return null;
      const { skeleton: t, sheetId: n } = e, i = this._context.unit, o = i == null ? void 0 : i.getSheetBySheetId(n);
      if (i == null || o == null) return;
      const { mainComponent: s, components: l } = this._context, a = s, c = l.get(Ye.ROW), d = l.get(Ye.COLUMN), u = l.get(Ye.LEFT_TOP), { rowHeaderWidth: h, columnHeaderHeight: g } = t;
      a == null || a.updateSkeleton(t), c == null || c.updateSkeleton(t), d == null || d.updateSkeleton(t), u == null || u.transformByState({
        width: h,
        height: g
      });
    }));
  }
  _initCommandListener() {
    this.disposeWithMe(this._commandService.onCommandExecuted((e) => {
      const { unit: t } = this._context, { id: n } = e;
      if (Xs.includes(n) || this._sheetRenderService.checkMutationShouldTriggerRerender(n)) {
        const i = e.params, { unitId: o, subUnitId: s } = i, l = t.getActiveSheet();
        if (!l) return;
        const a = this._context.unitId, c = l.getSheetId();
        if (o !== a || s !== c)
          return;
        this._sheetSkeletonManagerService.makeDirty({
          sheetId: c,
          commandId: n
        }, !0), this._sheetSkeletonManagerService.setCurrent({
          sheetId: c,
          commandId: n
        });
      } else cS.includes(n) && this._sheetSkeletonManagerService.reCalculate();
      e.type === J.MUTATION && this._markUnitDirty(e);
    }));
  }
  _markUnitDirty(e) {
    const { mainComponent: t, scene: n } = this._context;
    if (e.id === pC.id && e.params.stageInfo != null || (t && t.makeDirty(), n.makeDirty(), !e.params)) return;
    const i = e.params, o = this._spreadsheetViewports(n);
    if (e.id === we.id && i.cellValue) {
      const s = this._cellValueToRange(i.cellValue), l = this._rangeToBounds([s]);
      this._markViewportDirty(o, l), t.setDirtyArea(l);
    }
    if (e.id === tr.id && i.from && i.to) {
      const s = i.fromRange || this._cellValueToRange(i.from.value), l = i.toRange || this._cellValueToRange(i.to.value), a = this._rangeToBounds([s, l]);
      this._markViewportDirty(o, a), t.setDirtyArea(a);
    }
  }
  /**
   * cellValue data structure:
   * {[row]: { [col]: value}}
   * @param cellValue
   * @returns IRange
   */
  _cellValueToRange(e) {
    let t = 0, n = 0, i = 0, o = 0;
    for (const [d, u] of Object.entries(e)) {
      for (const h in u)
        t > Number(h) && (t = Number(h)), n < Number(h) && (n = Number(h));
      i > Number(d) && (i = Number(d)), o < Number(d) && (o = Number(d));
    }
    return {
      startRow: i,
      endRow: o,
      startColumn: t,
      endColumn: n
    };
  }
  _rangeToBounds(e) {
    const t = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { rowHeightAccumulation: n, columnWidthAccumulation: i, rowHeaderWidth: o, columnHeaderHeight: s } = t, l = [];
    for (const a of e) {
      const { startRow: c, endRow: d, startColumn: u, endColumn: h } = a, g = c === 0 ? 0 : n[c - 1] + s, m = n[d] + s, f = u === 0 ? 0 : i[u - 1] + o, v = i[h] + o;
      l.push({ top: g, left: f, bottom: m, right: v, width: v - f, height: m - g });
    }
    return l;
  }
  _markViewportDirty(e, t) {
    const n = e.filter((i) => i.isActive && i.cacheBound);
    for (const i of n)
      for (const o of t)
        se.hasIntersectionBetweenTwoRect(i.cacheBound, o) && i.markDirty(!0);
  }
  _spreadsheetViewports(e) {
    return e.getViewports().filter((t) => ["viewMain", "viewMainLeftTop", "viewMainTop", "viewMainLeft"].includes(t.viewportKey));
  }
};
fl = U_([
  Ki(1, N(Vt)),
  Ki(2, N(ue)),
  Ki(3, N(ir)),
  Ki(4, W),
  Ki(5, ld(MC))
], fl);
const z_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M0.98999 1.08218H-0.0100098V0.0821838H0.98999V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M5.78992 1.08218H2.78992V0.0821838H5.78992V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M7.58984 1.08218H8.58984V0.0821838H7.58984V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M14.9152 1.08218H13.9152V0.0821838H14.9152V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M16.7151 1.08218H19.7151V0.0821838H16.7151V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M22.515 1.08218H21.515V0.0821838H22.515V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M27.8405 1.08218H28.8405V0.0821838H27.8405V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M33.6404 1.08218H30.6404V0.0821838H33.6404V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M35.4403 1.08218H36.4403V0.0821838H35.4403V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M42.7657 1.08218H41.7657V0.0821838H42.7657V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M44.5657 1.08218H47.5657V0.0821838H44.5657V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M50.3656 1.08218H49.3656V0.0821838H50.3656V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M55.691 1.08218H56.691V0.0821838H55.691V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M61.491 1.08218H58.491V0.0821838H61.491V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M63.2909 1.08218H64.2909V0.0821838H63.2909V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M70.6163 1.08218H69.6163V0.0821838H70.6163V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M72.4163 1.08218H75.4163V0.0821838H72.4163V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M78.2162 1.08218H77.2162V0.0821838H78.2162V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M83.5416 1.08218H84.5416V0.0821838H83.5416V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M89.3416 1.08218H86.3416V0.0821838H89.3416V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M91.1415 1.08218H92.1415V0.0821838H91.1415V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M98.4669 1.08218H97.4669V0.0821838H98.4669V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M100.267 1.08218H103.267V0.0821838H100.267V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M106.067 1.08218H105.067V0.0821838H106.067V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M111.392 1.08218H112.392V0.0821838H111.392V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M117.192 1.08218H114.192V0.0821838H117.192V1.08218Z" }),
  /* @__PURE__ */ b("path", { d: "M118.992 1.08218H119.992V0.0821838H118.992V1.08218Z" })
] }), j_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.0100098 1.15771H0.98999V0.157715H-0.0100098V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M2.78992 1.15771H5.78992V0.157715H2.78992V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M8.58984 1.15771H7.58984V0.157715H8.58984V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M10.3899 1.15771H11.3899V0.157715H10.3899V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M19.0903 1.15771H18.0903V0.157715H19.0903V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M20.8903 1.15771H23.8903V0.157715H20.8903V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M26.6902 1.15771H25.6902V0.157715H26.6902V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M28.4902 1.15771H29.4902V0.157715H28.4902V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M37.1907 1.15771H36.1907V0.157715H37.1907V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M38.9906 1.15771H41.9906V0.157715H38.9906V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M44.7905 1.15771H43.7905V0.157715H44.7905V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M46.5906 1.15771H47.5906V0.157715H46.5906V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M55.291 1.15771H54.291V0.157715H55.291V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M57.0909 1.15771H60.0909V0.157715H57.0909V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M62.8909 1.15771H61.8909V0.157715H62.8909V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M64.6909 1.15771H65.6909V0.157715H64.6909V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M73.3914 1.15771H72.3914V0.157715H73.3914V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M75.1913 1.15771H78.1913V0.157715H75.1913V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M80.9912 1.15771H79.9912V0.157715H80.9912V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M82.7913 1.15771H83.7913V0.157715H82.7913V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M91.4917 1.15771H90.4917V0.157715H91.4917V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M93.2916 1.15771H96.2916V0.157715H93.2916V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M99.0916 1.15771H98.0916V0.157715H99.0916V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M100.892 1.15771H101.892V0.157715H100.892V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M109.592 1.15771H108.592V0.157715H109.592V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M111.392 1.15771H114.392V0.157715H111.392V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M117.192 1.15771H116.192V0.157715H117.192V1.15771Z" }),
  /* @__PURE__ */ b("path", { d: "M118.992 1.15771H119.992V0.157715H118.992V1.15771Z" })
] }), Y_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.00842285 1.22449H2.99158V0.224487H-0.00842285V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M6.14941 1.22449H9.14941V0.224487H6.14941V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M15.3073 1.22449H12.3073V0.224487H15.3073V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M18.4651 1.22449H21.4651V0.224487H18.4651V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M27.6229 1.22449H24.6229V0.224487H27.6229V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M30.7808 1.22449H33.7808V0.224487H30.7808V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M39.9386 1.22449H36.9386V0.224487H39.9386V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M43.0964 1.22449H46.0964V0.224487H43.0964V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M52.2543 1.22449H49.2543V0.224487H52.2543V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M55.4121 1.22449H58.4121V0.224487H55.4121V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M64.5699 1.22449H61.5699V0.224487H64.5699V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M67.7278 1.22449H70.7278V0.224487H67.7278V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M76.8856 1.22449H73.8856V0.224487H76.8856V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M80.0435 1.22449H83.0435V0.224487H80.0435V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M89.2013 1.22449H86.2013V0.224487H89.2013V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M92.3591 1.22449H95.3591V0.224487H92.3591V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M101.517 1.22449H98.517V0.224487H101.517V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M104.675 1.22449H107.675V0.224487H104.675V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M113.833 1.22449H110.833V0.224487H113.833V1.22449Z" }),
  /* @__PURE__ */ b("path", { d: "M116.99 1.22449H119.99V0.224487H116.99V1.22449Z" })
] }), Z_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "8", viewBox: "0 0 120 8", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b(
    "path",
    {
      fillRule: "evenodd",
      clipRule: "evenodd",
      d: "M119.991 2.06215H-0.0090332V0.862152H119.991V1.86215Z"
    }
  ),
  /* @__PURE__ */ b(
    "path",
    {
      fillRule: "evenodd",
      clipRule: "evenodd",
      d: "M119.991 6.66215H-0.0090332V5.86215H119.991V6.86215Z"
    }
  )
] }), G_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.00976562 1.65707H0.990234V0.657074H-0.00976562V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M2.32361 1.65707H3.32361V0.657074H2.32361V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M5.65698 1.65707H4.65698V0.657074H5.65698V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M6.99036 1.65707H7.99036V0.657074H6.99036V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M10.3237 1.65707H9.32373V0.657074H10.3237V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M11.6571 1.65707H12.6571V0.657074H11.6571V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M14.9905 1.65707H13.9905V0.657074H14.9905V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M16.3239 1.65707H17.3239V0.657074H16.3239V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M19.6572 1.65707H18.6572V0.657074H19.6572V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M20.9906 1.65707H21.9906V0.657074H20.9906V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M24.324 1.65707H23.324V0.657074H24.324V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M25.6573 1.65707H26.6573V0.657074H25.6573V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M28.9907 1.65707H27.9907V0.657074H28.9907V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M30.3241 1.65707H31.3241V0.657074H30.3241V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M33.6575 1.65707H32.6575V0.657074H33.6575V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M34.9908 1.65707H35.9908V0.657074H34.9908V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M38.3242 1.65707H37.3242V0.657074H38.3242V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M39.6576 1.65707H40.6576V0.657074H39.6576V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M42.991 1.65707H41.991V0.657074H42.991V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M44.3243 1.65707H45.3243V0.657074H44.3243V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M47.6577 1.65707H46.6577V0.657074H47.6577V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M48.9911 1.65707H49.9911V0.657074H48.9911V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M52.3245 1.65707H51.3245V0.657074H52.3245V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M53.6578 1.65707H54.6578V0.657074H53.6578V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M56.9912 1.65707H55.9912V0.657074H56.9912V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M58.3246 1.65707H59.3246V0.657074H58.3246V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M61.658 1.65707H60.658V0.657074H61.658V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M62.9913 1.65707H63.9913V0.657074H62.9913V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M66.3247 1.65707H65.3247V0.657074H66.3247V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M67.6581 1.65707H68.6581V0.657074H67.6581V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M70.9915 1.65707H69.9915V0.657074H70.9915V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M72.3248 1.65707H73.3248V0.657074H72.3248V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M75.6582 1.65707H74.6582V0.657074H75.6582V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M76.9916 1.65707H77.9916V0.657074H76.9916V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M80.325 1.65707H79.325V0.657074H80.325V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M81.6583 1.65707H82.6583V0.657074H81.6583V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M84.9917 1.65707H83.9917V0.657074H84.9917V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M86.3251 1.65707H87.3251V0.657074H86.3251V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M89.6584 1.65707H88.6584V0.657074H89.6584V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M90.9918 1.65707H91.9918V0.657074H90.9918V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M94.3252 1.65707H93.3252V0.657074H94.3252V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M95.6586 1.65707H96.6586V0.657074H95.6586V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M98.9919 1.65707H97.9919V0.657074H98.9919V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M100.325 1.65707H101.325V0.657074H100.325V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M103.659 1.65707H102.659V0.657074H103.659V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M104.992 1.65707H105.992V0.657074H104.992V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M108.325 1.65707H107.325V0.657074H108.325V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M109.659 1.65707H110.659V0.657074H109.659V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M112.992 1.65707H111.992V0.657074H112.992V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M114.325 1.65707H115.325V0.657074H114.325V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M117.659 1.65707H116.659V0.657074H117.659V1.65707Z" }),
  /* @__PURE__ */ b("path", { d: "M118.992 1.65707H119.992V0.657074H118.992V1.65707Z" })
] }), q_ = ({ className: r }) => /* @__PURE__ */ b("svg", { className: r, width: "120", height: "3", viewBox: "0 0 120 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ b(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 2.42035H-0.0090332V0.420349H119.991V2.42035Z"
  }
) }), Q_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "3", viewBox: "0 0 120 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.0100098 2.47614H1.98999V0.476135H-0.0100098V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M3.99014 2.47614H9.99014V0.476135H3.99014V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M13.9901 2.47614H11.9901V0.476135H13.9901V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M21.1904 2.47614H23.1904V0.476135H21.1904V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M31.1906 2.47614H25.1906V0.476135H31.1906V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M33.1906 2.47614H35.1906V0.476135H33.1906V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M44.3909 2.47614H42.3909V0.476135H44.3909V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M46.391 2.47614H52.391V0.476135H46.391V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M56.391 2.47614H54.391V0.476135H56.391V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M63.5913 2.47614H65.5913V0.476135H63.5913V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M73.5915 2.47614H67.5915V0.476135H73.5915V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M75.5915 2.47614H77.5915V0.476135H75.5915V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M86.7917 2.47614H84.7917V0.476135H86.7917V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M88.7919 2.47614H94.7919V0.476135H88.7919V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M98.7919 2.47614H96.7919V0.476135H98.7919V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M105.992 2.47614H107.992V0.476135H105.992V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M115.992 2.47614H109.992V0.476135H115.992V2.47614Z" }),
  /* @__PURE__ */ b("path", { d: "M117.992 2.47614H119.992V0.476135H117.992V2.47614Z" })
] }), K_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.0100098 2.00415H1.98999V0.00415039H-0.0100098V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M3.99014 2.00415H9.99014V0.00415039H3.99014V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M13.9901 2.00415H11.9901V0.00415039H13.9901V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M15.9901 2.00415H17.9901V0.00415039H15.9901V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M27.4905 2.00415H25.4905V0.00415039H27.4905V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M29.4906 2.00415H35.4906V0.00415039H29.4906V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M39.4906 2.00415H37.4906V0.00415039H39.4906V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M41.4906 2.00415H43.4906V0.00415039H41.4906V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M52.991 2.00415H50.991V0.00415039H52.991V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M54.9911 2.00415H60.9911V0.00415039H54.9911V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M64.9911 2.00415H62.9911V0.00415039H64.9911V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M66.9911 2.00415H68.9911V0.00415039H66.9911V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M78.4915 2.00415H76.4915V0.00415039H78.4915V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M80.4916 2.00415H86.4916V0.00415039H80.4916V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M90.4916 2.00415H88.4916V0.00415039H90.4916V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M92.4916 2.00415H94.4916V0.00415039H92.4916V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M103.992 2.00415H101.992V0.00415039H103.992V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M105.992 2.00415H111.992V0.00415039H105.992V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M115.992 2.00415H113.992V0.00415039H115.992V2.00415Z" }),
  /* @__PURE__ */ b("path", { d: "M117.992 2.00415H119.992V0.00415039H117.992V2.00415Z" })
] }), J_ = ({ className: r }) => /* @__PURE__ */ q("svg", { className: r, width: "118", height: "3", viewBox: "0 0 118 3", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: [
  /* @__PURE__ */ b("path", { d: "M-0.00854492 2.94815H1.99146V0.948151H-0.00854492V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M6.09668 2.94815H8.09668V0.948151H6.09668V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M14.2019 2.94815H12.2019V0.948151H14.2019V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M18.3071 2.94815H20.3071V0.948151H18.3071V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M26.4124 2.94815H24.4124V0.948151H26.4124V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M30.5176 2.94815H32.5176V0.948151H30.5176V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M38.6228 2.94815H36.6228V0.948151H38.6228V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M42.728 2.94815H44.728V0.948151H42.728V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M50.8333 2.94815H48.8333V0.948151H50.8333V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M54.9385 2.94815H56.9385V0.948151H54.9385V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M63.0437 2.94815H61.0437V0.948151H63.0437V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M67.1489 2.94815H69.1489V0.948151H67.1489V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M75.2542 2.94815H73.2542V0.948151H75.2542V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M79.3594 2.94815H81.3594V0.948151H79.3594V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M87.4645 2.94815H85.4645V0.948151H87.4645V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M91.5697 2.94815H93.5697V0.948151H91.5697V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M99.6749 2.94815H97.6749V0.948151H99.6749V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M103.78 2.94815H105.78V0.948151H103.78V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M111.885 2.94815H109.885V0.948151H111.885V2.94815Z" }),
  /* @__PURE__ */ b("path", { d: "M115.991 2.94815H117.991V0.948151H115.991V2.94815Z" })
] }), $_ = ({ className: r }) => /* @__PURE__ */ b("svg", { className: r, width: "120", height: "4", viewBox: "0 0 120 4", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ b(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 3.86215H-0.0090332V0.862152H119.991V3.86215Z"
  }
) }), eR = ({ className: r }) => /* @__PURE__ */ b("svg", { className: r, width: "120", height: "2", viewBox: "0 0 120 2", fill: "none", xmlns: "http://www.w3.org/2000/svg", children: /* @__PURE__ */ b(
  "path",
  {
    fillRule: "evenodd",
    clipRule: "evenodd",
    d: "M119.991 1.15668H-0.0090332V0.156677H119.991V1.15668Z"
  }
) });
function Ah(r) {
  const { type: e = Pe.THIN, className: t } = r;
  switch (e) {
    case Pe.DASH_DOT:
      return /* @__PURE__ */ b(z_, { className: t });
    case Pe.DASH_DOT_DOT:
      return /* @__PURE__ */ b(j_, { className: t });
    case Pe.DASHED:
      return /* @__PURE__ */ b(Y_, { className: t });
    case Pe.HAIR:
      return /* @__PURE__ */ b(G_, { className: t });
    case Pe.MEDIUM:
      return /* @__PURE__ */ b(q_, { className: t });
    case Pe.MEDIUM_DASH_DOT:
      return /* @__PURE__ */ b(Q_, { className: t });
    case Pe.MEDIUM_DASH_DOT_DOT:
      return /* @__PURE__ */ b(K_, { className: t });
    case Pe.MEDIUM_DASHED:
      return /* @__PURE__ */ b(J_, { className: t });
    case Pe.THICK:
      return /* @__PURE__ */ b($_, { className: t });
    case Pe.DOUBLE:
      return /* @__PURE__ */ b(Z_, { className: t });
    case Pe.THIN:
    default:
      return /* @__PURE__ */ b(eR, { className: t });
  }
}
const tR = [
  {
    label: Pe.THIN,
    value: Pe.THIN
  },
  {
    label: Pe.HAIR,
    value: Pe.HAIR
  },
  {
    label: Pe.DOTTED,
    value: Pe.DOTTED
  },
  {
    label: Pe.DASHED,
    value: Pe.DASHED
  },
  {
    label: Pe.DASH_DOT,
    value: Pe.DASH_DOT
  },
  {
    label: Pe.DASH_DOT_DOT,
    value: Pe.DASH_DOT_DOT
  },
  {
    label: Pe.MEDIUM,
    value: Pe.MEDIUM
  },
  {
    label: Pe.MEDIUM_DASHED,
    value: Pe.MEDIUM_DASHED
  },
  {
    label: Pe.MEDIUM_DASH_DOT,
    value: Pe.MEDIUM_DASH_DOT
  },
  {
    label: Pe.MEDIUM_DASH_DOT_DOT,
    value: Pe.MEDIUM_DASH_DOT_DOT
  },
  {
    label: Pe.THICK,
    value: Pe.THICK
  },
  {
    label: Pe.DOUBLE,
    value: Pe.DOUBLE
  }
];
function nR(r) {
  var e;
  if (r)
    for (const t in r) {
      const n = r[t];
      if ((e = n == null ? void 0 : n.cl) != null && e.rgb) return n.cl.rgb;
    }
}
function rR(r) {
  var e;
  if (r)
    for (const t in r) {
      const n = r[t];
      if ((e = n == null ? void 0 : n.cl) != null && e.rgb) return n.s;
    }
}
function Hf(r) {
  var h;
  const e = L(kt), t = L(Ec), n = L(Q), { isAllValuesSame: i, value: o } = n.getCellStylesProperty("bd"), s = i ? nR(o) : void 0, l = i ? rR(o) : void 0, { onChange: a, value: c } = r;
  function d(g, m) {
    a == null || a({
      ...c,
      [m]: g
    });
  }
  function u(g) {
    const m = e.get(g);
    return m && /* @__PURE__ */ b(m, { className: "univer-fill-primary-600" });
  }
  return /* @__PURE__ */ q("section", { className: "univer-box-border univer-grid univer-gap-2 univer-p-1.5", children: [
    /* @__PURE__ */ b(
      "div",
      {
        className: "univer-box-border univer-grid univer-grid-cols-5 univer-gap-2 univer-text-gray-600 dark:!univer-text-gray-200",
        children: bf.map((g) => /* @__PURE__ */ b(
          "a",
          {
            className: Te("univer-flex univer-size-6 univer-cursor-pointer univer-items-center univer-justify-center univer-justify-self-center univer-rounded hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700", {
              "univer-bg-gray-200 dark:!univer-bg-gray-600": t.getBorderInfo().type === g.value
            }),
            onClick: (m) => {
              m.stopPropagation(), d(g.value, "type");
            },
            children: u(g.icon)
          },
          g.value
        ))
      }
    ),
    /* @__PURE__ */ b(wC, {}),
    /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center univer-gap-2", children: [
      /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
        kc,
        {
          overlay: /* @__PURE__ */ b("div", { className: "univer-rounded-lg univer-p-4", children: /* @__PURE__ */ b(cm, { value: s, onChange: (g) => d(g, "color") }) }),
          children: /* @__PURE__ */ q(
            "button",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              type: "button",
              children: [
                /* @__PURE__ */ b(
                  Jm,
                  {
                    className: "univer-fill-primary-600 dark:!univer-text-white",
                    extend: { colorChannel1: (h = c == null ? void 0 : c.color) != null ? h : "" }
                  }
                ),
                /* @__PURE__ */ b(_i, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      ) }),
      /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
        kc,
        {
          overlay: /* @__PURE__ */ b("section", { className: "univer-rounded-lg univer-p-1.5", children: /* @__PURE__ */ b("ul", { className: "univer-m-0 univer-grid univer-list-none univer-gap-1 univer-p-0", children: tR.map((g) => /* @__PURE__ */ q(
            "li",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-justify-center univer-rounded univer-px-1 univer-py-3 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              onClick: () => d(g.value, "style"),
              children: [
                g.value === l && /* @__PURE__ */ b(
                  Dr,
                  {
                    className: "univer-absolute univer-left-3 univer-text-primary-600"
                  }
                ),
                /* @__PURE__ */ b(
                  Ah,
                  {
                    className: "univer-ml-6 univer-fill-gray-900 dark:!univer-fill-white",
                    type: g.value
                  }
                )
              ]
            },
            g.value
          )) }) }),
          children: /* @__PURE__ */ q(
            "button",
            {
              className: "univer-flex univer-cursor-pointer univer-items-center univer-gap-2 univer-rounded univer-border-none univer-bg-transparent univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-700",
              type: "button",
              children: [
                /* @__PURE__ */ b(
                  Ah,
                  {
                    className: "univer-fill-gray-900 dark:!univer-fill-white",
                    type: l != null ? l : Pe.THIN
                  }
                ),
                /* @__PURE__ */ b(_i, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      ) })
    ] })
  ] });
}
const hu = "sheets.component.cell-popup";
var iR = Object.getOwnPropertyDescriptor, oR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? iR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ur = (r, e) => (t, n) => e(t, n, r);
let yi = class extends oe {
  constructor(e, t, n, i, o, s, l) {
    super();
    // the DrawingTypeEnum should refer from drawing package, here we just use type, so no need to import the drawing package
    _(this, "_popupMenuFeatureMap", /* @__PURE__ */ new Map());
    _(this, "_isSelectionMoving", !1);
    this._globalPopupManagerService = e, this._renderManagerService = t, this._univerInstanceService = n, this._refRangeService = i, this._commandService = o, this._refSelectionsService = s, this._selectionManagerService = l, this._initMoving();
  }
  _initMoving() {
    this.disposeWithMe(
      this._refSelectionsService.selectionMoving$.subscribe(() => {
        this._isSelectionMoving = !0;
      })
    ), this.disposeWithMe(
      this._refSelectionsService.selectionMoveEnd$.subscribe(() => {
        this._isSelectionMoving = !1;
      })
    ), this.disposeWithMe(
      this._selectionManagerService.selectionMoving$.subscribe(() => {
        this._isSelectionMoving = !0;
      })
    ), this.disposeWithMe(
      this._selectionManagerService.selectionMoveEnd$.subscribe(() => {
        this._isSelectionMoving = !1;
      })
    );
  }
  /**
   * Register a feature menu callback for a specific drawing type.such as image, chart, etc.
   */
  registerFeatureMenu(e, t) {
    this._popupMenuFeatureMap.set(e, t);
  }
  /**
   * Get the feature menu by drawing type, the function should be called when a drawing element need trigger popup menu, so the unitId, subUnitId, drawingId should be provided.
   * @param {string} unitId the unit id
   * @param {string} subUnitId the sub unit id
   * @param {string} drawingId the drawing id
   * @param {DrawingTypeEnum} drawingType the feature type
   * @returns the feature menu if it exists, otherwise return undefined
   */
  getFeatureMenu(e, t, n, i) {
    const o = this._popupMenuFeatureMap.get(i);
    if (o)
      return o(e, t, n, i);
  }
  dispose() {
    super.dispose(), this._popupMenuFeatureMap.clear();
  }
  _createHiddenRectObserver(e) {
    const { row: t, column: n, worksheet: i, skeleton: o, currentRender: s } = e, l = () => {
      var B, j;
      const u = i.getFreeze(), { startRow: h, startColumn: g, xSplit: m, ySplit: f } = u, v = h - f, p = g - m, { rowHeightAccumulation: S, columnWidthAccumulation: w, rowHeaderWidth: C, columnHeaderHeight: I } = o, R = C + (p === -1 ? 0 : w[p + m - 1] - ((B = w[p - 1]) != null ? B : 0)), y = I + (v === -1 ? 0 : S[v + f - 1] - ((j = S[v]) != null ? j : 0)), M = s.engine.getCanvasElement(), E = M.getBoundingClientRect(), T = gc(M.style.width), P = E.width / T, H = s.scene.getAncestorScale().scaleX, A = R * P * H, x = y * P * H, V = {
        left: -1 / 0,
        top: -1 / 0,
        right: E.left + A,
        bottom: E.top + x
      }, D = {
        left: E.left + A,
        top: -1 / 0,
        right: 1 / 0,
        bottom: E.top + x
      }, X = {
        left: -1 / 0,
        top: E.top + x,
        right: E.left + A,
        bottom: 1 / 0
      };
      return t < h && n < g ? [] : t < h ? [V] : n < g ? [V] : [V, D, X];
    }, a = l(), c = new Me(a), d = new ht();
    return d.add(this._commandService.onCommandExecuted((u) => {
      u.id === fr.id && c.next(l());
    })), d.add(Ws(s.engine.onTransformChange$).pipe(Ys(16)).subscribe(() => {
      c.next(l());
    })), {
      rects$: c,
      disposable: d
    };
  }
  // #region attach to object
  // Unlike _createCellPositionObserver, this bind to a certain position.
  _createPositionObserver(e, t, n, i) {
    const o = () => {
      const { scene: c } = t, d = Cw(e, c, n, i), u = t.engine.getCanvasElement(), h = u.getBoundingClientRect(), g = gc(u.style.width), m = h.width / g;
      return {
        left: d.left * m + h.left,
        right: d.right * m + h.left,
        top: d.top * m + h.top,
        bottom: d.bottom * m + h.top
      };
    }, s = o(), l = new Me(s), a = new ht();
    return a.add(this._commandService.onCommandExecuted((c) => {
      (c.id === gn.id || c.id === Jt.id) && l.next(o());
    })), {
      position: s,
      position$: l,
      disposable: a
    };
  }
  /**
   * attach a popup to canvas object
   * @param targetObject target canvas object
   * @param popup popup item
   * @returns disposable
   */
  attachPopupToObject(e, t) {
    var S;
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), i = n.getActiveSheet();
    if (!i || this._isSelectionMoving && !t.showOnSelectionMoving)
      return {
        dispose: () => {
        },
        canDispose: () => !0
      };
    const o = n.getUnitId(), s = i.getSheetId(), l = (S = this._renderManagerService.getRenderById(o)) == null ? void 0 : S.with(ue).ensureSkeleton(s), a = this._renderManagerService.getRenderById(o);
    if (!a || !l)
      return {
        dispose: () => {
        },
        canDispose: () => !0
      };
    const { left: c, top: d, width: u, height: h } = e, g = {
      left: c,
      right: c + u,
      top: d,
      bottom: d + h
    }, { position: m, position$: f, disposable: v } = this._createPositionObserver(g, a, l, i), p = this._globalPopupManagerService.addPopup({
      ...t,
      unitId: o,
      subUnitId: s,
      anchorRect: m,
      anchorRect$: f,
      canvasElement: a.engine.getCanvasElement()
    });
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(p), f.complete(), v.dispose();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== p
    };
  }
  // #endregion
  // #region attach to position
  attachPopupByPosition(e, t, n) {
    var v;
    let i = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), o = i.getActiveSheet();
    if (!o)
      return null;
    const s = i.getUnitId(), l = o.getSheetId();
    if (s !== n.unitId || n.subUnitId !== l)
      return null;
    if (this._isSelectionMoving && !t.showOnSelectionMoving)
      return;
    const a = (v = this._renderManagerService.getRenderById(s)) == null ? void 0 : v.with(ue).getOrCreateSkeleton({
      sheetId: l
    }), c = this._renderManagerService.getRenderById(s);
    if (!c || !a)
      return null;
    const { position: d, position$: u, disposable: h } = this._createPositionObserver(e, c, a, o), { rects$: g, disposable: m } = this._createHiddenRectObserver({
      row: n.row,
      column: n.col,
      worksheet: o,
      skeleton: a,
      currentRender: c
    }), f = this._globalPopupManagerService.addPopup({
      ...t,
      unitId: s,
      subUnitId: l,
      anchorRect: d,
      anchorRect$: u,
      hiddenRects$: g,
      canvasElement: c.engine.getCanvasElement()
    });
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(f), u.complete(), h.dispose(), m.dispose(), i = null, o = null;
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== f
    };
  }
  // #endregion
  // #region attach to absolute position
  attachPopupToAbsolutePosition(e, t, n, i) {
    var g;
    const o = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), s = o.getActiveSheet();
    if (!s)
      return null;
    const l = o.getUnitId(), a = s.getSheetId();
    if (n && l !== n || i && i !== a)
      return null;
    const c = (g = this._renderManagerService.getRenderById(l)) == null ? void 0 : g.with(ue).ensureSkeleton(a), d = this._renderManagerService.getRenderById(l);
    if (!d || !c)
      return null;
    if (this._isSelectionMoving && !t.showOnSelectionMoving)
      return;
    const u = new Me(e), h = this._globalPopupManagerService.addPopup({
      ...t,
      unitId: l,
      subUnitId: a,
      anchorRect: e,
      anchorRect$: u.asObservable(),
      canvasElement: d.engine.getCanvasElement()
    });
    return {
      dispose: () => {
        this._globalPopupManagerService.removePopup(h), u.complete();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== h
    };
  }
  // #endregion
  // #region attach to cell
  /**
   * Bind popup to the right part of cell at(row, col).
   * This popup would move with the cell.
   * @param row
   * @param col
   * @param popup
   * @param _unitId
   * @param _subUnitId
   * @param viewport
   * @returns
   */
  attachPopupToCell(e, t, n, i, o, s) {
    let l = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), a = l.getActiveSheet();
    if (!a)
      return null;
    const c = l.getUnitId(), d = a.getSheetId();
    if (i && c !== i || o && d !== o)
      return null;
    const u = this._renderManagerService.getRenderById(c), h = u == null ? void 0 : u.with(ue).ensureSkeleton(d), g = u == null ? void 0 : u.with(gt);
    if (!u || !h || !g)
      return null;
    if (this._isSelectionMoving && !n.showOnSelectionMoving)
      return;
    const m = s != null ? s : ch(e, t, u.scene, a);
    if (!m)
      return null;
    const { position: f, position$: v, disposable: p, updateRowCol: S } = this._createCellPositionObserver(e, t, u, h, m), { rects$: w, disposable: C } = this._createHiddenRectObserver({
      row: e,
      column: t,
      worksheet: a,
      skeleton: h,
      currentRender: u
    }), I = this._globalPopupManagerService.addPopup({
      ...n,
      unitId: c,
      subUnitId: d,
      anchorRect: f,
      anchorRect$: v,
      canvasElement: u.engine.getCanvasElement(),
      hiddenRects$: w
    }), R = new ht();
    R.add(p), R.add(We(() => {
      this._globalPopupManagerService.removePopup(I), v.complete();
    })), R.add(C);
    const y = { startRow: e, endRow: e, startColumn: t, endColumn: t };
    return R.add(this._refRangeService.watchRange(c, d, y, (M, E) => {
      E ? S(E.startRow, E.startColumn) : R.dispose();
    })), {
      dispose() {
        R.dispose(), a = null, l = null;
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== I
    };
  }
  /**
   * attach Comp to floatDOM
   * @param range
   * @param popup
   * @param _unitId
   * @param _subUnitId
   * @param viewport
   * @param showOnSelectionMoving
   */
  attachRangePopup(e, t, n, i, o, s = !1) {
    const l = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), a = l.getActiveSheet();
    if (!a)
      return null;
    const c = l.getUnitId(), d = a.getSheetId();
    if (n && c !== n || i && d !== i)
      return null;
    const u = this._renderManagerService.getRenderById(c), h = u == null ? void 0 : u.with(ue).getOrCreateSkeleton({
      sheetId: d
    }), g = u == null ? void 0 : u.with(gt);
    if (!u || !h || !g)
      return null;
    if (g.selectionMoving && !s)
      return;
    const m = o != null ? o : ch(e.startRow, e.startColumn, u.scene, a);
    if (!m)
      return null;
    const { position: f, position$: v, disposable: p, updateRange: S, topLeftPos$: w, rightBottomPos$: C } = this._createRangePositionObserver(e, u, h, m), { rects$: I, disposable: R } = this._createHiddenRectObserver({
      row: e.startRow,
      column: e.startColumn,
      worksheet: a,
      skeleton: h,
      currentRender: u
    }), y = this._globalPopupManagerService.addPopup({
      ...t,
      unitId: c,
      subUnitId: d,
      anchorRect: f,
      anchorRect$: v,
      canvasElement: u.engine.getCanvasElement(),
      hiddenRects$: I
    }), M = new ht();
    M.add(p), M.add(We(() => {
      this._globalPopupManagerService.removePopup(y), w.complete(), C.complete();
    })), M.add(R);
    const E = { ...e };
    return M.add(this._refRangeService.watchRange(c, d, E, (T, P) => {
      P ? S(P) : M.dispose();
    })), {
      dispose() {
        M.dispose();
      },
      canDispose: () => this._globalPopupManagerService.activePopupId !== y
    };
  }
  /**
   *
   * @param initialRow
   * @param initialCol
   * @param currentRender
   * @param skeleton
   * @param activeViewport
   */
  _createCellPositionObserver(e, t, n, i, o) {
    let s = e, l = t;
    const a = this._calcCellPositionByCell(s, l, n, i, o), c = new Me(a), d = () => c.next(this._calcCellPositionByCell(s, l, n, i, o)), u = new ht();
    return u.add(n.engine.clientRect$.subscribe(() => d())), u.add(Ws(n.engine.onTransformChange$).pipe(Ys(16)).subscribe(() => d())), u.add(this._commandService.onCommandExecuted((g) => {
      if (g.id === er.id && g.params.rowsAutoHeightInfo.findIndex((f) => f.row === s) > -1) {
        d();
        return;
      }
      (Xs.indexOf(g.id) > -1 || g.id === gn.id || g.id === Jt.id) && d();
    })), {
      position$: c,
      disposable: u,
      position: a,
      updateRowCol: (g, m) => {
        s = g, l = m, d();
      }
    };
  }
  // TODO @lumixraku to a normal function, not method.
  _calcCellPositionByCell(e, t, n, i, o) {
    const { scene: s, engine: l } = n;
    if (i._disposed || s._disposed)
      return {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0
      };
    const a = i.getCellWithCoordByIndex(e, t), c = a.isMergedMainCell ? a.mergeInfo : a, { scaleX: d, scaleY: u } = s.getAncestorScale(), h = {
      x: o.viewportScrollX,
      y: o.viewportScrollY
    }, g = l.getCanvasElement();
    if (!g)
      return {
        left: 0,
        right: 0,
        top: 0,
        bottom: 0
      };
    const m = g.getBoundingClientRect(), f = gc(g.style.width), { top: v, left: p, width: S } = m, w = S / f;
    return {
      left: (c.startX - h.x) * w * d + p,
      right: (c.endX - h.x) * w * d + p,
      top: (c.startY - h.y) * w * u + v,
      bottom: (c.endY - h.y) * w * u + v
    };
  }
  // #endregion
  /**
   * Unlike _createCellPositionObserver, this accept a range not a single cell.
   * @param initialRow
   * @param initialCol
   * @param currentRender
   * @param skeleton
   * @param activeViewport
   */
  _createRangePositionObserver(e, t, n, i) {
    let { startRow: o, startColumn: s, endRow: l, endColumn: a } = e;
    const c = this._calcCellPositionByCell(o, s, t, n, i), d = new Me(c), u = this._calcCellPositionByCell(l, a, t, n, i), h = new Me(u), g = () => {
      const S = this._calcCellPositionByCell(o, s, t, n, i), w = this._calcCellPositionByCell(l, a, t, n, i);
      d.next(S), h.next(w);
    }, m = new ht();
    m.add(t.engine.clientRect$.subscribe(() => g())), m.add(this._commandService.onCommandExecuted((S) => {
      if (S.id === er.id && S.params.rowsAutoHeightInfo.findIndex((C) => C.row === o) > -1) {
        g();
        return;
      }
      (Xs.indexOf(S.id) > -1 || S.id === gn.id || S.id === Jt.id) && g();
    }));
    const f = (S) => {
      o = S.startRow, s = S.startColumn, l = S.endRow, a = S.endColumn, g();
    }, v = d.pipe(
      Be((S) => {
        const w = this._calcCellPositionByCell(l, a, t, n, i);
        return {
          top: S.top,
          left: S.left,
          right: w.right,
          bottom: w.bottom
        };
      })
    ), p = {
      top: c.top,
      left: c.left,
      right: u.right,
      bottom: u.bottom
    };
    return {
      position$: v,
      position: p,
      updateRange: f,
      topLeftPos$: d,
      rightBottomPos$: h,
      disposable: m
    };
  }
};
yi = oR([
  ur(0, N(uC)),
  ur(1, fe),
  ur(2, k),
  ur(3, N(dS)),
  ur(4, W),
  ur(5, _d),
  ur(6, N(Q))
], yi);
function gc(r) {
  return Number.parseInt(r.replace("px", ""));
}
var sR = Object.getOwnPropertyDescriptor, lR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? sR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, aR = (r, e) => (t, n) => e(t, n, r);
let Mi = class extends oe {
  constructor(e) {
    super();
    _(this, "_cellPopupMap", /* @__PURE__ */ new Map());
    _(this, "_change$", new He());
    _(this, "change$", this._change$.asObservable());
    this._sheetCanvasPopManagerService = e;
  }
  _ensureCellPopupMap(e, t) {
    let n = this._cellPopupMap.get(e);
    n || (n = /* @__PURE__ */ new Map(), this._cellPopupMap.set(e, n));
    let i = n.get(t);
    return i || (i = new Ge(), n.set(t, i)), i;
  }
  showPopup(e, t) {
    var u, h;
    const { direction: n = "horizontal" } = t, { unitId: i, subUnitId: o, row: s, col: l } = e, a = this._ensureCellPopupMap(i, o), c = (u = a.getValue(s, l)) == null ? void 0 : u[n];
    t.id = (h = t.id) != null ? h : xn();
    const d = () => {
      var v;
      const g = a.getValue(s, l);
      if (!g)
        return;
      const m = g[n];
      if (!m)
        return;
      const f = m == null ? void 0 : m.popups.findIndex((p) => p.id === t.id && p.componentKey === t.componentKey);
      m == null || m.popups.splice(f, 1), m.popups.length === 0 && ((v = m.disposable) == null || v.dispose(), g[n] = void 0), this._change$.next({
        ...e,
        direction: n
      });
    };
    if (c)
      c.popups.push(t), c.popups.sort((g, m) => g.priority - m.priority);
    else {
      const g = this._sheetCanvasPopManagerService.attachPopupToCell(
        s,
        l,
        {
          ...t,
          direction: n,
          componentKey: hu,
          extraProps: {
            ...e,
            direction: n
          },
          noPushMinimumGap: !0,
          autoRelayout: !1,
          zIndex: 90
        },
        i,
        o
      );
      a.setValue(s, l, {
        ...a.getValue(s, l),
        [n]: {
          disposable: g,
          popups: [t]
        }
      });
    }
    return this._change$.next({
      ...e,
      direction: n
    }), We(d);
  }
  getPopups(e, t, n, i, o) {
    var l, a;
    return ((a = (l = this._ensureCellPopupMap(e, t).getValue(n, i)) == null ? void 0 : l[o]) == null ? void 0 : a.popups) || [];
  }
};
Mi = lR([
  aR(0, N(yi))
], Mi);
const Vf = (r) => {
  const { popup: e } = r, t = e.extraProps, { row: n, col: i, direction: o, unitId: s, subUnitId: l } = t, a = L(Mi);
  dt(
    Ct(() => a.change$.pipe(
      qo((u) => u.row === n && u.col === i && u.direction === o)
    ), [a, n, i, o])
  );
  const c = a.getPopups(s, l, n, i, o), d = L(kt);
  return /* @__PURE__ */ b("div", { "data-u-comp": "cell-popup", className: "univer-ml-px univer-flex univer-flex-col", children: c.map((u) => {
    var g;
    const h = d.get(u.componentKey);
    return h ? /* @__PURE__ */ b(h, { popup: u }, (g = u.id) != null ? g : u.componentKey) : null;
  }) });
}, Hh = (r) => {
  const {
    inputId: e,
    state: t = !1,
    type: n = "range",
    confirm: i,
    cancel: o,
    name: s,
    formulaOrRefString: l,
    comment: a = "",
    localSheetId: c = Vc,
    hidden: d = !1,
    // excel
    id: u
  } = r, g = L(k).getCurrentUnitForType(O.UNIVER_SHEET), m = L(xe), f = L(Jo), v = L(rm), p = L(nm), S = L(kt), w = Ct(() => S.get(hm), []), C = Ct(() => S.get(Ld), []);
  if (g == null)
    return;
  const I = Ct(() => g.getUnitId(), []), R = Ct(() => g.getActiveSheet().getSheetId(), []), [y, M] = re(s), [E, T] = re(l), [P, H] = re(a), [A, x] = re(c), [V, D] = re(""), [X, B] = re(n), [j, G] = re(!0), ge = [{
    label: m.t("definedName.scopeWorkbook"),
    value: Vc
  }], Re = (me) => !im(me);
  Ee(() => {
    G(!0), M(s), H(a), x(c);
    let me = l;
    l.substring(0, 1) === Yr.EQUALS ? B("formula") : Re(l) ? (B("formula"), me = Yr.EQUALS + l) : B("range"), T(me), D("");
  }, [t]), g.getSheetOrders().forEach((me) => {
    const _e = g.getSheetBySheetId(me);
    ge.push({
      label: (_e == null ? void 0 : _e.getName()) || "",
      value: me
    });
  });
  const be = (me) => {
    T(me);
  }, Ne = (me) => {
    T(me || "");
  }, Z = () => {
    if (y.length === 0) {
      D(m.t("definedName.nameEmpty"));
      return;
    }
    if (f.getValueByName(I, y) != null && (u == null || u.length === 0)) {
      D(m.t("definedName.nameDuplicate"));
      return;
    }
    if (!de.isValidParameter(y) || vC(y) || !de.isStartValidPosition(y) && !WS(y.substring(0, 1))) {
      D(m.t("definedName.nameInvalid"));
      return;
    }
    if (g.getSheetOrders().map((le) => {
      var it;
      return ((it = g.getSheetBySheetId(le)) == null ? void 0 : it.getName()) || "";
    }).includes(y)) {
      D(m.t("definedName.nameSheetConflict"));
      return;
    }
    if (E.length === 0) {
      D(m.t("definedName.formulaOrRefStringEmpty"));
      return;
    }
    if (!j) {
      D(m.t("definedName.formulaOrRefStringInvalid"));
      return;
    }
    if (v.hasExecutor(y.toUpperCase())) {
      D(m.t("definedName.nameConflict"));
      return;
    }
    const _e = g.getActiveSheet().getName();
    i && i({
      id: u || "",
      name: y,
      formulaOrRefString: p.convertRefersToAbsolute(E, wu.ALL, wu.ALL, _e),
      comment: P,
      localSheetId: A
    });
  }, ee = (me) => {
    const _e = me;
    _e === "formula" ? l[0] === Yr.EQUALS ? T(l) : T(`${Yr.EQUALS}`) : l[0] === Yr.EQUALS ? T("") : T(l), B(_e);
  }, ne = Tn(null), [pe, Ue] = re(!1);
  return Jg((me) => {
    var le;
    ((le = ne.current) == null ? void 0 : le.isClickOutSide(me)) && Ue(!1);
  }), /* @__PURE__ */ q(
    "div",
    {
      className: Te("univer-grid univer-space-y-2 univer-pb-1", Vd, {
        "univer-hidden": !t
      }),
      children: [
        /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
          Zs,
          {
            className: "univer-w-full",
            placeholder: m.t("definedName.inputNamePlaceholder"),
            value: y,
            allowClear: !0,
            onChange: M
          }
        ) }),
        /* @__PURE__ */ b("div", { children: /* @__PURE__ */ q(Dc, { value: X, onChange: ee, children: [
          /* @__PURE__ */ b(Qr, { value: "range", children: m.t("definedName.ratioRange") }),
          /* @__PURE__ */ b(Qr, { value: "formula", children: m.t("definedName.ratioFormula") })
        ] }) }),
        X === "range" ? w && /* @__PURE__ */ b(
          w,
          {
            unitId: I,
            subUnitId: R,
            initialValue: E,
            onChange: (me, _e) => be(_e),
            supportAcrossSheet: !0
          }
        ) : C && /* @__PURE__ */ b("div", { className: "univer-relative univer-mt-4 univer-h-full", children: /* @__PURE__ */ b("div", { className: "univer-relative univer-h-8 univer-select-none", children: /* @__PURE__ */ b(
          C,
          {
            ref: ne,
            className: Te("univer-box-border univer-h-8 univer-w-full univer-cursor-pointer univer-items-center univer-rounded-lg univer-bg-white univer-pt-2 univer-transition-colors hover:univer-border-primary-600 dark:!univer-bg-gray-700 dark:!univer-text-white [&>div:first-child]:univer-px-2.5 [&>div]:univer-h-5 [&>div]:univer-ring-transparent", Li),
            initValue: E,
            unitId: I,
            subUnitId: R,
            isFocus: pe,
            isSupportAcrossSheet: !0,
            onChange: (me = "") => {
              Ne(me || "");
            },
            onVerify: (me) => {
              G(me);
            },
            onFocus: () => Ue(!0)
          }
        ) }) }),
        /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
          dm,
          {
            className: "univer-w-full",
            value: A,
            options: ge,
            onChange: x
          }
        ) }),
        /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
          Zs,
          {
            className: "univer-w-full",
            placeholder: m.t("definedName.inputCommentPlaceholder"),
            value: P,
            onChange: H,
            allowClear: !0
          }
        ) }),
        /* @__PURE__ */ q(
          "div",
          {
            className: Te("univer-items-center univer-gap-1 univer-text-sm univer-text-red-500", {
              "univer-hidden": V.length === 0,
              "univer-flex": V.length !== 0
            }),
            children: [
              /* @__PURE__ */ b("span", { children: V }),
              /* @__PURE__ */ b(nu, {})
            ]
          }
        ),
        /* @__PURE__ */ q("div", { className: "univer-flex univer-gap-2", children: [
          /* @__PURE__ */ b(
            jt,
            {
              onClick: () => {
                o == null || o();
              },
              children: m.t("definedName.cancel")
            }
          ),
          /* @__PURE__ */ b(
            jt,
            {
              variant: "primary",
              onClick: Z,
              children: m.t("definedName.confirm")
            }
          )
        ] })
      ]
    }
  );
}, Nf = () => {
  const r = L(W), t = L(k).getCurrentUnitOfType(O.UNIVER_SHEET), n = L(xe), i = L(Jo), o = L(Q);
  if (t == null)
    return;
  const s = t.getUnitId(), l = () => {
    const P = i.getDefinedNameMap(s);
    return P ? Array.from(Object.values(P)) : [];
  }, [a, c] = re(!1), [d, u] = re(l()), [h, g] = re(null), [m, f] = re();
  Ee(() => {
    const P = i.update$.subscribe(() => {
      u(l());
    });
    return () => {
      P.unsubscribe();
    };
  }, []);
  const v = (P) => {
    const { name: H, formulaOrRefString: A, comment: x, localSheetId: V, hidden: D } = P;
    let X = P.id;
    if (X == null || X.length === 0)
      X = xn(10), r.executeCommand(uS.id, { id: X, unitId: s, name: H, formulaOrRefString: A, comment: x, localSheetId: V, hidden: D });
    else {
      const B = { id: X, unitId: s, name: H, formulaOrRefString: A, comment: x, localSheetId: V, hidden: D };
      r.executeCommand(hS.id, B);
    }
    c(!1), g(null);
  }, p = (P) => {
    f(P);
  };
  function S() {
    f(null);
  }
  function w(P) {
    const H = i.getValueById(s, P);
    r.executeCommand(gS.id, { ...H, unitId: s }), f(null);
  }
  const C = async (P) => {
    const { formulaOrRefString: H, id: A } = P, x = i.getWorksheetByRef(s, H);
    if (!x)
      return;
    x.isSheetHidden() && await r.executeCommand(pd.id, { unitId: s, subUnitId: x.getSheetId() }), i.focusRange(s, A);
  }, I = () => {
    const P = d.length + 1, H = n.t("definedName.defaultName") + P;
    if (i.getValueByName(s, H) == null)
      return H;
    let A = P + 1;
    for (; ; ) {
      const x = n.t("definedName.defaultName") + A;
      if (i.getValueByName(s, x) == null)
        return x;
      A++;
    }
  }, R = () => {
    var x;
    const P = (x = t.getActiveSheet()) == null ? void 0 : x.getName();
    if (!P)
      return "";
    const H = o.getCurrentSelections();
    return H == null ? "" : H.map((V) => om(P, V.range)).join(",");
  }, y = () => {
    c(!1), g(null);
  }, M = () => {
    c(!0), g(null);
  }, E = (P) => {
    c(!1), g(P);
  }, T = (P) => {
    const H = t.getSheetBySheetId(P);
    return H == null ? "" : H.getName();
  };
  return /* @__PURE__ */ b(
    "div",
    {
      "data-u-comp": "defined-name-container",
      className: "univer-relative univer-box-border univer-w-full",
      children: /* @__PURE__ */ q("div", { className: Te("univer-w-full univer-overflow-hidden univer-overflow-y-auto", ra), children: [
        /* @__PURE__ */ q("div", { className: "univer-mb-4", children: [
          /* @__PURE__ */ q(
            jt,
            {
              className: Te(
                "univer-w-full",
                {
                  "univer-hidden": a
                }
              ),
              onClick: M,
              children: [
                /* @__PURE__ */ b(ru, {}),
                /* @__PURE__ */ b("span", { className: "univer-ml-1", children: n.t("definedName.addButton") })
              ]
            }
          ),
          a && /* @__PURE__ */ b(
            Hh,
            {
              confirm: v,
              cancel: y,
              state: a,
              inputId: "insertDefinedName",
              name: I(),
              formulaOrRefString: R()
            }
          )
        ] }, "insertDefinedName"),
        d.map((P, H) => /* @__PURE__ */ q(
          "div",
          {
            className: "univer-relative univer-w-full univer-divide-x-0 univer-divide-y univer-divide-solid univer-divide-gray-200 dark:!univer-divide-gray-600",
            children: [
              /* @__PURE__ */ q(
                "div",
                {
                  className: Te("univer-group univer-relative univer-flex univer-w-full univer-cursor-default univer-select-none univer-items-center univer-justify-between univer-rounded-md univer-p-2 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700", {
                    "univer-hidden": P.id === h
                  }),
                  onClick: () => {
                    C(P);
                  },
                  children: [
                    /* @__PURE__ */ q("div", { title: P.comment, children: [
                      /* @__PURE__ */ q(
                        "div",
                        {
                          className: "univer-my-1 univer-max-h-[100px] univer-max-w-[190px] univer-truncate univer-text-sm univer-font-medium univer-text-gray-900 dark:!univer-text-white",
                          children: [
                            P.name,
                            /* @__PURE__ */ b("span", { className: "univer-text-xxs univer-ml-1 univer-text-gray-400", children: P.localSheetId === Vc || P.localSheetId == null ? "" : T(P.localSheetId) })
                          ]
                        }
                      ),
                      /* @__PURE__ */ b(
                        "div",
                        {
                          className: "univer-my-1 univer-max-h-[100px] univer-w-full univer-max-w-[190px] univer-truncate univer-text-xs univer-text-gray-500",
                          title: P.formulaOrRefString,
                          children: P.formulaOrRefString
                        }
                      )
                    ] }),
                    /* @__PURE__ */ q(
                      "div",
                      {
                        className: "univer-absolute univer-right-5 univer-top-1/2 univer-hidden -univer-translate-y-1/2 univer-cursor-pointer univer-items-center univer-justify-end univer-gap-7 univer-text-xs univer-text-primary-600 group-hover:univer-flex dark:hover:!univer-bg-gray-600",
                        children: [
                          /* @__PURE__ */ b(Zn, { title: n.t("definedName.updateButton"), placement: "top", children: /* @__PURE__ */ b(
                            "a",
                            {
                              className: "univer-rounded univer-p-1 hover:univer-bg-gray-100",
                              onClick: (A) => {
                                A.stopPropagation(), E(P.id);
                              },
                              children: /* @__PURE__ */ b(Gm, {})
                            }
                          ) }),
                          /* @__PURE__ */ b(Zn, { title: n.t("definedName.deleteButton"), placement: "top", children: /* @__PURE__ */ b(
                            "a",
                            {
                              className: "univer-rounded univer-p-1 univer-text-red-600 hover:univer-bg-gray-100",
                              onClick: (A) => {
                                A.stopPropagation(), p(P.id);
                              },
                              children: /* @__PURE__ */ b(Pa, {})
                            }
                          ) })
                        ]
                      }
                    )
                  ]
                }
              ),
              /* @__PURE__ */ b(
                bC,
                {
                  visible: m === P.id,
                  onClose: S,
                  onConfirm: () => {
                    w(P.id);
                  },
                  children: n.t("definedName.deleteConfirmText")
                }
              ),
              P.id === h && /* @__PURE__ */ b(
                Hh,
                {
                  confirm: v,
                  cancel: y,
                  state: P.id === h,
                  id: P.id,
                  inputId: P.id + H,
                  name: P.name,
                  formulaOrRefString: P.formulaOrRefString,
                  comment: P.comment,
                  localSheetId: P.localSheetId
                }
              )
            ]
          },
          H
        ))
      ] })
    }
  );
}, kf = {
  id: ug.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  binding: Y.Digit9 | ve.CTRL_COMMAND
}, Df = {
  id: hg.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  binding: Y.Digit0 | ve.CTRL_COMMAND | ve.SHIFT
}, Lf = {
  id: Ut.id,
  description: "shortcut.sheet.select-below-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_DOWN,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.DOWN
  }
}, Wf = {
  id: Ut.id,
  description: "shortcut.sheet.select-up-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_UP,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.UP
  }
}, Bf = {
  id: Ut.id,
  description: "shortcut.sheet.select-left-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_LEFT,
  priority: 100,
  preconditions: Sm,
  staticParameters: {
    direction: U.LEFT
  }
}, Ff = {
  id: Ut.id,
  description: "shortcut.sheet.select-right-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_RIGHT,
  priority: 100,
  preconditions: Sm,
  staticParameters: {
    direction: U.RIGHT
  }
}, Uf = {
  id: Wn.id,
  description: "shortcut.sheet.select-next-cell",
  group: "3_sheet-view",
  binding: Y.TAB,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.RIGHT,
    keycode: Y.TAB
  }
}, Xf = {
  id: Wn.id,
  description: "shortcut.sheet.select-previous-cell",
  group: "3_sheet-view",
  binding: Y.TAB | ve.SHIFT,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.LEFT,
    keycode: Y.TAB
  }
}, zf = {
  id: Wn.id,
  description: "shortcut.sheet.select-below-cell",
  group: "3_sheet-view",
  binding: Y.ENTER,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.DOWN,
    keycode: Y.ENTER
  }
}, jf = {
  id: Wn.id,
  description: "shortcut.sheet.select-up-cell",
  group: "3_sheet-view",
  binding: Y.ENTER | ve.SHIFT,
  priority: 100,
  preconditions: Ve,
  staticParameters: {
    direction: U.UP,
    keycode: Y.ENTER
  }
}, Yf = {
  id: Ut.id,
  description: "shortcut.sheet.select-below-value-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_DOWN | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.DOWN,
    jumpOver: Ln.moveGap
  }
}, Zf = {
  id: Ut.id,
  description: "shortcut.sheet.select-up-value-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_UP | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.UP,
    jumpOver: Ln.moveGap
  }
}, Gf = {
  id: Ut.id,
  description: "shortcut.sheet.select-left-value-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_LEFT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.LEFT,
    jumpOver: Ln.moveGap
  }
}, qf = {
  id: Ut.id,
  description: "shortcut.sheet.select-right-value-cell",
  group: "3_sheet-view",
  binding: Y.ARROW_RIGHT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.RIGHT,
    jumpOver: Ln.moveGap
  }
}, Qf = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-down",
  group: "3_sheet-view",
  binding: Y.ARROW_DOWN | ve.SHIFT,
  preconditions: Ve,
  staticParameters: {
    direction: U.DOWN
  }
}, Kf = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-up",
  group: "3_sheet-view",
  binding: Y.ARROW_UP | ve.SHIFT,
  preconditions: Ve,
  staticParameters: {
    direction: U.UP
  }
}, Jf = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-left",
  group: "3_sheet-view",
  binding: Y.ARROW_LEFT | ve.SHIFT,
  preconditions: Ve,
  staticParameters: {
    direction: U.LEFT
  }
}, $f = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-right",
  group: "3_sheet-view",
  binding: Y.ARROW_RIGHT | ve.SHIFT,
  preconditions: Ve,
  staticParameters: {
    direction: U.RIGHT
  }
}, ep = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-to-below-gap",
  group: "3_sheet-view",
  binding: Y.ARROW_DOWN | ve.SHIFT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.DOWN,
    jumpOver: Ln.moveGap
  }
}, tp = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-to-up-gap",
  group: "3_sheet-view",
  binding: Y.ARROW_UP | ve.SHIFT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.UP,
    jumpOver: Ln.moveGap
  }
}, np = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-to-left-gap",
  group: "3_sheet-view",
  binding: Y.ARROW_LEFT | ve.SHIFT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.LEFT,
    jumpOver: Ln.moveGap
  }
}, rp = {
  id: Gt.id,
  description: "shortcut.sheet.expand-selection-to-right-gap",
  group: "3_sheet-view",
  binding: Y.ARROW_RIGHT | ve.SHIFT | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    direction: U.RIGHT,
    jumpOver: Ln.moveGap
  }
}, ip = {
  id: Ra.id,
  description: "shortcut.sheet.select-all",
  group: "3_sheet-view",
  binding: Y.A | ve.CTRL_COMMAND,
  preconditions: Ve,
  staticParameters: {
    expandToGapFirst: !0,
    loop: !0
  }
}, op = {
  id: Bi.id,
  description: "shortcut.sheet.set-bold",
  group: "4_sheet-edit",
  preconditions: (r) => Ve(r),
  binding: Y.B | ve.CTRL_COMMAND
}, sp = {
  id: Fi.id,
  description: "shortcut.sheet.set-italic",
  group: "4_sheet-edit",
  preconditions: (r) => Ve(r),
  binding: Y.I | ve.CTRL_COMMAND
}, lp = {
  id: Ui.id,
  description: "shortcut.sheet.set-underline",
  group: "4_sheet-edit",
  preconditions: (r) => Ve(r),
  binding: Y.U | ve.CTRL_COMMAND
}, ap = {
  id: Xi.id,
  description: "shortcut.sheet.set-strike-through",
  group: "4_sheet-edit",
  preconditions: (r) => Ve(r),
  binding: Y.X | ve.SHIFT | ve.CTRL_COMMAND
}, cp = {
  id: pr.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  binding: Y.DELETE,
  mac: Y.BACKSPACE
}, dp = {
  id: pr.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  mac: Y.DELETE
}, up = {
  id: pr.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  binding: ve.SHIFT + Y.BACKSPACE
}, hp = {
  id: Yd.id,
  // when focusing on any other input tag do not trigger this shortcut
  preconditions: (r) => Ve(r),
  binding: ve.SHIFT + Y.DELETE
}, gp = {
  id: os.id,
  description: "shortcut.sheet.zoom-in",
  binding: Y.EQUAL | ve.CTRL_COMMAND,
  group: "3_sheet-view",
  preconditions: Ve,
  priority: 1,
  staticParameters: {
    delta: 0.2
  }
}, mp = {
  id: ad.id,
  binding: Y.EQUAL | ve.CTRL_COMMAND
}, fp = {
  id: os.id,
  description: "shortcut.sheet.zoom-out",
  binding: Y.MINUS | ve.CTRL_COMMAND,
  group: "3_sheet-view",
  preconditions: Ve,
  priority: 1,
  staticParameters: {
    delta: -0.2
  }
}, pp = {
  id: ad.id,
  binding: Y.MINUS | ve.CTRL_COMMAND
}, vp = {
  id: os.id,
  description: "shortcut.sheet.reset-zoom",
  binding: Y.Digit0 | ve.CTRL_COMMAND,
  preconditions: Ve,
  group: "3_sheet-view",
  priority: 1,
  staticParameters: {
    reset: !0
  }
}, Sp = {
  id: ad.id,
  binding: Y.Digit0 | ve.CTRL_COMMAND
};
var cR = Object.getOwnPropertyDescriptor, dR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? cR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Un = (r, e) => (t, n) => e(t, n, r);
let pl = class extends oe {
  constructor(r, e, t, n, i, o, s, l) {
    super(), this._injector = r, this._componentManager = e, this._layoutService = t, this._commandService = n, this._shortcutService = i, this._menuManagerService = o, this._uiPartsService = s, this._configService = l, this._init();
  }
  _init() {
    this._initComponents(), this._initCommands(), this._initMenus(), this._initShortcuts(), this._initWorkbenchParts(), this._initFocusHandler();
  }
  _initComponents() {
    const r = this._componentManager;
    this.disposeWithMe(r.register(Sn, yf)), this.disposeWithMe(r.register(au, Hf)), this.disposeWithMe(r.register(xo, Nf)), this.disposeWithMe(r.register(hu, Vf)), this.disposeWithMe(r.register("HideGridlinesDoubleIcon", su));
  }
  _initCommands() {
    [
      cu,
      sr,
      uu,
      du,
      os,
      Gt,
      Ut,
      Wn,
      Ta,
      Sa,
      Mo,
      Eo,
      ca,
      da,
      mn,
      Hm,
      Ra,
      Jd,
      cd,
      wi,
      tt,
      Ea,
      Bi,
      Fi,
      Ui,
      Xi,
      Mm,
      Em,
      ua,
      ha,
      Io,
      qd,
      dd,
      hd,
      md,
      gd,
      Ca,
      Qd,
      rs,
      wa,
      gn,
      To,
      $n,
      ba,
      _a,
      $d,
      ud,
      ss,
      Jt,
      Ia,
      va,
      vi,
      pi,
      ns,
      ts,
      eu,
      gr,
      _o,
      // permission
      Hn,
      Nm,
      ma,
      ii,
      oi,
      fa,
      pa,
      Ma,
      si,
      li,
      ya,
      is,
      oa,
      sa
    ].forEach((r) => {
      this.disposeWithMe(this._commandService.registerCommand(r));
    });
  }
  _initMenus() {
    this._menuManagerService.mergeMenu(v_);
  }
  _initShortcuts() {
    [
      // selection shortcuts
      Lf,
      Wf,
      Bf,
      Ff,
      Uf,
      Xf,
      zf,
      jf,
      // MoveBackSelectionShortcutItem,
      Yf,
      Zf,
      Gf,
      qf,
      Qf,
      Kf,
      Jf,
      $f,
      ep,
      tp,
      np,
      rp,
      ip,
      // view shortcuts
      gp,
      fp,
      vp,
      Sp,
      mp,
      pp,
      // toggle cell style shortcuts
      op,
      sp,
      lp,
      ap,
      // cell content editing shortcuts
      cp,
      dp,
      up,
      hp,
      ...af(),
      df,
      cf,
      uf,
      mf,
      ff,
      pf,
      Sf,
      hf,
      gf,
      vf,
      // operation shortcuts
      kf,
      Df
    ].forEach((r) => {
      this.disposeWithMe(this._shortcutService.registerShortcut(r));
    });
  }
  _initWorkbenchParts() {
    const r = this._uiPartsService, e = this._injector;
    this.disposeWithMe(r.registerComponent(ti.HEADER, () => ni(I0, e))), this.disposeWithMe(r.registerComponent(ti.FOOTER, () => ni(R0, e))), this.disposeWithMe(r.registerComponent(ti.CONTENT, () => ni(of, e)));
  }
  _initFocusHandler() {
    this.disposeWithMe(
      this._layoutService.registerFocusHandler(O.UNIVER_SHEET, (r) => {
        const e = this._injector.get(fe), t = this._injector.get(k), n = Go(O.UNIVER_DOC, t, e), i = n == null ? void 0 : n.with(Qn);
        i == null || i.focus();
      })
    );
  }
};
pl = dR([
  Un(0, N(Rt)),
  Un(1, N(kt)),
  Un(2, Td),
  Un(3, W),
  Un(4, ta),
  Un(5, Ed),
  Un(6, Od),
  Un(7, Vt)
], pl);
var uR = Object.getOwnPropertyDescriptor, hR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? uR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Ji = (r, e) => (t, n) => e(t, n, r);
const gR = Nn("statusBarPermissionCorrect");
class mR {
  constructor() {
    _(this, "_sum", 0);
    _(this, "_count", 0);
    _(this, "_countNumber", 0);
    _(this, "_min", Number.POSITIVE_INFINITY);
    _(this, "_max", Number.NEGATIVE_INFINITY);
  }
  add(e, t, n) {
    if (!de.isDefine(e == null ? void 0 : e.v))
      return;
    const i = e == null ? void 0 : e.t;
    let { v: o } = e;
    const s = (a) => {
      this._sum += a, this._countNumber++, this._min = Math.min(this._min, a), this._max = Math.max(this._max, a);
    }, l = (a, c, d) => {
      var g;
      if (!((g = a == null ? void 0 : a.n) != null && g.pattern))
        return;
      const { pattern: u } = a.n;
      d[u] || (d[u] = Bt.getFormatInfo(u)), d[u].isDate && s(c);
    };
    if (typeof o == "string" && i === yt.NUMBER) {
      const a = Number(o);
      Number.isNaN(a) || (o = a);
    }
    if (typeof o == "number" && i !== yt.STRING)
      s(o);
    else if (i === yt.NUMBER && e.s) {
      const a = t.get(e.s);
      l(a, o, n);
    }
    this._count++;
  }
  getResults() {
    return {
      sum: this._sum,
      count: this._countNumber,
      // the countA in formula is the count of all values
      countA: this._count,
      min: this._min,
      max: this._max
    };
  }
}
function fR(r) {
  const { sum: e, count: t, countA: n, min: i, max: o } = r.getResults();
  return [
    {
      func: ze.MAX,
      value: o
    },
    {
      func: ze.MIN,
      value: i
    },
    {
      func: na.SUM,
      value: e
    },
    {
      func: ze.COUNTA,
      value: n
    },
    {
      func: ze.COUNT,
      value: t
    },
    {
      func: ze.AVERAGE,
      value: e / t
    }
  ];
}
let Er = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "interceptor", new ki({ STATUS_BAR_PERMISSION_CORRECT: gR }));
    this._univerInstanceService = e, this._selectionManagerService = t, this._statusBarService = n, this._commandService = i, this._numfmtService = o, this._init();
  }
  _init() {
    this._registerSelectionListener();
  }
  _registerSelectionListener() {
    const e = Rc((n) => {
      var o;
      const i = (o = n[n.length - 1]) == null ? void 0 : o.primary;
      this._calculateSelection(
        n.map((s) => s.range),
        i
      );
    }, 100), t = Rc((n) => {
      var o;
      const i = (o = n[n.length - 1]) == null ? void 0 : o.primary;
      this._calculateSelection(
        n.map((s) => s.range),
        i
      );
    }, 500);
    this.disposeWithMe(
      We(
        this._selectionManagerService.selectionMoving$.subscribe((n) => {
          n && t(n);
        })
      )
    ), this.disposeWithMe(
      We(
        this._selectionManagerService.selectionMoveEnd$.subscribe((n) => {
          n && e(n);
        })
      )
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((n) => {
        if (n.id === we.id) {
          const i = this._selectionManagerService.getCurrentSelections();
          i && e(i);
        }
      })
    );
  }
  _clearResult() {
    this._statusBarService.setState(null);
  }
  getRangeStartEndInfo(e, t) {
    return e.rangeType === z.ALL ? {
      startRow: 0,
      startColumn: 0,
      endRow: t.getRowCount() - 1,
      endColumn: t.getColumnCount() - 1
    } : e.rangeType === z.COLUMN ? {
      startRow: 0,
      startColumn: e.startColumn,
      endRow: t.getRowCount() - 1,
      endColumn: e.endColumn
    } : e.rangeType === z.ROW ? {
      startRow: e.startRow,
      startColumn: 0,
      endRow: e.endRow,
      endColumn: t.getColumnCount() - 1
    } : {
      startRow: e.startRow,
      startColumn: e.startColumn,
      endRow: e.endRow,
      endColumn: e.endColumn
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _calculateSelection(e, t) {
    var a;
    const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET);
    if (!n)
      return this._clearResult();
    const i = n.getUnitId(), o = n.getActiveSheet(), s = o == null ? void 0 : o.getSheetId();
    if (!s)
      return this._clearResult();
    const l = {};
    if (this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getSheets().forEach((c) => {
      const d = c.getConfig();
      l[c.getSheetId()] = {
        cellData: new Ge(d.cellData),
        rowCount: d.rowCount,
        columnCount: d.columnCount,
        rowData: d.rowData,
        columnData: d.columnData
      };
    }), e != null && e.length) {
      const c = [];
      e.forEach((S) => {
        const { startRow: w, endRow: C } = S;
        let I = null;
        for (let R = w; R <= C; R++)
          o.getRowVisible(R) ? I === null && (I = R) : I !== null && (c.push({ ...S, startRow: I, endRow: R - 1 }), I = null);
        I !== null && c.push({ ...S, startRow: I, endRow: C });
      });
      const d = Cv(c), u = new mR(), h = n.getStyles(), g = {};
      for (const S of d) {
        const { startRow: w, startColumn: C, endColumn: I, endRow: R } = this.getRangeStartEndInfo(S, o);
        for (let y = w; y <= R; y++)
          for (let M = C; M <= I; M++) {
            const E = o.getCellRaw(y, M);
            u.add(E, h, g);
          }
      }
      const m = fR(u);
      if (m.every((S) => S === void 0))
        return;
      let f = null;
      if (t) {
        const { actualRow: S, actualColumn: w } = t;
        f = (a = this._numfmtService.getValue(i, s, S, w)) == null ? void 0 : a.pattern;
      }
      const p = {
        values: m.filter((S) => S !== void 0),
        pattern: f
      };
      this._statusBarService.setState(p);
    } else
      this._clearResult();
  }
};
Er = hR([
  Ji(0, k),
  Ji(1, N(Q)),
  Ji(2, xa),
  Ji(3, W),
  Ji(4, N(mS))
], Er);
const pR = (r = []) => {
  const e = L(Wi);
  Ee(() => {
    const t = r.map((n) => e.addShape({
      range: n,
      style: {
        fill: "rgba(73, 184, 17, 0.05)",
        strokeWidth: 1,
        stroke: "#49B811",
        widgets: {}
      },
      primary: {
        startColumn: n.startColumn,
        endColumn: n.endColumn,
        startRow: n.startRow,
        endRow: n.endRow,
        actualRow: n.startRow,
        actualColumn: n.startColumn,
        isMerged: !1,
        isMergedMainCell: !1
      }
    }));
    return () => {
      t.forEach((n) => {
        n && e.removeShape(n);
      });
    };
  }, [r]);
};
var vR = Object.getOwnPropertyDescriptor, SR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? vR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Vh = (r, e) => (t, n) => e(t, n, r);
let Ei = class extends oe {
  constructor(e, t) {
    super();
    _(this, "_previousSheetIndex", -1);
    this._commandService = e, this._univerInstanceService = t, this.disposeWithMe(this._commandService.beforeCommandExecuted((n) => {
      if (n.id === On.id)
        return this._beforeAdjustActiveSheetOnRemoveSheet(
          n
        );
    })), this.disposeWithMe(this._commandService.onCommandExecuted((n, i) => {
      if (n.id === On.id)
        return this._adjustActiveSheetOnRemoveSheet(n);
      if (n.id === nr.id && n.params.hidden)
        return this._adjustActiveSheetOnHideSheet(n);
      if (i != null && i.fromCollab) return !1;
      if (n.id === xr.id)
        return this._adjustActiveSheetOnInsertSheet(n);
      if (n.id === nr.id && !n.params.hidden)
        return this._adjustActiveSheetOnShowSheet(n);
      if (n.id === Ie.id)
        return this._adjustActiveSheetOnSelection(n);
    }));
  }
  _adjustActiveSheetOnHideSheet(e) {
    var a;
    const { unitId: t, subUnitId: n } = e.params, i = this._univerInstanceService.getUniverSheetInstance(t);
    if (!i || ((a = i.getActiveSheet()) == null ? void 0 : a.getSheetId()) !== n)
      return;
    const s = i.getActiveSheetIndex(), l = Nh(i, s);
    this._switchToNextSheet(t, l);
  }
  _beforeAdjustActiveSheetOnRemoveSheet(e) {
    const { unitId: t, subUnitId: n } = e.params, i = this._univerInstanceService.getUniverSheetInstance(t);
    if (!i)
      return;
    const o = i.getSheetBySheetId(n);
    o && (this._previousSheetIndex = i.getSheetIndex(o));
  }
  _adjustActiveSheetOnRemoveSheet(e) {
    if (this._previousSheetIndex === -1)
      return;
    const { unitId: t } = e.params, n = this._univerInstanceService.getUniverSheetInstance(t);
    if (!n)
      return;
    if (n.getActiveSheet().getSheetId() === e.params.subUnitId) {
      const o = this._previousSheetIndex, s = o >= 1 ? o - 1 : 0, l = Nh(n, s);
      this._switchToNextSheet(t, l);
    }
  }
  _adjustActiveSheetOnInsertSheet(e) {
    const { unitId: t, sheet: n } = e.params;
    this._switchToNextSheet(t, n.id);
  }
  _adjustActiveSheetOnShowSheet(e) {
    const { unitId: t, subUnitId: n } = e.params;
    this._switchToNextSheet(t, n);
  }
  _adjustActiveSheetOnSelection(e) {
    var i;
    const { unitId: t, subUnitId: n } = e.params;
    n !== ((i = this._univerInstanceService.getUnit(t)) == null ? void 0 : i.getActiveSheet().getSheetId()) && this._switchToNextSheet(t, n);
  }
  _switchToNextSheet(e, t) {
    this._commandService.executeCommand(nt.id, {
      unitId: e,
      subUnitId: t
    });
  }
};
Ei = SR([
  Vh(0, W),
  Vh(1, k)
], Ei);
function Nh(r, e) {
  const t = r.getSheetSize();
  for (let n = e; n > -1; n--) {
    const i = r.getSheetByIndex(n);
    if (!i.getConfig().hidden)
      return i.getSheetId();
  }
  for (let n = e; n < t; n++) {
    const i = r.getSheetByIndex(n);
    if (!i.getConfig().hidden)
      return i.getSheetId();
  }
  throw new Error(
    "[ActiveWorksheetController]: could not find the next unhidden sheet! Collaboration error perhaps."
  );
}
var CR = Object.getOwnPropertyDescriptor, wR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? CR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, kh = (r, e) => (t, n) => e(t, n, r), po = /* @__PURE__ */ ((r) => (r[r.INFO = 0] = "INFO", r[r.WARNING = 1] = "WARNING", r[r.ERROR = 2] = "ERROR", r))(po || {});
let Do = class extends oe {
  constructor(e, t) {
    super();
    _(this, "_currentAlert$", new He());
    _(this, "_currentAlert", /* @__PURE__ */ new Map());
    _(this, "currentAlert$", this._currentAlert$.asObservable());
    this._renderManagerService = e, this._cellPopupManagerService = t, this.disposeWithMe(() => {
      this._currentAlert$.complete();
    });
  }
  get currentAlert() {
    return this._currentAlert;
  }
  showAlert(e) {
    var d;
    let t = this._currentAlert.get(e.key);
    t && t.dispose.dispose(), t ? t.dispose.dispose() : (t = {
      alert: e,
      dispose: {
        dispose() {
        }
      }
    }, this._currentAlert.set(e.key, t));
    const { location: n } = e, { row: i, col: o, unitId: s, subUnitId: l } = n;
    if (!this._renderManagerService.getRenderById(s))
      return;
    const c = this._cellPopupManagerService.showPopup(
      {
        unitId: s,
        subUnitId: l,
        row: i,
        col: o
      },
      {
        componentKey: Cp,
        direction: "horizontal",
        extraProps: {
          alert: e
        },
        priority: 1
      }
    );
    c && (t && ((d = t.dispose) == null || d.dispose()), t.dispose = c), this._currentAlert$.next(Array.from(this._currentAlert.entries()));
  }
  removeAlert(e) {
    const t = this._currentAlert.get(e);
    t && (this._currentAlert.delete(e), t == null || t.dispose.dispose(), this._currentAlert$.next(Array.from(this._currentAlert.entries())));
  }
  clearAlert() {
    this._currentAlert.forEach((e) => {
      e.dispose.dispose();
    }), this._currentAlert.clear(), this._currentAlert$.next(Array.from(this._currentAlert.entries()));
  }
};
Do = wR([
  kh(0, fe),
  kh(1, N(Mi))
], Do);
function bR({ popup: r }) {
  var s;
  const e = (s = r.extraProps) == null ? void 0 : s.alert;
  if (!e)
    return null;
  const { type: t, title: n, message: i } = e, o = {
    [po.ERROR]: /* @__PURE__ */ b(nu, { className: "univer-mr-1.5 univer-text-red-500" }),
    [po.INFO]: /* @__PURE__ */ b(Zm, { className: "univer-mr-1.5 univer-text-blue-500" }),
    [po.WARNING]: /* @__PURE__ */ b(Qm, { className: "univer-mr-1.5 univer-text-yellow-500" })
  };
  return /* @__PURE__ */ q(
    "div",
    {
      className: "univer-z-[100] univer-box-border univer-w-[156px] univer-rounded-lg univer-bg-white univer-px-2 univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white",
      children: [
        /* @__PURE__ */ q(
          "div",
          {
            className: "univer-mb-1.5 univer-flex univer-h-5 univer-flex-row univer-items-center univer-text-sm univer-font-medium",
            children: [
              t ? o[t] : null,
              n
            ]
          }
        ),
        /* @__PURE__ */ b("div", { className: "univer-text-sm", children: i })
      ]
    }
  );
}
const Cp = "univer.sheet.cell-alert";
var _R = Object.getOwnPropertyDescriptor, RR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? _R(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, IR = (r, e) => (t, n) => e(t, n, r);
let vl = class extends oe {
  constructor(r, e) {
    super(), this._context = r, this._componentManager = e, this._initComponent();
  }
  _initComponent() {
    this.disposeWithMe(
      this._componentManager.register(Cp, bR)
    );
  }
};
vl = RR([
  IR(1, N(kt))
], vl);
var yR = Object.getOwnPropertyDescriptor, MR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? yR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Rs = (r, e) => (t, n) => e(t, n, r);
let Ti = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_isPointer", !1);
    this._hoverManagerService = e, this._instanceService = t, this._commandService = n, this._renderManagerService = i, this._initPointerEvent(), this._initHover();
  }
  get _mainComponent() {
    var e;
    return (e = Go(O.UNIVER_SHEET, this._instanceService, this._renderManagerService)) == null ? void 0 : e.mainComponent;
  }
  _initHover() {
    this.disposeWithMe(this._hoverManagerService.currentRichText$.subscribe((e) => {
      var t, n;
      e != null && e.bullet ? (this._isPointer || (t = this._mainComponent) == null || t.setCursor(ye.POINTER), this._isPointer = !0) : (this._isPointer && ((n = this._mainComponent) == null || n.setCursor(ye.AUTO)), this._isPointer = !1);
    }));
  }
  _initPointerEvent() {
    this.disposeWithMe(this._hoverManagerService.currentClickedCell$.subscribe((e) => {
      const { location: t, bullet: n } = e;
      n && this._commandService.executeCommand(fS.id, {
        unitId: t.unitId,
        subUnitId: t.subUnitId,
        row: t.row,
        col: t.col,
        paragraphIndex: n.startIndex
      });
    }));
  }
};
Ti = MR([
  Rs(0, N(Mr)),
  Rs(1, k),
  Rs(2, W),
  Rs(3, fe)
], Ti);
const Dh = 2, ER = [
  { value: "DEFAULT_PASTE", label: "rightClick.paste" },
  { value: "SPECIAL_PASTE_VALUE", label: "rightClick.pasteValue" },
  { value: "SPECIAL_PASTE_FORMAT", label: "rightClick.pasteFormat" },
  { value: "SPECIAL_PASTE_COL_WIDTH", label: "rightClick.pasteColWidth" },
  { value: "SPECIAL_PASTE_BESIDES_BORDER", label: "rightClick.pasteBesidesBorder" },
  { value: "SPECIAL_PASTE_FORMULA", label: "formula.operation.pasteFormula" }
], TR = (r) => {
  var P, H, A, x, V;
  const e = L(k), t = L(fe), n = kr();
  if (!r || !n) return null;
  const i = {
    startRow: r.rows[0],
    startCol: r.cols[0],
    endRow: r.rows[r.rows.length - 1],
    endCol: r.cols[r.cols.length - 1]
  };
  if (i.endRow < 0 || i.endCol < 0)
    return null;
  const o = t.getRenderById(n.getUnitId()), s = o == null ? void 0 : o.with(ue), l = o == null ? void 0 : o.with(gt), a = en(e, t);
  if (!a || !l) return null;
  const { scene: c } = a, d = s == null ? void 0 : s.getCurrentSkeleton(), u = l.getViewPort(), h = c == null ? void 0 : c.scaleX, g = c == null ? void 0 : c.scaleY, m = c == null ? void 0 : c.getViewportScrollXY(u), f = (P = c.getEngine()) == null ? void 0 : P.getCanvas();
  if (!h || !c || !h || !g || !m) return null;
  const v = d == null ? void 0 : d.getNoMergeCellPositionByIndex(i.endRow, i.endCol), p = (H = v == null ? void 0 : v.endX) != null ? H : 0, S = (A = v == null ? void 0 : v.endY) != null ? A : 0, w = (x = Gr(p, h, m)) != null ? x : -9999, C = (V = qr(S, g, m)) != null ? V : -9999, I = f == null ? void 0 : f.getWidth(), R = f == null ? void 0 : f.getHeight();
  if (!I || !R) return null;
  const y = w + 50 <= I, M = C + 50 <= R;
  let E = w, T = C;
  return y || (E = I - 100), M || (T = R - 100), {
    positionX: E,
    positionY: T
  };
}, PR = () => {
  const r = L(nn), e = dt(r.showMenu$, !1), t = dt(r.pasteOptionsCache$, null), n = L(xe), i = L(W), [o, s] = re(!1), [l, a] = re(!1), c = t == null ? void 0 : t.target.pastedRange, d = TR(c);
  if (!d || !e || d.positionX < 50 || d.positionY < 30) return null;
  const u = o || l, h = (g) => {
    a(!1), i.executeCommand(_m.id, { type: g });
  };
  return /* @__PURE__ */ b("div", { className: "univer-absolute univer-inset-0 univer-z-10 univer-size-0", children: /* @__PURE__ */ b(
    "div",
    {
      className: "univer-absolute",
      style: {
        left: d.positionX + Dh,
        top: d.positionY + Dh
      },
      onMouseEnter: () => s(!0),
      onMouseLeave: () => s(!1),
      children: /* @__PURE__ */ b(
        Hd,
        {
          align: "start",
          items: ER.map((g) => ({
            type: "checkbox",
            value: g.value,
            label: n.t(g.label),
            checked: (t == null ? void 0 : t.pasteType) === et[g.value],
            onSelect: () => h(g.value)
          })),
          open: l,
          onOpenChange: a,
          children: /* @__PURE__ */ q(
            "div",
            {
              className: Te("univer-flex univer-items-center univer-gap-2 univer-rounded univer-p-1 hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800", Li, {
                "univer-bg-gray-100 dark:!univer-bg-gray-800": l,
                "univer-bg-white dark:!univer-bg-gray-900": !l
              }),
              children: [
                /* @__PURE__ */ b(
                  $m,
                  {
                    className: "univer-fill-primary-600 univer-text-gray-900 dark:!univer-text-white"
                  }
                ),
                u && /* @__PURE__ */ b(_i, { className: "dark:!univer-text-white" })
              ]
            }
          )
        }
      )
    }
  ) });
}, xR = [
  tt.id,
  Fl.id,
  Jt.id,
  tr.id,
  Xo.id,
  zo.id,
  jo.id,
  Yo.id,
  Ul.id,
  Xl.id,
  ln.id,
  So.id,
  Ie.id,
  wv
];
function OR(r, e, t, n, i) {
  const o = [], s = [];
  if (n.copyType === Yn.CUT) {
    const { undos: l, redos: a } = AR(r, e, i);
    o.push(...a), s.push(...l);
  } else {
    const { undos: l, redos: a } = _p(e, t, i);
    o.push(...a), s.push(...l);
    const { undos: c, redos: d } = HR(e, t, i);
    o.push(...d), s.push(...c);
    const { undos: u, redos: h } = wp(e, r, t, i);
    o.push(...h), s.push(...u);
    const { undos: g, redos: m } = bp(e, r, t, i, !0);
    o.push(...m), s.push(...g);
    const { undos: f, redos: v } = Kc(
      e,
      t,
      i
    );
    o.push(...v), s.push(...f);
  }
  return {
    undos: s,
    redos: o
  };
}
function AR(r, e, t) {
  let n = [], i = [];
  const { range: o, subUnitId: s, unitId: l } = r, { range: a, subUnitId: c } = e, d = a ? Cr(a) : null, u = o ? Cr(o) : null;
  if (u && d) {
    const h = t.get(k), g = t.get(vn), m = h.getUniverSheetInstance(l), f = m == null ? void 0 : m.getSheetBySheetId(s), v = m == null ? void 0 : m.getSheetBySheetId(c);
    if (f && v) {
      const p = new Ge(), S = new Ge(), w = f.getCellMatrix(), C = v.getCellMatrix();
      Ts.foreach(u, (B, j) => {
        p.setValue(B, j, de.deepClone(w.getValue(B, j))), S.setValue(B, j, null);
      });
      const I = new Ge();
      Ts.foreach(d, (B, j) => {
        I.setValue(B, j, de.deepClone(C.getValue(B, j)));
      });
      const R = new Ge();
      Ts.foreach(u, (B, j) => {
        const G = _v(B, j), ge = se.getRelativeRange(G, u), Re = se.getPositionRange(ge, d);
        R.setValue(Re.startRow, Re.startColumn, w.getValue(B, j));
      });
      const y = {
        fromRange: u,
        toRange: d,
        from: {
          value: S.getMatrix(),
          subUnitId: s
        },
        to: {
          value: R.getMatrix(),
          subUnitId: c
        },
        unitId: l
      }, M = {
        fromRange: d,
        toRange: u,
        from: {
          value: p.getMatrix(),
          subUnitId: s
        },
        to: {
          value: I.getMatrix(),
          subUnitId: c
        },
        unitId: l
      }, E = g.onCommandExecute({
        id: Yg.id,
        params: { toRange: d, fromRange: u }
      }), T = f.getMergeData(), P = v.getMergeData(), H = T.filter((B) => se.intersects(B, u)), A = P.filter((B) => se.intersects(B, d)), x = H.map((B) => se.getRelativeRange(B, u)).map((B) => se.getPositionRange(B, d)), V = jl(x), D = [
        {
          id: Qt.id,
          params: {
            unitId: l,
            subUnitId: s,
            ranges: H
          }
        },
        {
          id: Qt.id,
          params: {
            unitId: l,
            subUnitId: s,
            ranges: A
          }
        },
        {
          id: Kt.id,
          params: {
            unitId: l,
            subUnitId: c,
            ranges: V
          }
        }
      ], X = [
        {
          id: Qt.id,
          params: {
            unitId: l,
            subUnitId: c,
            ranges: V
          }
        },
        {
          id: Kt.id,
          params: {
            unitId: l,
            subUnitId: c,
            ranges: A
          }
        },
        {
          id: Kt.id,
          params: {
            unitId: l,
            subUnitId: s,
            ranges: H
          }
        }
      ];
      n = [
        { id: tr.id, params: y },
        ...E.redos,
        ...D,
        {
          id: Ie.id,
          params: {
            unitId: l,
            subUnitId: c,
            selections: [{ range: d }],
            type: At.MOVE_END
          }
        }
      ], i = [
        { id: tr.id, params: M },
        ...E.undos,
        ...X,
        {
          id: Ie.id,
          params: {
            unitId: l,
            subUnitId: s,
            type: At.MOVE_END,
            selections: [{ range: u }]
          }
        }
      ];
    }
  }
  return {
    undos: i,
    redos: n
  };
}
function wp(r, e, t, n) {
  var m;
  const { unitId: i, subUnitId: o, range: s } = r, l = (m = n.get(k).getUniverSheetInstance(i)) == null ? void 0 : m.getSheetBySheetId(o), a = [], c = [], { mapFunc: d } = wr([s]), u = new Ge();
  t.forValue((f, v, p) => {
    var I, R;
    const { row: S, col: w } = d(f, v), C = {
      v: p.v,
      t: p.t
    };
    if (!p.p && p.v && !e) {
      const y = l == null ? void 0 : l.getCellStyle(S, w);
      if (Bo((I = y == null ? void 0 : y.n) == null ? void 0 : I.pattern))
        C.t = yt.STRING;
      else {
        const M = String(p.v), E = Bt.parseValue(M);
        (E == null ? void 0 : E.v) !== void 0 && typeof E.v == "number" && (!E.z && bv(M) ? C.t = yt.FORCE_STRING : C.v = E.v);
      }
    }
    if ((R = p.p) != null && R.body && Zc(p.p.body)) {
      const y = de.deepClone({ p: p.p, v: p.v });
      u.setValue(S, w, y);
    } else
      u.setValue(S, w, de.deepClone(C));
  });
  const h = {
    unitId: i,
    subUnitId: o,
    cellValue: de.deepClone(u.getMatrix())
  };
  a.push({
    id: we.id,
    params: h
  });
  const g = $t(
    n,
    h
  );
  return c.push({
    id: we.id,
    params: g
  }), {
    undos: c,
    redos: a
  };
}
function bp(r, e, t, n, i = !1) {
  var f;
  const o = [], s = [], { unitId: l, subUnitId: a, range: c } = r, d = (f = n.get(k).getUniverSheetInstance(l)) == null ? void 0 : f.getSheetBySheetId(a), u = new Ge(), { mapFunc: h } = wr([c]);
  t.forValue((v, p, S) => {
    var M, E;
    const w = {
      s: Object.assign({}, {
        ...Fo,
        pd: BS,
        bg: null,
        cl: null
      }, S.s)
    }, C = w.s.bd;
    C && (Object.keys(C).length > 0 || (w.s.bd = {
      b: null,
      l: null,
      r: null,
      t: null
    }));
    const { row: I, col: R } = h(v, p), y = d == null ? void 0 : d.getCellStyle(I, R);
    if (S.v && !e && Bo((M = y == null ? void 0 : y.n) == null ? void 0 : M.pattern))
      w.s || (w.s = {}), w.s.n = y == null ? void 0 : y.n;
    else {
      const T = String(S.v), P = Bt.parseValue(T);
      P != null && P.z && (w.s || (w.s = {}), typeof w.s == "object" && ((E = w.s) != null && E.n ? w.s.n.pattern = P.z : w.s.n = { pattern: P.z }));
    }
    u.setValue(I, R, w);
  });
  const g = {
    unitId: l,
    subUnitId: a,
    cellValue: de.deepClone(u.getMatrix())
  };
  o.push({
    id: we.id,
    params: g
  });
  const m = $t(
    n,
    g
  );
  return s.push({
    id: we.id,
    params: m
  }), {
    undos: s,
    redos: o
  };
}
function _p(r, e, t) {
  const n = [], i = [], o = new Ge(), { unitId: s, subUnitId: l, range: a } = r, { mapFunc: c } = wr([a]);
  if (e.forEach((d, u) => {
    Object.keys(u).forEach((h) => {
      const g = Number(h), { row: m, col: f } = c(d, g);
      o.setValue(m, f, { s: null });
    });
  }), o.getLength() > 0) {
    const d = {
      subUnitId: l,
      unitId: s,
      cellValue: de.deepClone(o.getMatrix())
    };
    n.push({
      id: we.id,
      params: d
    });
    const u = $t(
      t,
      d
    );
    i.push({
      id: we.id,
      params: u
    });
  }
  return { undos: i, redos: n };
}
function HR(r, e, t) {
  const n = [], i = [], o = new Ge(), { unitId: s, subUnitId: l, range: a } = r, { mapFunc: c } = wr([a]);
  if (e.forValue((d, u, h) => {
    const { row: g, col: m } = c(d, u);
    o.setValue(g, m, { v: null, p: null });
  }), o.getLength() > 0) {
    const d = {
      subUnitId: l,
      unitId: s,
      cellValue: de.deepClone(o.getMatrix())
    };
    n.push({
      id: we.id,
      params: d
    });
    const u = $t(
      t,
      d
    );
    i.push({
      id: we.id,
      params: u
    });
  }
  return { undos: i, redos: n };
}
function Kc(r, e, t) {
  const n = [], i = [], { unitId: o, subUnitId: s, range: l } = r, { startColumn: a, startRow: c, endColumn: d, endRow: u } = Cr(l), h = [];
  e.forValue((S, w, C) => {
    if (C.rowSpan && C.rowSpan > 1) {
      const I = C.colSpan || 1, R = {
        startRow: c + S,
        endRow: c + S + C.rowSpan - 1,
        startColumn: a + w,
        endColumn: a + w + I - 1
      };
      h.push(R);
    } else if (C.colSpan && C.colSpan > 1) {
      const I = C.rowSpan || 1, R = {
        startRow: c + S,
        endRow: c + S + I - 1,
        startColumn: a + w,
        endColumn: a + w + C.colSpan - 1
      };
      h.push(R);
    }
  });
  const m = t.get(k).getUniverSheetInstance(o), f = m == null ? void 0 : m.getSheetBySheetId(s);
  if (m && f) {
    const w = f.getMergeData().filter(
      (R) => se.intersects({ startRow: c, startColumn: a, endRow: u, endColumn: d }, R)
    ), C = {
      unitId: o,
      subUnitId: s,
      ranges: w
    };
    n.push({
      id: Qt.id,
      params: C
    });
    const I = zl(
      t,
      C
    );
    i.push({
      id: Kt.id,
      params: I
    });
  }
  const v = {
    unitId: o,
    subUnitId: s,
    ranges: h
  };
  h.length > 0 && n.push({
    id: Kt.id,
    params: v
  });
  const p = Yl(
    t,
    v
  );
  return h.length > 0 && i.push({
    id: Qt.id,
    params: p
  }), { undos: i, redos: n };
}
function VR(r) {
  if (!r.includes("\r") && de.isLegalUrl(r)) {
    const n = xn(), i = `${r}`, o = {
      startIndex: 0,
      endIndex: i.length - 1,
      rangeId: n,
      rangeType: sd.HYPERLINK,
      properties: {
        url: r
      }
    };
    return {
      dataStream: `${i}\r
`,
      paragraphs: [{
        startIndex: i.length
      }],
      customRanges: [o]
    };
  }
  let e = r.replace(/(\r\n|\n)/g, "\r");
  e.endsWith(`\r
`) || (e += `\r
`);
  const t = [];
  for (let n = 0; n < e.length; n++)
    e[n] === "\r" && t.push({ startIndex: n });
  return {
    dataStream: e,
    paragraphs: t,
    sectionBreaks: [{ startIndex: e.indexOf(`
`) }]
  };
}
var NR = Object.getOwnPropertyDescriptor, kR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? NR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, rn = (r, e) => (t, n) => e(t, n, r);
const DR = [
  Yo.id,
  jo.id,
  zo.id,
  Xo.id,
  tr.id,
  Ul.id,
  Xl.id
];
let Tr = class extends kn {
  constructor(e, t, n, i, o, s, l, a, c, d) {
    super();
    _(this, "_refreshOptionalPaste$", new He());
    _(this, "refreshOptionalPaste$", this._refreshOptionalPaste$.asObservable());
    this._injector = e, this._instanceService = t, this._renderManagerService = n, this._commandService = i, this._contextService = o, this._configService = s, this._sheetClipboardService = l, this._messageService = a, this._localService = c, this._uiPartsService = d, this._init(), this._initCommandListener(), this._initUIComponents(), this._pasteWithDoc();
  }
  refreshOptionalPaste() {
    this._refreshOptionalPaste$.next(Math.random());
  }
  _pasteWithDoc() {
    var n;
    const e = (i) => {
      i.onPaste$.pipe(ui(this.dispose$)).subscribe((o) => {
        var d, u;
        if (!Ve(this._contextService))
          return;
        o.event.preventDefault();
        const s = o.event, l = (d = s.clipboardData) == null ? void 0 : d.getData("text/html"), a = (u = s.clipboardData) == null ? void 0 : u.getData("text/plain"), c = this._resolveClipboardFiles(s.clipboardData);
        this._commandService.executeCommand(Xc.id, { htmlContent: l, textContent: a, files: c });
      }), i == null || i.onKeydown$.subscribe((o) => {
        o.event.key === "Escape" && this._sheetClipboardService.removeMarkSelection();
      });
    };
    let t = (n = this._renderManagerService.getRenderById(Oe)) == null ? void 0 : n.with(Qn);
    t && e(t), this._renderManagerService.created$.subscribe((i) => {
      var o;
      i.unitId === Oe && (t = (o = this._renderManagerService.getRenderById(Oe)) == null ? void 0 : o.with(Qn), t && e(t));
    });
  }
  _resolveClipboardFiles(e) {
    if (!e)
      return;
    const t = Array.from(e.items).map((n) => n.kind === "file" ? n.getAsFile() : void 0).filter(Boolean);
    return t.length > 0 ? t : void 0;
  }
  _init() {
    [un, Yd, hn].forEach(
      (t) => this.disposeWithMe(this._commandService.registerMultipleCommand(t))
    ), [
      go,
      mo,
      ri,
      fo,
      Xc,
      _m
    ].forEach((t) => this.disposeWithMe(this._commandService.registerCommand(t))), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initCopyingHooks())), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._initPastingHook()));
    const e = this._initSpecialPasteHooks().map(
      (t) => this._sheetClipboardService.addClipboardHook(t)
    );
    this.disposeWithMe({ dispose: () => e.forEach((t) => t.dispose()) });
  }
  // eslint-disable-next-line max-lines-per-function
  _initCopyingHooks() {
    const e = this;
    let t = null;
    return {
      id: et.DEFAULT_COPY,
      isDefaultHook: !0,
      onBeforeCopy(n, i) {
        t = e._getWorksheet(n, i);
      },
      onCopyCellContent(n, i) {
        var l, a, c, d;
        const o = t.getCell(n, i);
        return (a = (l = o == null ? void 0 : o.p) == null ? void 0 : l.body) != null && a.paragraphs || (d = (c = o == null ? void 0 : o.p) == null ? void 0 : c.body) != null && d.textRuns ? sv(o.p) : o ? Jh(o) : "";
      },
      onCopyCellStyle: (n, i, o, s) => {
        const l = {};
        (o || s) && (l.rowspan = `${o || 1}`, l.colspan = `${s || 1}`);
        const a = t.getMergedCell(n, i), c = t.getComposedCellStyle(n, i);
        let d = "";
        if (c && (d = bu(c)), a) {
          const u = a.endRow, h = a.endColumn, m = t.getRange(u, h).getTextStyle();
          if (m) {
            const f = bu(m);
            d ? d += f ? `;${f}` : "" : d = f;
          }
        }
        return d && (l.style = d), Object.keys(l).length ? l : null;
      },
      onCopyColumn(n) {
        return {
          width: `${t.getColumnWidth(n)}`
        };
      },
      onCopyRow(n) {
        return {
          style: `height: ${t.getRowHeight(n)}px;`
        };
      },
      onAfterCopy() {
        t = null;
      },
      getFilteredOutRows(n) {
        var a;
        const { startRow: i, endRow: o } = n, s = (a = e._instanceService.getCurrentUnitForType(O.UNIVER_SHEET)) == null ? void 0 : a.getActiveSheet(), l = [];
        if (!s)
          return l;
        for (let c = i; c <= o; c++)
          s.getRowFiltered(c) && l.push(c);
        return l;
      }
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _initPastingHook() {
    const e = this;
    let t = null, n = null, i = null;
    return {
      id: et.DEFAULT_PASTE,
      isDefaultHook: !0,
      onBeforePaste({ unitId: o, subUnitId: s, range: l }) {
        i = e._getWorksheet(o, s), t = o, n = s;
        const a = e._configService.getConfig(pS), c = l.rows[l.rows.length - 1], d = l.cols[l.cols.length - 1];
        return a && c * d > a ? (e._messageService.show({
          type: am.Error,
          content: e._localService.t("clipboard.paste.exceedMaxCells")
        }), !1) : !0;
      },
      // eslint-disable-next-line max-lines-per-function
      onPasteRows(o, s) {
        const { range: l } = o, a = [], c = [], d = i.getMaxRows(), u = d - 1, h = l.rows[l.rows.length - 1] - u, g = s.length - h, m = i.getRowManager();
        if (h > 0) {
          const p = {};
          s.slice(g).forEach((C, I) => {
            const { height: R } = C || {};
            R && (p[I] = {
              h: Number.parseFloat(R),
              hd: Ke.FALSE
            });
          });
          const S = {
            startColumn: l.cols[0],
            endColumn: l.cols[l.cols.length - 1],
            endRow: l.rows[l.rows.length - 1],
            startRow: d
          }, w = {
            unitId: t,
            subUnitId: n,
            range: S,
            rowInfo: p
          };
          a.push({
            id: jo.id,
            params: w
          }), c.push({
            id: Xo.id,
            params: {
              unitId: t,
              subUnitId: n,
              range: S
            }
          });
        }
        const f = {}, v = {};
        if (s.slice(0, g).forEach((p, S) => {
          var C, I;
          const { height: w } = p;
          if (w) {
            const R = m.getRow(l.rows[0] + S), y = Number.parseFloat(w);
            if (R) {
              const { h: M = _c, ah: E = 0 } = R, T = Math.max(M, E);
              y > T ? (f[S + l.rows[0]] = y, v[S + l.rows[0]] = T) : (f[S + l.rows[0]] = T, v[S + l.rows[0]] = T);
            } else
              f[S + l.rows[0]] = y, v[S + l.rows[0]] = (I = (C = m.getRow(l.rows[0] + S)) == null ? void 0 : C.h) != null ? I : _c;
          }
        }), Object.keys(f).length) {
          const p = {
            unitId: t,
            subUnitId: n,
            ranges: [{
              startRow: l.rows[0],
              endRow: Math.min(l.rows[l.rows.length - 1], d),
              startColumn: l.cols[0],
              endColumn: l.cols[l.cols.length - 1]
            }],
            rowHeight: f
          };
          a.push({
            id: So.id,
            params: p
          }), c.push({
            id: So.id,
            params: {
              ...p,
              rowHeight: v
            }
          });
        }
        return {
          redos: a,
          undos: c
        };
      },
      // eslint-disable-next-line max-lines-per-function
      onPasteColumns(o, s, l) {
        var w;
        const { range: a } = o, c = [], d = [], u = i.getMaxColumns(), h = u - 1, g = a.cols[a.cols.length - 1] - h, m = s.length - g, f = (w = e._configService.getConfig(_u)) != null ? w : Ru, v = a.cols, p = v[0];
        if (g > 0) {
          const C = {
            startRow: a.rows[0],
            endRow: a.rows[a.rows.length - 1],
            endColumn: a.cols[a.cols.length - 1],
            startColumn: u
          }, I = {
            unitId: t,
            subUnitId: n,
            range: C,
            colInfo: s.slice(m).map((R, y) => ({
              w: R.width ? Math.max(+R.width, i.getColumnWidth(v[y])) : f,
              hd: Ke.FALSE
            }))
          };
          c.push({
            id: Yo.id,
            params: I
          }), d.push({
            id: zo.id,
            params: {
              unitId: t,
              subUnitId: n,
              range: C
            }
          });
        }
        const S = {
          unitId: t,
          subUnitId: n,
          ranges: [{
            startRow: a.rows[0],
            endRow: a.rows[a.rows.length - 1],
            startColumn: a.cols[0],
            endColumn: Math.min(a.cols[a.cols.length - 1], u)
          }]
        };
        if (s.length > 0) {
          const C = {
            ...S,
            colWidth: s.slice(0, m).reduce((R, y, M) => {
              var E;
              return R[M + p] = y.width ? Math.max(+y.width, (E = i.getColumnWidth(v[M])) != null ? E : f) : f, R;
            }, {})
          }, I = {
            ...S,
            colWidth: s.slice(0, m).reduce((R, y, M) => {
              var E;
              return R[M + p] = (E = i.getColumnWidth(v[M])) != null ? E : f, R;
            }, {})
          };
          c.push({
            id: ln.id,
            params: C
          }), d.push({
            id: ln.id,
            params: I
          });
        }
        return {
          redos: c,
          undos: d
        };
      },
      onPastePlainText(o, s, l) {
        return e._onPastePlainText(o, s, l);
      },
      onPasteCells(o, s, l, a) {
        return e._onPasteCells(o, s, l, a);
      },
      onAfterPaste(o) {
        i = null;
      }
    };
  }
  _generateDocumentDataModelSnapshot(e) {
    var l, a;
    const t = (l = Rd(
      O.UNIVER_SHEET,
      ue,
      this._instanceService,
      this._renderManagerService
    )) == null ? void 0 : l.getCurrentParam();
    if (t == null)
      return null;
    const { skeleton: n } = t, i = (a = n.getBlankCellDocumentModel()) == null ? void 0 : a.documentModel, s = { ...i == null ? void 0 : i.getSnapshot(), ...e };
    return i == null || i.reset(s), i == null ? void 0 : i.getSnapshot();
  }
  _onPastePlainText(e, t, n) {
    const { range: i, unitId: o, subUnitId: s } = e;
    let l;
    if (/\r|\n/.test(t) || de.isLegalUrl(t)) {
      const c = VR(t), d = this._generateDocumentDataModelSnapshot({ body: c });
      l = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            p: d,
            v: null,
            f: null
          }
        }
      };
    } else if (od(t))
      l = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            f: t,
            v: null,
            p: null
          }
        }
      };
    else {
      const c = Bt.parseNumber(t);
      c != null && c.z ? l = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            v: c.v,
            s: {
              n: {
                pattern: c.z
              }
            },
            f: null
          }
        }
      } : l = {
        [i.rows[0]]: {
          [i.cols[0]]: {
            v: t,
            f: null
          }
        }
      };
    }
    const a = {
      unitId: o,
      subUnitId: s,
      cellValue: l
    };
    return {
      redos: [
        {
          id: we.id,
          params: a
        }
      ],
      undos: [
        {
          id: we.id,
          params: $t(this._injector, a)
        }
      ]
    };
  }
  _onPasteCells(e, t, n, i) {
    return this._injector.invoke((o) => OR(e, t, n, i, o));
  }
  // eslint-disable-next-line max-lines-per-function
  _initSpecialPasteHooks() {
    const e = this, t = {
      id: et.SPECIAL_PASTE_VALUE,
      specialPasteInfo: {
        label: "specialPaste.value"
      },
      onPasteCells: (s, l, a) => this._injector.invoke((c) => wp(l, s, a, c))
    }, n = {
      id: et.SPECIAL_PASTE_FORMAT,
      specialPasteInfo: {
        label: "specialPaste.format"
      },
      onPasteCells: (s, l, a) => {
        const c = [], d = [], { undos: u, redos: h } = this._injector.invoke((p) => _p(l, a, p));
        c.push(...h), d.push(...u);
        const { undos: g, redos: m } = this._injector.invoke((p) => Kc(
          l,
          a,
          p
        ));
        c.push(...m), d.push(...g);
        const { undos: f, redos: v } = this._injector.invoke((p) => bp(
          l,
          s,
          a,
          p
        ));
        return c.push(...v), d.push(...f), {
          undos: d,
          redos: c
        };
      }
    }, i = {
      id: et.SPECIAL_PASTE_COL_WIDTH,
      specialPasteInfo: {
        label: "specialPaste.colWidth"
      },
      onPasteCells() {
        return {
          undos: [],
          redos: []
        };
      },
      onPasteColumns(s, l, a) {
        var M, E;
        const c = e._instanceService.getCurrentUnitForType(O.UNIVER_SHEET), d = c.getUnitId(), u = (M = c.getActiveSheet()) == null ? void 0 : M.getSheetId();
        if (!d || !u)
          throw new Error("Cannot find unitId or subUnitId");
        const h = [], g = [], m = e._getWorksheet(d, u), { range: f } = s, v = f.cols, p = v[0], S = m.getMaxColumns(), w = f.cols[f.cols.length - 1] - S, C = l.length - w, I = (E = e._configService.getConfig(_u)) != null ? E : Ru, R = {
          unitId: d,
          subUnitId: u,
          ranges: [{
            startRow: f.rows[0],
            endRow: Math.min(f.cols[f.cols.length - 1], S),
            startColumn: f.cols[0],
            endColumn: f.cols[f.cols.length - 1]
          }],
          colWidth: l.slice(0, C).reduce((T, P, H) => {
            var A;
            return T[H + p] = P.width ? Math.max(+P.width, (A = m.getColumnWidth(v[H])) != null ? A : I) : I, T;
          }, {})
        }, y = {
          unitId: d,
          subUnitId: u,
          ranges: [{
            startRow: f.rows[0],
            endRow: Math.min(f.cols[f.cols.length - 1], S),
            startColumn: f.cols[0],
            endColumn: f.cols[f.cols.length - 1]
          }],
          colWidth: l.slice(0, C).reduce((T, P, H) => {
            var A;
            return T[H + p] = (A = m.getColumnWidth(v[H])) != null ? A : I, T;
          }, {})
        };
        return h.push({
          id: ln.id,
          params: R
        }), g.push({
          id: ln.id,
          params: y
        }), {
          redos: h,
          undos: g
        };
      }
    }, o = {
      id: et.SPECIAL_PASTE_BESIDES_BORDER,
      specialPasteInfo: {
        label: "specialPaste.besidesBorder"
      },
      onPasteCells: (s, l, a, c) => {
        e._instanceService.getCurrentUnitForType(O.UNIVER_SHEET);
        const d = [], u = [], { range: h, unitId: g, subUnitId: m } = l, f = new Ge();
        a.forValue((C, I, R) => {
          const y = R.s;
          if (typeof y == "object") {
            const M = de.deepClone(R);
            M.s && (M.s = {
              ...y,
              bd: null
            }), f.setValue(h.rows[C], h.cols[I], M);
          }
        });
        const v = {
          unitId: g,
          subUnitId: m,
          cellValue: f.getData()
        };
        d.push({
          id: we.id,
          params: v
        });
        const p = this._injector.invoke(
          $t,
          v
        );
        u.push({
          id: we.id,
          params: p
        });
        const { undos: S, redos: w } = this._injector.invoke((C) => Kc(l, a, C));
        return u.push(...S), d.push(...w), {
          redos: d,
          undos: u
        };
      }
    };
    return [t, n, i, o];
  }
  _getWorksheet(e, t) {
    var i;
    const n = (i = this._instanceService.getUniverSheetInstance(e)) == null ? void 0 : i.getSheetBySheetId(t);
    if (!n)
      throw new Error(
        `[SheetClipboardController]: cannot find a worksheet with unitId ${e} and subUnitId ${t}.`
      );
    return n;
  }
  _initCommandListener() {
    var t;
    this.disposeWithMe(
      this._commandService.onCommandExecuted((n) => {
        n.id === sr.id ? this._sheetClipboardService.removeMarkSelection() : DR.includes(n.id) && this._sheetClipboardService.removeMarkSelection();
      })
    );
    const e = this._configService.getConfig(Tt);
    (t = e == null ? void 0 : e.clipboardConfig) != null && t.hidePasteOptions || (this.disposeWithMe(
      this._commandService.onCommandExecuted((n) => {
        xR.includes(n.id) && this._sheetClipboardService.disposePasteOptionsCache();
      })
    ), this.disposeWithMe(
      this._commandService.onCommandExecuted((n) => {
        if (n.id === gn.id) {
          if (!this._sheetClipboardService.getPasteMenuVisible())
            return;
          const o = n.params.unitId, s = this._sheetClipboardService.getPasteOptionsCache(), l = s == null ? void 0 : s.target.unitId;
          o === l && this._refreshOptionalPaste$.next(Math.random());
        }
      })
    ));
  }
  _initUIComponents() {
    var t;
    const e = this._configService.getConfig(Tt);
    (t = e == null ? void 0 : e.clipboardConfig) != null && t.hidePasteOptions || this.disposeWithMe(
      this._uiPartsService.registerComponent(ti.CONTENT, () => ni(PR, this._injector))
    );
  }
};
Tr = kR([
  rn(0, N(Rt)),
  rn(1, k),
  rn(2, fe),
  rn(3, W),
  rn(4, De),
  rn(5, Vt),
  rn(6, nn),
  rn(7, $g),
  rn(8, N(xe)),
  rn(9, Od)
], Tr);
var LR = Object.getOwnPropertyDescriptor, WR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? LR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, $i = (r, e) => (t, n) => e(t, n, r);
let Pi = class extends oe {
  constructor(r, e, t, n, i) {
    super(), this._selectionManagerService = r, this._themeService = e, this._instanceSrv = t, this._cmdSrv = n, this._definedNamesService = i, this._init();
  }
  _init() {
    this.disposeWithMe(St(
      this._selectionManagerService.selectionMoveStart$,
      this._selectionManagerService.selectionMoving$,
      this._selectionManagerService.selectionMoveEnd$,
      this._selectionManagerService.selectionSet$
    ).pipe(qo((r) => !!r)).subscribe((r) => {
      this._syncDefinedNameRange(r);
    })), this.disposeWithMe(this._definedNamesService.focusRange$.subscribe(async (r) => {
      if (r == null) return;
      const { unitId: e } = r;
      let { formulaOrRefString: t } = r;
      if (t.substring(0, 1) === Yr.EQUALS && (t = t.substring(1)), !im(t))
        return;
      const i = this._instanceSrv.getUnit(e), o = await this._getSelections(i, e, t);
      this._selectionManagerService.setSelections(o), this._cmdSrv.executeCommand(fd.id, {
        unitId: e,
        range: o[0].range
      });
    }));
  }
  _syncDefinedNameRange(r) {
    if (r.length === 0)
      return;
    const e = r[r.length - 1], t = this._instanceSrv.getCurrentUnitForType(O.UNIVER_SHEET), n = t == null ? void 0 : t.getActiveSheet();
    n && this._definedNamesService.setCurrentRange({
      range: e.range,
      unitId: t.getUnitId(),
      sheetId: n.getSheetId()
    });
  }
  async _getSelections(r, e, t) {
    const n = t.split(",");
    let i = r.getActiveSheet();
    if (!i)
      return [];
    const o = [];
    for (let s = 0; s < n.length; s++) {
      const l = n[s].trim(), a = sm(l.trim());
      if (s === 0) {
        const d = r.getSheetBySheetName(a.sheetName);
        d && i.getSheetId() !== d.getSheetId() && (i = d, await this._cmdSrv.executeCommand(Cd.id, {
          subUnitId: i.getSheetId(),
          unitId: e
        }));
      }
      if (i.getName() !== a.sheetName)
        continue;
      let c = null;
      if (s === n.length - 1) {
        const d = a.range, { startRow: u, startColumn: h, endRow: g, endColumn: m } = d;
        c = dg({
          startRow: u,
          startColumn: h,
          endRow: g,
          endColumn: m
        }, i);
      }
      o.push({
        range: a.range,
        style: Sr(this._themeService),
        primary: c
      });
    }
    return o;
  }
};
Pi = WR([
  $i(0, N(Q)),
  $i(1, N(Ht)),
  $i(2, k),
  $i(3, W),
  $i(4, Jo)
], Pi);
var BR = Object.getOwnPropertyDescriptor, FR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? BR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Xn = (r, e) => (t, n) => e(t, n, r);
const UR = {
  pageSize: {
    width: Number.POSITIVE_INFINITY,
    height: Number.POSITIVE_INFINITY
  },
  documentFlavor: Rv.UNSPECIFIED,
  marginTop: 5,
  marginBottom: 5,
  marginRight: 0,
  marginLeft: 0,
  paragraphLineGapDefault: 0,
  renderConfig: {
    horizontalAlign: It.UNSPECIFIED,
    verticalAlign: cn.TOP,
    centerAngle: 0,
    vertexAngle: 0,
    wrapStrategy: mr.WRAP,
    isRenderStyle: Ke.FALSE
  }
};
let xi = class extends oe {
  constructor(r, e, t, n, i, o, s, l) {
    super(), this._univerInstanceService = r, this._renderManagerService = e, this._editorBridgeService = t, this._commandService = n, this._rangeProtectionRuleModel = i, this._worksheetProtectionRuleModel = o, this._formulaEditorController = s, this._formulaEditorManagerService = l, this._initialize();
  }
  _initialize() {
    this._syncFormulaEditorContent(), this._commandExecutedListener();
  }
  _getEditorViewModel(r) {
    var e;
    return (e = this._renderManagerService.getRenderById(r)) == null ? void 0 : e.with(Jn).getViewModel();
  }
  // Sync cell content to formula editor bar when sheet selection changed.
  _syncFormulaEditorContent() {
    this.disposeWithMe(this._editorBridgeService.currentEditCellState$.subscribe((r) => {
      r == null || this._editorBridgeService.isForceKeepVisible() || !this._rangeProtectionRuleModel.getRangeRuleInitState() || !this._worksheetProtectionRuleModel.getSheetRuleInitState() || this._editorSyncHandler(r);
    }));
  }
  // Sync cell content to formula editor bar when sheet selection changed or visible changed.
  _editorSyncHandler(r) {
    var i, o, s;
    let e = de.deepClone((i = r.documentLayoutObject.documentModel) == null ? void 0 : i.getBody());
    const t = de.deepClone((o = r.documentLayoutObject.documentModel) == null ? void 0 : o.drawings), n = de.deepClone((s = r.documentLayoutObject.documentModel) == null ? void 0 : s.getDrawingsOrder());
    (!e || r.isInArrayFormulaRange === !0 && this._editorBridgeService.isVisible().eventType === je.Dblclick) && (e = {
      dataStream: `\r
`,
      paragraphs: [
        {
          startIndex: 0
        }
      ],
      textRuns: []
    }), this._syncContentAndRender(Ae, e, t, n);
  }
  _commandExecutedListener() {
    const r = [Oe, Ae];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((t) => {
        if (t.id === wo.id) {
          const n = t.params, { unitId: i, trigger: o, isSync: s } = n;
          if (s || o === Gh.id)
            return;
          if (r.includes(i)) {
            const l = this._univerInstanceService.getUnit(i, O.UNIVER_DOC), a = i === Ae ? Oe : Ae;
            this._checkAndSetRenderStyleConfig(l), this._syncActionsAndRender(a, n);
          }
        }
      })
    );
    const e = [we.id, tr.id];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((t) => {
        var n, i, o, s, l, a, c;
        if (e.includes(t.id)) {
          const d = this._editorBridgeService.getLatestEditCellState();
          if (d == null)
            return;
          let u = !1;
          const { row: h, column: g } = d;
          if (t.id === we.id && t.params ? (i = (n = t.params.cellValue) == null ? void 0 : n[h]) != null && i[g] && (u = !0) : t.id === tr.id && t.params && (s = (o = t.params.to.value) == null ? void 0 : o[h]) != null && s[g] && (u = !0), u) {
            const m = de.deepClone((l = d.documentLayoutObject.documentModel) == null ? void 0 : l.getBody()), f = de.deepClone((a = d.documentLayoutObject.documentModel) == null ? void 0 : a.drawings), v = de.deepClone((c = d.documentLayoutObject.documentModel) == null ? void 0 : c.getDrawingsOrder());
            if (m == null)
              return;
            this._syncContentAndRender(Ae, m, f, v);
          }
        }
      })
    );
  }
  // Sync actions between cell editor and formula editor, and make `dataStream` and `paragraph` is the same.
  _syncActionsAndRender(r, e) {
    var l;
    const t = [Oe, Ae], n = this._renderManagerService.getRenderById(r);
    if (n == null)
      return;
    const i = n.with(Jn).getSkeleton(), o = this._univerInstanceService.getUnit(r, O.UNIVER_DOC), s = this._getEditorViewModel(r);
    o == null || s == null || (this._commandService.syncExecuteCommand(wo.id, {
      ...e,
      textRanges: null,
      isSync: !0,
      unitId: r,
      syncer: e.unitId
    }), s.reset(o), i.calculate(), t.includes(r) && ((l = n.mainComponent) == null || l.makeDirty()));
  }
  _syncContentAndRender(r, e, t, n) {
    var c, d;
    r === Ae && e.paragraphs && (e.paragraphs = this._clearParagraph(e.paragraphs));
    const i = [Oe, Ae], o = (c = this._renderManagerService.getRenderById(r)) == null ? void 0 : c.with(Jn).getSkeleton(), s = this._univerInstanceService.getUnit(r, O.UNIVER_DOC), l = this._getEditorViewModel(r);
    if (s == null || l == null || o == null)
      return;
    s.getSnapshot().body = e, s.getSnapshot().drawings = t != null ? t : {}, s.getSnapshot().drawingsOrder = n != null ? n : [], this._checkAndSetRenderStyleConfig(s), l.reset(s);
    const a = this._renderManagerService.getRenderById(r);
    a != null && (o.calculate(), i.includes(r) && ((d = a.mainComponent) == null || d.makeDirty()), r === Ae && this._formulaEditorController.autoScroll());
  }
  _checkAndSetRenderStyleConfig(r) {
    var o;
    const e = r.getSnapshot(), { body: t } = e;
    if (e.id !== Ae)
      return;
    e.documentStyle = UR;
    let n = e.documentStyle.renderConfig;
    n == null && (n = {}, e.documentStyle.renderConfig = n);
    const i = this._formulaEditorManagerService.getPosition();
    if (i) {
      const s = i.width;
      e.documentStyle.pageSize = {
        width: s,
        height: 1 / 0
      };
    }
    ((o = t == null ? void 0 : t.dataStream) != null ? o : "").startsWith("=") ? n.isRenderStyle = Ke.TRUE : n.isRenderStyle = Ke.FALSE;
  }
  _clearParagraph(r) {
    const e = de.deepClone(r);
    for (const t of e)
      t.paragraphStyle && (t.paragraphStyle.horizontalAlign = It.UNSPECIFIED);
    return e;
  }
};
xi = FR([
  Xn(0, k),
  Xn(1, fe),
  Xn(2, qe),
  Xn(3, W),
  Xn(4, N($e)),
  Xn(5, N(ft)),
  Xn(6, N(yr)),
  Xn(7, as)
], xi);
var XR = Object.getOwnPropertyDescriptor, zR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? XR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, eo = (r, e) => (t, n) => e(t, n, r);
const mc = "SHEET_FORCE_STRING_ALERT";
let Sl = class extends oe {
  constructor(r, e, t, n, i, o) {
    super(), this._context = r, this._hoverManagerService = e, this._cellAlertManagerService = t, this._localeService = n, this._zenZoneService = i, this._configService = o, this._init();
  }
  _init() {
    this._initCellAlertPopup(), this._initZenService();
  }
  _initCellAlertPopup() {
    this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe((r) => {
      var e, t;
      if (r) {
        const n = r.location, i = this._context.unit, o = i.getActiveSheet();
        if (!o) return this._hideAlert();
        const s = o.getCell(n.row, n.col);
        if (!s || s.v === null || s.v === void 0) return this._hideAlert();
        let l;
        if (s != null && s.s) {
          const a = i.getStyles().get(s.s);
          a != null && a.n && (l = a.n);
        }
        if (Bo(l == null ? void 0 : l.pattern)) {
          this._hideAlert();
          return;
        }
        if ((s.t === yt.FORCE_STRING || s.t === yt.STRING) && (ng(s.v) || typeof s.v == "string" && Bt.parseNumber(s.v))) {
          if ((e = this._configService.getConfig(Tt)) != null && e.disableForceStringAlert)
            return;
          const a = this._cellAlertManagerService.currentAlert.get(mc), c = (t = a == null ? void 0 : a.alert) == null ? void 0 : t.location;
          if (c && c.row === r.location.row && c.col === r.location.col && c.subUnitId === r.location.subUnitId && c.unitId === r.location.unitId) {
            this._hideAlert();
            return;
          }
          this._cellAlertManagerService.showAlert({
            type: po.ERROR,
            title: this._localeService.t("info.error"),
            message: this._localeService.t("info.forceStringInfo"),
            location: n,
            width: 200,
            height: 74,
            key: mc
          });
          return;
        }
      }
      this._hideAlert();
    }));
  }
  _initZenService() {
    this.disposeWithMe(this._zenZoneService.visible$.subscribe((r) => {
      r && this._hideAlert();
    }));
  }
  _hideAlert() {
    this._cellAlertManagerService.removeAlert(mc);
  }
};
Sl = zR([
  eo(1, N(Mr)),
  eo(2, N(Do)),
  eo(3, N(xe)),
  eo(4, em),
  eo(5, Vt)
], Sl);
var jR = Object.getOwnPropertyDescriptor, YR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? jR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, fc = (r, e) => (t, n) => e(t, n, r);
let Cl = class extends kn {
  constructor(r, e, t, n) {
    super(), this._context = r, this._sheetSkeletonManagerService = e, this._sheetInterceptorService = t, this._configService = n, this._initViewModelIntercept();
  }
  _initViewModelIntercept() {
    const r = {
      tl: {
        size: 6,
        color: "#409f11"
      }
    };
    this.disposeWithMe(
      this._sheetInterceptorService.intercept(
        vS.CELL_CONTENT,
        {
          priority: 10,
          effect: Iv.Style,
          handler: (e, t, n) => {
            var s, l, a;
            if (!((s = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : s.skeleton))
              return n(e);
            const o = t.rawData;
            if (!o || o.v === null || o.v === void 0)
              return n(e);
            if (((e == null ? void 0 : e.t) === yt.FORCE_STRING || (e == null ? void 0 : e.t) === yt.STRING) && (ng(o.v) || typeof o.v == "string" && Bt.parseNumber(o.v))) {
              const c = t.workbook.getStyles().get(o.s);
              return Bo((l = c == null ? void 0 : c.n) == null ? void 0 : l.pattern) || (a = this._configService.getConfig(Tt)) != null && a.disableForceStringMark || (e === o && (e = { ...o }), e.markers = { ...e == null ? void 0 : e.markers, ...r }), n(e);
            }
            return n(e);
          }
        }
      )
    );
  }
};
Cl = YR([
  fc(1, N(ue)),
  fc(2, N(vn)),
  fc(3, Vt)
], Cl);
var ZR = Object.getOwnPropertyDescriptor, GR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ZR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, hr = (r, e) => (t, n) => e(t, n, r);
let Oi = class extends oe {
  constructor(r, e, t, n, i, o, s) {
    super(), this._commandService = r, this._formatPainterService = e, this._univerInstanceService = t, this._renderManagerService = n, this._selectionManagerService = i, this._sheetInterceptorService = o, this._injector = s, this._initialize();
  }
  _initialize() {
    this._addDefaultHook();
  }
  _addDefaultHook() {
    const r = {
      id: "default-format-painter",
      priority: 0,
      isDefaultHook: !0,
      onStatusChange: (e) => {
        if (e !== zt.OFF) {
          const t = this._collectSelectionRangeFormat();
          t && this._formatPainterService.setSelectionFormat(t);
        }
      },
      onApply: (e, t, n, i) => this._getUndoRedoMutationInfo(e, t, n, i)
    };
    this._formatPainterService.addHook(r);
  }
  _collectSelectionRangeFormat() {
    const r = this._selectionManagerService.getCurrentLastSelection(), e = r == null ? void 0 : r.range;
    if (!e) return null;
    const { startRow: t, endRow: n, startColumn: i, endColumn: o } = e, s = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET), l = s == null ? void 0 : s.getActiveSheet();
    if (!l) return null;
    const a = l.getCellMatrix(), c = s.getStyles(), d = new Ge(), u = [];
    for (let h = t; h <= n; h++)
      for (let g = i; g <= o; g++) {
        const m = a.getValue(h, g);
        d.setValue(h, g, c.getStyleByCell(m) || {});
        const { isMergedMainCell: f, ...v } = l.getCellInfoInMergeData(h, g);
        f && u.push({
          startRow: v.startRow,
          startColumn: v.startColumn,
          endRow: v.endRow,
          endColumn: v.endColumn
        });
      }
    return {
      styles: d,
      merges: u
    };
  }
  // eslint-disable-next-line max-lines-per-function
  _getUndoRedoMutationInfo(r, e, t, n) {
    const i = this._sheetInterceptorService, o = this._univerInstanceService, { merges: s, styles: l } = n;
    if (!l) return { undos: [], redos: [] };
    const { startRow: a, startColumn: c, endRow: d, endColumn: u } = l.getDataRange(), h = d - a + 1, g = u - c + 1, m = t.startRow === t.endRow && t.startColumn === t.endColumn ? {
      startRow: t.startRow,
      startColumn: t.startColumn,
      endRow: t.startRow + h - 1,
      endColumn: t.startColumn + g - 1
    } : t, f = Array.from({ length: m.endRow - m.startRow + 1 }, () => Array.from({ length: m.endColumn - m.startColumn + 1 }, () => ({}))), v = [];
    f.forEach((A, x) => {
      A.forEach((V, D) => {
        const X = x % h + a, B = D % g + c, j = l.getValue(X, B);
        j && (f[x][D].s = Object.keys(j).length > 0 ? j : null);
      });
    });
    let p = 0, S = 0;
    s.forEach((A) => {
      A.startRow === a && A.startColumn === c && (p = A.endRow - A.startRow, S = A.endColumn - A.startColumn);
      const x = {
        startRow: A.startRow - a,
        startColumn: A.startColumn - c,
        endRow: A.endRow - a,
        endColumn: A.endColumn - c
      }, V = Math.max(1, Math.floor((m.endRow - m.startRow + 1) / h)), D = Math.max(1, Math.floor((m.endColumn - m.startColumn + 1) / g));
      for (let X = 0; X < V; X++)
        for (let B = 0; B < D; B++)
          v.push({
            startRow: x.startRow + X * h + m.startRow,
            startColumn: x.startColumn + B * g + m.startColumn,
            endRow: x.endRow + X * h + m.startRow,
            endColumn: x.endColumn + B * g + m.startColumn
          });
    });
    const w = [m], C = new Ge(), I = new Ge();
    if (de.isArray(f))
      for (let A = 0; A < w.length; A++) {
        const { startRow: x, startColumn: V, endRow: D, endColumn: X } = w[A];
        for (let B = 0; B <= D - x; B++)
          for (let j = 0; j <= X - V; j++)
            C.setValue(B + x, j + V, { s: null }), I.setValue(B + x, j + V, f[B][j]);
      }
    const R = {
      subUnitId: e,
      unitId: r,
      cellValue: C.getMatrix()
    }, y = {
      subUnitId: e,
      unitId: r,
      cellValue: I.getMatrix()
    }, M = this._injector.invoke(
      $t,
      R
    ), { undos: E, redos: T } = i.onCommandExecute({
      id: Fl.id,
      params: { ...y, range: w }
    }), P = [], H = [];
    if (v.length > 0) {
      const A = jl(v), x = o.getUnit(r).getSheetBySheetId(e), V = km(x, A), D = {
        unitId: r,
        subUnitId: e,
        ranges: A
      }, X = {
        unitId: r,
        subUnitId: e,
        ranges: A
      };
      P.push({ id: Qt.id, params: D }), P.push({ id: Kt.id, params: X });
      const B = this._injector.invoke(
        zl,
        D
      ), j = this._injector.invoke(
        Yl,
        X
      );
      if (H.push({ id: Qt.id, params: j }), H.push({ id: Kt.id, params: B }), V) {
        const G = this._injector.invoke((ge) => Dm(ge, r, x, A));
        P.unshift(...G.redos), H.push(...G.undos);
      }
    }
    if (!se.equals(m, t)) {
      const A = {
        actualRow: m.startRow,
        actualColumn: m.startColumn,
        rangeType: z.NORMAL,
        isMerged: p > 0 || S > 0,
        isMergedMainCell: !1,
        startRow: m.startRow,
        startColumn: m.startColumn,
        endRow: m.startRow + p,
        endColumn: m.startColumn + S
      };
      P.push({
        id: Ie.id,
        params: {
          unitId: r,
          subUnitId: e,
          type: At.ONLY_SET,
          selections: [{ range: m, primary: A, style: null }]
        }
      }), H.unshift({
        id: Ie.id,
        params: {
          unitId: r,
          subUnitId: e,
          type: At.ONLY_SET,
          selections: [{ range: t, primary: A, style: null }]
        }
      });
    }
    return {
      undos: [
        { id: we.id, params: R },
        { id: we.id, params: M },
        ...E,
        ...H
      ],
      redos: [
        { id: we.id, params: R },
        { id: we.id, params: y },
        ...T,
        ...P
      ]
    };
  }
};
Oi = GR([
  hr(0, W),
  hr(1, Dn),
  hr(2, k),
  hr(3, fe),
  hr(4, N(Q)),
  hr(5, N(vn)),
  hr(6, N(Rt))
], Oi);
var qR = Object.getOwnPropertyDescriptor, QR = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? qR(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, pc = (r, e) => (t, n) => e(t, n, r);
let wl = class extends oe {
  constructor(r, e, t, n) {
    super(), this._context = r, this._markSelectionService = e, this._commandService = t, this._sheetSkeletonManagerService = n, this._initListeners();
  }
  _initListeners() {
    this._addRemoveListener(), this._addRefreshListener();
  }
  _addRemoveListener() {
    const r = [tt.id];
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        r.includes(e.id) ? this._markSelectionService.removeAllShapes() : this._markSelectionService.getShapeMap().forEach((n, i) => {
          n.exits.includes(e.id) && this._markSelectionService.removeShape(i);
        });
      })
    );
  }
  _addRefreshListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((r) => {
      r && this._markSelectionService.refreshShapes();
    }));
  }
};
wl = QR([
  pc(1, N(Wi)),
  pc(2, W),
  pc(3, N(ue))
], wl);
function KR() {
  const r = kr();
  return r ? /* @__PURE__ */ b(JR, { workbook: r }) : null;
}
function JR(r) {
  const { workbook: e } = r, [t, n] = re([]), [i, o] = re(""), s = Tn(/* @__PURE__ */ new Map()), l = L(W), a = An(() => {
    const d = e.getActiveSheet().getSheetId(), u = e.getSheets(), h = e.getActiveSheet(), g = u.filter((m) => !m.isSheetHidden()).map((m, f) => {
      var v;
      return {
        sheetId: m.getSheetId(),
        label: m.getName(),
        index: f,
        selected: h === m,
        color: (v = m.getTabColor()) != null ? v : void 0
      };
    });
    if (n(g), o(d), s.current.has(d)) {
      const m = s.current.get(d);
      m && m.scrollIntoView({ behavior: "smooth", block: "nearest" });
    }
    s.current.clear();
  }, [e]);
  Ee(() => a(), [a]);
  const c = An((d) => {
    l.executeCommand(nt.id, {
      unitId: e.getUnitId(),
      subUnitId: d
    });
  }, [l, e]);
  return Ee(() => {
    const d = l.onCommandExecuted((u) => {
      switch (u.id) {
        case nr.id:
        case On.id:
        case Sd.id:
        case xr.id:
        case vd.id:
        case nt.id:
          a();
          break;
      }
    });
    return () => d.dispose();
  }, [l, a]), /* @__PURE__ */ b(
    "div",
    {
      className: "univer-h-8 univer-w-full univer-overflow-x-scroll univer-bg-gray-100 dark:!univer-bg-gray-900",
      children: /* @__PURE__ */ b("div", { className: "univer-flex univer-h-8 univer-flex-nowrap univer-items-center", children: t.map((d) => /* @__PURE__ */ b(
        "div",
        {
          ref: (u) => {
            s.current.set(d.sheetId, u);
          },
          className: Te(
            `
                              univer-box-border univer-h-full univer-min-w-12 univer-max-w-[120px] univer-shrink-0
                              univer-flex-nowrap univer-items-center univer-truncate univer-px-1 univer-py-0.5
                              univer-text-center univer-text-xs univer-leading-7
                            `,
            Nd,
            {
              "univer-bg-white univer-text-primary-600 dark:!univer-bg-slate-600": d.sheetId === i
            }
          ),
          onClick: () => c(d.sheetId),
          children: d.label
        },
        d.sheetId
      )) })
    }
  );
}
const $R = {
  [_t.MAIN_AREA]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      }
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  },
  [_t.COL_HEADER]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      }
    },
    [Qe.LAYOUT]: {
      order: 1
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  },
  [_t.ROW_HEADER]: {
    [Qe.FORMAT]: {
      [un.name]: {
        order: 0,
        menuItemFactory: ci
      }
    },
    [Qe.LAYOUT]: {
      order: 1
    },
    [Qe.DATA]: {
      order: 2
    },
    [Qe.OTHERS]: {
      order: 3
    }
  }
};
var eI = Object.getOwnPropertyDescriptor, tI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? eI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, zn = (r, e) => (t, n) => e(t, n, r);
let bl = class extends oe {
  constructor(r, e, t, n, i, o, s, l) {
    super(), this._injector = r, this._componentManager = e, this._layoutService = t, this._commandService = n, this._shortcutService = i, this._menuManagerService = o, this._uiPartsService = s, this._configService = l, this._init();
  }
  _init() {
    this._initComponents(), this._initCommands(), this._initMenus(), this._initShortcuts(), this._initWorkbenchParts(), this._initFocusHandler();
  }
  _initComponents() {
    const r = this._componentManager;
    this.disposeWithMe(r.register(Sn, yf)), this.disposeWithMe(r.register(au, Hf)), this.disposeWithMe(r.register(xo, Nf)), this.disposeWithMe(r.register(hu, Vf)), this.disposeWithMe(r.register("HideGridlinesDoubleIcon", su));
  }
  _initCommands() {
    [
      cu,
      sr,
      uu,
      du,
      os,
      Gt,
      Ut,
      Wn,
      Ta,
      Sa,
      Mo,
      Eo,
      ca,
      da,
      mn,
      Hm,
      Ra,
      Jd,
      cd,
      wi,
      tt,
      Ea,
      Bi,
      Fi,
      Ui,
      Xi,
      Mm,
      Em,
      ua,
      ha,
      Io,
      qd,
      dd,
      hd,
      md,
      gd,
      Ca,
      Qd,
      rs,
      wa,
      gn,
      To,
      $n,
      ba,
      _a,
      $d,
      ud,
      ss,
      Jt,
      Ia,
      va,
      vi,
      pi,
      ns,
      ts,
      eu,
      gr,
      _o,
      // permission
      Hn,
      Nm,
      ma,
      ii,
      oi,
      fa,
      pa,
      Ma,
      si,
      li,
      ya,
      is,
      oa,
      sa
    ].forEach((r) => {
      this.disposeWithMe(this._commandService.registerCommand(r));
    });
  }
  _initMenus() {
    this._menuManagerService.mergeMenu($R);
  }
  _initShortcuts() {
    [
      // selection shortcuts
      Lf,
      Wf,
      Bf,
      Ff,
      Uf,
      Xf,
      zf,
      jf,
      // MoveBackSelectionShortcutItem,
      Yf,
      Zf,
      Gf,
      qf,
      Qf,
      Kf,
      Jf,
      $f,
      ep,
      tp,
      np,
      rp,
      ip,
      // view shortcuts
      gp,
      fp,
      vp,
      Sp,
      mp,
      pp,
      // toggle cell style shortcuts
      op,
      sp,
      lp,
      ap,
      // cell content editing shortcuts
      cp,
      dp,
      up,
      hp,
      ...af(),
      df,
      cf,
      uf,
      mf,
      ff,
      pf,
      Sf,
      hf,
      gf,
      vf,
      // operation shortcuts
      kf,
      Df
    ].forEach((r) => {
      this.disposeWithMe(this._shortcutService.registerShortcut(r));
    });
  }
  _initWorkbenchParts() {
    const r = this._uiPartsService, e = this._injector;
    this.disposeWithMe(r.registerComponent(ti.HEADER, () => ni(KR, e))), this.disposeWithMe(r.registerComponent(ti.CONTENT, () => ni(of, e)));
  }
  _initFocusHandler() {
    this.disposeWithMe(
      this._layoutService.registerFocusHandler(O.UNIVER_SHEET, (r) => {
        const e = this._injector.get(fe), t = this._injector.get(k), n = Go(O.UNIVER_DOC, t, e), i = n == null ? void 0 : n.with(Qn);
        i == null || i.focus();
      })
    );
  }
};
bl = tI([
  zn(0, N(Rt)),
  zn(1, N(kt)),
  zn(2, Td),
  zn(3, W),
  zn(4, ta),
  zn(5, Ed),
  zn(6, Od),
  zn(7, Vt)
], bl);
var nI = Object.getOwnPropertyDescriptor, rI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? nI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, vc = (r, e) => (t, n) => e(t, n, r);
let _l = class extends oe {
  constructor(e, t, n, i) {
    super();
    _(this, "_disposableCollection", new ht());
    _(this, "_initialize", () => {
      const e = this._disposableCollection;
      this.disposeWithMe(
        this._selectionManagerService.selectionMoveEnd$.subscribe(() => {
          e.dispose(), this._selectionRenderService.getSelectionControls().forEach((n) => {
            e.add(
              We(
                n.selectionMoveEnd$.subscribe((i) => {
                  if (!i)
                    return;
                  const o = n.model.getRange(), s = {
                    startRow: o.startRow,
                    startColumn: o.startColumn,
                    endRow: o.endRow,
                    endColumn: o.endColumn,
                    rangeType: o.rangeType
                  }, l = {
                    startRow: i.startRow,
                    startColumn: i.startColumn,
                    endRow: i.endRow,
                    endColumn: i.endColumn,
                    // rangeType must equal to fromRange
                    rangeType: o.rangeType
                  };
                  if (s.startRow === l.startRow && s.startColumn === l.startColumn || l.startRow < 0 || l.startColumn < 0)
                    return;
                  const a = {
                    fromRange: s,
                    toRange: l
                  };
                  this._commandService.executeCommand(Yg.id, a);
                })
              )
            );
          });
        })
      );
    });
    this._context = e, this._selectionRenderService = t, this._selectionManagerService = n, this._commandService = i, this._initialize();
  }
  dispose() {
    var e;
    super.dispose(), (e = this._disposableCollection) == null || e.dispose();
  }
};
_l = rI([
  vc(1, N(gt)),
  vc(2, N(Q)),
  vc(3, N(W))
], _l);
var iI = Object.getOwnPropertyDescriptor, oI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? iI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, sI = (r, e) => (t, n) => e(t, n, r);
let Ai = class extends oe {
  constructor(r) {
    super(), this._sheetPermissionInitController = r, this._initPermission();
  }
  _initPermission() {
    this._sheetPermissionInitController.initPermission();
  }
};
Ai = oI([
  sI(0, N(SS))
], Ai);
var lI = Object.getOwnPropertyDescriptor, aI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? lI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, _n = (r, e) => (t, n) => e(t, n, r);
let Rl = class extends kn {
  constructor(e, t, n, i, o, s, l, a, c, d) {
    super();
    _(this, "disposableCollection", new ht());
    this._context = e, this._univerInstanceService = t, this._permissionService = n, this._selectionManagerService = i, this._rangeProtectionRuleModel = o, this._headerMoveRenderController = s, this._selectionRenderService = l, this._headerFreezeRenderController = a, this._rangeProtectionCache = c, this._headerResizeRenderController = d, this._initHeaderMovePermissionInterceptor(), this._initHeaderResizePermissionInterceptor(), this._initRangeFillPermissionInterceptor(), this._initRangeMovePermissionInterceptor();
  }
  _initHeaderMovePermissionInterceptor() {
    const e = this._headerMoveRenderController.interceptor.getInterceptPoints().HEADER_MOVE_PERMISSION_CHECK;
    this.disposeWithMe(
      this._headerMoveRenderController.interceptor.intercept(e, {
        handler: (t, n) => {
          const i = Xe(this._univerInstanceService);
          if (!i)
            return !1;
          const { unitId: o, subUnitId: s } = i;
          if (!this._permissionService.composePermission([new K(o).id, new te(o, s).id]).every((a) => a.value))
            return !1;
          if (!n)
            return !0;
          if (n.rangeType !== z.ROW && n.rangeType !== z.COLUMN)
            return t;
          if (n.rangeType === z.ROW) {
            for (let a = n.startRow; a <= n.endRow; a++)
              if (this._rangeProtectionCache.getRowPermissionInfo(o, s, a, [ae.Edit]) === !1)
                return !1;
          } else
            for (let a = n.startColumn; a <= n.endColumn; a++)
              if (this._rangeProtectionCache.getColPermissionInfo(o, s, a, [ae.Edit]) === !1)
                return !1;
          return !0;
        }
      })
    );
  }
  _initHeaderResizePermissionInterceptor() {
    this._headerResizeRenderController && this.disposeWithMe(
      this._headerResizeRenderController.interceptor.intercept(this._headerResizeRenderController.interceptor.getInterceptPoints().HEADER_RESIZE_PERMISSION_CHECK, {
        handler: (e, t) => {
          var s, l, a, c;
          const n = Xe(this._univerInstanceService);
          if (!n)
            return !1;
          const { unitId: i, subUnitId: o } = n;
          if (t.row) {
            if (((l = (s = this._permissionService.getPermissionPoint(new Or(i, o).id)) == null ? void 0 : s.value) != null ? l : !1) === !1)
              return !1;
          } else if (t.col && ((c = (a = this._permissionService.getPermissionPoint(new Ar(i, o).id)) == null ? void 0 : a.value) != null ? c : !1) === !1)
            return !1;
          return !0;
        }
      })
    );
  }
  _initRangeFillPermissionInterceptor() {
    this.disposeWithMe(
      this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_FILL_PERMISSION_CHECK, {
        handler: (e, t) => {
          var m, f, v;
          const n = Xe(this._univerInstanceService);
          if (!n)
            return !1;
          const { worksheet: i, unitId: o, subUnitId: s } = n;
          if (!this._permissionService.composePermission([
            new K(o).id,
            new te(o, s).id,
            new qt(o, s).id,
            new Ze(o, s).id
          ]).every((p) => p.value))
            return !1;
          const a = (m = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : m.map((p) => p.range), c = a == null ? void 0 : a.find((p) => {
            const S = Os(t.x, t.y, t.scene, t.skeleton), w = t.skeleton.getCellWithCoordByIndex(p.endRow, p.endColumn), C = Math.abs(w.endX - S.x), I = Math.abs(w.endY - S.y);
            return C <= 5 && I <= 5;
          });
          if (!c)
            return !0;
          const { startRow: d, endRow: u, startColumn: h, endColumn: g } = c;
          for (let p = d; p <= u; p++)
            for (let S = h; S <= g; S++) {
              const w = (v = (f = i.getCell(p, S)) == null ? void 0 : f.selectionProtection) == null ? void 0 : v[0];
              if ((w == null ? void 0 : w[ae.Edit]) === !1 || (w == null ? void 0 : w[ae.View]) === !1)
                return !1;
            }
          return !0;
        }
      })
    );
  }
  _initRangeMovePermissionInterceptor() {
    this.disposeWithMe(
      this._selectionRenderService.interceptor.intercept(this._selectionRenderService.interceptor.getInterceptPoints().RANGE_MOVE_PERMISSION_CHECK, {
        handler: (e, t) => {
          var h;
          const n = Xe(this._univerInstanceService);
          if (!n)
            return !1;
          const { worksheet: i, unitId: o, subUnitId: s } = n;
          if (!this._permissionService.composePermission([new K(o).id, new te(o, s).id]).every((g) => g.value))
            return !1;
          const a = (h = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : h.map((g) => g.range), c = this._rangeProtectionRuleModel.getSubunitRuleList(o, s).reduce((g, m) => [...g, ...m.ranges], []), d = a == null ? void 0 : a.filter((g) => c.some((m) => se.intersects(m, g)));
          return !(d == null ? void 0 : d.some((g) => {
            var S, w;
            const { startRow: m, startColumn: f, endRow: v, endColumn: p } = g;
            for (let C = m; C <= v; C++)
              for (let I = f; I <= p; I++) {
                const R = (w = (S = i.getCell(C, I)) == null ? void 0 : S.selectionProtection) == null ? void 0 : w[0];
                if ((R == null ? void 0 : R[ae.Edit]) === !1)
                  return !0;
              }
            return !1;
          }));
        }
      })
    );
  }
  _initFreezePermissionInterceptor() {
    this.disposeWithMe(
      this._headerFreezeRenderController.interceptor.intercept(this._headerFreezeRenderController.interceptor.getInterceptPoints().FREEZE_PERMISSION_CHECK, {
        handler: (e, t) => {
          var s, l;
          const n = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET);
          return !(n == null ? void 0 : n.getActiveSheet()) || !n ? !1 : (l = (s = this._permissionService.getPermissionPoint(new K(n.getUnitId()).id)) == null ? void 0 : s.value) != null ? l : !1;
        }
      })
    );
  }
};
Rl = aI([
  _n(1, k),
  _n(2, rt),
  _n(3, N(Q)),
  _n(4, N($e)),
  _n(5, N(No)),
  _n(6, gt),
  _n(7, N(Vo)),
  _n(8, N(Zo)),
  _n(9, ld(ko))
], Rl);
var cI = Object.getOwnPropertyDescriptor, dI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? cI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, to = (r, e) => (t, n) => e(t, n, r);
const uI = "SHEET_PERMISSION_PASTE_PLUGIN";
let Hi = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "disposableCollection", new ht());
    this._univerInstanceService = e, this._selectionManagerService = t, this._localService = n, this._sheetClipboardService = i, this._sheetPermissionCheckController = o, this._initClipboardHook();
  }
  _initClipboardHook() {
    this.disposeWithMe(
      this._sheetClipboardService.addClipboardHook({
        id: uI,
        onBeforePaste: (e) => {
          var h, g, m;
          const [t] = wr([e.range]).ranges, n = (h = this._selectionManagerService.getCurrentLastSelection()) == null ? void 0 : h.range;
          if (!n)
            return !1;
          const i = {
            startRow: n.startRow + t.startRow,
            endRow: n.startRow + t.endRow,
            startColumn: n.startColumn + t.startColumn,
            endColumn: n.startColumn + t.endColumn
          }, s = this._univerInstanceService.getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet();
          if (!s)
            return !1;
          const { startRow: l, endRow: a, startColumn: c, endColumn: d } = i;
          let u = !0;
          for (let f = l; f <= a; f++)
            for (let v = c; v <= d; v++) {
              const p = (m = (g = s.getCell(f, v)) == null ? void 0 : g.selectionProtection) == null ? void 0 : m[0];
              if ((p == null ? void 0 : p[ae.Edit]) === !1) {
                u = !1;
                break;
              }
            }
          return u || this._sheetPermissionCheckController.blockExecuteWithoutPermission(this._localService.t("permission.dialog.pasteErr")), u;
        }
      })
    );
  }
};
Hi = dI([
  to(0, k),
  to(1, N(Q)),
  to(2, N(xe)),
  to(3, N(nn)),
  to(4, N(bd))
], Hi);
var hI = Object.getOwnPropertyDescriptor, gI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? hI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Is = (r, e) => (t, n) => e(t, n, r);
let Il = class extends kn {
  constructor(e, t, n, i, o) {
    super();
    _(this, "disposableCollection", new ht());
    this._context = e, this._univerInstanceService = t, this._permissionService = n, this._statusBarController = i, this._rangeProtectionCache = o, this._initStatusBarPermissionInterceptor();
  }
  _initStatusBarPermissionInterceptor() {
    this.disposeWithMe(
      this._statusBarController.interceptor.intercept(this._statusBarController.interceptor.getInterceptPoints().STATUS_BAR_PERMISSION_CORRECT, {
        priority: 100,
        handler: (e, t) => {
          var a;
          const n = Xe(this._univerInstanceService);
          if (!n)
            return e != null ? e : [];
          const { worksheet: i, unitId: o, subUnitId: s } = n;
          return ((a = this._permissionService.getPermissionPoint(new Sg(o, s).id)) == null ? void 0 : a.value) === !1 ? t.forEach((c) => {
            const d = c.getArrayValue();
            d.forEach((u, h) => {
              u.forEach((g, m) => {
                d[h][m] = Du.create();
              });
            });
          }) : t.forEach((c) => {
            const d = c.getArrayValue(), u = c.getCurrentRow(), h = c.getCurrentColumn();
            d.forEach((g, m) => {
              g.forEach((f, v) => {
                var w;
                if (((w = i.getCellRaw(m + u, v + h)) == null ? void 0 : w.v) === void 0)
                  return;
                const S = this._rangeProtectionCache.getCellInfo(o, s, m + u, v + h);
                (S == null ? void 0 : S[ae.View]) === !1 && (d[m][v] = Du.create());
              });
            });
          }), t;
        }
      })
    );
  }
};
Il = gI([
  Is(1, k),
  Is(2, rt),
  Is(3, N(Er)),
  Is(4, N(Zo))
], Il);
const Rp = (r, e, t, n, i) => {
  const o = r.get(xe), s = r.get(ft), l = r.get($e);
  let a = "";
  if (e.length === 0)
    a = o.t("permission.panel.emptyRangeError");
  else if (e.length > 1) {
    let c = !1;
    for (let d = 0; d < e.length; d++) {
      for (let u = d + 1; u < e.length; u++)
        if (se.intersects(e[d], e[u])) {
          c = !0;
          break;
        }
      if (c)
        break;
    }
    c && (a = o.t("permission.panel.rangeOverlapError"));
  }
  if (!a) {
    if (s.getRule(n, i) && !t)
      return a = o.t("permission.panel.rangeOverlapOverPermissionError"), a;
    const d = l.getSubunitRuleList(n, i).filter((h) => h.permissionId !== t).find((h) => h.ranges.some((g) => e.some((m) => se.intersects(g, m))));
    (d == null ? void 0 : d.ranges.find((h) => e.some((g) => se.intersects(h, g)))) && (a = o.t("permission.panel.rangeOverlapOverPermissionError"));
  }
  return a === "" ? void 0 : a;
}, mI = (r, e) => {
  if (r.length !== 1)
    return !1;
  const t = r[0], n = e.getRowCount(), i = e.getColumnCount(), { startRow: o, endRow: s, startColumn: l, endColumn: a } = t;
  return o === 0 && l === 0 && s === n - 1 && a === i - 1;
}, fI = (r, e) => {
  var a, c;
  const t = r.get(k), n = r.get(Q), i = t.getCurrentUnitForType(O.UNIVER_SHEET), o = i.getActiveSheet();
  let s = Dt.SelectRange, l = (c = (a = n.getCurrentSelections()) == null ? void 0 : a.map((d) => d.range)) != null ? c : [];
  return e && (s = Dt.Worksheet, l = [{
    startRow: 0,
    startColumn: 0,
    endRow: o.getRowCount() - 1,
    endColumn: o.getColumnCount() - 1,
    rangeType: z.ALL
  }]), {
    unitId: i.getUnitId(),
    subUnitId: o.getSheetId(),
    permissionId: "",
    unitType: s,
    description: "",
    id: "",
    ranges: l,
    editState: sn.OnlyMe,
    viewState: di.OthersCanView
  };
}, pI = (r, e) => {
  const i = r.get(k).getCurrentUnitForType(O.UNIVER_SHEET).getActiveSheet(), { unitType: o } = e;
  return o === Dt.Worksheet ? {
    ...e,
    ranges: [{
      startRow: 0,
      startColumn: 0,
      endRow: i.getRowCount() - 1,
      endColumn: i.getColumnCount() - 1,
      rangeType: z.ALL
    }]
  } : e;
}, vI = (r) => {
  const { viewState: e, editState: t, permissionId: n, ranges: i, rangesErrMsg: o, desc: s, oldRule: l, id: a } = r, c = L(Rr), d = L(Di), u = L(Bl), h = L(xe), g = L(W), m = L(Vr), v = L(k).getCurrentUnitForType(O.UNIVER_SHEET), p = v == null ? void 0 : v.getActiveSheet();
  if (!v || !p)
    return null;
  const S = v.getUnitId(), w = p.getSheetId();
  return /* @__PURE__ */ q("div", { className: "univer-mt-auto univer-flex univer-flex-row-reverse univer-gap-2 univer-py-5", children: [
    /* @__PURE__ */ b(
      jt,
      {
        variant: "primary",
        onClick: async () => {
          if (o) return;
          const C = {
            unitId: S,
            subUnitId: w,
            permissionId: n,
            id: a,
            viewState: e,
            editState: t,
            unitType: Dt.SelectRange,
            ranges: i,
            description: s
          };
          mI(i, p) && (C.unitType = Dt.Worksheet, C.ranges = []);
          let R = m.selectUserList;
          C.editState === sn.OnlyMe && (R = [], m.setSelectUserList([]));
          const y = {
            read: C.viewState === di.OthersCanView ? on.AllCollaborator : on.SomeCollaborator,
            edit: C.editState === sn.DesignedUserCanEdit ? on.SomeCollaborator : on.OneSelf
          };
          if (C.editState === sn.DesignedUserCanEdit && R.length === 0 && (R = [], y.edit = on.OneSelf), C.permissionId) {
            const E = fw(R.filter((x) => x.role === Lt.Editor), m.oldCollaboratorList.filter((x) => x.role === Lt.Editor)), T = (l == null ? void 0 : l.viewState) === C.viewState, P = (l == null ? void 0 : l.editState) === C.editState, H = C.unitType === (l == null ? void 0 : l.unitType) && C.description === l.description && C.ranges === l.ranges, A = !E || !T || !P;
            if (H && A)
              await u.update({
                objectType: C.unitType,
                objectID: C.permissionId,
                unitID: C.unitId,
                share: void 0,
                name: "",
                strategies: [],
                scope: y,
                collaborators: {
                  collaborators: R
                }
              });
            else {
              let x = C.permissionId;
              A && (C.unitType === Dt.Worksheet ? x = await u.create({
                worksheetObject: {
                  collaborators: R,
                  unitID: C.unitId,
                  name: "",
                  strategies: [{ role: Lt.Editor, action: ae.Edit }, { role: Lt.Reader, action: ae.View }],
                  scope: y
                },
                objectType: Dt.Worksheet
              }) : x = await u.create({
                selectRangeObject: {
                  collaborators: R,
                  unitID: C.unitId,
                  name: "",
                  scope: y
                },
                objectType: Dt.SelectRange
              })), g.executeCommand(CS.id, {
                rule: {
                  ...C,
                  permissionId: x
                },
                oldRule: l
              });
            }
          } else if (C.unitType === Dt.Worksheet) {
            const E = await u.create({
              worksheetObject: {
                collaborators: R,
                unitID: C.unitId,
                name: "",
                strategies: [{ role: Lt.Editor, action: ae.Edit }, { role: Lt.Reader, action: ae.View }],
                scope: y
              },
              objectType: Dt.Worksheet
            }), { ranges: T = [], ...P } = C;
            P.permissionId = E, g.executeCommand(vg.id, {
              rule: P,
              unitId: C.unitId
            });
          } else if (C.unitType === Dt.SelectRange) {
            const E = await u.create({
              selectRangeObject: {
                collaborators: R,
                unitID: C.unitId,
                name: "",
                scope: y
              },
              objectType: Dt.SelectRange
            });
            g.executeCommand(wS.id, {
              rule: C,
              permissionId: E
            });
          }
          const M = {
            header: { title: `${h.t("permission.panel.title")}` },
            children: {
              label: yo,
              showDetail: !1
            },
            width: 330
          };
          d.open(M);
        },
        children: h.t("permission.button.confirm")
      }
    ),
    /* @__PURE__ */ b(
      jt,
      {
        onClick: () => {
          c.reset(), m.reset(), d.close();
        },
        children: h.t("permission.button.cancel")
      }
    )
  ] });
}, SI = (r) => {
  const { ranges: e, onRangesChange: t, desc: n, onDescChange: i, rangesErrMsg: o, permissionId: s } = r, l = L(kt), a = Ct(() => l.get(hm), []), c = L(k), d = L(xe), u = L(Rt), h = c.getCurrentUnitForType(O.UNIVER_SHEET), g = h == null ? void 0 : h.getActiveSheet();
  if (!h || !g)
    return null;
  const m = h.getUnitId(), f = g.getSheetId(), v = (p) => {
    const S = p.split(",").map(sm).map((E) => E.range);
    if (S.some((E) => !yv(E) || E.endColumn < E.startColumn || E.endRow < E.startRow))
      return;
    const w = c.getCurrentUnitForType(O.UNIVER_SHEET), C = w == null ? void 0 : w.getActiveSheet();
    if (!w || !C)
      return;
    const I = w.getUnitId(), R = C.getSheetId(), y = S.map((E) => {
      const T = C.getRowCount(), P = C.getColumnCount();
      return bS(E, T, P), E;
    }), M = Rp(u, y, s, I, R);
    t(y, M);
  };
  return /* @__PURE__ */ q($o, { children: [
    /* @__PURE__ */ b(
      Gs,
      {
        className: "univer-font-medium",
        label: d.t("permission.panel.protectedRange"),
        error: o,
        children: a && /* @__PURE__ */ b(
          a,
          {
            unitId: m,
            subUnitId: f,
            initialValue: e == null ? void 0 : e.map((p) => lm(p)).join(","),
            onChange: (p, S) => v(S)
          }
        )
      }
    ),
    /* @__PURE__ */ b(Gs, { className: "univer-font-medium", label: d.t("permission.panel.permissionDirection"), children: /* @__PURE__ */ b(
      Zs,
      {
        value: n,
        onChange: (p) => i(p),
        placeholder: d.t("permission.panel.permissionDirectionPlaceholder")
      }
    ) })
  ] });
}, Ip = "data:image/png;base64,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", CI = (r) => {
  const { editState: e, onEditStateChange: t, viewState: n, onViewStateChange: i, permissionId: o } = r, s = L(xe), l = L(Qo), a = L(Bl), c = L(Vr), d = L(Ft), u = L(k), h = dt(c.selectUserList$, c.selectUserList), g = u.getCurrentUnitForType(O.UNIVER_SHEET), m = g == null ? void 0 : g.getActiveSheet();
  if (!g || !m)
    return null;
  const f = g.getUnitId(), v = async () => {
    const p = await a.listCollaborators({
      objectID: f,
      unitID: f
    }), S = d.getCurrentUser();
    c.setCanEditUserList(p.filter((w) => {
      var C;
      return ((C = w.subject) == null ? void 0 : C.userID) !== S.userID;
    })), l.open({
      id: il,
      title: { title: "" },
      children: { label: Pm },
      width: 280,
      destroyOnClose: !0,
      closable: !1,
      onClose: () => l.close(il),
      className: "sheet-permission-user-dialog"
    });
  };
  return Ee(() => {
    o ? (async () => {
      const w = (await a.listCollaborators({
        objectID: o,
        unitID: f
      })).filter((C) => C.role === Lt.Editor);
      w.length > 0 && t(sn.DesignedUserCanEdit), c.setSelectUserList(w), c.setOldCollaboratorList(w);
    })() : (c.setSelectUserList([]), c.setOldCollaboratorList([]));
  }, []), /* @__PURE__ */ q($o, { children: [
    /* @__PURE__ */ b(Gs, { className: "univer-font-medium", label: s.t("permission.panel.editPermission"), children: /* @__PURE__ */ q(
      Dc,
      {
        value: e,
        onChange: (p) => t(p),
        className: "univer-flex univer-flex-col",
        children: [
          /* @__PURE__ */ b(Qr, { value: sn.OnlyMe, children: /* @__PURE__ */ b("span", { children: s.t("permission.panel.onlyICanEdit") }) }),
          /* @__PURE__ */ b(Qr, { value: sn.DesignedUserCanEdit, children: /* @__PURE__ */ b("span", { children: s.t("permission.panel.designedUserCanEdit") }) })
        ]
      }
    ) }),
    e === sn.DesignedUserCanEdit && /* @__PURE__ */ q(
      "div",
      {
        className: Te("univer-mb-2 univer-flex univer-h-[270px] univer-flex-col univer-overflow-y-auto univer-rounded-lg univer-p-3", Li),
        children: [
          /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center univer-justify-between univer-text-sm", children: [
            /* @__PURE__ */ b("span", { children: s.t("permission.panel.designedPerson") }),
            /* @__PURE__ */ b("span", { className: "univer-cursor-pointer univer-text-primary-600", onClick: v, children: s.t("permission.panel.addPerson") })
          ] }),
          /* @__PURE__ */ b("div", { className: "univer-my-2 univer-h-px univer-bg-gray-200" }),
          /* @__PURE__ */ b("div", { className: "univer-flex-1", children: (h == null ? void 0 : h.length) > 0 ? h.map((p) => {
            var S, w, C;
            return /* @__PURE__ */ q(
              "div",
              {
                className: "univer-mb-3 univer-flex univer-h-7 univer-items-center univer-leading-7 last:univer-mb-0",
                children: [
                  /* @__PURE__ */ b(kd, { size: 24, src: (S = p.subject) == null ? void 0 : S.avatar }),
                  /* @__PURE__ */ b(
                    "span",
                    {
                      className: "univer-ml-1.5 univer-w-[130px] univer-truncate univer-text-gray-900 dark:!univer-text-white",
                      children: (w = p.subject) == null ? void 0 : w.name
                    }
                  ),
                  /* @__PURE__ */ b(
                    dm,
                    {
                      className: "!univer-w-[90px] univer-min-w-0 univer-cursor-pointer",
                      borderless: !0,
                      value: "edit",
                      options: [
                        { label: `${s.t("permission.panel.canEdit")}`, value: "edit" },
                        { label: `${s.t("permission.panel.delete")}`, value: "delete" }
                      ],
                      onChange: (I) => {
                        I === "delete" && c.setSelectUserList(h.filter((R) => {
                          var y, M;
                          return ((y = R.subject) == null ? void 0 : y.userID) !== ((M = p.subject) == null ? void 0 : M.userID);
                        }));
                      }
                    }
                  )
                ]
              },
              (C = p.subject) == null ? void 0 : C.userID
            );
          }) : /* @__PURE__ */ q(
            "div",
            {
              className: "univer-flex univer-h-full univer-flex-col univer-items-center univer-justify-center",
              children: [
                /* @__PURE__ */ b("img", { width: 240, height: 120, src: Ip, alt: "" }),
                /* @__PURE__ */ b(
                  "p",
                  {
                    className: "univer-w-60 univer-break-words univer-text-sm univer-text-gray-400",
                    children: s.t("permission.dialog.userEmpty")
                  }
                )
              ]
            }
          ) })
        ]
      }
    ),
    /* @__PURE__ */ b(Gs, { className: "univer-font-medium", label: s.t("permission.panel.viewPermission"), children: /* @__PURE__ */ q(
      Dc,
      {
        value: n,
        onChange: (p) => i(p),
        className: "univer-flex univer-flex-col last:univer-mb-0",
        children: [
          /* @__PURE__ */ b(Qr, { value: di.OthersCanView, children: /* @__PURE__ */ b("span", { children: s.t("permission.panel.othersCanView") }) }),
          /* @__PURE__ */ b(Qr, { value: di.NoOneElseCanView, children: /* @__PURE__ */ b("span", { children: s.t("permission.panel.noOneElseCanView") }) })
        ]
      }
    ) })
  ] });
}, wI = (r) => {
  var w, C;
  const { fromSheetBar: e, rule: t, oldRule: n } = r, i = L(Rt), o = L(kt), s = t ? pI(i, t) : fI(i, e), [l, a] = re(s.ranges), [c, d] = re(() => Rp(i, s.ranges, s.permissionId, s.unitId, s.subUnitId)), [u, h] = re(s.description), [g, m] = re((w = s.editState) != null ? w : sn.OnlyMe), [f, v] = re((C = s.viewState) != null ? C : di.OthersCanView), p = o.get(ga), S = p != null ? p : CI;
  return Ee(() => {
    const I = i.get(k), R = i.get(Di), y = I.getCurrentUnitOfType(O.UNIVER_SHEET);
    if (!y) return;
    const M = y.getActiveSheet().getSheetId(), E = y.activeSheet$.subscribe((T) => {
      (T == null ? void 0 : T.getSheetId()) !== M && R.close();
    });
    return () => {
      E.unsubscribe();
    };
  }, []), /* @__PURE__ */ q(
    "div",
    {
      className: "univer-mt-4 univer-flex univer-h-[calc(100%-16px)] univer-flex-col",
      children: [
        /* @__PURE__ */ b(
          SI,
          {
            permissionId: s.permissionId,
            ranges: l,
            onRangesChange: (I, R) => {
              a(I), d(R);
            },
            rangesErrMsg: c,
            desc: u,
            onDescChange: (I) => h(I)
          }
        ),
        /* @__PURE__ */ b(
          S,
          {
            editState: g,
            onEditStateChange: (I) => m(I),
            viewState: f,
            onViewStateChange: (I) => v(I),
            permissionId: s.permissionId
          }
        ),
        /* @__PURE__ */ b(
          vI,
          {
            permissionId: s.permissionId,
            id: s.id,
            ranges: l,
            rangesErrMsg: c,
            desc: u,
            viewState: f,
            editState: g,
            oldRule: n
          }
        )
      ]
    }
  );
}, bI = "data:image/png;base64,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";
function _I() {
  var A;
  const [r, e] = re(!0), [t, n] = re(!1), [i, o] = re([]), s = L(xe), l = L($e), a = L(ft), c = L(k), d = L(W), u = L(Di), h = L(Bl), g = L(rt), f = L(Ft).getCurrentUser(), v = L(Vr), p = dt(a.ruleRefresh$, ""), S = dt(l.ruleRefresh$, ""), w = c.getCurrentUnitOfType(O.UNIVER_SHEET);
  if (!w) return null;
  const C = w.getUnitId(), I = An(async (x) => {
    var Z;
    const V = w.getActiveSheet(), D = w.getUnitId(), X = V.getSheetId(), B = [], j = [];
    w.getSheets().forEach((ee) => {
      const ne = ee.getSheetId();
      l.getSubunitRuleList(D, ne).forEach((me) => {
        me.permissionId && B.push(me.permissionId);
      });
      const Ue = a.getRule(D, ne);
      Ue != null && Ue.permissionId && j.push(Ue.permissionId);
    });
    const G = [...B, ...j], ge = await h.list({
      objectIDs: G,
      unitID: D,
      actions: _S
    }), Re = l.getSubunitRuleList(D, X).map((ee) => ee.permissionId), be = (Z = a.getRule(D, X)) == null ? void 0 : Z.permissionId;
    be && Re.push(be);
    const Ne = ge.filter((ee) => {
      var ne;
      return Re.includes(ee.objectID) || ee.objectID === ((ne = a.getRule(D, X)) == null ? void 0 : ne.permissionId);
    });
    return x ? Ne : ge;
  }, []), [R, y] = re([]);
  Ee(() => {
    const x = St(
      l.ruleChange$,
      a.ruleChange$
    ).subscribe(async () => {
      const V = await I(r);
      y(V);
    });
    return () => {
      x.unsubscribe();
    };
  }, [r]), Ee(() => {
    const x = w.activeSheet$.pipe(
      dn((V, D) => (V == null ? void 0 : V.getSheetId()) === (D == null ? void 0 : D.getSheetId()))
    ).subscribe(async () => {
      const V = await I(r);
      y(V);
    });
    return () => {
      x.unsubscribe();
    };
  }, [r]), Ee(() => {
    (async () => {
      if (p || S) {
        const V = await I(!0);
        y(V);
      }
    })();
  }, [p, S]);
  function M(x) {
    const { unitId: V, subUnitId: D, unitType: X } = x;
    let B;
    X === yn.Worksheet ? B = d.executeCommand(Us.id, { unitId: V, subUnitId: D, rule: x }) : X === yn.SelectRange && (B = d.executeCommand(RS.id, { unitId: V, subUnitId: D, rule: x })), B && (n(!t), x.ranges === i && o([]));
  }
  Ee(() => {
    v.reset();
  }, []), pR(i);
  const E = Ct(() => {
    const x = /* @__PURE__ */ new Map();
    return w.getSheets().forEach((V) => {
      const D = V.getSheetId();
      l.getSubunitRuleList(C, D).forEach((j) => {
        x.set(j.permissionId, j);
      });
      const B = a.getRule(C, D);
      B && x.set(B == null ? void 0 : B.permissionId, B);
    }), x;
  }, [C, w, l, a]), T = (x) => {
    x.subUnitId !== w.getActiveSheet().getSheetId() && d.executeCommand(nt.id, {
      unitId: x.unitId,
      subUnitId: x.subUnitId
    });
    const V = {
      header: { title: "permission.panel.title" },
      children: {
        label: yo,
        showDetail: !0,
        rule: de.deepClone(x),
        oldRule: de.deepClone(x)
      },
      width: 330
    };
    u.open(V);
  }, P = (x) => {
    e(x);
  }, H = (A = g.getPermissionPoint(new Kl(C).id)) == null ? void 0 : A.value;
  return /* @__PURE__ */ q("div", { className: "univer-mt-2 univer-flex univer-h-[calc(100%-8px)] univer-flex-col", children: [
    /* @__PURE__ */ q("div", { className: "univer-flex univer-h-[30px] univer-py-2", children: [
      /* @__PURE__ */ q("div", { className: "univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center", onClick: () => P(!0), children: [
        /* @__PURE__ */ q("div", { className: Te("univer-h-6 univer-text-base univer-font-medium univer-leading-6", { "univer-text-blue-500": r }), children: [
          " ",
          s.t("permission.panel.currentSheet")
        ] }),
        /* @__PURE__ */ b("div", { className: Te("univer-mt-1 univer-h-0.5 univer-w-6", { "univer-bg-blue-500": r }) })
      ] }),
      /* @__PURE__ */ q("div", { className: "univer-mr-5 univer-flex univer-cursor-pointer univer-flex-col univer-items-center", onClick: () => P(!1), children: [
        /* @__PURE__ */ b("div", { className: Te("univer-h-6 univer-text-base univer-font-medium univer-leading-6", { "univer-text-blue-500": !r }), children: s.t("permission.panel.allSheet") }),
        /* @__PURE__ */ b("div", { className: Te("univer-mt-1 univer-h-0.5 univer-w-6", { "univer-bg-blue-500": !r }) })
      ] })
    ] }),
    (R == null ? void 0 : R.length) > 0 ? /* @__PURE__ */ b("div", { children: R == null ? void 0 : R.map((x) => {
      var ne, pe, Ue, me, _e;
      const V = E.get(x.objectID);
      if (!V)
        return null;
      const D = x.actions.find((le) => le.action === ae.Edit), X = D == null ? void 0 : D.allowed, B = x.actions.find((le) => le.action === ae.View), j = B == null ? void 0 : B.allowed, G = x.actions.find((le) => le.action === ae.ManageCollaborator), ge = x.actions.find((le) => le.action === ae.Delete), Re = (G == null ? void 0 : G.allowed) || f.userID === ((ne = x.creator) == null ? void 0 : ne.userID), be = (ge == null ? void 0 : ge.allowed) || f.userID === ((pe = x.creator) == null ? void 0 : pe.userID);
      let Ne = "";
      const Z = w.getSheetBySheetId(V.subUnitId), ee = Z == null ? void 0 : Z.getName();
      if (V.unitType === yn.SelectRange) {
        const le = V.ranges, it = le != null && le.length ? le.map((ot) => {
          const vt = lm(ot);
          return vt === "NaN" ? "" : vt;
        }).filter((ot) => !!ot).join(",") : "";
        Ne = `${ee}(${it})`;
      } else V.unitType === yn.Worksheet && (Ne = ee || "");
      return /* @__PURE__ */ q(
        "div",
        {
          className: Te("univer-mt-3 univer-rounded-lg univer-p-3 hover:univer-bg-gray-50", Li),
          onMouseMove: () => {
            const { subUnitId: le, unitType: it } = V, ot = w.getActiveSheet();
            if (!ot)
              return !1;
            const vt = ot.getSheetId();
            if (le !== vt)
              return !1;
            if (it === yn.SelectRange) {
              const wt = V.ranges || [];
              wt !== i && o(wt);
            } else if (it === yn.Worksheet) {
              const wt = [{ startRow: 0, endRow: ot.getRowCount() - 1, startColumn: 0, endColumn: ot.getColumnCount() - 1 }];
              wt !== i && o(wt);
            }
          },
          onMouseLeave: () => o([]),
          children: [
            /* @__PURE__ */ q("div", { className: "univer-flex univer-h-5 univer-justify-between univer-leading-5", children: [
              /* @__PURE__ */ b(Zn, { title: Ne, children: /* @__PURE__ */ b(
                "div",
                {
                  className: "univer-max-w-[200px] univer-truncate univer-text-sm univer-font-medium",
                  children: Ne
                }
              ) }),
              (Re || be) && /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center", children: [
                Re && /* @__PURE__ */ b(Zn, { title: s.t("permission.panel.edit"), children: /* @__PURE__ */ b(
                  "div",
                  {
                    className: "univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",
                    onClick: () => T(V),
                    children: /* @__PURE__ */ b(ou, {})
                  }
                ) }),
                be && /* @__PURE__ */ b(Zn, { title: s.t("permission.panel.delete"), children: /* @__PURE__ */ b(
                  "div",
                  {
                    className: "univer-box-border univer-h-6 univer-rounded-sm univer-p-1 hover:univer-bg-gray-200",
                    onClick: () => M(V),
                    children: /* @__PURE__ */ b(Pa, {})
                  }
                ) })
              ] })
            ] }),
            /* @__PURE__ */ b("div", { className: "univer-my-2 univer-h-px univer-bg-gray-200" }),
            /* @__PURE__ */ q("div", { children: [
              /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center", children: [
                /* @__PURE__ */ b(Zn, { title: (me = (Ue = x.creator) == null ? void 0 : Ue.name) != null ? me : "", children: /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(kd, { src: (_e = x.creator) == null ? void 0 : _e.avatar, className: "univer-mr-1.5", size: 24 }) }) }),
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: "univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: s.t("permission.panel.created")
                  }
                ),
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: "univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: X ? `${s.t("permission.panel.iCanEdit")}` : `${s.t("permission.panel.iCanNotEdit")}`
                  }
                )
              ] }),
              /* @__PURE__ */ q("div", { className: "univer-mt-2 univer-flex univer-items-center", children: [
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: "univer-h-4 univer-flex-grow univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: s.t("permission.panel.viewPermission")
                  }
                ),
                /* @__PURE__ */ b(
                  "span",
                  {
                    className: "univer-h-4 univer-text-xs univer-text-gray-900 dark:!univer-text-white",
                    children: j ? `${s.t("permission.panel.iCanView")}` : `${s.t("permission.panel.iCanNotView")}`
                  }
                )
              ] }),
              V.description && /* @__PURE__ */ b(Zn, { title: V.description, children: /* @__PURE__ */ b(
                "div",
                {
                  className: "univer-text-3 univer-mt-2 univer-max-w-64 univer-truncate univer-text-sm univer-text-gray-400",
                  children: V.description
                }
              ) })
            ] })
          ]
        },
        x.objectID
      );
    }) }) : /* @__PURE__ */ q(
      "div",
      {
        className: "univer-flex univer-flex-1 univer-flex-col univer-items-center univer-justify-center",
        children: [
          /* @__PURE__ */ b("img", { width: 240, height: 120, src: bI, alt: "", draggable: !1 }),
          /* @__PURE__ */ b("p", { className: "univer-w-60 univer-break-words univer-text-sm univer-text-gray-400", children: s.t("permission.dialog.listEmpty") })
        ]
      }
    ),
    H && /* @__PURE__ */ b("div", { className: "univer-mt-auto univer-py-5", children: /* @__PURE__ */ q(
      jt,
      {
        className: "univer-w-full",
        variant: "primary",
        onClick: () => {
          const x = {
            header: { title: `${s.t("permission.panel.title")}` },
            children: {
              label: yo,
              showDetail: !0
            },
            width: 330
          };
          u.open(x);
        },
        children: [
          /* @__PURE__ */ b("div", { children: "+ " }),
          s.t("permission.button.addNewPermission")
        ]
      }
    ) })
  ] });
}
const RI = ({ showDetail: r, fromSheetBar: e, rule: t, oldRule: n }) => {
  var u;
  const i = L(k), o = L(Q);
  if (!L(Rr).getVisible()) return null;
  const l = Xe(i);
  if (!l) return null;
  const { worksheet: a } = l, d = ((u = o.getCurrentSelections()) == null ? void 0 : u.map((h) => h.range)).reduce((h, g) => h + om(a.getName(), g), "");
  return r ? /* @__PURE__ */ b(
    wI,
    {
      fromSheetBar: e,
      rule: t,
      oldRule: n
    },
    e ? "sheet-bar" : "normal"
  ) : /* @__PURE__ */ b(_I, {}, d);
}, II = ({ loading: r, children: e }) => /* @__PURE__ */ q("div", { className: "univer-relative univer-h-full univer-w-full", children: [
  r && /* @__PURE__ */ b(
    "div",
    {
      className: "univer-absolute -univer-bottom-0.5 -univer-left-0.5 -univer-right-0.5 -univer-top-0.5 univer-z-10 univer-flex univer-items-center univer-justify-center univer-bg-white univer-backdrop-blur dark:!univer-bg-black",
      children: /* @__PURE__ */ b(
        "div",
        {
          className: "univer-size-10 univer-animate-spin univer-rounded-full univer-border-4 univer-border-solid univer-border-gray-100 univer-border-t-primary-500"
        }
      )
    }
  ),
  /* @__PURE__ */ b("div", { className: r ? "univer-pointer-events-none univer-blur-sm" : "", children: e })
] }), yI = () => {
  const r = L(xe), e = L(k), t = L(Bl), n = L(IS), i = L(Qo), o = L(rt), s = e.getCurrentUnitForType(O.UNIVER_SHEET), l = s.getActiveSheet();
  if (!l)
    throw new Error("No active sheet found");
  const [a, c] = re([]), d = L(W), [u, h] = re(() => !!n.getRule(s.getUnitId(), l.getSheetId())), [g, m] = re(() => Object.keys(Cs).reduce((v, p) => (v[p] = {
    text: r.t(`permission.panel.${Cs[Number(p)]}`),
    allowed: !0
  }, v), {}));
  Ee(() => {
    (async () => {
      const p = s.getUnitId(), S = await t.listCollaborators({
        objectID: p,
        unitID: p
      });
      c(S);
    })();
  }, []), Ee(() => {
    (async () => {
      const p = s.getUnitId(), S = n.getRule(p, l.getSheetId());
      if (!S)
        return;
      h(!0);
      const C = (await t.list({
        unitID: s.getUnitId(),
        objectIDs: [S.permissionId],
        actions: Y1
      }))[0].strategies.reduce((I, R) => (Cs[R.action] && (I[R.action] = {
        text: r.t(`permission.panel.${Cs[R.action]}`),
        allowed: R.role !== Lt.Owner
      }), I), {});
      m(C), setTimeout(() => {
        h(!1);
      }, 100);
    })();
  }, []);
  const f = async () => {
    const v = e.getCurrentUnitForType(O.UNIVER_SHEET), p = v == null ? void 0 : v.getActiveSheet();
    if (!p)
      throw new Error("No active sheet found");
    const S = v.getUnitId(), w = p.getSheetId(), C = n.getRule(S, w), I = Object.keys(g).map((y) => ({
      action: Number(y),
      role: g[y].allowed ? Lt.Editor : Lt.Owner
    }));
    let R = C == null ? void 0 : C.permissionId;
    R ? t.update({
      objectType: yn.Worksheet,
      objectID: R,
      unitID: S,
      strategies: I,
      share: void 0,
      name: "",
      scope: {
        read: on.AllCollaborator,
        edit: on.AllCollaborator
      },
      collaborators: void 0
    }).then(() => {
      MS().forEach((y) => {
        const M = new y(S, w), E = M.subType, T = I.find((P) => P.action === E);
        T && o.updatePermissionPoint(M.id, T.role === Lt.Editor);
      });
    }) : (R = await t.create({
      objectType: yn.Worksheet,
      worksheetObject: {
        unitID: S,
        collaborators: a,
        name: "",
        strategies: I,
        scope: {
          read: on.AllCollaborator,
          edit: on.AllCollaborator
        }
      }
    }), d.executeCommand(yS.id, {
      rule: {
        permissionId: R,
        unitId: S,
        subUnitId: w
      }
    }));
  };
  return /* @__PURE__ */ b(II, { loading: u, children: /* @__PURE__ */ q("div", { className: Te("univer-flex univer-flex-col", qs), children: [
    Object.keys(g).map((v) => {
      const p = g[v], { text: S, allowed: w } = p;
      return /* @__PURE__ */ q(
        "div",
        {
          className: "univer-my-1.5 univer-flex univer-h-5 univer-items-center univer-justify-between univer-leading-5",
          children: [
            /* @__PURE__ */ b("div", { children: S }),
            /* @__PURE__ */ b(
              _C,
              {
                defaultChecked: w,
                onChange: () => {
                  m({
                    ...g,
                    [v]: {
                      ...p,
                      allowed: !w
                    }
                  });
                }
              }
            )
          ]
        },
        S
      );
    }),
    /* @__PURE__ */ q(
      "div",
      {
        className: Te("univer-flex univer-h-9 univer-items-center univer-justify-end univer-gap-2 univer-pt-2", qs),
        children: [
          /* @__PURE__ */ b(
            jt,
            {
              onClick: () => {
                i.close(ol);
              },
              children: r.t("permission.button.cancel")
            }
          ),
          /* @__PURE__ */ b(
            jt,
            {
              variant: "primary",
              onClick: () => {
                f(), i.close(ol);
              },
              children: r.t("permission.button.confirm")
            }
          )
        ]
      }
    )
  ] }) });
}, MI = () => {
  var d;
  const [r, e] = re(""), t = L(xe), n = L(Qo), i = L(Vr), o = dt(i.userList$, i.userList), s = (d = o == null ? void 0 : o.filter((u) => {
    var h;
    return ((h = u.subject) == null ? void 0 : h.name.toLocaleLowerCase().includes(r.toLocaleLowerCase())) && u.role === Lt.Editor;
  })) != null ? d : [], [l, a] = re(i.selectUserList), c = (u) => {
    if ((l == null ? void 0 : l.findIndex((g) => {
      var m, f;
      return ((m = g.subject) == null ? void 0 : m.userID) === ((f = u.subject) == null ? void 0 : f.userID);
    })) === -1) {
      const g = { ...u };
      a([...l, g]);
    } else {
      const g = l.filter((m) => {
        var f, v;
        return ((f = m.subject) == null ? void 0 : f.userID) !== ((v = u.subject) == null ? void 0 : v.userID);
      });
      a(g);
    }
  };
  return /* @__PURE__ */ q("div", { children: [
    /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(
      Zs,
      {
        className: "univer-w-full",
        placeholder: t.t("permission.dialog.search"),
        value: r,
        onChange: (u) => e(u)
      }
    ) }),
    /* @__PURE__ */ b("div", { className: Te("univer-h-60 univer-overflow-y-auto", ra), children: (s == null ? void 0 : s.length) > 0 ? s == null ? void 0 : s.map((u) => {
      var h, g, m;
      return /* @__PURE__ */ q(
        "div",
        {
          className: "univer-my-2 univer-flex univer-items-center univer-rounded-md hover:univer-bg-gray-50",
          onClick: () => c(u),
          children: [
            /* @__PURE__ */ b(kd, { src: (h = u.subject) == null ? void 0 : h.avatar, size: 24 }),
            /* @__PURE__ */ b("div", { className: "univer-ml-1.5 univer-flex-1", children: (g = u.subject) == null ? void 0 : g.name }),
            (l == null ? void 0 : l.findIndex((f) => {
              var v, p;
              return ((v = f.subject) == null ? void 0 : v.userID) === ((p = u.subject) == null ? void 0 : p.userID);
            })) !== -1 && /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b(Dr, {}) })
          ]
        },
        (m = u.subject) == null ? void 0 : m.userID
      );
    }) : /* @__PURE__ */ q("div", { className: "univer-flex univer-h-full univer-flex-col univer-items-center", children: [
      /* @__PURE__ */ b(
        "img",
        {
          className: "univer-w-full",
          src: Ip,
          alt: "empty list",
          draggable: !1
        }
      ),
      /* @__PURE__ */ b("p", { className: "univer-text-sm univer-text-gray-400", children: t.t("permission.dialog.userEmpty") })
    ] }) }),
    /* @__PURE__ */ b("div", { className: "univer-h-px univer-w-full univer-bg-gray-200" }),
    /* @__PURE__ */ q("div", { className: "univer-flex univer-items-center univer-justify-end univer-gap-1 univer-py-2", children: [
      /* @__PURE__ */ b(
        jt,
        {
          onClick: () => n.close(il),
          children: t.t("permission.button.cancel")
        }
      ),
      /* @__PURE__ */ b(
        jt,
        {
          variant: "primary",
          onClick: () => {
            i.setSelectUserList(l), n.close(il);
          },
          children: t.t("permission.button.confirm")
        }
      )
    ] })
  ] });
}, EI = ({ errorMsg: r }) => {
  const e = L(xe);
  return /* @__PURE__ */ b("div", { children: /* @__PURE__ */ b("p", { className: "univer-m-0", children: r || e.t("permission.dialog.alertContent") }) });
}, yp = "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNCIgaGVpZ2h0PSI0IiB2aWV3Qm94PSIwIDAgNCA0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8bWFzayBpZD0ibWFzazBfNzU5XzExMDgiIHN0eWxlPSJtYXNrLXR5cGU6YWxwaGEiIG1hc2tVbml0cz0idXNlclNwYWNlT25Vc2UiIHg9IjAiIHk9IjAiIHdpZHRoPSI0IiBoZWlnaHQ9IjQiPgo8cmVjdCB3aWR0aD0iNCIgaGVpZ2h0PSI0IiBmaWxsPSIjRDZEOEQ5Ii8+CjwvbWFzaz4KPGcgbWFzaz0idXJsKCNtYXNrMF83NTlfMTEwOCkiPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTS0zLjY0MDAyIDMuNDQxNDFMMi4wNzM5NyAtMi4yNzI1OEwyLjc4MTA4IC0xLjU2NTQ4TC0yLjkzMjkxIDQuMTQ4NTJMLTMuNjQwMDIgMy40NDE0MVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0tMS41MTg2OCA1LjU2Mjc1TDQuMTk1MzEgLTAuMTUxMjQ1TDQuOTAyNDIgMC41NTU4NjJMLTAuODExNTc1IDYuMjY5ODZMLTEuNTE4NjggNS41NjI3NVoiIGZpbGw9IiNENkQ4REIiLz4KPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0wLjYwMjY1NiA3LjY4NDAzTDYuMzE2NjUgMS45NzAwM0w3LjAyMzc2IDIuNjc3MTRMMS4zMDk3NiA4LjM5MTEzTDAuNjAyNjU2IDcuNjg0MDNaIiBmaWxsPSIjRDZEOERCIi8+CjwvZz4KPC9zdmc+", gu = "RANGE_PROTECTION_CAN_VIEW_RENDER_EXTENSION_KEY", mu = "RANGE_PROTECTION_CAN_NOT_VIEW_RENDER_EXTENSION_KEY", TI = 25, PI = 80;
class Mp extends Kg {
  constructor(t) {
    super();
    _(this, "_pattern", null);
    _(this, "_img", new Image());
    _(this, "renderCache", /* @__PURE__ */ new Set());
    _(this, "_shadowStrategy", "always");
    this._img.src = yp, t && (this._shadowStrategy = t);
  }
  clearCache() {
    this.renderCache.clear();
  }
  /**
   * Set the shadow strategy for this extension
   * @param strategy The shadow strategy
   */
  setShadowStrategy(t) {
    this._shadowStrategy = t, this.clearCache();
  }
  /**
   * Get the current shadow strategy
   */
  getShadowStrategy() {
    return this._shadowStrategy;
  }
  draw(t, n, i) {
    const { worksheet: o } = i;
    o && (t.save(), this._pattern || (this._pattern = t.createPattern(this._img, "repeat")), this.renderCache.clear(), Ts.foreach(i.rowColumnSegment, (s, l) => {
      if (!o.getRowVisible(s) || !o.getColVisible(l))
        return;
      const { selectionProtection: a = [] } = o.getCell(s, l) || {};
      this._pattern && (t.fillStyle = this._pattern, a.forEach((c) => {
        if (c.ruleId && this.shouldRender(c)) {
          if (this.renderCache.has(c.ruleId))
            return;
          this.renderCache.add(c.ruleId), c.ranges.forEach((d) => {
            const u = i.getCellWithCoordByIndex(d.startRow, d.startColumn, !1), h = i.getCellWithCoordByIndex(d.endRow, d.endColumn, !1);
            t.fillRect(u.startX, u.startY, h.endX - u.startX, h.endY - u.startY);
          });
        }
      }));
    }), t.restore());
  }
}
class xI extends Mp {
  constructor(t) {
    super(t);
    _(this, "uKey", gu);
    _(this, "Z_INDEX", TI);
  }
  shouldRender(t) {
    return this._shadowStrategy === "none" ? !1 : this._shadowStrategy === "non-editable" ? (t == null ? void 0 : t[ae.View]) !== !1 && (t == null ? void 0 : t[ae.Edit]) === !1 : this._shadowStrategy === "non-viewable" ? (t == null ? void 0 : t[ae.View]) === !1 : (t == null ? void 0 : t[ae.View]) !== !1;
  }
}
class OI extends Mp {
  constructor(t) {
    super(t);
    _(this, "uKey", mu);
    _(this, "Z_INDEX", PI);
  }
  shouldRender(t) {
    return this._shadowStrategy === "none" ? !1 : (t == null ? void 0 : t[ae.View]) === !1;
  }
}
const fu = "worksheet-protection", Lh = 25, AI = 80;
class HI extends Kg {
  constructor(t) {
    super();
    _(this, "uKey", fu);
    _(this, "Z_INDEX", Lh);
    _(this, "_pattern");
    _(this, "_img", new Image());
    _(this, "_shadowStrategy", "always");
    this._img.src = yp, t && (this._shadowStrategy = t);
  }
  draw(t, n, i) {
    const { worksheet: o } = i;
    if (!o)
      return !1;
    t.save(), this._pattern || (this._pattern = t.createPattern(this._img, "repeat"));
    const { startRow: s, startColumn: l, endRow: a, endColumn: c } = i.rowColumnSegment, d = i.getCellWithCoordByIndex(s, l, !1), u = i.getCellWithCoordByIndex(a, c, !1), { hasWorksheetRule: h = !1, selectionProtection: g = [] } = o.getCell(s, l) || {};
    if (!this._pattern)
      return;
    if (g.length > 0) {
      const f = g[0];
      (f == null ? void 0 : f[ae.View]) ? this.setZIndex(Lh) : this.setZIndex(AI);
    }
    t.fillStyle = this._pattern;
    let m = h;
    if (this._shadowStrategy === "none")
      m = !1;
    else if (h && g.length > 0) {
      const f = g[0];
      this._shadowStrategy === "non-editable" ? m = (f == null ? void 0 : f[ae.Edit]) === !1 : this._shadowStrategy === "non-viewable" && (m = (f == null ? void 0 : f[ae.View]) === !1);
    }
    m && t.fillRect(d.startX, d.startY, u.endX - d.startX, u.endY - d.startY), t.restore();
  }
  /**
   * Set the shadow strategy for this extension
   * @param strategy The shadow strategy
   */
  setShadowStrategy(t) {
    this._shadowStrategy = t;
  }
  /**
   * Get the current shadow strategy
   */
  getShadowStrategy() {
    return this._shadowStrategy;
  }
  setZIndex(t) {
    this.Z_INDEX = t;
  }
}
var VI = Object.getOwnPropertyDescriptor, pu = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? VI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, an = (r, e) => (t, n) => e(t, n, r);
let Vi = class extends oe {
  constructor(r, e) {
    super(), this._injector = r, this._componentManager = e, this._init();
  }
  _init() {
    this._initComponents(), this._initUiPartComponents();
  }
  _initComponents() {
    [
      [Om, qm],
      [Z1, Pa],
      [G1, ou],
      [q1, Dr],
      [Am, iu],
      [yo, RI],
      [Pm, MI],
      [xm, yI],
      [Af, EI]
    ].forEach(([r, e]) => {
      this.disposeWithMe(this._componentManager.register(
        r,
        e
      ));
    });
  }
  _initUiPartComponents() {
    const e = this._injector.get(Vt).getConfig(Tt);
    if (e != null && e.protectedRangeUserSelector) {
      const { component: t, framework: n } = e.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(ga, t, {
          framework: n
        })
      );
    }
  }
};
Vi = pu([
  an(0, N(Rt)),
  an(1, N(kt))
], Vi);
let yl = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "_rangeProtectionCanViewRenderExtension");
    _(this, "_rangeProtectionCanNotViewRenderExtension");
    this._context = e, this._rangeProtectionRuleModel = t, this._sheetSkeletonManagerService = n, this._permissionService = i, this._configService = o;
    const s = this._configService.getConfig(Tt), l = tu(s == null ? void 0 : s.protectedRangeShadow);
    this._rangeProtectionCanViewRenderExtension = new xI(l), this._rangeProtectionCanNotViewRenderExtension = new OI(l), this._initSkeleton(), this._initRender(), this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe((a) => {
      var c, d;
      ((c = a.oldRule) != null && c.id && this._rangeProtectionCanViewRenderExtension.renderCache.has(a.oldRule.id) || this._rangeProtectionCanViewRenderExtension.renderCache.has(a.rule.id)) && this._rangeProtectionCanViewRenderExtension.clearCache(), ((d = a.oldRule) != null && d.id && this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a.oldRule.id) || this._rangeProtectionCanNotViewRenderExtension.renderCache.has(a.rule.id)) && this._rangeProtectionCanNotViewRenderExtension.clearCache();
    }));
  }
  _initRender() {
    const e = this._context.mainComponent;
    e && (e.getExtensionByKey(gu) || e.register(this._rangeProtectionCanViewRenderExtension), e.getExtensionByKey(mu) || e.register(this._rangeProtectionCanNotViewRenderExtension));
  }
  _initSkeleton() {
    const e = () => {
      var t;
      this._sheetSkeletonManagerService.reCalculate(), (t = this._context.mainComponent) == null || t.makeDirty();
    };
    this.disposeWithMe(St(
      this._permissionService.permissionPointUpdate$.pipe(Ys(300, void 0, { trailing: !0 })),
      this._rangeProtectionRuleModel.rangeRuleInitStateChange$,
      this._rangeProtectionRuleModel.ruleChange$
    ).pipe().subscribe(e));
  }
};
yl = pu([
  an(1, N($e)),
  an(2, N(ue)),
  an(3, rt),
  an(4, Vt)
], yl);
let Ml = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "_worksheetProtectionRenderExtension");
    this._context = e, this._renderManagerService = t, this._sheetSkeletonManagerService = n, this._worksheetProtectionRuleModel = i, this._configService = o;
    const s = this._configService.getConfig(Tt), l = tu(s == null ? void 0 : s.protectedRangeShadow);
    this._worksheetProtectionRenderExtension = new HI(l), this._initSkeleton(), l !== "none" && this._initRender();
  }
  _initRender() {
    const e = this._context.unitId, t = e && this._renderManagerService.getRenderById(e), n = t && t.mainComponent;
    n && (n.getExtensionByKey(fu) || n.register(this._worksheetProtectionRenderExtension));
  }
  _initSkeleton() {
    const e = () => {
      var t;
      this._sheetSkeletonManagerService.reCalculate(), (t = this._context.mainComponent) == null || t.makeDirty();
    };
    this.disposeWithMe(St(
      this._worksheetProtectionRuleModel.worksheetRuleInitStateChange$
    ).pipe().subscribe(e));
  }
};
Ml = pu([
  an(1, N(fe)),
  an(2, N(ue)),
  an(3, N(ft)),
  an(4, N(Vt))
], Ml);
var NI = Object.getOwnPropertyDescriptor, kI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? NI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Sc = (r, e) => (t, n) => e(t, n, r);
let El = class extends oe {
  constructor(r, e, t, n) {
    super(), this._context = r, this._sheetSkeletonManagerService = e, this._sheetClipboardService = t, this._sheetClipboardController = n, this._initialize();
  }
  _initialize() {
    this.disposeWithMe(
      We(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((r) => {
        if (!(r != null && r.unitId) || !this._sheetClipboardService.getPasteMenuVisible())
          return;
        const e = this._sheetClipboardService.getPasteOptionsCache(), t = e == null ? void 0 : e.target.unitId;
        r.unitId === t && this._sheetClipboardController.refreshOptionalPaste();
      }))
    );
  }
};
El = kI([
  Sc(1, N(ue)),
  Sc(2, nn),
  Sc(3, N(Tr))
], El);
var DI = Object.getOwnPropertyDescriptor, LI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? DI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Cc = (r, e) => (t, n) => e(t, n, r);
let Tl = class extends oe {
  constructor(r, e, t, n) {
    super(), this._context = r, this._formatPainterService = e, this._selectionRenderService = t, this._commandService = n, this._initialize();
  }
  _initialize() {
    this._bindFormatPainterStatus(), this._commandExecutedListener();
  }
  _commandExecutedListener() {
    this.disposeWithMe(
      this._selectionRenderService.selectionMoveEnd$.subscribe((r) => {
        var e;
        if (this._formatPainterService.getStatus() !== zt.OFF) {
          const { rangeWithCoord: t } = r[r.length - 1];
          this._commandService.executeCommand(wa.id, {
            unitId: this._context.unitId,
            subUnitId: ((e = this._context.unit.getActiveSheet()) == null ? void 0 : e.getSheetId()) || "",
            range: {
              startRow: t.startRow,
              startColumn: t.startColumn,
              endRow: t.endRow,
              endColumn: t.endColumn
            }
          }), this._formatPainterService.getStatus() === zt.ONCE && this._commandService.executeCommand(rs.id);
        }
      })
    );
  }
  _bindFormatPainterStatus() {
    this.disposeWithMe(
      We(this._formatPainterService.status$.subscribe((r) => {
        const e = this._context.scene;
        e && (r !== zt.OFF ? e.setDefaultCursor(ye.CELL) : e.setDefaultCursor(ye.DEFAULT));
      }))
    );
  }
};
Tl = LI([
  Cc(1, Dn),
  Cc(2, gt),
  Cc(3, W)
], Tl);
var Jc = /* @__PURE__ */ ((r) => (r[r.NORMAL = 0] = "NORMAL", r[r.HIGHLIGHT = 1] = "HIGHLIGHT", r))(Jc || {});
const WI = "rgba(0, 0, 0, 0.15)", In = "rgb(0, 0, 0)", ys = "rgb(255, 255, 255, 1)";
class BI extends Md {
  constructor(t, n) {
    super(t, n);
    _(this, "_size", 12);
    _(this, "_iconRatio", 0.4);
    _(this, "_mode", 0);
    this.setShapeProps(n);
  }
  setShapeProps(t) {
    t != null && t.size && (this._size = t.size), t != null && t.mode && (this._mode = t.mode), this.transformByState({
      width: this._size,
      height: this._size
    });
  }
  _draw(t) {
    this._mode === 1 && Se.drawWith(t, {
      width: this._size,
      height: this._size,
      radius: this._size,
      fill: WI
    });
    const n = this._size * 0.5 * this._iconRatio, i = Math.PI / 180 * 60, o = n * Math.sin(i), s = n * Math.cos(i);
    so.drawWith(t, {
      pointsGroup: [
        [
          { x: -o + this._size / 2, y: -s + this._size / 2 },
          { x: o + this._size / 2, y: -s + this._size / 2 },
          { x: this._size / 2, y: n + this._size / 2 }
        ]
      ],
      // left: this.left,
      // top: this.top,
      fill: In
    });
  }
}
var FI = Object.getOwnPropertyDescriptor, UI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? FI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Ms = (r, e) => (t, n) => e(t, n, r);
const XI = "__SpreadsheetHeaderMenuSHAPEControllerShape__", zI = "__SpreadsheetHeaderMenuMAINControllerShape__", jI = "rgba(0, 0, 0, 0.1)";
let Pl = class extends oe {
  constructor(e, t, n, i, o) {
    super();
    _(this, "_hoverRect");
    _(this, "_hoverMenu");
    _(this, "_currentColumn", Number.POSITIVE_INFINITY);
    // private _rowHeaderPointerMoveSub: Subscription;
    // private _colHeaderPointerMoveSub: Subscription;
    // private _rowHeaderPointerLeaveSub: Subscription;
    // private _colHeaderPointerLeaveSub: Subscription;
    // private _rowHeaderPointerEnterSub: Subscription;
    // private _colHeaderPointerEnterSub: Subscription;
    _(this, "_headerPointerSubs");
    _(this, "_colHeaderPointerSubs");
    this._context = e, this._sheetSkeletonManagerService = t, this._contextMenuService = n, this._commandService = i, this._selectionManagerService = o, this._initialize();
  }
  dispose() {
    var e, t, n;
    (e = this._hoverRect) == null || e.dispose(), (t = this._hoverMenu) == null || t.dispose(), (n = this._headerPointerSubs) == null || n.unsubscribe(), this._headerPointerSubs = null;
  }
  _initialize() {
    const e = this._context.scene;
    this._hoverRect = new Se(XI, {
      fill: jI,
      evented: !1
    }), this._hoverMenu = new BI(zI, { zIndex: 100, visible: !1 }), e.addObjects([this._hoverRect, this._hoverMenu], rr), this._initialHover(
      0
      /* ROW */
    ), this._initialHover(
      1
      /* COLUMN */
    ), this._initialHoverMenu();
  }
  // eslint-disable-next-line max-lines-per-function
  _initialHover(e = 0) {
    var u, h, g;
    const t = this._context.components.get(Ye.COLUMN), n = this._context.components.get(Ye.ROW), i = e === 0 ? n : t, o = (m) => {
      var y, M, E;
      const f = (y = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : y.skeleton;
      if (f == null)
        return;
      const { rowHeaderWidth: v, columnHeaderHeight: p } = f, { startX: S, startY: w, endX: C, endY: I, column: R } = Vn(
        m.offsetX,
        m.offsetY,
        this._context.scene,
        f
      );
      if (e === 0)
        (M = this._hoverRect) == null || M.transformByState({
          width: v,
          height: I - w,
          left: 0,
          top: w
        });
      else {
        if (this._currentColumn = R, (E = this._hoverRect) == null || E.transformByState({
          width: C - S,
          height: p,
          left: S,
          top: 0
        }), this._hoverMenu == null)
          return;
        if (C - S < p * 2) {
          this._hoverMenu.hide();
          return;
        }
        const T = p * 0.8;
        this._hoverMenu.transformByState({
          left: C - p,
          top: p / 2 - T / 2
        }), this._hoverMenu.setShapeProps({ size: T }), this._hoverMenu.show();
      }
    }, s = () => {
      var m;
      (m = this._hoverRect) == null || m.show();
    }, l = () => {
      var m, f;
      (m = this._hoverRect) == null || m.hide(), (f = this._hoverMenu) == null || f.hide();
    };
    this._headerPointerSubs = new Kn();
    const a = i.onPointerMove$.subscribeEvent(o), c = i.onPointerEnter$.subscribeEvent(s), d = i.onPointerLeave$.subscribeEvent(l);
    (u = this._headerPointerSubs) == null || u.add(a), (h = this._headerPointerSubs) == null || h.add(c), (g = this._headerPointerSubs) == null || g.add(d);
  }
  _initialHoverMenu() {
    this._hoverMenu != null && (this._hoverMenu.onPointerEnter$.subscribeEvent(() => {
      this._hoverMenu != null && (this._hoverMenu.setProps({
        mode: Jc.HIGHLIGHT,
        visible: !0
      }), this._context.scene.setCursor(ye.POINTER));
    }), this._hoverMenu.onPointerLeave$.subscribeEvent(() => {
      this._hoverMenu != null && (this._hoverMenu.setProps({
        mode: Jc.NORMAL,
        visible: !1
      }), this._context.scene.resetCursor());
    }), this._hoverMenu.onPointerDown$.subscribeEvent((e) => {
      var o;
      const t = this._currentColumn, n = (o = this._selectionManagerService.getCurrentSelections()) == null ? void 0 : o.map((s) => s.range);
      if (!!!(n != null && n.filter((s) => s.rangeType === z.COLUMN).find((s) => {
        const { startColumn: l, endColumn: a } = s;
        return t >= l && t <= a;
      }))) {
        const s = this._getSelectionOnColumn(t);
        this._commandService.syncExecuteCommand(Ie.id, s);
      }
      e.stopPropagation(), e.preventDefault(), this._contextMenuService.triggerContextMenu(e, _t.COL_HEADER);
    }));
  }
  _getSelectionOnColumn(e) {
    const t = this._context.unit, n = t.getActiveSheet();
    if (!n)
      throw new Error("No active worksheet");
    return {
      unitId: t.getUnitId(),
      subUnitId: n.getSheetId(),
      selections: [
        {
          range: {
            startRow: 0,
            startColumn: e,
            endRow: n.getRowCount() - 1,
            endColumn: e,
            rangeType: z.COLUMN
          },
          primary: {
            startRow: 0,
            startColumn: e,
            endRow: 0,
            endColumn: e,
            actualRow: 0,
            actualColumn: e,
            isMerged: !1,
            isMergedMainCell: !1
          },
          style: null
        }
      ]
    };
  }
};
Pl = UI([
  Ms(1, N(ue)),
  Ms(2, Pd),
  Ms(3, W),
  Ms(4, N(Q))
], Pl);
var $c = /* @__PURE__ */ ((r) => (r[r.ROW = 0] = "ROW", r[r.COLUMN = 1] = "COLUMN", r))($c || {});
const ao = 12, YI = 0.4;
class Wh extends Md {
  constructor(t, n, i) {
    super(t, n);
    _(this, "_size", ao);
    _(this, "_iconRatio", YI);
    _(this, "_hovered", !0);
    _(this, "_hasPrevious", !0);
    _(this, "_hasNext", !0);
    _(this, "_unhideType");
    n && this.setShapeProps(n), this.onPointerEnter$.subscribeEvent(() => this.setShapeProps({ hovered: !0 })), this.onPointerLeave$.subscribeEvent(() => this.setShapeProps({ hovered: !1 })), this.onPointerDown$.subscribeEvent(() => i == null ? void 0 : i());
  }
  setShapeProps(t) {
    t.type !== void 0 && (this._unhideType = t.type), t.hovered !== void 0 && (this._hovered = t.hovered), t.hasPrevious !== void 0 && (this._hasPrevious = t.hasPrevious), t.hasNext !== void 0 && (this._hasNext = t.hasNext), this.transformByState({
      width: this._size * (this._unhideType === 1 ? 2 : 1),
      height: this._size * (this._unhideType === 0 ? 2 : 1)
    });
  }
  _draw(t) {
    this._unhideType === 0 ? this._drawOnRow(t) : this._drawOnCol(t);
  }
  _drawOnRow(t) {
    this._hovered && (!this._hasNext || !this._hasPrevious ? Se.drawWith(t, {
      width: this._size,
      height: this._size,
      stroke: In,
      fill: ys
    }) : Se.drawWith(t, {
      width: this._size,
      height: 2 * this._size,
      stroke: In,
      fill: ys
    }));
    const n = this._size * 0.5 * this._iconRatio, i = Math.PI / 3, o = n * Math.cos(i), s = n * Math.sin(i);
    if (this._hasPrevious && so.drawWith(t, {
      pointsGroup: [
        [
          { x: this._size / 2, y: this._size / 2 - s },
          { x: this._size / 2 - s, y: this._size / 2 + o },
          { x: this._size / 2 + s, y: this._size / 2 + o }
        ]
      ],
      fill: In
    }), this._hasNext) {
      const l = this._hasPrevious ? 3 : 1;
      so.drawWith(t, {
        pointsGroup: [
          [
            { x: this._size / 2, y: this._size * l / 2 + s },
            { x: this._size / 2 - s, y: this._size * l / 2 - o },
            { x: this._size / 2 + s, y: this._size * l / 2 - o }
          ]
        ],
        fill: In
      });
    }
  }
  /**
   *
   * @param ctx
   */
  _drawOnCol(t) {
    this._hovered && (!this._hasNext || !this._hasPrevious ? Se.drawWith(t, {
      width: this._size,
      height: this._size,
      stroke: In,
      fill: ys
    }) : Se.drawWith(t, {
      width: 2 * this._size,
      height: this._size,
      stroke: In,
      fill: ys
    }));
    const n = this._size * 0.5 * this._iconRatio, i = Math.PI / 3, o = n * Math.cos(i), s = n * Math.sin(i);
    if (this._hasPrevious && so.drawWith(t, {
      pointsGroup: [
        [
          { x: -o + this._size / 2, y: this._size / 2 },
          { x: this._size / 2 + s, y: this._size / 2 - s },
          { x: this._size / 2 + s, y: this._size / 2 + s }
        ]
      ],
      fill: In
    }), this._hasNext) {
      const l = this._hasPrevious ? 3 : 1;
      so.drawWith(t, {
        pointsGroup: [
          [
            { x: o + this._size * l / 2, y: this._size / 2 },
            { x: -s + this._size * l / 2, y: this._size / 2 - s },
            { x: -s + this._size * l / 2, y: this._size / 2 + s }
          ]
        ],
        fill: In
      });
    }
  }
}
var ZI = Object.getOwnPropertyDescriptor, GI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ZI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Bh = (r, e) => (t, n) => e(t, n, r);
const Fh = "__SpreadsheetHeaderUnhideSHAPEControllerShape__";
let xl = class extends kn {
  constructor(e, t, n) {
    super();
    _(this, "_shapes", { cols: [], rows: [] });
    this._context = e, this._sheetSkeletonManagerService = t, this._commandService = n, this._init();
  }
  get _workbook() {
    return this._context.unit;
  }
  dispose() {
    super.dispose(), this._clearShapes();
  }
  _init() {
    let e = "";
    this._context.unit.activeSheet$.pipe(ui(this.dispose$)).subscribe((t) => {
      if (this._clearShapes(), !t) {
        e = "";
        return;
      }
      e = t.getSheetId(), this._update(this._workbook, t);
    }), this.disposeWithMe(
      this._sheetSkeletonManagerService.currentSkeleton$.subscribe((t) => {
        if (t) {
          const { unitId: n, sheetId: i } = t;
          if (n === this._workbook.getUnitId() && i === e) {
            const o = this._workbook.getSheetBySheetId(i);
            o && this._update(this._workbook, o);
          }
        }
      })
    );
  }
  _update(e, t) {
    var h;
    const n = (h = this._sheetSkeletonManagerService.getSkeletonParam(t.getSheetId())) == null ? void 0 : h.skeleton;
    if (!n) return;
    const i = t.getHiddenRows(), o = t.getHiddenCols(), s = this._getSheetObject(), { scene: l } = s, a = t.getRowCount(), c = i.map((g) => {
      const { startRow: m, endRow: f } = g, v = lh(m, 0, l, n), p = m !== 0, S = f !== a - 1;
      return new Wh(
        Fh,
        {
          type: $c.ROW,
          hovered: !1,
          hasPrevious: p,
          hasNext: S,
          top: v.startY - (p ? ao : 0),
          left: v.startX - ao
        },
        () => this._commandService.executeCommand(
          ES.id,
          {
            unitId: e.getUnitId(),
            subUnitId: t.getSheetId(),
            ranges: [g]
          }
        )
      );
    }), d = t.getColumnCount(), u = o.map((g) => {
      const { startColumn: m, endColumn: f } = g, v = lh(0, m, l, n), p = m !== 0, S = f !== d - 1;
      return new Wh(
        Fh,
        {
          type: $c.COLUMN,
          hovered: !1,
          hasPrevious: p,
          hasNext: S,
          top: 20 - ao,
          left: v.startX - (p ? ao : 0)
        },
        () => this._commandService.executeCommand(
          TS.id,
          {
            unitId: e.getUnitId(),
            subUnitId: t.getSheetId(),
            ranges: [g]
          }
        )
      );
    });
    l.addObjects(u, Bu), l.addObjects(c, Bu), this._clearShapes(), this._shapes = { cols: u, rows: c };
  }
  _clearShapes() {
    this._shapes.cols.forEach((e) => e.dispose()), this._shapes.rows.forEach((e) => e.dispose()), this._shapes = { cols: [], rows: [] };
  }
  _getSheetObject() {
    return en(this._workbook, this._context);
  }
};
xl = GI([
  Bh(1, N(ue)),
  Bh(2, W)
], xl);
var qI = Object.getOwnPropertyDescriptor, QI = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? qI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, jr = (r, e) => (t, n) => e(t, n, r);
const KI = [Ut.id, Wn.id];
let ed = class extends oe {
  constructor(r, e, t, n, i, o, s) {
    super(), this._context = r, this._sheetSkeletonManagerService = e, this._commandService = t, this._renderManagerService = n, this._selectionManagerService = i, this._scrollManagerService = o, this._univerInstanceService = s, this._init();
  }
  scrollToRange(r) {
    let { endRow: e, endColumn: t, startColumn: n, startRow: i } = r;
    const o = this._getViewportBounding();
    if (r.rangeType === z.ROW ? (n = 0, t = 0) : r.rangeType === z.COLUMN && (i = 0, e = 0), o) {
      const s = o.startRow > e ? i : e, l = o.startColumn > t ? n : t;
      return this._scrollToCell(s, l);
    } else
      return this._scrollToCell(i, n);
  }
  _init() {
    this._initCommandListener(), this._initScrollEventListener(), this._initPointerScrollEvent(), this._initSkeletonListener();
  }
  _initCommandListener() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((r) => {
        if (KI.includes(r.id))
          this._scrollToSelection();
        else if (r.id === fd.id) {
          const e = r.params.range;
          this.scrollToRange(e);
        } else if (r.id === Gt.id) {
          const e = r.params;
          this._scrollToSelectionForExpand(e);
        }
      })
    );
  }
  _scrollToSelectionForExpand(r) {
    setTimeout(() => {
      const e = this._selectionManagerService.getCurrentLastSelection();
      if (e == null)
        return;
      const { startRow: t, startColumn: n, endRow: i, endColumn: o } = e.range, s = this._getViewportBounding();
      if (s == null)
        return;
      const { startRow: l, startColumn: a, endRow: c, endColumn: d } = s;
      let u = 0, h = 0;
      t > l ? u = i : i < c ? u = t : u = l, n > a ? h = o : o < d ? h = n : h = a, r.direction === U.DOWN ? u = i : r.direction === U.UP ? u = t : r.direction === U.RIGHT ? h = o : r.direction === U.LEFT && (h = n), this._scrollToCell(u, h);
    }, 0);
  }
  _getFreeze() {
    var e;
    const r = (e = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : e.skeleton.getWorksheetConfig();
    if (r != null)
      return r.freeze;
  }
  // eslint-disable-next-line max-lines-per-function
  _initScrollEventListener() {
    const { scene: r } = this._context;
    if (r == null) return;
    const e = r.getViewport(F.VIEW_MAIN);
    e && (this.disposeWithMe(
      We(
        // wheel event --> set-scroll.command('sheet.operation.set-scroll') --> scroll.operation.ts -->
        // scrollManagerService.setScrollInfoAndEmitEvent --->  scrollManagerService.setScrollInfo(raw value, may be negative) &&
        // _notifyCurrentScrollInfo
        this._scrollManagerService.rawScrollInfo$.subscribe((t) => {
          var h;
          if (t == null) {
            e.scrollToViewportPos({
              viewportScrollX: 0,
              viewportScrollY: 0
            });
            return;
          }
          const n = (h = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h.skeleton;
          if (!n) return;
          const { sheetViewStartRow: i, sheetViewStartColumn: o, offsetX: s, offsetY: l } = t, { startX: a, startY: c } = n.getCellWithCoordByIndex(
            i,
            o,
            !1
          ), d = a + s, u = c + l;
          e.scrollToViewportPos({ viewportScrollX: d, viewportScrollY: u });
        })
      )
    ), this.disposeWithMe(
      e.onScrollAfter$.subscribeEvent((t) => {
        var m;
        if (!t) return;
        const n = (m = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : m.skeleton;
        if (n == null) return;
        const i = this._getSheetObject();
        if (n == null || i == null) return;
        const { viewportScrollX: o, viewportScrollY: s, scrollX: l, scrollY: a } = t, { row: c, column: d, rowOffset: u, columnOffset: h } = n.getOffsetRelativeToRowCol(
          o,
          s
        ), g = {
          sheetViewStartRow: c,
          sheetViewStartColumn: d,
          offsetX: h,
          offsetY: u,
          viewportScrollX: o,
          viewportScrollY: s,
          scrollX: l,
          scrollY: a
        };
        this._scrollManagerService.setValidScrollStateToCurrSheet(g), this._scrollManagerService.validViewportScrollInfo$.next({
          ...g,
          scrollX: l,
          scrollY: a,
          viewportScrollX: o,
          viewportScrollY: s
        });
      })
    ), this.disposeWithMe(
      e.onScrollByBar$.subscribeEvent((t) => {
        var h;
        const n = (h = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h.skeleton;
        if (n == null || t.isTrigger === !1)
          return;
        const i = this._getSheetObject();
        if (n == null || i == null)
          return;
        const { viewportScrollX: o = 0, viewportScrollY: s = 0 } = t, l = this._getFreeze(), { row: a, column: c, rowOffset: d, columnOffset: u } = n.getOffsetRelativeToRowCol(
          o,
          s
        );
        this._commandService.executeCommand(mn.id, {
          sheetViewStartRow: a + ((l == null ? void 0 : l.ySplit) || 0),
          sheetViewStartColumn: c + ((l == null ? void 0 : l.xSplit) || 0),
          offsetX: u,
          offsetY: d
        });
      })
    ));
  }
  _initSkeletonListener() {
    this.disposeWithMe(We(
      this._sheetSkeletonManagerService.currentSkeletonBefore$.subscribe((r) => {
        if (r == null)
          return;
        const e = { unitId: r.unitId, sheetId: r.sheetId };
        this._scrollManagerService.setSearchParam(e);
        const t = this._getSheetObject();
        if (!t) return;
        const i = t.scene.getViewport(F.VIEW_MAIN), o = this._scrollManagerService.getScrollStateByParam(e), { viewportScrollX: s, viewportScrollY: l } = this._scrollManagerService.calcViewportScrollFromRowColOffset(o);
        i && (o ? (i.viewportScrollX = s, i.viewportScrollY = l) : (i.viewportScrollX = 0, i.viewportScrollY = 0), this._updateSceneSize(r));
      })
    ));
  }
  /**
   * for mobile
   */
  // eslint-disable-next-line max-lines-per-function
  _initPointerScrollEvent() {
    const r = this._getSheetObject();
    if (!r) return;
    const e = this._scrollManagerService, t = r.scene, n = r.spreadsheet, i = t.getViewport(F.VIEW_MAIN), o = { x: 0, y: 0 };
    let s = !1;
    const l = { x: 0, y: 0 }, a = 0.95;
    let c = null;
    const d = () => {
      if (!i) return;
      l.x *= a, l.y *= a, o.x += l.x, o.y += l.y;
      const h = l.x, g = l.y;
      (g !== 0 || h !== 0) && this._commandService.executeCommand(To.id, { offsetY: g, offsetX: h }), Math.abs(l.x) > 1 || Math.abs(l.y) > 1 ? c = requestAnimationFrame(d) : c = null;
    }, u = () => {
      cancelAnimationFrame(c), c = null;
    };
    n.onPointerDown$.subscribeEvent((h, g) => {
      u(), i && (o.x = h.offsetX, o.y = h.offsetY, s = !0, g.stopPropagation());
    }), n.onPointerMove$.subscribeEvent((h, g) => {
      if (!s || !i) return;
      const m = h, f = -(m.offsetX - o.x), v = -(m.offsetY - o.y);
      l.x = -(m.offsetX - o.x), l.y = -(m.offsetY - o.y);
      const p = f, S = v;
      (f !== 0 || v !== 0) && (S !== 0 || p !== 0) && this._commandService.executeCommand(To.id, { offsetY: S, offsetX: p }), e.getCurrentScrollState(), o.x = m.offsetX, o.y = m.offsetY, g.stopPropagation();
    }), n.onPointerUp$.subscribeEvent((h) => {
      s = !1, c = requestAnimationFrame(d);
    }), n.onPointerLeave$.subscribeEvent(() => {
      s = !1;
    }), n.onPointerOut$.subscribeEvent(() => {
      s = !1;
    }), t.onPointerOut$.subscribeEvent(() => {
      s = !1;
    }), t.onPointerCancel$.subscribeEvent(() => {
      s = !1;
    });
  }
  _updateSceneSize(r) {
    var u;
    if (r == null)
      return;
    const { unitId: e } = this._context, { skeleton: t } = r, n = (u = this._renderManagerService.getRenderById(e)) == null ? void 0 : u.scene;
    if (t == null || n == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o, rowHeaderWidthAndMarginLeft: s, columnHeaderHeightAndMarginTop: l } = t, c = this._context.unit.getActiveSheet();
    if (!c) return;
    const d = c.getZoomRatio() || 1;
    n == null || n.setScaleValueOnly(d, d), n == null || n.transformByState({
      width: s + o,
      height: l + i
    });
  }
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  _scrollToSelectionByDirection(r) {
    const e = this._getViewportBounding();
    if (e == null)
      return !1;
    const {
      startRow: t,
      startColumn: n,
      endRow: i,
      endColumn: o
    } = e;
    let s = 0, l = 0;
    const { startRow: a, startColumn: c, endRow: d, endColumn: u } = r;
    a >= t && (s = d), d <= i && (s = a), c >= n && (l = u), u <= o && (l = c), this._scrollToCell(s, l);
  }
  _scrollToSelection(r = !0) {
    const e = this._selectionManagerService.getCurrentLastSelection();
    if (e == null)
      return;
    const { startRow: t, startColumn: n, actualRow: i, actualColumn: o } = e.primary, s = r ? i : t, l = r ? o : n;
    this._scrollToCell(s, l);
  }
  _getViewportBounding() {
    var n, i;
    const r = (n = this._getSheetObject()) == null ? void 0 : n.scene;
    if (r == null)
      return;
    const e = r.getViewport(F.VIEW_MAIN);
    if (e == null)
      return;
    const t = (i = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : i.skeleton;
    if (t != null)
      return t.getRangeByViewport(e.calcViewportInfo());
  }
  // eslint-disable-next-line max-lines-per-function, complexity
  _scrollToCell(r, e) {
    var I, R, y, M;
    const { rowHeightAccumulation: t, columnWidthAccumulation: n } = (R = (I = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : I.skeleton) != null ? R : {};
    if (t == null || n == null) return !1;
    const i = (y = this._getSheetObject()) == null ? void 0 : y.scene;
    if (i == null) return !1;
    const o = i.getViewport(F.VIEW_MAIN);
    if (o == null || ((M = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : M.skeleton) == null) return !1;
    const l = this._context.unit.getActiveSheet();
    if (!l) return !1;
    const {
      startColumn: a,
      startRow: c,
      ySplit: d,
      xSplit: u
    } = l.getFreeze(), h = this._getViewportBounding();
    if (h == null) return !1;
    const {
      startRow: g,
      startColumn: m,
      endRow: f,
      endColumn: v
    } = h;
    let p, S;
    if (r >= c && e >= a - u && (r <= g && (p = r), r >= f)) {
      const E = t[r] - o.height;
      for (let T = g; T <= r; T++)
        if (t[T] >= E) {
          p = T + 1;
          break;
        }
    }
    if (e >= a && r >= c - d && (e <= m && (S = e), e >= v)) {
      const E = n[e] - o.width;
      for (let T = m; T <= e; T++)
        if (n[T] >= E) {
          S = T + 1;
          break;
        }
    }
    if (p === void 0 && S === void 0) return !1;
    const { offsetX: w, offsetY: C } = this._scrollManagerService.getCurrentScrollState() || {};
    return this._commandService.syncExecuteCommand(mn.id, {
      sheetViewStartRow: p,
      sheetViewStartColumn: S,
      offsetX: S === void 0 ? w : 0,
      offsetY: p === void 0 ? C : 0
    });
  }
};
ed = QI([
  jr(1, N(ue)),
  jr(2, W),
  jr(3, fe),
  jr(4, N(Q)),
  jr(5, N(Et)),
  jr(6, k)
], ed);
var JI = Object.getOwnPropertyDescriptor, $I = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? JI(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Uh = (r, e) => (t, n) => e(t, n, r);
let Ol = class extends oe {
  constructor(r, e, t) {
    super(), this._context = r, this._sheetSkeletonManagerService = e, this._renderManagerService = t, this.disposeWithMe(this._context.unit.sheetDisposed$.subscribe((n) => {
      this._sheetSkeletonManagerService.disposeSkeleton(n.getSheetId());
    })), this._sheetSkeletonManagerService.currentSkeleton$.subscribe((n) => {
      this._updateSceneSize(n);
    });
  }
  _updateSceneSize(r) {
    var d;
    if (r == null)
      return;
    const { unitId: e } = this._context, { skeleton: t } = r, n = (d = this._renderManagerService.getRenderById(e)) == null ? void 0 : d.scene;
    if (t == null || n == null)
      return;
    const { rowTotalHeight: i, columnTotalWidth: o, rowHeaderWidthAndMarginLeft: s, columnHeaderHeightAndMarginTop: l } = t;
    this._context.unit.getActiveSheet() && (n == null || n.transformByState({
      width: s + o,
      height: l + i
    }));
  }
};
Ol = $I([
  Uh(1, N(ue)),
  Uh(2, fe)
], Ol);
var ey = Object.getOwnPropertyDescriptor, ty = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ey(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Xh = (r, e) => (t, n) => e(t, n, r);
Yt("sheets-ui.services.auto-height");
function ny(r, e) {
  const t = [], n = [...r];
  let i = e;
  for (; n.length > 0; ) {
    const o = n.shift();
    if (!o)
      break;
    const s = o.endRow - o.startRow + 1;
    if (s > i) {
      t.push({
        ...o,
        startRow: o.startRow,
        endRow: o.startRow + i - 1
      }), n.unshift({
        ...o,
        startRow: o.startRow + i
      });
      break;
    } else
      t.push(o), i -= s;
  }
  return { result: t, lasts: n };
}
const ry = 500;
let Al = class extends oe {
  constructor(e, t, n) {
    super();
    _(this, "_autoHeightTasks", []);
    _(this, "_calculateLoopId", null);
    this._context = e, this._sheetSkeletonManagerService = t, this._commandService = n, this._initMarkDirty();
  }
  _initMarkDirty() {
    this.disposeWithMe(
      this._commandService.onCommandExecuted((e) => {
        if (e.id === lg.id) {
          const t = e.params, { unitId: n, subUnitId: i, ranges: o, id: s } = t;
          if (n !== this._context.unitId)
            return;
          this.startAutoHeightTask({
            ranges: o,
            sheetId: i,
            id: s,
            // 10s timeout
            maxTime: 1e4
          });
        }
        if (e.id === ag.id) {
          const t = e.params, { unitId: n, id: i } = t;
          if (n !== this._context.unitId)
            return;
          this.cancelTask(i);
        }
      })
    );
  }
  _loopTask(e) {
    const t = e.skeleton;
    let n = [], i = [];
    if (e.maxTime && e.maxTime + e.startTime <= Date.now())
      n = e.ranges;
    else {
      const l = ny(e.ranges, ry);
      n = l.result, i = l.lasts;
    }
    const s = t.calculateAutoHeightInRange(n).filter((l) => {
      const { row: a, autoHeight: c } = l;
      return !(!c || t.getRowHeight(a) === c);
    });
    if (i.length && (e.ranges = i, this._autoHeightTasks.unshift(e)), s.length) {
      const l = {
        unitId: this._context.unitId,
        subUnitId: e.sheetId,
        rowsAutoHeightInfo: s
      };
      this._commandService.syncExecuteCommand(er.id, l);
    }
  }
  _calculateLoop(e) {
    for (; this._autoHeightTasks.length && !(e.timeRemaining() <= 0); ) {
      const t = this._autoHeightTasks.shift();
      if (!t) {
        this._calculateLoopId = null;
        return;
      }
      this._loopTask(t);
    }
    this._calculateLoopId = requestIdleCallback((t) => {
      this._calculateLoop(t);
    });
  }
  _initialCalculateLoop() {
    this._calculateLoopId === null && (this._calculateLoopId = requestIdleCallback((e) => {
      this._calculateLoop(e);
    }));
  }
  startAutoHeightTask(e) {
    const t = this._sheetSkeletonManagerService.getSkeleton(e.sheetId);
    if (!t)
      return;
    e.ranges = se.mergeRanges(e.ranges.map((i) => ({
      ...i,
      startColumn: 0,
      endColumn: 0
    })));
    const n = se.subtractMulti(
      e.ranges,
      this._autoHeightTasks.filter((i) => i.sheetId === e.sheetId).map((i) => i.ranges).flat()
    );
    n.length && (this._autoHeightTasks.push({
      ...e,
      startTime: Date.now(),
      skeleton: t,
      ranges: n
    }), this._initialCalculateLoop());
  }
  cancelTask(e) {
    const t = this._autoHeightTasks.findIndex((n) => n.id === e);
    t !== -1 && this._autoHeightTasks.splice(t, 1);
  }
};
Al = ty([
  Xh(1, N(ue)),
  Xh(2, W)
], Al);
function Ep(r) {
  const { popup: e } = r, { extraProps: t } = e, { options: n, defaultValue: i, onChange: o } = t, [s, l] = re(i != null ? i : []);
  return /* @__PURE__ */ b(
    RC,
    {
      options: n,
      value: s,
      onChange: o
    }
  );
}
Ep.componentKey = "sheets.dropdown.cascader";
function Tp(r) {
  const { popup: e } = r, { extraProps: t } = e, { defaultValue: n, onChange: i } = t;
  return /* @__PURE__ */ b(
    cm,
    {
      value: n,
      onChange: i
    }
  );
}
Tp.componentKey = "sheets.dropdown.color";
function Pp(r) {
  const { popup: e } = r, { extraProps: t } = e, { hideFn: n, patternType: i, defaultValue: o, onChange: s, showTime: l } = t, [a, c] = re(o), d = Ct(() => i !== "time" ? fs() : fs("1900-01-01 00:00:00"), []), u = a && a.isValid() ? a : d, h = L(xe), g = async () => {
    if (!u) return;
    await (s == null ? void 0 : s(u)) && n();
  };
  return /* @__PURE__ */ q(
    "div",
    {
      className: "univer-rounded univer-bg-white univer-p-2 univer-shadow-lg dark:!univer-bg-black",
      children: [
        i === "time" ? /* @__PURE__ */ b(
          IC,
          {
            value: u.toDate(),
            onValueChange: (m) => {
              c(fs(m));
            }
          }
        ) : /* @__PURE__ */ b(
          yC,
          {
            value: u.toDate(),
            showTime: l != null ? l : i === "datetime",
            onValueChange: (m) => {
              c(fs(m));
            }
          }
        ),
        /* @__PURE__ */ b(
          "footer",
          {
            className: Te("univer-mt-2 univer-flex univer-justify-end univer-pt-2", qs),
            children: /* @__PURE__ */ b(jt, { size: "small", variant: "primary", onClick: g, disabled: !u || !u.isValid(), children: h.t("dataValidation.alert.ok") })
          }
        )
      ]
    }
  );
}
Pp.componentKey = "sheets.dropdown.date";
function iy(r) {
  return r.filter(Boolean).join(",");
}
function oy(r) {
  return r.split(",").filter(Boolean);
}
function sy(r) {
  const { value: e, onChange: t, multiple: n, options: i, title: o, onEdit: s, filter: l, style: a, location: c, showEdit: d } = r, u = L(xe), h = l == null ? void 0 : l.toLowerCase(), { row: g, col: m, unitId: f, subUnitId: v } = c, p = i.filter((C) => h ? C.label.toLowerCase().includes(h) : !0), S = L(bd), w = Ct(() => S.permissionCheckWithRanges(
    {
      workbookTypes: [K],
      rangeTypes: [ie],
      worksheetTypes: [te]
    },
    [{ startColumn: m, startRow: g, endColumn: m, endRow: g }],
    f,
    v
  ), [S, m, g, f, v]);
  return /* @__PURE__ */ q(
    "div",
    {
      "data-u-comp": "sheets-dropdown-list",
      className: Te("univer-box-border univer-rounded-lg univer-bg-white univer-py-1 univer-text-gray-900 univer-shadow dark:!univer-bg-black dark:!univer-text-white", Li),
      style: a,
      children: [
        /* @__PURE__ */ b("div", { className: "univer-px-3.5 univer-py-1 univer-pt-2 univer-text-xs", children: o }),
        /* @__PURE__ */ b(
          "div",
          {
            className: Te("univer-flex univer-max-h-52 univer-flex-col univer-gap-1 univer-overflow-y-auto univer-px-2 univer-py-1", ra),
            children: p.map((C, I) => {
              const R = e.indexOf(C.value) > -1, y = () => {
                let T;
                R ? T = new Set(e.filter((H) => H !== C.value)) : T = new Set(n ? [...e, C.value] : [C.value]);
                const P = [];
                i.forEach((H) => {
                  T.has(H.value) && P.push(H.value);
                }), t(P);
              }, M = C.label.toLocaleLowerCase().indexOf(h), E = new fn(C.color).isDark();
              return /* @__PURE__ */ q(
                "div",
                {
                  className: "univer-flex univer-cursor-pointer univer-flex-row univer-items-center univer-justify-between univer-rounded-md univer-px-1.5 univer-py-1 hover:univer-bg-gray-50 dark:hover:!univer-bg-gray-700",
                  onClick: y,
                  children: [
                    /* @__PURE__ */ b(
                      "div",
                      {
                        className: Te("univer-inline-flex univer-h-4 univer-w-fit univer-items-center univer-truncate univer-rounded-full univer-px-1.5 univer-text-xs", {
                          "univer-text-gray-900": !E,
                          "univer-text-white": E
                        }),
                        style: { background: C.color },
                        children: h && C.label.toLowerCase().includes(h) ? /* @__PURE__ */ q($o, { children: [
                          /* @__PURE__ */ b("span", { children: C.label.substring(0, M) }),
                          /* @__PURE__ */ b("span", { className: "univer-font-semibold", children: C.label.substring(M, M + h.length) }),
                          /* @__PURE__ */ b("span", { children: C.label.substring(M + h.length) })
                        ] }) : C.label
                      }
                    ),
                    /* @__PURE__ */ b(
                      "div",
                      {
                        className: "univer-ml-3 univer-h-4 univer-w-4 univer-flex-shrink-0 univer-flex-grow-0 univer-text-base univer-text-primary-500",
                        children: R && /* @__PURE__ */ b(Dr, { className: "univer-text-primary-600" })
                      }
                    )
                  ]
                },
                I
              );
            })
          },
          l
        ),
        d && w && /* @__PURE__ */ b("div", { className: Te("univer-box-border univer-px-2 univer-pt-1", qs), children: /* @__PURE__ */ b(
          "a",
          {
            className: "univer-block univer-cursor-pointer univer-rounded univer-px-1.5 univer-py-1 univer-text-xs hover:univer-bg-gray-100 dark:hover:!univer-bg-gray-800",
            onClick: s,
            children: u.t("dataValidation.list.edit")
          }
        ) })
      ]
    }
  );
}
function xp(r) {
  var I, R, y, M;
  const { popup: { extraProps: e } } = r, { location: t, hideFn: n, onChange: i, onEdit: o, options: s, defaultValue: l, multiple: a, showEdit: c } = e, { worksheet: d } = t, [u, h] = re(""), g = L(W), m = L(xe), [f, v] = re(l), p = L(qe), S = L(k), w = hC.useContext(), C = ((R = (I = w.current) == null ? void 0 : I.right) != null ? R : 0) - ((M = (y = w.current) == null ? void 0 : y.left) != null ? M : 0);
  return Ee(() => {
    const E = g.onCommandExecuted((T) => {
      var P, H;
      if (T.id === wo.id) {
        const A = T.params, { unitId: x } = A, V = S.getUnit(x, O.UNIVER_DOC);
        if (!V || !p.isVisible().visible) return;
        const D = Mv.transform.getPlainText((H = (P = V.getSnapshot().body) == null ? void 0 : P.dataStream) != null ? H : "");
        h(D);
      }
    });
    return () => {
      E.dispose();
    };
  }, [g, p, S]), d ? /* @__PURE__ */ b(
    sy,
    {
      style: { minWidth: C, maxWidth: Math.max(C, 200) },
      title: a ? m.t("dataValidation.listMultiple.dropdown") : m.t("dataValidation.list.dropdown"),
      value: oy(f != null ? f : ""),
      multiple: a,
      onChange: async (E) => {
        const T = iy(E);
        v(T), await (i == null ? void 0 : i(E)) !== !1 && n();
      },
      options: s,
      onEdit: o,
      filter: u,
      location: t,
      showEdit: c
    }
  ) : null;
}
xp.componentKey = "sheets.dropdown.list";
const zh = {
  datepicker: Pp,
  list: xp,
  color: Tp,
  cascader: Ep
};
var ly = Object.getOwnPropertyDescriptor, ay = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? ly(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Es = (r, e) => (t, n) => e(t, n, r);
const Op = Yt("ICellDropdownManagerService");
let Hl = class extends oe {
  constructor(r, e, t, n) {
    super(), this._canvasPopupManagerService = r, this._zenZoneService = e, this._renderManagerService = t, this._componentManager = n, Object.values(zh).forEach((i) => {
      this.disposeWithMe(this._componentManager.register(i.componentKey, i));
    });
  }
  showDropdown(r) {
    const { location: e, onHide: t, closeOnOutSide: n = !0 } = r, { row: i, col: o, unitId: s, subUnitId: l } = e;
    if (this._zenZoneService.visible)
      throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown when zen mode is visible");
    const a = zh[r.type], c = this._renderManagerService.getRenderById(Ae), d = new ht(), u = this._canvasPopupManagerService.attachPopupToCell(
      i,
      o,
      {
        componentKey: a.componentKey,
        onClickOutside: () => {
          n && d.dispose();
        },
        offset: [0, 3],
        excludeOutside: [c == null ? void 0 : c.engine.getCanvasElement()].filter(Boolean),
        extraProps: {
          ...r,
          ...r.props,
          hideFn: () => {
            d.dispose();
          }
        }
      },
      s,
      l
    );
    if (!u)
      throw new Error("[SheetCellDropdownManagerService]: cannot show dropdown");
    return d.add(u), d.add({
      dispose: () => {
        t == null || t();
      }
    }), d;
  }
};
Hl = ay([
  Es(0, N(yi)),
  Es(1, em),
  Es(2, fe),
  Es(3, N(kt))
], Hl);
const cy = Nn("PRINTING_RANGE"), dy = Nn("PRINTING_COMPONENT_COLLECT"), uy = Nn("PRINTING_DOM_COLLECT");
class Ap extends oe {
  constructor() {
    super();
    _(this, "_printComponentMap", /* @__PURE__ */ new Map());
    _(this, "interceptor", new ki({
      PRINTING_RANGE: cy,
      PRINTING_COMPONENT_COLLECT: dy,
      PRINTING_DOM_COLLECT: uy
    }));
    this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_RANGE, {
      priority: -1,
      handler: (t) => t
    })), this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_COMPONENT_COLLECT, {
      priority: -1,
      handler: (t) => t
    })), this.disposeWithMe(this.interceptor.intercept(this.interceptor.getInterceptPoints().PRINTING_DOM_COLLECT, {
      priority: -1,
      handler: (t) => t
    }));
  }
  registerPrintComponent(t, n) {
    this._printComponentMap.set(t, n);
  }
  getPrintComponent(t) {
    return this._printComponentMap.get(t);
  }
}
class hy extends Wd {
  constructor(t, n, i, o) {
    super(t, n, i, o);
    /**
     * topLeft controlPointer, it is not visible, just transparent, for handling event.
     */
    _(this, "_fillControlTopLeft");
    /**
     * bottomRight controlPointer, it is not visible, just transparent, for handling event.
     */
    _(this, "_fillControlBottomRight");
    _(this, "_rangeType", z.NORMAL);
    this._scene = t, this._zIndex = n, this._themeService = i, this._rangeType = (o == null ? void 0 : o.rangeType) || z.NORMAL, this.initControlPoints();
  }
  initControlPoints() {
    const t = this.currentStyle, n = t.expandCornerSize || 0, i = (t.expandCornerSize || 0) / 4, o = t.autofillStrokeWidth || 0, s = t.stroke, l = t.autofillStroke, a = this.zIndex;
    this._fillControlTopLeft = new Se(Fc.fillTopLeft + a, {
      zIndex: a + 2,
      width: n,
      height: n,
      radius: n / 2,
      visualWidth: i,
      visualHeight: i,
      strokeWidth: o
    }), this._fillControlBottomRight = new Se(Fc.fillBottomRight + a, {
      zIndex: a + 2,
      width: n,
      height: n,
      radius: n / 2,
      visualHeight: i,
      visualWidth: i,
      strokeWidth: o
    });
    const c = {
      fill: s,
      stroke: l,
      strokeScaleEnabled: !1
    };
    this._fillControlTopLeft.setProps({ ...c }), this._fillControlBottomRight.setProps({ ...c });
    const d = [
      this._fillControlTopLeft,
      this._fillControlBottomRight
    ];
    switch (this._rangeType) {
      case z.ROW:
        this.rowHeaderGroup.addObjects(...d);
        break;
      case z.COLUMN:
        this.columnHeaderGroup.addObjects(...d);
        break;
      case z.NORMAL:
        this.selectionShapeGroup.addObjects(...d);
    }
    this.getScene().addObjects(d, Qs);
  }
  get fillControlTopLeft() {
    return this._fillControlTopLeft;
  }
  set fillControlTopLeft(t) {
    this._fillControlTopLeft = t;
  }
  get fillControlBottomRight() {
    return this._fillControlBottomRight;
  }
  set fillControlBottomRight(t) {
    this._fillControlBottomRight = t;
  }
  get rangeType() {
    return this._rangeType;
  }
  set rangeType(t) {
    this._rangeType = t;
  }
  dispose() {
    var t, n;
    (t = this._fillControlBottomRight) == null || t.dispose(), (n = this._fillControlTopLeft) == null || n.dispose(), super.dispose();
  }
  _updateLayoutOfSelectionControl(t) {
    var o, s;
    super._updateLayoutOfSelectionControl(t);
    const n = this.currentStyle;
    t == null && (t = n);
    const {
      widgets: i = n.widgets
    } = t;
    if (this.currentStyle = t, this._enableAutoFill === !0 && !super._hasWidgets(i)) {
      const { viewportScrollX: l, viewportScrollY: a } = this.getViewportMainScrollInfo(), { endX: c, endY: d } = this.selectionModel;
      this.transformControlPoint(l, a, c, d), this.fillControlTopLeft.show(), this.fillControlBottomRight.show();
    } else
      (o = this.fillControlTopLeft) == null || o.hide(), (s = this.fillControlBottomRight) == null || s.hide();
  }
  getViewportMainScrollInfo() {
    const t = this.getScene().getViewport(F.VIEW_MAIN);
    return {
      viewportScrollX: (t == null ? void 0 : t.viewportScrollX) || 0,
      viewportScrollY: (t == null ? void 0 : t.viewportScrollY) || 0,
      width: (t == null ? void 0 : t.width) || 0,
      height: (t == null ? void 0 : t.height) || 0
    };
  }
  /**
   * Mainly for row & col selection control point position. update control point position by when scrolling.
   * @param viewportScrollX viewportScrollX
   * @param viewportScrollY
   * @param sheetContentWidth
   * @param sheetContentHeight max sheet content height, for very short sheet, control pointer shoud not out of sheet
   */
  transformControlPoint(t = 0, n = 0, i = 0, o = 0) {
    const s = this.currentStyle, l = this.selectionModel.rangeType, a = s.expandCornerSize, { startX: c, startY: d, endX: u, endY: h } = this.selectionModel, g = this.getViewportMainScrollInfo(), m = g.width, f = g.height;
    switch (l) {
      case z.NORMAL:
        this.fillControlTopLeft.transformByState({
          left: -a / 2,
          top: -a / 2
        }), this.fillControlBottomRight.transformByState({
          left: u - c - a / 2,
          top: h - d - a / 2
        });
        break;
      case z.ROW:
        {
          const v = Math.min(m / 2 + t, i), p = -a / 2 + v;
          this.fillControlTopLeft.transformByState({
            left: p,
            top: -a / 2
          }), this.fillControlBottomRight.transformByState({
            left: p,
            top: -a / 2 + h - d
          });
        }
        break;
      case z.COLUMN:
        {
          const v = Math.min(+f / 2 + n, o), p = -a / 2 + v;
          this.fillControlTopLeft.transformByState({
            left: -a / 2,
            top: p
          }), this.fillControlBottomRight.transformByState({
            left: -a / 2 + u - c,
            top: p
          });
        }
        break;
      default:
        console.error("unknown range type");
    }
  }
}
var gy = Object.getOwnPropertyDescriptor, my = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? gy(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, Rn = (r, e) => (t, n) => e(t, n, r);
let td = class extends mm {
  constructor(e, t, n, i, o, s, l, a, c, d) {
    super(
      t,
      n,
      i,
      s,
      c
    );
    _(this, "_workbookSelections");
    _(this, "_renderDisposable", null);
    _(this, "_expandingSelection", !1);
    _(this, "_selectionControls", []);
    // sheetID:Controls
    _(this, "expandingControlMode", "bottom-right");
    this._context = e, this._logService = l, this._commandService = a, this._contextService = c, this._scrollManagerService = d, this._workbookSelections = o.getWorkbookSelections(this._context.unitId), this._init();
  }
  _init() {
    const e = this._getSheetObject();
    this._initEventListeners(e), this._initSelectionChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener(), this._updateControlPointWhenScrolling();
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      if (e == null) {
        this._logService.error("[SelectionRenderService]: should not receive null!");
        return;
      }
      const t = this._context.unitId, { sheetId: n, skeleton: i } = e, { scene: o } = this._context, s = o.getViewport(F.VIEW_MAIN);
      this._changeRuntime(i, o, s), this._workbookSelections.getCurrentLastSelection() || this._commandService.syncExecuteCommand(Ie.id, {
        unitId: t,
        subUnitId: n,
        selections: [Bd(i)]
      });
    }));
  }
  _initSelectionChangeListener() {
  }
  _initEventListeners(e) {
    const { spreadsheetRowHeader: t, spreadsheetColumnHeader: n, spreadsheet: i, spreadsheetLeftTopPlaceholder: o } = e, { scene: s } = this._context;
    this._initSpreadsheetEvent(e), this.disposeWithMe(
      t == null ? void 0 : t.onPointerUp$.subscribeEvent((l, a) => {
        if (this._normalSelectionDisabled()) return;
        const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { row: d } = Vn(l.offsetX, l.offsetY, s, c);
        Tf(this._workbookSelections.getCurrentSelections(), d) || (this.createNewSelection(l, (i.zIndex || 1) + 1, z.ROW, this._getActiveViewport(l)), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()));
      })
    ), this.disposeWithMe(
      n == null ? void 0 : n.onPointerUp$.subscribeEvent((l, a) => {
        if (this._normalSelectionDisabled()) return;
        const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { column: d } = Vn(l.offsetX, l.offsetY, s, c);
        Pf(this._workbookSelections.getCurrentSelections(), d) || (this.createNewSelection(l, (i.zIndex || 1) + 1, z.COLUMN, this._getActiveViewport(l)), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()));
      })
    ), this.disposeWithMe(o == null ? void 0 : o.onPointerUp$.subscribeEvent((l, a) => {
      if (this._normalSelectionDisabled()) return;
      this._reset();
      const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, d = fm(c);
      this._addSelectionControlByModelData(d), this.refreshSelectionMoveStart(), a.stopPropagation(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
    }));
  }
  _initSpreadsheetEvent(e) {
    const { spreadsheet: t } = e;
    let n;
    const i = 500, o = { x: 0, y: 0 }, s = () => {
      clearTimeout(n);
    }, l = (d, u) => {
      this.createNewSelection(
        d,
        t.zIndex + 1,
        z.NORMAL,
        this._getActiveViewport(d)
      ), u && this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());
    };
    t == null || t.onPointerMove$.subscribeEvent((d, u) => {
      (Math.abs(d.offsetX - o.x) > 10 || Math.abs(d.offsetY - o.y) > 10) && s();
    });
    const a = t == null ? void 0 : t.onPointerDown$.subscribeEvent((d, u) => {
      o.x = d.offsetX, o.y = d.offsetY, n = setTimeout(() => {
        l(d, !0);
      }, i), u.stopPropagation();
    }), c = t == null ? void 0 : t.onPointerUp$.subscribeEvent((d, u) => {
      if (this._normalSelectionDisabled()) return;
      clearTimeout(n);
      const h = 10;
      Math.abs(d.offsetX - o.x) > h || Math.abs(d.offsetY - o.y) > h || (l(d, !1), u.stopPropagation());
    });
    this.disposeWithMe(We(a)), this.disposeWithMe(We(c));
  }
  _initUserActionSyncListener() {
    this.disposeWithMe(this.selectionMoveStart$.subscribe((e) => this._updateSelections(e, At.MOVE_START))), this.disposeWithMe(this.selectionMoving$.subscribe((e) => this._updateSelections(e, At.MOVING))), this.disposeWithMe(this._contextService.subscribeContextValue$(vo).pipe(xt(!1), dn()).subscribe((e) => {
      var t;
      e ? ((t = this._renderDisposable) == null || t.dispose(), this._renderDisposable = null, this._reset()) : this._renderDisposable = We(
        this.selectionMoveEnd$.subscribe((n) => this._updateSelections(n, At.MOVE_END))
      );
    }));
  }
  _updateSelections(e, t) {
    const n = this._context.unit, i = n.getUnitId(), o = n.getActiveSheet().getSheetId();
    e.length !== 0 && this._commandService.executeCommand(Ie.id, {
      unitId: i,
      subUnitId: o,
      type: t,
      selections: e.map(
        (s) => Zg(s)
      )
    });
  }
  /**
   * invoked when pointerup or long press on spreadsheet, or pointerdown on row&col
   * then move curr selection to cell at cursor
   * Main purpose to create a new selection, or update curr selection to a new range.
   * @param evt
   * @param _zIndex
   * @param rangeType
   * @param viewport
   */
  createNewSelection(e, t = 0, n = z.NORMAL, i) {
    this._rangeType = n;
    const o = this._skeleton, s = this._scene;
    if (!s || !o)
      return;
    i && (this._activeViewport = i);
    const { offsetX: l, offsetY: a } = e, c = s.getCoordRelativeToViewport(ke.FromArray([l, a])), { x: d, y: u } = c;
    this._startViewportPosX = d, this._startViewportPosY = u;
    const h = s.getScrollXYInfoByViewport(c), { scaleX: g, scaleY: m } = s.getAncestorScale(), f = this._skeleton.getCellByOffset(d, u, g, m, h);
    if (!f) return;
    switch (n) {
      case z.NORMAL:
        break;
      case z.ROW:
        f.startColumn = 0, f.endColumn = this._skeleton.getColumnCount() - 1;
        break;
      case z.COLUMN:
        f.startRow = 0, f.endRow = this._skeleton.getRowCount() - 1;
        break;
      case z.ALL:
        f.startRow = 0, f.startColumn = 0, f.endRow = this._skeleton.getRowCount() - 1, f.endColumn = this._skeleton.getColumnCount() - 1;
    }
    const v = { range: f, primary: f, style: null };
    v.range.rangeType = n;
    const p = Wt(v, this._skeleton);
    this._startRangeWhenPointerDown = { ...p.rangeWithCoord };
    let S = this.getActiveSelectionControl();
    const w = { ...p.rangeWithCoord };
    for (const C of this.getSelectionControls())
      if (C.model.isEqual(w)) {
        S = C;
        break;
      }
    (S == null ? void 0 : S.model.rangeType) !== n ? (this._clearAllSelectionControls(), S = this.newSelectionControl(s, o, v)) : S.updateRangeBySelectionWithCoord(p), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._clearUpdatingListeners(), this._expandingSelection = !1;
  }
  /**
   * Not same as PC version,
   * new selection control for mobile do one more thing: bind event for two control points.
   * @param scene
   * @param rangeType
   */
  newSelectionControl(e, t, n) {
    const i = this.getSelectionControls(), { rowHeaderWidth: o, columnHeaderHeight: s } = t, l = n.range.rangeType, a = new hy(e, i.length, this._themeService, {
      highlightHeader: this._highlightHeader,
      rowHeaderWidth: o,
      columnHeaderHeight: s,
      rangeType: l
    }), c = Wt(n, t);
    a.updateRangeBySelectionWithCoord(c), this._selectionControls.push(a);
    const { expandingModeForTopLeft: d, expandingModeForBottomRight: u } = (() => {
      switch (l) {
        case z.NORMAL:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
        case z.ROW:
          return {
            expandingModeForTopLeft: "top",
            expandingModeForBottomRight: "bottom"
            /* BOTTOM */
          };
        case z.COLUMN:
          return {
            expandingModeForTopLeft: "left",
            expandingModeForBottomRight: "right"
            /* RIGHT */
          };
        case z.ALL:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
        default:
          return {
            expandingModeForTopLeft: "top-left",
            expandingModeForBottomRight: "bottom-right"
            /* BOTTOM_RIGHT */
          };
      }
    })();
    return a.fillControlTopLeft.onPointerDown$.subscribeEvent((h) => {
      this._expandingSelection = !0, this.expandingControlMode = d, this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._fillControlPointerDownHandler(
        h,
        l,
        this._activeViewport
      );
    }), a.fillControlBottomRight.onPointerDown$.subscribeEvent((h) => {
      this._expandingSelection = !0, this.expandingControlMode = u, this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._fillControlPointerDownHandler(
        h,
        l,
        this._activeViewport
      );
    }), (l === z.ROW || l === z.COLUMN) && !e.getViewport(F.VIEW_MAIN), a;
  }
  // same as PC
  _getActiveViewport(e) {
    const t = this._getSheetObject();
    return t == null ? void 0 : t.scene.getActiveViewportByCoord(ke.FromArray([e.offsetX, e.offsetY]));
  }
  // same as PC
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  // same as PC
  _normalSelectionDisabled() {
    return this._contextService.getContextValue(vo);
  }
  getSelectionControls() {
    return this._selectionControls;
  }
  _fillControlPointerDownHandler(e, t = z.NORMAL, n, i = bt.ALL) {
    var u, h, g;
    const o = this._skeleton, s = this._scene;
    if (!s || !o)
      return;
    n && (this._activeViewport = n);
    const l = s.getViewport(F.VIEW_MAIN), a = this.getActiveSelectionControl();
    if (!a) return;
    this._changeCurrCellWhenControlPointerDown(), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._clearUpdatingListeners(), this._addEndingListeners(), this._scrollTimer = ei.create(this._scene, i), this._scrollTimer.startScroll((u = l == null ? void 0 : l.left) != null ? u : 0, (h = l == null ? void 0 : l.top) != null ? h : 0, l), (g = s.getTransformer()) == null || g.clearSelectedObjects();
    const c = s.getCoordRelativeToViewport(ke.FromArray([e.offsetX, e.offsetY]));
    this._setupPointerMoveListener(l, a, t, i, c.x, c.y);
    const d = this._shortcutService.forceEscape();
    this._scenePointerUpSub = s.onPointerUp$.subscribeEvent((m) => {
      this.endSelection(), this._expandingSelection = !1, this.expandingControlMode = "bottom-right", this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), d.dispose();
    });
  }
  _changeCurrCellWhenControlPointerDown() {
    const e = this.getActiveSelectionControl(), t = this._skeleton;
    let n;
    const { startRow: i, startColumn: o, endRow: s, endColumn: l } = e.model;
    switch (this.expandingControlMode) {
      case "top-left":
        n = t.getCellWithCoordByIndex(s, l);
        break;
      case "bottom-right":
        n = t.getCellWithCoordByIndex(i, o);
        break;
      case "left":
        n = t.getCellWithCoordByIndex(i, l), n.isMerged = !1, n.isMergedMainCell = !1;
        break;
      case "right":
        n = t.getCellWithCoordByIndex(i, o), n.isMerged = !1, n.isMergedMainCell = !1;
        break;
      case "top":
        n = t.getCellWithCoordByIndex(s, o), n.isMerged = !1, n.isMergedMainCell = !1;
        break;
      case "bottom":
        n = t.getCellWithCoordByIndex(i, o), n.isMerged = !1, n.isMergedMainCell = !1;
        break;
      default:
        n = t.getCellWithCoordByIndex(i, o);
    }
    return e.updateCurrCell(n), n;
  }
  /**
   * Not same as _moving in PC (base selection render service)
   * The diff is
   * In base version, new selection is determined by the cursor cell and _startRangeWhenPointerDown
   *
   * In Mobile version, new selection is determined by cursor cell and current of activeSelectionControl.model
   */
  _movingHandler(e, t, n, i) {
    var M, E, T, P, H, A, x, V, D, X, B, j, G;
    this._rangeType = i;
    const o = this._skeleton, s = this._scene, l = {
      startRow: n.model.startRow,
      endRow: n.model.endRow,
      startColumn: n.model.startColumn,
      endColumn: n.model.endColumn
    }, a = s.getViewport(F.VIEW_MAIN), c = (M = this._getViewportByCell(l.endRow, l.endColumn)) != null ? M : a, d = s.getScrollXYInfoByViewport(
      ke.FromArray([this._startViewportPosX, this._startViewportPosY]),
      c
    ), { scaleX: u, scaleY: h } = s.getAncestorScale();
    i === z.ROW ? e = Number.POSITIVE_INFINITY : i === z.COLUMN && (t = Number.POSITIVE_INFINITY);
    const g = this._getSelectionWithCoordByOffset(e, t, u, h, d);
    if (!g)
      return !1;
    const { rangeWithCoord: m } = g, f = n.model.currentCell, v = (E = f == null ? void 0 : f.mergeInfo.startRow) != null ? E : -1, p = (T = f == null ? void 0 : f.mergeInfo.endRow) != null ? T : -1, S = (P = f == null ? void 0 : f.mergeInfo.startColumn) != null ? P : -1, w = (H = f == null ? void 0 : f.mergeInfo.endColumn) != null ? H : -1;
    let C = {
      startRow: Math.min(m.startRow, v),
      startColumn: Math.min(m.startColumn, S),
      endRow: Math.max(m.endRow, p),
      endColumn: Math.max(m.endColumn, w)
    };
    if (i === z.NORMAL ? C = o.expandRangeByMerge(C) : i === z.COLUMN ? C = {
      startRow: Math.min(m.startRow, (A = f == null ? void 0 : f.actualRow) != null ? A : -1),
      startColumn: Math.min(m.startColumn, (x = f == null ? void 0 : f.actualColumn) != null ? x : -1),
      endRow: Math.max(m.endRow, (V = f == null ? void 0 : f.actualRow) != null ? V : -1),
      endColumn: Math.max(m.endColumn, (D = f == null ? void 0 : f.actualColumn) != null ? D : -1)
    } : i === z.ROW && (C = {
      startRow: Math.min(m.startRow, (X = f == null ? void 0 : f.actualRow) != null ? X : -1),
      startColumn: Math.min(m.startColumn, (B = f == null ? void 0 : f.actualColumn) != null ? B : -1),
      endRow: Math.max(m.endRow, (j = f == null ? void 0 : f.actualRow) != null ? j : -1),
      endColumn: Math.max(m.endColumn, (G = f == null ? void 0 : f.actualColumn) != null ? G : -1)
    }), !C)
      return !1;
    const R = Wt({ range: C, style: null, primary: null }, o);
    (l.startRow !== C.startRow || l.startColumn !== C.startColumn || l.endRow !== C.endRow || l.endColumn !== C.endColumn) && n && (n.updateRangeBySelectionWithCoord(R), this._selectionMoving$.next(this.getSelectionDataWithStyle()));
  }
  _updateControlPointWhenScrolling() {
    const { scene: e } = this._context;
    if (!e.getViewport(F.VIEW_MAIN)) return;
    const n = this._scrollManagerService.validViewportScrollInfo$.subscribe((i) => {
      var h;
      if (i == null)
        return;
      const { viewportScrollX: o, viewportScrollY: s } = i, l = this.getActiveSelectionControl();
      if (l == null)
        return;
      const a = (h = this._sheetSkeletonManagerService.getCurrentParam()) == null ? void 0 : h.skeleton, c = a == null ? void 0 : a.rowTotalHeight, d = a == null ? void 0 : a.columnTotalWidth, u = l.rangeType;
      u === z.COLUMN ? l.transformControlPoint(0, s, d, c) : u === z.ROW && l.transformControlPoint(o, 0, d, c);
    });
    this.disposeWithMe(We(n));
  }
};
td = my([
  Rn(1, N(Rt)),
  Rn(2, N(Ht)),
  Rn(3, ta),
  Rn(4, N(Q)),
  Rn(5, N(ue)),
  Rn(6, Wl),
  Rn(7, W),
  Rn(8, De),
  Rn(9, N(Et))
], td);
var fy = Object.defineProperty, py = Object.getOwnPropertyDescriptor, vy = (r, e, t) => e in r ? fy(r, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : r[e] = t, Sy = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? py(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, no = (r, e) => (t, n) => e(t, n, r), Hp = (r, e, t) => vy(r, typeof e != "symbol" ? e + "" : e, t);
let Vl = class extends ig {
  /** @ignore */
  constructor(r = dl, e, t, n, i, o) {
    super(), this._config = r, this._injector = e, this._renderManagerService = t, this._configService = n, this._univerInstanceService = i, this._componentManager = o;
    const { menu: s, ...l } = og(
      {},
      dl,
      this._config
    );
    if (l.protectedRangeUserSelector) {
      const { component: a, framework: c } = l.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(
          ga,
          a,
          {
            framework: c
          }
        )
      );
    }
    s && this._configService.setConfig("menu", s, { merge: !0 }), this._configService.setConfig(Tt, { ...l });
  }
  onStarting() {
    Bs(this._injector, sg([
      [Si],
      [qe, { useClass: ll }],
      [nn, { useClass: rl }],
      [Nr, { useClass: Vm }],
      [Dn, { useClass: sl }],
      [ls, { useClass: Bm }],
      [as, { useClass: tf }],
      [_d, { useClass: qg }],
      [Hr, { useClass: el }],
      [Ap],
      [xa, { useClass: nf }],
      [Wi, { useClass: tl }],
      [Mr],
      [Oo],
      [yi],
      [Mi],
      [Do],
      [Kd],
      [Op, { useClass: Hl }],
      [Ao],
      // controllers
      [Ei],
      [hi],
      [Ir],
      [yr],
      [ir],
      [bl],
      [Er],
      [bi],
      [Oi],
      [Pi],
      [xi],
      [Ti],
      [Ri],
      // permission
      [Rr],
      [Ai],
      [Vr],
      [Hi],
      [Ii],
      [Vi]
    ], this._config.override));
  }
  onReady() {
    this._config.disableAutoFocus || this._initAutoFocus(), Bs(this._injector, [
      [Tr]
    ]), this._registerRenderBasics(), $r(this._injector, [
      [bl],
      [ir],
      [Ei],
      [Ii],
      [Ai]
    ]);
  }
  onRendered() {
    this._registerRenderModules(), $r(this._injector, [
      [Vi],
      [Rr],
      [Tr],
      [yr],
      [Pi],
      [Er],
      [hi],
      [Ir],
      [xi],
      [Ti],
      [Ri]
    ]);
  }
  onSteady() {
    $r(this._injector, [
      [Oi],
      [bi],
      [Hi]
    ]);
  }
  _registerRenderBasics() {
    [
      [ue],
      [Ol],
      [fl],
      [gt, { useClass: td }],
      [Et],
      [Al]
    ].forEach((r) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(O.UNIVER_SHEET, r));
    });
  }
  // We have to let render basics get bootstrapped before. Because some render controllers relies on
  // a correct skeleton when they get loaded.
  _registerRenderModules() {
    var n;
    const r = [
      [No],
      [xl],
      [ko],
      // TODO: Should not register these two Controllers at the same time
      [Ci],
      [ed],
      [Vo],
      [Po],
      [Tl],
      [El],
      [vl],
      [Sl],
      [wl],
      [hl],
      [cl],
      [Cl],
      [al],
      // [SheetContextMenuMobileRenderController],
      [_l],
      // editor
      [Ho],
      // permission
      [Rl],
      [Il],
      [yl],
      [Ml]
    ], e = this._configService.getConfig(ea);
    ((n = e == null ? void 0 : e.contextMenu) != null ? n : !0) && r.push([Pl]), r.forEach((i) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(O.UNIVER_SHEET, i));
    });
  }
  _initAutoFocus() {
    const r = this._univerInstanceService;
    this.disposeWithMe(r.getCurrentTypeOfUnit$(O.UNIVER_SHEET).pipe(um((e) => !!e)).subscribe((e) => r.focusUnit(e.getUnitId())));
  }
};
Hp(Vl, "pluginName", "SHEET_UI_PLUGIN");
Hp(Vl, "type", O.UNIVER_SHEET);
Vl = Sy([
  rg(Gg, gC),
  no(1, N(Rt)),
  no(2, fe),
  no(3, Vt),
  no(4, k),
  no(5, N(kt))
], Vl);
var Cy = Object.getOwnPropertyDescriptor, wy = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Cy(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, wc = (r, e) => (t, n) => e(t, n, r);
let nd = class extends oe {
  constructor(r, e, t, n) {
    super(), this._context = r, this._contextMenuService = e, this._selectionManagerService = t, this._selectionRenderService = n, this._init();
  }
  _init() {
    var l, a;
    const e = ((a = (l = this._context) == null ? void 0 : l.mainComponent) == null ? void 0 : a.onPointerDown$).subscribeEvent((c) => {
      if (c.button === 2) {
        const d = this._selectionManagerService.getCurrentSelections(), u = d == null ? void 0 : d[0];
        if (!u)
          return;
        const h = u.range.rangeType, g = this._selectionRenderService.getSkeleton(), f = Wt(u, g).rangeWithCoord, v = () => {
          if (!f)
            return !1;
          const S = c.offsetX, w = c.offsetY;
          switch (h) {
            case z.ROW:
              return f.startY <= w && f.endY >= w;
            case z.COLUMN:
              return f.startX <= S && f.endX >= S;
            default:
              return f.startX <= S && f.endX >= S && f.startY <= w && f.endY >= w;
          }
        }, p = (S) => {
          this._contextMenuService.triggerContextMenu(c, S);
        };
        v() ? h === z.COLUMN ? p(_t.COL_HEADER) : h === z.ROW ? p(_t.ROW_HEADER) : p(_t.MAIN_AREA) : p(_t.MAIN_AREA);
      }
    });
    this.disposeWithMe(e);
    const t = this._context.components.get(Ye.COLUMN), i = this._context.components.get(Ye.ROW).onPointerDown$.subscribeEvent((c) => {
      c.button === 2 && this._contextMenuService.triggerContextMenu(c, _t.ROW_HEADER);
    });
    this.disposeWithMe(i);
    const s = t.onPointerDown$.subscribeEvent((c) => {
      c.button === 2 && this._contextMenuService.triggerContextMenu(c, _t.COL_HEADER);
    });
    this.disposeWithMe(s);
  }
};
nd = wy([
  wc(1, Pd),
  wc(2, N(Q)),
  wc(3, gt)
], nd);
var by = Object.getOwnPropertyDescriptor, _y = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? by(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, jh = (r, e) => (t, n) => e(t, n, r);
function Ry(r) {
  return typeof r.setShadowStrategy == "function";
}
let rd = class extends oe {
  constructor(e, t) {
    super();
    _(this, "_currentStrategy");
    _(this, "_strategySubject");
    this._configService = e, this._renderManagerService = t;
    const n = this._configService.getConfig(Tt);
    this._currentStrategy = tu(n == null ? void 0 : n.protectedRangeShadow), this._strategySubject = new Me(this._currentStrategy), this.disposeWithMe({
      dispose: () => {
        this._strategySubject.complete();
      }
    });
  }
  _updateAllWorkbooks(e) {
    this._renderManagerService.getRenderAll().forEach((n) => {
      const i = n.mainComponent;
      if (!i)
        return;
      const o = [
        { key: gu },
        { key: mu },
        { key: fu }
      ];
      let s = !1;
      for (const { key: l } of o) {
        const a = i.getExtensionByKey(l);
        a && Ry(a) && (a.setShadowStrategy(e), s = !0);
      }
      s && i.makeDirty(!0);
    });
  }
  setProtectedRangeShadowStrategy(e) {
    this._currentStrategy = e, this._strategySubject.next(e), this._updateAllWorkbooks(e);
  }
  getProtectedRangeShadowStrategy() {
    return this._currentStrategy;
  }
  getProtectedRangeShadowStrategy$() {
    return this._strategySubject.asObservable();
  }
  dispose() {
    super.dispose(), this._strategySubject.complete();
  }
};
rd = _y([
  jh(0, Vt),
  jh(1, fe)
], rd);
var Iy = Object.getOwnPropertyDescriptor, yy = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Iy(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, jn = (r, e) => (t, n) => e(t, n, r);
let id = class extends mm {
  constructor(e, t, n, i, o, s, l, a, c) {
    super(
      t,
      n,
      i,
      s,
      c
    );
    _(this, "_workbookSelections");
    _(this, "_renderDisposable", null);
    this._context = e, this._logService = l, this._commandService = a, this._contextService = c, this._workbookSelections = o.getWorkbookSelections(this._context.unitId), this._init();
  }
  _init() {
    const e = this._getSheetObject();
    this._contextService.setContextValue(Zr, !0), this._initEventListeners(e), this._initSelectionModelChangeListener(), this._initThemeChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener();
  }
  dispose() {
    var e;
    super.dispose(), (e = this._renderDisposable) == null || e.dispose();
  }
  _initEventListeners(e) {
    const { spreadsheetRowHeader: t, spreadsheetColumnHeader: n, spreadsheet: i, spreadsheetLeftTopPlaceholder: o } = e, { scene: s } = this._context;
    this.disposeWithMe(i == null ? void 0 : i.onPointerDown$.subscribeEvent((l, a) => {
      this.isSelectionDisabled() || this.inRefSelectionMode() || (this._onPointerDown(l, i.zIndex + 1, z.NORMAL, this._getActiveViewport(l)), l.button !== 2 && a.stopPropagation());
    })), this.disposeWithMe(
      t == null ? void 0 : t.onPointerDown$.subscribeEvent((l, a) => {
        if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
        const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { row: d } = Vn(l.offsetX, l.offsetY, s, c);
        Tf(this._workbookSelections.getCurrentSelections(), d) || (this._onPointerDown(l, (i.zIndex || 1) + 1, z.ROW, this._getActiveViewport(l), bt.Y), l.button !== 2 && a.stopPropagation());
      })
    ), this.disposeWithMe(n == null ? void 0 : n.onPointerDown$.subscribeEvent((l, a) => {
      if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
      const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, { column: d } = Vn(l.offsetX, l.offsetY, s, c);
      Pf(this._workbookSelections.getCurrentSelections(), d) || (this._onPointerDown(l, (i.zIndex || 1) + 1, z.COLUMN, this._getActiveViewport(l), bt.X), l.button !== 2 && a.stopPropagation());
    })), this.disposeWithMe(o == null ? void 0 : o.onPointerDown$.subscribeEvent((l, a) => {
      if (this.isSelectionDisabled() || this.inRefSelectionMode()) return;
      this._reset();
      const c = this._sheetSkeletonManagerService.getCurrentParam().skeleton, d = fm(c);
      this._addSelectionControlByModelData(d), this.refreshSelectionMoveEnd(), l.button !== 2 && a.stopPropagation();
    }));
  }
  _initThemeChangeListener() {
    this.disposeWithMe(this._themeService.currentTheme$.subscribe(() => {
      this._initSelectionThemeFromThemeService();
      const e = this._workbookSelections.getCurrentSelections();
      e && this.resetSelectionsByModelData(e);
    }));
  }
  /**
   * Response for selection model changing.
   */
  _initSelectionModelChangeListener() {
    this.disposeWithMe(St(
      this._workbookSelections.selectionMoveEnd$,
      // triggered by keyboard(e.g. arrow key tab enter)
      this._workbookSelections.selectionSet$
      // shift + arrow key
    ).subscribe((e) => {
      this.resetSelectionsByModelData(e);
    }));
  }
  disableSelection() {
    this._contextService.setContextValue(Zr, !1);
  }
  enableSelection() {
    this._contextService.setContextValue(Zr, !0);
  }
  transparentSelection() {
    const e = this._themeService.getCurrentTheme(), t = Ev(e, "primary.600", "transparent");
    this.setSelectionTheme(t);
    const n = this._workbookSelections.getCurrentSelections();
    for (let i = 0; i < n.length; i++) {
      const o = n[i];
      o.style = Sr(this._selectionTheme);
    }
    this.resetSelectionsByModelData(n);
  }
  showSelection() {
    const e = this._themeService.getCurrentTheme();
    this.setSelectionTheme(e);
    const t = this._workbookSelections.getCurrentSelections();
    for (let n = 0; n < t.length; n++) {
      const i = t[n];
      i.style && (i.style = Sr(this._selectionTheme));
    }
    this.resetSelectionsByModelData(t);
  }
  /**
   * Handle events in spreadsheet. (e.g. drag and move to make a selection)
   */
  _initUserActionSyncListener() {
    this.disposeWithMe(this.selectionMoveStart$.subscribe((e) => this._updateSelections(e, At.MOVE_START))), this.disposeWithMe(this.selectionMoving$.subscribe((e) => this._updateSelections(e, At.MOVING))), this.disposeWithMe(this._contextService.subscribeContextValue$(vo).pipe(xt(!1), dn()).subscribe((e) => {
      e && this._reset();
    })), this.disposeWithMe(this._contextService.subscribeContextValue$(Zr).pipe(xt(!0), dn()).subscribe((e) => {
      var t;
      e ? this._renderDisposable = We(
        this.selectionMoveEnd$.subscribe((n) => {
          this._updateSelections(n, At.MOVE_END);
        })
      ) : ((t = this._renderDisposable) == null || t.dispose(), this._renderDisposable = null, this._reset());
    }));
  }
  /**
   * Update selectionData to selectionDataModel (WorkBookSelections) by SetSelectionsOperation.
   *
   * Unlike baseSelectionRenderService@resetSelectionsByModelData, this method is for update WorkbookSelectionModel.
   *
   *
   * @param selectionDataWithStyleList
   * @param type
   */
  _updateSelections(e, t) {
    const n = this._context.unit, i = n.getUnitId(), o = n.getActiveSheet().getSheetId();
    if (e.length === 0)
      return;
    const s = e.map(
      (l) => Zg(l)
    );
    this._commandService.executeCommand(Ie.id, {
      unitId: i,
      subUnitId: o,
      type: t,
      selections: s
    });
  }
  _initSkeletonChangeListener() {
    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((e) => {
      var c, d;
      if (e == null) {
        this._logService.error("[SelectionRenderService]: should not receive null!");
        return;
      }
      const t = this._context.unitId, { sheetId: n, skeleton: i } = e, { scene: o } = this._context, s = o.getViewport(F.VIEW_MAIN), l = (d = (c = this._skeleton) == null ? void 0 : c.worksheet) == null ? void 0 : d.getSheetId();
      if (this._changeRuntime(i, o, s), l !== i.worksheet.getSheetId()) {
        const u = this._workbookSelections.getCurrentSelections();
        this._commandService.syncExecuteCommand(Ie.id, {
          unitId: t,
          subUnitId: n,
          selections: u.length !== 0 ? u : [Bd(i)]
        });
      }
      const a = this._workbookSelections.getCurrentSelections();
      a != null && this.resetSelectionsByModelData(a);
    }));
  }
  _getActiveViewport(e) {
    const t = this._getSheetObject();
    return t == null ? void 0 : t.scene.getActiveViewportByCoord(ke.FromArray([e.offsetX, e.offsetY]));
  }
  _getSheetObject() {
    return en(this._context.unit, this._context);
  }
  /**
   * Handle pointer down event, bind pointermove & pointerup handler.
   * then trigger selectionMoveStart$.
   *
   * @param evt
   * @param _zIndex
   * @param rangeType
   * @param viewport
   * @param scrollTimerType
   */
  // eslint-disable-next-line complexity, max-lines-per-function
  _onPointerDown(e, t = 0, n = z.NORMAL, i, o = bt.ALL) {
    var T, P;
    this._rangeType = n;
    const s = this._skeleton, l = this._scene;
    if (!l || !s)
      return;
    i && (this._activeViewport = i);
    const { offsetX: a, offsetY: c } = e, d = l.getViewport(F.VIEW_MAIN);
    if (!d) return;
    const u = l.getCoordRelativeToViewport(ke.FromArray([a, c])), { x: h, y: g } = u;
    this._startViewportPosX = h, this._startViewportPosY = g;
    const m = l.getScrollXYInfoByViewport(u), { scaleX: f, scaleY: v } = l.getAncestorScale(), p = this._skeleton.getCellByOffset(h, g, f, v, m);
    if (!p) return;
    switch (n) {
      case z.NORMAL:
        break;
      case z.ROW:
        p.startColumn = 0, p.endColumn = this._skeleton.getColumnCount() - 1, p.startRow = p.actualRow, p.endRow = p.actualRow;
        break;
      case z.COLUMN:
        p.startRow = 0, p.endRow = this._skeleton.getRowCount() - 1, p.startColumn = p.actualColumn, p.endColumn = p.actualColumn;
        break;
      case z.ALL:
        p.startRow = 0, p.startColumn = 0, p.endRow = this._skeleton.getRowCount() - 1, p.endColumn = this._skeleton.getColumnCount() - 1;
    }
    const S = { range: p, primary: p, style: null };
    S.range.rangeType = n;
    const w = Wt(S, this._skeleton);
    this._startRangeWhenPointerDown = { ...w.rangeWithCoord };
    let C = this.getActiveSelectionControl();
    const I = { ...w.rangeWithCoord, rangeType: n }, R = this.getSelectionControls();
    for (const H of R)
      if (e.button === 2 && se.contains(H.model, I)) {
        C = H;
        return;
      }
    this._checkClearPreviousControls(e);
    const y = C == null ? void 0 : C.model.currentCell, M = e.shiftKey && y, E = this._remainLastEnabled && !e.ctrlKey && !e.shiftKey && !this._skipLastEnabled && !this._singleSelectionEnabled;
    M ? this._makeSelectionByTwoCells(
      y,
      I,
      s,
      n,
      C
      // Get updated in this method
    ) : E && C ? C.updateRangeBySelectionWithCoord(w) : C = this.newSelectionControl(l, s, S);
    for (let H = 0; H < this.getSelectionControls().length - 1; H++)
      this.getSelectionControls()[H].clearHighlight();
    l.disableObjectsEvent(), this._clearUpdatingListeners(), this._addEndingListeners(), (T = l.getTransformer()) == null || T.clearSelectedObjects(), this._setupPointerMoveListener(d, C, n, o, h, g), this._escapeShortcutDisposable = this._shortcutService.forceEscape(), this._selectionMoveStart$.next(this.getSelectionDataWithStyle()), this._scenePointerUpSub = l.onPointerUp$.subscribeEvent(() => {
      var H;
      this._clearUpdatingListeners(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle()), (H = this._escapeShortcutDisposable) == null || H.dispose(), this._escapeShortcutDisposable = null;
    }), (P = this._scene.getEngine()) == null || P.setCapture();
  }
};
id = yy([
  jn(1, N(Rt)),
  jn(2, N(Ht)),
  jn(3, ta),
  jn(4, N(Q)),
  jn(5, N(ue)),
  jn(6, Wl),
  jn(7, W),
  jn(8, De)
], id);
var My = Object.defineProperty, Ey = Object.getOwnPropertyDescriptor, Ty = (r, e, t) => e in r ? My(r, e, { enumerable: !0, configurable: !0, writable: !0, value: t }) : r[e] = t, Py = (r, e, t, n) => {
  for (var i = n > 1 ? void 0 : n ? Ey(e, t) : e, o = r.length - 1, s; o >= 0; o--)
    (s = r[o]) && (i = s(i) || i);
  return i;
}, ro = (r, e) => (t, n) => e(t, n, r), Vp = (r, e, t) => Ty(r, typeof e != "symbol" ? e + "" : e, t);
let Nl = class extends ig {
  /** @ignore */
  constructor(r = dl, e, t, n, i, o) {
    super(), this._config = r, this._injector = e, this._renderManagerService = t, this._configService = n, this._univerInstanceService = i, this._componentManager = o;
    const { menu: s, ...l } = og(
      {},
      dl,
      this._config
    );
    if (l.protectedRangeUserSelector) {
      const { component: a, framework: c } = l.protectedRangeUserSelector;
      this.disposeWithMe(
        this._componentManager.register(
          ga,
          a,
          {
            framework: c
          }
        )
      );
    }
    s && this._configService.setConfig("menu", s, { merge: !0 }), this._configService.setConfig(Tt, { ...l });
  }
  onStarting() {
    Bs(this._injector, sg([
      [Si],
      [qe, { useClass: ll }],
      [nn, { useClass: rl }],
      [Nr, { useClass: Vm }],
      [Dn, { useClass: sl }],
      [ls, { useClass: Bm }],
      [as, { useClass: tf }],
      [_d, { useClass: qg }],
      [Hr, { useClass: el }],
      [Ap],
      [xa, { useClass: nf }],
      [Wi, { useClass: tl }],
      [Mr],
      [Oo],
      [yi],
      [Mi],
      [Do],
      [Kd],
      [Op, { useClass: Hl }],
      [Ao],
      // controllers
      [Ei],
      [hi],
      [Ir],
      [yr],
      [ir],
      [pl],
      [Er],
      [bi],
      [Oi],
      [Pi],
      [xi],
      [Ti],
      [Ri],
      // permission
      [Rr],
      [Ai],
      [Vr],
      [rd],
      [Hi],
      [Ii],
      [Vi]
    ], this._config.override));
  }
  onReady() {
    this._config.disableAutoFocus || this._initAutoFocus(), Bs(this._injector, [
      [Tr]
    ]), this._registerRenderBasics(), $r(this._injector, [
      [pl],
      [ir],
      [Ei],
      [Ii],
      [Ai]
    ]);
  }
  onRendered() {
    this._registerRenderModules(), $r(this._injector, [
      [Vi],
      [Rr],
      [Tr],
      [yr],
      [Pi],
      [Er],
      [hi],
      [Ir],
      [xi],
      [Ti],
      [Ri]
    ]);
  }
  onSteady() {
    $r(this._injector, [
      [Oi],
      [bi],
      [Hi]
    ]);
  }
  _registerRenderBasics() {
    [
      [ue],
      [Ol],
      [fl],
      [gt, { useClass: id }],
      [Al]
    ].forEach((r) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(O.UNIVER_SHEET, r));
    });
  }
  // We have to let render basics get bootstrapped before. Because some render controllers relies on
  // a correct skeleton when they get loaded.
  _registerRenderModules() {
    var n;
    const r = [
      [No],
      [xl],
      [ko],
      // Caution: ScrollRenderController should placed before ZoomRenderController.
      [Et],
      [Ci],
      [Vo],
      [Po],
      [Tl],
      [El],
      [vl],
      [Sl],
      [wl],
      [hl],
      [cl],
      [Cl],
      [al],
      [nd],
      [_l],
      // editor
      [Ho],
      // permission
      [Rl],
      [Il],
      [yl],
      [Ml]
    ], e = this._configService.getConfig(ea);
    ((n = e == null ? void 0 : e.contextMenu) != null ? n : !0) && r.push([Pl]), r.forEach((i) => {
      this.disposeWithMe(this._renderManagerService.registerRenderModule(O.UNIVER_SHEET, i));
    });
  }
  _initAutoFocus() {
    const r = this._univerInstanceService;
    this.disposeWithMe(r.getCurrentTypeOfUnit$(O.UNIVER_SHEET).pipe(um((e) => !!e)).subscribe((e) => r.focusUnit(e.getUnitId())));
  }
};
Vp(Nl, "pluginName", "SHEET_UI_PLUGIN");
Vp(Nl, "type", O.UNIVER_SHEET);
Nl = Py([
  rg(Gg),
  ro(1, N(Rt)),
  ro(2, fe),
  ro(3, Vt),
  ro(4, k),
  ro(5, N(kt))
], Nl);
function e2(r, e, t, n) {
  const { from: i, to: o } = t, { column: s, columnOffset: l, row: a, rowOffset: c } = i, { column: d, columnOffset: u, row: h, rowOffset: g } = o, m = n.ensureSkeleton(e);
  if (m == null)
    throw new Error("No current skeleton");
  const f = bo(m, {
    startColumn: s,
    endColumn: s,
    startRow: a,
    endRow: a
  }), v = bo(m, {
    startColumn: d,
    endColumn: d,
    startRow: h,
    endRow: h
  }), { startX: p, startY: S } = f, { startX: w, startY: C } = v, I = Gn(p + l, 1), R = Gn(S + c, 1);
  let y = Gn(w + u - I, 1), M = Gn(C + g - R, 1);
  return f.startX === v.endX && (y = 0), f.startY === v.endY && (M = 0), {
    unitId: r,
    subUnitId: e,
    left: I,
    top: R,
    width: y,
    height: M
  };
}
function t2(r, e, t, n, i, o, s) {
  const { column: l, columnOffset: a, row: c, rowOffset: d } = t, u = s.ensureSkeleton(e);
  if (u == null)
    throw new Error("No current skeleton");
  const h = bo(u, {
    startColumn: l,
    endColumn: l,
    startRow: c,
    endRow: c
  }), { startX: g, startY: m } = h, f = Gn(g + a, 1), v = Gn(m + d, 1), p = o.getCellWithCoordByOffset(f + n, v + i, u);
  if (p == null)
    throw new Error("No end selection cell");
  const S = {
    column: p.actualColumn,
    columnOffset: Gn(f + n - p.startX, 1),
    row: p.actualRow,
    rowOffset: Gn(v + i - p.startY, 1)
  };
  return {
    unitId: r,
    subUnitId: e,
    sheetTransform: {
      from: {
        column: l,
        columnOffset: a,
        row: c,
        rowOffset: d
      },
      to: S
    },
    transform: {
      left: f,
      top: v,
      width: n,
      height: i
    }
  };
}
export {
  DC as AFFECT_LAYOUT_STYLES,
  Le as APPLY_TYPE,
  ii as AddRangeProtectionFromContextMenuCommand,
  fa as AddRangeProtectionFromSheetBarCommand,
  ma as AddRangeProtectionFromToolbarCommand,
  wa as ApplyFormatPainterCommand,
  _o as AutoClearContentCommand,
  gr as AutoFillCommand,
  bi as AutoFillController,
  el as AutoFillService,
  hi as AutoHeightController,
  Ir as AutoWidthController,
  mm as BaseSelectionRenderService,
  Yn as COPY_TYPE,
  Do as CellAlertManagerService,
  po as CellAlertType,
  al as CellCustomRenderController,
  Bm as CellEditorManagerService,
  Mi as CellPopupManagerService,
  Ma as ChangeSheetProtectionFromSheetBarCommand,
  os as ChangeZoomRatioCommand,
  mt as DATA_TYPE,
  ts as DeleteRangeMoveLeftConfirmCommand,
  pi as DeleteRangeMoveUpConfirmCommand,
  si as DeleteRangeProtectionFromContextMenuCommand,
  ya as DeleteWorksheetProtectionFormSheetBarCommand,
  Oo as DragManagerService,
  cl as DragRenderController,
  q0 as EMBEDDING_FORMULA_EDITOR,
  Ld as EMBEDDING_FORMULA_EDITOR_COMPONENT_KEY,
  Ri as EditingRenderController,
  ll as EditorBridgeService,
  Gt as ExpandSelectionCommand,
  zt as FormatPainterStatus,
  s0 as FormulaBar,
  yr as FormulaEditorController,
  Vo as HeaderFreezeRenderController,
  No as HeaderMoveRenderController,
  ko as HeaderResizeRenderController,
  da as HideColConfirmCommand,
  ca as HideRowConfirmCommand,
  Mr as HoverManagerService,
  hl as HoverRenderController,
  Hr as IAutoFillService,
  ls as ICellEditorManagerService,
  qe as IEditorBridgeService,
  Dn as IFormatPainterService,
  as as IFormulaEditorManagerService,
  Wi as IMarkSelectionService,
  Op as ISheetCellDropdownManagerService,
  nn as ISheetClipboardService,
  gt as ISheetSelectionRenderService,
  xa as IStatusBarService,
  vi as InsertRangeMoveDownConfirmCommand,
  ns as InsertRangeMoveRightConfirmCommand,
  Ln as JumpOver,
  tl as MarkSelectionService,
  KR as MobileSheetBar,
  Ut as MoveSelectionCommand,
  Wn as MoveSelectionEnterAndTabCommand,
  Vs as PASTE_SPECIAL_MENU_ID,
  et as PREDEFINED_HOOK_NAME,
  hm as RANGE_SELECTOR_COMPONENT_KEY,
  F0 as RANGE_SELECTOR_SYMBOLS,
  va as RefillCommand,
  Eo as RemoveColConfirmCommand,
  Mo as RemoveRowConfirmCommand,
  Sa as RemoveSheetConfirmCommand,
  Ta as RenameSheetOperation,
  of as RenderSheetContent,
  R0 as RenderSheetFooter,
  I0 as RenderSheetHeader,
  qd as ResetRangeTextColorCommand,
  Zy as ResetScrollCommand,
  gm as SELECTION_SHAPE_DEPTH,
  Qy as SHEET_UI_PLUGIN_NAME,
  Ye as SHEET_VIEW_KEY,
  mn as ScrollCommand,
  Hm as ScrollToCellCommand,
  $d as ScrollToRangeOperation,
  Ra as SelectAllCommand,
  Wd as SelectionControl,
  Wd as SelectionShape,
  xC as SelectionShapeExtension,
  Jd as SetActivateCellEditOperation,
  wi as SetCellEditVisibleArrowOperation,
  tt as SetCellEditVisibleOperation,
  Ea as SetCellEditVisibleWithF2Operation,
  _a as SetColumnFrozenCommand,
  sa as SetColumnHeaderHeightCommand,
  Ca as SetFormatPainterOperation,
  Qd as SetInfiniteFormatPainterCommand,
  rs as SetOnceFormatPainterCommand,
  Bi as SetRangeBoldCommand,
  ha as SetRangeFontFamilyCommand,
  ua as SetRangeFontSizeCommand,
  Fi as SetRangeItalicCommand,
  li as SetRangeProtectionFromContextMenuCommand,
  Xi as SetRangeStrickThroughCommand,
  Mm as SetRangeSubscriptCommand,
  Em as SetRangeSuperscriptCommand,
  Io as SetRangeTextColorCommand,
  Ui as SetRangeUnderlineCommand,
  ba as SetRowFrozenCommand,
  oa as SetRowHeaderWidthCommand,
  gn as SetScrollOperation,
  To as SetScrollRelativeCommand,
  $n as SetSelectionFrozenCommand,
  is as SetWorksheetColAutoWidthCommand,
  ss as SetZoomRatioCommand,
  Jt as SetZoomRatioOperation,
  m0 as SheetBar,
  yi as SheetCanvasPopManagerService,
  Hl as SheetCellDropdownManagerService,
  Ao as SheetCellEditorResizeService,
  rl as SheetClipboardService,
  un as SheetCopyCommand,
  Yd as SheetCutCommand,
  wb as SheetMenuPosition,
  fo as SheetPasteBesidesBorderCommand,
  ri as SheetPasteColWidthCommand,
  hn as SheetPasteCommand,
  mo as SheetPasteFormatCommand,
  Xc as SheetPasteShortKeyCommand,
  go as SheetPasteValueCommand,
  Ii as SheetPermissionCheckUIController,
  Nm as SheetPermissionOpenDialogOperation,
  Hn as SheetPermissionOpenPanelOperation,
  rd as SheetPermissionRenderManagerService,
  Vr as SheetPermissionUserManagerService,
  Ap as SheetPrintInterceptorService,
  fl as SheetRenderController,
  Et as SheetScrollManagerService,
  id as SheetSelectionRenderService,
  ue as SheetSkeletonManagerService,
  pl as SheetUIController,
  ir as SheetsRenderService,
  Ci as SheetsScrollRenderController,
  v_ as SheetsUIMenuSchema,
  Wm as SheetsUIPart,
  Ia as ShowMenuListCommand,
  eu as SidebarDefinedNameOperation,
  Er as StatusBarController,
  nf as StatusBarService,
  ga as UNIVER_SHEET_PERMISSION_USER_PART,
  Vl as UniverSheetsMobileUIPlugin,
  Nl as UniverSheetsUIPlugin,
  oi as ViewSheetPermissionFromContextMenuCommand,
  pa as ViewSheetPermissionFromSheetBarCommand,
  Ks as attachPrimaryWithCoord,
  bo as attachRangeWithCoord,
  Wt as attachSelectionWithCoord,
  $0 as calculateDocSkeletonRects,
  gl as checkInHeaderRanges,
  t2 as convertPositionCellToSheetOverGrid,
  e2 as convertPositionSheetOverGridToAbsolute,
  pt as deriveStateFromActiveSheet$,
  Cr as discreteRangeToRange,
  Ua as functionDisplayNames,
  Sr as genNormalSelectionStyle,
  AC as genSelectionByRange,
  fm as getAllSelection,
  zy as getAutoFillRepeatRange,
  ww as getCellRealRange,
  lh as getCoordByCell,
  Vn as getCoordByOffset,
  ob as getCurrentExclusiveRangeInterest$,
  he as getCurrentRangeDisable$,
  Jy as getCustomRangePosition,
  $y as getEditingCustomRangePosition,
  Dd as getEditorObject,
  N1 as getMatrixPlainText,
  zi as getObservableWithExclusiveRange$,
  Yy as getRepeatRange,
  en as getSheetObject,
  Bd as getTopLeftSelectionOfCurrSheet,
  Os as getTransformCoord,
  Ky as isEmbeddingFormulaEditor,
  U0 as isRangeSelector,
  rh as mergeSetRangeValues,
  kr as useActiveWorkbook,
  Gy as useActiveWorksheet,
  pR as useHighlightRange,
  ef as useKeyEventConfig,
  qy as useWorkbooks,
  wr as virtualizeDiscreteRanges,
  jy as whenFormulaEditorActivated,
  Ve as whenSheetEditorFocused
};
